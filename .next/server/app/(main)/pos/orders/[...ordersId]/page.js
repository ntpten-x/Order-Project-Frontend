(()=>{var e={};e.id=1304,e.ids=[1304],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},78893:e=>{"use strict";e.exports=require("buffer")},61282:e=>{"use strict";e.exports=require("child_process")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},35240:e=>{"use strict";e.exports=require("https")},98216:e=>{"use strict";e.exports=require("net")},19801:e=>{"use strict";e.exports=require("os")},76162:e=>{"use strict";e.exports=require("stream")},82452:e=>{"use strict";e.exports=require("tls")},74175:e=>{"use strict";e.exports=require("tty")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},96110:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>l.Z,__next_app__:()=>p,originalPathname:()=>c,pages:()=>d,routeModule:()=>y,tree:()=>o}),r(64538),r(85429),r(58522),r(86296),r(7629),r(11930),r(12523);var i=r(23191),s=r(88716),l=r(43315),n=r(95231),a={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(a[e]=()=>n[e]);r.d(t,a);let o=["",{children:["(main)",{children:["pos",{children:["orders",{children:["[...ordersId]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,64538)),"E:\\Project\\Order-Project-Frontend\\src\\app\\(main)\\pos\\orders\\[...ordersId]\\page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,85429)),"E:\\Project\\Order-Project-Frontend\\src\\app\\(main)\\pos\\layout.tsx"]}]},{layout:[()=>Promise.resolve().then(r.bind(r,58522)),"E:\\Project\\Order-Project-Frontend\\src\\app\\(main)\\layout.tsx"]}]},{layout:[()=>Promise.resolve().then(r.bind(r,86296)),"E:\\Project\\Order-Project-Frontend\\src\\app\\layout.tsx"],error:[()=>Promise.resolve().then(r.bind(r,7629)),"E:\\Project\\Order-Project-Frontend\\src\\app\\error.tsx"],loading:[()=>Promise.resolve().then(r.bind(r,11930)),"E:\\Project\\Order-Project-Frontend\\src\\app\\loading.tsx"],"not-found":[()=>Promise.resolve().then(r.bind(r,12523)),"E:\\Project\\Order-Project-Frontend\\src\\app\\not-found.tsx"]}],d=["E:\\Project\\Order-Project-Frontend\\src\\app\\(main)\\pos\\orders\\[...ordersId]\\page.tsx"],c="/(main)/pos/orders/[...ordersId]/page",p={require:r,loadChunk:()=>Promise.resolve()},y=new i.AppPageRouteModule({definition:{kind:s.x.APP_PAGE,page:"/(main)/pos/orders/[...ordersId]/page",pathname:"/pos/orders/[...ordersId]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},75349:(e,t,r)=>{Promise.resolve().then(r.bind(r,45997))},16185:(e,t,r)=>{"use strict";r.d(t,{Z:()=>a});var i=r(17577);let s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M864 736c0-111.6-65.4-208-160-252.9V317.3c0-15.1-5.3-29.7-15.1-41.2L536.5 95.4C530.1 87.8 521 84 512 84s-18.1 3.8-24.5 11.4L335.1 276.1a63.97 63.97 0 00-15.1 41.2v165.8C225.4 528 160 624.4 160 736h156.5c-2.3 7.2-3.5 15-3.5 23.8 0 22.1 7.6 43.7 21.4 60.8a97.2 97.2 0 0043.1 30.6c23.1 54 75.6 88.8 134.5 88.8 29.1 0 57.3-8.6 81.4-24.8 23.6-15.8 41.9-37.9 53-64a97 97 0 0043.1-30.5 97.52 97.52 0 0021.4-60.8c0-8.4-1.1-16.4-3.1-23.8H864zM762.3 621.4c9.4 14.6 17 30.3 22.5 46.6H700V558.7a211.6 211.6 0 0162.3 62.7zM388 483.1V318.8l124-147 124 147V668H388V483.1zM239.2 668c5.5-16.3 13.1-32 22.5-46.6 16.3-25.2 37.5-46.5 62.3-62.7V668h-84.8zm388.9 116.2c-5.2 3-11.2 4.2-17.1 3.4l-19.5-2.4-2.8 19.4c-5.4 37.9-38.4 66.5-76.7 66.5-38.3 0-71.3-28.6-76.7-66.5l-2.8-19.5-19.5 2.5a27.7 27.7 0 01-17.1-3.5c-8.7-5-14.1-14.3-14.1-24.4 0-10.6 5.9-19.4 14.6-23.8h231.3c8.8 4.5 14.6 13.3 14.6 23.8-.1 10.2-5.5 19.6-14.2 24.5zM464 400a48 48 0 1096 0 48 48 0 10-96 0z"}}]},name:"rocket",theme:"outlined"};var l=r(74082);function n(){return(n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}let a=i.forwardRef((e,t)=>i.createElement(l.Z,n({},e,{ref:t,icon:s})))},30278:(e,t,r)=>{"use strict";r.d(t,{Z:()=>a});var i=r(17577);let s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M893.3 293.3L730.7 130.7c-7.5-7.5-16.7-13-26.7-16V112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V338.5c0-17-6.7-33.2-18.7-45.2zM384 184h256v104H384V184zm456 656H184V184h136v136c0 17.7 14.3 32 32 32h320c17.7 0 32-14.3 32-32V205.8l136 136V840zM512 442c-79.5 0-144 64.5-144 144s64.5 144 144 144 144-64.5 144-144-64.5-144-144-144zm0 224c-44.2 0-80-35.8-80-80s35.8-80 80-80 80 35.8 80 80-35.8 80-80 80z"}}]},name:"save",theme:"outlined"};var l=r(74082);function n(){return(n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}let a=i.forwardRef((e,t)=>i.createElement(l.Z,n({},e,{ref:t,icon:s})))},61758:(e,t,r)=>{"use strict";r.d(t,{Z:()=>a});var i=r(17577);let s={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M922.9 701.9H327.4l29.9-60.9 496.8-.9c16.8 0 31.2-12 34.2-28.6l68.8-385.1c1.8-10.1-.9-20.5-7.5-28.4a34.99 34.99 0 00-26.6-12.5l-632-2.1-5.4-25.4c-3.4-16.2-18-28-34.6-28H96.5a35.3 35.3 0 100 70.6h125.9L246 312.8l58.1 281.3-74.8 122.1a34.96 34.96 0 00-3 36.8c6 11.9 18.1 19.4 31.5 19.4h62.8a102.43 102.43 0 00-20.6 61.7c0 56.6 46 102.6 102.6 102.6s102.6-46 102.6-102.6c0-22.3-7.4-44-20.6-61.7h161.1a102.43 102.43 0 00-20.6 61.7c0 56.6 46 102.6 102.6 102.6s102.6-46 102.6-102.6c0-22.3-7.4-44-20.6-61.7H923c19.4 0 35.3-15.8 35.3-35.3a35.42 35.42 0 00-35.4-35.2zM305.7 253l575.8 1.9-56.4 315.8-452.3.8L305.7 253zm96.9 612.7c-17.4 0-31.6-14.2-31.6-31.6 0-17.4 14.2-31.6 31.6-31.6s31.6 14.2 31.6 31.6a31.6 31.6 0 01-31.6 31.6zm325.1 0c-17.4 0-31.6-14.2-31.6-31.6 0-17.4 14.2-31.6 31.6-31.6s31.6 14.2 31.6 31.6a31.6 31.6 0 01-31.6 31.6z"}}]},name:"shopping-cart",theme:"outlined"};var l=r(74082);function n(){return(n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}let a=i.forwardRef((e,t)=>i.createElement(l.Z,n({},e,{ref:t,icon:s})))},45997:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>eh});var i=r(10326),s=r(77626),l=r.n(s),n=r(17577),a=r(35047),o=r(58184),d=r(46752),c=r(75698),p=r(64635),y=r(61357),h=r(6400),x=r(71935),u=r(4139),m=r(38106),g=r(56249),j=r(30124),f=r(13483),b=r(276),v=r(62938),_=r(41684),w=r(24895),S=r(46024),k=r(63191),Z=r(49965),C=r(2643),P=r(9297),z=r(16185),B=r(80490),T=r(72380),A=r(12226),N=r(26859),E=r(33357),O=r(31499),I=r(13976),R=r(10985),$=r(43401),F=r(95963),L=r(88295),q=r.n(L);r(63699);var D=r(46226),M=r(75958),H=r(49909),W=r(31916),G=r(24395),V=r(61758),X=r(38572),U=r(51562),Y=r(47374),J=r(37938);let{Text:K,Title:Q}=o.default,ee=({isOpen:e,onClose:t,onAddItem:r})=>{let[s,a]=(0,n.useState)([]),[o,p]=(0,n.useState)([]),[y,h]=(0,n.useState)([]),[u,m]=(0,n.useState)(null),[g,j]=(0,n.useState)(""),{showLoading:f,hideLoading:v}=(0,J.x)(),[_,w]=(0,n.useState)(null),[S,P]=(0,n.useState)(1),[z,B]=(0,n.useState)(""),[A,N]=(0,n.useState)([]),E=(0,n.useCallback)(async()=>{try{f("กำลังโหลดข้อมูลสินค้า...");let[e,t]=await Promise.all([Y.R.findAll(1,100),U.G.findAll()]);a(e.data),p(e.data),h(t)}catch{d.ZP.error("ไม่สามารถโหลดข้อมูลได้")}finally{v()}},[f,v]),O=(0,n.useCallback)(()=>{P(1),B(""),N([]),w(null),j("")},[]);(0,n.useEffect)(()=>{e&&(E(),O())},[E,e,O]);let I=e=>{m(e),R(g,e)},R=(e,t)=>{let r=s;t&&(r=r.filter(e=>e.category_id===t)),e&&(r=r.filter(t=>t.display_name.toLowerCase().includes(e.toLowerCase()))),p(r)},L=e=>{w(e),P(1),B(""),N([])},q=(e,t,r)=>{N(i=>i.map(i=>{if(i.id!==e)return i;if("price"===t){let e="number"==typeof r?r:Number(r)||0;return{...i,price:e}}return{...i,name:String(r)}}))},ee=e=>{N(t=>t.filter(t=>t.id!==e))},et=async()=>{if(_)try{f("กำลังเพิ่มรายการ...");let e=A.filter(e=>""!==e.name.trim()).map(e=>({detail_name:e.name,extra_price:e.price}));await r(_,S,z,e),d.ZP.success("เพิ่มรายการเรียบร้อย"),t(),w(null)}catch{}finally{v()}};return(0,i.jsxs)(M.Z,{className:"mobile-fullscreen-modal",title:null,open:e,onCancel:t,footer:null,width:850,destroyOnClose:!0,centered:!0,children:[i.jsx(l(),{id:$.$k.__hash,children:$.$k}),(0,i.jsxs)("div",{style:$.il.modalHeader,children:[_?i.jsx(x.ZP,{type:"text",icon:i.jsx(C.Z,{}),onClick:()=>w(null),style:{height:40,width:40,borderRadius:"50%"}}):i.jsx(x.ZP,{type:"text",icon:i.jsx(Z.Z,{}),onClick:t,style:{height:40,width:40,borderRadius:"50%"}}),i.jsx(K,{strong:!0,style:{fontSize:20,flex:1},children:_?"ระบุรายละเอียด":"เลือกสินค้า"})]}),_?i.jsx("div",{style:$.m4.detailSection,children:(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:20},children:[(0,i.jsxs)("div",{style:{display:"flex",gap:16,alignItems:"flex-start"},children:[_.img_url?i.jsx(i.Fragment,{children:i.jsx(D.default,{src:_.img_url,alt:_.display_name,width:100,height:100,style:{objectFit:"cover",borderRadius:12}})}):i.jsx("div",{style:{width:100,height:100,background:$._A.backgroundSecondary,borderRadius:12,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:i.jsx(V.Z,{style:{fontSize:32,opacity:.2}})}),(0,i.jsxs)("div",{children:[i.jsx(Q,{level:4,style:{margin:"0 0 4px 0",fontSize:22},children:_.display_name}),(0,i.jsxs)(K,{style:{fontSize:22,fontWeight:700,color:$._A.primary},children:["฿",Number(_.price).toLocaleString()]})]})]}),i.jsx(b.Z,{style:{margin:"0"}}),(0,i.jsxs)("div",{children:[i.jsx(K,{strong:!0,style:{display:"block",marginBottom:12,fontSize:16},children:"จำนวน"}),(0,i.jsxs)("div",{style:$.il.quantityControl,children:[i.jsx(x.ZP,{type:"primary",icon:i.jsx(X.Z,{}),onClick:()=>P(e=>Math.max(1,e-1)),disabled:S<=1,style:{...$.il.quantityButton,background:$._A.white,color:$._A.primary,border:`1px solid ${$._A.primary}`}}),i.jsx("div",{style:$.il.quantityDisplay,children:S}),i.jsx(x.ZP,{type:"primary",icon:i.jsx(T.Z,{}),onClick:()=>P(e=>e+1),style:$.il.quantityButton})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[i.jsx(K,{strong:!0,style:{fontSize:16},children:"ตัวเลือกเพิ่มเติม (Optional)"}),i.jsx(x.ZP,{size:"small",type:"dashed",onClick:()=>{N(e=>[...e,{id:Date.now(),name:"",price:0}])},icon:i.jsx(T.Z,{}),children:"เพิ่ม"})]}),A.map(e=>(0,i.jsxs)("div",{style:$.m4.detailItemRow,children:[i.jsx(H.default,{placeholder:"ไข่ดาว, พิเศษ...",value:e.name,onChange:t=>q(e.id,"name",t.target.value),style:{flex:1,borderRadius:8}}),i.jsx(W.Z,{placeholder:"0.00",value:e.price,onChange:t=>q(e.id,"price",t||0),style:{width:100,borderRadius:8,height:40},inputMode:"decimal",controls:!1,min:0,precision:2,formatter:e=>`${e}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:e=>e.replace(/\$\s?|(,*)/g,""),onKeyDown:t=>{/^[0-9]$/.test(t.key)||["Backspace","Delete","ArrowLeft","ArrowRight","Tab","Enter","."].includes(t.key)||t.preventDefault(),"."===t.key&&e.price.toString().includes(".")&&t.preventDefault()}}),i.jsx(x.ZP,{type:"text",danger:!0,icon:i.jsx(k.Z,{}),onClick:()=>ee(e.id)})]},e.id))]}),(0,i.jsxs)("div",{children:[i.jsx(K,{strong:!0,style:{display:"block",marginBottom:8,fontSize:16},children:"หมายเหตุ"}),i.jsx(H.default.TextArea,{rows:2,value:z,onChange:e=>B(e.target.value),placeholder:"เช่น ไม่ใส่ผัก, เผ็ดน้อย...",style:{borderRadius:12,fontSize:16,padding:"10px"}})]}),(0,i.jsxs)("div",{style:{marginTop:20},children:[(0,i.jsxs)("div",{style:{...$.il.priceCard,marginBottom:16,padding:"16px"},children:[i.jsx(K,{strong:!0,style:{fontSize:16},children:"ยอดรวมรายการนี้"}),i.jsx(K,{style:{...$.il.priceValue,fontSize:24},children:(0,F.xG)((()=>{if(!_)return 0;let e=A.map(e=>({detail_name:e.name,extra_price:e.price}));return(0,F.ku)(_.price,S,e)})())})]}),(0,i.jsxs)("div",{style:{display:"flex",gap:12},children:[i.jsx(x.ZP,{onClick:()=>w(null),style:$.il.secondaryButton,children:"ย้อนกลับ"}),i.jsx(x.ZP,{type:"primary",onClick:et,icon:i.jsx(T.Z,{}),style:$.il.primaryButton,children:"เพิ่มลงออเดอร์"})]})]})]})}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{style:{...$.m4.searchBar,paddingBottom:8},children:[i.jsx(H.default,{placeholder:"ค้นหาสินค้าหรือรหัส...",prefix:i.jsx(G.Z,{style:{color:$._A.textSecondary}}),value:g,onChange:e=>{let t=e.target.value;j(t),R(t,u)},allowClear:!0,style:{...$.m4.searchInput,marginBottom:12}}),(0,i.jsxs)("div",{style:{display:"flex",overflowX:"auto",gap:8,paddingBottom:4,scrollBehavior:"smooth",scrollbarWidth:"none",msOverflowStyle:"none"},className:"hide-scrollbar",children:[i.jsx(x.ZP,{size:"middle",type:null===u?"primary":"default",onClick:()=>I(null),style:{borderRadius:20,minWidth:70,border:null===u?"none":`1px solid ${$._A.border}`},children:"ทั้งหมด"}),y.map(e=>i.jsx(x.ZP,{size:"middle",type:u===e.id?"primary":"default",onClick:()=>I(e.id),style:{borderRadius:20,border:u===e.id?"none":`1px solid ${$._A.border}`},children:e.display_name||e.category_name},e.id))]})]}),(0,i.jsxs)("div",{style:{maxHeight:"calc(100vh - 130px)",overflowY:"auto"},className:"order-detail-content",children:[i.jsx("div",{style:$.m4.productGrid,className:"product-grid",children:o.map(e=>(0,i.jsxs)("div",{style:$.m4.productCard,onClick:()=>L(e),className:"product-card-hoverable scale-in",children:[i.jsx("div",{style:{position:"relative",width:"100%",height:120},children:e.img_url?i.jsx(i.Fragment,{children:i.jsx(D.default,{alt:e.display_name,src:e.img_url,fill:!0,style:{objectFit:"cover",borderRadius:"12px 12px 0 0"},sizes:"(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw"})}):i.jsx("div",{style:$.m4.productPlaceholder,children:i.jsx(V.Z,{style:{fontSize:24,opacity:.3}})})}),(0,i.jsxs)("div",{style:$.m4.productInfo,children:[i.jsx("div",{style:{...$.m4.productName,fontSize:18,lineHeight:1.3},children:e.display_name}),i.jsx(K,{style:{...$.m4.productPrice,fontSize:16},children:(0,F.xG)(e.price)})]})]},e.id))}),0===o.length&&i.jsx(c.Z,{description:"ไม่พบสินค้าที่คุณต้องการ",style:{marginTop:60}})]})]})]})};var et=r(30278);let{Text:er,Title:ei}=o.default,{TextArea:es}=H.default,el=({item:e,isOpen:t,onClose:r,onSave:s})=>{let[l,a]=(0,n.useState)(1),[o,d]=(0,n.useState)(""),[c,h]=(0,n.useState)([]),{showLoading:u,hideLoading:m}=(0,J.x)();(0,n.useEffect)(()=>{e&&t&&(a(e.quantity),d(e.notes||""),h(e.details?[...e.details.map(e=>({...e}))]:[]))},[e,t]);let g=async()=>{if(e)try{u("กำลังบันทึกแก้ไข..."),await s(e.id,l,o,c),r()}catch{}finally{m()}},j=e=>{h(c.filter((t,r)=>r!==e))},f=(e,t,r)=>{let i=[...c];i[e]={...i[e],[t]:r},h(i)};return e?(0,i.jsxs)(M.Z,{className:"mobile-fullscreen-modal",title:null,open:t,onCancel:r,footer:null,width:480,destroyOnClose:!0,centered:!0,closable:!1,children:[(0,i.jsxs)("div",{style:{...$.il.modalHeader,padding:"12px 16px"},children:[i.jsx(er,{strong:!0,style:{fontSize:18,flex:1},children:"แก้ไขรายการ"}),i.jsx(x.ZP,{type:"text",icon:i.jsx(Z.Z,{}),onClick:r,style:{height:32,width:32,display:"flex",alignItems:"center",justifyContent:"center",marginRight:-8}})]}),(0,i.jsxs)("div",{style:{padding:"16px",maxHeight:"70vh",overflowY:"auto"},children:[(0,i.jsxs)("div",{style:{display:"flex",gap:16,marginBottom:20,alignItems:"center"},children:[i.jsx("div",{style:{flexShrink:0},children:e.product?.img_url?i.jsx(D.default,{src:e.product.img_url,alt:e.product?.display_name??"สินค้า",width:80,height:80,style:{borderRadius:12,objectFit:"cover",border:`1px solid ${$._A.border}`}}):i.jsx("div",{style:{width:80,height:80,borderRadius:12,background:$._A.backgroundSecondary,display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsx(_.Z,{style:{fontSize:24,color:$._A.textSecondary}})})}),(0,i.jsxs)("div",{style:{flex:1,minWidth:0},children:[i.jsx(ei,{level:5,style:{margin:0,fontSize:18},children:e.product?.display_name||"ไม่ระบุ"}),(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginTop:4},children:[e.product?.category?.display_name&&i.jsx(y.Z,{color:"cyan",style:{fontSize:10,margin:0,borderRadius:4},children:e.product.category.display_name}),i.jsx(er,{type:"secondary",style:{fontSize:14},children:(0,F.xG)(e.price)})]})]})]}),i.jsx(b.Z,{style:{margin:"16px 0"}}),(0,i.jsxs)("div",{style:{marginBottom:24},children:[(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[i.jsx(er,{strong:!0,style:{fontSize:16},children:"รายการเพิ่มเติม (Topping)"}),i.jsx(x.ZP,{type:"text",icon:i.jsx(T.Z,{style:{fontSize:12}}),onClick:()=>{h([...c,{detail_name:"",extra_price:0}])},style:{borderRadius:"30px",background:$._A.primaryLight,color:$._A.primary,fontWeight:700,fontSize:"13px",height:"32px",padding:"0 16px",border:`1px solid ${$._A.primary}40`,display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.3s ease"},className:"scale-hover",children:"เพิ่มรายการ"})]}),0===c.length?i.jsx("div",{style:{textAlign:"center",padding:"12px",background:"#f9f9f9",borderRadius:8},children:i.jsx(er,{type:"secondary",style:{fontSize:13},children:"ไม่มีรายการเพิ่มเติม"})}):i.jsx(p.Z,{direction:"vertical",style:{width:"100%"},size:10,children:c.map((e,t)=>(0,i.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"flex-start"},children:[i.jsx(H.default,{placeholder:"รายการ",value:e.detail_name,onChange:e=>f(t,"detail_name",e.target.value),style:{flex:2,borderRadius:8}}),i.jsx(W.Z,{placeholder:"ราคา",value:e.extra_price,onChange:e=>f(t,"extra_price",e||0),style:{flex:1,borderRadius:8,height:40},inputMode:"decimal",controls:!1,min:0,precision:2,formatter:e=>`${e}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:e=>e.replace(/\$\s?|(,*)/g,""),onKeyDown:t=>{/^[0-9]$/.test(t.key)||["Backspace","Delete","ArrowLeft","ArrowRight","Tab","Enter","."].includes(t.key)||t.preventDefault(),"."===t.key&&e.extra_price.toString().includes(".")&&t.preventDefault()}}),i.jsx(x.ZP,{danger:!0,type:"text",icon:i.jsx(k.Z,{}),onClick:()=>j(t),style:{color:$._A.danger}})]},t))})]}),(0,i.jsxs)("div",{style:{marginBottom:24},children:[i.jsx(er,{strong:!0,style:{display:"block",marginBottom:12,fontSize:16},children:"ปรับจำนวน"}),(0,i.jsxs)("div",{style:{...$.il.quantityControl,padding:"8px",borderRadius:12},children:[i.jsx(x.ZP,{type:"primary",icon:i.jsx(X.Z,{}),onClick:()=>{a(e=>Math.max(1,e-1))},disabled:l<=1,style:{...$.il.quantityButton,background:$._A.white,color:$._A.primary,border:`1px solid ${$._A.primary}`}}),i.jsx("div",{style:$.il.quantityDisplay,children:l}),i.jsx(x.ZP,{type:"primary",icon:i.jsx(T.Z,{}),onClick:()=>{a(e=>e+1)},style:$.il.quantityButton})]})]}),(0,i.jsxs)("div",{style:{marginBottom:24},children:[i.jsx(er,{strong:!0,style:{display:"block",marginBottom:8,fontSize:16},children:"หมายเหตุ / คำแนะนำพิเศษ"}),i.jsx(es,{value:o,onChange:e=>d(e.target.value),placeholder:"เช่น หวานน้อย, ไม่ใส่น้ำตาล...",rows:2,style:{borderRadius:10,padding:"10px 14px",fontSize:16}})]}),(0,i.jsxs)("div",{style:{...$.il.priceCard,padding:"12px 16px",borderRadius:12,background:$._A.primaryLight},children:[i.jsx(er,{strong:!0,style:{fontSize:16},children:"ยอดรวมรายการนี้"}),(0,i.jsxs)(ei,{level:4,style:{margin:0,color:$._A.primary},children:["฿",(0,F.ku)(Number(e.price),l,c).toLocaleString()]})]})]}),(0,i.jsxs)("div",{style:{...$.il.actionButtons,padding:"16px",borderTop:`1px solid ${$._A.border}`},children:[i.jsx(x.ZP,{onClick:r,style:{...$.il.secondaryButton,flex:1},children:"ยกเลิก"}),i.jsx(x.ZP,{type:"primary",onClick:g,icon:i.jsx(et.Z,{}),style:{...$.il.primaryButton,flex:2},children:"บันทึกแก้ไข"})]})]}):null};var en=r(58989),ea=r(67355),eo=r(3548),ed=r(80440),ec=r(54354);let{Title:ep,Text:ey}=o.default;function eh(){let e=(0,a.useRouter)(),t=(0,a.useParams)(),r=Array.isArray(t?.ordersId)?t.ordersId[0]:t?.ordersId,[s,o]=(0,n.useState)(null),[L,D]=(0,n.useState)(!0),[M,H]=(0,n.useState)(!1),{showLoading:W,hideLoading:G}=(0,J.x)(),{socket:V}=(0,ed.s)(),X=(0,ea.L)(),[U,Y]=(0,n.useState)([]),[K,Q]=(0,n.useState)(!1),[et,er]=(0,n.useState)(null),[ei,es]=(0,n.useState)(!1),[eh,ex]=(0,n.useState)({open:!1,type:"confirm",title:"",content:"",onOk:()=>{}}),eu=()=>ex(e=>({...e,open:!1})),em=(0,n.useCallback)(async t=>{try{D(!0),W("กำลังโหลดข้อมูลออเดอร์...");let r=await N.x.getById(t);if([I.i.Paid,I.i.Cancelled,I.i.WaitingForPayment].includes(r.status)){let t=(0,F.EO)(r);e.push(t);return}o(r)}catch(e){console.error("Failed to fetch order:",e),d.ZP.error("ไม่สามารถโหลดข้อมูลออเดอร์ได้")}finally{D(!1),G()}},[e,W,G]);(0,ec.D)({socket:V,events:["orders:update","orders:delete","orders:create","payments:create","payments:update"],onRefresh:()=>{r&&em(r)},intervalMs:15e3,enabled:!!r});let eg=async e=>{try{H(!0),W("กำลังดำเนินการเสิร์ฟ...");let t=await (0,E.P)();await N.x.updateItemStatus(e,I.i.Served,void 0,t),d.ZP.success("เสิร์ฟรายการเรียบร้อย"),em(r)}catch{d.ZP.error("เกิดข้อผิดพลาดในการเสิร์ฟ")}finally{H(!1),G()}},ej=async()=>{if(0!==U.length)try{H(!0),W(`กำลังดำเนินการเสิร์ฟ ${U.length} รายการ...`);let e=await (0,E.P)();await Promise.all(U.map(t=>N.x.updateItemStatus(t.toString(),I.i.Served,void 0,e))),d.ZP.success("เสิร์ฟรายการที่เลือกเรียบร้อย"),Y([]),em(r)}catch{d.ZP.error("เกิดข้อผิดพลาดในการเสิร์ฟ")}finally{H(!1),G()}},ef=async()=>{0!==U.length&&ex({open:!0,type:"danger",title:"ยืนยันการยกเลิก",content:`คุณต้องการยกเลิก ${U.length} รายการที่เลือกใช่หรือไม่?`,okText:"ยืนยันยกเลิก",cancelText:"ไม่ยกเลิก",onOk:async()=>{try{H(!0),W("กำลังดำเนินการยกเลิก..."),eu();let e=await (0,E.P)();await Promise.all(U.map(t=>N.x.updateItemStatus(t.toString(),I.i.Cancelled,void 0,e))),d.ZP.success("ยกเลิกรายการที่เลือกเรียบร้อย"),Y([]),em(r)}catch{d.ZP.error("เกิดข้อผิดพลาดในการยกเลิก")}finally{H(!1),G()}}})},eb=async e=>{try{H(!0),W("กำลังย้อนกลับสถานะ...");let t=await (0,E.P)();await N.x.updateItemStatus(e,I.i.Cooking,void 0,t),d.ZP.success("ยกเลิกการเสิร์ฟ (กลับไปปรุง)"),em(r)}finally{H(!1),G()}},ev=async e=>{ex({open:!0,type:"danger",title:"ยืนยันการลบ",content:"คุณต้องการลบรายการสินค้านี้ใช่หรือไม่?",okText:"ลบ",cancelText:"ยกเลิก",onOk:async()=>{try{H(!0),W("กำลังลบรายการ..."),eu();let t=await (0,E.P)();await N.x.deleteItem(e,void 0,t),d.ZP.success("ลบรายการเรียบร้อย"),em(r)}catch{d.ZP.error("ไม่สามารถลบรายการได้")}finally{H(!1),G()}}})},e_=async(e,t,i,s=[])=>{try{H(!0),W("กำลังบันทึกข้อมูล...");let l=await (0,E.P)();await N.x.updateItem(e,{quantity:t,notes:i,details:s},void 0,l),d.ZP.success("แก้ไขรายการเรียบร้อย"),em(r)}catch(e){throw d.ZP.error("ไม่สามารถแก้ไขรายการได้"),e}finally{H(!1),G()}},ew=e=>{er(e),Q(!0)},eS=async(e,t,i,s=[])=>{let l=(Number(e.price)+s.reduce((e,t)=>e+t.extra_price,0))*t;if(!X){eo.x.addToQueue("ADD_ITEM",{orderId:r,itemData:{product_id:e.id,quantity:t,price:e.price,notes:i,discount_amount:0,total_price:l,details:s}}),d.ZP.warning("บันทึกข้อมูลแบบ Offline แล้ว"),em(r);return}try{H(!0),W("กำลังเพิ่มสินค้า...");let n=await (0,E.P)();await N.x.addItem(r,{product_id:e.id,quantity:t,price:e.price,notes:i,discount_amount:0,total_price:l,details:s,status:I.i.Cooking},void 0,n),d.ZP.success("เพิ่มสินค้าเรียบร้อย"),em(r)}catch(e){throw d.ZP.error("เพิ่มสินค้าไม่สำเร็จ"),e}finally{H(!1),G()}},ek=async()=>{let t=s?.order_type===I.m.Delivery;ex({open:!0,type:"success",title:t?"ยืนยันจัดออเดอร์เสร็จสิ้น":`ยืนยันการ${(0,F.qO)(s?.order_type)}ทั้งหมด`,content:t?"จัดเตรียมอาหารเรียบร้อยแล้ว ต้องการส่งมอบให้ไรเดอร์หรือไม่?":"รายการทั้งหมดเสร็จสิ้นแล้ว ต้องการเข้าสู่ขั้นตอนการชำระเงินหรือไม่?",okText:"ยืนยัน",cancelText:"ยกเลิก",onOk:async()=>{try{H(!0),W("กำลังยืนยันรายการ..."),eu();let t=await (0,E.P)();if(await N.x.updateStatus(r,I.i.WaitingForPayment,t),d.ZP.success("ยืนยันออเดอร์เรียบร้อย"),s){let t=(0,F.EO)(s);e.push(t)}else e.push("/pos/orders")}catch{d.ZP.error("เกิดข้อผิดพลาดในการยืนยัน")}finally{H(!1),G()}}})};if(L&&!s)return null;if(!s)return i.jsx(c.Z,{description:"ไม่พบข้อมูล"});let eZ=[{title:"",key:"image",width:70,align:"center",render:(e,t)=>t.product?.img_url?i.jsx(i.Fragment,{children:i.jsx("img",{src:t.product.img_url,alt:t.product?.display_name??"สินค้า",style:$.B9.productThumb})}):i.jsx("div",{style:$.B9.productThumbPlaceholder,children:i.jsx(v.Z,{})})},{title:"รายการ",key:"product",align:"center",render:(e,t)=>(0,i.jsxs)(p.Z,{direction:"vertical",size:2,align:"center",children:[i.jsx(ey,{strong:!0,style:{fontSize:15,lineHeight:"1.2"},children:t.product?.display_name}),t.details&&t.details.length>0&&i.jsx("div",{style:{fontSize:13,color:$._A.served,textAlign:"center"},children:t.details.map((e,t)=>(0,i.jsxs)("div",{style:{lineHeight:"1.4"},children:["+ ",e.detail_name]},t))}),t.notes&&(0,i.jsxs)(ey,{style:{fontSize:13,color:$._A.cancelled},children:[i.jsx(_.Z,{})," ",t.notes]})]})},{title:"หมวดหมู่",key:"category",width:120,align:"center",render:(e,t)=>i.jsx(p.Z,{direction:"vertical",size:0,align:"center",children:t.product?.category?.display_name?i.jsx(y.Z,{color:"cyan",style:$.B9.categoryTag,children:t.product.category.display_name}):"-"})},{title:"ราคา",key:"price",width:110,align:"center",render:(e,t)=>(0,i.jsxs)(p.Z,{direction:"vertical",size:0,align:"center",children:[(0,i.jsxs)(ey,{style:{...$.B9.priceTag,fontSize:18},children:["฿",Number(t.price).toLocaleString()]}),t.details&&t.details.length>0&&t.details.map((e,t)=>(0,i.jsxs)(ey,{style:{fontSize:13,color:$._A.priceTotal,display:"block",lineHeight:"1.4"},children:["+ ฿",Number(e.extra_price).toLocaleString()]},t))]})},{title:"สถานะ",dataIndex:"status",key:"status",width:120,align:"center",render:e=>i.jsx(y.Z,{color:e===I.i.Pending?"orange":e===I.i.Cooking?"blue":"green",children:(0,F.d7)(e,s.order_type)})},{title:"จำนวน",dataIndex:"quantity",key:"quantity",width:80,align:"center",render:e=>(0,i.jsxs)(ey,{strong:!0,style:{fontSize:16},children:["x",e]})},{title:"จัดการ",key:"actions",width:130,align:"right",render:(e,t)=>(0,i.jsxs)(p.Z,{children:[i.jsx(h.Z,{title:(0,F.qO)(s.order_type),children:(0,i.jsxs)(x.ZP,{type:"primary",onClick:()=>eg(t.id),style:{background:$._A.served,borderColor:$._A.served,height:"auto",padding:"4px 8px",display:"flex",flexDirection:"column",alignItems:"center",gap:2,minWidth:60,borderRadius:10},children:[i.jsx(w.Z,{style:{fontSize:16}}),i.jsx("span",{style:{fontSize:10,fontWeight:700},children:(0,F.qO)(s.order_type)})]})}),i.jsx(h.Z,{title:"แก้ไข",children:i.jsx(x.ZP,{type:"text",icon:i.jsx(S.Z,{}),onClick:()=>ew(t)})}),i.jsx(h.Z,{title:"ลบ",children:i.jsx(x.ZP,{type:"text",danger:!0,icon:i.jsx(k.Z,{}),onClick:()=>ev(t.id)})})]})}],eC=[{title:"",key:"image",width:70,align:"center",render:(e,t)=>t.product?.img_url?i.jsx(i.Fragment,{children:i.jsx("img",{src:t.product.img_url,alt:t.product?.display_name??"สินค้า",style:{...$.B9.productThumb,opacity:.7}})}):i.jsx("div",{style:$.B9.productThumbPlaceholder,children:i.jsx(v.Z,{})})},{title:"รายการ",key:"product",align:"center",render:(e,t)=>(0,i.jsxs)(p.Z,{direction:"vertical",size:2,align:"center",children:[i.jsx(ey,{strong:!0,style:{fontSize:15,lineHeight:"1.2",textDecoration:t.status===I.i.Cancelled?"line-through":"none",color:t.status===I.i.Cancelled?$._A.textLight:$._A.text},children:t.product?.display_name}),t.details&&t.details.length>0&&i.jsx("div",{style:{fontSize:12,color:$._A.served,opacity:.7,textAlign:"center"},children:t.details.map((e,t)=>(0,i.jsxs)("div",{style:{lineHeight:"1.4"},children:["+ ",e.detail_name]},t))}),t.notes&&(0,i.jsxs)(ey,{style:{fontSize:12,opacity:.7,color:$._A.cancelled},children:[i.jsx(_.Z,{})," ",t.notes]})]})},{title:"หมวดหมู่",key:"category",width:120,align:"center",render:(e,t)=>i.jsx(p.Z,{direction:"vertical",size:0,align:"center",children:t.product?.category?.display_name?i.jsx(y.Z,{color:"cyan",style:{...$.B9.categoryTag,opacity:.7},children:t.product.category.display_name}):"-"})},{title:"ราคา",key:"price",width:110,align:"center",render:(e,t)=>(0,i.jsxs)(p.Z,{direction:"vertical",size:0,align:"center",children:[(0,i.jsxs)(ey,{style:{...$.B9.priceTag,opacity:.7},children:["฿",Number(t.price).toLocaleString()]}),t.details&&t.details.length>0&&t.details.map((e,t)=>(0,i.jsxs)(ey,{style:{fontSize:11,opacity:.7,color:$._A.priceTotal,display:"block",lineHeight:"1.4"},children:["+ ฿",Number(e.extra_price).toLocaleString()]},t))]})},{title:"ราคารวม",key:"total",width:120,align:"center",render:(e,t)=>(0,i.jsxs)(ey,{strong:!0,style:{color:t.status===I.i.Cancelled?$._A.textLight:$._A.priceTotal,fontSize:16,textDecoration:t.status===I.i.Cancelled?"line-through":"none"},children:["฿",Number(t.total_price).toLocaleString()]})},{title:"สถานะ",dataIndex:"status",key:"status",width:120,align:"center",render:e=>i.jsx(y.Z,{color:(0,F.OY)(e),children:(0,F.d7)(e,s.order_type)})},{title:"จำนวน",dataIndex:"quantity",key:"quantity",width:80,align:"center",render:e=>(0,i.jsxs)(ey,{strong:!0,style:{fontSize:16},children:["x",e]})},{title:"จัดการ",key:"actions",width:130,align:"right",render:(e,t)=>t.status===I.i.Served?i.jsx(x.ZP,{size:"small",className:"unserve-button",style:$.B9.unserveButton,icon:i.jsx(Z.Z,{}),onClick:()=>eb(t.id),children:s.order_type===I.m.DineIn?"ยกเลิกเสิร์ฟ":"ยกเลิกปรุงเสร็จ"}):null}],eP=s.items?.filter(e=>e.status===I.i.Pending||e.status===I.i.Cooking)||[],ez=(s.items?.filter(e=>e.status===I.i.Served||e.status===I.i.Cancelled||e.status===I.i.WaitingForPayment)||[]).sort((e,t)=>e.status===I.i.Cancelled&&t.status!==I.i.Cancelled?1:e.status!==I.i.Cancelled&&t.status===I.i.Cancelled?-1:0),eB=(0,F.Nz)(s.items),eT=(0,F.yj)(s.items),eA=0===eP.length&&(s.items?.length||0)>0,eN=eP.length>12,eE=ez.length>12;return(0,i.jsxs)("div",{style:$.B9.container,className:"order-detail-page",children:[i.jsx(l(),{id:$.$k.__hash,children:$.$k}),i.jsx("header",{style:$.B9.header,className:"order-detail-header",children:(0,i.jsxs)("div",{style:$.B9.headerContent,children:[i.jsx(x.ZP,{type:"text",icon:i.jsx(C.Z,{}),onClick:()=>{s?.order_type===I.m.DineIn?e.push("/pos/channels/dine-in"):e.back()},style:{height:40,width:40,borderRadius:"50%"}}),(0,i.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:10},children:[i.jsx(ep,{level:4,style:{margin:0,fontSize:18,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:s.order_no}),s.order_type===I.m.DineIn&&s.table&&(0,i.jsxs)(y.Z,{style:$.B9.tableNameBadge,children:["โต๊ะ ",s.table.table_name]}),s.order_type===I.m.Delivery&&s.delivery_code&&(0,i.jsxs)(y.Z,{style:$.B9.tableNameBadge,children:["รหัสออเดอร์ : ",s.delivery_code]})]}),(0,i.jsxs)("div",{style:$.B9.headerMetaRow,children:[i.jsx(y.Z,{icon:s.order_type===I.m.DineIn?i.jsx(v.Z,{}):s.order_type===I.m.TakeAway?i.jsx(P.Z,{}):i.jsx(z.Z,{}),style:{...$.B9.channelBadge,background:(0,F.Gs)(s.order_type)+"15",color:(0,F.Gs)(s.order_type)},children:(0,F.mz)(s.order_type)}),i.jsx("div",{style:$.B9.headerMetaSeparator}),i.jsx(ey,{type:"secondary",style:{fontSize:13},children:q()(s.create_date).format("HH:mm | D MMM YY")})]})]}),i.jsx(y.Z,{color:(0,F.OY)(s.status),className:"status-badge",style:{margin:0,fontSize:12},children:(0,F.d7)(s.status,s.order_type)})]})}),i.jsx("main",{style:$.B9.contentWrapper,className:"order-detail-content",children:(0,i.jsxs)(u.Z,{gutter:[20,20],children:[(0,i.jsxs)(m.Z,{xs:24,lg:16,children:[i.jsx(g.Z,{className:"order-detail-card fade-in",style:$.B9.card,title:(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,i.jsxs)(p.Z,{align:"center",size:12,children:[i.jsx("div",{style:$.B9.masterCheckboxWrapper,children:i.jsx(j.Z,{indeterminate:U.length>0&&U.length<eP.length,checked:eP.length>0&&U.length===eP.length,onChange:e=>{e.target.checked?Y(eP.map(e=>e.id)):Y([])},style:$.B9.masterCheckbox})}),(0,i.jsxs)(ey,{strong:!0,style:$.Qo.sectionTitle,children:["กำลังทำอาหาร (",eP.length,")"]})]}),(0,i.jsxs)(p.Z,{wrap:!0,children:[U.length>0&&(0,i.jsxs)(p.Z,{style:{gap:8},children:[(0,i.jsxs)(x.ZP,{danger:!0,icon:i.jsx(k.Z,{}),onClick:ef,style:$.B9.bulkActionButtonDesktop,className:"bulk-action-btn",children:[(0,i.jsxs)("span",{className:"hide-on-mobile",children:["ยกเลิกรายการ (",U.length,")"]}),(0,i.jsxs)("span",{className:"show-on-mobile-inline",children:["ยกเลิกรายการ (",U.length,")"]})]}),(0,i.jsxs)(x.ZP,{type:"primary",icon:i.jsx(w.Z,{}),onClick:ej,loading:M,style:{...$.B9.bulkActionButtonDesktop,background:$._A.served,borderColor:$._A.served},className:"bulk-action-btn",children:[(0,i.jsxs)("span",{className:"hide-on-mobile",children:[(0,F.qO)(s.order_type)," (",U.length,")"]}),(0,i.jsxs)("span",{className:"show-on-mobile-inline",children:[(0,F.qO)(s.order_type)," (",U.length,")"]})]})]}),i.jsx(x.ZP,{icon:i.jsx(B.Z,{}),onClick:()=>em(r),style:$.B9.actionButtonSecondary}),i.jsx(x.ZP,{type:"primary",icon:i.jsx(T.Z,{}),onClick:()=>es(!0),style:$.B9.actionButtonPrimary,children:"เพิ่ม"})]})]}),children:eP.length>0?(0,i.jsxs)(i.Fragment,{children:[i.jsx("div",{className:"order-detail-table-desktop",children:i.jsx(f.Z,{dataSource:eP,columns:eZ,rowKey:"id",virtual:eN,scroll:eN?{y:420}:void 0,pagination:!1,size:"middle",className:"order-items-table",rowSelection:{selectedRowKeys:U,onChange:e=>{Y(e)},hideSelectAll:!0}})}),i.jsx("div",{className:"order-detail-cards-mobile",children:eP.map(e=>(0,i.jsxs)("div",{style:{...$.B9.itemCard,...$.B9.itemCardActive,padding:12},className:"order-item-card scale-in",children:[(0,i.jsxs)("div",{style:{display:"flex",gap:12,marginBottom:8},children:[i.jsx("div",{style:{flexShrink:0},children:e.product?.img_url?i.jsx(i.Fragment,{children:i.jsx("img",{src:e.product.img_url,alt:e.product?.display_name??"สินค้า",style:{...$.B9.productThumb,width:60,height:60}})}):i.jsx("div",{style:{...$.B9.productThumbPlaceholder,width:60,height:60},children:i.jsx(v.Z,{})})}),(0,i.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[(0,i.jsxs)("div",{style:{flex:1,minWidth:0},children:[i.jsx(j.Z,{checked:U.includes(e.id),onChange:t=>{Y(t.target.checked?[...U,e.id]:U.filter(t=>t!==e.id))},children:i.jsx(ey,{strong:!0,style:{fontSize:16},children:e.product?.display_name})}),i.jsx("div",{style:{paddingLeft:24,marginTop:2},children:e.product?.category?.display_name&&i.jsx(y.Z,{color:"cyan",style:{...$.B9.categoryTag,fontSize:9},children:e.product.category.display_name})})]}),(0,i.jsxs)(ey,{strong:!0,style:{fontSize:18,color:$._A.primary,marginLeft:8},children:["x",e.quantity]})]}),(0,i.jsxs)("div",{style:{paddingLeft:24,marginTop:2},children:[e.details&&e.details.length>0&&i.jsx("div",{style:{fontSize:12,color:$._A.served,marginBottom:4},children:e.details.map(e=>`${e.detail_name} (+ ฿${Number(e.extra_price).toLocaleString()})`).join(", ")}),i.jsx(p.Z,{direction:"vertical",size:2,children:(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,i.jsxs)(ey,{style:$.B9.priceTag,children:["฿",Number(e.price).toLocaleString()]}),(0,i.jsxs)(ey,{strong:!0,style:{color:$._A.priceTotal},children:["รวม ฿",Number(e.total_price).toLocaleString()]})]})}),e.notes&&i.jsx("div",{style:{marginTop:4},children:(0,i.jsxs)(ey,{style:{fontSize:12,color:$._A.cancelled},children:[i.jsx(_.Z,{})," ",e.notes]})})]})]})]}),(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",borderTop:`1px solid ${$._A.borderLight}`,paddingTop:8,gap:8},children:[i.jsx(x.ZP,{size:"small",type:"text",danger:!0,icon:i.jsx(k.Z,{}),onClick:()=>ev(e.id),children:"ลบ"}),i.jsx(x.ZP,{size:"small",type:"text",icon:i.jsx(S.Z,{}),onClick:()=>ew(e),children:"แก้ไข"}),(0,i.jsxs)(x.ZP,{size:"small",type:"primary",onClick:()=>eg(e.id),style:{background:$._A.served,borderColor:$._A.served,height:"auto",padding:"4px 10px",display:"flex",flexDirection:"column",alignItems:"center",gap:2,borderRadius:10},children:[i.jsx(w.Z,{style:{fontSize:16}}),i.jsx("span",{style:{fontSize:10,fontWeight:700},children:(0,F.qO)(s.order_type)})]})]})]},e.id))})]}):(0,i.jsxs)("div",{style:$.B9.emptyState,children:[i.jsx(A.Z,{className:"empty-state-icon"}),i.jsx(ey,{className:"empty-state-text",children:"ไม่มีรายการที่กำลังรอ"})]})}),i.jsx(g.Z,{className:"order-detail-card fade-in",style:$.B9.card,title:(0,i.jsxs)(ey,{strong:!0,style:{...$.Qo.sectionTitle,color:$._A.textSecondary},children:[(0,F.zP)(s.order_type)," (",ez.length,")"]}),children:ez.length>0?(0,i.jsxs)(i.Fragment,{children:[i.jsx("div",{className:"order-detail-table-desktop",children:i.jsx(f.Z,{dataSource:ez,columns:eC,rowKey:"id",virtual:eE,scroll:eE?{y:360}:void 0,pagination:!1,size:"small",className:"order-items-table",rowClassName:e=>e.status===I.i.Cancelled?"row-cancelled":""})}),i.jsx("div",{className:"order-detail-cards-mobile",children:ez.map(e=>(0,i.jsxs)("div",{style:{...$.B9.itemCard,...$.B9.itemCardServed,padding:12,backgroundColor:e.status===I.i.Cancelled?$._A.cancelledLight:$._A.white,borderColor:e.status===I.i.Cancelled?$._A.cancelled+"30":$._A.border,position:"relative"},children:[i.jsx("div",{style:{position:"absolute",top:8,right:12},children:i.jsx(y.Z,{color:(0,F.OY)(e.status),style:{margin:0},children:(0,F.d7)(e.status,s.order_type)})}),(0,i.jsxs)("div",{style:{display:"flex",gap:12},children:[i.jsx("div",{style:{flexShrink:0},children:e.product?.img_url?i.jsx(i.Fragment,{children:i.jsx("img",{src:e.product.img_url,alt:e.product?.display_name??"สินค้า",style:{...$.B9.productThumb,width:50,height:50,opacity:.7}})}):i.jsx("div",{style:{...$.B9.productThumbPlaceholder,width:50,height:50},children:i.jsx(v.Z,{})})}),i.jsx("div",{style:{flex:1,minWidth:0,paddingRight:60},children:i.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:(0,i.jsxs)("div",{style:{flex:1},children:[i.jsx(ey,{strong:!0,style:{fontSize:15,textDecoration:e.status===I.i.Cancelled?"line-through":"none",color:e.status===I.i.Cancelled?$._A.textLight:$._A.text},children:e.product?.display_name}),i.jsx("div",{style:{marginTop:2},children:e.product?.category?.display_name&&i.jsx(y.Z,{color:"cyan",style:{...$.B9.categoryTag,fontSize:9},children:e.product.category.display_name})}),e.details&&e.details.length>0&&i.jsx("div",{style:{fontSize:12,color:$._A.served,opacity:.7,marginBottom:4},children:e.details.map(e=>`${e.detail_name} (+ ฿${Number(e.extra_price).toLocaleString()})`).join(", ")}),i.jsx(p.Z,{direction:"vertical",size:2,style:{marginTop:4,width:"100%"},children:(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,i.jsxs)("div",{children:[(0,i.jsxs)(ey,{style:{...$.B9.priceTag,opacity:.7},children:["฿",Number(e.price).toLocaleString()]}),(0,i.jsxs)(ey,{strong:!0,style:{marginLeft:8,color:$._A.textSecondary,opacity:.7},children:["รวม ฿",Number(e.total_price).toLocaleString()]})]}),(0,i.jsxs)(ey,{strong:!0,style:{color:$._A.textSecondary},children:["x",e.quantity]})]})}),e.notes&&i.jsx("div",{style:{marginTop:4},children:(0,i.jsxs)(ey,{style:{fontSize:12,opacity:.7,color:$._A.cancelled},children:[i.jsx(_.Z,{})," ",e.notes]})})]})})})]}),e.status===I.i.Served&&i.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:8},children:i.jsx(x.ZP,{size:"small",className:"unserve-button",style:$.B9.unserveButton,icon:i.jsx(Z.Z,{}),onClick:()=>eb(e.id),children:s?.order_type===I.m.DineIn?"ยกเลิกเสิร์ฟ":"ยกเลิกปรุงเสร็จ"})})]},e.id))})]}):i.jsx("div",{style:{textAlign:"center",padding:"20px 0"},children:i.jsx(ey,{type:"secondary",children:"ยังไม่มีรายการที่ดำเนินการแล้ว"})})})]}),i.jsx(m.Z,{xs:24,lg:8,children:(0,i.jsxs)(g.Z,{className:"order-detail-card",style:$.B9.summaryCard,children:[i.jsx(ep,{level:5,style:{marginBottom:16},children:"สรุปการสั่งซื้อ"}),(0,i.jsxs)("div",{style:{...$.B9.summaryList,background:"white"},children:[i.jsx(ey,{strong:!0,style:{fontSize:13,marginBottom:8,display:"block",color:$._A.textSecondary},children:"รายการสินค้า"}),eB.map((e,t)=>(0,i.jsxs)("div",{style:$.B9.summaryItemRow,children:[e.product?.img_url?i.jsx(i.Fragment,{children:i.jsx("img",{src:e.product.img_url,alt:e.product?.display_name||"สินค้า",style:$.B9.summaryItemImage})}):i.jsx("div",{style:{...$.B9.summaryItemImage,display:"flex",alignItems:"center",justifyContent:"center",background:"#f8fafc"},children:i.jsx(v.Z,{style:{fontSize:16,color:"#bfbfbf"}})}),(0,i.jsxs)("div",{style:$.B9.summaryItemContent,children:[(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[i.jsx(ey,{strong:!0,style:{fontSize:13,flex:1},children:e.product?.display_name}),(0,i.jsxs)(ey,{strong:!0,style:{fontSize:13,color:$._A.primary},children:["฿",Number(e.total_price).toLocaleString()]})]}),(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:2},children:[(0,i.jsxs)(ey,{type:"secondary",style:{fontSize:11},children:["จำนวน : ",e.quantity]}),(0,i.jsxs)(ey,{type:"secondary",style:{fontSize:11},children:["ราคา : ",Number(e.price).toLocaleString()]})]}),e.details&&e.details.length>0&&(0,i.jsxs)("div",{style:$.B9.summaryDetailText,children:[i.jsx(T.Z,{style:{fontSize:10}})," ",e.details.map(e=>`${e.detail_name} (+${Number(e.extra_price).toLocaleString()})`).join(", ")]}),e.notes&&(0,i.jsxs)("div",{style:{...$.B9.summaryDetailText,color:$._A.cancelled,fontStyle:"italic"},children:["โน้ต: ",e.notes]})]})]},e.id||t))]}),(0,i.jsxs)("div",{style:$.B9.summaryList,children:[i.jsx(ey,{strong:!0,style:{fontSize:13,marginBottom:8,display:"block",color:$._A.textSecondary},children:"แยกตามหมวดหมู่"}),Object.entries((0,F.Rr)(s?.items||[])).map(([e,t])=>(0,i.jsxs)("div",{style:$.B9.summaryRow,children:[i.jsx(ey,{type:"secondary",style:{fontSize:13},children:e}),(0,i.jsxs)(ey,{strong:!0,style:{fontSize:13},children:[String(t)," รายการ"]})]},e)),i.jsx(b.Z,{style:{margin:"8px 0"}}),(0,i.jsxs)("div",{style:$.B9.summaryRow,children:[i.jsx(ey,{type:"secondary",style:{fontSize:13},children:"จำนวนรายการทั้งหมด"}),(0,i.jsxs)(ey,{strong:!0,style:{fontSize:13},children:[eB.length," รายการ"]})]})]}),i.jsx("div",{style:{padding:"0 4px"},children:(0,i.jsxs)("div",{style:$.B9.summaryMainRow,children:[i.jsx(ey,{strong:!0,style:{fontSize:18},children:"ยอดรวมทั้งสิ้น"}),(0,i.jsxs)(ey,{strong:!0,style:{fontSize:26,color:$._A.primary},children:["฿",eT.toLocaleString()]})]})}),eA&&i.jsx(x.ZP,{type:"primary",block:!0,size:"large",onClick:ek,style:{marginTop:24,height:52,borderRadius:14,fontWeight:700,fontSize:16},children:(0,F.iN)(s.order_type)}),i.jsx(x.ZP,{danger:!0,block:!0,size:"large",onClick:()=>{s&&ex({open:!0,type:"danger",title:"ยืนยันการยกเลิกออเดอร์?",content:"การดำเนินการนี้จะยกเลิกสินค้าทุกรายการและคืนสถานะโต๊ะ (หากมี) คุณแน่ใจหรือไม่?",okText:"ยืนยันการยกเลิก",cancelText:"ยกเลิก",onOk:async()=>{try{H(!0),W("กำลังดำเนินการยกเลิก..."),eu();let t=await (0,E.P)(),r=s.items?.filter(e=>e.status!==I.i.Cancelled)||[];await Promise.all(r.map(e=>N.x.updateItemStatus(e.id,I.i.Cancelled,void 0,t))),await N.x.updateStatus(s.id,I.i.Cancelled,t),s.table_id&&await O.$.update(s.table_id,{status:R.c.Available},void 0,t),d.ZP.success("ยกเลิกออเดอร์เรียบร้อย"),e.push((0,F.d$)(s.order_type))}catch(e){console.error("Cancel failed:",e),d.ZP.error("ไม่สามารถยกเลิกออเดอร์ได้")}finally{H(!1),G()}}})},style:{marginTop:12,height:45,borderRadius:14,fontWeight:600,fontSize:15},disabled:M,children:"ยกเลิกออเดอร์"})]})})]})}),i.jsx(ee,{isOpen:ei,onClose:()=>es(!1),onAddItem:eS}),i.jsx(el,{item:et,isOpen:K,onClose:()=>{Q(!1),er(null)},onSave:e_}),i.jsx(en.Z,{open:eh.open,type:eh.type,title:eh.title,content:eh.content,okText:eh.okText,cancelText:eh.cancelText,onOk:eh.onOk,onCancel:eu,loading:M})]})}q().locale("th")},58989:(e,t,r)=>{"use strict";r.d(t,{Z:()=>m});var i=r(10326),s=r(77626),l=r.n(s);r(17577);var n=r(58184),a=r(75958),o=r(71935),d=r(16771),c=r(33013),p=r(12226),y=r(41684),h=r(2030);let{Title:x,Text:u}=n.default,m=({open:e,type:t="confirm",title:r,content:s,okText:n="ยืนยัน",cancelText:m="ยกเลิก",onOk:g,onCancel:j,loading:f=!1,icon:b})=>{let v=()=>{switch(t){case"danger":return"#ef4444";case"warning":return"#f59e0b";case"success":return"#10b981";default:return"#3b82f6"}},_=v();return(0,i.jsxs)(a.Z,{open:e,onCancel:j,footer:null,centered:!0,width:400,closable:!1,styles:{body:{padding:"32px 24px"},mask:{backdropFilter:"blur(4px)",backgroundColor:"rgba(0,0,0,0.45)"}},className:"modern-confirm-modal",children:[(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center"},className:"jsx-a93d1526d5312985",children:[i.jsx("div",{style:{marginBottom:20,padding:20,borderRadius:"50%",backgroundColor:`${_}10`,display:"flex",alignItems:"center",justifyContent:"center"},className:"jsx-a93d1526d5312985",children:(()=>{if(b)return b;let e={fontSize:42,color:v()};switch(t){case"danger":return i.jsx(d.Z,{style:e});case"warning":return i.jsx(c.Z,{style:e});case"success":return i.jsx(p.Z,{style:e});case"info":return i.jsx(y.Z,{style:e});default:return i.jsx(h.Z,{style:e})}})()}),i.jsx(x,{level:4,style:{marginBottom:12,fontWeight:700},children:r}),i.jsx("div",{style:{marginBottom:32},className:"jsx-a93d1526d5312985",children:"string"==typeof s?i.jsx(u,{type:"secondary",style:{fontSize:15},children:s}):s}),(0,i.jsxs)("div",{style:{width:"100%",display:"flex",gap:12},className:"jsx-a93d1526d5312985",children:[i.jsx(o.ZP,{block:!0,size:"large",onClick:j,disabled:f,style:{borderRadius:12,height:48,fontWeight:600,border:"1px solid #e2e8f0"},children:m}),i.jsx(o.ZP,{block:!0,type:"primary",size:"large",onClick:g,loading:f,style:{borderRadius:12,height:48,fontWeight:600,background:_,border:`1px solid ${_}`,boxShadow:`0 4px 12px ${_}40`},children:n})]})]}),i.jsx(l(),{id:"a93d1526d5312985",children:".modern-confirm-modal .ant-modal-content{-webkit-border-radius:20px!important;-moz-border-radius:20px!important;border-radius:20px!important;-webkit-box-shadow:0 10px 30px rgba(0,0,0,.15)!important;-moz-box-shadow:0 10px 30px rgba(0,0,0,.15)!important;box-shadow:0 10px 30px rgba(0,0,0,.15)!important;overflow:hidden}"})]})}},51562:(e,t,r)=>{"use strict";r.d(t,{G:()=>l});var i=r(12529);let s="/pos/category",l={findAll:async(e,t)=>{let r=(0,i.b)("GET",s);t&&(r+=`?${t.toString()}`);let l={};e&&(l.Cookie=e);let n=await fetch(r,{cache:"no-store",credentials:"include",headers:l});if(!n.ok){let e=await n.json().catch(()=>({}));throw Error(e.error||e.message||"Failed to fetch categories")}return n.json()},findOne:async(e,t)=>{let r=(0,i.b)("GET",`${s}/${e}`),l={};t&&(l.Cookie=t);let n=await fetch(r,{cache:"no-store",credentials:"include",headers:l});if(!n.ok){let e=await n.json().catch(()=>({}));throw Error(e.error||e.message||"Failed to fetch category")}return n.json()},findOneByName:async(e,t)=>{let r=(0,i.b)("GET",`${s}/name/${e}`),l={};t&&(l.Cookie=t);let n=await fetch(r,{cache:"no-store",credentials:"include",headers:l});if(!n.ok){let e=await n.json().catch(()=>({}));throw Error(e.error||e.message||"Failed to fetch category by name")}return n.json()},create:async(e,t,r)=>{let l=(0,i.b)("POST",s),n={"Content-Type":"application/json"};t&&(n.Cookie=t),r&&(n["X-CSRF-Token"]=r);let a=await fetch(l,{method:"POST",headers:n,body:JSON.stringify(e),credentials:"include"});if(!a.ok){let e=await a.json().catch(()=>({}));throw Error(e.error||e.message||"Failed to create category")}return a.json()},update:async(e,t,r,l)=>{let n=(0,i.b)("PUT",`${s}/${e}`),a={"Content-Type":"application/json"};r&&(a.Cookie=r),l&&(a["X-CSRF-Token"]=l);let o=await fetch(n,{method:"PUT",headers:a,body:JSON.stringify(t),credentials:"include"});if(!o.ok){let e=await o.json().catch(()=>({}));throw Error(e.error||e.message||"Failed to update category")}return o.json()},delete:async(e,t,r)=>{let l=(0,i.b)("DELETE",`${s}/${e}`),n={};t&&(n.Cookie=t),r&&(n["X-CSRF-Token"]=r);let a=await fetch(l,{method:"DELETE",headers:n,credentials:"include"});if(!a.ok){let e=await a.json().catch(()=>({}));throw Error(e.error||e.message||"Failed to delete category")}}}},47374:(e,t,r)=>{"use strict";r.d(t,{R:()=>d});var i=r(12529),s=r(40820),l=r(48571);let n=l.Ryn({id:l.Z_8(),product_name:l.Z_8(),display_name:l.Z_8(),description:l.Z_8().optional().or(l.Z_8()),price:l.Rxh().or(l.Z_8().transform(e=>Number(e))),category_id:l.Z_8(),unit_id:l.Z_8(),img_url:l.Z_8().nullable().optional(),create_date:l.Z_8().or(l.hTZ()).transform(e=>new Date(e)),update_date:l.Z_8().or(l.hTZ()).transform(e=>new Date(e)),is_active:l.O72().optional().default(!0),category:l.YjB().optional(),unit:l.YjB().optional()}),a=l.Ryn({data:l.IXX(n),total:l.Rxh(),page:l.Rxh(),last_page:l.Rxh()}),o=s.q.POS.PRODUCTS,d={findAll:async(e=1,t=50,r,s)=>{let l=(0,i.b)("GET",o),n=new URLSearchParams(s||"");n.append("page",e.toString()),n.append("limit",t.toString()),l+=`?${n.toString()}`;let d={};r&&(d.Cookie=r);let c=await fetch(l,{cache:"no-store",credentials:"include",headers:d});if(!c.ok){let e=await c.json().catch(()=>({}));throw Error(e.error||e.message||"Failed to fetch products")}let p=await c.json();return a.parse(p)},findOne:async(e,t)=>{let r=(0,i.b)("GET",`${o}/${e}`),s={};t&&(s.Cookie=t);let l=await fetch(r,{cache:"no-store",credentials:"include",headers:s});if(!l.ok){let e=await l.json().catch(()=>({}));throw Error(e.error||e.message||"Failed to fetch product")}let a=await l.json();return n.parse(a)},findOneByName:async(e,t)=>{let r=(0,i.b)("GET",`${o}/name/${e}`),s={};t&&(s.Cookie=t);let l=await fetch(r,{cache:"no-store",credentials:"include",headers:s});if(!l.ok){let e=await l.json().catch(()=>({}));throw Error(e.error||e.message||"Failed to fetch product by name")}let a=await l.json();return n.parse(a)},create:async(e,t,r)=>{let s=(0,i.b)("POST",o),l={"Content-Type":"application/json"};t&&(l.Cookie=t),r&&(l["X-CSRF-Token"]=r);let n=await fetch(s,{method:"POST",headers:l,body:JSON.stringify(e),credentials:"include"});if(!n.ok){let e=await n.json().catch(()=>({}));throw Error(e.error||e.message||"Failed to create product")}return n.json()},update:async(e,t,r,s)=>{let l=(0,i.b)("PUT",`${o}/${e}`),n={"Content-Type":"application/json"};r&&(n.Cookie=r),s&&(n["X-CSRF-Token"]=s);let a=await fetch(l,{method:"PUT",headers:n,body:JSON.stringify(t),credentials:"include"});if(!a.ok){let e=await a.json().catch(()=>({}));throw Error(e.error||e.message||"Failed to update product")}return a.json()},delete:async(e,t,r)=>{let s=(0,i.b)("DELETE",`${o}/${e}`),l={};t&&(l.Cookie=t),r&&(l["X-CSRF-Token"]=r);let n=await fetch(s,{method:"DELETE",headers:l,credentials:"include"});if(!n.ok){let e=await n.json().catch(()=>({}));throw Error(e.error||e.message||"Failed to delete product")}}}},31499:(e,t,r)=>{"use strict";r.d(t,{$:()=>n});var i=r(12529);let s=r(40820).q.POS.TABLES,l=(e,t="application/json")=>{let r={};return t&&(r["Content-Type"]=t),e&&(r.Cookie=e),r},n={getAll:async(e,t)=>{let r=(0,i.b)("GET",s),n=new URLSearchParams(t||"");n.has("page")||n.set("page","1"),n.has("limit")||n.set("limit","200");let a=n.toString();a&&(r+=`?${a}`);let o=l(e,""),d=await fetch(r,{cache:"no-store",headers:o,credentials:"include"});if(!d.ok){let e=await d.json().catch(()=>({}));throw Error(e.error||e.message||"Failed to fetch tables")}return d.json()},getById:async(e,t)=>{let r=(0,i.b)("GET",`${s}/${e}`),n=l(t,""),a=await fetch(r,{cache:"no-store",headers:n,credentials:"include"});if(!a.ok){let e=await a.json().catch(()=>({}));throw Error(e.error||e.message||"Failed to fetch tables")}return a.json()},getByName:async(e,t)=>{let r=(0,i.b)("GET",`${s}/getByName/${e}`),n=l(t,""),a=await fetch(r,{cache:"no-store",headers:n,credentials:"include"});if(!a.ok){let e=await a.json().catch(()=>({}));throw Error(e.error||e.message||"Failed to fetch tables")}return a.json()},create:async(e,t,r)=>{let n=(0,i.b)("POST",`${s}`),a=l(t);r&&(a["X-CSRF-Token"]=r);let o=await fetch(n,{method:"POST",headers:a,credentials:"include",body:JSON.stringify(e)});if(!o.ok){let e=await o.json().catch(()=>({}));throw Error(e.error||e.message||"Failed to create table")}return o.json()},update:async(e,t,r,n)=>{let a=(0,i.b)("PUT",`${s}/${e}`),o=l(r);n&&(o["X-CSRF-Token"]=n);let d=await fetch(a,{method:"PUT",headers:o,credentials:"include",body:JSON.stringify(t)});if(!d.ok){let e=await d.json().catch(()=>({}));throw Error(e.error||e.message||"Failed to update table")}return d.json()},delete:async(e,t,r)=>{let n=(0,i.b)("DELETE",`${s}/${e}`),a=l(t,"");r&&(a["X-CSRF-Token"]=r);let o=await fetch(n,{method:"DELETE",headers:a,credentials:"include"});if(!o.ok){let e=await o.json().catch(()=>({}));throw Error(e.error||e.message||"Failed to delete table")}}}},64538:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>i});let i=(0,r(68570).createProxy)(String.raw`E:\Project\Order-Project-Frontend\src\app\(main)\pos\orders\[...ordersId]\page.tsx#default`)}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[9276,5898,8571,6927,6226,3332,6857,4300,4259],()=>r(96110));module.exports=i})();