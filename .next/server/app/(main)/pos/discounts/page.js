(()=>{var e={};e.id=2519,e.ids=[2519],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},78893:e=>{"use strict";e.exports=require("buffer")},61282:e=>{"use strict";e.exports=require("child_process")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},32694:e=>{"use strict";e.exports=require("http2")},35240:e=>{"use strict";e.exports=require("https")},98216:e=>{"use strict";e.exports=require("net")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},76162:e=>{"use strict";e.exports=require("stream")},82452:e=>{"use strict";e.exports=require("tls")},74175:e=>{"use strict";e.exports=require("tty")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},76651:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>n.Z,__next_app__:()=>u,originalPathname:()=>d,pages:()=>c,routeModule:()=>p,tree:()=>l}),r(743),r(85429),r(58522),r(61804),r(7629),r(11930),r(12523);var s=r(23191),i=r(88716),n=r(43315),a=r(95231),o={};for(let e in a)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>a[e]);r.d(t,o);let l=["",{children:["(main)",{children:["pos",{children:["discounts",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,743)),"E:\\Project\\Order-Project-Frontend\\src\\app\\(main)\\pos\\discounts\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,85429)),"E:\\Project\\Order-Project-Frontend\\src\\app\\(main)\\pos\\layout.tsx"]}]},{layout:[()=>Promise.resolve().then(r.bind(r,58522)),"E:\\Project\\Order-Project-Frontend\\src\\app\\(main)\\layout.tsx"]}]},{layout:[()=>Promise.resolve().then(r.bind(r,61804)),"E:\\Project\\Order-Project-Frontend\\src\\app\\layout.tsx"],error:[()=>Promise.resolve().then(r.bind(r,7629)),"E:\\Project\\Order-Project-Frontend\\src\\app\\error.tsx"],loading:[()=>Promise.resolve().then(r.bind(r,11930)),"E:\\Project\\Order-Project-Frontend\\src\\app\\loading.tsx"],"not-found":[()=>Promise.resolve().then(r.bind(r,12523)),"E:\\Project\\Order-Project-Frontend\\src\\app\\not-found.tsx"]}],c=["E:\\Project\\Order-Project-Frontend\\src\\app\\(main)\\pos\\discounts\\page.tsx"],d="/(main)/pos/discounts/page",u={require:r,loadChunk:()=>Promise.resolve()},p=new s.AppPageRouteModule({definition:{kind:i.x.APP_PAGE,page:"/(main)/pos/discounts/page",pathname:"/pos/discounts",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:l}})},48046:(e,t,r)=>{Promise.resolve().then(r.bind(r,47268))},2643:(e,t,r)=>{"use strict";r.d(t,{Z:()=>o});var s=r(17577);let i={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M872 474H286.9l350.2-304c5.6-4.9 2.2-14-5.2-14h-88.5c-3.9 0-7.6 1.4-10.5 3.9L155 487.8a31.96 31.96 0 000 48.3L535.1 866c1.5 1.3 3.3 2 5.2 2h91.5c7.4 0 10.8-9.2 5.2-14L286.9 550H872c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8z"}}]},name:"arrow-left",theme:"outlined"};var n=r(74082);function a(){return(a=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e}).apply(this,arguments)}let o=s.forwardRef((e,t)=>s.createElement(n.Z,a({},e,{ref:t,icon:i})))},98064:(e,t,r)=>{"use strict";r.d(t,{Z:()=>o});var s=r(17577);let i={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M855.7 210.8l-42.4-42.4a8.03 8.03 0 00-11.3 0L168.3 801.9a8.03 8.03 0 000 11.3l42.4 42.4c3.1 3.1 8.2 3.1 11.3 0L855.6 222c3.2-3 3.2-8.1.1-11.2zM304 448c79.4 0 144-64.6 144-144s-64.6-144-144-144-144 64.6-144 144 64.6 144 144 144zm0-216c39.7 0 72 32.3 72 72s-32.3 72-72 72-72-32.3-72-72 32.3-72 72-72zm416 344c-79.4 0-144 64.6-144 144s64.6 144 144 144 144-64.6 144-144-64.6-144-144-144zm0 216c-39.7 0-72-32.3-72-72s32.3-72 72-72 72 32.3 72 72-32.3 72-72 72z"}}]},name:"percentage",theme:"outlined"};var n=r(74082);function a(){return(a=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e}).apply(this,arguments)}let o=s.forwardRef((e,t)=>s.createElement(n.Z,a({},e,{ref:t,icon:i})))},47268:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>M});var s=r(10326),i=r(17577),n=r(66874),a=r(61357),o=r(63459),l=r(71935),c=r(75958),d=r(46752),u=r(64635),p=r(49909),x=r(92442),h=r(99251),g=r(98064),f=r(46024),y=r(63191),j=r(80490),m=r(72380),v=r(24395),b=r(82451),P=r(35047),Z=r(37938),_=r(59746),w=r(80440),k=r(33357),S=r(7670),C=r(54354),E=r(83179),z=r(60128),q=r(26902),O=r(26963),T=r(76892),F=r(18978),L=r(52647),R=r(36231);let{Text:A}=n.default,$=e=>{let t=new Date(e);return Number.isNaN(t.getTime())?"-":new Intl.DateTimeFormat("th-TH",{dateStyle:"medium",timeStyle:"short"}).format(t)},I=e=>{let t=Number(e.discount_amount||0);return e.discount_type===b.L.Percentage?`${t}%`:`${t.toLocaleString("th-TH")} บาท`},W=({total:e,active:t,inactive:r,fixed:i,percentage:n})=>(0,s.jsxs)("div",{style:{background:"#fff",borderRadius:16,border:"1px solid #e2e8f0",display:"grid",gridTemplateColumns:"repeat(5, minmax(0, 1fr))",gap:8,padding:14},children:[(0,s.jsxs)("div",{style:{textAlign:"center"},children:[s.jsx("span",{style:{fontSize:24,fontWeight:700,color:"#0f172a",display:"block"},children:e}),s.jsx(A,{style:{fontSize:12,color:"#64748b"},children:"ทั้งหมด"})]}),(0,s.jsxs)("div",{style:{textAlign:"center"},children:[s.jsx("span",{style:{fontSize:24,fontWeight:700,color:"#d97706",display:"block"},children:t}),s.jsx(A,{style:{fontSize:12,color:"#64748b"},children:"ใช้งาน"})]}),(0,s.jsxs)("div",{style:{textAlign:"center"},children:[s.jsx("span",{style:{fontSize:24,fontWeight:700,color:"#b91c1c",display:"block"},children:r}),s.jsx(A,{style:{fontSize:12,color:"#64748b"},children:"ปิดใช้งาน"})]}),(0,s.jsxs)("div",{style:{textAlign:"center"},children:[s.jsx("span",{style:{fontSize:24,fontWeight:700,color:"#0369a1",display:"block"},children:i}),s.jsx(A,{style:{fontSize:12,color:"#64748b"},children:"ลดเป็นบาท"})]}),(0,s.jsxs)("div",{style:{textAlign:"center"},children:[s.jsx("span",{style:{fontSize:24,fontWeight:700,color:"#7e22ce",display:"block"},children:n}),s.jsx(A,{style:{fontSize:12,color:"#64748b"},children:"ลดเปอร์เซ็นต์"})]})]}),H=({discount:e,onEdit:t,onDelete:r,onToggleActive:i,updatingStatusId:n})=>{let c=e.discount_type===b.L.Fixed;return s.jsx("div",{className:"discount-card",style:{...z.R.discountCard(e.is_active),borderRadius:16},onClick:()=>t(e),children:(0,s.jsxs)("div",{style:z.R.discountCardInner,children:[s.jsx("div",{style:{width:52,height:52,borderRadius:14,background:c?"linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%)":"linear-gradient(135deg, #f3e8ff 0%, #e9d5ff 100%)",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,boxShadow:c?"0 4px 10px rgba(3, 105, 161, 0.18)":"0 4px 10px rgba(126, 34, 206, 0.18)"},children:c?s.jsx(h.Z,{style:{fontSize:22,color:"#0369a1"}}):s.jsx(g.Z,{style:{fontSize:22,color:"#7e22ce"}})}),(0,s.jsxs)("div",{style:{flex:1,minWidth:0,paddingRight:8},children:[(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4},children:[s.jsx(A,{strong:!0,style:{fontSize:16,color:"#0f172a"},ellipsis:{tooltip:e.display_name},children:e.display_name}),s.jsx(a.Z,{color:e.is_active?"green":"default",children:e.is_active?"ใช้งาน":"ปิดใช้งาน"})]}),s.jsx(A,{type:"secondary",style:{fontSize:13,display:"block",color:"#334155"},ellipsis:{tooltip:e.discount_name},children:e.discount_name}),(0,s.jsxs)(A,{type:"secondary",style:{fontSize:12,display:"block",marginTop:2},children:["มูลค่าส่วนลด ",I(e)]}),(0,s.jsxs)(A,{type:"secondary",style:{fontSize:12,display:"block",marginTop:2},children:["สร้างเมื่อ ",$(e.create_date)]})]}),(0,s.jsxs)("div",{style:{display:"flex",gap:6,alignItems:"center"},children:[s.jsx(o.Z,{size:"small",checked:e.is_active,loading:n===e.id,onClick:(t,r)=>{r?.stopPropagation(),i(e,t)}}),s.jsx(l.ZP,{type:"text",icon:s.jsx(f.Z,{}),onClick:r=>{r.stopPropagation(),t(e)},style:{borderRadius:10,color:"#d97706",background:"#fff7ed",width:36,height:36}}),s.jsx(l.ZP,{type:"text",danger:!0,icon:s.jsx(y.Z,{}),onClick:t=>{t.stopPropagation(),r(e)},style:{borderRadius:10,background:"#fef2f2",width:36,height:36}})]})]})})};function M(){let e=(0,P.useRouter)(),[t,r]=(0,i.useState)([]),[n,a]=(0,i.useState)(""),[o,h]=(0,i.useState)("all"),[f,A]=(0,i.useState)("all"),[$,I]=(0,i.useState)(null),{execute:M}=(0,_.J)(),{showLoading:N}=(0,Z.x)(),{socket:D}=(0,w.s)(),{isAuthorized:G,isChecking:B}=(0,S.e)({allowedRoles:["Admin","Manager"]}),J=(0,i.useCallback)(async()=>{M(async()=>{let e=await fetch("/api/pos/discounts");if(!e.ok){let t=await e.json().catch(()=>({}));throw Error(t.error||t.message||"ไม่สามารถดึงข้อมูลส่วนลดได้")}let t=await e.json(),s=Array.isArray(t)?t:t?.data;if(!Array.isArray(s))throw Error("รูปแบบข้อมูลไม่ถูกต้อง");r(s)},"กำลังโหลดข้อมูลส่วนลด...")},[M]);(0,C.v)(D,{create:E.b.discounts.create,update:E.b.discounts.update,delete:E.b.discounts.delete},r);let U=(0,i.useMemo)(()=>{let e=t;"active"===o?e=e.filter(e=>e.is_active):"inactive"===o&&(e=e.filter(e=>!e.is_active)),"all"!==f&&(e=e.filter(e=>e.discount_type===f));let r=n.trim().toLowerCase();return r&&(e=e.filter(e=>e.display_name.toLowerCase().includes(r)||e.discount_name.toLowerCase().includes(r)||(e.description||"").toLowerCase().includes(r))),e},[t,n,o,f]),X=()=>{N("กำลังเปิดหน้าจัดการส่วนลด..."),e.push("/pos/discounts/manager/add")},Y=t=>{N("กำลังเปิดหน้าแก้ไขส่วนลด..."),e.push(`/pos/discounts/manager/edit/${t.id}`)},K=e=>{c.Z.confirm({title:"ยืนยันการลบส่วนลด",content:`คุณต้องการลบส่วนลด "${e.display_name}" หรือไม่?`,okText:"ลบ",okType:"danger",cancelText:"ยกเลิก",centered:!0,icon:s.jsx(y.Z,{style:{color:"#EF4444"}}),onOk:async()=>{await M(async()=>{let t=await (0,k.P)();if(!(await fetch(`/api/pos/discounts/delete/${e.id}`,{method:"DELETE",headers:{"X-CSRF-Token":t}})).ok)throw Error("ไม่สามารถลบส่วนลดได้");r(t=>t.filter(t=>t.id!==e.id)),d.ZP.success(`ลบส่วนลด "${e.display_name}" สำเร็จ`)},"กำลังลบส่วนลด...")}})},Q=async(e,t)=>{I(e.id);try{let s=await (0,k.P)(),i=await fetch(`/api/pos/discounts/update/${e.id}`,{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-Token":s},body:JSON.stringify({is_active:t})});if(!i.ok){let e=await i.json().catch(()=>({}));throw Error(e.error||e.message||"ไม่สามารถเปลี่ยนสถานะส่วนลดได้")}let n=await i.json();r(t=>t.map(t=>t.id===e.id?n:t)),d.ZP.success(t?"เปิดใช้งานส่วนลดแล้ว":"ปิดใช้งานส่วนลดแล้ว")}catch(e){console.error(e),d.ZP.error(e instanceof Error?e.message:"ไม่สามารถเปลี่ยนสถานะส่วนลดได้")}finally{I(null)}};if(B)return s.jsx(q.H,{message:"กำลังตรวจสอบสิทธิ์การใช้งาน..."});if(!G)return s.jsx(q.H,{message:"คุณไม่มีสิทธิ์เข้าถึงหน้านี้ กำลังพากลับ...",tone:"danger"});let V=t.filter(e=>e.is_active).length,ee=t.filter(e=>!e.is_active).length,et=t.filter(e=>e.discount_type===b.L.Fixed).length,er=t.filter(e=>e.discount_type===b.L.Percentage).length;return(0,s.jsxs)("div",{className:"discount-page",style:z.R.container,children:[s.jsx("style",{children:z.W}),s.jsx(L.Z,{title:"ส่วนลด",subtitle:`ทั้งหมด ${t.length} รายการ`,icon:s.jsx(g.Z,{}),actions:(0,s.jsxs)(u.Z,{size:8,wrap:!0,children:[s.jsx(l.ZP,{icon:s.jsx(j.Z,{}),onClick:J}),s.jsx(l.ZP,{type:"primary",icon:s.jsx(m.Z,{}),onClick:X,children:"เพิ่มส่วนลด"})]})}),s.jsx(O.Z,{children:(0,s.jsxs)(F.Z,{children:[s.jsx(W,{total:t.length,active:V,inactive:ee,fixed:et,percentage:er}),s.jsx(T.Z,{title:"ค้นหาและตัวกรอง",children:(0,s.jsxs)("div",{style:{display:"grid",gap:10,gridTemplateColumns:"1fr",alignItems:"center"},children:[s.jsx(p.default,{prefix:s.jsx(v.Z,{style:{color:"#94A3B8"}}),allowClear:!0,placeholder:"ค้นหาจากชื่อแสดง ชื่อระบบ หรือคำอธิบาย...",value:n,onChange:e=>a(e.target.value)}),s.jsx(x.Z,{options:[{label:`ทั้งหมด (${t.length})`,value:"all"},{label:`ใช้งาน (${V})`,value:"active"},{label:`ปิดใช้งาน (${ee})`,value:"inactive"}],value:o,onChange:e=>h(e)}),s.jsx(x.Z,{options:[{label:`ทุกประเภท (${t.length})`,value:"all"},{label:`ลดเป็นบาท (${et})`,value:b.L.Fixed},{label:`ลด % (${er})`,value:b.L.Percentage}],value:f,onChange:e=>A(e)})]})}),s.jsx(T.Z,{title:"รายการส่วนลด",extra:s.jsx("span",{style:{fontWeight:600},children:U.length}),children:U.length>0?U.map(e=>s.jsx(H,{discount:e,onEdit:Y,onDelete:K,onToggleActive:Q,updatingStatusId:$},e.id)):s.jsx(R.Z,{title:n.trim()?"ไม่พบส่วนลดตามคำค้น":"ยังไม่มีส่วนลด",description:n.trim()?"ลองเปลี่ยนคำค้น หรือตัวกรองสถานะ/ประเภท":"เพิ่มส่วนลดแรกเพื่อเริ่มใช้งาน",action:n.trim()?null:s.jsx(l.ZP,{type:"primary",icon:s.jsx(m.Z,{}),onClick:X,children:"เพิ่มส่วนลด"})})})]})})]})}},18978:(e,t,r)=>{"use strict";r.d(t,{Z:()=>a});var s=r(10326);r(17577);var i=r(21020),n=r(52386);function a({children:e,gap:t=n.H.sectionGap,style:r}){return s.jsx(i.Z,{vertical:!0,gap:t,style:r,children:e})}},36231:(e,t,r)=>{"use strict";r.d(t,{Z:()=>l});var s=r(10326);r(17577);var i=r(56249),n=r(75698),a=r(66874),o=r(52386);function l({title:e="ไม่มีข้อมูล",description:t,action:r,image:l}){return s.jsx(i.Z,{size:"small",variant:"outlined",style:{borderRadius:o.H.cardRadiusLG},bodyStyle:{padding:20},children:s.jsx(n.Z,{image:l,description:(0,s.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[s.jsx(a.default.Text,{strong:!0,children:e}),t?s.jsx(a.default.Text,{type:"secondary",children:t}):null]}),children:r})})}},59746:(e,t,r)=>{"use strict";r.d(t,{J:()=>a});var s=r(17577),i=r(75958),n=r(37938);let a=()=>{let{showLoading:e,hideLoading:t}=(0,n.x)();return{execute:(0,s.useCallback)(async(r,s="กำลังดำเนินการ...",n,a="เกิดข้อผิดพลาด")=>{try{return e(s,"async"),await r()}catch(t){console.error("Async action error:",t);let e=a;"string"==typeof t?e=t:t instanceof Error?e=t.message:"object"==typeof t&&null!==t&&(e=t.response?.data?.message??t.message??(()=>{try{return JSON.stringify(t)}catch{return"เกิดข้อผิดพลาดที่ไม่ทราบสาเหตุ (Unknown Error)"}})()),i.Z.error({title:"ข้อผิดพลาด",content:e});return}finally{t("async")}},[e,t])}}},80440:(e,t,r)=>{"use strict";r.d(t,{s:()=>n});var s=r(17577),i=r(19211);let n=()=>(0,s.useContext)(i.J)},60128:(e,t,r)=>{"use strict";r.d(t,{R:()=>i,W:()=>n});var s=r(44528);let i={...(0,s.yf)("linear-gradient(135deg, #F59E0B 0%, #D97706 100%)"),discountCard:s.YO,discountCardInner:s.lv},n=(0,s.IU)(".discount-page",".discount-card")},82451:(e,t,r)=>{"use strict";var s;r.d(t,{L:()=>s}),function(e){e.Fixed="Fixed",e.Percentage="Percentage"}(s||(s={}))},54354:(e,t,r)=>{"use strict";function s(e,t,r,s=e=>e.id,i=()=>!0){}function i({socket:e,events:t=[],onRefresh:r,intervalMs:s,enabled:i=!0,debounceMs:n}){}r.d(t,{D:()=>i,v:()=>s}),r(17577)},743:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});let s=(0,r(68570).createProxy)(String.raw`E:\Project\Order-Project-Frontend\src\app\(main)\pos\discounts\page.tsx#default`)}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[9276,4421,8571,1742,8963,1399,4658,3849],()=>r(76651));module.exports=s})();