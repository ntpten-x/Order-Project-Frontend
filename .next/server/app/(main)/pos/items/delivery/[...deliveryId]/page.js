(()=>{var e={};e.id=9110,e.ids=[9110],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},78893:e=>{"use strict";e.exports=require("buffer")},61282:e=>{"use strict";e.exports=require("child_process")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},32694:e=>{"use strict";e.exports=require("http2")},35240:e=>{"use strict";e.exports=require("https")},98216:e=>{"use strict";e.exports=require("net")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},76162:e=>{"use strict";e.exports=require("stream")},82452:e=>{"use strict";e.exports=require("tls")},74175:e=>{"use strict";e.exports=require("tty")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},80627:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>n.Z,__next_app__:()=>p,originalPathname:()=>c,pages:()=>d,routeModule:()=>y,tree:()=>o}),r(12829),r(85429),r(58522),r(61804),r(7629),r(11930),r(12523);var s=r(23191),i=r(88716),n=r(43315),l=r(95231),a={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(a[e]=()=>l[e]);r.d(t,a);let o=["",{children:["(main)",{children:["pos",{children:["items",{children:["delivery",{children:["[...deliveryId]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,12829)),"E:\\Project\\Order-Project-Frontend\\src\\app\\(main)\\pos\\items\\delivery\\[...deliveryId]\\page.tsx"]}]},{}]},{}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,85429)),"E:\\Project\\Order-Project-Frontend\\src\\app\\(main)\\pos\\layout.tsx"]}]},{layout:[()=>Promise.resolve().then(r.bind(r,58522)),"E:\\Project\\Order-Project-Frontend\\src\\app\\(main)\\layout.tsx"]}]},{layout:[()=>Promise.resolve().then(r.bind(r,61804)),"E:\\Project\\Order-Project-Frontend\\src\\app\\layout.tsx"],error:[()=>Promise.resolve().then(r.bind(r,7629)),"E:\\Project\\Order-Project-Frontend\\src\\app\\error.tsx"],loading:[()=>Promise.resolve().then(r.bind(r,11930)),"E:\\Project\\Order-Project-Frontend\\src\\app\\loading.tsx"],"not-found":[()=>Promise.resolve().then(r.bind(r,12523)),"E:\\Project\\Order-Project-Frontend\\src\\app\\not-found.tsx"]}],d=["E:\\Project\\Order-Project-Frontend\\src\\app\\(main)\\pos\\items\\delivery\\[...deliveryId]\\page.tsx"],c="/(main)/pos/items/delivery/[...deliveryId]/page",p={require:r,loadChunk:()=>Promise.resolve()},y=new s.AppPageRouteModule({definition:{kind:i.x.APP_PAGE,page:"/(main)/pos/items/delivery/[...deliveryId]/page",pathname:"/pos/items/delivery/[...deliveryId]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},29e3:(e,t,r)=>{Promise.resolve().then(r.bind(r,73974))},12226:(e,t,r)=>{"use strict";r.d(t,{Z:()=>a});var s=r(17577);let i={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M699 353h-46.9c-10.2 0-19.9 4.9-25.9 13.3L469 584.3l-71.2-98.8c-6-8.3-15.6-13.3-25.9-13.3H325c-6.5 0-10.3 7.4-6.5 12.7l124.6 172.8a31.8 31.8 0 0051.7 0l210.6-292c3.9-5.3.1-12.7-6.4-12.7z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"check-circle",theme:"outlined"};var n=r(74082);function l(){return(l=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e}).apply(this,arguments)}let a=s.forwardRef((e,t)=>s.createElement(n.Z,l({},e,{ref:t,icon:i})))},41684:(e,t,r)=>{"use strict";r.d(t,{Z:()=>a});var s=r(17577);let i={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M464 336a48 48 0 1096 0 48 48 0 10-96 0zm72 112h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V456c0-4.4-3.6-8-8-8z"}}]},name:"info-circle",theme:"outlined"};var n=r(74082);function l(){return(l=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e}).apply(this,arguments)}let a=s.forwardRef((e,t)=>s.createElement(n.Z,l({},e,{ref:t,icon:i})))},16185:(e,t,r)=>{"use strict";r.d(t,{Z:()=>a});var s=r(17577);let i={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M864 736c0-111.6-65.4-208-160-252.9V317.3c0-15.1-5.3-29.7-15.1-41.2L536.5 95.4C530.1 87.8 521 84 512 84s-18.1 3.8-24.5 11.4L335.1 276.1a63.97 63.97 0 00-15.1 41.2v165.8C225.4 528 160 624.4 160 736h156.5c-2.3 7.2-3.5 15-3.5 23.8 0 22.1 7.6 43.7 21.4 60.8a97.2 97.2 0 0043.1 30.6c23.1 54 75.6 88.8 134.5 88.8 29.1 0 57.3-8.6 81.4-24.8 23.6-15.8 41.9-37.9 53-64a97 97 0 0043.1-30.5 97.52 97.52 0 0021.4-60.8c0-8.4-1.1-16.4-3.1-23.8H864zM762.3 621.4c9.4 14.6 17 30.3 22.5 46.6H700V558.7a211.6 211.6 0 0162.3 62.7zM388 483.1V318.8l124-147 124 147V668H388V483.1zM239.2 668c5.5-16.3 13.1-32 22.5-46.6 16.3-25.2 37.5-46.5 62.3-62.7V668h-84.8zm388.9 116.2c-5.2 3-11.2 4.2-17.1 3.4l-19.5-2.4-2.8 19.4c-5.4 37.9-38.4 66.5-76.7 66.5-38.3 0-71.3-28.6-76.7-66.5l-2.8-19.5-19.5 2.5a27.7 27.7 0 01-17.1-3.5c-8.7-5-14.1-14.3-14.1-24.4 0-10.6 5.9-19.4 14.6-23.8h231.3c8.8 4.5 14.6 13.3 14.6 23.8-.1 10.2-5.5 19.6-14.2 24.5zM464 400a48 48 0 1096 0 48 48 0 10-96 0z"}}]},name:"rocket",theme:"outlined"};var n=r(74082);function l(){return(l=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e}).apply(this,arguments)}let a=s.forwardRef((e,t)=>s.createElement(n.Z,l({},e,{ref:t,icon:i})))},73974:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>V});var s=r(10326),i=r(77626),n=r.n(i),l=r(17577),a=r(35047),o=r(58184),d=r(46752),c=r(61357),p=r(75698),y=r(71935),u=r(4139),x=r(38106),h=r(56249),m=r(71209),g=r(276),f=r(64635),j=r(74944),v=r(2643),b=r(16185),P=r(46024),Z=r(62938),w=r(12226),_=r(41684),k=r(26859),S=r(24297),O=r(83476),z=r(33357),q=r(13976),C=r(35905),B=r(83717),I=r(27851),T=r(88295),E=r.n(T);r(63699);var W=r(95963),R=r(4106),M=r(37938),F=r(80440),A=r(54354);let{Title:D,Text:G}=o.default;function V(){let e=(0,a.useRouter)(),t=(0,a.useParams)(),[r,i]=d.ZP.useMessage(),o=Array.isArray(t?.deliveryId)?t.deliveryId[0]:t?.deliveryId,[T,E]=(0,l.useState)(null),[V,H]=(0,l.useState)(!0),[N,L]=(0,l.useState)(!0),{showLoading:$,hideLoading:Q}=(0,M.x)(),{socket:Y}=(0,F.s)(),[U,X]=(0,l.useState)({open:!1,type:"confirm",title:"",content:"",onOk:()=>{}}),J=()=>X(e=>({...e,open:!1})),K=(0,l.useCallback)(async()=>{if(o)try{H(!0),$("กำลังโหลดข้อมูลออเดอร์...");let[t,s]=await Promise.all([k.x.getById(o),S.E.getByName("Delivery").catch(()=>null)]);if(t.status!==q.i.WaitingForPayment){e.push("/pos/channels");return}if(t.order_type!==q.m.Delivery){r.warning("รายการนี้ไม่ใช่ Order Delivery"),e.push("/pos/channels");return}E(t),L(!!s)}catch{r.error("ไม่สามารถโหลดข้อมูลออเดอร์ได้")}finally{H(!1),Q()}},[o,r,e,$,Q]);(0,A.D)({socket:Y,events:["orders:update","orders:delete","payments:create","payments:update"],onRefresh:()=>{o&&K()},intervalMs:15e3,enabled:!!o});let{subtotal:ee,discount:et,vat:er,total:es}=(0,I.hs)(T,Number(T?.total_amount||0)),ei=async()=>{T&&X({open:!0,type:"confirm",title:"ยืนยันการส่งมอบสินค้า",content:(0,s.jsxs)("div",{style:{textAlign:"center"},children:[(0,s.jsxs)("div",{style:{fontSize:16,marginBottom:12},children:["คุณกำลังจะส่งมอบสินค้าให้ไรเดอร์สำหรับออเดอร์ ",(0,s.jsxs)(G,{strong:!0,children:["#",T.order_no]})]}),(0,s.jsxs)(c.Z,{color:"blue",style:{fontSize:14,padding:"4px 12px"},children:[T.delivery?.delivery_name," ",T.delivery_code?`(${T.delivery_code})`:""]})]}),okText:"ยืนยันส่งมอบ",cancelText:"ยกเลิก",onOk:async()=>{try{$("กำลังดำเนินการส่งมอบ..."),J();let t=await (0,z.P)(),s=await S.E.getByName("Delivery"),i={order_id:T.id,payment_method_id:s?.id,amount:es,amount_received:es,change_amount:0,status:C.b.Success};await O.U.create(i,void 0,t),r.success("ส่งมอบสินค้าให้ไรเดอร์เรียบร้อย"),e.push(`/pos/dashboard/${T.id}`)}catch{r.error("เกิดข้อผิดพลาดในการส่งมอบ")}finally{Q()}}})},en=async()=>{T&&X({open:!0,type:"warning",title:"ย้อนกลับไปแก้ไขออเดอร์?",content:'สถานะออเดอร์จะถูกเปลี่ยนกลับเป็น "กำลังดำเนินการ" เพื่อให้คุณสามารถแก้ไขรายการอาหารได้ คุณแน่ใจหรือไม่?',okText:"ตกลง",cancelText:"ยกเลิก",onOk:async()=>{try{$("กำลังดำเนินการ..."),J();let t=await (0,z.P)(),s=T.items?.filter(e=>e.status!==q.i.Cancelled)||[];await Promise.all(s.map(e=>k.x.updateItemStatus(e.id,q.i.Served,void 0,t))),await k.x.updateStatus(T.id,q.i.Pending,t),r.success("ย้อนกลับไปแก้ไขออเดอร์เรียบร้อย"),e.push((0,W.HL)(T.id))}catch{r.error("ไม่สามารถเปลี่ยนสถานะออเดอร์ได้")}finally{Q()}}})};return V&&!T?null:T?(0,s.jsxs)("div",{style:B.ZW.container,children:[s.jsx(n(),{id:B.um.__hash,children:B.um}),i,s.jsx("div",{style:{...B.ZW.heroSection,background:"linear-gradient(135deg, #eb2f96 0%, #c41d7f 100%)"},className:"payment-hero-mobile",children:s.jsx("div",{style:B.ZW.contentWrapper,className:"payment-content-mobile",children:(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",flexWrap:"wrap",gap:16},children:[(0,s.jsxs)("div",{style:{display:"flex",alignItems:"flex-start",gap:16},children:[s.jsx(y.ZP,{type:"text",icon:s.jsx(v.Z,{style:{fontSize:20}}),style:{color:"#fff",padding:0,height:"auto",marginTop:4},onClick:()=>e.back()}),(0,s.jsxs)("div",{children:[s.jsx(D,{level:3,style:B.ZW.pageTitle,children:"สรุปออเดอร์เดลิเวอรี่"}),(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginTop:8,flexWrap:"wrap"},children:[(0,s.jsxs)(c.Z,{color:"magenta",style:{borderRadius:6,border:"none",fontWeight:600},children:[s.jsx(b.Z,{})," ",T.delivery?.delivery_name||"Delivery"," ",T.delivery_code?`#${T.delivery_code}`:""]}),s.jsx(c.Z,{color:(0,W.OY)(T.status),style:{borderRadius:6,border:"none"},children:(0,W.d7)(T.status)}),(0,s.jsxs)(G,{style:{color:"rgba(255,255,255,0.85)",fontSize:13},children:["#",T.order_no]})]})]})]}),(0,s.jsxs)("div",{style:{display:"flex",gap:8},children:[s.jsx(y.ZP,{icon:s.jsx(P.Z,{}),onClick:en,style:{background:"rgba(255,255,255,0.2)",border:"none",color:"#fff"},children:"แก้ไขออเดอร์"}),s.jsx(y.ZP,{danger:!0,onClick:()=>{T&&X({open:!0,type:"danger",title:"ยืนยันการยกเลิกออเดอร์?",content:"การดำเนินการนี้จะยกเลิกสินค้าทุกรายการ คุณแน่ใจหรือไม่?",okText:"ยืนยันการยกเลิก",cancelText:"ยกเลิก",onOk:async()=>{try{$("กำลังดำเนินการยกเลิก..."),J();let t=await (0,z.P)(),s=T.items?.filter(e=>e.status!==q.i.Cancelled)||[];await Promise.all(s.map(e=>k.x.updateItemStatus(e.id,q.i.Cancelled,void 0,t))),await k.x.updateStatus(T.id,q.i.Cancelled,t),r.success("ยกเลิกออเดอร์เรียบร้อย"),e.push((0,W.d$)(T.order_type))}catch{r.error("ไม่สามารถยกเลิกออเดอร์ได้")}finally{Q()}}})},children:"ยกเลิกออเดอร์"})]})]})})}),s.jsx("div",{style:{...B.ZW.contentWrapper,marginTop:-30,paddingBottom:40},children:(0,s.jsxs)(u.Z,{gutter:[24,24],children:[s.jsx(x.Z,{xs:24,lg:14,children:(0,s.jsxs)(h.Z,{style:B.ZW.card,children:[s.jsx(D,{level:4,style:{marginBottom:20},children:"รายการอาหาร"}),s.jsx("div",{style:{overflowY:"auto",paddingRight:8,minHeight:300,maxHeight:600},children:T.items?.filter(e=>e.status!==q.i.Cancelled).map((e,t)=>s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:16,paddingBottom:16,borderBottom:`1px solid ${B.QF.borderLight}`},children:[s.jsxs("div",{style:{display:"flex",gap:12,flex:1,minWidth:0},children:[s.jsx(m.Z,{shape:"square",size:56,src:e.product?.img_url,icon:s.jsx(Z.Z,{}),style:{backgroundColor:"#f0f2f5",flexShrink:0,borderRadius:10}}),s.jsxs("div",{style:{flex:1,minWidth:0},children:[s.jsx(G,{strong:!0,style:{display:"block",fontSize:15},ellipsis:!0,children:e.product?.display_name}),s.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",marginTop:4},children:[s.jsx(G,{type:"secondary",style:{fontSize:13},children:W.xG(e.price)}),s.jsxs(c.Z,{style:{margin:0,fontSize:11,borderRadius:4},children:["x",e.quantity]})]}),e.notes&&s.jsxs(G,{type:"secondary",style:{display:"block",fontSize:12,fontStyle:"italic",marginTop:4},children:["* ",e.notes]})]})]}),s.jsx(G,{strong:!0,style:{fontSize:15},children:W.xG(Number(e.total_price))})]},e.id||t))}),(0,s.jsxs)("div",{style:{...B.ZW.summaryBox,background:"#f8fafc",borderRadius:16,padding:20},children:[(0,s.jsxs)(u.Z,{justify:"space-between",style:{marginBottom:8},children:[s.jsx(G,{type:"secondary",children:"ยอดรวม (Subtotal)"}),s.jsx(G,{children:(0,W.xG)(ee)})]}),et>0&&(0,s.jsxs)(u.Z,{justify:"space-between",style:{marginBottom:8,color:B.QF.success},children:[s.jsx(G,{type:"success",children:"ส่วนลด (Discount)"}),(0,s.jsxs)(G,{type:"success",children:["-",(0,W.xG)(et)]})]}),er>0&&(0,s.jsxs)(u.Z,{justify:"space-between",style:{marginBottom:8},children:[s.jsx(G,{type:"secondary",children:"VAT (7%)"}),s.jsx(G,{children:(0,W.xG)(er)})]}),s.jsx(g.Z,{style:{margin:"12px 0"}}),(0,s.jsxs)(u.Z,{justify:"space-between",align:"middle",children:[s.jsx(D,{level:4,style:{margin:0},children:"ยอดรวมสุทธิ"}),s.jsx(D,{level:3,style:{color:"#eb2f96",margin:0},children:(0,W.xG)(es)})]})]})]})}),s.jsx(x.Z,{xs:24,lg:10,children:(0,s.jsxs)(h.Z,{style:{...B.ZW.card,textAlign:"center",padding:"24px 0"},children:[(0,s.jsxs)("div",{style:{marginBottom:32},children:[s.jsx("div",{style:{width:80,height:80,borderRadius:"50%",background:"#fff0f6",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 16px"},children:s.jsx(b.Z,{style:{fontSize:40,color:"#eb2f96"}})}),s.jsx(D,{level:4,children:"พร้อมสำหรับการจัดส่ง"}),s.jsx(G,{type:"secondary",children:"ตรวจสอบความถูกต้องของรายการอาหารและเครื่องดื่ม ก่อนส่งมอบให้ไรเดอร์"})]}),s.jsx(h.Z,{style:{background:"#f9fafb",borderRadius:16,border:"1px dashed #d1d5db",marginBottom:32},bodyStyle:{padding:16},children:(0,s.jsxs)(f.Z,{orientation:"vertical",style:{width:"100%"},size:12,children:[(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[s.jsx(G,{type:"secondary",children:"ผู้ให้บริการ"}),s.jsx(G,{strong:!0,children:T.delivery?.delivery_name||"-"})]}),(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[s.jsx(G,{type:"secondary",children:"รหัสออเดอร์ไรเดอร์"}),s.jsx(G,{strong:!0,children:T.delivery_code||"-"})]}),(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[s.jsx(G,{type:"secondary",children:"เลขที่ออเดอร์ POS"}),s.jsx(G,{strong:!0,children:T.order_no})]})]})}),!N&&s.jsx(j.Z,{message:"ไม่พบวิธีการชำระเงิน 'Delivery'",description:"กรุณาเพิ่มวิธีการชำระเงินชื่อ 'Delivery' ในเมนูตั้งค่า เพื่อให้สามารถส่งมอบสินค้าได้",type:"error",showIcon:!0,style:{marginBottom:16,textAlign:"left"}}),s.jsx(y.ZP,{type:"primary",size:"large",block:!0,icon:s.jsx(w.Z,{}),disabled:!N,style:{height:64,fontSize:18,borderRadius:16,background:N?"#eb2f96":void 0,borderColor:N?"#eb2f96":void 0,fontWeight:700,boxShadow:N?"0 8px 16px rgba(235, 47, 150, 0.25)":"none"},onClick:ei,children:"ส่งมอบสินค้าให้ไรเดอร์"}),(0,s.jsxs)("div",{style:{marginTop:20,display:"flex",alignItems:"center",justifyContent:"center",gap:8},children:[s.jsx(_.Z,{style:{color:"#8c8c8c"}}),s.jsx(G,{type:"secondary",style:{fontSize:13},children:"เมื่อกดแล้ว ระบบจะบันทึกยอดขายและปิดออเดอร์นี้"})]})]})})]})}),s.jsx(R.Z,{open:U.open,type:U.type,title:U.title,content:U.content,okText:U.okText,cancelText:U.cancelText,onOk:U.onOk,onCancel:J})]}):s.jsx(p.Z,{description:"ไม่พบข้อมูลออเดอร์"})}E().locale("th")},54354:(e,t,r)=>{"use strict";function s(e,t,r,s=e=>e.id,i=()=>!0){}function i({socket:e,events:t=[],onRefresh:r,intervalMs:s,enabled:i=!0,debounceMs:n}){}r.d(t,{D:()=>i,v:()=>s}),r(17577)},12829:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});let s=(0,r(68570).createProxy)(String.raw`E:\Project\Order-Project-Frontend\src\app\(main)\pos\items\delivery\[...deliveryId]\page.tsx#default`)}};var t=require("../../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[9276,8674,8571,8270,9345,9042,1399,4658,8498,8217],()=>r(80627));module.exports=s})();