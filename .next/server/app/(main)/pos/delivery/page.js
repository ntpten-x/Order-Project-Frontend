(()=>{var e={};e.id=561,e.ids=[561],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},78893:e=>{"use strict";e.exports=require("buffer")},61282:e=>{"use strict";e.exports=require("child_process")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},32694:e=>{"use strict";e.exports=require("http2")},35240:e=>{"use strict";e.exports=require("https")},98216:e=>{"use strict";e.exports=require("net")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},76162:e=>{"use strict";e.exports=require("stream")},82452:e=>{"use strict";e.exports=require("tls")},74175:e=>{"use strict";e.exports=require("tty")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},45699:(e,r,t)=>{"use strict";t.r(r),t.d(r,{GlobalError:()=>a.Z,__next_app__:()=>p,originalPathname:()=>d,pages:()=>c,routeModule:()=>u,tree:()=>o}),t(53803),t(85429),t(58522),t(61804),t(7629),t(11930),t(12523);var i=t(23191),s=t(88716),a=t(43315),n=t(95231),l={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>n[e]);t.d(r,l);let o=["",{children:["(main)",{children:["pos",{children:["delivery",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,53803)),"E:\\Project\\Order-Project-Frontend\\src\\app\\(main)\\pos\\delivery\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,85429)),"E:\\Project\\Order-Project-Frontend\\src\\app\\(main)\\pos\\layout.tsx"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,58522)),"E:\\Project\\Order-Project-Frontend\\src\\app\\(main)\\layout.tsx"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,61804)),"E:\\Project\\Order-Project-Frontend\\src\\app\\layout.tsx"],error:[()=>Promise.resolve().then(t.bind(t,7629)),"E:\\Project\\Order-Project-Frontend\\src\\app\\error.tsx"],loading:[()=>Promise.resolve().then(t.bind(t,11930)),"E:\\Project\\Order-Project-Frontend\\src\\app\\loading.tsx"],"not-found":[()=>Promise.resolve().then(t.bind(t,12523)),"E:\\Project\\Order-Project-Frontend\\src\\app\\not-found.tsx"]}],c=["E:\\Project\\Order-Project-Frontend\\src\\app\\(main)\\pos\\delivery\\page.tsx"],d="/(main)/pos/delivery/page",p={require:t,loadChunk:()=>Promise.resolve()},u=new i.AppPageRouteModule({definition:{kind:s.x.APP_PAGE,page:"/(main)/pos/delivery/page",pathname:"/pos/delivery",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},349:(e,r,t)=>{Promise.resolve().then(t.bind(t,33041))},2643:(e,r,t)=>{"use strict";t.d(r,{Z:()=>l});var i=t(17577);let s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M872 474H286.9l350.2-304c5.6-4.9 2.2-14-5.2-14h-88.5c-3.9 0-7.6 1.4-10.5 3.9L155 487.8a31.96 31.96 0 000 48.3L535.1 866c1.5 1.3 3.3 2 5.2 2h91.5c7.4 0 10.8-9.2 5.2-14L286.9 550H872c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8z"}}]},name:"arrow-left",theme:"outlined"};var a=t(74082);function n(){return(n=Object.assign?Object.assign.bind():function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e}).apply(this,arguments)}let l=i.forwardRef((e,r)=>i.createElement(a.Z,n({},e,{ref:r,icon:s})))},33041:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>L});var i=t(10326),s=t(17577),a=t(66874),n=t(71209),l=t(61357),o=t(63459),c=t(71935),d=t(75958),p=t(46752),u=t(64635),x=t(49909),y=t(92442),h=t(71696),v=t(46024),g=t(63191),f=t(62938),j=t(80490),m=t(72380),b=t(24395),P=t(35047),Z=t(37938),_=t(59746),w=t(80440),k=t(33357),C=t(7670),q=t(54354),E=t(83179),S=t(86230),O=t(26902),R=t(26963),T=t(76892),z=t(18978),A=t(52647),F=t(36231);let{Text:D}=a.default,$=e=>{let r=new Date(e);return Number.isNaN(r.getTime())?"-":new Intl.DateTimeFormat("th-TH",{dateStyle:"medium",timeStyle:"short"}).format(r)},B=({totalDelivery:e,activeDelivery:r,inactiveDelivery:t})=>(0,i.jsxs)("div",{style:{background:"#fff",borderRadius:16,border:"1px solid #e2e8f0",display:"grid",gridTemplateColumns:"repeat(3, minmax(0, 1fr))",gap:8,padding:14},children:[(0,i.jsxs)("div",{style:{textAlign:"center"},children:[i.jsx("span",{style:{fontSize:24,fontWeight:700,color:"#0f172a",display:"block"},children:e}),i.jsx(D,{style:{fontSize:12,color:"#64748b"},children:"ทั้งหมด"})]}),(0,i.jsxs)("div",{style:{textAlign:"center"},children:[i.jsx("span",{style:{fontSize:24,fontWeight:700,color:"#0891B2",display:"block"},children:r}),i.jsx(D,{style:{fontSize:12,color:"#64748b"},children:"ใช้งาน"})]}),(0,i.jsxs)("div",{style:{textAlign:"center"},children:[i.jsx("span",{style:{fontSize:24,fontWeight:700,color:"#b91c1c",display:"block"},children:t}),i.jsx(D,{style:{fontSize:12,color:"#64748b"},children:"ปิดใช้งาน"})]})]}),I=({delivery:e,onEdit:r,onDelete:t,onToggleActive:s,updatingStatusId:a})=>i.jsx("div",{className:"delivery-card",style:{...S.R.deliveryCard(e.is_active),borderRadius:16},onClick:()=>r(e),children:(0,i.jsxs)("div",{style:S.R.deliveryCardInner,children:[i.jsx(n.Z,{shape:"square",size:52,src:e.logo||void 0,icon:i.jsx(h.Z,{}),style:{borderRadius:14,background:e.is_active?"linear-gradient(135deg, #cffafe 0%, #a5f3fc 100%)":"#f1f5f9",color:e.is_active?"#0891B2":"#94a3b8",boxShadow:e.is_active?"0 4px 10px rgba(8, 145, 178, 0.18)":"none"}}),(0,i.jsxs)("div",{style:{flex:1,minWidth:0,paddingRight:8},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4},children:[i.jsx(D,{strong:!0,style:{fontSize:16,color:"#0f172a"},ellipsis:{tooltip:e.delivery_name},children:e.delivery_name}),i.jsx(l.Z,{color:e.is_active?"green":"default",children:e.is_active?"ใช้งาน":"ปิดใช้งาน"})]}),(0,i.jsxs)(D,{type:"secondary",style:{fontSize:13,display:"block",color:"#334155"},children:["Prefix: ",e.delivery_prefix||"-"]}),(0,i.jsxs)(D,{type:"secondary",style:{fontSize:12,display:"block",marginTop:2},children:["อัปเดตล่าสุด ",$(e.update_date)]})]}),(0,i.jsxs)("div",{style:{display:"flex",gap:6,alignItems:"center"},children:[i.jsx(o.Z,{size:"small",checked:e.is_active,loading:a===e.id,onClick:(r,t)=>{t?.stopPropagation(),s(e,r)}}),i.jsx(c.ZP,{type:"text",icon:i.jsx(v.Z,{}),onClick:t=>{t.stopPropagation(),r(e)},style:{borderRadius:10,color:"#0891B2",background:"#ecfeff",width:36,height:36}}),i.jsx(c.ZP,{type:"text",danger:!0,icon:i.jsx(g.Z,{}),onClick:r=>{r.stopPropagation(),t(e)},style:{borderRadius:10,background:"#fef2f2",width:36,height:36}})]})]})});function L(){let e=(0,P.useRouter)(),[r,t]=(0,s.useState)([]),[a,n]=(0,s.useState)(""),[l,o]=(0,s.useState)("all"),[v,D]=(0,s.useState)(null),{execute:$}=(0,_.J)(),{showLoading:L}=(0,Z.x)(),{socket:H}=(0,w.s)(),{isAuthorized:N,isChecking:W}=(0,C.e)({allowedRoles:["Admin","Manager"]}),G=(0,s.useCallback)(async()=>{$(async()=>{let e=await fetch("/api/pos/delivery?limit=200");if(!e.ok){let r=await e.json().catch(()=>({}));throw Error(r.error||r.message||"ไม่สามารถดึงข้อมูลช่องทางจัดส่งได้")}let r=await e.json(),i=Array.isArray(r)?r:r?.data;if(!Array.isArray(i))throw Error("รูปแบบข้อมูลไม่ถูกต้อง");t(i)},"กำลังโหลดข้อมูลช่องทางจัดส่ง...")},[$]);(0,q.v)(H,{create:E.b.delivery.create,update:E.b.delivery.update,delete:E.b.delivery.delete},t);let M=(0,s.useMemo)(()=>{let e=r;"active"===l?e=e.filter(e=>e.is_active):"inactive"===l&&(e=e.filter(e=>!e.is_active));let t=a.trim().toLowerCase();return t&&(e=e.filter(e=>e.delivery_name.toLowerCase().includes(t)||(e.delivery_prefix||"").toLowerCase().includes(t))),e},[r,a,l]),J=()=>{L("กำลังเปิดหน้าจัดการช่องทางจัดส่ง..."),e.push("/pos/delivery/manager/add")},U=r=>{L("กำลังเปิดหน้าแก้ไขช่องทางจัดส่ง..."),e.push(`/pos/delivery/manager/edit/${r.id}`)},X=e=>{d.Z.confirm({title:"ยืนยันการลบช่องทางจัดส่ง",content:`คุณต้องการลบช่องทางจัดส่ง "${e.delivery_name}" หรือไม่?`,okText:"ลบ",okType:"danger",cancelText:"ยกเลิก",centered:!0,icon:i.jsx(g.Z,{style:{color:"#EF4444"}}),onOk:async()=>{await $(async()=>{let r=await (0,k.P)();if(!(await fetch(`/api/pos/delivery/delete/${e.id}`,{method:"DELETE",headers:{"X-CSRF-Token":r}})).ok)throw Error("ไม่สามารถลบช่องทางจัดส่งได้");t(r=>r.filter(r=>r.id!==e.id)),p.ZP.success(`ลบช่องทางจัดส่ง "${e.delivery_name}" สำเร็จ`)},"กำลังลบช่องทางจัดส่ง...")}})},Y=async(e,r)=>{D(e.id);try{let i=await (0,k.P)(),s=await fetch(`/api/pos/delivery/update/${e.id}`,{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-Token":i},body:JSON.stringify({is_active:r})});if(!s.ok){let e=await s.json().catch(()=>({}));throw Error(e.error||e.message||"ไม่สามารถเปลี่ยนสถานะช่องทางจัดส่งได้")}let a=await s.json();t(r=>r.map(r=>r.id===e.id?a:r)),p.ZP.success(r?"เปิดใช้งานช่องทางจัดส่งแล้ว":"ปิดใช้งานช่องทางจัดส่งแล้ว")}catch(e){console.error(e),p.ZP.error(e instanceof Error?e.message:"ไม่สามารถเปลี่ยนสถานะช่องทางจัดส่งได้")}finally{D(null)}};if(W)return i.jsx(O.H,{message:"กำลังตรวจสอบสิทธิ์การใช้งาน..."});if(!N)return i.jsx(O.H,{message:"คุณไม่มีสิทธิ์เข้าถึงหน้านี้ กำลังพากลับ...",tone:"danger"});let K=r.filter(e=>e.is_active).length,Q=r.filter(e=>!e.is_active).length;return(0,i.jsxs)("div",{className:"delivery-page",style:S.R.container,children:[i.jsx("style",{children:S.W}),i.jsx(A.Z,{title:"ช่องทางจัดส่ง",subtitle:`ทั้งหมด ${r.length} รายการ`,icon:i.jsx(h.Z,{}),actions:(0,i.jsxs)(u.Z,{size:8,wrap:!0,children:[i.jsx(c.ZP,{icon:i.jsx(f.Z,{}),onClick:()=>e.push("/pos/orders"),children:"ไปหน้าออเดอร์"}),i.jsx(c.ZP,{icon:i.jsx(j.Z,{}),onClick:G}),i.jsx(c.ZP,{type:"primary",icon:i.jsx(m.Z,{}),onClick:J,children:"เพิ่มช่องทางจัดส่ง"})]})}),i.jsx(R.Z,{children:(0,i.jsxs)(z.Z,{children:[i.jsx(B,{totalDelivery:r.length,activeDelivery:K,inactiveDelivery:Q}),i.jsx(T.Z,{title:"ค้นหาและตัวกรอง",children:(0,i.jsxs)("div",{style:{display:"grid",gap:10,gridTemplateColumns:"1fr",alignItems:"center"},children:[i.jsx(x.default,{prefix:i.jsx(b.Z,{style:{color:"#94A3B8"}}),allowClear:!0,placeholder:"ค้นหาจากชื่อช่องทาง หรือ prefix...",value:a,onChange:e=>n(e.target.value)}),i.jsx(y.Z,{options:[{label:`ทั้งหมด (${r.length})`,value:"all"},{label:`ใช้งาน (${K})`,value:"active"},{label:`ปิดใช้งาน (${Q})`,value:"inactive"}],value:l,onChange:e=>o(e)})]})}),i.jsx(T.Z,{title:"รายการช่องทางจัดส่ง",extra:i.jsx("span",{style:{fontWeight:600},children:M.length}),children:M.length>0?M.map(e=>i.jsx(I,{delivery:e,onEdit:U,onDelete:X,onToggleActive:Y,updatingStatusId:v},e.id)):i.jsx(F.Z,{title:a.trim()?"ไม่พบช่องทางจัดส่งตามคำค้น":"ยังไม่มีช่องทางจัดส่ง",description:a.trim()?"ลองเปลี่ยนคำค้น หรือตัวกรองสถานะ":"เพิ่มช่องทางจัดส่งแรกเพื่อเริ่มใช้งาน",action:a.trim()?null:i.jsx(c.ZP,{type:"primary",icon:i.jsx(m.Z,{}),onClick:J,children:"เพิ่มช่องทางจัดส่ง"})})})]})})]})}},18978:(e,r,t)=>{"use strict";t.d(r,{Z:()=>n});var i=t(10326);t(17577);var s=t(21020),a=t(52386);function n({children:e,gap:r=a.H.sectionGap,style:t}){return i.jsx(s.Z,{vertical:!0,gap:r,style:t,children:e})}},36231:(e,r,t)=>{"use strict";t.d(r,{Z:()=>o});var i=t(10326);t(17577);var s=t(56249),a=t(75698),n=t(66874),l=t(52386);function o({title:e="ไม่มีข้อมูล",description:r,action:t,image:o}){return i.jsx(s.Z,{size:"small",variant:"outlined",style:{borderRadius:l.H.cardRadiusLG},bodyStyle:{padding:20},children:i.jsx(a.Z,{image:o,description:(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[i.jsx(n.default.Text,{strong:!0,children:e}),r?i.jsx(n.default.Text,{type:"secondary",children:r}):null]}),children:t})})}},59746:(e,r,t)=>{"use strict";t.d(r,{J:()=>n});var i=t(17577),s=t(75958),a=t(37938);let n=()=>{let{showLoading:e,hideLoading:r}=(0,a.x)();return{execute:(0,i.useCallback)(async(t,i="กำลังดำเนินการ...",a,n="เกิดข้อผิดพลาด")=>{try{return e(i,"async"),await t()}catch(r){console.error("Async action error:",r);let e=n;"string"==typeof r?e=r:r instanceof Error?e=r.message:"object"==typeof r&&null!==r&&(e=r.response?.data?.message??r.message??(()=>{try{return JSON.stringify(r)}catch{return"เกิดข้อผิดพลาดที่ไม่ทราบสาเหตุ (Unknown Error)"}})()),s.Z.error({title:"ข้อผิดพลาด",content:e});return}finally{r("async")}},[e,r])}}},80440:(e,r,t)=>{"use strict";t.d(r,{s:()=>a});var i=t(17577),s=t(19211);let a=()=>(0,i.useContext)(s.J)},86230:(e,r,t)=>{"use strict";t.d(r,{R:()=>s,W:()=>a});var i=t(44528);let s={...(0,i.yf)("linear-gradient(135deg, #06B6D4 0%, #0891B2 100%)"),deliveryCard:i.YO,deliveryCardInner:i.lv},a=(0,i.IU)(".delivery-page",".delivery-card")},54354:(e,r,t)=>{"use strict";function i(e,r,t,i=e=>e.id,s=()=>!0){}function s({socket:e,events:r=[],onRefresh:t,intervalMs:i,enabled:s=!0,debounceMs:a}){}t.d(r,{D:()=>s,v:()=>i}),t(17577)},53803:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>i});let i=(0,t(68570).createProxy)(String.raw`E:\Project\Order-Project-Frontend\src\app\(main)\pos\delivery\page.tsx#default`)}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),i=r.X(0,[9276,4421,8571,1742,8963,1399,4658,3849],()=>t(45699));module.exports=i})();