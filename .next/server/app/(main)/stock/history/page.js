(()=>{var e={};e.id=961,e.ids=[961],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},78893:e=>{"use strict";e.exports=require("buffer")},61282:e=>{"use strict";e.exports=require("child_process")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},32694:e=>{"use strict";e.exports=require("http2")},35240:e=>{"use strict";e.exports=require("https")},98216:e=>{"use strict";e.exports=require("net")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},76162:e=>{"use strict";e.exports=require("stream")},82452:e=>{"use strict";e.exports=require("tls")},74175:e=>{"use strict";e.exports=require("tty")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},74986:(e,r,t)=>{"use strict";t.r(r),t.d(r,{GlobalError:()=>o.Z,__next_app__:()=>p,originalPathname:()=>c,pages:()=>d,routeModule:()=>x,tree:()=>l}),t(54120),t(52987),t(58522),t(61804),t(7629),t(11930),t(12523);var s=t(23191),i=t(88716),o=t(43315),a=t(95231),n={};for(let e in a)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(n[e]=()=>a[e]);t.d(r,n);let l=["",{children:["(main)",{children:["stock",{children:["history",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,54120)),"E:\\Project\\Order-Project-Frontend\\src\\app\\(main)\\stock\\history\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,52987)),"E:\\Project\\Order-Project-Frontend\\src\\app\\(main)\\stock\\layout.tsx"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,58522)),"E:\\Project\\Order-Project-Frontend\\src\\app\\(main)\\layout.tsx"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,61804)),"E:\\Project\\Order-Project-Frontend\\src\\app\\layout.tsx"],error:[()=>Promise.resolve().then(t.bind(t,7629)),"E:\\Project\\Order-Project-Frontend\\src\\app\\error.tsx"],loading:[()=>Promise.resolve().then(t.bind(t,11930)),"E:\\Project\\Order-Project-Frontend\\src\\app\\loading.tsx"],"not-found":[()=>Promise.resolve().then(t.bind(t,12523)),"E:\\Project\\Order-Project-Frontend\\src\\app\\not-found.tsx"]}],d=["E:\\Project\\Order-Project-Frontend\\src\\app\\(main)\\stock\\history\\page.tsx"],c="/(main)/stock/history/page",p={require:t,loadChunk:()=>Promise.resolve()},x=new s.AppPageRouteModule({definition:{kind:i.x.APP_PAGE,page:"/(main)/stock/history/page",pathname:"/stock/history",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:l}})},13474:(e,r,t)=>{Promise.resolve().then(t.bind(t,97800))},97800:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>F});var s=t(10326),i=t(17577),o=t(46752),a=t(75958),n=t(71935),l=t(92121),d=t(43778),c=t(4779),p=t(24949),x=t(25151),u=t(80440),h=t(94001);t(81456);var f=t(26963),g=t(52647),y=t(76892),m=t(36231),j=t(58184),b=t(61357),v=t(71209),C=t(56811),P=t(54695),k=t(29116),E=t(63191),w=t(20331),Z=t(63348),q=t(9297);let{Text:S,Title:_}=j.default,I={container:{paddingBottom:100,backgroundColor:"#f8f9fc",minHeight:"100vh"},statsCard:{margin:"-40px 16px 0 16px",padding:"16px",background:"white",borderRadius:20,boxShadow:"0 8px 24px rgba(0,0,0,0.08)",display:"flex",justifyContent:"space-around",position:"relative",zIndex:10},statItem:{textAlign:"center",flex:1},statNumber:{fontSize:24,fontWeight:700,display:"block"},statLabel:{fontSize:12,color:"#8c8c8c",marginTop:2},listContainer:{padding:"20px 16px 0 16px"},orderCard:e=>({marginBottom:12,borderRadius:20,border:"none",boxShadow:"0 2px 8px rgba(0,0,0,0.04)",overflow:"hidden",transition:"all 0.3s ease",background:e===p.i.COMPLETED?"linear-gradient(to right, #f6ffed, white)":"linear-gradient(to right, #fff2f0, white)"}),orderCardInner:{padding:16,display:"flex",flexDirection:"column",gap:12},orderHeader:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},orderInfo:{display:"flex",alignItems:"center",gap:10},orderActions:{display:"flex",gap:8}},D={[p.i.PENDING]:{color:"#faad14",bgColor:"linear-gradient(135deg, #fffbe6 0%, #fff1b8 100%)",borderColor:"#ffe58f",icon:s.jsx(s.Fragment,{}),label:"รอดำเนินการ",tagColor:"gold"},[p.i.COMPLETED]:{color:"#52c41a",bgColor:"linear-gradient(135deg, #f6ffed 0%, #d9f7be 100%)",borderColor:"#b7eb8f",icon:s.jsx(C.Z,{style:{color:"#52c41a"}}),label:"เสร็จสิ้น",tagColor:"success"},[p.i.CANCELLED]:{color:"#ff4d4f",bgColor:"linear-gradient(135deg, #fff2f0 0%, #ffccc7 100%)",borderColor:"#ffa39e",icon:s.jsx(P.Z,{style:{color:"#ff4d4f"}}),label:"ยกเลิก",tagColor:"error"}},z=()=>s.jsx("style",{children:`
        .history-page-modal .ant-modal-content {
            border-radius: 24px !important;
            overflow: hidden;
            padding: 0 !important;
        }
        
        @keyframes fadeSlideIn {
            from {
                opacity: 0;
                transform: translateY(12px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .history-order-card {
            animation: fadeSlideIn 0.4s ease both;
        }
        
        .history-order-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.1) !important;
        }
        
        .history-order-card:active {
            transform: scale(0.98);
        }
        
        /* Custom scrollbar */
        .history-page *::-webkit-scrollbar {
            width: 6px;
        }
        .history-page *::-webkit-scrollbar-track {
            background: transparent;
        }
        .history-page *::-webkit-scrollbar-thumb {
            background: #d9d9d9;
            border-radius: 3px;
        }
        .history-page *::-webkit-scrollbar-thumb:hover {
            background: #bfbfbf;
        }
    `}),O=({totalOrders:e,completedOrders:r,cancelledOrders:t})=>(0,s.jsxs)("div",{style:I.statsCard,children:[(0,s.jsxs)("div",{style:I.statItem,children:[s.jsx("span",{style:{...I.statNumber,color:"#667eea"},children:e}),s.jsx(S,{style:I.statLabel,children:"ทั้งหมด"})]}),s.jsx("div",{style:{width:1,background:"#f0f0f0"}}),(0,s.jsxs)("div",{style:I.statItem,children:[s.jsx("span",{style:{...I.statNumber,color:"#52c41a"},children:r}),s.jsx(S,{style:I.statLabel,children:"เสร็จสิ้น"})]}),s.jsx("div",{style:{width:1,background:"#f0f0f0"}}),(0,s.jsxs)("div",{style:I.statItem,children:[s.jsx("span",{style:{...I.statNumber,color:"#ff4d4f"},children:t}),s.jsx(S,{style:I.statLabel,children:"ยกเลิก"})]})]}),T=({order:e,index:r,onView:t,onDelete:i,isAdmin:o})=>{let a=D[e.status]||D[p.i.PENDING],l=e.ordersItems?.length||0,d=e.ordersItems?.filter(e=>e.ordersDetail?.is_purchased).length||0,c=e.ordersItems?.slice(0,3)||[],x=l-3;return s.jsx("div",{className:"history-order-card",style:{...I.orderCard(e.status),animationDelay:`${.05*r}s`},children:(0,s.jsxs)("div",{style:I.orderCardInner,children:[(0,s.jsxs)("div",{style:I.orderHeader,children:[(0,s.jsxs)("div",{style:I.orderInfo,children:[s.jsx("div",{style:{width:44,height:44,borderRadius:12,background:a.bgColor,border:`1px solid ${a.borderColor}`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:20},children:a.icon}),(0,s.jsxs)("div",{children:[(0,s.jsxs)(S,{strong:!0,style:{fontSize:15,color:"#1a1a2e",display:"block"},children:["#",e.id.substring(0,8).toUpperCase()]}),s.jsx(b.Z,{color:a.tagColor,style:{marginTop:4,borderRadius:10,fontWeight:600},children:a.label})]})]}),(0,s.jsxs)("div",{style:I.orderActions,children:[s.jsx(n.ZP,{type:"primary",size:"small",icon:s.jsx(k.Z,{}),onClick:()=>t(e),style:{borderRadius:10,background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",border:"none"},children:"ดู"}),o&&s.jsx(n.ZP,{danger:!0,size:"small",icon:s.jsx(E.Z,{}),onClick:()=>i(e),style:{borderRadius:10},children:"ลบ"})]})]}),(0,s.jsxs)("div",{style:{display:"flex",gap:16,padding:"12px 0",borderTop:"1px solid #f0f0f0",borderBottom:"1px solid #f0f0f0"},children:[(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:6},children:[s.jsx(w.Z,{style:{color:"#8c8c8c"}}),s.jsx(S,{type:"secondary",style:{fontSize:13},children:e.ordered_by?.name||e.ordered_by?.username||"Unknown"})]}),(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:6},children:[s.jsx(Z.Z,{style:{color:"#8c8c8c"}}),s.jsx(S,{type:"secondary",style:{fontSize:13},children:new Date(e.create_date).toLocaleDateString("th-TH",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:6,marginBottom:10},children:[s.jsx(q.Z,{style:{color:"#667eea",fontSize:14}}),s.jsx(S,{style:{fontSize:13,color:"#666"},children:e.status===p.i.COMPLETED?`ซื้อแล้ว ${d}/${l} รายการ`:`${l} รายการ`})]}),(0,s.jsxs)("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[c.map(e=>(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,padding:"6px 10px",background:"#f5f5f5",borderRadius:10},children:[s.jsx(v.Z,{src:e.ingredient?.img_url||"https://placehold.co/32x32/f5f5f5/999999?text=\uD83D\uDCE6",size:28,shape:"square",style:{borderRadius:6}}),(0,s.jsxs)("div",{children:[s.jsx(S,{style:{fontSize:12,display:"block"},ellipsis:{tooltip:e.ingredient?.display_name},children:e.ingredient?.display_name}),(0,s.jsxs)(S,{type:"secondary",style:{fontSize:11},children:[e.ordersDetail?.is_purchased?e.ordersDetail.actual_quantity:e.quantity_ordered," ",e.ingredient?.unit?.display_name]})]})]},e.id)),x>0&&(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"6px 12px",background:"#e6f4ff",borderRadius:10,color:"#1890ff",fontWeight:600,fontSize:12},children:["+",x," อื่นๆ"]})]})]})]})})};function F(){let[e,r]=(0,i.useState)([]),[t,j]=(0,i.useState)(!0),[b,v]=(0,i.useState)(null),{socket:C}=(0,u.s)(),{user:P}=(0,h.a)(),[k,E]=(0,i.useState)(1),[w,Z]=(0,i.useState)(10),[q,S]=(0,i.useState)(0),[_,D]=(0,i.useState)(""),F=async(e=1,t=10)=>{try{j(!0);let s=await fetch(`/api/stock/orders?status=completed,cancelled&page=${e}&limit=${t}`,{cache:"no-store"});if(!s.ok)throw Error("Failed to fetch orders");let i=await s.json();Array.isArray(i)?(r(i),S(i.length)):(r(i.data),S(i.total))}catch{console.error("Failed to fetch orders"),o.ZP.error("ไม่สามารถโหลดประวัติออเดอร์ได้")}finally{j(!1)}},L=e=>{a.Z.confirm({title:"ยืนยันการลบ",content:`คุณต้องการลบประวัติออเดอร์ #${e.id.substring(0,8).toUpperCase()} หรือไม่? ข้อมูลที่เกี่ยวข้องทั้งหมดจะถูกลบด้วย`,okText:"ลบ",okType:"danger",cancelText:"ยกเลิก",centered:!0,onOk:async()=>{try{if(!(await fetch(`/api/stock/orders/${e.id}`,{method:"DELETE",headers:{"X-CSRF-Token":_}})).ok)throw Error("Failed to delete order");o.ZP.success("ลบประวัติออเดอร์สำเร็จ"),F(k,w)}catch{o.ZP.error("ลบประวัติออเดอร์ล้มเหลว")}}})},A=e.filter(e=>e.status===p.i.COMPLETED),N=e.filter(e=>e.status===p.i.CANCELLED),R=P?.role==="Admin";return t&&0===e.length?(0,s.jsxs)("div",{style:{minHeight:"100vh",background:I.container.backgroundColor},children:[s.jsx(z,{}),s.jsx(g.Z,{title:"ประวัติออเดอร์สต็อก",subtitle:"รายการที่เสร็จสิ้น/ยกเลิก",icon:s.jsx(c.Z,{}),actions:s.jsx(n.ZP,{onClick:()=>F(k,w),loading:t,children:"รีเฟรช"})}),s.jsx(f.Z,{children:s.jsx(y.Z,{children:s.jsx("div",{style:{display:"flex",justifyContent:"center",padding:"60px 0"},children:s.jsx(l.Z,{size:"large"})})})})]}):(0,s.jsxs)("div",{className:"history-page",style:I.container,children:[s.jsx(z,{}),s.jsx(g.Z,{title:"ประวัติออเดอร์สต็อก",subtitle:"รายการที่เสร็จสิ้น/ยกเลิก",icon:s.jsx(c.Z,{}),actions:s.jsx(n.ZP,{onClick:()=>F(k,w),loading:t,children:"รีเฟรช"})}),(0,s.jsxs)(f.Z,{children:[s.jsx(y.Z,{children:s.jsx(O,{totalOrders:q,completedOrders:A.length,cancelledOrders:N.length})}),s.jsx(y.Z,{title:"ประวัติทั้งหมด",extra:(0,s.jsxs)("span",{style:{fontWeight:600},children:[q," รายการ"]}),children:s.jsx("div",{style:I.listContainer,children:e.length>0?(0,s.jsxs)(s.Fragment,{children:[e.map((e,r)=>s.jsx(T,{order:e,index:r,onView:v,onDelete:L,isAdmin:R},e.id)),s.jsx("div",{style:{display:"flex",justifyContent:"center",marginTop:24},children:s.jsx(d.Z,{current:k,pageSize:w,total:q,onChange:(e,r)=>{E(e),Z(r)},showSizeChanger:!0,showTotal:e=>`ทั้งหมด ${e} รายการ`})})]}):s.jsx(m.Z,{title:"ยังไม่มีประวัติออเดอร์",description:"เมื่อมีรายการเสร็จสิ้น/ยกเลิก จะแสดงที่หน้านี้"})})}),s.jsx(x.Z,{open:!!b,order:b,onClose:()=>v(null)})]})]})}},54120:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>s});let s=(0,t(68570).createProxy)(String.raw`E:\Project\Order-Project-Frontend\src\app\(main)\stock\history\page.tsx#default`)}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[9276,8491,8571,8963,1399,1323,5595],()=>t(74986));module.exports=s})();