(()=>{var e={};e.id=961,e.ids=[961],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},78893:e=>{"use strict";e.exports=require("buffer")},61282:e=>{"use strict";e.exports=require("child_process")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},32694:e=>{"use strict";e.exports=require("http2")},35240:e=>{"use strict";e.exports=require("https")},98216:e=>{"use strict";e.exports=require("net")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},76162:e=>{"use strict";e.exports=require("stream")},82452:e=>{"use strict";e.exports=require("tls")},74175:e=>{"use strict";e.exports=require("tty")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},74986:(e,r,t)=>{"use strict";t.r(r),t.d(r,{GlobalError:()=>o.Z,__next_app__:()=>p,originalPathname:()=>c,pages:()=>l,routeModule:()=>x,tree:()=>d}),t(54120),t(94239),t(58522),t(61804),t(7629),t(11930),t(12523);var s=t(23191),i=t(88716),o=t(43315),a=t(95231),n={};for(let e in a)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(n[e]=()=>a[e]);t.d(r,n);let d=["",{children:["(main)",{children:["stock",{children:["history",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,54120)),"E:\\Project\\Order-Project-Frontend\\src\\app\\(main)\\stock\\history\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,94239)),"E:\\Project\\Order-Project-Frontend\\src\\app\\(main)\\stock\\layout.tsx"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,58522)),"E:\\Project\\Order-Project-Frontend\\src\\app\\(main)\\layout.tsx"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,61804)),"E:\\Project\\Order-Project-Frontend\\src\\app\\layout.tsx"],error:[()=>Promise.resolve().then(t.bind(t,7629)),"E:\\Project\\Order-Project-Frontend\\src\\app\\error.tsx"],loading:[()=>Promise.resolve().then(t.bind(t,11930)),"E:\\Project\\Order-Project-Frontend\\src\\app\\loading.tsx"],"not-found":[()=>Promise.resolve().then(t.bind(t,12523)),"E:\\Project\\Order-Project-Frontend\\src\\app\\not-found.tsx"]}],l=["E:\\Project\\Order-Project-Frontend\\src\\app\\(main)\\stock\\history\\page.tsx"],c="/(main)/stock/history/page",p={require:t,loadChunk:()=>Promise.resolve()},x=new s.AppPageRouteModule({definition:{kind:i.x.APP_PAGE,page:"/(main)/stock/history/page",pathname:"/stock/history",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},13474:(e,r,t)=>{Promise.resolve().then(t.bind(t,97800))},97800:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>T});var s=t(10326),i=t(17577),o=t(46752),a=t(75958),n=t(92121),d=t(43778),l=t(4779),c=t(24949),p=t(25151),x=t(80440),h=t(94001);t(81456);var u=t(58184),g=t(71935),f=t(61357),y=t(71209),b=t(75698),m=t(56811),j=t(54695),v=t(29116),C=t(63191),k=t(20331),P=t(63348),w=t(9297);let{Text:E,Title:S}=u.default,I={container:{paddingBottom:100,backgroundColor:"#f8f9fc",minHeight:"100vh"},header:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",padding:"20px 20px 60px 20px",position:"relative",overflow:"hidden"},headerDecoCircle1:{position:"absolute",top:-50,right:-50,width:150,height:150,borderRadius:"50%",background:"rgba(255,255,255,0.1)"},headerDecoCircle2:{position:"absolute",bottom:-30,left:-30,width:100,height:100,borderRadius:"50%",background:"rgba(255,255,255,0.08)"},headerContent:{position:"relative",zIndex:1,display:"flex",alignItems:"center",justifyContent:"space-between"},headerLeft:{display:"flex",alignItems:"center",gap:12},headerIconBox:{width:48,height:48,borderRadius:14,background:"rgba(255,255,255,0.2)",display:"flex",alignItems:"center",justifyContent:"center",backdropFilter:"blur(8px)"},statsCard:{margin:"-40px 16px 0 16px",padding:"16px",background:"white",borderRadius:20,boxShadow:"0 8px 24px rgba(0,0,0,0.08)",display:"flex",justifyContent:"space-around",position:"relative",zIndex:10},statItem:{textAlign:"center",flex:1},statNumber:{fontSize:24,fontWeight:700,display:"block"},statLabel:{fontSize:12,color:"#8c8c8c",marginTop:2},listContainer:{padding:"20px 16px 0 16px"},sectionTitle:{display:"flex",alignItems:"center",gap:8,marginBottom:16},orderCard:e=>({marginBottom:12,borderRadius:20,border:"none",boxShadow:"0 2px 8px rgba(0,0,0,0.04)",overflow:"hidden",transition:"all 0.3s ease",background:e===c.i.COMPLETED?"linear-gradient(to right, #f6ffed, white)":"linear-gradient(to right, #fff2f0, white)"}),orderCardInner:{padding:16,display:"flex",flexDirection:"column",gap:12},orderHeader:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},orderInfo:{display:"flex",alignItems:"center",gap:10},orderActions:{display:"flex",gap:8}},q={[c.i.PENDING]:{color:"#faad14",bgColor:"linear-gradient(135deg, #fffbe6 0%, #fff1b8 100%)",borderColor:"#ffe58f",icon:s.jsx(s.Fragment,{}),label:"รอดำเนินการ",tagColor:"gold"},[c.i.COMPLETED]:{color:"#52c41a",bgColor:"linear-gradient(135deg, #f6ffed 0%, #d9f7be 100%)",borderColor:"#b7eb8f",icon:s.jsx(m.Z,{style:{color:"#52c41a"}}),label:"เสร็จสิ้น",tagColor:"success"},[c.i.CANCELLED]:{color:"#ff4d4f",bgColor:"linear-gradient(135deg, #fff2f0 0%, #ffccc7 100%)",borderColor:"#ffa39e",icon:s.jsx(j.Z,{style:{color:"#ff4d4f"}}),label:"ยกเลิก",tagColor:"error"}},_=()=>s.jsx("style",{children:`
        .history-page-modal .ant-modal-content {
            border-radius: 24px !important;
            overflow: hidden;
            padding: 0 !important;
        }
        
        @keyframes fadeSlideIn {
            from {
                opacity: 0;
                transform: translateY(12px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .history-order-card {
            animation: fadeSlideIn 0.4s ease both;
        }
        
        .history-order-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.1) !important;
        }
        
        .history-order-card:active {
            transform: scale(0.98);
        }
        
        /* Custom scrollbar */
        .history-page *::-webkit-scrollbar {
            width: 6px;
        }
        .history-page *::-webkit-scrollbar-track {
            background: transparent;
        }
        .history-page *::-webkit-scrollbar-thumb {
            background: #d9d9d9;
            border-radius: 3px;
        }
        .history-page *::-webkit-scrollbar-thumb:hover {
            background: #bfbfbf;
        }
    `}),z=({onRefresh:e,loading:r})=>(0,s.jsxs)("div",{style:I.header,children:[s.jsx("div",{style:I.headerDecoCircle1}),s.jsx("div",{style:I.headerDecoCircle2}),(0,s.jsxs)("div",{style:I.headerContent,children:[(0,s.jsxs)("div",{style:I.headerLeft,children:[s.jsx("div",{style:I.headerIconBox,children:s.jsx(l.Z,{style:{fontSize:24,color:"white"}})}),(0,s.jsxs)("div",{children:[s.jsx(E,{style:{color:"rgba(255,255,255,0.85)",fontSize:13,display:"block"},children:"ประวัติทั้งหมด"}),s.jsx(S,{level:4,style:{color:"white",margin:0,fontWeight:700,letterSpacing:"0.5px"},children:"รายการสั่งซื้อ"})]})]}),s.jsx(g.ZP,{type:"text",icon:s.jsx(l.Z,{style:{color:"white"}}),onClick:e,loading:r,style:{background:"rgba(255,255,255,0.2)",borderRadius:12,height:40,color:"white",fontWeight:600},children:"รีเฟรช"})]})]}),D=({totalOrders:e,completedOrders:r,cancelledOrders:t})=>(0,s.jsxs)("div",{style:I.statsCard,children:[(0,s.jsxs)("div",{style:I.statItem,children:[s.jsx("span",{style:{...I.statNumber,color:"#667eea"},children:e}),s.jsx(E,{style:I.statLabel,children:"ทั้งหมด"})]}),s.jsx("div",{style:{width:1,background:"#f0f0f0"}}),(0,s.jsxs)("div",{style:I.statItem,children:[s.jsx("span",{style:{...I.statNumber,color:"#52c41a"},children:r}),s.jsx(E,{style:I.statLabel,children:"เสร็จสิ้น"})]}),s.jsx("div",{style:{width:1,background:"#f0f0f0"}}),(0,s.jsxs)("div",{style:I.statItem,children:[s.jsx("span",{style:{...I.statNumber,color:"#ff4d4f"},children:t}),s.jsx(E,{style:I.statLabel,children:"ยกเลิก"})]})]}),Z=({order:e,index:r,onView:t,onDelete:i,isAdmin:o})=>{let a=q[e.status]||q[c.i.PENDING],n=e.ordersItems?.length||0,d=e.ordersItems?.filter(e=>e.ordersDetail?.is_purchased).length||0,l=e.ordersItems?.slice(0,3)||[],p=n-3;return s.jsx("div",{className:"history-order-card",style:{...I.orderCard(e.status),animationDelay:`${.05*r}s`},children:(0,s.jsxs)("div",{style:I.orderCardInner,children:[(0,s.jsxs)("div",{style:I.orderHeader,children:[(0,s.jsxs)("div",{style:I.orderInfo,children:[s.jsx("div",{style:{width:44,height:44,borderRadius:12,background:a.bgColor,border:`1px solid ${a.borderColor}`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:20},children:a.icon}),(0,s.jsxs)("div",{children:[(0,s.jsxs)(E,{strong:!0,style:{fontSize:15,color:"#1a1a2e",display:"block"},children:["#",e.id.substring(0,8).toUpperCase()]}),s.jsx(f.Z,{color:a.tagColor,style:{marginTop:4,borderRadius:10,fontWeight:600},children:a.label})]})]}),(0,s.jsxs)("div",{style:I.orderActions,children:[s.jsx(g.ZP,{type:"primary",size:"small",icon:s.jsx(v.Z,{}),onClick:()=>t(e),style:{borderRadius:10,background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",border:"none"},children:"ดู"}),o&&s.jsx(g.ZP,{danger:!0,size:"small",icon:s.jsx(C.Z,{}),onClick:()=>i(e),style:{borderRadius:10},children:"ลบ"})]})]}),(0,s.jsxs)("div",{style:{display:"flex",gap:16,padding:"12px 0",borderTop:"1px solid #f0f0f0",borderBottom:"1px solid #f0f0f0"},children:[(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:6},children:[s.jsx(k.Z,{style:{color:"#8c8c8c"}}),s.jsx(E,{type:"secondary",style:{fontSize:13},children:e.ordered_by?.username||"Unknown"})]}),(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:6},children:[s.jsx(P.Z,{style:{color:"#8c8c8c"}}),s.jsx(E,{type:"secondary",style:{fontSize:13},children:new Date(e.create_date).toLocaleDateString("th-TH",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:6,marginBottom:10},children:[s.jsx(w.Z,{style:{color:"#667eea",fontSize:14}}),s.jsx(E,{style:{fontSize:13,color:"#666"},children:e.status===c.i.COMPLETED?`ซื้อแล้ว ${d}/${n} รายการ`:`${n} รายการ`})]}),(0,s.jsxs)("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[l.map(e=>(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,padding:"6px 10px",background:"#f5f5f5",borderRadius:10},children:[s.jsx(y.Z,{src:e.ingredient?.img_url||"https://placehold.co/32x32/f5f5f5/999999?text=\uD83D\uDCE6",size:28,shape:"square",style:{borderRadius:6}}),(0,s.jsxs)("div",{children:[s.jsx(E,{style:{fontSize:12,display:"block"},ellipsis:{tooltip:e.ingredient?.display_name},children:e.ingredient?.display_name}),(0,s.jsxs)(E,{type:"secondary",style:{fontSize:11},children:[e.ordersDetail?.is_purchased?e.ordersDetail.actual_quantity:e.quantity_ordered," ",e.ingredient?.unit?.display_name]})]})]},e.id)),p>0&&(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"6px 12px",background:"#e6f4ff",borderRadius:10,color:"#1890ff",fontWeight:600,fontSize:12},children:["+",p," อื่นๆ"]})]})]})]})})},R=()=>s.jsx(b.Z,{image:b.Z.PRESENTED_IMAGE_SIMPLE,description:(0,s.jsxs)("div",{style:{textAlign:"center"},children:[s.jsx(E,{type:"secondary",style:{fontSize:15},children:"ยังไม่มีประวัติการสั่งซื้อ"}),s.jsx("br",{}),s.jsx(E,{type:"secondary",style:{fontSize:13},children:"เมื่อมีการสั่งซื้อเสร็จสิ้นหรือยกเลิก จะแสดงที่นี่"})]}),style:{padding:"60px 20px",background:"white",borderRadius:20,margin:"0 16px"}});function T(){let[e,r]=(0,i.useState)([]),[t,u]=(0,i.useState)(!0),[g,f]=(0,i.useState)(null),{socket:y}=(0,x.s)(),{user:b}=(0,h.a)(),[m,j]=(0,i.useState)(1),[v,C]=(0,i.useState)(10),[k,P]=(0,i.useState)(0),[w,E]=(0,i.useState)(""),S=async(e=1,t=10)=>{try{u(!0);let s=await fetch(`/api/stock/orders?status=completed,cancelled&page=${e}&limit=${t}`,{cache:"no-store"});if(!s.ok)throw Error("Failed to fetch orders");let i=await s.json();Array.isArray(i)?(r(i),P(i.length)):(r(i.data),P(i.total))}catch{console.error("Failed to fetch orders"),o.ZP.error("ไม่สามารถโหลดประวัติออเดอร์ได้")}finally{u(!1)}},q=e=>{a.Z.confirm({title:"ยืนยันการลบ",content:`คุณต้องการลบประวัติออเดอร์ #${e.id.substring(0,8).toUpperCase()} หรือไม่? ข้อมูลที่เกี่ยวข้องทั้งหมดจะถูกลบด้วย`,okText:"ลบ",okType:"danger",cancelText:"ยกเลิก",centered:!0,onOk:async()=>{try{if(!(await fetch(`/api/stock/orders/${e.id}`,{method:"DELETE",headers:{"X-CSRF-Token":w}})).ok)throw Error("Failed to delete order");o.ZP.success("ลบประวัติออเดอร์สำเร็จ"),S(m,v)}catch{o.ZP.error("ลบประวัติออเดอร์ล้มเหลว")}}})},T=e.filter(e=>e.status===c.i.COMPLETED),O=e.filter(e=>e.status===c.i.CANCELLED),L=b?.role==="Admin";return t&&0===e.length?s.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",minHeight:"100vh",flexDirection:"column",gap:16},children:s.jsx(n.Z,{size:"large"})}):(0,s.jsxs)("div",{className:"history-page",style:I.container,children:[s.jsx(_,{}),s.jsx(z,{onRefresh:()=>S(m,v),loading:t}),s.jsx(D,{totalOrders:k,completedOrders:T.length,cancelledOrders:O.length}),s.jsx("div",{style:I.listContainer,children:e.length>0?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{style:I.sectionTitle,children:[s.jsx(l.Z,{style:{fontSize:18,color:"#667eea"}}),s.jsx("span",{style:{fontSize:16,fontWeight:600,color:"#1a1a2e"},children:"ประวัติทั้งหมด"}),(0,s.jsxs)("div",{style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",padding:"4px 12px",borderRadius:20,fontSize:12,fontWeight:600},children:[k," รายการ"]})]}),e.map((e,r)=>s.jsx(Z,{order:e,index:r,onView:f,onDelete:q,isAdmin:L},e.id)),s.jsx("div",{style:{display:"flex",justifyContent:"center",marginTop:24},children:s.jsx(d.Z,{current:m,pageSize:v,total:k,onChange:(e,r)=>{j(e),C(r)},showSizeChanger:!0,showTotal:e=>`ทั้งหมด ${e} รายการ`})})]}):s.jsx(R,{})}),s.jsx(p.Z,{open:!!g,order:g,onClose:()=>f(null)})]})}},54120:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>s});let s=(0,t(68570).createProxy)(String.raw`E:\Project\Order-Project-Frontend\src\app\(main)\stock\history\page.tsx#default`)}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[9276,8674,8571,9042,1399,2414,5151],()=>t(74986));module.exports=s})();