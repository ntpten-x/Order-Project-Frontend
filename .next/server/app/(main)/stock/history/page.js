(()=>{var e={};e.id=961,e.ids=[961],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},78893:e=>{"use strict";e.exports=require("buffer")},61282:e=>{"use strict";e.exports=require("child_process")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},32694:e=>{"use strict";e.exports=require("http2")},35240:e=>{"use strict";e.exports=require("https")},98216:e=>{"use strict";e.exports=require("net")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},76162:e=>{"use strict";e.exports=require("stream")},82452:e=>{"use strict";e.exports=require("tls")},74175:e=>{"use strict";e.exports=require("tty")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},74986:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>o.Z,__next_app__:()=>u,originalPathname:()=>c,pages:()=>d,routeModule:()=>p,tree:()=>l}),r(54120),r(52987),r(58522),r(61804),r(7629),r(11930),r(12523);var s=r(23191),i=r(88716),o=r(43315),n=r(95231),a={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(a[e]=()=>n[e]);r.d(t,a);let l=["",{children:["(main)",{children:["stock",{children:["history",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,54120)),"E:\\Project\\Order-Project-Frontend\\src\\app\\(main)\\stock\\history\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,52987)),"E:\\Project\\Order-Project-Frontend\\src\\app\\(main)\\stock\\layout.tsx"]}]},{layout:[()=>Promise.resolve().then(r.bind(r,58522)),"E:\\Project\\Order-Project-Frontend\\src\\app\\(main)\\layout.tsx"]}]},{layout:[()=>Promise.resolve().then(r.bind(r,61804)),"E:\\Project\\Order-Project-Frontend\\src\\app\\layout.tsx"],error:[()=>Promise.resolve().then(r.bind(r,7629)),"E:\\Project\\Order-Project-Frontend\\src\\app\\error.tsx"],loading:[()=>Promise.resolve().then(r.bind(r,11930)),"E:\\Project\\Order-Project-Frontend\\src\\app\\loading.tsx"],"not-found":[()=>Promise.resolve().then(r.bind(r,12523)),"E:\\Project\\Order-Project-Frontend\\src\\app\\not-found.tsx"]}],d=["E:\\Project\\Order-Project-Frontend\\src\\app\\(main)\\stock\\history\\page.tsx"],c="/(main)/stock/history/page",u={require:r,loadChunk:()=>Promise.resolve()},p=new s.AppPageRouteModule({definition:{kind:i.x.APP_PAGE,page:"/(main)/stock/history/page",pathname:"/stock/history",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:l}})},13474:(e,t,r)=>{Promise.resolve().then(r.bind(r,97800))},97800:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>F});var s=r(10326),i=r(17577),o=r(46752),n=r(75958),a=r(71935),l=r(92121),d=r(43778),c=r(44976),u=r(20108),p=r(10119),h=r(4779),y=r(24949),x=r(25151),f=r(80440),g=r(94001),m=r(81456),b=r(26963),j=r(52647),k=r(76892),v=r(36231),C=r(60578);r(83179);var P=r(66874),E=r(61357),O=r(71209),w=r(56811),q=r(54695),Z=r(29116),S=r(63191),H=r(20331),_=r(63348),I=r(9297);let{Text:R,Title:T}=P.default,D={container:{paddingBottom:100,backgroundColor:"#f8f9fc",minHeight:"100vh"},statsCard:{margin:"-40px 16px 0 16px",padding:"16px",background:"white",borderRadius:20,boxShadow:"0 8px 24px rgba(0,0,0,0.08)",display:"flex",justifyContent:"space-around",position:"relative",zIndex:10},statItem:{textAlign:"center",flex:1},statNumber:{fontSize:24,fontWeight:700,display:"block"},statLabel:{fontSize:12,color:"#8c8c8c",marginTop:2},listContainer:{padding:"20px 16px 0 16px"},orderCard:e=>({marginBottom:12,borderRadius:20,border:"none",boxShadow:"0 2px 8px rgba(0,0,0,0.04)",overflow:"hidden",transition:"all 0.3s ease",background:e===y.i.COMPLETED?"linear-gradient(to right, #f6ffed, white)":"linear-gradient(to right, #fff2f0, white)"}),orderCardInner:{padding:16,display:"flex",flexDirection:"column",gap:12},orderHeader:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},orderInfo:{display:"flex",alignItems:"center",gap:10},orderActions:{display:"flex",gap:8}},M={[y.i.PENDING]:{color:"#faad14",bgColor:"linear-gradient(135deg, #fffbe6 0%, #fff1b8 100%)",borderColor:"#ffe58f",icon:s.jsx(s.Fragment,{}),label:"รอดำเนินการ",tagColor:"gold"},[y.i.COMPLETED]:{color:"#52c41a",bgColor:"linear-gradient(135deg, #f6ffed 0%, #d9f7be 100%)",borderColor:"#b7eb8f",icon:s.jsx(w.Z,{style:{color:"#52c41a"}}),label:"เสร็จสิ้น",tagColor:"success"},[y.i.CANCELLED]:{color:"#ff4d4f",bgColor:"linear-gradient(135deg, #fff2f0 0%, #ffccc7 100%)",borderColor:"#ffa39e",icon:s.jsx(q.Z,{style:{color:"#ff4d4f"}}),label:"ยกเลิก",tagColor:"error"}},z=()=>s.jsx("style",{children:`
        .history-page-modal .ant-modal-content {
            border-radius: 24px !important;
            overflow: hidden;
            padding: 0 !important;
        }
        
        @keyframes fadeSlideIn {
            from {
                opacity: 0;
                transform: translateY(12px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .history-order-card {
            animation: fadeSlideIn 0.4s ease both;
        }
        
        .history-order-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.1) !important;
        }
        
        .history-order-card:active {
            transform: scale(0.98);
        }
        
        /* Custom scrollbar */
        .history-page *::-webkit-scrollbar {
            width: 6px;
        }
        .history-page *::-webkit-scrollbar-track {
            background: transparent;
        }
        .history-page *::-webkit-scrollbar-thumb {
            background: #d9d9d9;
            border-radius: 3px;
        }
        .history-page *::-webkit-scrollbar-thumb:hover {
            background: #bfbfbf;
        }
    `}),L=({totalOrders:e,completedOrders:t,cancelledOrders:r})=>(0,s.jsxs)("div",{style:D.statsCard,children:[(0,s.jsxs)("div",{style:D.statItem,children:[s.jsx("span",{style:{...D.statNumber,color:"#667eea"},children:e}),s.jsx(R,{style:D.statLabel,children:"ทั้งหมด"})]}),s.jsx("div",{style:{width:1,background:"#f0f0f0"}}),(0,s.jsxs)("div",{style:D.statItem,children:[s.jsx("span",{style:{...D.statNumber,color:"#52c41a"},children:t}),s.jsx(R,{style:D.statLabel,children:"เสร็จสิ้น"})]}),s.jsx("div",{style:{width:1,background:"#f0f0f0"}}),(0,s.jsxs)("div",{style:D.statItem,children:[s.jsx("span",{style:{...D.statNumber,color:"#ff4d4f"},children:r}),s.jsx(R,{style:D.statLabel,children:"ยกเลิก"})]})]}),A=({order:e,index:t,onView:r,onDelete:i,isAdmin:o})=>{let n=M[e.status]||M[y.i.PENDING],l=e.ordersItems?.length||0,d=e.ordersItems?.filter(e=>e.ordersDetail?.is_purchased).length||0,c=e.ordersItems?.slice(0,3)||[],u=l-3;return s.jsx("div",{className:"history-order-card",style:{...D.orderCard(e.status),animationDelay:`${.05*t}s`},children:(0,s.jsxs)("div",{style:D.orderCardInner,children:[(0,s.jsxs)("div",{style:D.orderHeader,children:[(0,s.jsxs)("div",{style:D.orderInfo,children:[s.jsx("div",{style:{width:44,height:44,borderRadius:12,background:n.bgColor,border:`1px solid ${n.borderColor}`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:20},children:n.icon}),(0,s.jsxs)("div",{children:[(0,s.jsxs)(R,{strong:!0,style:{fontSize:15,color:"#1a1a2e",display:"block"},children:["#",e.id.substring(0,8).toUpperCase()]}),s.jsx(E.Z,{color:n.tagColor,style:{marginTop:4,borderRadius:10,fontWeight:600},children:n.label})]})]}),(0,s.jsxs)("div",{style:D.orderActions,children:[s.jsx(a.ZP,{type:"primary",size:"small",icon:s.jsx(Z.Z,{}),onClick:()=>r(e),style:{borderRadius:10,background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",border:"none"},children:"ดู"}),o&&s.jsx(a.ZP,{danger:!0,size:"small",icon:s.jsx(S.Z,{}),onClick:()=>i(e),style:{borderRadius:10},children:"ลบ"})]})]}),(0,s.jsxs)("div",{style:{display:"flex",gap:16,padding:"12px 0",borderTop:"1px solid #f0f0f0",borderBottom:"1px solid #f0f0f0"},children:[(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:6},children:[s.jsx(H.Z,{style:{color:"#8c8c8c"}}),s.jsx(R,{type:"secondary",style:{fontSize:13},children:e.ordered_by?.name||e.ordered_by?.username||"Unknown"})]}),(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:6},children:[s.jsx(_.Z,{style:{color:"#8c8c8c"}}),s.jsx(R,{type:"secondary",style:{fontSize:13},children:new Date(e.create_date).toLocaleDateString("th-TH",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:6,marginBottom:10},children:[s.jsx(I.Z,{style:{color:"#667eea",fontSize:14}}),s.jsx(R,{style:{fontSize:13,color:"#666"},children:e.status===y.i.COMPLETED?`ซื้อแล้ว ${d}/${l} รายการ`:`${l} รายการ`})]}),(0,s.jsxs)("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[c.map(e=>(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,padding:"6px 10px",background:"#f5f5f5",borderRadius:10},children:[s.jsx(O.Z,{src:e.ingredient?.img_url||"https://placehold.co/32x32/f5f5f5/999999?text=\uD83D\uDCE6",size:28,shape:"square",style:{borderRadius:6}}),(0,s.jsxs)("div",{children:[s.jsx(R,{style:{fontSize:12,display:"block"},ellipsis:{tooltip:e.ingredient?.display_name},children:e.ingredient?.display_name}),(0,s.jsxs)(R,{type:"secondary",style:{fontSize:11},children:[e.ordersDetail?.is_purchased?e.ordersDetail.actual_quantity:e.quantity_ordered," ",e.ingredient?.unit?.display_name]})]})]},e.id)),u>0&&(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"6px 12px",background:"#e6f4ff",borderRadius:10,color:"#1890ff",fontWeight:600,fontSize:12},children:["+",u," อื่นๆ"]})]})]})]})})};function F(){let[e,t]=(0,i.useState)(null),{socket:r}=(0,f.s)(),{user:P}=(0,g.a)(),E=(0,c.NL)(),[O,w]=(0,i.useState)(1),[q,Z]=(0,i.useState)(10),{data:S=""}=(0,u.a)({queryKey:["csrfToken"],queryFn:()=>m.O.getCsrfToken(),staleTime:6e5}),{data:H,isLoading:_,isFetching:I}=(0,u.a)({queryKey:["stockHistory",O,q],queryFn:async()=>{let e=await fetch(`/api/stock/orders?status=completed,cancelled&page=${O}&limit=${q}`,{cache:"no-store"});if(!e.ok)throw Error((0,C.t)("stockHistory.fetch.error"));let t=await e.json();return Array.isArray(t)?{data:t,total:t.length}:{data:t.data,total:t.total}},placeholderData:e=>e,staleTime:6e4}),R=H?.data??[],T=H?.total??0,M=(0,p.D)({mutationFn:async e=>{let t=S||await m.O.getCsrfToken();if(!(await fetch(`/api/stock/orders/${e}`,{method:"DELETE",headers:{"X-CSRF-Token":t||""}})).ok)throw Error((0,C.t)("stockHistory.delete.error"));return e},onSuccess:()=>{E.invalidateQueries({queryKey:["stockHistory"]}),o.ZP.success((0,C.t)("stockHistory.delete.success"))},onError:()=>{o.ZP.error((0,C.t)("stockHistory.delete.error"))}}),F=e=>{n.Z.confirm({title:(0,C.t)("stockHistory.delete.title"),content:(0,C.t)("stockHistory.delete.content",{code:e.id.substring(0,8).toUpperCase()}),okText:(0,C.t)("stockHistory.delete.ok"),okType:"danger",cancelText:(0,C.t)("stockHistory.delete.cancel"),centered:!0,onOk:async()=>{await M.mutateAsync(e.id)}})},N=R.filter(e=>e.status===y.i.COMPLETED),K=R.filter(e=>e.status===y.i.CANCELLED),$=P?.role==="Admin";return _&&0===R.length?(0,s.jsxs)("div",{style:{minHeight:"100vh",background:D.container.backgroundColor},children:[s.jsx(z,{}),s.jsx(j.Z,{title:(0,C.t)("stockHistory.title"),subtitle:(0,C.t)("stockHistory.subtitle"),icon:s.jsx(h.Z,{}),actions:s.jsx(a.ZP,{onClick:()=>E.invalidateQueries({queryKey:["stockHistory"]}),loading:I,children:(0,C.t)("stockHistory.refresh")})}),s.jsx(b.Z,{children:s.jsx(k.Z,{children:s.jsx("div",{style:{display:"flex",justifyContent:"center",padding:"60px 0"},children:s.jsx(l.Z,{size:"large"})})})})]}):(0,s.jsxs)("div",{className:"history-page",style:D.container,children:[s.jsx(z,{}),s.jsx(j.Z,{title:(0,C.t)("stockHistory.title"),subtitle:(0,C.t)("stockHistory.subtitle"),icon:s.jsx(h.Z,{}),actions:s.jsx(a.ZP,{onClick:()=>E.invalidateQueries({queryKey:["stockHistory"]}),loading:I,children:(0,C.t)("stockHistory.refresh")})}),(0,s.jsxs)(b.Z,{children:[s.jsx(k.Z,{children:s.jsx(L,{totalOrders:T,completedOrders:N.length,cancelledOrders:K.length})}),s.jsx(k.Z,{title:(0,C.t)("stockHistory.sectionAll"),extra:s.jsx("span",{style:{fontWeight:600},children:(0,C.t)("stockHistory.count",{total:T})}),children:s.jsx("div",{style:D.listContainer,children:R.length>0?(0,s.jsxs)(s.Fragment,{children:[R.map((e,r)=>s.jsx(A,{order:e,index:r,onView:t,onDelete:F,isAdmin:$},e.id)),s.jsx("div",{style:{display:"flex",justifyContent:"center",marginTop:24},children:s.jsx(d.Z,{current:O,pageSize:q,total:T,onChange:(e,t)=>{w(e),Z(t)},showSizeChanger:!0,showTotal:e=>(0,C.t)("stockHistory.paginationTotal",{total:e})})})]}):s.jsx(v.Z,{title:(0,C.t)("stockHistory.empty.title"),description:(0,C.t)("stockHistory.empty.desc")})})}),s.jsx(x.Z,{open:!!e,order:e,onClose:()=>t(null)})]})]})}},36231:(e,t,r)=>{"use strict";r.d(t,{Z:()=>l});var s=r(10326);r(17577);var i=r(56249),o=r(75698),n=r(66874),a=r(52386);function l({title:e="ไม่มีข้อมูล",description:t,action:r,image:l}){return s.jsx(i.Z,{size:"small",variant:"outlined",style:{borderRadius:a.H.cardRadiusLG},bodyStyle:{padding:20},children:s.jsx(o.Z,{image:l,description:(0,s.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[s.jsx(n.default.Text,{strong:!0,children:e}),t?s.jsx(n.default.Text,{type:"secondary",children:t}):null]}),children:r})})}},54120:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});let s=(0,r(68570).createProxy)(String.raw`E:\Project\Order-Project-Frontend\src\app\(main)\stock\history\page.tsx#default`)},10119:(e,t,r)=>{"use strict";r.d(t,{D:()=>c});var s=r(17577),i=r(71180),o=r(12113),n=r(64351),a=r(3341),l=class extends n.l{#e;#t=void 0;#r;#s;constructor(e,t){super(),this.#e=e,this.setOptions(t),this.bindMethods(),this.#i()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){let t=this.options;this.options=this.#e.defaultMutationOptions(e),(0,a.VS)(this.options,t)||this.#e.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#r,observer:this}),t?.mutationKey&&this.options.mutationKey&&(0,a.Ym)(t.mutationKey)!==(0,a.Ym)(this.options.mutationKey)?this.reset():this.#r?.state.status==="pending"&&this.#r.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#r?.removeObserver(this)}onMutationUpdate(e){this.#i(),this.#o(e)}getCurrentResult(){return this.#t}reset(){this.#r?.removeObserver(this),this.#r=void 0,this.#i(),this.#o()}mutate(e,t){return this.#s=t,this.#r?.removeObserver(this),this.#r=this.#e.getMutationCache().build(this.#e,this.options),this.#r.addObserver(this),this.#r.execute(e)}#i(){let e=this.#r?.state??(0,i.R)();this.#t={...e,isPending:"pending"===e.status,isSuccess:"success"===e.status,isError:"error"===e.status,isIdle:"idle"===e.status,mutate:this.mutate,reset:this.reset}}#o(e){o.Vr.batch(()=>{if(this.#s&&this.hasListeners()){let t=this.#t.variables,r=this.#t.context,s={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};if(e?.type==="success"){try{this.#s.onSuccess?.(e.data,t,r,s)}catch(e){Promise.reject(e)}try{this.#s.onSettled?.(e.data,null,t,r,s)}catch(e){Promise.reject(e)}}else if(e?.type==="error"){try{this.#s.onError?.(e.error,t,r,s)}catch(e){Promise.reject(e)}try{this.#s.onSettled?.(void 0,e.error,t,r,s)}catch(e){Promise.reject(e)}}}this.listeners.forEach(e=>{e(this.#t)})})}},d=r(44976);function c(e,t){let r=(0,d.NL)(t),[i]=s.useState(()=>new l(r,e));s.useEffect(()=>{i.setOptions(e)},[i,e]);let n=s.useSyncExternalStore(s.useCallback(e=>i.subscribe(o.Vr.batchCalls(e)),[i]),()=>i.getCurrentResult(),()=>i.getCurrentResult()),c=s.useCallback((e,t)=>{i.mutate(e,t).catch(a.ZT)},[i]);if(n.error&&(0,a.L3)(i.options.throwOnError,[n.error]))throw n.error;return{...n,mutate:c,mutateAsync:n.mutate}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[9276,4421,8571,108,8963,1399,1323,7271],()=>r(74986));module.exports=s})();