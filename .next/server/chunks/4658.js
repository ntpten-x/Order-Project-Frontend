exports.id=4658,exports.ids=[4658],exports.modules={58679:(e,t,a)=>{Promise.resolve().then(a.bind(a,82599))},82599:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>W});var o=a(10326),r=a(17577),i=a(18418),n=a(63196),s=a(39655),l=a(35047),d=a(67329),c=a(62938),p=a(73330),u=a(10907),m=a(47885),f=a(27266),b=a(71696),x=a(95762),h=a(11397),y=a(91377),g=a(48230),w=a(35189),k=a(90218),j=a(97458),S=a(71935),v=a(11401),C=a(94001),_=a(88196),Z=a(60920);let E=()=>{let e=(0,l.useRouter)(),t=(0,l.usePathname)(),{user:a}=(0,C.a)(),{currentShift:i}=(0,s.S)(),[n,E]=(0,r.useState)(!1),[T,z]=(0,r.useState)(!1),P=(0,r.useMemo)(()=>[{key:"home",label:"หน้าแรก",icon:o.jsx(d.Z,{}),path:"/"},{key:"pos",label:"ขาย",icon:o.jsx(c.Z,{}),path:"/pos"},{key:"orders",label:"ออเดอร์",icon:o.jsx(p.Z,{}),path:"/pos/orders"},{key:"dashboard",label:"สรุป",icon:o.jsx(u.Z,{}),path:"/pos/dashboard"}],[]),I=(0,r.useMemo)(()=>{let e=[{key:"kitchen",label:"ครัว",icon:o.jsx(m.Z,{}),path:"/pos/kitchen"},{key:"tables",label:"โต๊ะ",icon:o.jsx(f.Z,{}),path:"/pos/tables"},{key:"delivery",label:"เดลิเวอรี่",icon:o.jsx(b.Z,{}),path:"/pos/delivery"}];return(a?.role==="Admin"||a?.role==="Manager")&&e.push({key:"category",label:"หมวดหมู่",icon:o.jsx(u.Z,{}),path:"/pos/category"},{key:"products",label:"สินค้า",icon:o.jsx(c.Z,{}),path:"/pos/products"},{key:"productsUnit",label:"หน่วยสินค้า",icon:o.jsx(u.Z,{}),path:"/pos/productsUnit"},{key:"discounts",label:"ส่วนลด",icon:o.jsx(x.Z,{}),path:"/pos/discounts"},{key:"payment",label:"ชำระเงิน",icon:o.jsx(h.Z,{}),path:"/pos/paymentMethod"},{key:"settings",label:"ตั้งค่า",icon:o.jsx(y.Z,{}),path:"/pos/settings"}),e},[a?.role]),N=e=>"/"===e?"/"===t:"/pos"===e?"/pos"===t||t.startsWith("/pos/channels"):t===e||t.startsWith(e+"/"),D=I.some(e=>N(e.path)),F=t=>{e.push(t),E(!1)};return(0,o.jsxs)(o.Fragment,{children:[o.jsx(_.Z,{maxWidth:520,items:[...P.map(e=>({key:e.key,label:e.label,icon:e.icon,onClick:()=>F(e.path),active:N(e.path)})),{key:"more",label:"เพิ่มเติม",icon:o.jsx(g.Z,{}),onClick:()=>E(!0),active:n||D}]}),o.jsx(k.Z,{open:n,onClose:()=>E(!1),placement:"bottom",title:"เมนูเพิ่มเติม",zIndex:2e3,children:(0,o.jsxs)("div",{style:{paddingBottom:"calc(12px + env(safe-area-inset-bottom))"},children:[o.jsx(j.Z,{dataSource:I,renderItem:e=>o.jsx(j.Z.Item,{style:{paddingInline:0},children:o.jsx(S.ZP,{type:"text",block:!0,icon:e.icon,style:{height:48,justifyContent:"flex-start"},onClick:()=>F(e.path),children:e.label})})}),i&&o.jsx(S.ZP,{danger:!0,block:!0,icon:o.jsx(v.Z,{dot:!0,status:"processing",color:"#ef4444",children:o.jsx(w.Z,{})}),style:{height:48,marginTop:8},onClick:()=>{z(!0),E(!1)},children:"ปิดกะ"})]})}),o.jsx(Z.Z,{open:T,onCancel:()=>z(!1)})]})};var T=a(46752),z=a(57473),P=a(67355),I=a(3548),N=a(26859),D=a(83476),F=a(52249),R=a(81456),$=a(45839);let O=e=>new Promise(t=>setTimeout(t,e)),M=()=>{let e=(0,P.L)(),[t,a]=(0,r.useState)(!1),i=(0,r.useCallback)(async()=>{if(t||0===I.x.getQueue().length)return;a(!0);let e=T.ZP.loading("กำลังซิงค์รายการที่ค้างอยู่...",0),o=0,r=0;I.x.pruneExceeded();let i=I.x.getQueue();try{let e=await R.O.getCsrfToken();for(let t of i)try{let a=I.M.backoff(t.retryCount);if(a>0&&await O(a),"CREATE_ORDER"===t.type)await N.x.create(t.payload,void 0,e);else if("UPDATE_ORDER"===t.type){let{orderId:a,data:o}=t.payload;await N.x.update(a,o,void 0,e)}else if("ADD_ITEM"===t.type){let{orderId:a,itemData:o}=t.payload;await N.x.addItem(a,o,void 0,e)}else if("UPDATE_ITEM"===t.type){let{itemId:a,itemData:o}=t.payload;await N.x.updateItem(a,o,void 0,e)}else if("DELETE_ITEM"===t.type){let{itemId:a}=t.payload;await N.x.deleteItem(a,void 0,e)}else if("PAYMENT"===t.type){let{orderId:a,paymentData:o}=t.payload;await D.U.create({...o,order_id:a},void 0,e)}else if("UPDATE_QUEUE_STATUS"===t.type){let{queueId:e,status:a}=t.payload;await F.e.updateStatus(e,{status:a},void 0)}I.x.removeFromQueue(t.id),o++}catch(e){if(t.retryCount+1>I.M.maxRetry)I.x.removeFromQueue(t.id),r++;else{let a=e instanceof Error?e.message:void 0;I.x.incrementRetry(t.id,a)}}}finally{e(),a(!1),o>0&&T.ZP.success(`ซิงค์สำเร็จ ${o} รายการ`),r>0&&z.ZP.error({message:"ซิงค์บางรายการไม่สำเร็จ",description:`${r} รายการเกินจำนวน retry ที่กำหนด`,placement:"bottomRight",duration:3})}},[t]);return(0,r.useEffect)(()=>{e?i():z.ZP.warning({message:"ออฟไลน์",description:"รายการจะถูกเก็บเข้าคิวและซิงค์ให้อัตโนมัติเมื่อออนไลน์",icon:o.jsx($.Z,{style:{color:"#faad14"}}),duration:2,placement:"bottomRight"})},[e,i]),null};var A=a(60372),H=a(44976),U=a(19211);let J=()=>{let{socket:e}=(0,r.useContext)(U.J),t=(0,H.NL)();(0,r.useEffect)(()=>{if(!e)return;let a=()=>{t.invalidateQueries({queryKey:["orders"]}),t.invalidateQueries({queryKey:["ordersSummary"]})},o=()=>{a()},r=()=>{a()},i=()=>{a()};return e.on("orders:create",o),e.on("orders:update",r),e.on("orders:delete",i),e.on("payments:create",r),e.on("payments:update",r),()=>{e.off("orders:create",o),e.off("orders:update",r),e.off("orders:delete",i),e.off("payments:create",r),e.off("payments:update",r)}},[e,t])};function W({children:e}){return J(),(0,o.jsxs)(s.r,{children:[o.jsx(M,{}),o.jsx(A.Z,{}),o.jsx(n.Z,{children:(0,o.jsxs)(i.default,{style:{minHeight:"100%",background:"transparent"},children:[o.jsx(i.default.Content,{style:{background:"transparent"},children:e}),o.jsx(E,{})]})})]})}},88196:(e,t,a)=>{"use strict";a.d(t,{Z:()=>u});var o=a(10326);a(17577);var r=a(58184),i=a(5591),n=a(3861),s=a(56249),l=a(11401),d=a(71935),c=a(83575);let{Text:p}=r.default;function u({items:e,maxWidth:t=440,bottomOffset:a=c.w}){let{token:r}=i.default.useToken(),u=!n.default.useBreakpoint().md,m={position:"fixed",left:"50%",transform:"translateX(-50%)",bottom:`calc(${a}px + env(safe-area-inset-bottom))`,width:"calc(100% - 24px)",maxWidth:t,zIndex:900};return o.jsx("div",{style:m,"aria-label":"Bottom navigation",children:o.jsx(s.Z,{size:"small",variant:"outlined",bodyStyle:{padding:8,display:"grid",gridTemplateColumns:`repeat(${e.length}, minmax(0, 1fr))`,gap:4},style:{borderRadius:u?18:22,borderColor:r.colorBorderSecondary,background:"rgba(255, 255, 255, 0.92)",backdropFilter:"blur(12px)",boxShadow:r.boxShadowSecondary},children:e.map(e=>{let t=!!e.active,a=t?r.colorPrimary:r.colorTextSecondary,i=t?r.colorPrimary:r.colorTextSecondary,n=o.jsx("span",{style:{fontSize:22,lineHeight:1,color:a},children:e.icon}),s=e.badgeDot||(e.badgeCount??0)>0?o.jsx(l.Z,{dot:e.badgeDot,count:e.badgeCount,size:"small",children:n}):n;return(0,o.jsxs)(d.ZP,{type:"text",disabled:e.disabled,"aria-label":e.ariaLabel??e.label,"aria-current":t?"page":void 0,onClick:e.onClick,style:{height:u?64:68,paddingInline:0,borderRadius:16,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:4,background:t?r.colorPrimaryBg:"transparent"},children:[s,o.jsx(p,{style:{fontSize:11,fontWeight:t?600:500,color:i,lineHeight:1},children:e.label})]},e.key)})})})}},60920:(e,t,a)=>{"use strict";a.d(t,{Z:()=>y});var o=a(10326),r=a(77626),i=a.n(r),n=a(17577),s=a(58184),l=a(43359),d=a(75958),c=a(31916),p=a(71935),u=a(39655),m=a(99251),f=a(88295),b=a.n(f);let{Title:x,Text:h}=s.default;function y({open:e,onCancel:t,onSuccess:a}){let{currentShift:r,closeShift:s}=(0,u.S)(),[f,y]=(0,n.useState)(!1),[g]=l.Z.useForm(),w=async e=>{y(!0);try{await s(e.endAmount),t(),g.resetFields(),a&&a()}catch{}finally{y(!1)}};return(0,o.jsxs)(d.Z,{open:e,onCancel:t,title:null,centered:!0,footer:null,width:480,className:"soft-modal",styles:{body:{padding:0,borderRadius:24,overflow:"hidden",boxShadow:"0 20px 50px rgba(0,0,0,0.1)"},mask:{backdropFilter:"blur(5px)"}},children:[(0,o.jsxs)("div",{className:"jsx-513b4b5890b57a8a modal-header-close",children:[o.jsx("div",{className:"jsx-513b4b5890b57a8a icon-wrapper-close",children:o.jsx(m.Z,{style:{fontSize:32,color:"#ef4444"}})}),o.jsx(x,{level:3,style:{margin:0,color:"#1f1f1f",fontWeight:700},children:"ปิดรอบการขาย"}),o.jsx(h,{type:"secondary",style:{fontSize:16},children:"Close Shift"})]}),o.jsx("div",{style:{padding:"0 32px 32px 32px"},className:"jsx-513b4b5890b57a8a",children:r&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:"jsx-513b4b5890b57a8a info-card",children:[(0,o.jsxs)("div",{className:"jsx-513b4b5890b57a8a info-row",children:[o.jsx(h,{type:"secondary",children:"เวลาเปิดกะ"}),o.jsx(h,{strong:!0,children:b()(r.open_time).format("DD/MM/YYYY HH:mm")})]}),o.jsx("div",{className:"jsx-513b4b5890b57a8a info-divider"}),(0,o.jsxs)("div",{className:"jsx-513b4b5890b57a8a info-row",children:[o.jsx(h,{type:"secondary",children:"เงินทอนเริ่มต้น"}),(0,o.jsxs)(h,{strong:!0,children:[Number(r.start_amount).toLocaleString()," บาท"]})]})]}),(0,o.jsxs)(l.Z,{form:g,layout:"vertical",onFinish:w,children:[o.jsx(l.Z.Item,{name:"endAmount",label:o.jsx("span",{style:{fontSize:16,fontWeight:500,color:"#4b5563"},className:"jsx-513b4b5890b57a8a",children:"ยอดเงินสดที่นับได้ (Cash Counted)"}),rules:[{required:!0,message:"กรุณาระบุจำนวนเงิน"}],children:o.jsx(c.Z,{style:{width:"100%",height:"80px",borderRadius:16,border:"2px solid #e5e7eb"},size:"large",min:0,precision:2,placeholder:"0.00",autoFocus:!0,controls:!1,inputMode:"decimal",className:"huge-input-close",formatter:e=>`${e}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:e=>e?.replace(/\$\s?|(,*)/g,""),onKeyDown:e=>{if([8,46,9,27,13,190,110].includes(e.keyCode)||!0===e.ctrlKey||!0===e.metaKey||e.keyCode>=35&&e.keyCode<=39){(190===e.keyCode||110===e.keyCode)&&e.currentTarget.value.includes(".")&&e.preventDefault();return}(e.shiftKey||e.keyCode<48||e.keyCode>57)&&(e.keyCode<96||e.keyCode>105)&&e.preventDefault()}})}),(0,o.jsxs)("div",{style:{display:"flex",gap:12,marginTop:24},className:"jsx-513b4b5890b57a8a flex gap-4",children:[o.jsx(p.ZP,{block:!0,size:"large",onClick:t,disabled:f,style:{height:56,borderRadius:16,fontSize:16,fontWeight:600,background:"#f3f4f6",border:"none",color:"#4b5563"},children:"ยกเลิก"}),o.jsx(p.ZP,{type:"primary",htmlType:"submit",block:!0,size:"large",loading:f,style:{height:56,borderRadius:16,fontSize:16,fontWeight:600,background:"#ef4444",border:"none",boxShadow:"0 4px 14px rgba(239, 68, 68, 0.4)"},children:"ยืนยันปิดกะ"})]})]})]})}),o.jsx(i(),{id:"513b4b5890b57a8a",children:".modal-header-close{background:-webkit-linear-gradient(top,#fef2f2 0%,#fff 100%);background:-moz-linear-gradient(top,#fef2f2 0%,#fff 100%);background:-o-linear-gradient(top,#fef2f2 0%,#fff 100%);background:linear-gradient(180deg,#fef2f2 0%,#fff 100%);padding:32px 24px 24px 24px;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-moz-box-orient:vertical;-moz-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;gap:8px;text-align:center}.icon-wrapper-close{width:64px;height:64px;background:#fee2e2;-webkit-border-radius:50%;-moz-border-radius:50%;border-radius:50%;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center;margin-bottom:8px;-webkit-box-shadow:0 4px 12px rgba(239,68,68,.15);-moz-box-shadow:0 4px 12px rgba(239,68,68,.15);box-shadow:0 4px 12px rgba(239,68,68,.15)}.info-card{background:#f8fafc;-webkit-border-radius:16px;-moz-border-radius:16px;border-radius:16px;padding:16px;margin-bottom:24px}.info-row{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-moz-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center}.info-divider{height:1px;background:#e2e8f0;margin:12px 0}.huge-input-close input{font-size:36px!important;font-weight:700!important;text-align:center!important;color:#ef4444!important;height:100%!important}.huge-input-close:focus-within{border-color:#ef4444!important;-webkit-box-shadow:0 0 0 4px rgba(239,68,68,.1)!important;-moz-box-shadow:0 0 0 4px rgba(239,68,68,.1)!important;box-shadow:0 0 0 4px rgba(239,68,68,.1)!important}"})]})}},60372:(e,t,a)=>{"use strict";a.d(t,{Z:()=>h});var o=a(10326),r=a(77626),i=a.n(r),n=a(17577),s=a(58184),l=a(43359),d=a(75958),c=a(31916),p=a(71935),u=a(39655),m=a(99251),f=a(35047);let{Title:b,Text:x}=s.default;function h({open:e,onCancel:t}={}){let{currentShift:a,loading:r,openShift:s}=(0,u.S)(),[h,y]=(0,n.useState)(!1),[g]=l.Z.useForm(),w=(0,f.usePathname)(),k=async e=>{y(!0);try{await s(e.startAmount)}catch{}finally{y(!1)}};return r?null:(0,o.jsxs)(d.Z,{open:void 0!==e?e:!r&&!a&&"/pos/shift"!==w,onCancel:t,title:null,centered:!0,closable:!1,maskClosable:!1,footer:null,width:400,className:"soft-modal",styles:{body:{padding:0,borderRadius:24,overflow:"hidden",boxShadow:"0 20px 50px rgba(0,0,0,0.1)"}},children:[(0,o.jsxs)("div",{className:"jsx-986e1bd238b3f1c5 modal-header",children:[o.jsx("div",{className:"jsx-986e1bd238b3f1c5 icon-wrapper",children:o.jsx(m.Z,{style:{fontSize:32,color:"#10b981"}})}),o.jsx(b,{level:3,style:{margin:0,color:"#1f1f1f",fontWeight:700},children:"เปิดรอบการขาย"}),o.jsx(x,{type:"secondary",style:{fontSize:16},children:"Open Shift"})]}),o.jsx("div",{style:{padding:"0 32px 32px 32px"},className:"jsx-986e1bd238b3f1c5",children:(0,o.jsxs)(l.Z,{form:g,layout:"vertical",onFinish:k,initialValues:{startAmount:0},children:[o.jsx(l.Z.Item,{name:"startAmount",label:o.jsx("span",{style:{fontSize:16,fontWeight:500,color:"#4b5563"},className:"jsx-986e1bd238b3f1c5",children:"ระบุเงินทอนเริ่มต้น (บาท)"}),rules:[{required:!0,message:"กรุณาระบุจำนวนเงิน"}],children:o.jsx(c.Z,{style:{width:"100%",height:"80px",borderRadius:16,border:"2px solid #e5e7eb"},size:"large",min:0,precision:2,placeholder:"0.00",autoFocus:!0,controls:!1,inputMode:"decimal",className:"huge-input",formatter:e=>`${e}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:e=>e?.replace(/\$\s?|(,*)/g,""),onKeyDown:e=>{if([8,46,9,27,13,190,110].includes(e.keyCode)||!0===e.ctrlKey||!0===e.metaKey||e.keyCode>=35&&e.keyCode<=39){(190===e.keyCode||110===e.keyCode)&&e.target.value?.includes(".")&&e.preventDefault();return}(e.shiftKey||e.keyCode<48||e.keyCode>57)&&(e.keyCode<96||e.keyCode>105)&&e.preventDefault()}})}),o.jsx(p.ZP,{type:"primary",htmlType:"submit",block:!0,size:"large",loading:h,style:{height:56,borderRadius:16,fontSize:18,fontWeight:600,background:"#10b981",boxShadow:"0 4px 14px rgba(16, 185, 129, 0.4)",border:"none",marginTop:16},children:"ยืนยันเปิดกะ"})]})}),o.jsx(i(),{id:"986e1bd238b3f1c5",children:".soft-modal .ant-modal-content{padding:0!important}.modal-header{background:-webkit-linear-gradient(top,#f0fdf4 0%,#fff 100%);background:-moz-linear-gradient(top,#f0fdf4 0%,#fff 100%);background:-o-linear-gradient(top,#f0fdf4 0%,#fff 100%);background:linear-gradient(180deg,#f0fdf4 0%,#fff 100%);padding:40px 24px 24px 24px;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-moz-box-orient:vertical;-moz-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;gap:8px;text-align:center}.icon-wrapper{width:72px;height:72px;background:#d1fae5;-webkit-border-radius:50%;-moz-border-radius:50%;border-radius:50%;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center;margin-bottom:8px;-webkit-box-shadow:0 4px 12px rgba(16,185,129,.15);-moz-box-shadow:0 4px 12px rgba(16,185,129,.15);box-shadow:0 4px 12px rgba(16,185,129,.15)}.huge-input input{font-size:36px!important;font-weight:700!important;text-align:center!important;color:#10b981!important;height:100%!important}.huge-input:focus-within{border-color:#10b981!important;-webkit-box-shadow:0 0 0 4px rgba(16,185,129,.1)!important;-moz-box-shadow:0 0 0 4px rgba(16,185,129,.1)!important;box-shadow:0 0 0 4px rgba(16,185,129,.1)!important}"})]})}},63196:(e,t,a)=>{"use strict";a.d(t,{Z:()=>s,j:()=>l});var o=a(10326),r=a(17577),i=a.n(r);let n=(0,r.createContext)(void 0),s=({children:e})=>{let[t,a]=(0,r.useState)([]),[s,l]=(0,r.useState)("DINE_IN"),[d,c]=(0,r.useState)(null),[p,u]=(0,r.useState)(null),[m,f]=(0,r.useState)(null),[b,x]=(0,r.useState)(null),[h,y]=(0,r.useState)(!1);i().useEffect(()=>{let e=localStorage.getItem("pos_cart_items"),t=localStorage.getItem("pos_order_mode"),o=localStorage.getItem("pos_ref_id"),r=localStorage.getItem("pos_ref_code"),i=localStorage.getItem("pos_discount"),n=localStorage.getItem("pos_payment");if(e)try{let t=JSON.parse(e).map((e,t)=>({...e,cart_item_id:e.cart_item_id||`item-${Date.now()}-${t}-${Math.random().toString(36).substr(2,9)}`}));a(t)}catch(e){console.error("Failed to parse cart:",e),a([])}t&&l(t),o&&c(o),r&&u(r),i&&f(JSON.parse(i)),n&&x(JSON.parse(n)),y(!0)},[]),i().useEffect(()=>{h&&(localStorage.setItem("pos_cart_items",JSON.stringify(t)),localStorage.setItem("pos_order_mode",s),d?localStorage.setItem("pos_ref_id",d):localStorage.removeItem("pos_ref_id"),p?localStorage.setItem("pos_ref_code",p):localStorage.removeItem("pos_ref_code"),m?localStorage.setItem("pos_discount",JSON.stringify(m)):localStorage.removeItem("pos_discount"),b?localStorage.setItem("pos_payment",JSON.stringify(b)):localStorage.removeItem("pos_payment"))},[t,s,d,p,m,b,h]);let g=e=>{a(t=>t.filter(t=>t.cart_item_id!==e))},w=()=>t.reduce((e,t)=>e+(("DELIVERY"===s?Number(t.product.price_delivery??t.product.price):Number(t.product.price))+(t.details||[]).reduce((e,t)=>e+Number(t.extra_price),0))*t.quantity,0),k=()=>{let e=w();return m?"Percentage"===m.discount_type?e*m.discount_amount/100:Math.min(m.discount_amount,e):0};return o.jsx(n.Provider,{value:{cartItems:t,addToCart:(e,t=1,o)=>{a(a=>{let r={cart_item_id:`item-${Date.now()}-${a.length}-${Math.random().toString(36).substr(2,9)}`,product:e,quantity:t,notes:o,details:[]};return[...a,r]})},removeFromCart:g,updateQuantity:(e,t)=>{if(t<=0){g(e);return}a(a=>a.map(a=>a.cart_item_id===e?{...a,quantity:t}:a))},updateItemNote:(e,t)=>{a(a=>a.map(a=>a.cart_item_id===e?{...a,notes:t}:a))},clearCart:()=>{a([]),f(null),x(null),c(null),u(null)},addDetailToItem:(e,t)=>{a(a=>a.map(a=>a.cart_item_id===e?{...a,details:[...a.details||[],t]}:a))},removeDetailFromItem:(e,t)=>{a(a=>a.map(a=>a.cart_item_id===e?{...a,details:(a.details||[]).filter((e,a)=>a!==t)}:a))},updateItemDetails:(e,t)=>{a(a=>a.map(a=>a.cart_item_id===e?{...a,details:t}:a))},orderMode:s,setOrderMode:l,referenceId:d,setReferenceId:c,referenceCode:p,setReferenceCode:u,selectedDiscount:m,setSelectedDiscount:f,selectedPaymentMethod:b,setSelectedPaymentMethod:x,getTotalItems:()=>t.reduce((e,t)=>e+t.quantity,0),getSubtotal:w,getDiscountAmount:k,getFinalPrice:()=>Math.max(0,w()-k())},children:e})},l=()=>{let e=(0,r.useContext)(n);if(void 0===e)throw Error("useCart must be used within a CartProvider");return e}},39655:(e,t,a)=>{"use strict";a.d(t,{S:()=>c,r:()=>d});var o=a(10326),r=a(17577),i=a(94001),n=a(94658),s=a(46752);let l=(0,r.createContext)(void 0),d=({children:e})=>{let{user:t}=(0,i.a)(),[a,d]=(0,r.useState)(null),[c,p]=(0,r.useState)(!0),u=(0,r.useCallback)(async()=>{if(t)try{let e=await n.t.getCurrentShift();d(e)}catch(e){console.error("Error fetching shift:",e)}finally{p(!1)}},[t]);(0,r.useEffect)(()=>{u()},[u]);let m=async e=>{if(t)try{let t=await n.t.openShift(e);d(t),s.ZP.success("เปิดกะเรียบร้อยแล้ว")}catch(e){throw s.ZP.error(e instanceof Error?e.message:"เปิดกะไม่สำเร็จ"),e}},f=async e=>{if(t)try{await n.t.closeShift(e),d(null),s.ZP.success("ปิดกะเรียบร้อยแล้ว")}catch(e){throw s.ZP.error(e instanceof Error?e.message:"ปิดกะไม่สำเร็จ"),e}};return o.jsx(l.Provider,{value:{currentShift:a,loading:c,openShift:m,closeShift:f,refreshShift:u},children:e})},c=()=>{let e=(0,r.useContext)(l);if(!e)throw Error("useShift must be used within a ShiftProvider");return e}},67355:(e,t,a)=>{"use strict";a.d(t,{L:()=>r});var o=a(17577);function r(){let[e,t]=(0,o.useState)("undefined"==typeof navigator||navigator.onLine);return e}},83476:(e,t,a)=>{"use strict";a.d(t,{U:()=>s});var o=a(12529),r=a(40577);let i="/pos/payments",n=(e,t="application/json")=>{let a={};return t&&(a["Content-Type"]=t),e&&(a.Cookie=e),a},s={getAll:async e=>{let t=(0,o.b)("GET",i),a=n(e,""),s=await fetch(t,{cache:"no-store",headers:a});if(!s.ok){let e=await s.json().catch(()=>({}));throw Error((0,r.i_)(e,"ไม่สามารถดึงข้อมูลการชำระเงินได้"))}return(0,r.hH)(await s.json())},getById:async(e,t)=>{let a=(0,o.b)("GET",`${i}/${e}`),s=n(t,""),l=await fetch(a,{cache:"no-store",headers:s});if(!l.ok){let e=await l.json().catch(()=>({}));throw Error((0,r.i_)(e,"ไม่สามารถดึงข้อมูลการชำระเงินได้"))}return(0,r.hH)(await l.json())},create:async(e,t,a)=>{let s=(0,o.b)("POST",`${i}`),l=n(t);a&&(l["X-CSRF-Token"]=a);let d=await fetch(s,{method:"POST",headers:l,credentials:"include",body:JSON.stringify(e)});if(!d.ok){let e=await d.json().catch(()=>({}));throw Error((0,r.i_)(e,"ไม่สามารถสร้างรายการชำระเงินได้"))}return(0,r.hH)(await d.json())},update:async(e,t,a,s)=>{let l=(0,o.b)("PUT",`${i}/${e}`),d=n(a);s&&(d["X-CSRF-Token"]=s);let c=await fetch(l,{method:"PUT",headers:d,credentials:"include",body:JSON.stringify(t)});if(!c.ok){let e=await c.json().catch(()=>({}));throw Error((0,r.i_)(e,"ไม่สามารถแก้ไขรายการชำระเงินได้"))}return(0,r.hH)(await c.json())},delete:async(e,t,a)=>{let s=(0,o.b)("DELETE",`${i}/${e}`),l=n(t,"");a&&(l["X-CSRF-Token"]=a);let d=await fetch(s,{method:"DELETE",headers:l,credentials:"include"});if(!d.ok){let e=await d.json().catch(()=>({}));throw Error((0,r.i_)(e,"ไม่สามารถลบรายการชำระเงินได้"))}}}},94658:(e,t,a)=>{"use strict";a.d(t,{t:()=>i});var o=a(33357),r=a(40577);let i={getCurrentShift:async()=>{let e=await fetch("/api/pos/shifts/current",{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"});if(404===e.status)return null;if(!e.ok)throw Error("Failed to fetch current shift");return(0,r.hH)(await e.json())},openShift:async e=>{let t=await (0,o.P)(),a=await fetch("/api/pos/shifts/open",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":t},credentials:"include",body:JSON.stringify({start_amount:e})});if(!a.ok){let e=await a.json().catch(()=>({}));throw Error(e?.error?.message||e.message||"Failed to open shift")}return(0,r.hH)(await a.json())},closeShift:async e=>{let t=await (0,o.P)(),a=await fetch("/api/pos/shifts/close",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":t},credentials:"include",body:JSON.stringify({end_amount:e})});if(!a.ok){let e=await a.json().catch(()=>({}));throw Error(e?.error?.message||e.message||"Failed to close shift")}return(0,r.hH)(await a.json())},getCurrentSummary:async()=>{let e=await fetch("/api/pos/shifts/current/summary",{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"});if(!e.ok)throw Error("Failed to fetch shift summary");return(0,r.hH)(await e.json())},getSummary:async e=>{let t=await fetch(`/api/pos/shifts/summary/${e}`,{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"});if(!t.ok)throw Error("Failed to fetch shift summary");return(0,r.hH)(await t.json())}}},85429:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>o});let o=(0,a(68570).createProxy)(String.raw`E:\Project\Order-Project-Frontend\src\app\(main)\pos\layout.tsx#default`)}};