exports.id=4658,exports.ids=[4658],exports.modules={58679:(e,t,a)=>{Promise.resolve().then(a.bind(a,82599))},82599:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>q});var r=a(10326),o=a(17577),i=a(18418),s=a(63196),n=a(39655),l=a(35047),d=a(67329),c=a(62938),p=a(73330),u=a(10907),m=a(47885),b=a(27266),f=a(71696),x=a(95762),h=a(11397),y=a(91377),g=a(48230),k=a(35189),w=a(90218),j=a(97458),S=a(71935),v=a(11401),C=a(94001),_=a(88196),Z=a(60920);let E=()=>{let e=(0,l.useRouter)(),t=(0,l.usePathname)(),{user:a}=(0,C.a)(),{currentShift:i}=(0,n.S)(),[s,E]=(0,o.useState)(!1),[I,T]=(0,o.useState)(!1),z=(0,o.useMemo)(()=>[{key:"home",label:"หน้าแรก",icon:r.jsx(d.Z,{}),path:"/"},{key:"pos",label:"ขาย",icon:r.jsx(c.Z,{}),path:"/pos"},{key:"orders",label:"ออเดอร์",icon:r.jsx(p.Z,{}),path:"/pos/orders"},{key:"dashboard",label:"สรุป",icon:r.jsx(u.Z,{}),path:"/pos/dashboard"}],[]),P=(0,o.useMemo)(()=>{let e=[{key:"kitchen",label:"ครัว",icon:r.jsx(m.Z,{}),path:"/pos/kitchen"},{key:"tables",label:"โต๊ะ",icon:r.jsx(b.Z,{}),path:"/pos/tables"},{key:"delivery",label:"เดลิเวอรี่",icon:r.jsx(f.Z,{}),path:"/pos/delivery"}];return(a?.role==="Admin"||a?.role==="Manager")&&e.push({key:"category",label:"หมวดหมู่",icon:r.jsx(u.Z,{}),path:"/pos/category"},{key:"products",label:"สินค้า",icon:r.jsx(c.Z,{}),path:"/pos/products"},{key:"productsUnit",label:"หน่วยสินค้า",icon:r.jsx(u.Z,{}),path:"/pos/productsUnit"},{key:"discounts",label:"ส่วนลด",icon:r.jsx(x.Z,{}),path:"/pos/discounts"},{key:"payment",label:"ชำระเงิน",icon:r.jsx(h.Z,{}),path:"/pos/paymentMethod"},{key:"settings",label:"ตั้งค่า",icon:r.jsx(y.Z,{}),path:"/pos/settings"}),e},[a?.role]),O=e=>"/"===e?"/"===t:"/pos"===e?"/pos"===t||t.startsWith("/pos/channels"):t===e||t.startsWith(e+"/"),D=P.some(e=>O(e.path)),N=t=>{e.push(t),E(!1)};return(0,r.jsxs)(r.Fragment,{children:[r.jsx(_.Z,{maxWidth:520,items:[...z.map(e=>({key:e.key,label:e.label,icon:e.icon,onClick:()=>N(e.path),active:O(e.path)})),{key:"more",label:"เพิ่มเติม",icon:r.jsx(g.Z,{}),onClick:()=>E(!0),active:s||D}]}),r.jsx(w.Z,{open:s,onClose:()=>E(!1),placement:"bottom",title:"เมนูเพิ่มเติม",zIndex:2e3,children:(0,r.jsxs)("div",{style:{paddingBottom:"calc(12px + env(safe-area-inset-bottom))"},children:[r.jsx(j.Z,{dataSource:P,renderItem:e=>r.jsx(j.Z.Item,{style:{paddingInline:0},children:r.jsx(S.ZP,{type:"text",block:!0,icon:e.icon,style:{height:48,justifyContent:"flex-start"},onClick:()=>N(e.path),children:e.label})})}),i&&r.jsx(S.ZP,{danger:!0,block:!0,icon:r.jsx(v.Z,{dot:!0,status:"processing",color:"#ef4444",children:r.jsx(k.Z,{})}),style:{height:48,marginTop:8},onClick:()=>{T(!0),E(!1)},children:"ปิดกะ"})]})}),r.jsx(Z.Z,{open:I,onCancel:()=>T(!1)})]})};var I=a(46752),T=a(57473),z=a(67355),P=a(3548),O=a(26859),D=a(83476),N=a(52249),F=a(81456),R=a(45839);let M=e=>new Promise(t=>setTimeout(t,e)),U=()=>{let e=(0,z.L)(),[t,a]=(0,o.useState)(!1),i=(0,o.useCallback)(async()=>{if(t||0===P.x.getQueue().length)return;a(!0);let e=I.ZP.loading("กำลังซิงค์รายการที่ค้างอยู่...",0),r=0,o=0;P.x.pruneExceeded();let i=P.x.getQueue();try{let e=await F.O.getCsrfToken();for(let t of i)try{let a=P.M.backoff(t.retryCount);if(a>0&&await M(a),"CREATE_ORDER"===t.type)await O.x.create(t.payload,void 0,e);else if("UPDATE_ORDER"===t.type){let{orderId:a,data:r}=t.payload;await O.x.update(a,r,void 0,e)}else if("ADD_ITEM"===t.type){let{orderId:a,itemData:r}=t.payload;await O.x.addItem(a,r,void 0,e)}else if("UPDATE_ITEM"===t.type){let{itemId:a,itemData:r}=t.payload;await O.x.updateItem(a,r,void 0,e)}else if("DELETE_ITEM"===t.type){let{itemId:a}=t.payload;await O.x.deleteItem(a,void 0,e)}else if("PAYMENT"===t.type){let{orderId:a,paymentData:r}=t.payload;await D.U.create({...r,order_id:a},void 0,e)}else if("UPDATE_QUEUE_STATUS"===t.type){let{queueId:e,status:a}=t.payload;await N.e.updateStatus(e,{status:a},void 0)}P.x.removeFromQueue(t.id),r++}catch(e){if(t.retryCount+1>P.M.maxRetry)P.x.removeFromQueue(t.id),o++;else{let a=e instanceof Error?e.message:void 0;P.x.incrementRetry(t.id,a)}}}finally{e(),a(!1),r>0&&I.ZP.success(`ซิงค์สำเร็จ ${r} รายการ`),o>0&&T.ZP.error({message:"ซิงค์บางรายการไม่สำเร็จ",description:`${o} รายการเกินจำนวน retry ที่กำหนด`,placement:"bottomRight",duration:3})}},[t]);return(0,o.useEffect)(()=>{e?i():T.ZP.warning({message:"ออฟไลน์",description:"รายการจะถูกเก็บเข้าคิวและซิงค์ให้อัตโนมัติเมื่อออนไลน์",icon:r.jsx(R.Z,{style:{color:"#faad14"}}),duration:2,placement:"bottomRight"})},[e,i]),null};var $=a(60372),A=a(44976),H=a(19211),J=a(83179);let W=()=>{let{socket:e}=(0,o.useContext)(H.J),t=(0,A.NL)();(0,o.useEffect)(()=>{if(!e)return;let a=()=>{t.invalidateQueries({queryKey:["orders"]}),t.invalidateQueries({queryKey:["ordersSummary"]})},r=()=>{a()},o=()=>{a()},i=()=>{a()};return e.on(J.b.orders.create,r),e.on(J.b.orders.update,o),e.on(J.b.orders.delete,i),e.on(J.b.payments.create,o),e.on(J.b.payments.update,o),e.on(J.b.salesOrderItem.create,o),e.on(J.b.salesOrderItem.update,o),e.on(J.b.salesOrderItem.delete,o),e.on(J.b.salesOrderDetail.create,o),e.on(J.b.salesOrderDetail.update,o),e.on(J.b.salesOrderDetail.delete,o),()=>{e.off(J.b.orders.create,r),e.off(J.b.orders.update,o),e.off(J.b.orders.delete,i),e.off(J.b.payments.create,o),e.off(J.b.payments.update,o),e.off(J.b.salesOrderItem.create,o),e.off(J.b.salesOrderItem.update,o),e.off(J.b.salesOrderItem.delete,o),e.off(J.b.salesOrderDetail.create,o),e.off(J.b.salesOrderDetail.update,o),e.off(J.b.salesOrderDetail.delete,o)}},[e,t])};function q({children:e}){return W(),(0,r.jsxs)(n.r,{children:[r.jsx(U,{}),r.jsx($.Z,{}),r.jsx(s.Z,{children:(0,r.jsxs)(i.default,{style:{minHeight:"100%",background:"transparent"},children:[r.jsx(i.default.Content,{style:{background:"transparent"},children:e}),r.jsx(E,{})]})})]})}},88196:(e,t,a)=>{"use strict";a.d(t,{Z:()=>u});var r=a(10326);a(17577);var o=a(66874),i=a(5591),s=a(3861),n=a(56249),l=a(11401),d=a(71935),c=a(83575);let{Text:p}=o.default;function u({items:e,maxWidth:t=440,bottomOffset:a=c.w}){let{token:o}=i.default.useToken(),u=!s.default.useBreakpoint().md,m={position:"fixed",left:"50%",transform:"translateX(-50%)",bottom:`calc(${a}px + env(safe-area-inset-bottom))`,width:"calc(100% - 24px)",maxWidth:t,zIndex:900};return r.jsx("div",{style:m,"aria-label":"Bottom navigation",children:r.jsx(n.Z,{size:"small",variant:"outlined",bodyStyle:{padding:8,display:"grid",gridTemplateColumns:`repeat(${e.length}, minmax(0, 1fr))`,gap:4},style:{borderRadius:u?18:22,borderColor:o.colorBorderSecondary,background:"rgba(255, 255, 255, 0.92)",backdropFilter:"blur(12px)",boxShadow:o.boxShadowSecondary},children:e.map(e=>{let t=!!e.active,a=t?o.colorPrimary:o.colorTextSecondary,i=t?o.colorPrimary:o.colorTextSecondary,s=r.jsx("span",{style:{fontSize:22,lineHeight:1,color:a},children:e.icon}),n=e.badgeDot||(e.badgeCount??0)>0?r.jsx(l.Z,{dot:e.badgeDot,count:e.badgeCount,size:"small",children:s}):s;return(0,r.jsxs)(d.ZP,{type:"text",disabled:e.disabled,"aria-label":e.ariaLabel??e.label,"aria-current":t?"page":void 0,onClick:e.onClick,style:{height:u?64:68,paddingInline:0,borderRadius:16,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:4,background:t?o.colorPrimaryBg:"transparent"},children:[n,r.jsx(p,{style:{fontSize:11,fontWeight:t?600:500,color:i,lineHeight:1},children:e.label})]},e.key)})})})}},60920:(e,t,a)=>{"use strict";a.d(t,{Z:()=>y});var r=a(10326),o=a(77626),i=a.n(o),s=a(17577),n=a(66874),l=a(43359),d=a(75958),c=a(31916),p=a(71935),u=a(39655),m=a(99251),b=a(88295),f=a.n(b);let{Title:x,Text:h}=n.default;function y({open:e,onCancel:t,onSuccess:a}){let{currentShift:o,closeShift:n}=(0,u.S)(),[b,y]=(0,s.useState)(!1),[g]=l.Z.useForm(),k=async e=>{y(!0);try{await n(e.endAmount),t(),g.resetFields(),a&&a()}catch{}finally{y(!1)}};return(0,r.jsxs)(d.Z,{open:e,onCancel:t,title:null,centered:!0,footer:null,width:480,className:"soft-modal",styles:{body:{padding:0,borderRadius:24,overflow:"hidden",boxShadow:"0 20px 50px rgba(0,0,0,0.1)"},mask:{backdropFilter:"blur(5px)"}},children:[(0,r.jsxs)("div",{className:"jsx-513b4b5890b57a8a modal-header-close",children:[r.jsx("div",{className:"jsx-513b4b5890b57a8a icon-wrapper-close",children:r.jsx(m.Z,{style:{fontSize:32,color:"#ef4444"}})}),r.jsx(x,{level:3,style:{margin:0,color:"#1f1f1f",fontWeight:700},children:"ปิดรอบการขาย"}),r.jsx(h,{type:"secondary",style:{fontSize:16},children:"Close Shift"})]}),r.jsx("div",{style:{padding:"0 32px 32px 32px"},className:"jsx-513b4b5890b57a8a",children:o&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"jsx-513b4b5890b57a8a info-card",children:[(0,r.jsxs)("div",{className:"jsx-513b4b5890b57a8a info-row",children:[r.jsx(h,{type:"secondary",children:"เวลาเปิดกะ"}),r.jsx(h,{strong:!0,children:f()(o.open_time).format("DD/MM/YYYY HH:mm")})]}),r.jsx("div",{className:"jsx-513b4b5890b57a8a info-divider"}),(0,r.jsxs)("div",{className:"jsx-513b4b5890b57a8a info-row",children:[r.jsx(h,{type:"secondary",children:"เงินทอนเริ่มต้น"}),(0,r.jsxs)(h,{strong:!0,children:[Number(o.start_amount).toLocaleString()," บาท"]})]})]}),(0,r.jsxs)(l.Z,{form:g,layout:"vertical",onFinish:k,children:[r.jsx(l.Z.Item,{name:"endAmount",label:r.jsx("span",{style:{fontSize:16,fontWeight:500,color:"#4b5563"},className:"jsx-513b4b5890b57a8a",children:"ยอดเงินสดที่นับได้ (Cash Counted)"}),rules:[{required:!0,message:"กรุณาระบุจำนวนเงิน"}],children:r.jsx(c.Z,{style:{width:"100%",height:"80px",borderRadius:16,border:"2px solid #e5e7eb"},size:"large",min:0,precision:2,placeholder:"0.00",autoFocus:!0,controls:!1,inputMode:"decimal",className:"huge-input-close",formatter:e=>`${e}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:e=>e?.replace(/\$\s?|(,*)/g,""),onKeyDown:e=>{if([8,46,9,27,13,190,110].includes(e.keyCode)||!0===e.ctrlKey||!0===e.metaKey||e.keyCode>=35&&e.keyCode<=39){(190===e.keyCode||110===e.keyCode)&&e.currentTarget.value.includes(".")&&e.preventDefault();return}(e.shiftKey||e.keyCode<48||e.keyCode>57)&&(e.keyCode<96||e.keyCode>105)&&e.preventDefault()}})}),(0,r.jsxs)("div",{style:{display:"flex",gap:12,marginTop:24},className:"jsx-513b4b5890b57a8a flex gap-4",children:[r.jsx(p.ZP,{block:!0,size:"large",onClick:t,disabled:b,style:{height:56,borderRadius:16,fontSize:16,fontWeight:600,background:"#f3f4f6",border:"none",color:"#4b5563"},children:"ยกเลิก"}),r.jsx(p.ZP,{type:"primary",htmlType:"submit",block:!0,size:"large",loading:b,style:{height:56,borderRadius:16,fontSize:16,fontWeight:600,background:"#ef4444",border:"none",boxShadow:"0 4px 14px rgba(239, 68, 68, 0.4)"},children:"ยืนยันปิดกะ"})]})]})]})}),r.jsx(i(),{id:"513b4b5890b57a8a",children:".modal-header-close{background:-webkit-linear-gradient(top,#fef2f2 0%,#fff 100%);background:-moz-linear-gradient(top,#fef2f2 0%,#fff 100%);background:-o-linear-gradient(top,#fef2f2 0%,#fff 100%);background:linear-gradient(180deg,#fef2f2 0%,#fff 100%);padding:32px 24px 24px 24px;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-moz-box-orient:vertical;-moz-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;gap:8px;text-align:center}.icon-wrapper-close{width:64px;height:64px;background:#fee2e2;-webkit-border-radius:50%;-moz-border-radius:50%;border-radius:50%;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center;margin-bottom:8px;-webkit-box-shadow:0 4px 12px rgba(239,68,68,.15);-moz-box-shadow:0 4px 12px rgba(239,68,68,.15);box-shadow:0 4px 12px rgba(239,68,68,.15)}.info-card{background:#f8fafc;-webkit-border-radius:16px;-moz-border-radius:16px;border-radius:16px;padding:16px;margin-bottom:24px}.info-row{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-moz-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center}.info-divider{height:1px;background:#e2e8f0;margin:12px 0}.huge-input-close input{font-size:36px!important;font-weight:700!important;text-align:center!important;color:#ef4444!important;height:100%!important}.huge-input-close:focus-within{border-color:#ef4444!important;-webkit-box-shadow:0 0 0 4px rgba(239,68,68,.1)!important;-moz-box-shadow:0 0 0 4px rgba(239,68,68,.1)!important;box-shadow:0 0 0 4px rgba(239,68,68,.1)!important}"})]})}},60372:(e,t,a)=>{"use strict";a.d(t,{Z:()=>h});var r=a(10326),o=a(77626),i=a.n(o),s=a(17577),n=a(66874),l=a(43359),d=a(75958),c=a(31916),p=a(71935),u=a(39655),m=a(99251),b=a(35047);let{Title:f,Text:x}=n.default;function h({open:e,onCancel:t}={}){let{currentShift:a,loading:o,openShift:n}=(0,u.S)(),[h,y]=(0,s.useState)(!1),[g]=l.Z.useForm(),k=(0,b.usePathname)(),w=async e=>{y(!0);try{await n(e.startAmount)}catch{}finally{y(!1)}};return o?null:(0,r.jsxs)(d.Z,{open:void 0!==e?e:!o&&!a&&"/pos/shift"!==k,onCancel:t,title:null,centered:!0,closable:!1,maskClosable:!1,footer:null,width:400,className:"soft-modal",styles:{body:{padding:0,borderRadius:24,overflow:"hidden",boxShadow:"0 20px 50px rgba(0,0,0,0.1)"}},children:[(0,r.jsxs)("div",{className:"jsx-986e1bd238b3f1c5 modal-header",children:[r.jsx("div",{className:"jsx-986e1bd238b3f1c5 icon-wrapper",children:r.jsx(m.Z,{style:{fontSize:32,color:"#10b981"}})}),r.jsx(f,{level:3,style:{margin:0,color:"#1f1f1f",fontWeight:700},children:"เปิดรอบการขาย"}),r.jsx(x,{type:"secondary",style:{fontSize:16},children:"Open Shift"})]}),r.jsx("div",{style:{padding:"0 32px 32px 32px"},className:"jsx-986e1bd238b3f1c5",children:(0,r.jsxs)(l.Z,{form:g,layout:"vertical",onFinish:w,initialValues:{startAmount:0},children:[r.jsx(l.Z.Item,{name:"startAmount",label:r.jsx("span",{style:{fontSize:16,fontWeight:500,color:"#4b5563"},className:"jsx-986e1bd238b3f1c5",children:"ระบุเงินทอนเริ่มต้น (บาท)"}),rules:[{required:!0,message:"กรุณาระบุจำนวนเงิน"}],children:r.jsx(c.Z,{style:{width:"100%",height:"80px",borderRadius:16,border:"2px solid #e5e7eb"},size:"large",min:0,precision:2,placeholder:"0.00",autoFocus:!0,controls:!1,inputMode:"decimal",className:"huge-input",formatter:e=>`${e}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:e=>e?.replace(/\$\s?|(,*)/g,""),onKeyDown:e=>{if([8,46,9,27,13,190,110].includes(e.keyCode)||!0===e.ctrlKey||!0===e.metaKey||e.keyCode>=35&&e.keyCode<=39){(190===e.keyCode||110===e.keyCode)&&e.target.value?.includes(".")&&e.preventDefault();return}(e.shiftKey||e.keyCode<48||e.keyCode>57)&&(e.keyCode<96||e.keyCode>105)&&e.preventDefault()}})}),r.jsx(p.ZP,{type:"primary",htmlType:"submit",block:!0,size:"large",loading:h,style:{height:56,borderRadius:16,fontSize:18,fontWeight:600,background:"#10b981",boxShadow:"0 4px 14px rgba(16, 185, 129, 0.4)",border:"none",marginTop:16},children:"ยืนยันเปิดกะ"})]})}),r.jsx(i(),{id:"986e1bd238b3f1c5",children:".soft-modal .ant-modal-content{padding:0!important}.modal-header{background:-webkit-linear-gradient(top,#f0fdf4 0%,#fff 100%);background:-moz-linear-gradient(top,#f0fdf4 0%,#fff 100%);background:-o-linear-gradient(top,#f0fdf4 0%,#fff 100%);background:linear-gradient(180deg,#f0fdf4 0%,#fff 100%);padding:40px 24px 24px 24px;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-moz-box-orient:vertical;-moz-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;gap:8px;text-align:center}.icon-wrapper{width:72px;height:72px;background:#d1fae5;-webkit-border-radius:50%;-moz-border-radius:50%;border-radius:50%;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center;margin-bottom:8px;-webkit-box-shadow:0 4px 12px rgba(16,185,129,.15);-moz-box-shadow:0 4px 12px rgba(16,185,129,.15);box-shadow:0 4px 12px rgba(16,185,129,.15)}.huge-input input{font-size:36px!important;font-weight:700!important;text-align:center!important;color:#10b981!important;height:100%!important}.huge-input:focus-within{border-color:#10b981!important;-webkit-box-shadow:0 0 0 4px rgba(16,185,129,.1)!important;-moz-box-shadow:0 0 0 4px rgba(16,185,129,.1)!important;box-shadow:0 0 0 4px rgba(16,185,129,.1)!important}"})]})}},63196:(e,t,a)=>{"use strict";a.d(t,{Z:()=>n,j:()=>l});var r=a(10326),o=a(17577),i=a.n(o);let s=(0,o.createContext)(void 0),n=({children:e})=>{let[t,a]=(0,o.useState)([]),[n,l]=(0,o.useState)("DINE_IN"),[d,c]=(0,o.useState)(null),[p,u]=(0,o.useState)(null),[m,b]=(0,o.useState)(null),[f,x]=(0,o.useState)(null),[h,y]=(0,o.useState)(!1);i().useEffect(()=>{let e=localStorage.getItem("pos_cart_items"),t=localStorage.getItem("pos_order_mode"),r=localStorage.getItem("pos_ref_id"),o=localStorage.getItem("pos_ref_code"),i=localStorage.getItem("pos_discount"),s=localStorage.getItem("pos_payment");if(e)try{let t=JSON.parse(e).map((e,t)=>({...e,cart_item_id:e.cart_item_id||`item-${Date.now()}-${t}-${Math.random().toString(36).substr(2,9)}`}));a(t)}catch(e){console.error("Failed to parse cart:",e),a([])}t&&l(t),r&&c(r),o&&u(o),i&&b(JSON.parse(i)),s&&x(JSON.parse(s)),y(!0)},[]),i().useEffect(()=>{h&&(localStorage.setItem("pos_cart_items",JSON.stringify(t)),localStorage.setItem("pos_order_mode",n),d?localStorage.setItem("pos_ref_id",d):localStorage.removeItem("pos_ref_id"),p?localStorage.setItem("pos_ref_code",p):localStorage.removeItem("pos_ref_code"),m?localStorage.setItem("pos_discount",JSON.stringify(m)):localStorage.removeItem("pos_discount"),f?localStorage.setItem("pos_payment",JSON.stringify(f)):localStorage.removeItem("pos_payment"))},[t,n,d,p,m,f,h]);let g=e=>{a(t=>t.filter(t=>t.cart_item_id!==e))},k=()=>t.reduce((e,t)=>e+(("DELIVERY"===n?Number(t.product.price_delivery??t.product.price):Number(t.product.price))+(t.details||[]).reduce((e,t)=>e+Number(t.extra_price),0))*t.quantity,0),w=()=>{let e=k();return m?"Percentage"===m.discount_type?e*m.discount_amount/100:Math.min(m.discount_amount,e):0};return r.jsx(s.Provider,{value:{cartItems:t,addToCart:(e,t=1,r)=>{let o=`item-${Date.now()}-${Math.random().toString(36).slice(2,10)}`;return a(a=>[...a,{cart_item_id:o,product:e,quantity:t,notes:r,details:[]}]),o},removeFromCart:g,updateQuantity:(e,t)=>{if(t<=0){g(e);return}a(a=>a.map(a=>a.cart_item_id===e?{...a,quantity:t}:a))},updateItemNote:(e,t)=>{a(a=>a.map(a=>a.cart_item_id===e?{...a,notes:t}:a))},clearCart:()=>{a([]),b(null),x(null),c(null),u(null)},addDetailToItem:(e,t)=>{a(a=>a.map(a=>a.cart_item_id===e?{...a,details:[...a.details||[],t]}:a))},removeDetailFromItem:(e,t)=>{a(a=>a.map(a=>a.cart_item_id===e?{...a,details:(a.details||[]).filter((e,a)=>a!==t)}:a))},updateItemDetails:(e,t)=>{a(a=>a.map(a=>a.cart_item_id===e?{...a,details:t}:a))},orderMode:n,setOrderMode:l,referenceId:d,setReferenceId:c,referenceCode:p,setReferenceCode:u,selectedDiscount:m,setSelectedDiscount:b,selectedPaymentMethod:f,setSelectedPaymentMethod:x,getTotalItems:()=>t.reduce((e,t)=>e+t.quantity,0),getSubtotal:k,getDiscountAmount:w,getFinalPrice:()=>Math.max(0,k()-w())},children:e})},l=()=>{let e=(0,o.useContext)(s);if(void 0===e)throw Error("useCart must be used within a CartProvider");return e}},39655:(e,t,a)=>{"use strict";a.d(t,{S:()=>c,r:()=>d});var r=a(10326),o=a(17577),i=a(94001),s=a(94658),n=a(46752);let l=(0,o.createContext)(void 0),d=({children:e})=>{let{user:t}=(0,i.a)(),[a,d]=(0,o.useState)(null),[c,p]=(0,o.useState)(!0),u=(0,o.useCallback)(async()=>{if(t)try{let e=await s.t.getCurrentShift();d(e)}catch(e){console.error("Error fetching shift:",e)}finally{p(!1)}},[t]);(0,o.useEffect)(()=>{u()},[u]);let m=async e=>{if(t)try{let t=await s.t.openShift(e);d(t),n.ZP.success("เปิดกะเรียบร้อยแล้ว")}catch(e){throw n.ZP.error(e instanceof Error?e.message:"เปิดกะไม่สำเร็จ"),e}},b=async e=>{if(t)try{await s.t.closeShift(e),d(null),n.ZP.success("ปิดกะเรียบร้อยแล้ว")}catch(e){throw n.ZP.error(e instanceof Error?e.message:"ปิดกะไม่สำเร็จ"),e}};return r.jsx(l.Provider,{value:{currentShift:a,loading:c,openShift:m,closeShift:b,refreshShift:u},children:e})},c=()=>{let e=(0,o.useContext)(l);if(!e)throw Error("useShift must be used within a ShiftProvider");return e}},67355:(e,t,a)=>{"use strict";a.d(t,{L:()=>o});var r=a(17577);function o(){let[e,t]=(0,r.useState)("undefined"==typeof navigator||navigator.onLine);return e}},83476:(e,t,a)=>{"use strict";a.d(t,{U:()=>n});var r=a(12529),o=a(40577);let i="/pos/payments",s=(e,t="application/json")=>{let a={};return t&&(a["Content-Type"]=t),e&&(a.Cookie=e),a},n={getAll:async e=>{let t=(0,r.b)("GET",i),a=s(e,""),n=await fetch(t,{cache:"no-store",headers:a});if(!n.ok){let e=await n.json().catch(()=>({}));throw Error((0,o.i_)(e,"ไม่สามารถดึงข้อมูลการชำระเงินได้"))}return(0,o.hH)(await n.json())},getById:async(e,t)=>{let a=(0,r.b)("GET",`${i}/${e}`),n=s(t,""),l=await fetch(a,{cache:"no-store",headers:n});if(!l.ok){let e=await l.json().catch(()=>({}));throw Error((0,o.i_)(e,"ไม่สามารถดึงข้อมูลการชำระเงินได้"))}return(0,o.hH)(await l.json())},create:async(e,t,a)=>{let n=(0,r.b)("POST",`${i}`),l=s(t);a&&(l["X-CSRF-Token"]=a);let d=await fetch(n,{method:"POST",headers:l,credentials:"include",body:JSON.stringify(e)});if(!d.ok){let e=await d.json().catch(()=>({}));throw Error((0,o.i_)(e,"ไม่สามารถสร้างรายการชำระเงินได้"))}return(0,o.hH)(await d.json())},update:async(e,t,a,n)=>{let l=(0,r.b)("PUT",`${i}/${e}`),d=s(a);n&&(d["X-CSRF-Token"]=n);let c=await fetch(l,{method:"PUT",headers:d,credentials:"include",body:JSON.stringify(t)});if(!c.ok){let e=await c.json().catch(()=>({}));throw Error((0,o.i_)(e,"ไม่สามารถแก้ไขรายการชำระเงินได้"))}return(0,o.hH)(await c.json())},delete:async(e,t,a)=>{let n=(0,r.b)("DELETE",`${i}/${e}`),l=s(t,"");a&&(l["X-CSRF-Token"]=a);let d=await fetch(n,{method:"DELETE",headers:l,credentials:"include"});if(!d.ok){let e=await d.json().catch(()=>({}));throw Error((0,o.i_)(e,"ไม่สามารถลบรายการชำระเงินได้"))}}}},94658:(e,t,a)=>{"use strict";a.d(t,{t:()=>i});var r=a(33357),o=a(40577);let i={getCurrentShift:async()=>{let e=await fetch("/api/pos/shifts/current",{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"});if(404===e.status)return null;if(!e.ok)throw Error("Failed to fetch current shift");return(0,o.hH)(await e.json())},openShift:async e=>{let t=await (0,r.P)(),a=await fetch("/api/pos/shifts/open",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":t},credentials:"include",body:JSON.stringify({start_amount:e})});if(!a.ok){let e=await a.json().catch(()=>({}));throw Error(e?.error?.message||e.message||"Failed to open shift")}return(0,o.hH)(await a.json())},closeShift:async e=>{let t=await (0,r.P)(),a=await fetch("/api/pos/shifts/close",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":t},credentials:"include",body:JSON.stringify({end_amount:e})});if(!a.ok){let e=await a.json().catch(()=>({}));throw Error(e?.error?.message||e.message||"Failed to close shift")}return(0,o.hH)(await a.json())},getCurrentSummary:async()=>{let e=await fetch("/api/pos/shifts/current/summary",{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"});if(!e.ok)throw Error("Failed to fetch shift summary");return(0,o.hH)(await e.json())},getSummary:async e=>{let t=await fetch(`/api/pos/shifts/summary/${e}`,{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"});if(!t.ok)throw Error("Failed to fetch shift summary");return(0,o.hH)(await t.json())}}},83179:(e,t,a)=>{"use strict";a.d(t,{b:()=>r,g:()=>o});let r={system:{announcement:"system:announcement"},users:{create:"users:create",update:"users:update",delete:"users:delete",status:"users:update-status"},roles:{create:"roles:create",update:"roles:update",delete:"roles:delete"},branches:{create:"branches:create",update:"branches:update",delete:"branches:delete"},products:{create:"products:create",update:"products:update",delete:"products:delete"},productsUnit:{create:"productsUnit:create",update:"productsUnit:update",delete:"productsUnit:delete"},categories:{create:"category:create",update:"category:update",delete:"category:delete"},tables:{create:"tables:create",update:"tables:update",delete:"tables:delete"},orders:{create:"orders:create",update:"orders:update",delete:"orders:delete"},payments:{create:"payments:create",update:"payments:update",delete:"payments:delete"},discounts:{create:"discounts:create",update:"discounts:update",delete:"discounts:delete"},delivery:{create:"delivery:create",update:"delivery:update",delete:"delivery:delete"},shifts:{update:"shifts:update"},orderQueue:{added:"order-queue:added",updated:"order-queue:updated",removed:"order-queue:removed",reordered:"order-queue:reordered"},ingredients:{create:"ingredients:create",update:"ingredients:update",delete:"ingredients:delete"},ingredientsUnit:{create:"ingredientsUnit:create",update:"ingredientsUnit:update",delete:"ingredientsUnit:delete"},stock:{update:"stock:update"},stockOrders:{create:"stock:orders:create",update:"stock:orders:update",status:"stock:orders:status",delete:"stock:orders:delete",detailUpdate:"stock:orders:detail:update"},paymentAccounts:{create:"payment-accounts:create",update:"payment-accounts:update",delete:"payment-accounts:delete"},paymentMethods:{create:"paymentMethod:create",update:"paymentMethod:update",delete:"paymentMethod:delete"},shopProfile:{update:"shopProfile:update"},salesOrderItem:{create:"salesOrderItem:create",update:"salesOrderItem:update",delete:"salesOrderItem:delete"},salesOrderDetail:{create:"salesOrderDetail:create",update:"salesOrderDetail:update",delete:"salesOrderDetail:delete"}},o={stockOrdersUpdated:"orders_updated"}},85429:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>r});let r=(0,a(68570).createProxy)(String.raw`E:\Project\Order-Project-Frontend\src\app\(main)\pos\layout.tsx#default`)}};