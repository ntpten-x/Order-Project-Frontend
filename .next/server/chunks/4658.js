exports.id=4658,exports.ids=[4658],exports.modules={58679:(e,t,a)=>{Promise.resolve().then(a.bind(a,44776))},44776:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>O});var r=a(10326),o=a(17577),s=a(63196),i=a(39655),n=a(35047),l=a(67329),c=a(62938),d=a(73330),p=a(10907),u=a(47885),m=a(27266),f=a(71696),h=a(95762),x=a(11397),b=a(91377),y=a(48230),g=a(35189),w=a(11401),S=a(94001);let j=(0,a(23473).default)(async()=>{},{loadableGenerated:{modules:["components\\pos\\POSBottomNavigation.tsx -> ./shifts/CloseShiftModal"]},ssr:!1}),k=()=>{let e=(0,n.useRouter)(),t=(0,n.usePathname)(),{user:a}=(0,S.a)(),{currentShift:s}=(0,i.S)(),[k,v]=(0,o.useState)(!1),[_,E]=(0,o.useState)(!1),C=(0,o.useRef)(null);(0,o.useEffect)(()=>{let e=e=>{C.current&&!C.current.contains(e.target)&&E(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);let T=(0,o.useMemo)(()=>[{key:"home",label:"หน้าแรก",icon:l.Z,path:"/"},{key:"pos",label:"ขาย",icon:c.Z,path:"/pos"},{key:"orders",label:"ออเดอร์",icon:d.Z,path:"/pos/orders"},{key:"dashboard",label:"สรุป",icon:p.Z,path:"/pos/dashboard"}],[]),N=(0,o.useMemo)(()=>{let e=[{key:"kitchen",label:"ครัว",icon:u.Z,path:"/pos/kitchen"},{key:"tables",label:"โต๊ะ",icon:m.Z,path:"/pos/tables"},{key:"delivery",label:"เดลิเวอรี่",icon:f.Z,path:"/pos/delivery"}];return a?.role==="Admin"&&e.push({key:"discounts",label:"ส่วนลด",icon:h.Z,path:"/pos/discounts"},{key:"payment",label:"ชำระเงิน",icon:x.Z,path:"/pos/paymentMethod"},{key:"settings",label:"ตั้งค่า",icon:b.Z,path:"/pos/settings"}),e},[a?.role]),P=e=>"/"===e?"/"===t:"/pos"===e?"/pos"===t||t.startsWith("/pos/channels"):t===e||t.startsWith(e+"/"),Z=N.some(e=>P(e.path)),I=t=>{e.push(t),E(!1)};return(0,r.jsxs)(r.Fragment,{children:[r.jsx("div",{className:"fixed z-[1000] bottom-5 left-1/2 -translate-x-1/2 w-[calc(100%-20px)] max-w-[420px]",children:(0,r.jsxs)("div",{className:"flex justify-between items-center h-[80px] px-3 bg-[#0f172a]/95 backdrop-blur-xl shadow-[0_25px_50px_-12px_rgba(0,0,0,0.5)] border border-white/10 rounded-[32px]",style:{transition:"all 0.3s cubic-bezier(0.23, 1, 0.32, 1)"},children:[T.map(e=>{let t=P(e.path),a=e.icon;return(0,r.jsxs)("button",{onClick:()=>I(e.path),className:"flex flex-col items-center justify-center flex-1 h-full bg-transparent border-none cursor-pointer relative group",children:[r.jsx("div",{className:`
                    flex items-center justify-center w-[48px] h-[48px] rounded-[16px] mb-1
                    transition-all duration-300 ease-[cubic-bezier(0.23,1,0.32,1)]
                    ${t?"bg-emerald-500/20 -translate-y-1 scale-105":"bg-transparent"}
                    group-active:scale-90
                  `,children:r.jsx(a,{style:{fontSize:24,color:t?"#34d399":"#94a3b8",filter:t?"drop-shadow(0 0 10px rgba(52, 211, 153, 0.4))":"none",transition:"all 0.3s ease"}})}),r.jsx("span",{className:`text-[10px] font-bold transition-all duration-300 ${t?"text-[#34d399]":"text-[#94a3b8] opacity-60"}`,children:e.label})]},e.key)}),(0,r.jsxs)("div",{ref:C,className:"relative flex-1 h-full flex items-center justify-center",children:[(0,r.jsxs)("button",{onClick:()=>E(!_),className:"flex flex-col items-center justify-center h-full bg-transparent border-none cursor-pointer relative group",children:[r.jsx("div",{className:`
                  flex items-center justify-center w-[48px] h-[48px] rounded-[16px] mb-1
                  transition-all duration-300 ease-[cubic-bezier(0.23,1,0.32,1)]
                  ${_||Z?"bg-amber-500/20 -translate-y-1 scale-105":"bg-transparent"}
                  group-active:scale-90
                `,children:r.jsx(y.Z,{style:{fontSize:24,color:_||Z?"#fbbf24":"#94a3b8",filter:_||Z?"drop-shadow(0 0 10px rgba(251, 191, 36, 0.4))":"none",transition:"all 0.3s ease"}})}),r.jsx("span",{className:`text-[10px] font-bold transition-all duration-300 ${_||Z?"text-[#fbbf24]":"text-[#94a3b8] opacity-60"}`,children:"เพิ่มเติม"})]}),_&&(0,r.jsxs)("div",{className:"absolute bottom-full mb-3 right-0 w-[180px] bg-[#0f172a]/90 backdrop-blur-xl rounded-[20px] border border-white/15 shadow-[0_20px_40px_-10px_rgba(0,0,0,0.7)] overflow-hidden animate-in fade-in slide-in-from-bottom-2 duration-200",children:[N.map((e,t)=>{let a=P(e.path),o=e.icon;return(0,r.jsxs)("button",{onClick:()=>I(e.path),className:`
                        flex items-center gap-3 w-full px-4 py-3 border-none cursor-pointer transition-all duration-200
                        ${a?"bg-emerald-500/15 text-emerald-400":"bg-transparent text-slate-300 hover:bg-white/5"}
                        ${t!==N.length-1?"border-b border-white/5":""}
                      `,children:[r.jsx(o,{style:{fontSize:18,color:a?"#34d399":"#94a3b8"}}),r.jsx("span",{className:"text-[13px] font-medium",children:e.label})]},e.key)}),s&&(0,r.jsxs)("button",{onClick:()=>{v(!0),E(!1)},className:"flex items-center gap-3 w-full px-4 py-3 border-t border-white/10 bg-red-500/10 hover:bg-red-500/20 transition-all",children:[r.jsx(w.Z,{dot:!0,status:"processing",color:"#ef4444",children:r.jsx(g.Z,{style:{fontSize:18,color:"#ef4444"}})}),r.jsx("span",{className:"text-[13px] font-bold text-red-400",children:"ปิดกะ"})]})]})]})]})}),r.jsx(j,{open:k,onCancel:()=>v(!1)})]})};var v=a(46752),_=a(57473),E=a(67355),C=a(3548),T=a(26859),N=a(83476),P=a(52249),Z=a(81456),I=a(45839);let z=e=>new Promise(t=>setTimeout(t,e)),$=()=>{let e=(0,E.L)(),[t,a]=(0,o.useState)(!1),s=(0,o.useCallback)(async()=>{if(t||0===C.x.getQueue().length)return;a(!0);let e=v.ZP.loading("กำลังซิงค์รายการที่ค้างอยู่...",0),r=0,o=0;C.x.pruneExceeded();let s=C.x.getQueue();try{let e=await Z.O.getCsrfToken();for(let t of s)try{let a=C.M.backoff(t.retryCount);if(a>0&&await z(a),"CREATE_ORDER"===t.type)await T.x.create(t.payload,void 0,e);else if("UPDATE_ORDER"===t.type){let{orderId:a,data:r}=t.payload;await T.x.update(a,r,void 0,e)}else if("ADD_ITEM"===t.type){let{orderId:a,itemData:r}=t.payload;await T.x.addItem(a,r,void 0,e)}else if("UPDATE_ITEM"===t.type){let{itemId:a,itemData:r}=t.payload;await T.x.updateItem(a,r,void 0,e)}else if("DELETE_ITEM"===t.type){let{itemId:a}=t.payload;await T.x.deleteItem(a,void 0,e)}else if("PAYMENT"===t.type){let{orderId:a,paymentData:r}=t.payload;await N.U.create({...r,order_id:a},void 0,e)}else if("UPDATE_QUEUE_STATUS"===t.type){let{queueId:e,status:a}=t.payload;await P.e.updateStatus(e,{status:a},void 0)}C.x.removeFromQueue(t.id),r++}catch(e){if(t.retryCount+1>C.M.maxRetry)C.x.removeFromQueue(t.id),o++;else{let a=e instanceof Error?e.message:void 0;C.x.incrementRetry(t.id,a)}}}finally{e(),a(!1),r>0&&v.ZP.success(`ซิงค์สำเร็จ ${r} รายการ`),o>0&&_.ZP.error({message:"ซิงค์บางรายการไม่สำเร็จ",description:`${o} รายการเกินจำนวน retry ที่กำหนด`,placement:"bottomRight",duration:3})}},[t]);return(0,o.useEffect)(()=>{e?s():_.ZP.warning({message:"ออฟไลน์",description:"รายการจะถูกเก็บเข้าคิวและซิงค์ให้อัตโนมัติเมื่อออนไลน์",icon:r.jsx(I.Z,{style:{color:"#faad14"}}),duration:2,placement:"bottomRight"})},[e,s]),null};var F=a(60372);function O({children:e}){return(0,r.jsxs)(i.r,{children:[r.jsx($,{}),r.jsx(F.Z,{}),(0,r.jsxs)(s.Z,{children:[e,r.jsx(k,{})]})]})}},60372:(e,t,a)=>{"use strict";a.d(t,{Z:()=>b});var r=a(10326),o=a(77626),s=a.n(o),i=a(17577),n=a(58184),l=a(43359),c=a(75958),d=a(31916),p=a(71935),u=a(39655),m=a(99251),f=a(35047);let{Title:h,Text:x}=n.default;function b({open:e,onCancel:t}={}){let{currentShift:a,loading:o,openShift:n}=(0,u.S)(),[b,y]=(0,i.useState)(!1),[g]=l.Z.useForm(),w=(0,f.usePathname)(),S=async e=>{y(!0);try{await n(e.startAmount)}catch{}finally{y(!1)}};return o?null:(0,r.jsxs)(c.Z,{open:void 0!==e?e:!o&&!a&&"/pos/shift"!==w,onCancel:t,title:null,centered:!0,closable:!1,maskClosable:!1,footer:null,width:400,className:"soft-modal",styles:{body:{padding:0,borderRadius:24,overflow:"hidden",boxShadow:"0 20px 50px rgba(0,0,0,0.1)"}},children:[(0,r.jsxs)("div",{className:"jsx-986e1bd238b3f1c5 modal-header",children:[r.jsx("div",{className:"jsx-986e1bd238b3f1c5 icon-wrapper",children:r.jsx(m.Z,{style:{fontSize:32,color:"#10b981"}})}),r.jsx(h,{level:3,style:{margin:0,color:"#1f1f1f",fontWeight:700},children:"เปิดรอบการขาย"}),r.jsx(x,{type:"secondary",style:{fontSize:16},children:"Open Shift"})]}),r.jsx("div",{style:{padding:"0 32px 32px 32px"},className:"jsx-986e1bd238b3f1c5",children:(0,r.jsxs)(l.Z,{form:g,layout:"vertical",onFinish:S,initialValues:{startAmount:0},children:[r.jsx(l.Z.Item,{name:"startAmount",label:r.jsx("span",{style:{fontSize:16,fontWeight:500,color:"#4b5563"},className:"jsx-986e1bd238b3f1c5",children:"ระบุเงินทอนเริ่มต้น (บาท)"}),rules:[{required:!0,message:"กรุณาระบุจำนวนเงิน"}],children:r.jsx(d.Z,{style:{width:"100%",height:"80px",borderRadius:16,border:"2px solid #e5e7eb"},size:"large",min:0,precision:2,placeholder:"0.00",autoFocus:!0,controls:!1,inputMode:"decimal",className:"huge-input",formatter:e=>`${e}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:e=>e?.replace(/\$\s?|(,*)/g,""),onKeyDown:e=>{if([8,46,9,27,13,190,110].includes(e.keyCode)||!0===e.ctrlKey||!0===e.metaKey||e.keyCode>=35&&e.keyCode<=39){(190===e.keyCode||110===e.keyCode)&&e.target.value?.includes(".")&&e.preventDefault();return}(e.shiftKey||e.keyCode<48||e.keyCode>57)&&(e.keyCode<96||e.keyCode>105)&&e.preventDefault()}})}),r.jsx(p.ZP,{type:"primary",htmlType:"submit",block:!0,size:"large",loading:b,style:{height:56,borderRadius:16,fontSize:18,fontWeight:600,background:"#10b981",boxShadow:"0 4px 14px rgba(16, 185, 129, 0.4)",border:"none",marginTop:16},children:"ยืนยันเปิดกะ"})]})}),r.jsx(s(),{id:"986e1bd238b3f1c5",children:".soft-modal .ant-modal-content{padding:0!important}.modal-header{background:-webkit-linear-gradient(top,#f0fdf4 0%,#fff 100%);background:-moz-linear-gradient(top,#f0fdf4 0%,#fff 100%);background:-o-linear-gradient(top,#f0fdf4 0%,#fff 100%);background:linear-gradient(180deg,#f0fdf4 0%,#fff 100%);padding:40px 24px 24px 24px;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-moz-box-orient:vertical;-moz-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;gap:8px;text-align:center}.icon-wrapper{width:72px;height:72px;background:#d1fae5;-webkit-border-radius:50%;-moz-border-radius:50%;border-radius:50%;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center;margin-bottom:8px;-webkit-box-shadow:0 4px 12px rgba(16,185,129,.15);-moz-box-shadow:0 4px 12px rgba(16,185,129,.15);box-shadow:0 4px 12px rgba(16,185,129,.15)}.huge-input input{font-size:36px!important;font-weight:700!important;text-align:center!important;color:#10b981!important;height:100%!important}.huge-input:focus-within{border-color:#10b981!important;-webkit-box-shadow:0 0 0 4px rgba(16,185,129,.1)!important;-moz-box-shadow:0 0 0 4px rgba(16,185,129,.1)!important;box-shadow:0 0 0 4px rgba(16,185,129,.1)!important}"})]})}},63196:(e,t,a)=>{"use strict";a.d(t,{Z:()=>n,j:()=>l});var r=a(10326),o=a(17577),s=a.n(o);let i=(0,o.createContext)(void 0),n=({children:e})=>{let[t,a]=(0,o.useState)([]),[n,l]=(0,o.useState)("DINE_IN"),[c,d]=(0,o.useState)(null),[p,u]=(0,o.useState)(null),[m,f]=(0,o.useState)(null),[h,x]=(0,o.useState)(null),[b,y]=(0,o.useState)(!1);s().useEffect(()=>{let e=localStorage.getItem("pos_cart_items"),t=localStorage.getItem("pos_order_mode"),r=localStorage.getItem("pos_ref_id"),o=localStorage.getItem("pos_ref_code"),s=localStorage.getItem("pos_discount"),i=localStorage.getItem("pos_payment");if(e)try{let t=JSON.parse(e).map((e,t)=>({...e,cart_item_id:e.cart_item_id||`item-${Date.now()}-${t}-${Math.random().toString(36).substr(2,9)}`}));a(t)}catch(e){console.error("Failed to parse cart:",e),a([])}t&&l(t),r&&d(r),o&&u(o),s&&f(JSON.parse(s)),i&&x(JSON.parse(i)),y(!0)},[]),s().useEffect(()=>{b&&(localStorage.setItem("pos_cart_items",JSON.stringify(t)),localStorage.setItem("pos_order_mode",n),c?localStorage.setItem("pos_ref_id",c):localStorage.removeItem("pos_ref_id"),p?localStorage.setItem("pos_ref_code",p):localStorage.removeItem("pos_ref_code"),m?localStorage.setItem("pos_discount",JSON.stringify(m)):localStorage.removeItem("pos_discount"),h?localStorage.setItem("pos_payment",JSON.stringify(h)):localStorage.removeItem("pos_payment"))},[t,n,c,p,m,h,b]);let g=e=>{a(t=>t.filter(t=>t.cart_item_id!==e))},w=()=>t.reduce((e,t)=>e+(Number(t.product.price)+(t.details||[]).reduce((e,t)=>e+Number(t.extra_price),0))*t.quantity,0),S=()=>{let e=w();return m?"Percentage"===m.discount_type?e*m.discount_amount/100:Math.min(m.discount_amount,e):0};return r.jsx(i.Provider,{value:{cartItems:t,addToCart:(e,t=1,r)=>{a(a=>{let o={cart_item_id:`item-${Date.now()}-${a.length}-${Math.random().toString(36).substr(2,9)}`,product:e,quantity:t,notes:r,details:[]};return[...a,o]})},removeFromCart:g,updateQuantity:(e,t)=>{if(t<=0){g(e);return}a(a=>a.map(a=>a.cart_item_id===e?{...a,quantity:t}:a))},updateItemNote:(e,t)=>{a(a=>a.map(a=>a.cart_item_id===e?{...a,notes:t}:a))},clearCart:()=>{a([]),f(null),x(null),d(null),u(null)},addDetailToItem:(e,t)=>{a(a=>a.map(a=>a.cart_item_id===e?{...a,details:[...a.details||[],t]}:a))},removeDetailFromItem:(e,t)=>{a(a=>a.map(a=>a.cart_item_id===e?{...a,details:(a.details||[]).filter((e,a)=>a!==t)}:a))},updateItemDetails:(e,t)=>{a(a=>a.map(a=>a.cart_item_id===e?{...a,details:t}:a))},orderMode:n,setOrderMode:l,referenceId:c,setReferenceId:d,referenceCode:p,setReferenceCode:u,selectedDiscount:m,setSelectedDiscount:f,selectedPaymentMethod:h,setSelectedPaymentMethod:x,getTotalItems:()=>t.reduce((e,t)=>e+t.quantity,0),getSubtotal:w,getDiscountAmount:S,getFinalPrice:()=>Math.max(0,w()-S())},children:e})},l=()=>{let e=(0,o.useContext)(i);if(void 0===e)throw Error("useCart must be used within a CartProvider");return e}},39655:(e,t,a)=>{"use strict";a.d(t,{S:()=>d,r:()=>c});var r=a(10326),o=a(17577),s=a(94001),i=a(94658),n=a(46752);let l=(0,o.createContext)(void 0),c=({children:e})=>{let{user:t}=(0,s.a)(),[a,c]=(0,o.useState)(null),[d,p]=(0,o.useState)(!0),u=(0,o.useCallback)(async()=>{if(t)try{let e=await i.t.getCurrentShift();c(e)}catch(e){console.error("Error fetching shift:",e)}finally{p(!1)}},[t]);(0,o.useEffect)(()=>{u()},[u]);let m=async e=>{if(t)try{let t=await i.t.openShift(e);c(t),n.ZP.success("เปิดกะเรียบร้อยแล้ว")}catch(e){throw n.ZP.error(e instanceof Error?e.message:"เปิดกะไม่สำเร็จ"),e}},f=async e=>{if(t)try{await i.t.closeShift(e),c(null),n.ZP.success("ปิดกะเรียบร้อยแล้ว")}catch(e){throw n.ZP.error(e instanceof Error?e.message:"ปิดกะไม่สำเร็จ"),e}};return r.jsx(l.Provider,{value:{currentShift:a,loading:d,openShift:m,closeShift:f,refreshShift:u},children:e})},d=()=>{let e=(0,o.useContext)(l);if(!e)throw Error("useShift must be used within a ShiftProvider");return e}},67355:(e,t,a)=>{"use strict";a.d(t,{L:()=>o});var r=a(17577);function o(){let[e,t]=(0,r.useState)("undefined"==typeof navigator||navigator.onLine);return e}},83476:(e,t,a)=>{"use strict";a.d(t,{U:()=>i});var r=a(12529);let o="/pos/payments",s=(e,t="application/json")=>{let a={};return t&&(a["Content-Type"]=t),e&&(a.Cookie=e),a},i={getAll:async e=>{let t=(0,r.b)("GET",o),a=s(e,""),i=await fetch(t,{cache:"no-store",headers:a});if(!i.ok){let e=await i.json().catch(()=>({}));throw Error(e.error||e.message||"ไม่สามารถดึงข้อมูลการชำระเงินได้")}return i.json()},getById:async(e,t)=>{let a=(0,r.b)("GET",`${o}/${e}`),i=s(t,""),n=await fetch(a,{cache:"no-store",headers:i});if(!n.ok){let e=await n.json().catch(()=>({}));throw Error(e.error||e.message||"ไม่สามารถดึงข้อมูลการชำระเงินได้")}return n.json()},create:async(e,t,a)=>{let i=(0,r.b)("POST",`${o}`),n=s(t);a&&(n["X-CSRF-Token"]=a);let l=await fetch(i,{method:"POST",headers:n,credentials:"include",body:JSON.stringify(e)});if(!l.ok){let e=await l.json().catch(()=>({}));throw Error(e.error||e.message||"ไม่สามารถสร้างรายการชำระเงินได้")}return l.json()},update:async(e,t,a,i)=>{let n=(0,r.b)("PUT",`${o}/${e}`),l=s(a);i&&(l["X-CSRF-Token"]=i);let c=await fetch(n,{method:"PUT",headers:l,credentials:"include",body:JSON.stringify(t)});if(!c.ok){let e=await c.json().catch(()=>({}));throw Error(e.error||e.message||"ไม่สามารถแก้ไขรายการชำระเงินได้")}return c.json()},delete:async(e,t,a)=>{let i=(0,r.b)("DELETE",`${o}/${e}`),n=s(t,"");a&&(n["X-CSRF-Token"]=a);let l=await fetch(i,{method:"DELETE",headers:n,credentials:"include"});if(!l.ok){let e=await l.json().catch(()=>({}));throw Error(e.error||e.message||"ไม่สามารถลบรายการชำระเงินได้")}}}},94658:(e,t,a)=>{"use strict";a.d(t,{t:()=>o});var r=a(33357);let o={getCurrentShift:async()=>{let e=await fetch("/api/pos/shifts/current",{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"});if(404===e.status)return null;if(!e.ok)throw Error("Failed to fetch current shift");return e.json()},openShift:async e=>{let t=await (0,r.P)(),a=await fetch("/api/pos/shifts/open",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":t},credentials:"include",body:JSON.stringify({start_amount:e})});if(!a.ok)throw Error((await a.json().catch(()=>({}))).message||"Failed to open shift");return a.json()},closeShift:async e=>{let t=await (0,r.P)(),a=await fetch("/api/pos/shifts/close",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":t},credentials:"include",body:JSON.stringify({end_amount:e})});if(!a.ok)throw Error((await a.json().catch(()=>({}))).message||"Failed to close shift");return a.json()},getCurrentSummary:async()=>{let e=await fetch("/api/pos/shifts/current/summary",{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"});if(!e.ok)throw Error("Failed to fetch shift summary");return e.json()},getSummary:async e=>{let t=await fetch(`/api/pos/shifts/summary/${e}`,{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"});if(!t.ok)throw Error("Failed to fetch shift summary");return t.json()}}},85429:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>r});let r=(0,a(68570).createProxy)(String.raw`E:\Project\Order-Project-Frontend\src\app\(main)\pos\layout.tsx#default`)}};