"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdate_N_E"]("src/middleware",{

/***/ "(middleware)/./src/middleware.ts":
/*!***************************!*\
  !*** ./src/middleware.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   middleware: () => (/* binding */ middleware)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(middleware)/./node_modules/next/dist/esm/api/server.js\");\n\nconst BACKEND_API = \"http://localhost:3000\" || 0;\nasync function verifySession(request) {\n    const cookie = request.headers.get(\"cookie\") || \"\";\n    try {\n        const res = await fetch(`${BACKEND_API}/auth/me`, {\n            method: \"GET\",\n            headers: {\n                cookie,\n                \"content-type\": \"application/json\"\n            },\n            cache: \"no-store\"\n        });\n        if (!res.ok) return null;\n        const data = await res.json().catch(()=>null);\n        return data?.data || data || null;\n    } catch  {\n        return null;\n    }\n}\nasync function middleware(request) {\n    const { pathname } = request.nextUrl;\n    const publicPaths = [\n        \"/login\",\n        \"/register\",\n        \"/_next\",\n        \"/static\",\n        \"/favicon.ico\",\n        \"/public\",\n        \"/api/auth/login\",\n        \"/api/csrf\"\n    ];\n    const isPublicPath = publicPaths.some((path)=>pathname.startsWith(path));\n    const token = request.cookies.get(\"token\")?.value;\n    if (!token) {\n        if (!isPublicPath) {\n            if (pathname.startsWith(\"/api\")) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    message: \"Authentication required\"\n                }, {\n                    status: 401\n                });\n            }\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.redirect(new URL(\"/login\", request.url));\n        }\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.next();\n    }\n    // Validate session with backend\n    const user = await verifySession(request);\n    if (!user) {\n        if (pathname.startsWith(\"/api\")) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                message: \"Unauthorized\"\n            }, {\n                status: 401\n            });\n        }\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.redirect(new URL(\"/login\", request.url));\n    }\n    if (pathname === \"/login\") {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.redirect(new URL(\"/\", request.url));\n    }\n    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.next();\n}\nconst config = {\n    matcher: [\n        \"/((?!_next/static|_next/image|favicon.ico|.well-known).*)\"\n    ]\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKG1pZGRsZXdhcmUpLy4vc3JjL21pZGRsZXdhcmUudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQTBDO0FBRzFDLE1BQU1DLGNBQWNDLHVCQUFtQyxJQUFJO0FBRTNELGVBQWVHLGNBQWNDLE9BQW9CO0lBQzdDLE1BQU1DLFNBQVNELFFBQVFFLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDLGFBQWE7SUFDaEQsSUFBSTtRQUNBLE1BQU1DLE1BQU0sTUFBTUMsTUFBTSxDQUFDLEVBQUVWLFlBQVksUUFBUSxDQUFDLEVBQUU7WUFDOUNXLFFBQVE7WUFDUkosU0FBUztnQkFDTEQ7Z0JBQ0EsZ0JBQWdCO1lBQ3BCO1lBQ0FNLE9BQU87UUFDWDtRQUNBLElBQUksQ0FBQ0gsSUFBSUksRUFBRSxFQUFFLE9BQU87UUFDcEIsTUFBTUMsT0FBTyxNQUFNTCxJQUFJTSxJQUFJLEdBQUdDLEtBQUssQ0FBQyxJQUFNO1FBQzFDLE9BQU9GLE1BQU1BLFFBQVFBLFFBQVE7SUFDakMsRUFBRSxPQUFNO1FBQ0osT0FBTztJQUNYO0FBQ0o7QUFFTyxlQUFlRyxXQUFXWixPQUFvQjtJQUNqRCxNQUFNLEVBQUVhLFFBQVEsRUFBRSxHQUFHYixRQUFRYyxPQUFPO0lBRXBDLE1BQU1DLGNBQWM7UUFDaEI7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtLQUNIO0lBRUQsTUFBTUMsZUFBZUQsWUFBWUUsSUFBSSxDQUFDQyxDQUFBQSxPQUFRTCxTQUFTTSxVQUFVLENBQUNEO0lBQ2xFLE1BQU1FLFFBQVFwQixRQUFRcUIsT0FBTyxDQUFDbEIsR0FBRyxDQUFDLFVBQVVtQjtJQUU1QyxJQUFJLENBQUNGLE9BQU87UUFDUixJQUFJLENBQUNKLGNBQWM7WUFDZixJQUFJSCxTQUFTTSxVQUFVLENBQUMsU0FBUztnQkFDN0IsT0FBT3pCLHFEQUFZQSxDQUFDZ0IsSUFBSSxDQUFDO29CQUFFYSxTQUFTO2dCQUEwQixHQUFHO29CQUFFQyxRQUFRO2dCQUFJO1lBQ25GO1lBQ0EsT0FBTzlCLHFEQUFZQSxDQUFDK0IsUUFBUSxDQUFDLElBQUlDLElBQUksVUFBVTFCLFFBQVEyQixHQUFHO1FBQzlEO1FBQ0EsT0FBT2pDLHFEQUFZQSxDQUFDa0MsSUFBSTtJQUM1QjtJQUVBLGdDQUFnQztJQUNoQyxNQUFNQyxPQUFPLE1BQU05QixjQUFjQztJQUNqQyxJQUFJLENBQUM2QixNQUFNO1FBQ1AsSUFBSWhCLFNBQVNNLFVBQVUsQ0FBQyxTQUFTO1lBQzdCLE9BQU96QixxREFBWUEsQ0FBQ2dCLElBQUksQ0FBQztnQkFBRWEsU0FBUztZQUFlLEdBQUc7Z0JBQUVDLFFBQVE7WUFBSTtRQUN4RTtRQUNBLE9BQU85QixxREFBWUEsQ0FBQytCLFFBQVEsQ0FBQyxJQUFJQyxJQUFJLFVBQVUxQixRQUFRMkIsR0FBRztJQUM5RDtJQUVBLElBQUlkLGFBQWEsVUFBVTtRQUN2QixPQUFPbkIscURBQVlBLENBQUMrQixRQUFRLENBQUMsSUFBSUMsSUFBSSxLQUFLMUIsUUFBUTJCLEdBQUc7SUFDekQ7SUFFQSxPQUFPakMscURBQVlBLENBQUNrQyxJQUFJO0FBQzVCO0FBRU8sTUFBTUUsU0FBUztJQUNsQkMsU0FBUztRQUNMO0tBQ0g7QUFDTCxFQUFDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vX05fRS8uL3NyYy9taWRkbGV3YXJlLnRzP2QxOTkiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInXG5pbXBvcnQgdHlwZSB7IE5leHRSZXF1ZXN0IH0gZnJvbSAnbmV4dC9zZXJ2ZXInXG5cbmNvbnN0IEJBQ0tFTkRfQVBJID0gcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfQkFDS0VORF9BUEkgfHwgJ2h0dHA6Ly9sb2NhbGhvc3Q6NDAwMCdcblxuYXN5bmMgZnVuY3Rpb24gdmVyaWZ5U2Vzc2lvbihyZXF1ZXN0OiBOZXh0UmVxdWVzdCkge1xuICAgIGNvbnN0IGNvb2tpZSA9IHJlcXVlc3QuaGVhZGVycy5nZXQoJ2Nvb2tpZScpIHx8ICcnXG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgZmV0Y2goYCR7QkFDS0VORF9BUEl9L2F1dGgvbWVgLCB7XG4gICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgICAgIGNvb2tpZSxcbiAgICAgICAgICAgICAgICAnY29udGVudC10eXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNhY2hlOiAnbm8tc3RvcmUnLFxuICAgICAgICB9KVxuICAgICAgICBpZiAoIXJlcy5vaykgcmV0dXJuIG51bGxcbiAgICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlcy5qc29uKCkuY2F0Y2goKCkgPT4gbnVsbClcbiAgICAgICAgcmV0dXJuIGRhdGE/LmRhdGEgfHwgZGF0YSB8fCBudWxsXG4gICAgfSBjYXRjaCB7XG4gICAgICAgIHJldHVybiBudWxsXG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbWlkZGxld2FyZShyZXF1ZXN0OiBOZXh0UmVxdWVzdCkge1xuICAgIGNvbnN0IHsgcGF0aG5hbWUgfSA9IHJlcXVlc3QubmV4dFVybFxuXG4gICAgY29uc3QgcHVibGljUGF0aHMgPSBbXG4gICAgICAgICcvbG9naW4nLFxuICAgICAgICAnL3JlZ2lzdGVyJyxcbiAgICAgICAgJy9fbmV4dCcsXG4gICAgICAgICcvc3RhdGljJyxcbiAgICAgICAgJy9mYXZpY29uLmljbycsXG4gICAgICAgICcvcHVibGljJyxcbiAgICAgICAgJy9hcGkvYXV0aC9sb2dpbicsXG4gICAgICAgICcvYXBpL2NzcmYnXG4gICAgXVxuXG4gICAgY29uc3QgaXNQdWJsaWNQYXRoID0gcHVibGljUGF0aHMuc29tZShwYXRoID0+IHBhdGhuYW1lLnN0YXJ0c1dpdGgocGF0aCkpXG4gICAgY29uc3QgdG9rZW4gPSByZXF1ZXN0LmNvb2tpZXMuZ2V0KCd0b2tlbicpPy52YWx1ZVxuXG4gICAgaWYgKCF0b2tlbikge1xuICAgICAgICBpZiAoIWlzUHVibGljUGF0aCkge1xuICAgICAgICAgICAgaWYgKHBhdGhuYW1lLnN0YXJ0c1dpdGgoJy9hcGknKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IG1lc3NhZ2U6ICdBdXRoZW50aWNhdGlvbiByZXF1aXJlZCcgfSwgeyBzdGF0dXM6IDQwMSB9KVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5yZWRpcmVjdChuZXcgVVJMKCcvbG9naW4nLCByZXF1ZXN0LnVybCkpXG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5uZXh0KClcbiAgICB9XG5cbiAgICAvLyBWYWxpZGF0ZSBzZXNzaW9uIHdpdGggYmFja2VuZFxuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCB2ZXJpZnlTZXNzaW9uKHJlcXVlc3QpXG4gICAgaWYgKCF1c2VyKSB7XG4gICAgICAgIGlmIChwYXRobmFtZS5zdGFydHNXaXRoKCcvYXBpJykpIHtcbiAgICAgICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IG1lc3NhZ2U6ICdVbmF1dGhvcml6ZWQnIH0sIHsgc3RhdHVzOiA0MDEgfSlcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLnJlZGlyZWN0KG5ldyBVUkwoJy9sb2dpbicsIHJlcXVlc3QudXJsKSlcbiAgICB9XG5cbiAgICBpZiAocGF0aG5hbWUgPT09ICcvbG9naW4nKSB7XG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UucmVkaXJlY3QobmV3IFVSTCgnLycsIHJlcXVlc3QudXJsKSlcbiAgICB9XG5cbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLm5leHQoKVxufVxuXG5leHBvcnQgY29uc3QgY29uZmlnID0ge1xuICAgIG1hdGNoZXI6IFtcbiAgICAgICAgJy8oKD8hX25leHQvc3RhdGljfF9uZXh0L2ltYWdlfGZhdmljb24uaWNvfC53ZWxsLWtub3duKS4qKScsXG4gICAgXSxcbn1cbiJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJCQUNLRU5EX0FQSSIsInByb2Nlc3MiLCJlbnYiLCJORVhUX1BVQkxJQ19CQUNLRU5EX0FQSSIsInZlcmlmeVNlc3Npb24iLCJyZXF1ZXN0IiwiY29va2llIiwiaGVhZGVycyIsImdldCIsInJlcyIsImZldGNoIiwibWV0aG9kIiwiY2FjaGUiLCJvayIsImRhdGEiLCJqc29uIiwiY2F0Y2giLCJtaWRkbGV3YXJlIiwicGF0aG5hbWUiLCJuZXh0VXJsIiwicHVibGljUGF0aHMiLCJpc1B1YmxpY1BhdGgiLCJzb21lIiwicGF0aCIsInN0YXJ0c1dpdGgiLCJ0b2tlbiIsImNvb2tpZXMiLCJ2YWx1ZSIsIm1lc3NhZ2UiLCJzdGF0dXMiLCJyZWRpcmVjdCIsIlVSTCIsInVybCIsIm5leHQiLCJ1c2VyIiwiY29uZmlnIiwibWF0Y2hlciJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(middleware)/./src/middleware.ts\n");

/***/ })

});