"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4243],{2938:function(e,t,n){n.d(t,{H:function(){return l}});var a=n(57437);n(2265);var r=n(82646),o=n(48651);let{Text:i}=r.default,l=e=>{let{message:t,tone:n="secondary"}=e;return(0,a.jsxs)("div",{style:{display:"flex",height:"100vh",justifyContent:"center",alignItems:"center",flexDirection:"column",gap:16},children:[(0,a.jsx)(o.Z,{size:"large"}),(0,a.jsx)(i,{type:n,children:t})]})}},71567:function(e,t,n){n.d(t,{q:function(){return r},v:function(){return a}});let a="/api",r={AUTH:{LOGIN:"/auth/login",ME:"/auth/me",CSRF:"/csrf"},POS:{PRODUCTS:"/pos/products",ORDERS:"/pos/orders",TABLES:"/pos/tables",DISCOUNTS:"/pos/discounts",DELIVERY:"/pos/delivery",PAYMENT_METHODS:"/pos/paymentMethod",PAYMENTS:"/pos/payments",CATEGORY:"/pos/category",SHIFTS:{BASE:"/pos/shifts",CURRENT:"/pos/shifts/current",OPEN:"/pos/shifts/open",CLOSE:"/pos/shifts/close"},DASHBOARD:{SALES:"/pos/dashboard/sales",TOP_ITEMS:"/pos/dashboard/top-items"},CHANNELS:{STATS:"/pos/orders/stats"},SHOP_PROFILE:"/pos/shopProfile",SALES_ORDER_ITEMS:"/pos/salesOrderItem",SALES_ORDER_DETAILS:"/pos/salesOrderDetail",PRODUCTS_UNIT:"/pos/productsUnit",PAYMENT_DETAILS:"/pos/paymentDetails",BRANCH:"/branches"}}},14362:function(e,t,n){n.d(t,{AuthProvider:function(){return d},a:function(){return p}});var a=n(57437),r=n(2265),o=n(99376),i=n(5447),l=n(84859),s=n(48651),c=n(3369);let u=(0,r.createContext)(void 0),d=e=>{let{children:t}=e,[n,d]=(0,r.useState)(null),[p,g]=(0,r.useState)(!0),f=(0,o.useRouter)(),h=(0,o.usePathname)(),m=async()=>{try{let e="";e=localStorage.getItem("token_ws")||"";let t=await i.O.getMe(e);d(t)}catch(e){d(null)}finally{g(!1)}};(0,r.useEffect)(()=>{m()},[]);let{showLoading:x,hideLoading:b}=(0,c.x)();(0,r.useEffect)(()=>{p||n||"/login"===h||f.push("/login")},[n,p,h,f]);let y=async e=>{try{x("กำลังเข้าสู่ระบบ...");let t=await i.O.getCsrfToken(),{token:n,...a}=await i.O.login(e,t);n&&localStorage.setItem("token_ws",n),d(a),f.push("/")}catch(e){throw e}finally{b()}},S=async()=>{try{x("กำลังออกจากระบบ...");let e="";e=localStorage.getItem("token_ws")||"",await i.O.logout(e),localStorage.removeItem("token_ws"),l.x.clearQueue(),d(null),f.push("/login")}catch(e){console.error("Logout error:",e)}finally{b()}};return p?(0,a.jsx)("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-white",children:(0,a.jsx)(s.Z,{size:"large"})}):n||"/login"===h?(0,a.jsx)(u.Provider,{value:{user:n,loading:p,login:y,logout:S,checkAuth:m},children:t}):null},p=()=>{let e=(0,r.useContext)(u);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}},3369:function(e,t,n){n.d(t,{GlobalLoadingProvider:function(){return s},O:function(){return u},x:function(){return c}});var a=n(57437),r=n(2265),o=n(48651);let i=(0,r.createContext)(void 0),l=(0,r.createContext)(void 0),s=e=>{let{children:t}=e,[n,s]=(0,r.useState)({}),[c,u]=(0,r.useState)(void 0),d=(0,r.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default";s(e=>({...e,[t]:(e[t]||0)+1})),e&&u(e)},[]),p=(0,r.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";s(t=>{if(!t[e])return t;let n={...t};return n[e]-=1,n[e]<=0&&delete n[e],n})},[]),g=(0,r.useCallback)(()=>{s({}),u(void 0)},[]),f=Object.keys(n).length>0,h=(0,r.useMemo)(()=>({isLoading:f,loadingMessage:c}),[f,c]),m=(0,r.useMemo)(()=>({showLoading:d,hideLoading:p,resetLoading:g}),[d,p,g]);return(0,a.jsx)(l.Provider,{value:m,children:(0,a.jsxs)(i.Provider,{value:h,children:[t,f&&(0,a.jsx)("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center pointer-events-auto bg-black/10 backdrop-blur-[1px]",children:(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:10,background:"rgba(255, 255, 255, 0.9)",padding:"20px 40px",borderRadius:12,boxShadow:"0 4px 12px rgba(0,0,0,0.1)"},children:[(0,a.jsx)(o.Z,{size:"large"}),c&&(0,a.jsx)("div",{style:{fontSize:14,color:"#1f1f1f",fontWeight:500},children:c})]})})]})})};function c(){let e=(0,r.useContext)(i),t=(0,r.useContext)(l);if(!e||!t)throw Error("useGlobalLoading must be used within a GlobalLoadingProvider");return(0,r.useMemo)(()=>({...e,...t}),[e,t])}function u(){let e=(0,r.useContext)(l);if(!e)throw Error("useGlobalLoadingDispatch must be used within a GlobalLoadingProvider");return e}},2913:function(e,t,n){function a(e,t){return({GET:"".concat(r.API_BASE_URL).concat(t),POST:"".concat(r.API_BASE_URL).concat(t),PUT:"".concat(r.API_BASE_URL).concat(t),DELETE:"".concat(r.API_BASE_URL).concat(t),PATCH:"".concat(r.API_BASE_URL).concat(t)})[e]}n.d(t,{b:function(){return a}});let r={get API_BASE_URL(){return"/api"}}},5447:function(e,t,n){n.d(t,{O:function(){return o}});var a=n(71567),r=n(2913);let o={login:async(e,t,n)=>{try{let o=(0,r.b)("POST",a.q.AUTH.LOGIN),i={"Content-Type":"application/json"};t&&(i["X-CSRF-Token"]=t),n&&(i.Cookie=n);let l=await fetch(o,{method:"POST",headers:i,credentials:"include",body:JSON.stringify(e)});if(!l.ok){let e=await l.json().catch(()=>({}));throw Error(e.message||e.detail||"เข้าสู่ระบบไม่สำเร็จ")}let s=await l.json();return{...s.user,token:s.token}}catch(e){throw Error(e.message||"เข้าสู่ระบบไม่สำเร็จ")}},logout:async(e,t,n)=>{try{let a=(0,r.b)("POST","/auth/logout"),o={"Content-Type":"application/json"};e&&(o.Authorization="Bearer ".concat(e)),t&&(o["X-CSRF-Token"]=t),n&&(o.Cookie=n),await fetch(a,{method:"POST",headers:o,credentials:"include"})}catch(e){console.error("Logout failed",e)}},getMe:async e=>{try{let t=(0,r.b)("GET",a.q.AUTH.ME),n=await fetch(t,{method:"GET",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"},credentials:"include",cache:"no-store"});if(!n.ok)throw Error("Unauthorized");return await n.json()}catch(e){throw e}},async getCsrfToken(){try{let e=await fetch("".concat(a.v).concat(a.q.AUTH.CSRF),{credentials:"include"});if(!e.ok)return"";return(await e.json()).csrfToken}catch(e){return console.error("Failed to fetch CSRF token",e),""}}}},84859:function(e,t,n){n.d(t,{M:function(){return l},x:function(){return i}});let a="pos_offline_queue",r=()=>{let e=localStorage.getItem(a);return e?JSON.parse(e):[]},o=e=>{localStorage.setItem(a,JSON.stringify(e))},i={addToQueue:(e,t)=>{let n=r(),a={id:"offline-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),type:e,payload:t,timestamp:Date.now(),retryCount:0};return o([...n,a]),a},getQueue:()=>r(),removeFromQueue:e=>{o(r().filter(t=>t.id!==e))},incrementRetry:(e,t)=>{o(r().map(n=>n.id===e?{...n,retryCount:n.retryCount+1,lastError:t}:n))},clearQueue:()=>{localStorage.removeItem(a)},pruneExceeded:()=>{o(r().filter(e=>e.retryCount<=5))}},l={maxRetry:5,backoff:e=>Math.min(3e4,2e3*e)}},72175:function(e,t,n){n.d(t,{dg:function(){return g},oI:function(){return h},uM:function(){return f}});var a=n(57437);n(2265);var r=n(82646),o=n(50742),i=n(78355),l=n(17588),s=n(13377),c=n(34419),u=n(26349);let{Text:d,Title:p}=r.default,g=e=>{let{focusColor:t,focusShadow:n,switchGradient:r,extraCss:o=""}=e;return{pageStyles:{container:{paddingBottom:100,backgroundColor:"#f8f9fc",minHeight:"100vh"},header:e=>({background:e?"linear-gradient(135deg, #faad14 0%, #fa8c16 100%)":"linear-gradient(135deg, #52c41a 0%, #389e0d 100%)",padding:"20px 20px 60px 20px",position:"relative",overflow:"hidden"}),headerDecoCircle1:{position:"absolute",top:-50,right:-50,width:150,height:150,borderRadius:"50%",background:"rgba(255,255,255,0.1)"},headerDecoCircle2:{position:"absolute",bottom:-30,left:-30,width:100,height:100,borderRadius:"50%",background:"rgba(255,255,255,0.08)"},headerContent:{position:"relative",zIndex:1,display:"flex",alignItems:"center",gap:12},headerIconBox:{width:48,height:48,borderRadius:14,background:"rgba(255,255,255,0.2)",display:"flex",alignItems:"center",justifyContent:"center",backdropFilter:"blur(8px)"},formCard:{margin:"-40px 16px 0 16px",padding:"24px",background:"white",borderRadius:20,boxShadow:"0 8px 24px rgba(0,0,0,0.08)",position:"relative",zIndex:10},formSection:{marginBottom:20},formLabel:{fontSize:14,fontWeight:600,color:"#1a1a2e",marginBottom:8,display:"block"},actionButtons:{display:"flex",gap:12,marginTop:24,paddingTop:20,borderTop:"1px solid #f0f0f0"}},ManagePageStyles:()=>(0,a.jsx)("style",{children:"\n        @keyframes fadeSlideIn {\n            from {\n                opacity: 0;\n                transform: translateY(12px);\n            }\n            to {\n                opacity: 1;\n                transform: translateY(0);\n            }\n        }\n\n        .manage-form-card {\n            animation: fadeSlideIn 0.4s ease both;\n        }\n\n        .manage-page .ant-input,\n        .manage-page .ant-input-number,\n        .manage-page .ant-select-selector,\n        .manage-page .ant-input-affix-wrapper {\n            border-radius: 12px !important;\n            border: 2px solid #f0f0f0 !important;\n            transition: all 0.3s ease !important;\n        }\n\n        .manage-page .ant-input:focus,\n        .manage-page .ant-input-focused,\n        .manage-page .ant-input-number:focus,\n        .manage-page .ant-input-number-focused,\n        .manage-page .ant-select-focused .ant-select-selector,\n        .manage-page .ant-input-affix-wrapper:focus,\n        .manage-page .ant-input-affix-wrapper-focused {\n            border-color: ".concat(t," !important;\n            box-shadow: 0 0 0 3px ").concat(n,' !important;\n        }\n\n        .manage-page .ant-input-lg,\n        .manage-page .ant-select-lg .ant-select-selector {\n            padding: 12px 16px !important;\n            height: auto !important;\n        }\n\n        .manage-page .ant-form-item-label > label {\n            font-weight: 600;\n            color: #1a1a2e;\n            font-size: 14px;\n        }\n\n        .manage-page .ant-form-item-required::before {\n            display: none !important;\n        }\n\n        .manage-page .ant-form-item-required::after {\n            content: "*" !important;\n            display: inline-block !important;\n            color: #ff4d4f !important;\n            margin-left: 4px !important;\n        }\n\n        .manage-page .ant-switch {\n            min-width: 50px;\n        }\n\n        .manage-page .ant-switch-checked {\n            background: ').concat(r,";\n        }\n\n        .manage-page textarea.ant-input {\n            border-radius: 12px !important;\n        }\n\n        .manage-page .ant-input-number-lg {\n            width: 100%;\n        }\n\n        ").concat(o,"\n    ")})}},f=e=>{let{pageStyles:t,isEdit:n,loading:r,onCancel:l}=e;return(0,a.jsxs)("div",{style:t.actionButtons,children:[(0,a.jsx)(o.ZP,{size:"large",onClick:l,style:{flex:1,borderRadius:14,height:48},children:"ยกเลิก"}),(0,a.jsx)(o.ZP,{type:"primary",htmlType:"submit",size:"large",loading:r,icon:(0,a.jsx)(i.Z,{}),style:{flex:2,borderRadius:14,height:48,background:n?"linear-gradient(135deg, #faad14 0%, #fa8c16 100%)":"linear-gradient(135deg, #52c41a 0%, #389e0d 100%)",border:"none",fontWeight:600,boxShadow:n?"0 4px 12px rgba(250, 173, 20, 0.4)":"0 4px 12px rgba(82, 196, 26, 0.4)"},children:n?"อัปเดต":"บันทึก"})]})},h=e=>{let{pageStyles:t,isEdit:n,onBack:r,onDelete:i,titleCreate:g,titleEdit:f}=e;return(0,a.jsxs)("div",{style:t.header(n),children:[(0,a.jsx)("div",{style:t.headerDecoCircle1}),(0,a.jsx)("div",{style:t.headerDecoCircle2}),(0,a.jsxs)("div",{style:t.headerContent,children:[(0,a.jsx)(o.ZP,{type:"text",icon:(0,a.jsx)(l.Z,{style:{fontSize:20,color:"white"}}),onClick:r,style:{width:40,height:40,borderRadius:12,background:"rgba(255,255,255,0.2)",display:"flex",alignItems:"center",justifyContent:"center"}}),(0,a.jsx)("div",{style:t.headerIconBox,children:n?(0,a.jsx)(s.Z,{style:{fontSize:24,color:"white"}}):(0,a.jsx)(c.Z,{style:{fontSize:24,color:"white"}})}),(0,a.jsxs)("div",{style:{flex:1},children:[(0,a.jsx)(d,{style:{color:"rgba(255,255,255,0.85)",fontSize:13,display:"block"},children:n?"แก้ไขข้อมูล":"เพิ่มข้อมูลใหม่"}),(0,a.jsx)(p,{level:4,style:{color:"white",margin:0,fontWeight:700,letterSpacing:"0.5px"},children:n?f:g})]}),n&&i&&(0,a.jsx)(o.ZP,{danger:!0,icon:(0,a.jsx)(u.Z,{}),onClick:i,style:{background:"rgba(255,77,79,0.9)",borderColor:"transparent",color:"white",borderRadius:12,height:40,fontWeight:600},children:"ลบ"})]})]})}},3286:function(e,t,n){n.d(t,{e:function(){return l}});var a=n(2265),r=n(34029),o=n(99376),i=n(14362);function l(){let{requiredRole:e="Admin",redirectUnauthenticated:t="/login",redirectUnauthorized:n="/pos",unauthorizedMessage:l="คุณไม่มีสิทธิ์เข้าถึงหน้านี้"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=(0,o.useRouter)(),{user:c,loading:u}=(0,i.a)(),d=(0,a.useMemo)(()=>u?"checking":c?e&&c.role!==e?"unauthorized":"authorized":"unauthenticated",[c,u,e]),p=(0,a.useRef)(!1);return(0,a.useEffect)(()=>{if("unauthenticated"===d){s.replace(t);return}"unauthorized"===d&&(p.current||(p.current=!0,r.ZP.error(l)),s.replace(n))},[d,s,t,n,l]),{status:d,isAuthorized:"authorized"===d,isChecking:"checking"===d,user:c}}},97235:function(e,t,n){n.d(t,{P:function(){return l}});var a=n(5447);let r=null,o=0,i=null;async function l(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=Date.now();return!e&&r&&t-o<6e5?r:(i||(i=a.O.getCsrfToken().then(e=>(r=e||"",o=Date.now(),r)).finally(()=>{i=null})),i)}}}]);