"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6011],{71567:function(e,t,o){o.d(t,{q:function(){return r},v:function(){return n}});let n="/api",r={AUTH:{LOGIN:"/auth/login",ME:"/auth/me",CSRF:"/csrf"},POS:{PRODUCTS:"/pos/products",ORDERS:"/pos/orders",TABLES:"/pos/tables",DISCOUNTS:"/pos/discounts",DELIVERY:"/pos/delivery",PAYMENT_METHODS:"/pos/paymentMethod",PAYMENTS:"/pos/payments",CATEGORY:"/pos/category",SHIFTS:{BASE:"/pos/shifts",CURRENT:"/pos/shifts/current",OPEN:"/pos/shifts/open",CLOSE:"/pos/shifts/close"},DASHBOARD:{SALES:"/pos/dashboard/sales",TOP_ITEMS:"/pos/dashboard/top-items"},CHANNELS:{STATS:"/pos/orders/stats"},SHOP_PROFILE:"/pos/shopProfile",SALES_ORDER_ITEMS:"/pos/salesOrderItem",SALES_ORDER_DETAILS:"/pos/salesOrderDetail",PRODUCTS_UNIT:"/pos/productsUnit",PAYMENT_DETAILS:"/pos/paymentDetails",BRANCH:"/branches"}}},14362:function(e,t,o){o.d(t,{AuthProvider:function(){return d},a:function(){return f}});var n=o(57437),r=o(2265),a=o(99376),i=o(5447),s=o(84859),c=o(48651),l=o(3369);let u=(0,r.createContext)(void 0),d=e=>{let{children:t}=e,[o,d]=(0,r.useState)(null),[f,h]=(0,r.useState)(!0),p=(0,a.useRouter)(),S=(0,a.usePathname)(),m=async()=>{try{let e="";e=localStorage.getItem("token_ws")||"";let t=await i.O.getMe(e);d(t)}catch(e){d(null)}finally{h(!1)}};(0,r.useEffect)(()=>{m()},[]);let{showLoading:g,hideLoading:y}=(0,l.x)();(0,r.useEffect)(()=>{f||o||"/login"===S||p.push("/login")},[o,f,S,p]);let E=async e=>{try{g("กำลังเข้าสู่ระบบ...");let t=await i.O.getCsrfToken(),{token:o,...n}=await i.O.login(e,t);o&&localStorage.setItem("token_ws",o),d(n),p.push("/")}catch(e){throw e}finally{y()}},T=async()=>{try{g("กำลังออกจากระบบ...");let e="";e=localStorage.getItem("token_ws")||"",await i.O.logout(e),localStorage.removeItem("token_ws"),s.x.clearQueue(),d(null),p.push("/login")}catch(e){console.error("Logout error:",e)}finally{y()}};return f?(0,n.jsx)("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-white",children:(0,n.jsx)(c.Z,{size:"large"})}):o||"/login"===S?(0,n.jsx)(u.Provider,{value:{user:o,loading:f,login:E,logout:T,checkAuth:m},children:t}):null},f=()=>{let e=(0,r.useContext)(u);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}},3369:function(e,t,o){o.d(t,{GlobalLoadingProvider:function(){return c},O:function(){return u},x:function(){return l}});var n=o(57437),r=o(2265),a=o(48651);let i=(0,r.createContext)(void 0),s=(0,r.createContext)(void 0),c=e=>{let{children:t}=e,[o,c]=(0,r.useState)({}),[l,u]=(0,r.useState)(void 0),d=(0,r.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default";c(e=>({...e,[t]:(e[t]||0)+1})),e&&u(e)},[]),f=(0,r.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";c(t=>{if(!t[e])return t;let o={...t};return o[e]-=1,o[e]<=0&&delete o[e],o})},[]),h=(0,r.useCallback)(()=>{c({}),u(void 0)},[]),p=Object.keys(o).length>0,S=(0,r.useMemo)(()=>({isLoading:p,loadingMessage:l}),[p,l]),m=(0,r.useMemo)(()=>({showLoading:d,hideLoading:f,resetLoading:h}),[d,f,h]);return(0,n.jsx)(s.Provider,{value:m,children:(0,n.jsxs)(i.Provider,{value:S,children:[t,p&&(0,n.jsx)("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center pointer-events-auto bg-black/10 backdrop-blur-[1px]",children:(0,n.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:10,background:"rgba(255, 255, 255, 0.9)",padding:"20px 40px",borderRadius:12,boxShadow:"0 4px 12px rgba(0,0,0,0.1)"},children:[(0,n.jsx)(a.Z,{size:"large"}),l&&(0,n.jsx)("div",{style:{fontSize:14,color:"#1f1f1f",fontWeight:500},children:l})]})})]})})};function l(){let e=(0,r.useContext)(i),t=(0,r.useContext)(s);if(!e||!t)throw Error("useGlobalLoading must be used within a GlobalLoadingProvider");return(0,r.useMemo)(()=>({...e,...t}),[e,t])}function u(){let e=(0,r.useContext)(s);if(!e)throw Error("useGlobalLoadingDispatch must be used within a GlobalLoadingProvider");return e}},2913:function(e,t,o){function n(e,t){return({GET:"".concat(r.API_BASE_URL).concat(t),POST:"".concat(r.API_BASE_URL).concat(t),PUT:"".concat(r.API_BASE_URL).concat(t),DELETE:"".concat(r.API_BASE_URL).concat(t),PATCH:"".concat(r.API_BASE_URL).concat(t)})[e]}o.d(t,{b:function(){return n}});let r={get API_BASE_URL(){return"/api"}}},5447:function(e,t,o){o.d(t,{O:function(){return a}});var n=o(71567),r=o(2913);let a={login:async(e,t,o)=>{try{let a=(0,r.b)("POST",n.q.AUTH.LOGIN),i={"Content-Type":"application/json"};t&&(i["X-CSRF-Token"]=t),o&&(i.Cookie=o);let s=await fetch(a,{method:"POST",headers:i,credentials:"include",body:JSON.stringify(e)});if(!s.ok){let e=await s.json().catch(()=>({}));throw Error(e.message||e.detail||"เข้าสู่ระบบไม่สำเร็จ")}let c=await s.json();return{...c.user,token:c.token}}catch(e){throw Error(e.message||"เข้าสู่ระบบไม่สำเร็จ")}},logout:async(e,t,o)=>{try{let n=(0,r.b)("POST","/auth/logout"),a={"Content-Type":"application/json"};e&&(a.Authorization="Bearer ".concat(e)),t&&(a["X-CSRF-Token"]=t),o&&(a.Cookie=o),await fetch(n,{method:"POST",headers:a,credentials:"include"})}catch(e){console.error("Logout failed",e)}},getMe:async e=>{try{let t=(0,r.b)("GET",n.q.AUTH.ME),o=await fetch(t,{method:"GET",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"},credentials:"include",cache:"no-store"});if(!o.ok)throw Error("Unauthorized");return await o.json()}catch(e){throw e}},async getCsrfToken(){try{let e=await fetch("".concat(n.v).concat(n.q.AUTH.CSRF),{credentials:"include"});if(!e.ok)return"";return(await e.json()).csrfToken}catch(e){return console.error("Failed to fetch CSRF token",e),""}}}},84859:function(e,t,o){o.d(t,{M:function(){return s},x:function(){return i}});let n="pos_offline_queue",r=()=>{let e=localStorage.getItem(n);return e?JSON.parse(e):[]},a=e=>{localStorage.setItem(n,JSON.stringify(e))},i={addToQueue:(e,t)=>{let o=r(),n={id:"offline-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),type:e,payload:t,timestamp:Date.now(),retryCount:0};return a([...o,n]),n},getQueue:()=>r(),removeFromQueue:e=>{a(r().filter(t=>t.id!==e))},incrementRetry:(e,t)=>{a(r().map(o=>o.id===e?{...o,retryCount:o.retryCount+1,lastError:t}:o))},clearQueue:()=>{localStorage.removeItem(n)},pruneExceeded:()=>{a(r().filter(e=>e.retryCount<=5))}},s={maxRetry:5,backoff:e=>Math.min(3e4,2e3*e)}},59226:function(e,t,o){o.d(t,{t:function(){return r}});var n=o(97235);let r={getCurrentShift:async()=>{let e=await fetch("/api/pos/shifts/current",{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"});if(404===e.status)return null;if(!e.ok)throw Error("Failed to fetch current shift");return e.json()},openShift:async e=>{let t=await (0,n.P)(),o=await fetch("/api/pos/shifts/open",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":t},credentials:"include",body:JSON.stringify({start_amount:e})});if(!o.ok)throw Error((await o.json().catch(()=>({}))).message||"Failed to open shift");return o.json()},closeShift:async e=>{let t=await (0,n.P)(),o=await fetch("/api/pos/shifts/close",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":t},credentials:"include",body:JSON.stringify({end_amount:e})});if(!o.ok)throw Error((await o.json().catch(()=>({}))).message||"Failed to close shift");return o.json()},getCurrentSummary:async()=>{let e=await fetch("/api/pos/shifts/current/summary",{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"});if(!e.ok)throw Error("Failed to fetch shift summary");return e.json()},getSummary:async e=>{let t=await fetch("/api/pos/shifts/summary/".concat(e),{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"});if(!t.ok)throw Error("Failed to fetch shift summary");return t.json()}}},97235:function(e,t,o){o.d(t,{P:function(){return s}});var n=o(5447);let r=null,a=0,i=null;async function s(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=Date.now();return!e&&r&&t-a<6e5?r:(i||(i=n.O.getCsrfToken().then(e=>(r=e||"",a=Date.now(),r)).finally(()=>{i=null})),i)}}}]);