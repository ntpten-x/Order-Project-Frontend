(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8012],{89212:function(e,a,r){Promise.resolve().then(r.bind(r,54531))},54531:function(e,a,r){"use strict";r.r(a),r.d(a,{default:function(){return R}});var n=r(57437),t=r(2265),s=r(88589),i=r(19878),d=r(64625),l=r(48651),c=r(47451),o=r(69410),x=r(66487),h=r(50742),u=r(99376),m=r(29),p=r.n(m),f=r(19683),g=r(17588),b=r(26349);let{Title:j,Text:y}=f.default,k={minHeight:"100vh",background:"#f8f9fc",paddingBottom:40},v={background:"#fff",padding:"20px 24px",borderBottom:"1px solid #f0f0f0",display:"flex",justifyContent:"space-between",alignItems:"center",position:"sticky",top:0,zIndex:10,boxShadow:"0 2px 8px rgba(0,0,0,0.05)"},Z={maxWidth:800,margin:"32px auto",padding:"32px",background:"#fff",borderRadius:20,boxShadow:"0 4px 20px rgba(0,0,0,0.05)"},_=()=>(0,n.jsx)(p(),{id:"d6a7379aac763388",children:".manage-form-card .ant-form-item-label label{font-weight:600;color:#374151}.manage-form-card .ant-input,.manage-form-card .ant-input-number,.manage-form-card .ant-select-selector{-webkit-border-radius:12px!important;-moz-border-radius:12px!important;border-radius:12px!important;padding-top:8px;padding-bottom:8px}"}),w=e=>{let{isEdit:a,onBack:r,onDelete:t}=e;return(0,n.jsxs)("div",{style:v,children:[(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:16},children:[(0,n.jsx)(h.ZP,{icon:(0,n.jsx)(g.Z,{}),onClick:r,style:{borderRadius:"50%",width:40,height:40,display:"flex",alignItems:"center",justifyContent:"center",border:"none",background:"#f3f4f6"}}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,n.jsx)(j,{level:4,style:{margin:0},children:a?"แก้ไขข้อมูลสาขา":"เพิ่มสาขาใหม่"}),a&&(0,n.jsx)("div",{style:{background:"#f3f4f6",padding:"2px 8px",borderRadius:6,fontSize:12,color:"#6b7280",fontWeight:600},children:"EDIT MODE"})]}),(0,n.jsx)(y,{type:"secondary",style:{fontSize:13},children:a?"ปรับปรุงข้อมูลสาขาที่มีอยู่":"กรอกข้อมูลเพื่อสร้างสาขาใหม่"})]})]}),a&&t&&(0,n.jsx)(h.ZP,{danger:!0,icon:(0,n.jsx)(b.Z,{}),onClick:t,style:{borderRadius:12,height:40},children:"ลบสาขา"})]})};var I=r(1665),C=r(14362),z=r(97235);let{TextArea:P}=s.default;function R(e){let{params:a}=e,r=(0,u.useRouter)(),[m]=i.Z.useForm(),[p,f]=(0,t.useState)(!1),[g,b]=(0,t.useState)(!1),{user:j,loading:y}=(0,C.a)(),{message:v,modal:R}=d.Z.useApp(),E=a.mode[0],T=a.mode[1]||null,S="edit"===E&&!!T,B=(0,t.useCallback)(async()=>{f(!0);try{let e=await I.x.getById(T);m.setFieldsValue({branch_name:e.branch_name,branch_code:e.branch_code,address:e.address,phone:e.phone,tax_id:e.tax_id,is_active:e.is_active})}catch(e){console.error(e),v.error("ไม่สามารถดึงข้อมูลสาขาได้"),r.push("/branch")}finally{f(!1)}},[T,m,r,v]);(0,t.useEffect)(()=>{if(!y&&j){if("Admin"!==j.role){r.push("/");return}S&&B()}},[y,j,S,B,r]);let N=async e=>{b(!0);try{let a=await (0,z.P)();S?(await I.x.update(T,e,void 0,a),v.success("อัปเดตสาขาสำเร็จ")):(await I.x.create(e,void 0,a),v.success("สร้างสาขาสำเร็จ")),r.push("/branch")}catch(e){console.error(e),v.error(e.message||"เกิดข้อผิดพลาดในการบันทึกข้อมูล")}finally{b(!1)}},D=()=>r.push("/branch");return y||S&&p?(0,n.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",background:"#f8f9fc"},children:(0,n.jsx)(l.Z,{size:"large"})}):(0,n.jsxs)("div",{style:k,children:[(0,n.jsx)(_,{}),(0,n.jsx)(w,{isEdit:S,onBack:D,onDelete:S?()=>{T&&R.confirm({title:"ยืนยันการลบสาขา",content:"คุณต้องการลบสาขานี้หรือไม่?",okText:"ลบ",okType:"danger",cancelText:"ยกเลิก",centered:!0,onOk:async()=>{try{let e=await (0,z.P)();await I.x.delete(T,void 0,e),v.success("ลบสาขาสำเร็จ"),r.push("/branch")}catch(e){v.error("ไม่สามารถลบสาขาได้")}}})}:void 0}),(0,n.jsx)("div",{className:"manage-form-card",style:Z,children:(0,n.jsxs)(i.Z,{form:m,layout:"vertical",onFinish:N,requiredMark:!1,autoComplete:"off",initialValues:{is_active:!0},children:[(0,n.jsxs)(c.Z,{gutter:24,children:[(0,n.jsx)(o.Z,{xs:24,md:12,children:(0,n.jsx)(i.Z.Item,{name:"branch_name",label:"ชื่อสาขา *",rules:[{required:!0,message:"กรุณากรอกชื่อสาขา"}],children:(0,n.jsx)(s.default,{size:"large",placeholder:"ระบุชื่อสาขา",maxLength:100})})}),(0,n.jsx)(o.Z,{xs:24,md:12,children:(0,n.jsx)(i.Z.Item,{name:"branch_code",label:"รหัสสาขา *",rules:[{required:!0,message:"กรุณากรอกรหัสสาขา"},{pattern:/^[A-Za-z0-9]+$/,message:"รหัสสาขาต้องเป็นตัวอักษรภาษาอังกฤษหรือตัวเลข"}],children:(0,n.jsx)(s.default,{size:"large",placeholder:"เช่น B001",maxLength:20})})})]}),(0,n.jsx)(i.Z.Item,{name:"address",label:"ที่อยู่",children:(0,n.jsx)(P,{rows:3,placeholder:"ที่อยู่สาขา",style:{borderRadius:12}})}),(0,n.jsxs)(c.Z,{gutter:24,children:[(0,n.jsx)(o.Z,{xs:24,md:12,children:(0,n.jsx)(i.Z.Item,{name:"phone",label:"เบอร์โทรศัพท์",children:(0,n.jsx)(s.default,{size:"large",placeholder:"02xxxxxxx",maxLength:20})})}),(0,n.jsx)(o.Z,{xs:24,md:12,children:(0,n.jsx)(i.Z.Item,{name:"tax_id",label:"เลขประจำตัวผู้เสียภาษี (Tax ID)",children:(0,n.jsx)(s.default,{size:"large",placeholder:"ระบุเลขผู้เสียภาษี",maxLength:50})})})]}),(0,n.jsx)(i.Z.Item,{name:"is_active",label:"สถานะ",valuePropName:"checked",children:(0,n.jsx)(x.Z,{checkedChildren:"เปิดใช้งาน",unCheckedChildren:"ปิดปรับปรุง"})}),(0,n.jsxs)("div",{style:{marginTop:32,display:"flex",justifyContent:"flex-end",gap:12},children:[(0,n.jsx)(h.ZP,{size:"large",onClick:D,style:{borderRadius:12,minWidth:100},children:"ยกเลิก"}),(0,n.jsx)(h.ZP,{type:"primary",htmlType:"submit",loading:g,size:"large",style:{borderRadius:12,minWidth:120,background:"#7c3aed",border:"none"},children:S?"บันทึกการแก้ไข":"สร้างสาขา"})]})]})})]})}}},function(e){e.O(0,[8024,4736,8592,1744],function(){return e(e.s=89212)}),_N_E=e.O()}]);