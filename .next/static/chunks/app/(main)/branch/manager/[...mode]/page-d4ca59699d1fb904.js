(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8012],{89212:function(e,a,r){Promise.resolve().then(r.bind(r,54531))},54531:function(e,a,r){"use strict";r.r(a),r.d(a,{default:function(){return z}});var t=r(57437),n=r(2265),s=r(88589),i=r(19878),l=r(64625),d=r(48651),c=r(50742),o=r(47451),h=r(69410),u=r(66487),x=r(99376),m=r(29),p=r.n(m);let{Title:f,Text:g}=r(19683).default,b={minHeight:"100vh",background:"#f8f9fc",paddingBottom:40},j=()=>(0,t.jsx)(p(),{id:"d6a7379aac763388",children:".manage-form-card .ant-form-item-label label{font-weight:600;color:#374151}.manage-form-card .ant-input,.manage-form-card .ant-input-number,.manage-form-card .ant-select-selector{-webkit-border-radius:12px!important;-moz-border-radius:12px!important;border-radius:12px!important;padding-top:8px;padding-bottom:8px}"});var y=r(1665),Z=r(14362),k=r(97235),v=r(25193),_=r(37410),w=r(20148);let{TextArea:C}=s.default;function z(e){let{params:a}=e,r=(0,x.useRouter)(),[m]=i.Z.useForm(),[p,f]=(0,n.useState)(!1),[g,z]=(0,n.useState)(!1),{user:I,loading:P}=(0,Z.a)(),{message:T,modal:N}=l.Z.useApp(),B=a.mode[0],E=a.mode[1]||null,L="edit"===B&&!!E,O=(0,n.useCallback)(async()=>{f(!0);try{let e=await y.x.getById(E);m.setFieldsValue({branch_name:e.branch_name,branch_code:e.branch_code,address:e.address,phone:e.phone,tax_id:e.tax_id,is_active:e.is_active})}catch(e){console.error(e),T.error("ไม่สามารถดึงข้อมูลสาขาได้"),r.push("/branch")}finally{f(!1)}},[E,m,r,T]);(0,n.useEffect)(()=>{if(!P&&I){if("Admin"!==I.role){r.push("/");return}L&&O()}},[P,I,L,O,r]);let R=async e=>{z(!0);try{let a=await (0,k.P)();L?(await y.x.update(E,e,void 0,a),T.success("อัปเดตสาขาสำเร็จ")):(await y.x.create(e,void 0,a),T.success("สร้างสาขาสำเร็จ")),r.push("/branch")}catch(e){console.error(e),T.error(e.message||"เกิดข้อผิดพลาดในการบันทึกข้อมูล")}finally{z(!1)}},q=()=>r.push("/branch");return P||L&&p?(0,t.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",background:"#f8f9fc"},children:(0,t.jsx)(d.Z,{size:"large"})}):(0,t.jsxs)("div",{style:b,children:[(0,t.jsx)(j,{}),(0,t.jsx)(w.Z,{title:L?"แก้ไขสาขา":"เพิ่มสาขา",subtitle:"ข้อมูลสาขาสำหรับระบบ POS",onBack:q,actions:L?(0,t.jsx)(c.ZP,{danger:!0,onClick:()=>{E&&N.confirm({title:"ยืนยันการลบสาขา",content:"คุณต้องการลบสาขานี้หรือไม่?",okText:"ลบ",okType:"danger",cancelText:"ยกเลิก",centered:!0,onOk:async()=>{try{let e=await (0,k.P)();await y.x.delete(E,void 0,e),T.success("ลบสาขาสำเร็จ"),r.push("/branch")}catch(e){T.error("ไม่สามารถลบสาขาได้")}}})},children:"ลบ"}):void 0}),(0,t.jsx)(v.Z,{maxWidth:900,children:(0,t.jsx)("div",{className:"manage-form-card",children:(0,t.jsx)(_.Z,{children:(0,t.jsxs)(i.Z,{form:m,layout:"vertical",onFinish:R,requiredMark:!1,autoComplete:"off",initialValues:{is_active:!0},children:[(0,t.jsxs)(o.Z,{gutter:24,children:[(0,t.jsx)(h.Z,{xs:24,md:12,children:(0,t.jsx)(i.Z.Item,{name:"branch_name",label:"ชื่อสาขา *",rules:[{required:!0,message:"กรุณากรอกชื่อสาขา"}],children:(0,t.jsx)(s.default,{size:"large",placeholder:"ระบุชื่อสาขา",maxLength:100})})}),(0,t.jsx)(h.Z,{xs:24,md:12,children:(0,t.jsx)(i.Z.Item,{name:"branch_code",label:"รหัสสาขา *",rules:[{required:!0,message:"กรุณากรอกรหัสสาขา"},{pattern:/^[A-Za-z0-9]+$/,message:"รหัสสาขาต้องเป็นตัวอักษรภาษาอังกฤษหรือตัวเลข"}],children:(0,t.jsx)(s.default,{size:"large",placeholder:"เช่น B001",maxLength:20})})})]}),(0,t.jsx)(i.Z.Item,{name:"address",label:"ที่อยู่",children:(0,t.jsx)(C,{rows:3,placeholder:"ที่อยู่สาขา",style:{borderRadius:12}})}),(0,t.jsxs)(o.Z,{gutter:24,children:[(0,t.jsx)(h.Z,{xs:24,md:12,children:(0,t.jsx)(i.Z.Item,{name:"phone",label:"เบอร์โทรศัพท์",children:(0,t.jsx)(s.default,{size:"large",placeholder:"02xxxxxxx",maxLength:20})})}),(0,t.jsx)(h.Z,{xs:24,md:12,children:(0,t.jsx)(i.Z.Item,{name:"tax_id",label:"เลขประจำตัวผู้เสียภาษี (Tax ID)",children:(0,t.jsx)(s.default,{size:"large",placeholder:"ระบุเลขผู้เสียภาษี",maxLength:50})})})]}),(0,t.jsx)(i.Z.Item,{name:"is_active",label:"สถานะ",valuePropName:"checked",children:(0,t.jsx)(u.Z,{checkedChildren:"เปิดใช้งาน",unCheckedChildren:"ปิดปรับปรุง"})}),(0,t.jsxs)("div",{style:{marginTop:32,display:"flex",justifyContent:"flex-end",gap:12},children:[(0,t.jsx)(c.ZP,{size:"large",onClick:q,style:{borderRadius:12,minWidth:100},children:"ยกเลิก"}),(0,t.jsx)(c.ZP,{type:"primary",htmlType:"submit",loading:g,size:"large",style:{borderRadius:12,minWidth:120,background:"#7c3aed",border:"none"},children:L?"บันทึกการแก้ไข":"สร้างสาขา"})]})]})})})})]})}}},function(e){e.O(0,[8024,4736,8592,1744],function(){return e(e.s=89212)}),_N_E=e.O()}]);