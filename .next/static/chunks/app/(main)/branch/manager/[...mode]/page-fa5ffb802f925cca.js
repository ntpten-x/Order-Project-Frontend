(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8012],{89212:function(e,t,r){Promise.resolve().then(r.bind(r,54531))},54531:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return S}});var a=r(57437),n=r(2265),i=r(88589),o=r(19878),l=r(64625),c=r(48651),d=r(50742),s=r(47451),u=r(69410),h=r(80336),f=r(99376),m=r(29),b=r.n(m),p=r(39486),g=r(36799);let{Title:x,Text:y}=p.default,j={minHeight:"100vh",background:"#f8f9fc",paddingBottom:40},v=()=>(0,a.jsx)(b(),{id:"d6a7379aac763388",children:".manage-form-card .ant-form-item-label label{font-weight:600;color:#374151}.manage-form-card .ant-input,.manage-form-card .ant-input-number,.manage-form-card .ant-select-selector{-webkit-border-radius:12px!important;-moz-border-radius:12px!important;border-radius:12px!important;padding-top:8px;padding-bottom:8px}"});var k=r(1665),w=r(14362),C=r(97235),Z=r(25193),P=r(37410),_=r(20148);let{TextArea:E}=i.default;function S(e){let{params:t}=e,r=(0,f.useRouter)(),[m]=o.Z.useForm(),[b,p]=(0,n.useState)(!1),[x,y]=(0,n.useState)(!1),{user:S,loading:T}=(0,w.a)(),{message:I,modal:L}=l.Z.useApp(),R=t.mode[0],O=t.mode[1]||null,z="edit"===R&&!!O,H=(0,n.useCallback)(async()=>{p(!0);try{let e=await k.x.getById(O);m.setFieldsValue({branch_name:e.branch_name,branch_code:e.branch_code,address:e.address,phone:e.phone,tax_id:e.tax_id,is_active:e.is_active})}catch(e){console.error(e),I.error((0,g.t)("branch.form.loadError")),r.push("/branch")}finally{p(!1)}},[O,m,r,I]);(0,n.useEffect)(()=>{if(!T&&S){if("Admin"!==S.role){r.push("/");return}z&&H()}},[T,S,z,H,r]);let M=async e=>{y(!0);try{let t=await (0,C.P)();z?(await k.x.update(O,e,void 0,t),I.success((0,g.t)("branch.form.updateSuccess"))):(await k.x.create(e,void 0,t),I.success((0,g.t)("branch.form.createSuccess"))),r.push("/branch")}catch(e){console.error(e),I.error(e.message||(0,g.t)("branch.form.saveError"))}finally{y(!1)}},B=()=>r.push("/branch");return T||z&&b?(0,a.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",background:"#f8f9fc"},children:(0,a.jsx)(c.Z,{size:"large"})}):(0,a.jsxs)("div",{style:j,children:[(0,a.jsx)(v,{}),(0,a.jsx)(_.Z,{title:z?(0,g.t)("branch.form.titleEdit"):(0,g.t)("branch.form.titleCreate"),subtitle:(0,g.t)("branch.form.subtitle"),onBack:B,actions:z?(0,a.jsx)(d.ZP,{danger:!0,onClick:()=>{O&&L.confirm({title:(0,g.t)("branch.form.deleteTitle"),content:(0,g.t)("branch.form.deleteContent"),okText:(0,g.t)("branch.delete.ok"),okType:"danger",cancelText:(0,g.t)("branch.delete.cancel"),centered:!0,onOk:async()=>{try{let e=await (0,C.P)();await k.x.delete(O,void 0,e),I.success((0,g.t)("branch.form.deleteSuccess")),r.push("/branch")}catch(e){I.error((0,g.t)("branch.form.deleteError"))}}})},children:(0,g.t)("branch.delete.ok")}):void 0}),(0,a.jsx)(Z.Z,{maxWidth:900,children:(0,a.jsx)("div",{className:"manage-form-card",children:(0,a.jsx)(P.Z,{children:(0,a.jsxs)(o.Z,{form:m,layout:"vertical",onFinish:M,requiredMark:!1,autoComplete:"off",initialValues:{is_active:!0},children:[(0,a.jsxs)(s.Z,{gutter:24,children:[(0,a.jsx)(u.Z,{xs:24,md:12,children:(0,a.jsx)(o.Z.Item,{name:"branch_name",label:(0,g.t)("branch.form.fields.nameLabel"),rules:[{required:!0,message:(0,g.t)("branch.form.fields.nameRequired")}],children:(0,a.jsx)(i.default,{size:"large",placeholder:(0,g.t)("branch.form.fields.namePlaceholder"),maxLength:100})})}),(0,a.jsx)(u.Z,{xs:24,md:12,children:(0,a.jsx)(o.Z.Item,{name:"branch_code",label:(0,g.t)("branch.form.fields.codeLabel"),rules:[{required:!0,message:(0,g.t)("branch.form.fields.codeRequired")},{pattern:/^[A-Za-z0-9]+$/,message:(0,g.t)("branch.form.fields.codePattern")}],children:(0,a.jsx)(i.default,{size:"large",placeholder:(0,g.t)("branch.form.fields.codePlaceholder"),maxLength:20})})})]}),(0,a.jsx)(o.Z.Item,{name:"address",label:(0,g.t)("branch.form.fields.addressLabel"),children:(0,a.jsx)(E,{rows:3,placeholder:(0,g.t)("branch.form.fields.addressPlaceholder"),style:{borderRadius:12}})}),(0,a.jsxs)(s.Z,{gutter:24,children:[(0,a.jsx)(u.Z,{xs:24,md:12,children:(0,a.jsx)(o.Z.Item,{name:"phone",label:(0,g.t)("branch.form.fields.phoneLabel"),children:(0,a.jsx)(i.default,{size:"large",placeholder:(0,g.t)("branch.form.fields.phonePlaceholder"),maxLength:20})})}),(0,a.jsx)(u.Z,{xs:24,md:12,children:(0,a.jsx)(o.Z.Item,{name:"tax_id",label:(0,g.t)("branch.form.fields.taxIdLabel"),children:(0,a.jsx)(i.default,{size:"large",placeholder:(0,g.t)("branch.form.fields.taxIdPlaceholder"),maxLength:50})})})]}),(0,a.jsx)(o.Z.Item,{name:"is_active",label:(0,g.t)("branch.form.fields.statusLabel"),valuePropName:"checked",children:(0,a.jsx)(h.Z,{checkedChildren:(0,g.t)("branch.stats.active"),unCheckedChildren:(0,g.t)("branch.stats.inactive")})}),(0,a.jsxs)("div",{style:{marginTop:32,display:"flex",justifyContent:"flex-end",gap:12},children:[(0,a.jsx)(d.ZP,{size:"large",onClick:B,style:{borderRadius:12,minWidth:100},children:(0,g.t)("branch.form.back")}),(0,a.jsx)(d.ZP,{type:"primary",htmlType:"submit",loading:x,size:"large",style:{borderRadius:12,minWidth:120,background:"#7c3aed",border:"none"},children:z?(0,g.t)("branch.form.submitEdit"):(0,g.t)("branch.form.submitCreate")})]})]})})})})]})}},25193:function(e,t,r){"use strict";r.d(t,{Z:function(){return o}});var a=r(57437);r(2265);var n=r(38616),i=r(87530);function o(e){let{children:t,maxWidth:r=i.H.pageMaxWidth,style:o}=e,l=n.default.useBreakpoint().md?i.H.pagePaddingXDesktop:i.H.pagePaddingXMobile;return(0,a.jsx)("div",{style:{width:"100%",maxWidth:r,margin:"0 auto",padding:"".concat(i.H.pagePaddingY,"px ").concat(l,"px"),...o},children:t})}},20148:function(e,t,r){"use strict";r.d(t,{Z:function(){return u}});var a=r(57437);r(2265);var n=r(17588),i=r(2651),o=r(38616),l=r(10868),c=r(50742),d=r(39486),s=r(87530);function u(e){let{title:t,subtitle:r,icon:u,onBack:h,actions:f,style:m}=e,{token:b}=i.default.useToken(),p=o.default.useBreakpoint().md?s.H.pagePaddingXDesktop:s.H.pagePaddingXMobile;return(0,a.jsx)("div",{style:{padding:"".concat(s.H.pagePaddingY,"px ").concat(p,"px"),background:b.colorBgContainer,borderBottom:"1px solid ".concat(b.colorBorderSecondary),...m},children:(0,a.jsxs)(l.Z,{align:"center",justify:"space-between",wrap:"wrap",gap:12,style:{maxWidth:s.H.pageMaxWidth,margin:"0 auto"},children:[(0,a.jsxs)(l.Z,{align:"center",gap:12,style:{minWidth:0},children:[h&&(0,a.jsx)(c.ZP,{type:"text","aria-label":"ย้อนกลับ",icon:(0,a.jsx)(n.Z,{}),onClick:h,style:{borderRadius:12,width:44,height:44}}),u&&(0,a.jsx)("div",{style:{width:44,height:44,borderRadius:14,display:"grid",placeItems:"center",background:b.colorFillTertiary,color:b.colorText},children:u}),(0,a.jsxs)("div",{style:{minWidth:0},children:[(0,a.jsx)(d.default.Title,{level:4,style:{margin:0},children:t}),r&&(0,a.jsx)(d.default.Text,{type:"secondary",children:r})]})]}),f&&(0,a.jsx)(l.Z,{gap:8,wrap:"wrap",children:f})]})})}},37410:function(e,t,r){"use strict";r.d(t,{Z:function(){return d}});var a=r(57437);r(2265);var n=r(2651),i=r(96931),o=r(10868),l=r(39486),c=r(87530);function d(e){let{title:t,extra:r,children:d,style:s}=e,{token:u}=n.default.useToken();return(0,a.jsx)(i.Z,{size:"small",variant:"outlined",style:{borderRadius:c.H.cardRadiusLG,...s},styles:{header:t?{borderBottomColor:u.colorBorderSecondary}:{display:"none"}},title:t?(0,a.jsxs)(o.Z,{align:"center",justify:"space-between",gap:12,children:[(0,a.jsx)(l.default.Text,{strong:!0,children:t}),r]}):void 0,children:d})}},87530:function(e,t,r){"use strict";r.d(t,{H:function(){return a}});let a={pageMaxWidth:1200,pagePaddingXMobile:16,pagePaddingXDesktop:24,pagePaddingY:16,sectionGap:16,cardRadius:16,cardRadiusLG:20,cardShadow:"0 10px 24px rgba(15, 23, 42, 0.08)",surfaceBg:"#ffffff",surfaceBorder:"#e2e8f0"}},14362:function(e,t,r){"use strict";r.d(t,{AuthProvider:function(){return h},a:function(){return f}});var a=r(57437),n=r(2265),i=r(99376),o=r(5447),l=r(84859),c=r(48651),d=r(3369),s=r(36799);let u=(0,n.createContext)(void 0),h=e=>{let{children:t}=e,[r,h]=(0,n.useState)(null),[f,m]=(0,n.useState)(!0),b=(0,i.useRouter)(),p=(0,i.usePathname)(),g=async()=>{try{let e=await o.O.getMe();h(e)}catch(e){h(null)}finally{m(!1)}};(0,n.useEffect)(()=>{g()},[]);let{showLoading:x,hideLoading:y}=(0,d.x)();(0,n.useEffect)(()=>{f||r||"/login"===p||b.push("/login")},[r,f,p,b]);let j=async e=>{try{x((0,s.t)("auth.loadingLogin"));let t=await o.O.getCsrfToken(),{token:r,...a}=await o.O.login(e,t);h(a),b.push("/")}catch(e){throw e}finally{y()}},v=async()=>{try{x((0,s.t)("auth.loadingLogout")),await o.O.logout(),l.x.clearQueue(),h(null),b.push("/login")}catch(e){console.error("Logout error:",e)}finally{y()}};return f?(0,a.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center",background:"#ffffff"},children:(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"12px",padding:"24px",background:"#ffffff",borderRadius:"20px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.1)"},children:[(0,a.jsx)(c.Z,{size:"large"}),(0,a.jsx)("div",{style:{color:"#64748b",fontSize:"14px",fontWeight:500},children:"กำลังตรวจสอบสิทธิ์..."})]})}):r||"/login"===p?(0,a.jsx)(u.Provider,{value:{user:r,loading:f,login:j,logout:v,checkAuth:g},children:t}):null},f=()=>{let e=(0,n.useContext)(u);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}},3369:function(e,t,r){"use strict";r.d(t,{GlobalLoadingProvider:function(){return c},O:function(){return s},x:function(){return d}});var a=r(57437),n=r(2265),i=r(48651);let o=(0,n.createContext)(void 0),l=(0,n.createContext)(void 0),c=e=>{let{children:t}=e,[r,c]=(0,n.useState)({}),[d,s]=(0,n.useState)(void 0),u=(0,n.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default";c(e=>({...e,[t]:(e[t]||0)+1})),e&&s(e)},[]),h=(0,n.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";c(t=>{if(!t[e])return t;let r={...t};return r[e]-=1,r[e]<=0&&delete r[e],r})},[]),f=(0,n.useCallback)(()=>{c({}),s(void 0)},[]),m=Object.keys(r).length>0,b=(0,n.useMemo)(()=>({isLoading:m,loadingMessage:d}),[m,d]),p=(0,n.useMemo)(()=>({showLoading:u,hideLoading:h,resetLoading:f}),[u,h,f]);return(0,a.jsx)(l.Provider,{value:p,children:(0,a.jsxs)(o.Provider,{value:b,children:[t,m&&(0,a.jsx)("div",{role:"status","aria-live":"polite",className:"global-loading-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:13e3,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(255, 255, 255, 0.7)",backdropFilter:"blur(6px)",WebkitBackdropFilter:"blur(6px)",transition:"opacity 0.25s ease"},children:(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:16,background:"rgba(255, 255, 255, 0.95)",padding:"28px 40px",borderRadius:20,boxShadow:"0 10px 32px rgba(15, 23, 42, 0.14)",border:"1px solid rgba(148, 163, 184, 0.35)",minWidth:240,textAlign:"center"},children:[(0,a.jsx)(i.Z,{size:"large"}),d&&(0,a.jsx)("div",{style:{fontSize:16,color:"#334155",fontWeight:600,letterSpacing:"0.01em"},children:d})]})})]})})};function d(){let e=(0,n.useContext)(o),t=(0,n.useContext)(l);if(!e||!t)throw Error("useGlobalLoading must be used within a GlobalLoadingProvider");return(0,n.useMemo)(()=>({...e,...t}),[e,t])}function s(){let e=(0,n.useContext)(l);if(!e)throw Error("useGlobalLoadingDispatch must be used within a GlobalLoadingProvider");return e}},81026:function(e,t,r){"use strict";r.d(t,{E:function(){return i},M:function(){return n}});var a=r(20019);let n=a.Ryn({id:a.Z_8(),branch_name:a.Z_8(),branch_code:a.Z_8(),address:a.Z_8().optional().nullable(),phone:a.Z_8().optional().nullable(),tax_id:a.Z_8().optional().nullable(),is_active:a.O72().default(!0),create_date:a.Z_8().or(a.hTZ()).transform(e=>new Date(e))}),i=a.IXX(n)},1665:function(e,t,r){"use strict";r.d(t,{x:function(){return c}});var a=r(71567),n=r(2913),i=r(81026),o=r(98170);let l=a.q.POS.BRANCH,c={getAll:async e=>{let t=(0,n.b)("GET",l),r={};e&&(r.Cookie=e);let a=await fetch(t,{cache:"no-store",credentials:"include",headers:r});if(!a.ok)throw Error("Failed to fetch branches");let c=await a.json();return i.E.parse((0,o.hH)(c))},getById:async(e,t)=>{let r=(0,n.b)("GET","".concat(l,"/").concat(e)),a={};t&&(a.Cookie=t);let c=await fetch(r,{cache:"no-store",credentials:"include",headers:a});if(!c.ok)throw Error("Failed to fetch branch");let d=await c.json();return i.M.parse((0,o.hH)(d))},create:async(e,t,r)=>{let a=(0,n.b)("POST",l),i={"Content-Type":"application/json"};t&&(i.Cookie=t),r&&(i["X-CSRF-Token"]=r);let c=await fetch(a,{method:"POST",body:JSON.stringify(e),headers:i,credentials:"include"});if(!c.ok){let e=await c.json().catch(()=>({}));throw Error((0,o.i_)(e,"Failed to create branch"))}return(0,o.hH)(await c.json())},update:async(e,t,r,a)=>{let i=(0,n.b)("PUT","".concat(l,"/").concat(e)),c={"Content-Type":"application/json"};r&&(c.Cookie=r),a&&(c["X-CSRF-Token"]=a);let d=await fetch(i,{method:"PUT",body:JSON.stringify(t),headers:c,credentials:"include"});if(!d.ok){let e=await d.json().catch(()=>({}));throw Error((0,o.i_)(e,"Failed to update branch"))}return(0,o.hH)(await d.json())},delete:async(e,t,r)=>{let a=(0,n.b)("DELETE","".concat(l,"/").concat(e)),i={};t&&(i.Cookie=t),r&&(i["X-CSRF-Token"]=r);let c=await fetch(a,{method:"DELETE",headers:i,credentials:"include"});if(!c.ok){let e=await c.json().catch(()=>({}));throw Error((0,o.i_)(e,"Failed to delete branch"))}}}},84859:function(e,t,r){"use strict";r.d(t,{M:function(){return c},x:function(){return l}});let a="pos_offline_queue",n=()=>{let e=localStorage.getItem(a);return e?JSON.parse(e):[]},i=e=>{let t=Date.now();return e.filter(e=>t-e.timestamp<=6048e5)},o=e=>{localStorage.setItem(a,JSON.stringify(e))},l={addToQueue:(e,t)=>{let r=i(n()),a={id:"offline-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),type:e,payload:t,timestamp:Date.now(),retryCount:0};return o([...r,a]),a},getQueue:()=>n(),removeFromQueue:e=>{o(n().filter(t=>t.id!==e))},incrementRetry:(e,t)=>{o(n().map(r=>r.id===e?{...r,retryCount:r.retryCount+1,lastError:t}:r))},clearQueue:()=>{localStorage.removeItem(a)},pruneExceeded:()=>{o(i(n()).filter(e=>e.retryCount<=5))}},c={maxRetry:5,backoff:e=>Math.min(3e4,2e3*e)}},97235:function(e,t,r){"use strict";r.d(t,{P:function(){return l}});var a=r(5447);let n=null,i=0,o=null;async function l(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=Date.now();return!e&&n&&t-i<6e5?n:(o||(o=a.O.getCsrfToken().then(e=>(n=e||"",i=Date.now(),n)).finally(()=>{o=null})),o)}}},function(e){e.O(0,[253,1522,3418,742,9486,4252,3916,8651,6931,4159,3831,2224,3248,8879,8589,19,4221,9878,2239,3151,9385,2971,2117,1744],function(){return e(e.s=89212)}),_N_E=e.O()}]);