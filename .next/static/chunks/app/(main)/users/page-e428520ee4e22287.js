(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9386],{90880:function(e,t,r){Promise.resolve().then(r.bind(r,82151))},82151:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return H}});var a=r(57437),s=r(2265),n=r(19683),o=r(34029),i=r(53743),l=r(50742),d=r(41361),f=r(99376),c=r(29),x=r.n(c),p=r(96931),m=r(45235),y=r(35713),b=r(89970),u=r(91652),g=r(80009),h=r(89245),j=r(56531),v=r(15883),k=r(13377),w=r(26349);let{Title:Z,Text:z}=n.default,R={minHeight:"100vh",background:"#f8f9fc",paddingBottom:40},_={background:"linear-gradient(135deg, #1e40af 0%, #3b82f6 100%)",padding:"30px 24px 80px",position:"relative",borderBottomLeftRadius:32,borderBottomRightRadius:32,marginBottom:-40,boxShadow:"0 10px 30px -10px rgba(37, 99, 235, 0.4)"},S={maxWidth:1200,margin:"0 auto",padding:"0 24px",position:"relative",zIndex:2},C=e=>({borderRadius:20,border:"none",overflow:"hidden",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",background:"#fff",boxShadow:e?"0 10px 30px rgba(37, 99, 235, 0.15)":"0 4px 20px rgba(0,0,0,0.05)",transform:e?"translateY(-4px)":"none",position:"relative"}),I=()=>(0,a.jsx)(x(),{id:"985ac2baae04cebc",children:"@-webkit-keyframes fadeInUp{from{opacity:0;-webkit-transform:translatey(20px);transform:translatey(20px)}to{opacity:1;-webkit-transform:translatey(0);transform:translatey(0)}}@-moz-keyframes fadeInUp{from{opacity:0;-moz-transform:translatey(20px);transform:translatey(20px)}to{opacity:1;-moz-transform:translatey(0);transform:translatey(0)}}@-o-keyframes fadeInUp{from{opacity:0;-o-transform:translatey(20px);transform:translatey(20px)}to{opacity:1;-o-transform:translatey(0);transform:translatey(0)}}@keyframes fadeInUp{from{opacity:0;-webkit-transform:translatey(20px);-moz-transform:translatey(20px);-o-transform:translatey(20px);transform:translatey(20px)}to{opacity:1;-webkit-transform:translatey(0);-moz-transform:translatey(0);-o-transform:translatey(0);transform:translatey(0)}}@-webkit-keyframes float{0%{-webkit-transform:translatey(0px);transform:translatey(0px)}50%{-webkit-transform:translatey(-10px);transform:translatey(-10px)}100%{-webkit-transform:translatey(0px);transform:translatey(0px)}}@-moz-keyframes float{0%{-moz-transform:translatey(0px);transform:translatey(0px)}50%{-moz-transform:translatey(-10px);transform:translatey(-10px)}100%{-moz-transform:translatey(0px);transform:translatey(0px)}}@-o-keyframes float{0%{-o-transform:translatey(0px);transform:translatey(0px)}50%{-o-transform:translatey(-10px);transform:translatey(-10px)}100%{-o-transform:translatey(0px);transform:translatey(0px)}}@keyframes float{0%{-webkit-transform:translatey(0px);-moz-transform:translatey(0px);-o-transform:translatey(0px);transform:translatey(0px)}50%{-webkit-transform:translatey(-10px);-moz-transform:translatey(-10px);-o-transform:translatey(-10px);transform:translatey(-10px)}100%{-webkit-transform:translatey(0px);-moz-transform:translatey(0px);-o-transform:translatey(0px);transform:translatey(0px)}}.decorative-shape{position:absolute;background:rgba(255,255,255,.1);-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);-webkit-border-radius:50%;-moz-border-radius:50%;border-radius:50%}.shape-1{width:300px;height:300px;right:-100px;top:-100px}.shape-2{width:150px;height:150px;left:10%;bottom:20px;-webkit-animation:float 6s ease-in-out infinite;-moz-animation:float 6s ease-in-out infinite;-o-animation:float 6s ease-in-out infinite;animation:float 6s ease-in-out infinite}.action-btn{opacity:.7;-webkit-transition:all.2s;-moz-transition:all.2s;-o-transition:all.2s;transition:all.2s}.action-btn:hover{opacity:1;-webkit-transform:scale(1.1);-moz-transform:scale(1.1);-ms-transform:scale(1.1);-o-transform:scale(1.1);transform:scale(1.1)}"}),T=e=>{let{onRefresh:t,onAdd:r}=e;return(0,a.jsxs)("div",{style:_,children:[(0,a.jsx)("div",{className:"decorative-shape shape-1"}),(0,a.jsx)("div",{className:"decorative-shape shape-2"}),(0,a.jsx)("div",{style:{maxWidth:1200,margin:"0 auto",position:"relative",zIndex:1},children:(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:16},children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12,marginBottom:8},children:[(0,a.jsx)("div",{style:{background:"rgba(255,255,255,0.2)",padding:10,borderRadius:14,display:"flex",backdropFilter:"blur(4px)"},children:(0,a.jsx)(d.Z,{style:{fontSize:28,color:"#fff"}})}),(0,a.jsx)(Z,{level:2,style:{margin:0,color:"#fff",fontWeight:800},children:"จัดการผู้ใช้"})]}),(0,a.jsx)(z,{style:{color:"rgba(255,255,255,0.9)",fontSize:16,display:"block",paddingLeft:4},children:"บริหารจัดการสิทธิ์และข้อมูลผู้ใช้งานในระบบ"})]}),(0,a.jsxs)("div",{style:{display:"flex",gap:12},children:[(0,a.jsx)(l.ZP,{icon:(0,a.jsx)(h.Z,{}),onClick:t,size:"large",style:{background:"rgba(255,255,255,0.15)",border:"1px solid rgba(255,255,255,0.3)",color:"#fff",borderRadius:12,backdropFilter:"blur(4px)"},children:"รีเฟรช"}),(0,a.jsx)(l.ZP,{type:"primary",icon:(0,a.jsx)(j.Z,{}),onClick:r,size:"large",style:{background:"#fff",color:"#2563eb",border:"none",borderRadius:12,fontWeight:600,boxShadow:"0 4px 15px rgba(0,0,0,0.2)"},children:"เพิ่มผู้ใช้"})]})]})})]})},W=e=>{let{totalUsers:t,activeUsers:r,onlineUsers:s}=e;return(0,a.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:16,marginTop:-40,marginBottom:32,position:"relative",zIndex:2,maxWidth:1200,marginLeft:"auto",marginRight:"auto",padding:"0 24px",justifyContent:"center"},children:[(0,a.jsx)(p.Z,{variant:"borderless",style:{borderRadius:16,boxShadow:"0 10px 30px rgba(0,0,0,0.08)"},children:(0,a.jsx)(m.Z,{title:(0,a.jsx)(z,{type:"secondary",children:"ผู้ใช้ทั้งหมด"}),value:t,prefix:(0,a.jsx)(d.Z,{style:{color:"#3b82f6",background:"#eff6ff",padding:8,borderRadius:"50%"}}),styles:{content:{fontWeight:700}}})}),(0,a.jsx)(p.Z,{variant:"borderless",style:{borderRadius:16,boxShadow:"0 10px 30px rgba(0,0,0,0.08)"},children:(0,a.jsx)(m.Z,{title:(0,a.jsx)(z,{type:"secondary",children:"ออนไลน์/ใช้งาน"}),value:r,styles:{content:{color:"#10b981",fontWeight:700}},prefix:(0,a.jsx)(y.Z,{status:"processing",color:"#10b981"})})}),(0,a.jsx)(p.Z,{variant:"borderless",style:{borderRadius:16,boxShadow:"0 10px 30px rgba(0,0,0,0.08)"},children:(0,a.jsx)(m.Z,{title:(0,a.jsx)(z,{type:"secondary",children:"ผู้ดูแลระบบ"}),value:s,styles:{content:{color:"#f59e0b",fontWeight:700}},prefix:(0,a.jsx)(v.Z,{style:{color:"#f59e0b",background:"#fffbeb",padding:8,borderRadius:"50%"}})})})]})},B=e=>{var t,r,s;let{user:n,onEdit:o,onDelete:i}=e,d=(null===(t=n.roles)||void 0===t?void 0:t.roles_name)||"";return(0,a.jsxs)(p.Z,{hoverable:!0,style:C(n.is_active||!1),styles:{body:{padding:20}},actions:[(0,a.jsx)(b.Z,{title:"แก้ไขข้อมูล",children:(0,a.jsx)(l.ZP,{type:"text",icon:(0,a.jsx)(k.Z,{style:{color:"#3b82f6"}}),onClick:()=>o(n),children:"แก้ไข"})},"edit"),(0,a.jsx)(b.Z,{title:"ลบผู้ใช้",children:(0,a.jsx)(l.ZP,{type:"text",danger:!0,icon:(0,a.jsx)(w.Z,{}),onClick:()=>i(n),children:"ลบ"})},"delete")],children:[(0,a.jsxs)("div",{style:{display:"flex",alignItems:"flex-start",gap:16,marginBottom:16},children:[(0,a.jsx)(u.Z,{size:64,style:{backgroundColor:"Admin"===d?"#f59e0b":"Manager"===d?"#eb2f96":"#3b82f6",fontSize:24,boxShadow:"0 4px 12px rgba(0,0,0,0.1)",border:n.is_active?"3px solid #10b981":"3px solid transparent",transition:"all 0.3s ease"},icon:(0,a.jsx)(v.Z,{})}),(0,a.jsx)("div",{style:{flex:1},children:(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(Z,{level:4,style:{margin:0,marginBottom:4,color:"#1f2937"},children:n.name||n.username}),(0,a.jsxs)("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:[(0,a.jsx)(g.Z,{color:"Admin"===d?"gold":"Manager"===d?"magenta":"blue",style:{borderRadius:12,border:"none",padding:"0 10px",margin:0},children:(null===(r=n.roles)||void 0===r?void 0:r.display_name)||(null===(s=n.roles)||void 0===s?void 0:s.roles_name)||"N/A"}),n.branch&&(0,a.jsx)(g.Z,{color:"cyan",style:{borderRadius:12,border:"none",padding:"0 10px",margin:0},children:n.branch.branch_name})]})]}),(0,a.jsx)(b.Z,{title:n.is_active?"กำลังใช้งาน":"ออฟไลน์",children:n.is_active?(0,a.jsx)("div",{style:{width:12,height:12,borderRadius:"50%",background:"#10b981",boxShadow:"0 0 0 3px rgba(16, 185, 129, 0.2)"}}):(0,a.jsx)("div",{style:{width:12,height:12,borderRadius:"50%",background:"#d1d5db"}})})]})})]}),(0,a.jsxs)("div",{style:{background:"#f9fafb",padding:12,borderRadius:12},children:[(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6},children:[(0,a.jsx)(z,{type:"secondary",style:{fontSize:12},children:"สถานะการใช้งาน"}),n.is_active?(0,a.jsxs)(g.Z,{color:"#10b981",style:{margin:0,borderRadius:12,border:"none",padding:"0 10px",display:"flex",alignItems:"center",gap:6},children:[(0,a.jsx)("div",{style:{width:6,height:6,borderRadius:"50%",background:"#fff",boxShadow:"0 0 8px rgba(255,255,255,0.8)"}}),(0,a.jsx)("span",{style:{fontWeight:600},children:"กำลังใช้งาน"})]}):(0,a.jsx)(g.Z,{style:{margin:0,borderRadius:12,border:"none",background:"#f3f4f6",color:"#9ca3af"},children:"ออฟไลน์"})]}),(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:6},children:[(0,a.jsx)(z,{type:"secondary",style:{fontSize:12},children:"สถานะบัญชี"}),(0,a.jsx)(y.Z,{status:n.is_use?"success":"error",text:(0,a.jsx)("span",{style:{fontSize:12},children:n.is_use?"เปิดใช้งาน":"ระงับ"})})]}),(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,a.jsx)(z,{type:"secondary",style:{fontSize:12},children:"เข้าสู่ระบบล่าสุด"}),(0,a.jsx)(z,{style:{fontSize:12,fontWeight:500},children:n.last_login_at?new Date(n.last_login_at).toLocaleDateString("th-TH"):"-"})]})]})]})};var A=r(24675),U=r(26972),P=r(3369),E=r(14362),N=r(48651),D=r(5447),L=r(92719);let{Title:O,Text:F}=n.default;function H(){let e=(0,f.useRouter)(),[t,r]=(0,s.useState)([]),{socket:n}=(0,A.s)(),{execute:c}=(0,U.J)(),{showLoading:x,hideLoading:p}=(0,P.x)(),{user:m,loading:y}=(0,E.a)(),[b,u]=(0,s.useState)("");(0,s.useEffect)(()=>{(async()=>{u(await D.O.getCsrfToken())})()},[]),(0,s.useEffect)(()=>{if(!y&&(!m||"Admin"!==m.role)){let t=setTimeout(()=>{o.ZP.error("คุณไม่มีสิทธิ์เข้าถึงหน้านี้"),e.push("/")},1e3);return()=>clearTimeout(t)}},[m,y,e]);let g=(0,s.useCallback)(async()=>{c(async()=>{r(await L.W.getAllUsers())},"กำลังโหลดข้อมูลผู้ใช้...")},[c]);(0,s.useEffect)(()=>{y||(null==m?void 0:m.role)!=="Admin"||g()},[y,m,g]),(0,s.useEffect)(()=>{if(n)return n.on("users:create",e=>{r(t=>[...t,e]),o.ZP.success("ผู้ใช้ใหม่ ".concat(e.username," ถูกเพิ่มแล้ว"))}),n.on("users:update",e=>{r(t=>t.map(t=>t.id===e.id?e:t))}),n.on("users:delete",e=>{let{id:t}=e;r(e=>e.filter(e=>e.id!==t))}),n.on("users:update-status",e=>{let{id:t,is_active:a}=e;r(e=>e.map(e=>e.id===t?{...e,is_active:a}:e))}),()=>{n.off("users:create"),n.off("users:update"),n.off("users:delete"),n.off("users:update-status")}},[n]);let h=()=>{x(),e.push("/users/manage/add"),setTimeout(()=>p(),1e3)},j=t=>{e.push("/users/manage/edit/".concat(t.id))},v=e=>{i.Z.confirm({title:"ยืนยันการลบผู้ใช้",content:'คุณต้องการลบผู้ใช้ "'.concat(e.name||e.username,'" หรือไม่?'),okText:"ลบ",okType:"danger",cancelText:"ยกเลิก",centered:!0,onOk:async()=>{await c(async()=>{await L.W.deleteUser(e.id,void 0,b),o.ZP.success('ลบผู้ใช้ "'.concat(e.name||e.username,'" สำเร็จ'))},"กำลังลบผู้ใช้งาน...")}})};if(y||!m||"Admin"!==m.role)return(0,a.jsx)("div",{style:{height:"100vh",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",backgroundColor:"#f5f5f5"},children:(0,a.jsx)(N.Z,{size:"large"})});let k=t.filter(e=>e.is_active).length,w=t.filter(e=>{var t;return(null===(t=e.roles)||void 0===t?void 0:t.roles_name)==="Admin"}).length;return(0,a.jsxs)("div",{style:R,children:[(0,a.jsx)(I,{}),(0,a.jsx)(T,{onRefresh:g,onAdd:h}),(0,a.jsx)(W,{totalUsers:t.length,activeUsers:k,onlineUsers:w}),(0,a.jsx)("div",{style:S,children:t.length>0?(0,a.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:24,justifyContent:"center"},children:t.map((e,t)=>(0,a.jsx)("div",{style:{animation:"fadeInUp 0.6s ease-out forwards",animationDelay:"".concat(50*t,"ms"),opacity:0},children:(0,a.jsx)(B,{user:e,onEdit:j,onDelete:v})},e.id))}):(0,a.jsxs)("div",{style:{background:"white",borderRadius:20,padding:"60px 20px",textAlign:"center",boxShadow:"0 4px 20px rgba(0,0,0,0.05)"},children:[(0,a.jsx)(d.Z,{style:{fontSize:64,color:"#e5e7eb",marginBottom:16}}),(0,a.jsx)(O,{level:3,style:{color:"#374151",margin:0},children:"ยังไม่มีผู้ใช้งาน"}),(0,a.jsx)(F,{type:"secondary",children:"เริ่มต้นด้วยการเพิ่มผู้ใช้งานคนแรก"}),(0,a.jsx)("div",{style:{marginTop:24},children:(0,a.jsx)(l.ZP,{type:"primary",onClick:h,children:"เพิ่มผู้ใช้"})})]})})]})}}},function(e){e.O(0,[8024,4736,8592,1744],function(){return e(e.s=90880)}),_N_E=e.O()}]);