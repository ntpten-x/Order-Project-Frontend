(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9386,2456],{90880:function(e,t,r){Promise.resolve().then(r.bind(r,82151))},82151:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return F}});var a=r(57437),n=r(2265),o=r(82646),s=r(34029),i=r(53743),l=r(50742),c=r(41361),d=r(99376),u=r(29),f=r.n(u),p=r(96931),x=r(45235),m=r(35713),y=r(89970),h=r(91652),g=r(80009),b=r(89245),v=r(56531),j=r(15883),k=r(13377),w=r(26349);let{Title:S,Text:_}=o.default,T={minHeight:"100vh",background:"#f8f9fc",paddingBottom:40},C={background:"linear-gradient(135deg, #1e40af 0%, #3b82f6 100%)",padding:"30px 24px 80px",position:"relative",borderBottomLeftRadius:32,borderBottomRightRadius:32,marginBottom:-40,boxShadow:"0 10px 30px -10px rgba(37, 99, 235, 0.4)"},E={maxWidth:1200,margin:"0 auto",padding:"0 24px",position:"relative",zIndex:2},R=e=>({borderRadius:20,border:"none",overflow:"hidden",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",background:"#fff",boxShadow:e?"0 10px 30px rgba(37, 99, 235, 0.15)":"0 4px 20px rgba(0,0,0,0.05)",transform:e?"translateY(-4px)":"none",position:"relative"}),Z=()=>(0,a.jsx)(f(),{id:"985ac2baae04cebc",children:"@-webkit-keyframes fadeInUp{from{opacity:0;-webkit-transform:translatey(20px);transform:translatey(20px)}to{opacity:1;-webkit-transform:translatey(0);transform:translatey(0)}}@-moz-keyframes fadeInUp{from{opacity:0;-moz-transform:translatey(20px);transform:translatey(20px)}to{opacity:1;-moz-transform:translatey(0);transform:translatey(0)}}@-o-keyframes fadeInUp{from{opacity:0;-o-transform:translatey(20px);transform:translatey(20px)}to{opacity:1;-o-transform:translatey(0);transform:translatey(0)}}@keyframes fadeInUp{from{opacity:0;-webkit-transform:translatey(20px);-moz-transform:translatey(20px);-o-transform:translatey(20px);transform:translatey(20px)}to{opacity:1;-webkit-transform:translatey(0);-moz-transform:translatey(0);-o-transform:translatey(0);transform:translatey(0)}}@-webkit-keyframes float{0%{-webkit-transform:translatey(0px);transform:translatey(0px)}50%{-webkit-transform:translatey(-10px);transform:translatey(-10px)}100%{-webkit-transform:translatey(0px);transform:translatey(0px)}}@-moz-keyframes float{0%{-moz-transform:translatey(0px);transform:translatey(0px)}50%{-moz-transform:translatey(-10px);transform:translatey(-10px)}100%{-moz-transform:translatey(0px);transform:translatey(0px)}}@-o-keyframes float{0%{-o-transform:translatey(0px);transform:translatey(0px)}50%{-o-transform:translatey(-10px);transform:translatey(-10px)}100%{-o-transform:translatey(0px);transform:translatey(0px)}}@keyframes float{0%{-webkit-transform:translatey(0px);-moz-transform:translatey(0px);-o-transform:translatey(0px);transform:translatey(0px)}50%{-webkit-transform:translatey(-10px);-moz-transform:translatey(-10px);-o-transform:translatey(-10px);transform:translatey(-10px)}100%{-webkit-transform:translatey(0px);-moz-transform:translatey(0px);-o-transform:translatey(0px);transform:translatey(0px)}}.decorative-shape{position:absolute;background:rgba(255,255,255,.1);-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);-webkit-border-radius:50%;-moz-border-radius:50%;border-radius:50%}.shape-1{width:300px;height:300px;right:-100px;top:-100px}.shape-2{width:150px;height:150px;left:10%;bottom:20px;-webkit-animation:float 6s ease-in-out infinite;-moz-animation:float 6s ease-in-out infinite;-o-animation:float 6s ease-in-out infinite;animation:float 6s ease-in-out infinite}.action-btn{opacity:.7;-webkit-transition:all.2s;-moz-transition:all.2s;-o-transition:all.2s;transition:all.2s}.action-btn:hover{opacity:1;-webkit-transform:scale(1.1);-moz-transform:scale(1.1);-ms-transform:scale(1.1);-o-transform:scale(1.1);transform:scale(1.1)}"}),A=e=>{let{onRefresh:t,onAdd:r}=e;return(0,a.jsxs)("div",{style:C,children:[(0,a.jsx)("div",{className:"decorative-shape shape-1"}),(0,a.jsx)("div",{className:"decorative-shape shape-2"}),(0,a.jsx)("div",{style:{maxWidth:1200,margin:"0 auto",position:"relative",zIndex:1},children:(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:16},children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12,marginBottom:8},children:[(0,a.jsx)("div",{style:{background:"rgba(255,255,255,0.2)",padding:10,borderRadius:14,display:"flex",backdropFilter:"blur(4px)"},children:(0,a.jsx)(c.Z,{style:{fontSize:28,color:"#fff"}})}),(0,a.jsx)(S,{level:2,style:{margin:0,color:"#fff",fontWeight:800},children:"จัดการผู้ใช้"})]}),(0,a.jsx)(_,{style:{color:"rgba(255,255,255,0.9)",fontSize:16,display:"block",paddingLeft:4},children:"บริหารจัดการสิทธิ์และข้อมูลผู้ใช้งานในระบบ"})]}),(0,a.jsxs)("div",{style:{display:"flex",gap:12},children:[(0,a.jsx)(l.ZP,{icon:(0,a.jsx)(b.Z,{}),onClick:t,size:"large",style:{background:"rgba(255,255,255,0.15)",border:"1px solid rgba(255,255,255,0.3)",color:"#fff",borderRadius:12,backdropFilter:"blur(4px)"},children:"รีเฟรช"}),(0,a.jsx)(l.ZP,{type:"primary",icon:(0,a.jsx)(v.Z,{}),onClick:r,size:"large",style:{background:"#fff",color:"#2563eb",border:"none",borderRadius:12,fontWeight:600,boxShadow:"0 4px 15px rgba(0,0,0,0.2)"},children:"เพิ่มผู้ใช้"})]})]})})]})},P=e=>{let{totalUsers:t,activeUsers:r,onlineUsers:n}=e;return(0,a.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:16,marginTop:-40,marginBottom:32,position:"relative",zIndex:2,maxWidth:1200,marginLeft:"auto",marginRight:"auto",padding:"0 24px",justifyContent:"center"},children:[(0,a.jsx)(p.Z,{variant:"borderless",style:{borderRadius:16,boxShadow:"0 10px 30px rgba(0,0,0,0.08)"},children:(0,a.jsx)(x.Z,{title:(0,a.jsx)(_,{type:"secondary",children:"ผู้ใช้ทั้งหมด"}),value:t,prefix:(0,a.jsx)(c.Z,{style:{color:"#3b82f6",background:"#eff6ff",padding:8,borderRadius:"50%"}}),styles:{content:{fontWeight:700}}})}),(0,a.jsx)(p.Z,{variant:"borderless",style:{borderRadius:16,boxShadow:"0 10px 30px rgba(0,0,0,0.08)"},children:(0,a.jsx)(x.Z,{title:(0,a.jsx)(_,{type:"secondary",children:"ออนไลน์/ใช้งาน"}),value:r,styles:{content:{color:"#10b981",fontWeight:700}},prefix:(0,a.jsx)(m.Z,{status:"processing",color:"#10b981"})})}),(0,a.jsx)(p.Z,{variant:"borderless",style:{borderRadius:16,boxShadow:"0 10px 30px rgba(0,0,0,0.08)"},children:(0,a.jsx)(x.Z,{title:(0,a.jsx)(_,{type:"secondary",children:"ผู้ดูแลระบบ"}),value:n,styles:{content:{color:"#f59e0b",fontWeight:700}},prefix:(0,a.jsx)(j.Z,{style:{color:"#f59e0b",background:"#fffbeb",padding:8,borderRadius:"50%"}})})})]})},I=e=>{var t,r,n;let{user:o,onEdit:s,onDelete:i}=e,c=(null===(t=o.roles)||void 0===t?void 0:t.roles_name)||"";return(0,a.jsxs)(p.Z,{hoverable:!0,style:R(o.is_active||!1),styles:{body:{padding:20}},actions:[(0,a.jsx)(y.Z,{title:"แก้ไขข้อมูล",children:(0,a.jsx)(l.ZP,{type:"text",icon:(0,a.jsx)(k.Z,{style:{color:"#3b82f6"}}),onClick:()=>s(o),children:"แก้ไข"})},"edit"),(0,a.jsx)(y.Z,{title:"ลบผู้ใช้",children:(0,a.jsx)(l.ZP,{type:"text",danger:!0,icon:(0,a.jsx)(w.Z,{}),onClick:()=>i(o),children:"ลบ"})},"delete")],children:[(0,a.jsxs)("div",{style:{display:"flex",alignItems:"flex-start",gap:16,marginBottom:16},children:[(0,a.jsx)(h.Z,{size:64,style:{backgroundColor:"Admin"===c?"#f59e0b":"Manager"===c?"#eb2f96":"#3b82f6",fontSize:24,boxShadow:"0 4px 12px rgba(0,0,0,0.1)",border:o.is_active?"3px solid #10b981":"3px solid transparent",transition:"all 0.3s ease"},icon:(0,a.jsx)(j.Z,{})}),(0,a.jsx)("div",{style:{flex:1},children:(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(S,{level:4,style:{margin:0,marginBottom:4,color:"#1f2937"},children:o.name||o.username}),(0,a.jsxs)("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:[(0,a.jsx)(g.Z,{color:"Admin"===c?"gold":"Manager"===c?"magenta":"blue",style:{borderRadius:12,border:"none",padding:"0 10px",margin:0},children:(null===(r=o.roles)||void 0===r?void 0:r.display_name)||(null===(n=o.roles)||void 0===n?void 0:n.roles_name)||"N/A"}),o.branch&&(0,a.jsx)(g.Z,{color:"cyan",style:{borderRadius:12,border:"none",padding:"0 10px",margin:0},children:o.branch.branch_name})]})]}),(0,a.jsx)(y.Z,{title:o.is_active?"กำลังใช้งาน":"ออฟไลน์",children:o.is_active?(0,a.jsx)("div",{style:{width:12,height:12,borderRadius:"50%",background:"#10b981",boxShadow:"0 0 0 3px rgba(16, 185, 129, 0.2)"}}):(0,a.jsx)("div",{style:{width:12,height:12,borderRadius:"50%",background:"#d1d5db"}})})]})})]}),(0,a.jsxs)("div",{style:{background:"#f9fafb",padding:12,borderRadius:12},children:[(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6},children:[(0,a.jsx)(_,{type:"secondary",style:{fontSize:12},children:"สถานะการใช้งาน"}),o.is_active?(0,a.jsxs)(g.Z,{color:"#10b981",style:{margin:0,borderRadius:12,border:"none",padding:"0 10px",display:"flex",alignItems:"center",gap:6},children:[(0,a.jsx)("div",{style:{width:6,height:6,borderRadius:"50%",background:"#fff",boxShadow:"0 0 8px rgba(255,255,255,0.8)"}}),(0,a.jsx)("span",{style:{fontWeight:600},children:"กำลังใช้งาน"})]}):(0,a.jsx)(g.Z,{style:{margin:0,borderRadius:12,border:"none",background:"#f3f4f6",color:"#9ca3af"},children:"ออฟไลน์"})]}),(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:6},children:[(0,a.jsx)(_,{type:"secondary",style:{fontSize:12},children:"สถานะบัญชี"}),(0,a.jsx)(m.Z,{status:o.is_use?"success":"error",text:(0,a.jsx)("span",{style:{fontSize:12},children:o.is_use?"เปิดใช้งาน":"ระงับ"})})]}),(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,a.jsx)(_,{type:"secondary",style:{fontSize:12},children:"เข้าสู่ระบบล่าสุด"}),(0,a.jsx)(_,{style:{fontSize:12,fontWeight:500},children:o.last_login_at?new Date(o.last_login_at).toLocaleDateString("th-TH"):"-"})]})]})]})};var O=r(24675),z=r(26972),U=r(3369),L=r(14362),D=r(48651),N=r(5447),B=r(92719);let{Title:M,Text:W}=o.default;function F(){let e=(0,d.useRouter)(),[t,r]=(0,n.useState)([]),{socket:o}=(0,O.s)(),{execute:u}=(0,z.J)(),{showLoading:f,hideLoading:p}=(0,U.x)(),{user:x,loading:m}=(0,L.a)(),[y,h]=(0,n.useState)("");(0,n.useEffect)(()=>{(async()=>{h(await N.O.getCsrfToken())})()},[]),(0,n.useEffect)(()=>{if(!m&&(!x||"Admin"!==x.role)){let t=setTimeout(()=>{s.ZP.error("คุณไม่มีสิทธิ์เข้าถึงหน้านี้"),e.push("/")},1e3);return()=>clearTimeout(t)}},[x,m,e]);let g=(0,n.useCallback)(async()=>{u(async()=>{r(await B.W.getAllUsers())},"กำลังโหลดข้อมูลผู้ใช้...")},[u]);(0,n.useEffect)(()=>{g()},[g]),(0,n.useEffect)(()=>{if(o)return o.on("users:create",e=>{r(t=>[...t,e]),s.ZP.success("ผู้ใช้ใหม่ ".concat(e.username," ถูกเพิ่มแล้ว"))}),o.on("users:update",e=>{r(t=>t.map(t=>t.id===e.id?e:t))}),o.on("users:delete",e=>{let{id:t}=e;r(e=>e.filter(e=>e.id!==t))}),o.on("users:update-status",e=>{let{id:t,is_active:a}=e;r(e=>e.map(e=>e.id===t?{...e,is_active:a}:e))}),()=>{o.off("users:create"),o.off("users:update"),o.off("users:delete"),o.off("users:update-status")}},[o]);let b=()=>{f(),e.push("/users/manage/add"),setTimeout(()=>p(),1e3)},v=t=>{e.push("/users/manage/edit/".concat(t.id))},j=e=>{i.Z.confirm({title:"ยืนยันการลบผู้ใช้",content:'คุณต้องการลบผู้ใช้ "'.concat(e.name||e.username,'" หรือไม่?'),okText:"ลบ",okType:"danger",cancelText:"ยกเลิก",centered:!0,onOk:async()=>{await u(async()=>{await B.W.deleteUser(e.id,void 0,y),s.ZP.success('ลบผู้ใช้ "'.concat(e.name||e.username,'" สำเร็จ'))},"กำลังลบผู้ใช้งาน...")}})};if(m||!x||"Admin"!==x.role)return(0,a.jsx)("div",{style:{height:"100vh",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",backgroundColor:"#f5f5f5"},children:(0,a.jsx)(D.Z,{size:"large"})});let k=t.filter(e=>e.is_active).length,w=t.filter(e=>{var t;return(null===(t=e.roles)||void 0===t?void 0:t.roles_name)==="Admin"}).length;return(0,a.jsxs)("div",{style:T,children:[(0,a.jsx)(Z,{}),(0,a.jsx)(A,{onRefresh:g,onAdd:b}),(0,a.jsx)(P,{totalUsers:t.length,activeUsers:k,onlineUsers:w}),(0,a.jsx)("div",{style:E,children:t.length>0?(0,a.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:24,justifyContent:"center"},children:t.map((e,t)=>(0,a.jsx)("div",{style:{animation:"fadeInUp 0.6s ease-out forwards",animationDelay:"".concat(50*t,"ms"),opacity:0},children:(0,a.jsx)(I,{user:e,onEdit:v,onDelete:j})},e.id))}):(0,a.jsxs)("div",{style:{background:"white",borderRadius:20,padding:"60px 20px",textAlign:"center",boxShadow:"0 4px 20px rgba(0,0,0,0.05)"},children:[(0,a.jsx)(c.Z,{style:{fontSize:64,color:"#e5e7eb",marginBottom:16}}),(0,a.jsx)(M,{level:3,style:{color:"#374151",margin:0},children:"ยังไม่มีผู้ใช้งาน"}),(0,a.jsx)(W,{type:"secondary",children:"เริ่มต้นด้วยการเพิ่มผู้ใช้งานคนแรก"}),(0,a.jsx)("div",{style:{marginTop:24},children:(0,a.jsx)(l.ZP,{type:"primary",onClick:b,children:"เพิ่มผู้ใช้"})})]})})]})}},71567:function(e,t,r){"use strict";r.d(t,{q:function(){return n},v:function(){return a}});let a="/api",n={AUTH:{LOGIN:"/auth/login",ME:"/auth/me",CSRF:"/csrf"},POS:{PRODUCTS:"/pos/products",ORDERS:"/pos/orders",TABLES:"/pos/tables",DISCOUNTS:"/pos/discounts",DELIVERY:"/pos/delivery",PAYMENT_METHODS:"/pos/paymentMethod",PAYMENTS:"/pos/payments",CATEGORY:"/pos/category",SHIFTS:{BASE:"/pos/shifts",CURRENT:"/pos/shifts/current",OPEN:"/pos/shifts/open",CLOSE:"/pos/shifts/close"},DASHBOARD:{SALES:"/pos/dashboard/sales",TOP_ITEMS:"/pos/dashboard/top-items"},CHANNELS:{STATS:"/pos/orders/stats"},SHOP_PROFILE:"/pos/shopProfile",SALES_ORDER_ITEMS:"/pos/salesOrderItem",SALES_ORDER_DETAILS:"/pos/salesOrderDetail",PRODUCTS_UNIT:"/pos/productsUnit",PAYMENT_DETAILS:"/pos/paymentDetails",BRANCH:"/branches"}}},14362:function(e,t,r){"use strict";r.d(t,{AuthProvider:function(){return u},a:function(){return f}});var a=r(57437),n=r(2265),o=r(99376),s=r(5447),i=r(84859),l=r(48651),c=r(3369);let d=(0,n.createContext)(void 0),u=e=>{let{children:t}=e,[r,u]=(0,n.useState)(null),[f,p]=(0,n.useState)(!0),x=(0,o.useRouter)(),m=(0,o.usePathname)(),y=async()=>{try{let e="";e=localStorage.getItem("token_ws")||"";let t=await s.O.getMe(e);u(t)}catch(e){u(null)}finally{p(!1)}};(0,n.useEffect)(()=>{y()},[]);let{showLoading:h,hideLoading:g}=(0,c.x)();(0,n.useEffect)(()=>{f||r||"/login"===m||x.push("/login")},[r,f,m,x]);let b=async e=>{try{h("กำลังเข้าสู่ระบบ...");let t=await s.O.getCsrfToken(),{token:r,...a}=await s.O.login(e,t);r&&localStorage.setItem("token_ws",r),u(a),x.push("/")}catch(e){throw e}finally{g()}},v=async()=>{try{h("กำลังออกจากระบบ...");let e="";e=localStorage.getItem("token_ws")||"",await s.O.logout(e),localStorage.removeItem("token_ws"),i.x.clearQueue(),u(null),x.push("/login")}catch(e){console.error("Logout error:",e)}finally{g()}};return f?(0,a.jsx)("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-white",children:(0,a.jsx)(l.Z,{size:"large"})}):r||"/login"===m?(0,a.jsx)(d.Provider,{value:{user:r,loading:f,login:b,logout:v,checkAuth:y},children:t}):null},f=()=>{let e=(0,n.useContext)(d);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}},46252:function(e,t,r){"use strict";r.d(t,{J:function(){return i},SocketProvider:function(){return l}});var a=r(57437),n=r(2265),o=r(68680),s=r(14362);let i=(0,n.createContext)({socket:null,isConnected:!1}),l=e=>{let{children:t}=e,[r,l]=(0,n.useState)(null),[c,d]=(0,n.useState)(!1),{user:u}=(0,s.a)();return(0,n.useEffect)(()=>{if(!u){r&&(r.disconnect(),l(null),d(!1));return}let e=localStorage.getItem("token_ws"),t=(0,o.io)("http://localhost:3000",{transports:["websocket"],withCredentials:!0,auth:e?{token:e}:void 0});return t.on("connect",()=>{console.log("Socket Connected:",t.id),d(!0)}),t.on("disconnect",()=>{console.log("Socket Disconnected"),d(!1)}),l(t),()=>{t.disconnect()}},[u]),(0,a.jsx)(i.Provider,{value:{socket:r,isConnected:c},children:t})}},3369:function(e,t,r){"use strict";r.d(t,{GlobalLoadingProvider:function(){return l},O:function(){return d},x:function(){return c}});var a=r(57437),n=r(2265),o=r(48651);let s=(0,n.createContext)(void 0),i=(0,n.createContext)(void 0),l=e=>{let{children:t}=e,[r,l]=(0,n.useState)({}),[c,d]=(0,n.useState)(void 0),u=(0,n.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default";l(e=>({...e,[t]:(e[t]||0)+1})),e&&d(e)},[]),f=(0,n.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";l(t=>{if(!t[e])return t;let r={...t};return r[e]-=1,r[e]<=0&&delete r[e],r})},[]),p=(0,n.useCallback)(()=>{l({}),d(void 0)},[]),x=Object.keys(r).length>0,m=(0,n.useMemo)(()=>({isLoading:x,loadingMessage:c}),[x,c]),y=(0,n.useMemo)(()=>({showLoading:u,hideLoading:f,resetLoading:p}),[u,f,p]);return(0,a.jsx)(i.Provider,{value:y,children:(0,a.jsxs)(s.Provider,{value:m,children:[t,x&&(0,a.jsx)("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center pointer-events-auto bg-black/10 backdrop-blur-[1px]",children:(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:10,background:"rgba(255, 255, 255, 0.9)",padding:"20px 40px",borderRadius:12,boxShadow:"0 4px 12px rgba(0,0,0,0.1)"},children:[(0,a.jsx)(o.Z,{size:"large"}),c&&(0,a.jsx)("div",{style:{fontSize:14,color:"#1f1f1f",fontWeight:500},children:c})]})})]})})};function c(){let e=(0,n.useContext)(s),t=(0,n.useContext)(i);if(!e||!t)throw Error("useGlobalLoading must be used within a GlobalLoadingProvider");return(0,n.useMemo)(()=>({...e,...t}),[e,t])}function d(){let e=(0,n.useContext)(i);if(!e)throw Error("useGlobalLoadingDispatch must be used within a GlobalLoadingProvider");return e}},26972:function(e,t,r){"use strict";r.d(t,{J:function(){return s}});var a=r(2265),n=r(3369),o=r(53743);let s=()=>{let{showLoading:e,hideLoading:t}=(0,n.x)();return{execute:(0,a.useCallback)(async function(r){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"กำลังดำเนินการ...",n=(arguments.length>2&&arguments[2],arguments.length>3&&void 0!==arguments[3]?arguments[3]:"เกิดข้อผิดพลาด");try{return e(a,"async"),await r()}catch(e){console.error("Async action error:",e),o.Z.error({title:"ข้อผิดพลาด",content:e.message||n});return}finally{t("async")}},[e,t])}}},24675:function(e,t,r){"use strict";r.d(t,{s:function(){return o}});var a=r(2265),n=r(46252);let o=()=>(0,a.useContext)(n.J)},2913:function(e,t,r){"use strict";function a(e,t){return({GET:"".concat(n.API_BASE_URL).concat(t),POST:"".concat(n.API_BASE_URL).concat(t),PUT:"".concat(n.API_BASE_URL).concat(t),DELETE:"".concat(n.API_BASE_URL).concat(t),PATCH:"".concat(n.API_BASE_URL).concat(t)})[e]}r.d(t,{b:function(){return a}});let n={get API_BASE_URL(){return"/api"}}},81026:function(e,t,r){"use strict";r.d(t,{E:function(){return o},M:function(){return n}});var a=r(20019);let n=a.Ryn({id:a.Z_8(),branch_name:a.Z_8(),branch_code:a.Z_8(),address:a.Z_8().optional().nullable(),phone:a.Z_8().optional().nullable(),tax_id:a.Z_8().optional().nullable(),is_active:a.O72().default(!0),create_date:a.Z_8().or(a.hTZ()).transform(e=>new Date(e))}),o=a.IXX(n)},5447:function(e,t,r){"use strict";r.d(t,{O:function(){return o}});var a=r(71567),n=r(2913);let o={login:async(e,t,r)=>{try{let o=(0,n.b)("POST",a.q.AUTH.LOGIN),s={"Content-Type":"application/json"};t&&(s["X-CSRF-Token"]=t),r&&(s.Cookie=r);let i=await fetch(o,{method:"POST",headers:s,credentials:"include",body:JSON.stringify(e)});if(!i.ok){let e=await i.json().catch(()=>({}));throw Error(e.message||e.detail||"เข้าสู่ระบบไม่สำเร็จ")}let l=await i.json();return{...l.user,token:l.token}}catch(e){throw Error(e.message||"เข้าสู่ระบบไม่สำเร็จ")}},logout:async(e,t,r)=>{try{let a=(0,n.b)("POST","/auth/logout"),o={"Content-Type":"application/json"};e&&(o.Authorization="Bearer ".concat(e)),t&&(o["X-CSRF-Token"]=t),r&&(o.Cookie=r),await fetch(a,{method:"POST",headers:o,credentials:"include"})}catch(e){console.error("Logout failed",e)}},getMe:async e=>{try{let t=(0,n.b)("GET",a.q.AUTH.ME),r=await fetch(t,{method:"GET",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"},credentials:"include",cache:"no-store"});if(!r.ok)throw Error("Unauthorized");return await r.json()}catch(e){throw e}},async getCsrfToken(){try{let e=await fetch("".concat(a.v).concat(a.q.AUTH.CSRF),{credentials:"include"});if(!e.ok)return"";return(await e.json()).csrfToken}catch(e){return console.error("Failed to fetch CSRF token",e),""}}}},84859:function(e,t,r){"use strict";r.d(t,{M:function(){return i},x:function(){return s}});let a="pos_offline_queue",n=()=>{let e=localStorage.getItem(a);return e?JSON.parse(e):[]},o=e=>{localStorage.setItem(a,JSON.stringify(e))},s={addToQueue:(e,t)=>{let r=n(),a={id:"offline-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),type:e,payload:t,timestamp:Date.now(),retryCount:0};return o([...r,a]),a},getQueue:()=>n(),removeFromQueue:e=>{o(n().filter(t=>t.id!==e))},incrementRetry:(e,t)=>{o(n().map(r=>r.id===e?{...r,retryCount:r.retryCount+1,lastError:t}:r))},clearQueue:()=>{localStorage.removeItem(a)},pruneExceeded:()=>{o(n().filter(e=>e.retryCount<=5))}},i={maxRetry:5,backoff:e=>Math.min(3e4,2e3*e)}},92719:function(e,t,r){"use strict";r.d(t,{W:function(){return d}});var a=r(2913),n=r(20019);let o=n.Ryn({id:n.Z_8(),roles_name:n.Z_8(),display_name:n.Z_8()});var s=r(81026);let i=n.Ryn({id:n.Z_8(),username:n.Z_8(),name:n.Z_8().optional().nullable(),roles_id:n.Z_8().optional().nullable(),roles:o.optional().nullable(),branch_id:n.Z_8().optional().nullable(),branch:s.M.optional().nullable(),create_date:n.Z_8().or(n.hTZ()).transform(e=>new Date(e)).optional(),last_login_at:n.Z_8().or(n.hTZ()).transform(e=>new Date(e)).optional().nullable(),is_use:n.O72().optional().default(!0),is_active:n.O72().optional().default(!1)}),l=n.IXX(i),c="/users",d={getAllUsers:async(e,t)=>{let r=(0,a.b)("GET",c);t&&(r+="?".concat(t.toString()));let n={};e&&(n.Cookie=e);let o=await fetch(r,{headers:n,credentials:"include",cache:"no-store"});if(!o.ok){var s;let e=await o.json().catch(()=>({}));throw Error((null===(s=e.errors)||void 0===s?void 0:s.map(e=>e.message).join(", "))||e.error||e.message||"ไม่สามารถดึงข้อมูลผู้ใช้ได้")}let i=await o.json();return l.parse(i)},getUserById:async(e,t)=>{let r=(0,a.b)("GET","".concat(c,"/").concat(e)),n={};t&&(n.Cookie=t);let o=await fetch(r,{headers:n,credentials:"include",cache:"no-store"});if(!o.ok){var s;let e=await o.json().catch(()=>({}));throw Error((null===(s=e.errors)||void 0===s?void 0:s.map(e=>e.message).join(", "))||e.error||e.message||"ไม่สามารถดึงข้อมูลผู้ใช้ได้")}let l=await o.json();return i.parse(l)},createUser:async(e,t,r)=>{let n=(0,a.b)("POST",c),o={"Content-Type":"application/json"};t&&(o.Cookie=t),r&&(o["X-CSRF-Token"]=r);let s=await fetch(n,{method:"POST",headers:o,body:JSON.stringify(e),credentials:"include"});if(!s.ok){var i;let e=await s.json().catch(()=>({}));throw Error((null===(i=e.errors)||void 0===i?void 0:i.map(e=>e.message).join(", "))||e.error||e.message||"ไม่สามารถสร้างผู้ใช้ได้")}return s.json()},updateUser:async(e,t,r,n)=>{let o=(0,a.b)("PUT","".concat(c,"/").concat(e)),s={"Content-Type":"application/json"};r&&(s.Cookie=r),n&&(s["X-CSRF-Token"]=n);let i=await fetch(o,{method:"PUT",headers:s,body:JSON.stringify(t),credentials:"include"});if(!i.ok){var l;let e=await i.json().catch(()=>({}));throw Error((null===(l=e.errors)||void 0===l?void 0:l.map(e=>e.message).join(", "))||e.error||e.message||"ไม่สามารถอัปเดตผู้ใช้ได้")}return i.json()},deleteUser:async(e,t,r)=>{let n=(0,a.b)("DELETE","".concat(c,"/").concat(e)),o={};t&&(o.Cookie=t),r&&(o["X-CSRF-Token"]=r);let s=await fetch(n,{method:"DELETE",headers:o,credentials:"include"});if(!s.ok){var i;let e=await s.json().catch(()=>({}));throw Error((null===(i=e.errors)||void 0===i?void 0:i.map(e=>e.message).join(", "))||e.error||e.message||"ไม่สามารถลบผู้ใช้ได้")}}}}},function(e){e.O(0,[5015,7717,7698,742,3211,7993,8651,2646,6207,7213,9021,2224,3248,1721,9,8640,6931,19,1652,5713,4480,880,2971,2117,1744],function(){return e(e.s=90880)}),_N_E=e.O()}]);