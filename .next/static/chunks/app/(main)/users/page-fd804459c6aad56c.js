(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9386],{90880:function(e,t,a){Promise.resolve().then(a.bind(a,82151))},82151:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return L}});var r=a(57437),s=a(2265),n=a(34029),o=a(53743),i=a(24783),l=a(50742),d=a(41361),f=a(99376),c=a(29),x=a.n(c),p=a(19683),m=a(96931),y=a(45235),u=a(35713),b=a(89970),h=a(91652),g=a(80009),j=a(15883),v=a(13377),k=a(26349);let{Title:w,Text:Z}=p.default,z={minHeight:"100vh",background:"#f8f9fc",paddingBottom:40},_=e=>({borderRadius:20,border:"none",overflow:"hidden",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",background:"#fff",boxShadow:e?"0 10px 30px rgba(37, 99, 235, 0.15)":"0 4px 20px rgba(0,0,0,0.05)",transform:e?"translateY(-4px)":"none",position:"relative"}),C=()=>(0,r.jsx)(x(),{id:"985ac2baae04cebc",children:"@-webkit-keyframes fadeInUp{from{opacity:0;-webkit-transform:translatey(20px);transform:translatey(20px)}to{opacity:1;-webkit-transform:translatey(0);transform:translatey(0)}}@-moz-keyframes fadeInUp{from{opacity:0;-moz-transform:translatey(20px);transform:translatey(20px)}to{opacity:1;-moz-transform:translatey(0);transform:translatey(0)}}@-o-keyframes fadeInUp{from{opacity:0;-o-transform:translatey(20px);transform:translatey(20px)}to{opacity:1;-o-transform:translatey(0);transform:translatey(0)}}@keyframes fadeInUp{from{opacity:0;-webkit-transform:translatey(20px);-moz-transform:translatey(20px);-o-transform:translatey(20px);transform:translatey(20px)}to{opacity:1;-webkit-transform:translatey(0);-moz-transform:translatey(0);-o-transform:translatey(0);transform:translatey(0)}}@-webkit-keyframes float{0%{-webkit-transform:translatey(0px);transform:translatey(0px)}50%{-webkit-transform:translatey(-10px);transform:translatey(-10px)}100%{-webkit-transform:translatey(0px);transform:translatey(0px)}}@-moz-keyframes float{0%{-moz-transform:translatey(0px);transform:translatey(0px)}50%{-moz-transform:translatey(-10px);transform:translatey(-10px)}100%{-moz-transform:translatey(0px);transform:translatey(0px)}}@-o-keyframes float{0%{-o-transform:translatey(0px);transform:translatey(0px)}50%{-o-transform:translatey(-10px);transform:translatey(-10px)}100%{-o-transform:translatey(0px);transform:translatey(0px)}}@keyframes float{0%{-webkit-transform:translatey(0px);-moz-transform:translatey(0px);-o-transform:translatey(0px);transform:translatey(0px)}50%{-webkit-transform:translatey(-10px);-moz-transform:translatey(-10px);-o-transform:translatey(-10px);transform:translatey(-10px)}100%{-webkit-transform:translatey(0px);-moz-transform:translatey(0px);-o-transform:translatey(0px);transform:translatey(0px)}}.decorative-shape{position:absolute;background:rgba(255,255,255,.1);-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);-webkit-border-radius:50%;-moz-border-radius:50%;border-radius:50%}.shape-1{width:300px;height:300px;right:-100px;top:-100px}.shape-2{width:150px;height:150px;left:10%;bottom:20px;-webkit-animation:float 6s ease-in-out infinite;-moz-animation:float 6s ease-in-out infinite;-o-animation:float 6s ease-in-out infinite;animation:float 6s ease-in-out infinite}.action-btn{opacity:.7;-webkit-transition:all.2s;-moz-transition:all.2s;-o-transition:all.2s;transition:all.2s}.action-btn:hover{opacity:1;-webkit-transform:scale(1.1);-moz-transform:scale(1.1);-ms-transform:scale(1.1);-o-transform:scale(1.1);transform:scale(1.1)}"}),R=e=>{let{totalUsers:t,activeUsers:a,onlineUsers:s}=e;return(0,r.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:16,marginTop:-40,marginBottom:32,position:"relative",zIndex:2,maxWidth:1200,marginLeft:"auto",marginRight:"auto",padding:"0 24px",justifyContent:"center"},children:[(0,r.jsx)(m.Z,{variant:"borderless",style:{borderRadius:16,boxShadow:"0 10px 30px rgba(0,0,0,0.08)"},children:(0,r.jsx)(y.Z,{title:(0,r.jsx)(Z,{type:"secondary",children:"ผู้ใช้ทั้งหมด"}),value:t,prefix:(0,r.jsx)(d.Z,{style:{color:"#3b82f6",background:"#eff6ff",padding:8,borderRadius:"50%"}}),styles:{content:{fontWeight:700}}})}),(0,r.jsx)(m.Z,{variant:"borderless",style:{borderRadius:16,boxShadow:"0 10px 30px rgba(0,0,0,0.08)"},children:(0,r.jsx)(y.Z,{title:(0,r.jsx)(Z,{type:"secondary",children:"ออนไลน์/ใช้งาน"}),value:a,styles:{content:{color:"#10b981",fontWeight:700}},prefix:(0,r.jsx)(u.Z,{status:"processing",color:"#10b981"})})}),(0,r.jsx)(m.Z,{variant:"borderless",style:{borderRadius:16,boxShadow:"0 10px 30px rgba(0,0,0,0.08)"},children:(0,r.jsx)(y.Z,{title:(0,r.jsx)(Z,{type:"secondary",children:"ผู้ดูแลระบบ"}),value:s,styles:{content:{color:"#f59e0b",fontWeight:700}},prefix:(0,r.jsx)(j.Z,{style:{color:"#f59e0b",background:"#fffbeb",padding:8,borderRadius:"50%"}})})})]})},S=e=>{var t,a,s;let{user:n,onEdit:o,onDelete:i}=e,d=(null===(t=n.roles)||void 0===t?void 0:t.roles_name)||"";return(0,r.jsxs)(m.Z,{hoverable:!0,style:_(n.is_active||!1),styles:{body:{padding:20}},actions:[(0,r.jsx)(b.Z,{title:"แก้ไขข้อมูล",children:(0,r.jsx)(l.ZP,{type:"text",icon:(0,r.jsx)(v.Z,{style:{color:"#3b82f6"}}),onClick:()=>o(n),children:"แก้ไข"})},"edit"),(0,r.jsx)(b.Z,{title:"ลบผู้ใช้",children:(0,r.jsx)(l.ZP,{type:"text",danger:!0,icon:(0,r.jsx)(k.Z,{}),onClick:()=>i(n),children:"ลบ"})},"delete")],children:[(0,r.jsxs)("div",{style:{display:"flex",alignItems:"flex-start",gap:16,marginBottom:16},children:[(0,r.jsx)(h.Z,{size:64,style:{backgroundColor:"Admin"===d?"#f59e0b":"Manager"===d?"#eb2f96":"#3b82f6",fontSize:24,boxShadow:"0 4px 12px rgba(0,0,0,0.1)",border:n.is_active?"3px solid #10b981":"3px solid transparent",transition:"all 0.3s ease"},icon:(0,r.jsx)(j.Z,{})}),(0,r.jsx)("div",{style:{flex:1},children:(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(w,{level:4,style:{margin:0,marginBottom:4,color:"#1f2937"},children:n.name||n.username}),(0,r.jsxs)("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:[(0,r.jsx)(g.Z,{color:"Admin"===d?"gold":"Manager"===d?"magenta":"blue",style:{borderRadius:12,border:"none",padding:"0 10px",margin:0},children:(null===(a=n.roles)||void 0===a?void 0:a.display_name)||(null===(s=n.roles)||void 0===s?void 0:s.roles_name)||"N/A"}),n.branch&&(0,r.jsx)(g.Z,{color:"cyan",style:{borderRadius:12,border:"none",padding:"0 10px",margin:0},children:n.branch.branch_name})]})]}),(0,r.jsx)(b.Z,{title:n.is_active?"กำลังใช้งาน":"ออฟไลน์",children:n.is_active?(0,r.jsx)("div",{style:{width:12,height:12,borderRadius:"50%",background:"#10b981",boxShadow:"0 0 0 3px rgba(16, 185, 129, 0.2)"}}):(0,r.jsx)("div",{style:{width:12,height:12,borderRadius:"50%",background:"#d1d5db"}})})]})})]}),(0,r.jsxs)("div",{style:{background:"#f9fafb",padding:12,borderRadius:12},children:[(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6},children:[(0,r.jsx)(Z,{type:"secondary",style:{fontSize:12},children:"สถานะการใช้งาน"}),n.is_active?(0,r.jsxs)(g.Z,{color:"#10b981",style:{margin:0,borderRadius:12,border:"none",padding:"0 10px",display:"flex",alignItems:"center",gap:6},children:[(0,r.jsx)("div",{style:{width:6,height:6,borderRadius:"50%",background:"#fff",boxShadow:"0 0 8px rgba(255,255,255,0.8)"}}),(0,r.jsx)("span",{style:{fontWeight:600},children:"กำลังใช้งาน"})]}):(0,r.jsx)(g.Z,{style:{margin:0,borderRadius:12,border:"none",background:"#f3f4f6",color:"#9ca3af"},children:"ออฟไลน์"})]}),(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:6},children:[(0,r.jsx)(Z,{type:"secondary",style:{fontSize:12},children:"สถานะบัญชี"}),(0,r.jsx)(u.Z,{status:n.is_use?"success":"error",text:(0,r.jsx)("span",{style:{fontSize:12},children:n.is_use?"เปิดใช้งาน":"ระงับ"})})]}),(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,r.jsx)(Z,{type:"secondary",style:{fontSize:12},children:"เข้าสู่ระบบล่าสุด"}),(0,r.jsx)(Z,{style:{fontSize:12,fontWeight:500},children:n.last_login_at?new Date(n.last_login_at).toLocaleDateString("th-TH"):"-"})]})]})]})};var I=a(24675),T=a(26972),U=a(3369),W=a(14362),P=a(48651),A=a(5447),E=a(92719),B=a(25193),D=a(37410),N=a(27623),O=a(20148),H=a(2786);function L(){let e=(0,f.useRouter)(),[t,a]=(0,s.useState)([]),{socket:c}=(0,I.s)(),{execute:x}=(0,T.J)(),{showLoading:p,hideLoading:m}=(0,U.x)(),{user:y,loading:u}=(0,W.a)(),[b,h]=(0,s.useState)("");(0,s.useEffect)(()=>{(async()=>{h(await A.O.getCsrfToken())})()},[]),(0,s.useEffect)(()=>{if(!u&&(!y||"Admin"!==y.role)){let t=setTimeout(()=>{n.ZP.error("คุณไม่มีสิทธิ์เข้าถึงหน้านี้"),e.push("/")},1e3);return()=>clearTimeout(t)}},[y,u,e]);let g=(0,s.useCallback)(async()=>{x(async()=>{a(await E.W.getAllUsers())},"กำลังโหลดข้อมูลผู้ใช้...")},[x]);(0,s.useEffect)(()=>{u||(null==y?void 0:y.role)!=="Admin"||g()},[u,y,g]),(0,s.useEffect)(()=>{if(c)return c.on("users:create",e=>{a(t=>[...t,e]),n.ZP.success("ผู้ใช้ใหม่ ".concat(e.name||e.username," ถูกเพิ่มแล้ว"))}),c.on("users:update",e=>{a(t=>t.map(t=>t.id===e.id?e:t))}),c.on("users:delete",e=>{let{id:t}=e;a(e=>e.filter(e=>e.id!==t))}),c.on("users:update-status",e=>{let{id:t,is_active:r}=e;a(e=>e.map(e=>e.id===t?{...e,is_active:r}:e))}),()=>{c.off("users:create"),c.off("users:update"),c.off("users:delete"),c.off("users:update-status")}},[c]);let j=()=>{p(),e.push("/users/manage/add"),setTimeout(()=>m(),1e3)},v=t=>{e.push("/users/manage/edit/".concat(t.id))},k=e=>{o.Z.confirm({title:"ยืนยันการลบผู้ใช้",content:'คุณต้องการลบผู้ใช้ "'.concat(e.name||e.username,'" หรือไม่?'),okText:"ลบ",okType:"danger",cancelText:"ยกเลิก",centered:!0,onOk:async()=>{await x(async()=>{await E.W.deleteUser(e.id,void 0,b),n.ZP.success('ลบผู้ใช้ "'.concat(e.name||e.username,'" สำเร็จ'))},"กำลังลบผู้ใช้งาน...")}})};if(u||!y||"Admin"!==y.role)return(0,r.jsx)("div",{style:{height:"100vh",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",backgroundColor:"#f5f5f5"},children:(0,r.jsx)(P.Z,{size:"large"})});let w=t.filter(e=>e.is_active).length,Z=t.filter(e=>{var t;return(null===(t=e.roles)||void 0===t?void 0:t.roles_name)==="Admin"}).length;return(0,r.jsxs)("div",{style:z,children:[(0,r.jsx)(C,{}),(0,r.jsx)(O.Z,{title:"ผู้ใช้",subtitle:"".concat(t.length," รายการ"),icon:(0,r.jsx)(d.Z,{}),actions:(0,r.jsxs)(i.Z,{size:8,wrap:!0,children:[(0,r.jsx)(l.ZP,{onClick:g,children:"รีเฟรช"}),(0,r.jsx)(l.ZP,{type:"primary",onClick:j,children:"เพิ่มผู้ใช้"})]})}),(0,r.jsx)(B.Z,{children:(0,r.jsxs)(N.Z,{children:[(0,r.jsx)(R,{totalUsers:t.length,activeUsers:w,onlineUsers:Z}),(0,r.jsx)(D.Z,{title:"รายการผู้ใช้",extra:(0,r.jsx)("span",{style:{fontWeight:600},children:t.length}),children:t.length>0?(0,r.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:24,justifyContent:"center"},children:t.map((e,t)=>(0,r.jsx)("div",{style:{animation:"fadeInUp 0.6s ease-out forwards",animationDelay:"".concat(50*t,"ms"),opacity:0},children:(0,r.jsx)(S,{user:e,onEdit:v,onDelete:k})},e.id))}):(0,r.jsx)(H.Z,{title:"ยังไม่มีผู้ใช้งาน",description:"เริ่มต้นด้วยการเพิ่มผู้ใช้งานคนแรก",action:(0,r.jsx)(l.ZP,{type:"primary",onClick:j,children:"เพิ่มผู้ใช้"})})})]})})]})}}},function(e){e.O(0,[8024,4736,8592,1744],function(){return e(e.s=90880)}),_N_E=e.O()}]);