(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4802],{67894:function(e,t,a){Promise.resolve().then(a.bind(a,14053))},14053:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return v}});var r=a(57437),o=a(2265),s=a(82646),n=a(93834),l=a(44967),i=a(34029),c=a(50742),d=a(867),u=a(96931),h=a(48651),p=a(88589),m=a(80336),f=a(17588),b=a(26349),y=a(78355),_=a(99376),E=a(29),j=a.n(E);function T(){return(0,r.jsx)(j(),{id:"a434940711695c2b",children:".user-form-card{max-width:600px;margin:0 auto}.form-actions{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-pack:end;-webkit-justify-content:flex-end;-moz-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;gap:12px;margin-top:24px}"})}var g=a(5447),w=a(92719),x=a(1665);let{Title:S}=s.default,{Option:k}=n.default;function v(e){let{params:t}=e,a=(0,_.useRouter)(),[s]=l.Z.useForm(),[E,j]=(0,o.useState)(!1),[v,C]=(0,o.useState)(!1),[Z,P]=(0,o.useState)([]),[A,O]=(0,o.useState)([]),[R,N]=(0,o.useState)(""),U=t.mode[0],I=t.mode[1]||null,L="edit"===U&&!!I;(0,o.useEffect)(()=>{(async()=>{N(await g.O.getCsrfToken())})()},[]);let D=(0,o.useCallback)(async()=>{try{let e=await fetch("/api/roles/getAll");if(!e.ok)throw Error("ไม่สามารถดึงข้อมูลบทบาทได้");let t=await e.json(),a=t.filter(e=>!["Admin","Manager","Employee"].includes(e.display_name));P(a.length>0?a:t)}catch(e){console.error(e),i.ZP.error("ไม่สามารถดึงข้อมูลบทบาทได้")}},[]),F=(0,o.useCallback)(async()=>{try{let e=await x.x.getAll();O(e)}catch(e){console.error(e),i.ZP.error("ไม่สามารถดึงข้อมูลสาขาได้")}},[]),B=(0,o.useCallback)(async()=>{if(I){j(!0);try{var e,t;let a=await w.W.getUserById(I);s.setFieldsValue({username:a.username,name:a.name,roles_id:(null===(e=a.roles)||void 0===e?void 0:e.id)||a.roles_id,branch_id:(null===(t=a.branch)||void 0===t?void 0:t.id)||a.branch_id,is_active:a.is_active,is_use:a.is_use})}catch(e){console.error(e),i.ZP.error("ไม่สามารถดึงข้อมูลผู้ใช้ได้"),a.push("/users")}finally{j(!1)}}},[I,s,a]);(0,o.useEffect)(()=>{D(),F(),L&&B()},[L,I,D,F,B]);let z=async e=>{C(!0);try{if(L&&I){let t={...e};t.password||delete t.password,await w.W.updateUser(I,t,void 0,R),i.ZP.success("อัปเดตผู้ใช้สำเร็จ")}else await w.W.createUser(e,void 0,R),i.ZP.success("สร้างผู้ใช้สำเร็จ");a.push("/users")}catch(e){console.error(e),i.ZP.error(e.message||(L?"ไม่สามารถอัปเดตผู้ใช้ได้":"ไม่สามารถสร้างผู้ใช้ได้"))}finally{C(!1)}},M=async()=>{if(I)try{await w.W.deleteUser(I,void 0,R),i.ZP.success("ลบผู้ใช้สำเร็จ"),a.push("/users")}catch(e){console.error(e),i.ZP.error("ไม่สามารถลบผู้ใช้ได้")}};return(0,r.jsxs)("div",{className:"p-6 md:p-10 min-h-screen bg-gray-50",children:[(0,r.jsxs)("div",{className:"max-w-2xl mx-auto",children:[(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)(c.ZP,{type:"text",icon:(0,r.jsx)(f.Z,{}),onClick:()=>a.push("/users"),className:"mb-2 pl-0 hover:bg-transparent hover:text-blue-600",children:"กลับไปหน้าผู้ใช้"}),(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)(S,{level:2,style:{margin:0},children:L?"แก้ไขผู้ใช้":"เพิ่มผู้ใช้"}),L&&(0,r.jsx)(d.Z,{title:"ลบผู้ใช้",description:"คุณต้องการลบผู้ใช้หรือไม่?",onConfirm:M,okText:"ใช่",cancelText:"No",okButtonProps:{danger:!0},children:(0,r.jsx)(c.ZP,{danger:!0,icon:(0,r.jsx)(b.Z,{}),children:"ลบผู้ใช้"})})]})]}),(0,r.jsx)(u.Z,{className:"shadow-sm rounded-2xl border-gray-100",children:E?(0,r.jsx)("div",{className:"flex justify-center py-10",children:(0,r.jsx)(h.Z,{size:"large"})}):(0,r.jsxs)(l.Z,{form:s,layout:"vertical",onFinish:z,requiredMark:"optional",autoComplete:"off",children:[(0,r.jsx)(l.Z.Item,{name:"username",label:"ชื่อผู้ใช้",rules:[{required:!0,message:"กรุณากรอกชื่อผู้ใช้"},{pattern:/^[a-zA-Z0-9\-_@.]*$/,message:"กรุณากรอกภาษาอังกฤษ ตัวเลข หรืออักขระพิเศษ (- _ @ .)"}],children:(0,r.jsx)(p.default,{size:"large",placeholder:"กรุณากรอกชื่อผู้ใช้",autoComplete:"off"})}),(0,r.jsx)(l.Z.Item,{name:"name",label:"ชื่อ-นามสกุล / ชื่อเล่น",rules:[{required:!0,message:"กรุณากรอกชื่อ-นามสกุล หรือ ชื่อเล่น"}],children:(0,r.jsx)(p.default,{size:"large",placeholder:"ระบุชื่อ (เช่น สมชาย หรือ น้องบี)",autoComplete:"off"})}),(0,r.jsx)(l.Z.Item,{name:"password",label:L?"รหัสผ่านใหม่ (ปล่อยว่างเพื่อไม่เปลี่ยนรหัสผ่าน)":"รหัสผ่าน",rules:[{required:!L,message:"กรุณากรอกรหัสผ่าน"},{pattern:/^[a-zA-Z0-9!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]*$/,message:"กรุณากรอกภาษาอังกฤษ ตัวเลข หรืออักขระพิเศษเท่านั้น"}],children:(0,r.jsx)(p.default.Password,{size:"large",placeholder:"กรุณากรอกรหัสผ่าน",autoComplete:"new-password"})}),(0,r.jsx)(l.Z.Item,{name:"roles_id",label:"บทบาท",rules:[{required:!0,message:"กรุณาเลือกบทบาท"}],children:(0,r.jsx)(n.default,{size:"large",placeholder:"เลือกบทบาท",children:Z.map(e=>(0,r.jsx)(k,{value:e.id,children:e.display_name},e.id))})}),(0,r.jsx)(l.Z.Item,{name:"branch_id",label:"สาขา",rules:[{required:!0,message:"กรุณาเลือกสาขา"}],children:(0,r.jsx)(n.default,{size:"large",placeholder:"เลือกสาขา",allowClear:!0,children:A.map(e=>(0,r.jsxs)(k,{value:e.id,children:[e.branch_name," (",e.branch_code,")"]},e.id))})}),L&&(0,r.jsxs)("div",{className:"flex gap-8 mb-4",children:[(0,r.jsx)(l.Z.Item,{name:"is_active",label:"สถานะ (Active)",valuePropName:"checked",children:(0,r.jsx)(m.Z,{})}),(0,r.jsx)(l.Z.Item,{name:"is_use",label:"การใช้งาน (In Use)",valuePropName:"checked",children:(0,r.jsx)(m.Z,{})})]}),(0,r.jsxs)("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-50 mt-6",children:[(0,r.jsx)(c.ZP,{size:"large",onClick:()=>a.push("/users"),children:"ยกเลิก"}),(0,r.jsx)(c.ZP,{type:"primary",htmlType:"submit",size:"large",loading:v,icon:(0,r.jsx)(y.Z,{}),className:"bg-blue-600 hover:bg-blue-700",children:L?"อัปเดตผู้ใช้":"สร้างผู้ใช้"})]})]})})]}),(0,r.jsx)(T,{})]})}},71567:function(e,t,a){"use strict";a.d(t,{q:function(){return o},v:function(){return r}});let r="/api",o={AUTH:{LOGIN:"/auth/login",ME:"/auth/me",CSRF:"/csrf"},POS:{PRODUCTS:"/pos/products",ORDERS:"/pos/orders",TABLES:"/pos/tables",DISCOUNTS:"/pos/discounts",DELIVERY:"/pos/delivery",PAYMENT_METHODS:"/pos/paymentMethod",PAYMENTS:"/pos/payments",CATEGORY:"/pos/category",SHIFTS:{BASE:"/pos/shifts",CURRENT:"/pos/shifts/current",OPEN:"/pos/shifts/open",CLOSE:"/pos/shifts/close"},DASHBOARD:{SALES:"/pos/dashboard/sales",TOP_ITEMS:"/pos/dashboard/top-items"},CHANNELS:{STATS:"/pos/orders/stats"},SHOP_PROFILE:"/pos/shopProfile",SALES_ORDER_ITEMS:"/pos/salesOrderItem",SALES_ORDER_DETAILS:"/pos/salesOrderDetail",PRODUCTS_UNIT:"/pos/productsUnit",PAYMENT_DETAILS:"/pos/paymentDetails",BRANCH:"/branches"}}},2913:function(e,t,a){"use strict";function r(e,t){return({GET:"".concat(o.API_BASE_URL).concat(t),POST:"".concat(o.API_BASE_URL).concat(t),PUT:"".concat(o.API_BASE_URL).concat(t),DELETE:"".concat(o.API_BASE_URL).concat(t),PATCH:"".concat(o.API_BASE_URL).concat(t)})[e]}a.d(t,{b:function(){return r}});let o={get API_BASE_URL(){return"/api"}}},81026:function(e,t,a){"use strict";a.d(t,{E:function(){return s},M:function(){return o}});var r=a(20019);let o=r.Ryn({id:r.Z_8(),branch_name:r.Z_8(),branch_code:r.Z_8(),address:r.Z_8().optional().nullable(),phone:r.Z_8().optional().nullable(),tax_id:r.Z_8().optional().nullable(),is_active:r.O72().default(!0),create_date:r.Z_8().or(r.hTZ()).transform(e=>new Date(e))}),s=r.IXX(o)},5447:function(e,t,a){"use strict";a.d(t,{O:function(){return s}});var r=a(71567),o=a(2913);let s={login:async(e,t,a)=>{try{let s=(0,o.b)("POST",r.q.AUTH.LOGIN),n={"Content-Type":"application/json"};t&&(n["X-CSRF-Token"]=t),a&&(n.Cookie=a);let l=await fetch(s,{method:"POST",headers:n,credentials:"include",body:JSON.stringify(e)});if(!l.ok){let e=await l.json().catch(()=>({}));throw Error(e.message||e.detail||"เข้าสู่ระบบไม่สำเร็จ")}let i=await l.json();return{...i.user,token:i.token}}catch(e){throw Error(e.message||"เข้าสู่ระบบไม่สำเร็จ")}},logout:async(e,t,a)=>{try{let r=(0,o.b)("POST","/auth/logout"),s={"Content-Type":"application/json"};e&&(s.Authorization="Bearer ".concat(e)),t&&(s["X-CSRF-Token"]=t),a&&(s.Cookie=a),await fetch(r,{method:"POST",headers:s,credentials:"include"})}catch(e){console.error("Logout failed",e)}},getMe:async e=>{try{let t=(0,o.b)("GET",r.q.AUTH.ME),a=await fetch(t,{method:"GET",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"},credentials:"include",cache:"no-store"});if(!a.ok)throw Error("Unauthorized");return await a.json()}catch(e){throw e}},async getCsrfToken(){try{let e=await fetch("".concat(r.v).concat(r.q.AUTH.CSRF),{credentials:"include"});if(!e.ok)return"";return(await e.json()).csrfToken}catch(e){return console.error("Failed to fetch CSRF token",e),""}}}},1665:function(e,t,a){"use strict";a.d(t,{x:function(){return l}});var r=a(71567),o=a(2913),s=a(81026);let n=r.q.POS.BRANCH,l={getAll:async e=>{let t=(0,o.b)("GET",n),a={};e&&(a.Cookie=e);let r=await fetch(t,{cache:"no-store",credentials:"include",headers:a});if(!r.ok)throw Error("Failed to fetch branches");let l=await r.json();return s.E.parse(l)},getById:async(e,t)=>{let a=(0,o.b)("GET","".concat(n,"/").concat(e)),r={};t&&(r.Cookie=t);let l=await fetch(a,{cache:"no-store",credentials:"include",headers:r});if(!l.ok)throw Error("Failed to fetch branch");let i=await l.json();return s.M.parse(i)},create:async(e,t,a)=>{let r=(0,o.b)("POST",n),s={"Content-Type":"application/json"};t&&(s.Cookie=t),a&&(s["X-CSRF-Token"]=a);let l=await fetch(r,{method:"POST",body:JSON.stringify(e),headers:s,credentials:"include"});if(!l.ok){let e=await l.json().catch(()=>({}));throw Error(e.error||e.message||"Failed to create branch")}return l.json()},update:async(e,t,a,r)=>{let s=(0,o.b)("PUT","".concat(n,"/").concat(e)),l={"Content-Type":"application/json"};a&&(l.Cookie=a),r&&(l["X-CSRF-Token"]=r);let i=await fetch(s,{method:"PUT",body:JSON.stringify(t),headers:l,credentials:"include"});if(!i.ok){let e=await i.json().catch(()=>({}));throw Error(e.error||e.message||"Failed to update branch")}return i.json()},delete:async(e,t,a)=>{let r=(0,o.b)("DELETE","".concat(n,"/").concat(e)),s={};t&&(s.Cookie=t),a&&(s["X-CSRF-Token"]=a);let l=await fetch(r,{method:"DELETE",headers:s,credentials:"include"});if(!l.ok){let e=await l.json().catch(()=>({}));throw Error(e.error||e.message||"Failed to delete branch")}}}},92719:function(e,t,a){"use strict";a.d(t,{W:function(){return d}});var r=a(2913),o=a(20019);let s=o.Ryn({id:o.Z_8(),roles_name:o.Z_8(),display_name:o.Z_8()});var n=a(81026);let l=o.Ryn({id:o.Z_8(),username:o.Z_8(),name:o.Z_8().optional().nullable(),roles_id:o.Z_8().optional().nullable(),roles:s.optional().nullable(),branch_id:o.Z_8().optional().nullable(),branch:n.M.optional().nullable(),create_date:o.Z_8().or(o.hTZ()).transform(e=>new Date(e)).optional(),last_login_at:o.Z_8().or(o.hTZ()).transform(e=>new Date(e)).optional().nullable(),is_use:o.O72().optional().default(!0),is_active:o.O72().optional().default(!1)}),i=o.IXX(l),c="/users",d={getAllUsers:async(e,t)=>{let a=(0,r.b)("GET",c);t&&(a+="?".concat(t.toString()));let o={};e&&(o.Cookie=e);let s=await fetch(a,{headers:o,credentials:"include",cache:"no-store"});if(!s.ok){var n;let e=await s.json().catch(()=>({}));throw Error((null===(n=e.errors)||void 0===n?void 0:n.map(e=>e.message).join(", "))||e.error||e.message||"ไม่สามารถดึงข้อมูลผู้ใช้ได้")}let l=await s.json();return i.parse(l)},getUserById:async(e,t)=>{let a=(0,r.b)("GET","".concat(c,"/").concat(e)),o={};t&&(o.Cookie=t);let s=await fetch(a,{headers:o,credentials:"include",cache:"no-store"});if(!s.ok){var n;let e=await s.json().catch(()=>({}));throw Error((null===(n=e.errors)||void 0===n?void 0:n.map(e=>e.message).join(", "))||e.error||e.message||"ไม่สามารถดึงข้อมูลผู้ใช้ได้")}let i=await s.json();return l.parse(i)},createUser:async(e,t,a)=>{let o=(0,r.b)("POST",c),s={"Content-Type":"application/json"};t&&(s.Cookie=t),a&&(s["X-CSRF-Token"]=a);let n=await fetch(o,{method:"POST",headers:s,body:JSON.stringify(e),credentials:"include"});if(!n.ok){var l;let e=await n.json().catch(()=>({}));throw Error((null===(l=e.errors)||void 0===l?void 0:l.map(e=>e.message).join(", "))||e.error||e.message||"ไม่สามารถสร้างผู้ใช้ได้")}return n.json()},updateUser:async(e,t,a,o)=>{let s=(0,r.b)("PUT","".concat(c,"/").concat(e)),n={"Content-Type":"application/json"};a&&(n.Cookie=a),o&&(n["X-CSRF-Token"]=o);let l=await fetch(s,{method:"PUT",headers:n,body:JSON.stringify(t),credentials:"include"});if(!l.ok){var i;let e=await l.json().catch(()=>({}));throw Error((null===(i=e.errors)||void 0===i?void 0:i.map(e=>e.message).join(", "))||e.error||e.message||"ไม่สามารถอัปเดตผู้ใช้ได้")}return l.json()},deleteUser:async(e,t,a)=>{let o=(0,r.b)("DELETE","".concat(c,"/").concat(e)),s={};t&&(s.Cookie=t),a&&(s["X-CSRF-Token"]=a);let n=await fetch(o,{method:"DELETE",headers:s,credentials:"include"});if(!n.ok){var l;let e=await n.json().catch(()=>({}));throw Error((null===(l=e.errors)||void 0===l?void 0:l.map(e=>e.message).join(", "))||e.error||e.message||"ไม่สามารถลบผู้ใช้ได้")}}}}},function(e){e.O(0,[5015,7717,7698,742,3211,7993,8651,2646,6207,7213,9021,2224,5616,8589,5496,3834,8640,6931,19,4967,4480,8417,2971,2117,1744],function(){return e(e.s=67894)}),_N_E=e.O()}]);