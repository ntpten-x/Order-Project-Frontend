(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4802],{67894:function(e,a,s){Promise.resolve().then(s.bind(s,14053))},14053:function(e,a,s){"use strict";s.r(a),s.d(a,{default:function(){return I}});var r=s(57437),t=s(2265),l=s(60283),n=s(19878),i=s(34029),o=s(50742),d=s(867),c=s(96931),u=s(48651),m=s(88589),h=s(53743),x=s(66487),g=s(17588),b=s(26349),f=s(70464),p=s(9738),j=s(78355),y=s(99376),v=s(29),_=s.n(v);function Z(){return(0,r.jsx)(_(),{id:"20cbc76f7af591fa",children:".user-form-card{max-width:600px;margin:0 auto}.form-actions{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-pack:end;-webkit-justify-content:flex-end;-moz-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;gap:12px;margin-top:24px}.user-manage-page .ant-form-item{}"})}var w=s(5447),k=s(92719),N=s(1665),P=s(14362),C=s(25193),E=s(37410),z=s(20148),S=s(36799);let{Title:q}=l.default;function I(e){let{params:a}=e,s=(0,y.useRouter)(),[l]=n.Z.useForm(),{user:v}=(0,P.a)(),_=(null==v?void 0:v.role)==="Admin",I=(null==v?void 0:v.role)==="Manager",[R,F]=(0,t.useState)(!1),[L,T]=(0,t.useState)(!1),[U,W]=(0,t.useState)([]),[A,B]=(0,t.useState)([]),[M,O]=(0,t.useState)(""),[V,$]=(0,t.useState)(!1),[D,G]=(0,t.useState)(!1),H=n.Z.useWatch("roles_id",l),J=n.Z.useWatch("branch_id",l),K=a.mode[0],Q=a.mode[1]||null,X="edit"===K&&!!Q,Y=X&&!!Q&&Q===(null==v?void 0:v.id);(0,t.useEffect)(()=>{(async()=>{O(await w.O.getCsrfToken())})()},[]);let ee=(0,t.useCallback)(async()=>{try{let e=await fetch("/api/roles/getAll");if(!e.ok)throw Error((0,S.t)("users.manage.loadRolesError"));let a=await e.json();W(a)}catch(e){console.error(e),i.ZP.error((0,S.t)("users.manage.loadRolesError"))}},[]),ea=(0,t.useCallback)(async()=>{try{let e=await N.x.getAll();B(e)}catch(e){console.error(e),i.ZP.error((0,S.t)("users.manage.loadBranchesError"))}},[]),es=(0,t.useCallback)(async()=>{if(Q){F(!0);try{var e,a;let s=await k.W.getUserById(Q);l.setFieldsValue({username:s.username,name:s.name,roles_id:(null===(e=s.roles)||void 0===e?void 0:e.id)||s.roles_id,branch_id:(null===(a=s.branch)||void 0===a?void 0:a.id)||s.branch_id,is_active:s.is_active,is_use:s.is_use})}catch(e){console.error(e),i.ZP.error((0,S.t)("users.manage.loadUserError")),s.push("/users")}finally{F(!1)}}},[Q,l,s]);(0,t.useEffect)(()=>{_&&(ee(),ea()),I&&(null==v?void 0:v.branch_id)&&l.setFieldValue("branch_id",v.branch_id),X&&es()},[X,Q,ee,ea,es,_,I,null==v?void 0:v.branch_id,l]);let er=async e=>{T(!0);try{if(X&&Q){let a={...e};a.password||delete a.password,I&&(delete a.roles_id,delete a.branch_id,Y&&(delete a.is_use,delete a.is_active)),await k.W.updateUser(Q,a,void 0,M),i.ZP.success((0,S.t)("users.manage.updateSuccess"))}else{let a={...e};I&&(delete a.roles_id,delete a.branch_id),await k.W.createUser(a,void 0,M),i.ZP.success((0,S.t)("users.manage.createSuccess"))}s.push("/users")}catch(e){console.error(e),i.ZP.error(e.message||(X?(0,S.t)("users.manage.saveErrorUpdate"):(0,S.t)("users.manage.saveErrorCreate")))}finally{T(!1)}},et=async()=>{if(Q)try{await k.W.deleteUser(Q,void 0,M),i.ZP.success((0,S.t)("users.manage.deleteSuccess")),s.push("/users")}catch(e){console.error(e),i.ZP.error((0,S.t)("users.manage.deleteError"))}},el=U.find(e=>e.id===H),en=A.find(e=>e.id===J),ei=(null==v?void 0:v.branch)?"".concat(v.branch.branch_name," (").concat(v.branch.branch_code,")"):(null==v?void 0:v.branch_id)||"-";return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(z.Z,{title:(0,S.t)("users.headerTitle")}),(0,r.jsx)(C.Z,{children:(0,r.jsx)(E.Z,{children:(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)("div",{className:"p-6 md:p-10 min-h-screen bg-gray-50 user-manage-page",children:[(0,r.jsxs)("div",{className:"max-w-2xl mx-auto",children:[(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)(o.ZP,{type:"text",icon:(0,r.jsx)(g.Z,{}),onClick:()=>s.push("/users"),className:"mb-2 pl-0 hover:bg-transparent hover:text-blue-600",children:(0,S.t)("users.manage.backToList")}),(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)(q,{level:2,style:{margin:0},children:X?(0,S.t)("users.manage.headingEdit"):(0,S.t)("users.manage.headingCreate")}),X&&(0,r.jsx)(d.Z,{title:(0,S.t)("users.manage.deleteTitle"),description:(0,S.t)("users.manage.deleteDescription"),onConfirm:et,okText:(0,S.t)("users.manage.deleteOk"),cancelText:(0,S.t)("users.manage.deleteCancel"),okButtonProps:{danger:!0},children:(0,r.jsx)(o.ZP,{danger:!0,icon:(0,r.jsx)(b.Z,{}),children:(0,S.t)("users.manage.deleteButton")})})]})]}),(0,r.jsx)(c.Z,{className:"shadow-sm rounded-2xl border-gray-100",style:{overflow:"visible"},children:R?(0,r.jsx)("div",{className:"flex justify-center py-10",children:(0,r.jsx)(u.Z,{size:"large"})}):(0,r.jsxs)(n.Z,{form:l,layout:"vertical",onFinish:er,requiredMark:"optional",autoComplete:"off",children:[(0,r.jsx)(n.Z.Item,{name:"username",label:(0,S.t)("users.manage.form.usernameLabel"),rules:[{required:!0,message:(0,S.t)("users.manage.form.usernameRequired")},{pattern:/^[a-zA-Z0-9\-_@.]*$/,message:(0,S.t)("users.manage.form.usernamePattern")}],children:(0,r.jsx)(m.default,{size:"large",placeholder:(0,S.t)("users.manage.form.usernamePlaceholder"),autoComplete:"off"})}),(0,r.jsx)(n.Z.Item,{name:"name",label:(0,S.t)("users.manage.form.nameLabel"),rules:[{required:!0,message:(0,S.t)("users.manage.form.nameRequired")}],children:(0,r.jsx)(m.default,{size:"large",placeholder:(0,S.t)("users.manage.form.namePlaceholder"),autoComplete:"off"})}),(0,r.jsx)(n.Z.Item,{name:"password",label:X?(0,S.t)("users.manage.form.passwordLabelEdit"):(0,S.t)("users.manage.form.passwordLabel"),rules:[{required:!X,message:(0,S.t)("users.manage.form.passwordRequired")},{pattern:/^[a-zA-Z0-9!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]*$/,message:(0,S.t)("users.manage.form.passwordPattern")}],children:(0,r.jsx)(m.default.Password,{size:"large",placeholder:(0,S.t)("users.manage.form.passwordPlaceholder"),autoComplete:"new-password"})}),(0,r.jsx)(n.Z.Item,{name:"roles_id",label:(0,S.t)("users.manage.form.roleLabel"),rules:[{required:_,message:(0,S.t)("users.manage.form.roleRequired")}],children:(0,r.jsxs)("div",{className:"ant-input ant-input-lg flex items-center justify-between ".concat(_?"cursor-pointer":""),onClick:()=>_&&$(!0),style:{border:"1px solid #d9d9d9",borderRadius:8,padding:"7px 11px",height:48},children:[(0,r.jsx)("span",{className:el?"text-black":"text-gray-400",children:_?el?el.display_name:(0,S.t)("users.manage.form.rolePlaceholder"):"Employee"}),(0,r.jsx)(f.Z,{className:"text-gray-400"})]})}),(0,r.jsx)(n.Z.Item,{name:"branch_id",label:(0,S.t)("users.manage.form.branchLabel"),rules:[{required:_,message:(0,S.t)("users.manage.form.branchRequired")}],children:(0,r.jsxs)("div",{className:"ant-input ant-input-lg flex items-center justify-between ".concat(_?"cursor-pointer":""),onClick:()=>_&&G(!0),style:{border:"1px solid #d9d9d9",borderRadius:8,padding:"7px 11px",height:48},children:[(0,r.jsx)("span",{className:en?"text-black":"text-gray-400",children:_?en?"".concat(en.branch_name," (").concat(en.branch_code,")"):(0,S.t)("users.manage.form.branchPlaceholder"):ei}),(0,r.jsx)(f.Z,{className:"text-gray-400"})]})}),_&&(0,r.jsx)(h.Z,{title:(0,S.t)("users.manage.form.roleModalTitle"),open:V,onCancel:()=>$(!1),footer:null,centered:!0,zIndex:10001,children:(0,r.jsx)("div",{className:"flex flex-col gap-2 max-h-[60vh] overflow-y-auto p-1",children:U.map(e=>(0,r.jsxs)("div",{onClick:()=>{l.setFieldValue("roles_id",e.id),$(!1)},className:"p-3 border rounded-lg cursor-pointer flex justify-between items-center hover:bg-gray-50 transition-colors ".concat(H===e.id?"border-blue-500 bg-blue-50":"border-gray-200"),children:[(0,r.jsx)("span",{className:H===e.id?"font-medium text-blue-600":"text-gray-700",children:e.display_name}),H===e.id&&(0,r.jsx)(p.Z,{className:"text-blue-600"})]},e.id))})}),_&&(0,r.jsx)(h.Z,{title:(0,S.t)("users.manage.form.branchModalTitle"),open:D,onCancel:()=>G(!1),footer:null,centered:!0,zIndex:10001,children:(0,r.jsx)("div",{className:"flex flex-col gap-2 max-h-[60vh] overflow-y-auto p-1",children:A.map(e=>(0,r.jsxs)("div",{onClick:()=>{l.setFieldValue("branch_id",e.id),G(!1)},className:"p-3 border rounded-lg cursor-pointer flex justify-between items-center hover:bg-gray-50 transition-colors ".concat(J===e.id?"border-blue-500 bg-blue-50":"border-gray-200"),children:[(0,r.jsxs)("span",{className:J===e.id?"font-medium text-blue-600":"text-gray-700",children:[e.branch_name," (",e.branch_code,")"]}),J===e.id&&(0,r.jsx)(p.Z,{className:"text-blue-600"})]},e.id))})}),X&&(!I||!Y)&&(0,r.jsxs)("div",{className:"flex gap-8 mb-4",children:[(0,r.jsx)(n.Z.Item,{name:"is_active",label:(0,S.t)("users.manage.form.activeLabel"),valuePropName:"checked",children:(0,r.jsx)(x.Z,{})}),(0,r.jsx)(n.Z.Item,{name:"is_use",label:(0,S.t)("users.manage.form.useLabel"),valuePropName:"checked",children:(0,r.jsx)(x.Z,{})})]}),(0,r.jsxs)("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-50 mt-6",children:[(0,r.jsx)(o.ZP,{size:"large",onClick:()=>s.push("/users"),children:(0,S.t)("users.manage.cancel")}),(0,r.jsx)(o.ZP,{type:"primary",htmlType:"submit",size:"large",loading:L,icon:(0,r.jsx)(j.Z,{}),className:"bg-blue-600 hover:bg-blue-700",children:X?(0,S.t)("users.manage.updateSubmit"):(0,S.t)("users.manage.createSubmit")})]})]})})]}),(0,r.jsx)(Z,{})]})})})})})]})}}},function(e){e.O(0,[8024,4736,8592,1744],function(){return e(e.s=67894)}),_N_E=e.O()}]);