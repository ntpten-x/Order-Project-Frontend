(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4802],{67894:function(e,s,a){Promise.resolve().then(a.bind(a,14053))},14053:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return N}});var r=a(57437),l=a(2265),i=a(19683),t=a(93834),n=a(19878),c=a(34029),d=a(50742),o=a(867),u=a(96931),m=a(48651),h=a(88589),x=a(66487),p=a(17588),f=a(26349),b=a(78355),j=a(99376),g=a(29),y=a.n(g);function v(){return(0,r.jsx)(y(),{id:"a434940711695c2b",children:".user-form-card{max-width:600px;margin:0 auto}.form-actions{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-pack:end;-webkit-justify-content:flex-end;-moz-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;gap:12px;margin-top:24px}"})}var Z=a(5447),w=a(92719),_=a(1665);let{Title:k}=i.default,{Option:P}=t.default;function N(e){let{params:s}=e,a=(0,j.useRouter)(),[i]=n.Z.useForm(),[g,y]=(0,l.useState)(!1),[N,C]=(0,l.useState)(!1),[z,I]=(0,l.useState)([]),[E,q]=(0,l.useState)([]),[A,S]=(0,l.useState)(""),U=s.mode[0],T=s.mode[1]||null,W="edit"===U&&!!T;(0,l.useEffect)(()=>{(async()=>{S(await Z.O.getCsrfToken())})()},[]);let F=(0,l.useCallback)(async()=>{try{let e=await fetch("/api/roles/getAll");if(!e.ok)throw Error("ไม่สามารถดึงข้อมูลบทบาทได้");let s=await e.json(),a=s.filter(e=>!["Admin","Manager","Employee"].includes(e.display_name));I(a.length>0?a:s)}catch(e){console.error(e),c.ZP.error("ไม่สามารถดึงข้อมูลบทบาทได้")}},[]),O=(0,l.useCallback)(async()=>{try{let e=await _.x.getAll();q(e)}catch(e){console.error(e),c.ZP.error("ไม่สามารถดึงข้อมูลสาขาได้")}},[]),$=(0,l.useCallback)(async()=>{if(T){y(!0);try{var e,s;let a=await w.W.getUserById(T);i.setFieldsValue({username:a.username,name:a.name,roles_id:(null===(e=a.roles)||void 0===e?void 0:e.id)||a.roles_id,branch_id:(null===(s=a.branch)||void 0===s?void 0:s.id)||a.branch_id,is_active:a.is_active,is_use:a.is_use})}catch(e){console.error(e),c.ZP.error("ไม่สามารถดึงข้อมูลผู้ใช้ได้"),a.push("/users")}finally{y(!1)}}},[T,i,a]);(0,l.useEffect)(()=>{F(),O(),W&&$()},[W,T,F,O,$]);let B=async e=>{C(!0);try{if(W&&T){let s={...e};s.password||delete s.password,await w.W.updateUser(T,s,void 0,A),c.ZP.success("อัปเดตผู้ใช้สำเร็จ")}else await w.W.createUser(e,void 0,A),c.ZP.success("สร้างผู้ใช้สำเร็จ");a.push("/users")}catch(e){console.error(e),c.ZP.error(e.message||(W?"ไม่สามารถอัปเดตผู้ใช้ได้":"ไม่สามารถสร้างผู้ใช้ได้"))}finally{C(!1)}},M=async()=>{if(T)try{await w.W.deleteUser(T,void 0,A),c.ZP.success("ลบผู้ใช้สำเร็จ"),a.push("/users")}catch(e){console.error(e),c.ZP.error("ไม่สามารถลบผู้ใช้ได้")}};return(0,r.jsxs)("div",{className:"p-6 md:p-10 min-h-screen bg-gray-50",children:[(0,r.jsxs)("div",{className:"max-w-2xl mx-auto",children:[(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)(d.ZP,{type:"text",icon:(0,r.jsx)(p.Z,{}),onClick:()=>a.push("/users"),className:"mb-2 pl-0 hover:bg-transparent hover:text-blue-600",children:"กลับไปหน้าผู้ใช้"}),(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)(k,{level:2,style:{margin:0},children:W?"แก้ไขผู้ใช้":"เพิ่มผู้ใช้"}),W&&(0,r.jsx)(o.Z,{title:"ลบผู้ใช้",description:"คุณต้องการลบผู้ใช้หรือไม่?",onConfirm:M,okText:"ใช่",cancelText:"No",okButtonProps:{danger:!0},children:(0,r.jsx)(d.ZP,{danger:!0,icon:(0,r.jsx)(f.Z,{}),children:"ลบผู้ใช้"})})]})]}),(0,r.jsx)(u.Z,{className:"shadow-sm rounded-2xl border-gray-100",children:g?(0,r.jsx)("div",{className:"flex justify-center py-10",children:(0,r.jsx)(m.Z,{size:"large"})}):(0,r.jsxs)(n.Z,{form:i,layout:"vertical",onFinish:B,requiredMark:"optional",autoComplete:"off",children:[(0,r.jsx)(n.Z.Item,{name:"username",label:"ชื่อผู้ใช้",rules:[{required:!0,message:"กรุณากรอกชื่อผู้ใช้"},{pattern:/^[a-zA-Z0-9\-_@.]*$/,message:"กรุณากรอกภาษาอังกฤษ ตัวเลข หรืออักขระพิเศษ (- _ @ .)"}],children:(0,r.jsx)(h.default,{size:"large",placeholder:"กรุณากรอกชื่อผู้ใช้",autoComplete:"off"})}),(0,r.jsx)(n.Z.Item,{name:"name",label:"ชื่อ-นามสกุล / ชื่อเล่น",rules:[{required:!0,message:"กรุณากรอกชื่อ-นามสกุล หรือ ชื่อเล่น"}],children:(0,r.jsx)(h.default,{size:"large",placeholder:"ระบุชื่อ (เช่น สมชาย หรือ น้องบี)",autoComplete:"off"})}),(0,r.jsx)(n.Z.Item,{name:"password",label:W?"รหัสผ่านใหม่ (ปล่อยว่างเพื่อไม่เปลี่ยนรหัสผ่าน)":"รหัสผ่าน",rules:[{required:!W,message:"กรุณากรอกรหัสผ่าน"},{pattern:/^[a-zA-Z0-9!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]*$/,message:"กรุณากรอกภาษาอังกฤษ ตัวเลข หรืออักขระพิเศษเท่านั้น"}],children:(0,r.jsx)(h.default.Password,{size:"large",placeholder:"กรุณากรอกรหัสผ่าน",autoComplete:"new-password"})}),(0,r.jsx)(n.Z.Item,{name:"roles_id",label:"บทบาท",rules:[{required:!0,message:"กรุณาเลือกบทบาท"}],children:(0,r.jsx)(t.default,{size:"large",placeholder:"เลือกบทบาท",children:z.map(e=>(0,r.jsx)(P,{value:e.id,children:e.display_name},e.id))})}),(0,r.jsx)(n.Z.Item,{name:"branch_id",label:"สาขา",rules:[{required:!0,message:"กรุณาเลือกสาขา"}],children:(0,r.jsx)(t.default,{size:"large",placeholder:"เลือกสาขา",allowClear:!0,children:E.map(e=>(0,r.jsxs)(P,{value:e.id,children:[e.branch_name," (",e.branch_code,")"]},e.id))})}),W&&(0,r.jsxs)("div",{className:"flex gap-8 mb-4",children:[(0,r.jsx)(n.Z.Item,{name:"is_active",label:"สถานะ (Active)",valuePropName:"checked",children:(0,r.jsx)(x.Z,{})}),(0,r.jsx)(n.Z.Item,{name:"is_use",label:"การใช้งาน (In Use)",valuePropName:"checked",children:(0,r.jsx)(x.Z,{})})]}),(0,r.jsxs)("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-50 mt-6",children:[(0,r.jsx)(d.ZP,{size:"large",onClick:()=>a.push("/users"),children:"ยกเลิก"}),(0,r.jsx)(d.ZP,{type:"primary",htmlType:"submit",size:"large",loading:N,icon:(0,r.jsx)(b.Z,{}),className:"bg-blue-600 hover:bg-blue-700",children:W?"อัปเดตผู้ใช้":"สร้างผู้ใช้"})]})]})})]}),(0,r.jsx)(v,{})]})}}},function(e){e.O(0,[8024,4736,8592,1744],function(){return e(e.s=67894)}),_N_E=e.O()}]);