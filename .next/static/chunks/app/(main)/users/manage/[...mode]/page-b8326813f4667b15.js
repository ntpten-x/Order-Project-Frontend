(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4802],{67894:function(e,s,a){Promise.resolve().then(a.bind(a,14053))},14053:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return z}});var r=a(57437),l=a(2265),t=a(19683),i=a(19878),n=a(34029),c=a(50742),d=a(867),o=a(96931),u=a(48651),m=a(88589),x=a(53743),h=a(66487),p=a(17588),b=a(26349),f=a(78355),g=a(99376),j=a(29),y=a.n(j);function v(){return(0,r.jsx)(y(),{id:"20cbc76f7af591fa",children:".user-form-card{max-width:600px;margin:0 auto}.form-actions{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-pack:end;-webkit-justify-content:flex-end;-moz-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;gap:12px;margin-top:24px}.user-manage-page .ant-form-item{}"})}var Z=a(5447),w=a(92719),_=a(1665),N=a(25193),k=a(37410),C=a(20148);let{Title:P}=t.default;function z(e){let{params:s}=e,a=(0,g.useRouter)(),[t]=i.Z.useForm(),[j,y]=(0,l.useState)(!1),[z,I]=(0,l.useState)(!1),[F,E]=(0,l.useState)([]),[S,q]=(0,l.useState)([]),[A,W]=(0,l.useState)(""),[U,T]=(0,l.useState)(!1),[O,R]=(0,l.useState)(!1),V=i.Z.useWatch("roles_id",t),$=i.Z.useWatch("branch_id",t),B=s.mode[0],M=s.mode[1]||null,D="edit"===B&&!!M;(0,l.useEffect)(()=>{(async()=>{W(await Z.O.getCsrfToken())})()},[]);let G=(0,l.useCallback)(async()=>{try{let e=await fetch("/api/roles/getAll");if(!e.ok)throw Error("ไม่สามารถดึงข้อมูลบทบาทได้");let s=await e.json(),a=s.filter(e=>!["Admin","Manager","Employee"].includes(e.display_name));E(a.length>0?a:s)}catch(e){console.error(e),n.ZP.error("ไม่สามารถดึงข้อมูลบทบาทได้")}},[]),H=(0,l.useCallback)(async()=>{try{let e=await _.x.getAll();q(e)}catch(e){console.error(e),n.ZP.error("ไม่สามารถดึงข้อมูลสาขาได้")}},[]),J=(0,l.useCallback)(async()=>{if(M){y(!0);try{var e,s;let a=await w.W.getUserById(M);t.setFieldsValue({username:a.username,name:a.name,roles_id:(null===(e=a.roles)||void 0===e?void 0:e.id)||a.roles_id,branch_id:(null===(s=a.branch)||void 0===s?void 0:s.id)||a.branch_id,is_active:a.is_active,is_use:a.is_use})}catch(e){console.error(e),n.ZP.error("ไม่สามารถดึงข้อมูลผู้ใช้ได้"),a.push("/users")}finally{y(!1)}}},[M,t,a]);(0,l.useEffect)(()=>{G(),H(),D&&J()},[D,M,G,H,J]);let K=async e=>{I(!0);try{if(D&&M){let s={...e};s.password||delete s.password,await w.W.updateUser(M,s,void 0,A),n.ZP.success("อัปเดตผู้ใช้สำเร็จ")}else await w.W.createUser(e,void 0,A),n.ZP.success("สร้างผู้ใช้สำเร็จ");a.push("/users")}catch(e){console.error(e),n.ZP.error(e.message||(D?"ไม่สามารถอัปเดตผู้ใช้ได้":"ไม่สามารถสร้างผู้ใช้ได้"))}finally{I(!1)}},L=async()=>{if(M)try{await w.W.deleteUser(M,void 0,A),n.ZP.success("ลบผู้ใช้สำเร็จ"),a.push("/users")}catch(e){console.error(e),n.ZP.error("ไม่สามารถลบผู้ใช้ได้")}},Q=F.find(e=>e.id===V),X=S.find(e=>e.id===$);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(C.Z,{title:"จัดการผู้ใช้"}),(0,r.jsx)(N.Z,{children:(0,r.jsx)(k.Z,{children:(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)("div",{className:"p-6 md:p-10 min-h-screen bg-gray-50 user-manage-page",children:[(0,r.jsxs)("div",{className:"max-w-2xl mx-auto",children:[(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)(c.ZP,{type:"text",icon:(0,r.jsx)(p.Z,{}),onClick:()=>a.push("/users"),className:"mb-2 pl-0 hover:bg-transparent hover:text-blue-600",children:"กลับไปหน้าผู้ใช้"}),(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)(P,{level:2,style:{margin:0},children:D?"แก้ไขผู้ใช้":"เพิ่มผู้ใช้"}),D&&(0,r.jsx)(d.Z,{title:"ลบผู้ใช้",description:"คุณต้องการลบผู้ใช้หรือไม่?",onConfirm:L,okText:"ใช่",cancelText:"No",okButtonProps:{danger:!0},children:(0,r.jsx)(c.ZP,{danger:!0,icon:(0,r.jsx)(b.Z,{}),children:"ลบผู้ใช้"})})]})]}),(0,r.jsx)(o.Z,{className:"shadow-sm rounded-2xl border-gray-100",style:{overflow:"visible"},children:j?(0,r.jsx)("div",{className:"flex justify-center py-10",children:(0,r.jsx)(u.Z,{size:"large"})}):(0,r.jsxs)(i.Z,{form:t,layout:"vertical",onFinish:K,requiredMark:"optional",autoComplete:"off",children:[(0,r.jsx)(i.Z.Item,{name:"username",label:"ชื่อผู้ใช้",rules:[{required:!0,message:"กรุณากรอกชื่อผู้ใช้"},{pattern:/^[a-zA-Z0-9\-_@.]*$/,message:"กรุณากรอกภาษาอังกฤษ ตัวเลข หรืออักขระพิเศษ (- _ @ .)"}],children:(0,r.jsx)(m.default,{size:"large",placeholder:"กรุณากรอกชื่อผู้ใช้",autoComplete:"off"})}),(0,r.jsx)(i.Z.Item,{name:"name",label:"ชื่อ-นามสกุล / ชื่อเล่น",rules:[{required:!0,message:"กรุณากรอกชื่อ-นามสกุล หรือ ชื่อเล่น"}],children:(0,r.jsx)(m.default,{size:"large",placeholder:"ระบุชื่อ (เช่น สมชาย หรือ น้องบี)",autoComplete:"off"})}),(0,r.jsx)(i.Z.Item,{name:"password",label:D?"รหัสผ่านใหม่ (ปล่อยว่างเพื่อไม่เปลี่ยนรหัสผ่าน)":"รหัสผ่าน",rules:[{required:!D,message:"กรุณากรอกรหัสผ่าน"},{pattern:/^[a-zA-Z0-9!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]*$/,message:"กรุณากรอกภาษาอังกฤษ ตัวเลข หรืออักขระพิเศษเท่านั้น"}],children:(0,r.jsx)(m.default.Password,{size:"large",placeholder:"กรุณากรอกรหัสผ่าน",autoComplete:"new-password"})}),(0,r.jsx)(i.Z.Item,{name:"roles_id",label:"บทบาท",rules:[{required:!0,message:"กรุณาเลือกบทบาท"}],children:(0,r.jsxs)("div",{className:"ant-input ant-input-lg cursor-pointer flex items-center justify-between",onClick:()=>T(!0),style:{border:"1px solid #d9d9d9",borderRadius:8,padding:"7px 11px",height:48},children:[(0,r.jsx)("span",{className:Q?"text-black":"text-gray-400",children:Q?Q.display_name:"เลือกบทบาท"}),(0,r.jsx)("span",{className:"text-gray-400",children:"▼"})]})}),(0,r.jsx)(i.Z.Item,{name:"branch_id",label:"สาขา",rules:[{required:!0,message:"กรุณาเลือกสาขา"}],children:(0,r.jsxs)("div",{className:"ant-input ant-input-lg cursor-pointer flex items-center justify-between",onClick:()=>R(!0),style:{border:"1px solid #d9d9d9",borderRadius:8,padding:"7px 11px",height:48},children:[(0,r.jsx)("span",{className:X?"text-black":"text-gray-400",children:X?"".concat(X.branch_name," (").concat(X.branch_code,")"):"เลือกสาขา"}),(0,r.jsx)("span",{className:"text-gray-400",children:"▼"})]})}),(0,r.jsx)(x.Z,{title:"เลือกบทบาท",open:U,onCancel:()=>T(!1),footer:null,centered:!0,zIndex:10001,children:(0,r.jsx)("div",{className:"flex flex-col gap-2 max-h-[60vh] overflow-y-auto p-1",children:F.map(e=>(0,r.jsxs)("div",{onClick:()=>{t.setFieldValue("roles_id",e.id),T(!1)},className:"p-3 border rounded-lg cursor-pointer flex justify-between items-center hover:bg-gray-50 transition-colors ".concat(V===e.id?"border-blue-500 bg-blue-50":"border-gray-200"),children:[(0,r.jsx)("span",{className:V===e.id?"font-medium text-blue-600":"text-gray-700",children:e.display_name}),V===e.id&&(0,r.jsx)("span",{className:"text-blue-600",children:"✓"})]},e.id))})}),(0,r.jsx)(x.Z,{title:"เลือกสาขา",open:O,onCancel:()=>R(!1),footer:null,centered:!0,zIndex:10001,children:(0,r.jsx)("div",{className:"flex flex-col gap-2 max-h-[60vh] overflow-y-auto p-1",children:S.map(e=>(0,r.jsxs)("div",{onClick:()=>{t.setFieldValue("branch_id",e.id),R(!1)},className:"p-3 border rounded-lg cursor-pointer flex justify-between items-center hover:bg-gray-50 transition-colors ".concat($===e.id?"border-blue-500 bg-blue-50":"border-gray-200"),children:[(0,r.jsxs)("span",{className:$===e.id?"font-medium text-blue-600":"text-gray-700",children:[e.branch_name," (",e.branch_code,")"]}),$===e.id&&(0,r.jsx)("span",{className:"text-blue-600",children:"✓"})]},e.id))})}),D&&(0,r.jsxs)("div",{className:"flex gap-8 mb-4",children:[(0,r.jsx)(i.Z.Item,{name:"is_active",label:"สถานะ (Active)",valuePropName:"checked",children:(0,r.jsx)(h.Z,{})}),(0,r.jsx)(i.Z.Item,{name:"is_use",label:"การใช้งาน (In Use)",valuePropName:"checked",children:(0,r.jsx)(h.Z,{})})]}),(0,r.jsxs)("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-50 mt-6",children:[(0,r.jsx)(c.ZP,{size:"large",onClick:()=>a.push("/users"),children:"ยกเลิก"}),(0,r.jsx)(c.ZP,{type:"primary",htmlType:"submit",size:"large",loading:z,icon:(0,r.jsx)(f.Z,{}),className:"bg-blue-600 hover:bg-blue-700",children:D?"อัปเดตผู้ใช้":"สร้างผู้ใช้"})]})]})})]}),(0,r.jsx)(v,{})]})})})})})]})}}},function(e){e.O(0,[8024,4736,8592,1744],function(){return e(e.s=67894)}),_N_E=e.O()}]);