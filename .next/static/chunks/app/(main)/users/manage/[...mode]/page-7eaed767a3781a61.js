(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4802],{67894:function(e,a,r){Promise.resolve().then(r.bind(r,14053))},14053:function(e,a,r){"use strict";r.r(a),r.d(a,{default:function(){return R}});var s=r(57437),t=r(2265),n=r(39486),l=r(19878),o=r(34029),i=r(50742),c=r(867),d=r(96931),u=r(48651),m=r(88589),h=r(53743),b=r(80336),g=r(17588),f=r(26349),x=r(70464),p=r(9738),j=r(78355),y=r(99376),v=r(29),w=r.n(v);function _(){return(0,s.jsx)(w(),{id:"20cbc76f7af591fa",children:".user-form-card{max-width:600px;margin:0 auto}.form-actions{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-pack:end;-webkit-justify-content:flex-end;-moz-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;gap:12px;margin-top:24px}.user-manage-page .ant-form-item{}"})}var k=r(5447),Z=r(92719),C=r(1665),N=r(14362),E=r(25193),P=r(37410),T=r(20148),S=r(36799);let{Title:F}=n.default;function R(e){let{params:a}=e,r=(0,y.useRouter)(),[n]=l.Z.useForm(),{user:v}=(0,N.a)(),w=(null==v?void 0:v.role)==="Admin",R=(null==v?void 0:v.role)==="Manager",[q,z]=(0,t.useState)(!1),[I,L]=(0,t.useState)(!1),[O,U]=(0,t.useState)([]),[A,B]=(0,t.useState)([]),[W,H]=(0,t.useState)(""),[M,V]=(0,t.useState)(!1),[D,X]=(0,t.useState)(!1),$=l.Z.useWatch("roles_id",n),G=l.Z.useWatch("branch_id",n),J=a.mode[0],K=a.mode[1]||null,Q="edit"===J&&!!K,Y=Q&&!!K&&K===(null==v?void 0:v.id);(0,t.useEffect)(()=>{(async()=>{H(await k.O.getCsrfToken())})()},[]);let ee=(0,t.useCallback)(async()=>{try{let e=await fetch("/api/roles/getAll");if(!e.ok)throw Error((0,S.t)("users.manage.loadRolesError"));let a=await e.json();U(a)}catch(e){console.error(e),o.ZP.error((0,S.t)("users.manage.loadRolesError"))}},[]),ea=(0,t.useCallback)(async()=>{try{let e=await C.x.getAll();B(e)}catch(e){console.error(e),o.ZP.error((0,S.t)("users.manage.loadBranchesError"))}},[]),er=(0,t.useCallback)(async()=>{if(K){z(!0);try{var e,a;let r=await Z.W.getUserById(K);n.setFieldsValue({username:r.username,name:r.name,roles_id:(null===(e=r.roles)||void 0===e?void 0:e.id)||r.roles_id,branch_id:(null===(a=r.branch)||void 0===a?void 0:a.id)||r.branch_id,is_active:r.is_active,is_use:r.is_use})}catch(e){console.error(e),o.ZP.error((0,S.t)("users.manage.loadUserError")),r.push("/users")}finally{z(!1)}}},[K,n,r]);(0,t.useEffect)(()=>{w&&(ee(),ea()),R&&(null==v?void 0:v.branch_id)&&n.setFieldValue("branch_id",v.branch_id),Q&&er()},[Q,K,ee,ea,er,w,R,null==v?void 0:v.branch_id,n]);let es=async e=>{L(!0);try{if(Q&&K){let a={...e};a.password||delete a.password,R&&(delete a.roles_id,delete a.branch_id,Y&&(delete a.is_use,delete a.is_active)),await Z.W.updateUser(K,a,void 0,W),o.ZP.success((0,S.t)("users.manage.updateSuccess"))}else{let a={...e};R&&(delete a.roles_id,delete a.branch_id),await Z.W.createUser(a,void 0,W),o.ZP.success((0,S.t)("users.manage.createSuccess"))}r.push("/users")}catch(e){console.error(e),o.ZP.error(e.message||(Q?(0,S.t)("users.manage.saveErrorUpdate"):(0,S.t)("users.manage.saveErrorCreate")))}finally{L(!1)}},et=async()=>{if(K)try{await Z.W.deleteUser(K,void 0,W),o.ZP.success((0,S.t)("users.manage.deleteSuccess")),r.push("/users")}catch(e){console.error(e),o.ZP.error((0,S.t)("users.manage.deleteError"))}},en=O.find(e=>e.id===$),el=A.find(e=>e.id===G),eo=(null==v?void 0:v.branch)?"".concat(v.branch.branch_name," (").concat(v.branch.branch_code,")"):(null==v?void 0:v.branch_id)||"-";return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(T.Z,{title:(0,S.t)("users.headerTitle")}),(0,s.jsx)(E.Z,{children:(0,s.jsx)(P.Z,{children:(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("div",{className:"p-6 md:p-10 min-h-screen bg-gray-50 user-manage-page",children:[(0,s.jsxs)("div",{className:"max-w-2xl mx-auto",children:[(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)(i.ZP,{type:"text",icon:(0,s.jsx)(g.Z,{}),onClick:()=>r.push("/users"),className:"mb-2 pl-0 hover:bg-transparent hover:text-blue-600",children:(0,S.t)("users.manage.backToList")}),(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)(F,{level:2,style:{margin:0},children:Q?(0,S.t)("users.manage.headingEdit"):(0,S.t)("users.manage.headingCreate")}),Q&&(0,s.jsx)(c.Z,{title:(0,S.t)("users.manage.deleteTitle"),description:(0,S.t)("users.manage.deleteDescription"),onConfirm:et,okText:(0,S.t)("users.manage.deleteOk"),cancelText:(0,S.t)("users.manage.deleteCancel"),okButtonProps:{danger:!0},children:(0,s.jsx)(i.ZP,{danger:!0,icon:(0,s.jsx)(f.Z,{}),children:(0,S.t)("users.manage.deleteButton")})})]})]}),(0,s.jsx)(d.Z,{className:"shadow-sm rounded-2xl border-gray-100",style:{overflow:"visible"},children:q?(0,s.jsx)("div",{className:"flex justify-center py-10",children:(0,s.jsx)(u.Z,{size:"large"})}):(0,s.jsxs)(l.Z,{form:n,layout:"vertical",onFinish:es,requiredMark:"optional",autoComplete:"off",children:[(0,s.jsx)(l.Z.Item,{name:"username",label:(0,S.t)("users.manage.form.usernameLabel"),rules:[{required:!0,message:(0,S.t)("users.manage.form.usernameRequired")},{pattern:/^[a-zA-Z0-9\-_@.]*$/,message:(0,S.t)("users.manage.form.usernamePattern")}],children:(0,s.jsx)(m.default,{size:"large",placeholder:(0,S.t)("users.manage.form.usernamePlaceholder"),autoComplete:"off"})}),(0,s.jsx)(l.Z.Item,{name:"name",label:(0,S.t)("users.manage.form.nameLabel"),rules:[{required:!0,message:(0,S.t)("users.manage.form.nameRequired")}],children:(0,s.jsx)(m.default,{size:"large",placeholder:(0,S.t)("users.manage.form.namePlaceholder"),autoComplete:"off"})}),(0,s.jsx)(l.Z.Item,{name:"password",label:Q?(0,S.t)("users.manage.form.passwordLabelEdit"):(0,S.t)("users.manage.form.passwordLabel"),rules:[{required:!Q,message:(0,S.t)("users.manage.form.passwordRequired")},{pattern:/^[a-zA-Z0-9!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]*$/,message:(0,S.t)("users.manage.form.passwordPattern")}],children:(0,s.jsx)(m.default.Password,{size:"large",placeholder:(0,S.t)("users.manage.form.passwordPlaceholder"),autoComplete:"new-password"})}),(0,s.jsx)(l.Z.Item,{name:"roles_id",label:(0,S.t)("users.manage.form.roleLabel"),rules:[{required:w,message:(0,S.t)("users.manage.form.roleRequired")}],children:(0,s.jsxs)("div",{className:"ant-input ant-input-lg flex items-center justify-between ".concat(w?"cursor-pointer":""),onClick:()=>w&&V(!0),style:{border:"1px solid #d9d9d9",borderRadius:8,padding:"7px 11px",height:48},children:[(0,s.jsx)("span",{className:en?"text-black":"text-gray-400",children:w?en?en.display_name:(0,S.t)("users.manage.form.rolePlaceholder"):"Employee"}),(0,s.jsx)(x.Z,{className:"text-gray-400"})]})}),(0,s.jsx)(l.Z.Item,{name:"branch_id",label:(0,S.t)("users.manage.form.branchLabel"),rules:[{required:w,message:(0,S.t)("users.manage.form.branchRequired")}],children:(0,s.jsxs)("div",{className:"ant-input ant-input-lg flex items-center justify-between ".concat(w?"cursor-pointer":""),onClick:()=>w&&X(!0),style:{border:"1px solid #d9d9d9",borderRadius:8,padding:"7px 11px",height:48},children:[(0,s.jsx)("span",{className:el?"text-black":"text-gray-400",children:w?el?"".concat(el.branch_name," (").concat(el.branch_code,")"):(0,S.t)("users.manage.form.branchPlaceholder"):eo}),(0,s.jsx)(x.Z,{className:"text-gray-400"})]})}),w&&(0,s.jsx)(h.Z,{title:(0,S.t)("users.manage.form.roleModalTitle"),open:M,onCancel:()=>V(!1),footer:null,centered:!0,zIndex:10001,children:(0,s.jsx)("div",{className:"flex flex-col gap-2 max-h-[60vh] overflow-y-auto p-1",children:O.map(e=>(0,s.jsxs)("div",{onClick:()=>{n.setFieldValue("roles_id",e.id),V(!1)},className:"p-3 border rounded-lg cursor-pointer flex justify-between items-center hover:bg-gray-50 transition-colors ".concat($===e.id?"border-blue-500 bg-blue-50":"border-gray-200"),children:[(0,s.jsx)("span",{className:$===e.id?"font-medium text-blue-600":"text-gray-700",children:e.display_name}),$===e.id&&(0,s.jsx)(p.Z,{className:"text-blue-600"})]},e.id))})}),w&&(0,s.jsx)(h.Z,{title:(0,S.t)("users.manage.form.branchModalTitle"),open:D,onCancel:()=>X(!1),footer:null,centered:!0,zIndex:10001,children:(0,s.jsx)("div",{className:"flex flex-col gap-2 max-h-[60vh] overflow-y-auto p-1",children:A.map(e=>(0,s.jsxs)("div",{onClick:()=>{n.setFieldValue("branch_id",e.id),X(!1)},className:"p-3 border rounded-lg cursor-pointer flex justify-between items-center hover:bg-gray-50 transition-colors ".concat(G===e.id?"border-blue-500 bg-blue-50":"border-gray-200"),children:[(0,s.jsxs)("span",{className:G===e.id?"font-medium text-blue-600":"text-gray-700",children:[e.branch_name," (",e.branch_code,")"]}),G===e.id&&(0,s.jsx)(p.Z,{className:"text-blue-600"})]},e.id))})}),Q&&(!R||!Y)&&(0,s.jsxs)("div",{className:"flex gap-8 mb-4",children:[(0,s.jsx)(l.Z.Item,{name:"is_active",label:(0,S.t)("users.manage.form.activeLabel"),valuePropName:"checked",children:(0,s.jsx)(b.Z,{})}),(0,s.jsx)(l.Z.Item,{name:"is_use",label:(0,S.t)("users.manage.form.useLabel"),valuePropName:"checked",children:(0,s.jsx)(b.Z,{})})]}),(0,s.jsxs)("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-50 mt-6",children:[(0,s.jsx)(i.ZP,{size:"large",onClick:()=>r.push("/users"),children:(0,S.t)("users.manage.cancel")}),(0,s.jsx)(i.ZP,{type:"primary",htmlType:"submit",size:"large",loading:I,icon:(0,s.jsx)(j.Z,{}),className:"bg-blue-600 hover:bg-blue-700",children:Q?(0,S.t)("users.manage.updateSubmit"):(0,S.t)("users.manage.createSubmit")})]})]})})]}),(0,s.jsx)(_,{})]})})})})})]})}},1665:function(e,a,r){"use strict";r.d(a,{x:function(){return i}});var s=r(71567),t=r(2913),n=r(81026),l=r(98170);let o=s.q.POS.BRANCH,i={getAll:async e=>{let a=(0,t.b)("GET",o),r={};e&&(r.Cookie=e);let s=await fetch(a,{cache:"no-store",credentials:"include",headers:r});if(!s.ok)throw Error("Failed to fetch branches");let i=await s.json();return n.E.parse((0,l.hH)(i))},getById:async(e,a)=>{let r=(0,t.b)("GET","".concat(o,"/").concat(e)),s={};a&&(s.Cookie=a);let i=await fetch(r,{cache:"no-store",credentials:"include",headers:s});if(!i.ok)throw Error("Failed to fetch branch");let c=await i.json();return n.M.parse((0,l.hH)(c))},create:async(e,a,r)=>{let s=(0,t.b)("POST",o),n={"Content-Type":"application/json"};a&&(n.Cookie=a),r&&(n["X-CSRF-Token"]=r);let i=await fetch(s,{method:"POST",body:JSON.stringify(e),headers:n,credentials:"include"});if(!i.ok){let e=await i.json().catch(()=>({}));throw Error((0,l.i_)(e,"Failed to create branch"))}return(0,l.hH)(await i.json())},update:async(e,a,r,s)=>{let n=(0,t.b)("PUT","".concat(o,"/").concat(e)),i={"Content-Type":"application/json"};r&&(i.Cookie=r),s&&(i["X-CSRF-Token"]=s);let c=await fetch(n,{method:"PUT",body:JSON.stringify(a),headers:i,credentials:"include"});if(!c.ok){let e=await c.json().catch(()=>({}));throw Error((0,l.i_)(e,"Failed to update branch"))}return(0,l.hH)(await c.json())},delete:async(e,a,r)=>{let s=(0,t.b)("DELETE","".concat(o,"/").concat(e)),n={};a&&(n.Cookie=a),r&&(n["X-CSRF-Token"]=r);let i=await fetch(s,{method:"DELETE",headers:n,credentials:"include"});if(!i.ok){let e=await i.json().catch(()=>({}));throw Error((0,l.i_)(e,"Failed to delete branch"))}}}}},function(e){e.O(0,[253,1522,3418,742,9486,4252,3916,8651,6931,4159,3831,2224,3248,8879,8589,19,9878,4487,738,9385,4737,2971,2117,1744],function(){return e(e.s=67894)}),_N_E=e.O()}]);