(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4062],{95247:function(e,t,n){Promise.resolve().then(n.bind(n,5902))},5902:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return Q}});var i=n(57437),s=n(2265),r=n(60283),a=n(34029),d=n(53743),l=n(48651),o=n(24783),c=n(50742),g=n(41169),f=n(89245),u=n(96473),x=n(29827),h=n(11713),p=n(21770),y=n(99376),m=n(3369),b=n(24675),j=n(12028),k=n(14362),v=n(80009),U=n(8900),w=n(39725),Z=n(13377),C=n(26349);let{Text:S,Title:_}=r.default,T={container:{paddingBottom:100,backgroundColor:"#f8f9fc",minHeight:"100vh"},statsCard:{margin:"-40px 16px 0 16px",padding:"16px",background:"white",borderRadius:20,boxShadow:"0 8px 24px rgba(0,0,0,0.08)",display:"flex",justifyContent:"space-around",position:"relative",zIndex:10},statItem:{textAlign:"center",flex:1},statNumber:{fontSize:24,fontWeight:700,display:"block"},statLabel:{fontSize:12,color:"#8c8c8c",marginTop:2},listContainer:{padding:"20px 16px 0 16px"},unitCard:e=>({marginBottom:12,borderRadius:20,border:"none",boxShadow:"0 2px 8px rgba(0,0,0,0.04)",overflow:"hidden",transition:"all 0.3s ease",background:e?"white":"linear-gradient(to right, #fafafa, white)",opacity:e?1:.7}),unitCardInner:{padding:16,display:"flex",alignItems:"center",gap:14}},I=()=>(0,i.jsx)("style",{children:"\n        @keyframes fadeSlideIn {\n            from {\n                opacity: 0;\n                transform: translateY(12px);\n            }\n            to {\n                opacity: 1;\n                transform: translateY(0);\n            }\n        }\n        \n        .unit-card {\n            animation: fadeSlideIn 0.4s ease both;\n        }\n        \n        .unit-card:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 8px 24px rgba(0,0,0,0.1) !important;\n        }\n        \n        .unit-card:active {\n            transform: scale(0.98);\n        }\n        \n        /* Custom scrollbar */\n        .ingredients-unit-page *::-webkit-scrollbar {\n            width: 6px;\n        }\n        .ingredients-unit-page *::-webkit-scrollbar-track {\n            background: transparent;\n        }\n        .ingredients-unit-page *::-webkit-scrollbar-thumb {\n            background: #d9d9d9;\n            border-radius: 3px;\n        }\n        .ingredients-unit-page *::-webkit-scrollbar-thumb:hover {\n            background: #bfbfbf;\n        }\n    "}),E=e=>{let{totalUnits:t,activeUnits:n,inactiveUnits:s}=e;return(0,i.jsxs)("div",{style:T.statsCard,children:[(0,i.jsxs)("div",{style:T.statItem,children:[(0,i.jsx)("span",{style:{...T.statNumber,color:"#722ed1"},children:t}),(0,i.jsx)(S,{style:T.statLabel,children:"ทั้งหมด"})]}),(0,i.jsx)("div",{style:{width:1,background:"#f0f0f0"}}),(0,i.jsxs)("div",{style:T.statItem,children:[(0,i.jsx)("span",{style:{...T.statNumber,color:"#52c41a"},children:n}),(0,i.jsx)(S,{style:T.statLabel,children:"ใช้งาน"})]}),(0,i.jsx)("div",{style:{width:1,background:"#f0f0f0"}}),(0,i.jsxs)("div",{style:T.statItem,children:[(0,i.jsx)("span",{style:{...T.statNumber,color:"#ff4d4f"},children:s}),(0,i.jsx)(S,{style:T.statLabel,children:"ไม่ใช้งาน"})]})]})},z=e=>{let{unit:t,index:n,onEdit:s,onDelete:r}=e;return(0,i.jsx)("div",{className:"unit-card",style:{...T.unitCard(t.is_active),animationDelay:"".concat(.03*n,"s")},children:(0,i.jsxs)("div",{style:T.unitCardInner,children:[(0,i.jsx)("div",{style:{width:52,height:52,borderRadius:14,background:"linear-gradient(135deg, #f9f0ff 0%, #efdbff 100%)",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,border:"2px solid #d3adf7"},children:(0,i.jsx)(g.Z,{style:{fontSize:24,color:"#722ed1"}})}),(0,i.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4},children:[(0,i.jsx)(S,{strong:!0,style:{fontSize:16,color:"#1a1a2e"},children:t.display_name}),t.is_active?(0,i.jsx)(U.Z,{style:{color:"#52c41a",fontSize:14}}):(0,i.jsx)(w.Z,{style:{color:"#ff4d4f",fontSize:14}})]}),(0,i.jsxs)("div",{style:{display:"flex",gap:6,flexWrap:"wrap",alignItems:"center"},children:[(0,i.jsx)(v.Z,{color:"purple",style:{borderRadius:8,margin:0,fontSize:12,fontWeight:500},children:t.unit_name}),t.create_date&&(0,i.jsxs)(S,{type:"secondary",style:{fontSize:11},children:["สร้างเมื่อ: ",new Date(t.create_date).toLocaleDateString("th-TH")]})]})]}),(0,i.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,i.jsx)(c.ZP,{type:"text",icon:(0,i.jsx)(Z.Z,{}),onClick:e=>{e.stopPropagation(),s(t)},style:{borderRadius:10,color:"#722ed1",background:"#f9f0ff"}}),(0,i.jsx)(c.ZP,{type:"text",danger:!0,icon:(0,i.jsx)(C.Z,{}),onClick:e=>{e.stopPropagation(),r(t)},style:{borderRadius:10,background:"#fff2f0"}})]})]})})};var P=n(25193),D=n(37410),N=n(27623),R=n(20148),L=n(2786),q=n(36799),A=n(5447);let{Text:O}=r.default;function Q(){let e=(0,y.useRouter)(),{user:t,loading:n}=(0,k.a)(),r=(0,x.NL)(),{showLoading:v,hideLoading:U}=(0,m.x)(),{socket:w}=(0,b.s)(),[Z,C]=(0,s.useState)(null);(0,s.useEffect)(()=>{n||(t&&["Admin","Manager"].includes(t.role)?C(!0):(C(!1),setTimeout(()=>{e.replace("/")},1e3)))},[t,n,e]);let{data:S=""}=(0,h.a)({queryKey:["csrfToken"],queryFn:()=>A.O.getCsrfToken(),staleTime:6e5}),{data:_=[],isLoading:Q,isFetching:W}=(0,h.a)({queryKey:["ingredientsUnits"],queryFn:async()=>{let e=await fetch("/api/stock/ingredientsUnit/getAll",{cache:"no-store"});if(!e.ok){let t=await e.json().catch(()=>({}));throw Error(t.error||t.message||(0,q.t)("ingredientsUnit.fetch.error"))}return await e.json()},staleTime:6e4,enabled:!0===Z}),F=(0,p.D)({mutationFn:async e=>{let t=S||await A.O.getCsrfToken();if(!(await fetch("/api/stock/ingredientsUnit/delete/".concat(e.id),{method:"DELETE",headers:{"X-CSRF-Token":t||""}})).ok)throw Error((0,q.t)("ingredientsUnit.fetch.error"));return e.id},onSuccess:(e,t)=>{r.invalidateQueries({queryKey:["ingredientsUnits"]}),a.ZP.success((0,q.t)("ingredientsUnit.delete.success",{name:t.display_name}))},onError:e=>{let t=e instanceof Error?e.message:(0,q.t)("ingredientsUnit.fetch.error");a.ZP.error(t)}});(0,s.useEffect)(()=>{if(w&&!0===Z)return w.on(j.b.ingredientsUnit.create,e=>{r.setQueryData(["ingredientsUnits"],function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return t.some(t=>t.id===e.id)?t:[...t,e]}),a.ZP.success((0,q.t)("ingredientsUnit.create.toast",{name:e.unit_name}))}),w.on(j.b.ingredientsUnit.update,e=>{r.setQueryData(["ingredientsUnits"],function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return t.map(t=>t.id===e.id?e:t)})}),w.on(j.b.ingredientsUnit.delete,e=>{let{id:t}=e;r.setQueryData(["ingredientsUnits"],function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.filter(e=>e.id!==t)})}),()=>{w.off(j.b.ingredientsUnit.create),w.off(j.b.ingredientsUnit.update),w.off(j.b.ingredientsUnit.delete)}},[w,r,Z]);let K=()=>{v(),e.push("/stock/ingredientsUnit/manage/add"),setTimeout(()=>U(),1e3)},B=t=>{v(),e.push("/stock/ingredientsUnit/manage/edit/".concat(t.id)),setTimeout(()=>U(),1e3)},Y=e=>{d.Z.confirm({title:(0,q.t)("ingredientsUnit.delete.title"),content:(0,q.t)("ingredientsUnit.delete.content",{name:e.display_name}),okText:(0,q.t)("ingredientsUnit.delete.ok"),okType:"danger",cancelText:(0,q.t)("ingredientsUnit.delete.cancel"),centered:!0,onOk:async()=>{await F.mutateAsync(e)}})};if(n||null===Z)return(0,i.jsxs)("div",{style:{display:"flex",height:"100vh",justifyContent:"center",alignItems:"center",flexDirection:"column",gap:16},children:[(0,i.jsx)(l.Z,{size:"large"}),(0,i.jsx)(O,{type:"secondary",children:(0,q.t)("common.checkingAuth")})]});if(!1===Z)return(0,i.jsxs)("div",{style:{display:"flex",height:"100vh",justifyContent:"center",alignItems:"center",flexDirection:"column",gap:16},children:[(0,i.jsx)(l.Z,{size:"large"}),(0,i.jsx)(O,{type:"danger",children:(0,q.t)("common.noPermissionRedirect")})]});let H=_.filter(e=>e.is_active),M=_.filter(e=>!e.is_active);return(0,i.jsxs)("div",{className:"ingredients-unit-page",style:T.container,children:[(0,i.jsx)(I,{}),(0,i.jsx)(R.Z,{title:(0,q.t)("ingredientsUnit.title"),subtitle:(0,q.t)("ingredientsUnit.subtitle",{count:_.length}),icon:(0,i.jsx)(g.Z,{}),actions:(0,i.jsxs)(o.Z,{size:8,wrap:!0,children:[(0,i.jsx)(c.ZP,{icon:(0,i.jsx)(f.Z,{}),onClick:()=>r.invalidateQueries({queryKey:["ingredientsUnits"]}),loading:W,children:(0,q.t)("ingredientsUnit.button.refresh")}),(0,i.jsx)(c.ZP,{type:"primary",icon:(0,i.jsx)(u.Z,{}),onClick:K,children:(0,q.t)("ingredientsUnit.button.add")})]})}),(0,i.jsx)(P.Z,{children:(0,i.jsxs)(N.Z,{children:[(0,i.jsx)(E,{totalUnits:_.length,activeUnits:H.length,inactiveUnits:M.length}),(0,i.jsx)(D.Z,{title:(0,q.t)("ingredientsUnit.section.list"),extra:(0,i.jsx)("span",{style:{fontWeight:600},children:_.length}),children:Q?(0,i.jsx)("div",{style:{display:"flex",justifyContent:"center",padding:"40px 0"},children:(0,i.jsx)(l.Z,{tip:(0,q.t)("ingredientsUnit.loading")})}):_.length>0?(0,i.jsx)("div",{style:T.listContainer,children:_.map((e,t)=>(0,i.jsx)(z,{unit:e,index:t,onEdit:B,onDelete:Y},e.id))}):(0,i.jsx)(L.Z,{title:(0,q.t)("ingredientsUnit.empty.title"),description:(0,q.t)("ingredientsUnit.empty.desc"),action:(0,i.jsx)(c.ZP,{type:"primary",icon:(0,i.jsx)(u.Z,{}),onClick:K,children:(0,q.t)("ingredientsUnit.button.add")})})})]})})]})}}},function(e){e.O(0,[8024,4736,8592,1744],function(){return e(e.s=95247)}),_N_E=e.O()}]);