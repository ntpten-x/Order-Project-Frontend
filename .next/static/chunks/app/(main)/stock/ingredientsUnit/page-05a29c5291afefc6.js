(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4062],{95247:function(t,e,i){Promise.resolve().then(i.bind(i,5902))},5902:function(t,e,i){"use strict";i.r(e),i.d(e,{default:function(){return A}});var n=i(57437),s=i(2265),r=i(39486),a=i(34029),o=i(53743),c=i(48651),l=i(24783),d=i(50742),u=i(41169),h=i(89245),p=i(96473),f=i(29827),m=i(11713),g=i(21770),y=i(99376),x=i(3369),b=i(24675),v=i(12028),j=i(14362),C=i(80009),k=i(8900),w=i(39725),U=i(13377),S=i(26349);let{Text:R,Title:P}=r.default,Z={container:{paddingBottom:100,backgroundColor:"#f8f9fc",minHeight:"100vh"},statsCard:{margin:"-40px 16px 0 16px",padding:"16px",background:"white",borderRadius:20,boxShadow:"0 8px 24px rgba(0,0,0,0.08)",display:"flex",justifyContent:"space-around",position:"relative",zIndex:10},statItem:{textAlign:"center",flex:1},statNumber:{fontSize:24,fontWeight:700,display:"block"},statLabel:{fontSize:12,color:"#8c8c8c",marginTop:2},listContainer:{padding:"20px 16px 0 16px"},unitCard:t=>({marginBottom:12,borderRadius:20,border:"none",boxShadow:"0 2px 8px rgba(0,0,0,0.04)",overflow:"hidden",transition:"all 0.3s ease",background:t?"white":"linear-gradient(to right, #fafafa, white)",opacity:t?1:.7}),unitCardInner:{padding:16,display:"flex",alignItems:"center",gap:14}},O=()=>(0,n.jsx)("style",{children:"\n        @keyframes fadeSlideIn {\n            from {\n                opacity: 0;\n                transform: translateY(12px);\n            }\n            to {\n                opacity: 1;\n                transform: translateY(0);\n            }\n        }\n        \n        .unit-card {\n            animation: fadeSlideIn 0.4s ease both;\n        }\n        \n        .unit-card:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 8px 24px rgba(0,0,0,0.1) !important;\n        }\n        \n        .unit-card:active {\n            transform: scale(0.98);\n        }\n        \n        /* Custom scrollbar */\n        .ingredients-unit-page *::-webkit-scrollbar {\n            width: 6px;\n        }\n        .ingredients-unit-page *::-webkit-scrollbar-track {\n            background: transparent;\n        }\n        .ingredients-unit-page *::-webkit-scrollbar-thumb {\n            background: #d9d9d9;\n            border-radius: 3px;\n        }\n        .ingredients-unit-page *::-webkit-scrollbar-thumb:hover {\n            background: #bfbfbf;\n        }\n    "}),M=t=>{let{totalUnits:e,activeUnits:i,inactiveUnits:s}=t;return(0,n.jsxs)("div",{style:Z.statsCard,children:[(0,n.jsxs)("div",{style:Z.statItem,children:[(0,n.jsx)("span",{style:{...Z.statNumber,color:"#722ed1"},children:e}),(0,n.jsx)(R,{style:Z.statLabel,children:"ทั้งหมด"})]}),(0,n.jsx)("div",{style:{width:1,background:"#f0f0f0"}}),(0,n.jsxs)("div",{style:Z.statItem,children:[(0,n.jsx)("span",{style:{...Z.statNumber,color:"#52c41a"},children:i}),(0,n.jsx)(R,{style:Z.statLabel,children:"ใช้งาน"})]}),(0,n.jsx)("div",{style:{width:1,background:"#f0f0f0"}}),(0,n.jsxs)("div",{style:Z.statItem,children:[(0,n.jsx)("span",{style:{...Z.statNumber,color:"#ff4d4f"},children:s}),(0,n.jsx)(R,{style:Z.statLabel,children:"ไม่ใช้งาน"})]})]})},E=t=>{let{unit:e,index:i,onEdit:s,onDelete:r}=t;return(0,n.jsx)("div",{className:"unit-card",style:{...Z.unitCard(e.is_active),animationDelay:"".concat(.03*i,"s")},children:(0,n.jsxs)("div",{style:Z.unitCardInner,children:[(0,n.jsx)("div",{style:{width:52,height:52,borderRadius:14,background:"linear-gradient(135deg, #f9f0ff 0%, #efdbff 100%)",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,border:"2px solid #d3adf7"},children:(0,n.jsx)(u.Z,{style:{fontSize:24,color:"#722ed1"}})}),(0,n.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4},children:[(0,n.jsx)(R,{strong:!0,style:{fontSize:16,color:"#1a1a2e"},children:e.display_name}),e.is_active?(0,n.jsx)(k.Z,{style:{color:"#52c41a",fontSize:14}}):(0,n.jsx)(w.Z,{style:{color:"#ff4d4f",fontSize:14}})]}),(0,n.jsxs)("div",{style:{display:"flex",gap:6,flexWrap:"wrap",alignItems:"center"},children:[(0,n.jsx)(C.Z,{color:"purple",style:{borderRadius:8,margin:0,fontSize:12,fontWeight:500},children:e.unit_name}),e.create_date&&(0,n.jsxs)(R,{type:"secondary",style:{fontSize:11},children:["สร้างเมื่อ: ",new Date(e.create_date).toLocaleDateString("th-TH")]})]})]}),(0,n.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,n.jsx)(d.ZP,{type:"text",icon:(0,n.jsx)(U.Z,{}),onClick:t=>{t.stopPropagation(),s(e)},style:{borderRadius:10,color:"#722ed1",background:"#f9f0ff"}}),(0,n.jsx)(d.ZP,{type:"text",danger:!0,icon:(0,n.jsx)(S.Z,{}),onClick:t=>{t.stopPropagation(),r(e)},style:{borderRadius:10,background:"#fff2f0"}})]})]})})};var T=i(25193),I=i(37410),_=i(27623),D=i(20148),z=i(2786),N=i(36799),K=i(5447);let{Text:L}=r.default;function A(){let t=(0,y.useRouter)(),{user:e,loading:i}=(0,j.a)(),r=(0,f.NL)(),{showLoading:C,hideLoading:k}=(0,x.x)(),{socket:w}=(0,b.s)(),[U,S]=(0,s.useState)(null);(0,s.useEffect)(()=>{i||(e&&["Admin","Manager"].includes(e.role)?S(!0):(S(!1),setTimeout(()=>{t.replace("/")},1e3)))},[e,i,t]);let{data:R=""}=(0,m.a)({queryKey:["csrfToken"],queryFn:()=>K.O.getCsrfToken(),staleTime:6e5}),{data:P=[],isLoading:A,isFetching:F}=(0,m.a)({queryKey:["ingredientsUnits"],queryFn:async()=>{let t=await fetch("/api/stock/ingredientsUnit/getAll",{cache:"no-store"});if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.error||e.message||(0,N.t)("ingredientsUnit.fetch.error"))}return await t.json()},staleTime:6e4,enabled:!0===U}),q=(0,g.D)({mutationFn:async t=>{let e=R||await K.O.getCsrfToken();if(!(await fetch("/api/stock/ingredientsUnit/delete/".concat(t.id),{method:"DELETE",headers:{"X-CSRF-Token":e||""}})).ok)throw Error((0,N.t)("ingredientsUnit.fetch.error"));return t.id},onSuccess:(t,e)=>{r.invalidateQueries({queryKey:["ingredientsUnits"]}),a.ZP.success((0,N.t)("ingredientsUnit.delete.success",{name:e.display_name}))},onError:t=>{let e=t instanceof Error?t.message:(0,N.t)("ingredientsUnit.fetch.error");a.ZP.error(e)}});(0,s.useEffect)(()=>{if(w&&!0===U)return w.on(v.b.ingredientsUnit.create,t=>{r.setQueryData(["ingredientsUnits"],function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.some(e=>e.id===t.id)?e:[...e,t]}),a.ZP.success((0,N.t)("ingredientsUnit.create.toast",{name:t.unit_name}))}),w.on(v.b.ingredientsUnit.update,t=>{r.setQueryData(["ingredientsUnits"],function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.map(e=>e.id===t.id?t:e)})}),w.on(v.b.ingredientsUnit.delete,t=>{let{id:e}=t;r.setQueryData(["ingredientsUnits"],function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return t.filter(t=>t.id!==e)})}),()=>{w.off(v.b.ingredientsUnit.create),w.off(v.b.ingredientsUnit.update),w.off(v.b.ingredientsUnit.delete)}},[w,r,U]);let G=()=>{C(),t.push("/stock/ingredientsUnit/manage/add"),setTimeout(()=>k(),1e3)},Q=e=>{C(),t.push("/stock/ingredientsUnit/manage/edit/".concat(e.id)),setTimeout(()=>k(),1e3)},W=t=>{o.Z.confirm({title:(0,N.t)("ingredientsUnit.delete.title"),content:(0,N.t)("ingredientsUnit.delete.content",{name:t.display_name}),okText:(0,N.t)("ingredientsUnit.delete.ok"),okType:"danger",cancelText:(0,N.t)("ingredientsUnit.delete.cancel"),centered:!0,onOk:async()=>{await q.mutateAsync(t)}})};if(i||null===U)return(0,n.jsxs)("div",{style:{display:"flex",height:"100vh",justifyContent:"center",alignItems:"center",flexDirection:"column",gap:16},children:[(0,n.jsx)(c.Z,{size:"large"}),(0,n.jsx)(L,{type:"secondary",children:(0,N.t)("common.checkingAuth")})]});if(!1===U)return(0,n.jsxs)("div",{style:{display:"flex",height:"100vh",justifyContent:"center",alignItems:"center",flexDirection:"column",gap:16},children:[(0,n.jsx)(c.Z,{size:"large"}),(0,n.jsx)(L,{type:"danger",children:(0,N.t)("common.noPermissionRedirect")})]});let Y=P.filter(t=>t.is_active),V=P.filter(t=>!t.is_active);return(0,n.jsxs)("div",{className:"ingredients-unit-page",style:Z.container,children:[(0,n.jsx)(O,{}),(0,n.jsx)(D.Z,{title:(0,N.t)("ingredientsUnit.title"),subtitle:(0,N.t)("ingredientsUnit.subtitle",{count:P.length}),icon:(0,n.jsx)(u.Z,{}),actions:(0,n.jsxs)(l.Z,{size:8,wrap:!0,children:[(0,n.jsx)(d.ZP,{icon:(0,n.jsx)(h.Z,{}),onClick:()=>r.invalidateQueries({queryKey:["ingredientsUnits"]}),loading:F,children:(0,N.t)("ingredientsUnit.button.refresh")}),(0,n.jsx)(d.ZP,{type:"primary",icon:(0,n.jsx)(p.Z,{}),onClick:G,children:(0,N.t)("ingredientsUnit.button.add")})]})}),(0,n.jsx)(T.Z,{children:(0,n.jsxs)(_.Z,{children:[(0,n.jsx)(M,{totalUnits:P.length,activeUnits:Y.length,inactiveUnits:V.length}),(0,n.jsx)(I.Z,{title:(0,N.t)("ingredientsUnit.section.list"),extra:(0,n.jsx)("span",{style:{fontWeight:600},children:P.length}),children:A?(0,n.jsx)("div",{style:{display:"flex",justifyContent:"center",padding:"40px 0"},children:(0,n.jsx)(c.Z,{tip:(0,N.t)("ingredientsUnit.loading")})}):P.length>0?(0,n.jsx)("div",{style:Z.listContainer,children:P.map((t,e)=>(0,n.jsx)(E,{unit:t,index:e,onEdit:Q,onDelete:W},t.id))}):(0,n.jsx)(z.Z,{title:(0,N.t)("ingredientsUnit.empty.title"),description:(0,N.t)("ingredientsUnit.empty.desc"),action:(0,n.jsx)(d.ZP,{type:"primary",icon:(0,n.jsx)(p.Z,{}),onClick:G,children:(0,N.t)("ingredientsUnit.button.add")})})})]})})]})}},2894:function(t,e,i){"use strict";i.d(e,{R:function(){return o},m:function(){return a}});var n=i(18238),s=i(7989),r=i(11255),a=class extends s.F{#t;#e;#i;#n;constructor(t){super(),this.#t=t.client,this.mutationId=t.mutationId,this.#i=t.mutationCache,this.#e=[],this.state=t.state||o(),this.setOptions(t.options),this.scheduleGc()}setOptions(t){this.options=t,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(t){this.#e.includes(t)||(this.#e.push(t),this.clearGcTimeout(),this.#i.notify({type:"observerAdded",mutation:this,observer:t}))}removeObserver(t){this.#e=this.#e.filter(e=>e!==t),this.scheduleGc(),this.#i.notify({type:"observerRemoved",mutation:this,observer:t})}optionalRemove(){this.#e.length||("pending"===this.state.status?this.scheduleGc():this.#i.remove(this))}continue(){return this.#n?.continue()??this.execute(this.state.variables)}async execute(t){let e=()=>{this.#s({type:"continue"})},i={client:this.#t,meta:this.options.meta,mutationKey:this.options.mutationKey};this.#n=(0,r.Mz)({fn:()=>this.options.mutationFn?this.options.mutationFn(t,i):Promise.reject(Error("No mutationFn found")),onFail:(t,e)=>{this.#s({type:"failed",failureCount:t,error:e})},onPause:()=>{this.#s({type:"pause"})},onContinue:e,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#i.canRun(this)});let n="pending"===this.state.status,s=!this.#n.canStart();try{if(n)e();else{this.#s({type:"pending",variables:t,isPaused:s}),await this.#i.config.onMutate?.(t,this,i);let e=await this.options.onMutate?.(t,i);e!==this.state.context&&this.#s({type:"pending",context:e,variables:t,isPaused:s})}let r=await this.#n.start();return await this.#i.config.onSuccess?.(r,t,this.state.context,this,i),await this.options.onSuccess?.(r,t,this.state.context,i),await this.#i.config.onSettled?.(r,null,this.state.variables,this.state.context,this,i),await this.options.onSettled?.(r,null,t,this.state.context,i),this.#s({type:"success",data:r}),r}catch(e){try{await this.#i.config.onError?.(e,t,this.state.context,this,i)}catch(t){Promise.reject(t)}try{await this.options.onError?.(e,t,this.state.context,i)}catch(t){Promise.reject(t)}try{await this.#i.config.onSettled?.(void 0,e,this.state.variables,this.state.context,this,i)}catch(t){Promise.reject(t)}try{await this.options.onSettled?.(void 0,e,t,this.state.context,i)}catch(t){Promise.reject(t)}throw this.#s({type:"error",error:e}),e}finally{this.#i.runNext(this)}}#s(t){this.state=(e=>{switch(t.type){case"failed":return{...e,failureCount:t.failureCount,failureReason:t.error};case"pause":return{...e,isPaused:!0};case"continue":return{...e,isPaused:!1};case"pending":return{...e,context:t.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:t.isPaused,status:"pending",variables:t.variables,submittedAt:Date.now()};case"success":return{...e,data:t.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...e,data:void 0,error:t.error,failureCount:e.failureCount+1,failureReason:t.error,isPaused:!1,status:"error"}}})(this.state),n.Vr.batch(()=>{this.#e.forEach(e=>{e.onMutationUpdate(t)}),this.#i.notify({mutation:this,type:"updated",action:t})})}};function o(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}},21770:function(t,e,i){"use strict";i.d(e,{D:function(){return d}});var n=i(2265),s=i(2894),r=i(18238),a=i(24112),o=i(45345),c=class extends a.l{#t;#r=void 0;#a;#o;constructor(t,e){super(),this.#t=t,this.setOptions(e),this.bindMethods(),this.#c()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){let e=this.options;this.options=this.#t.defaultMutationOptions(t),(0,o.VS)(this.options,e)||this.#t.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#a,observer:this}),e?.mutationKey&&this.options.mutationKey&&(0,o.Ym)(e.mutationKey)!==(0,o.Ym)(this.options.mutationKey)?this.reset():this.#a?.state.status==="pending"&&this.#a.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#a?.removeObserver(this)}onMutationUpdate(t){this.#c(),this.#l(t)}getCurrentResult(){return this.#r}reset(){this.#a?.removeObserver(this),this.#a=void 0,this.#c(),this.#l()}mutate(t,e){return this.#o=e,this.#a?.removeObserver(this),this.#a=this.#t.getMutationCache().build(this.#t,this.options),this.#a.addObserver(this),this.#a.execute(t)}#c(){let t=this.#a?.state??(0,s.R)();this.#r={...t,isPending:"pending"===t.status,isSuccess:"success"===t.status,isError:"error"===t.status,isIdle:"idle"===t.status,mutate:this.mutate,reset:this.reset}}#l(t){r.Vr.batch(()=>{if(this.#o&&this.hasListeners()){let e=this.#r.variables,i=this.#r.context,n={client:this.#t,meta:this.options.meta,mutationKey:this.options.mutationKey};if(t?.type==="success"){try{this.#o.onSuccess?.(t.data,e,i,n)}catch(t){Promise.reject(t)}try{this.#o.onSettled?.(t.data,null,e,i,n)}catch(t){Promise.reject(t)}}else if(t?.type==="error"){try{this.#o.onError?.(t.error,e,i,n)}catch(t){Promise.reject(t)}try{this.#o.onSettled?.(void 0,t.error,e,i,n)}catch(t){Promise.reject(t)}}}this.listeners.forEach(t=>{t(this.#r)})})}},l=i(29827);function d(t,e){let i=(0,l.NL)(e),[s]=n.useState(()=>new c(i,t));n.useEffect(()=>{s.setOptions(t)},[s,t]);let a=n.useSyncExternalStore(n.useCallback(t=>s.subscribe(r.Vr.batchCalls(t)),[s]),()=>s.getCurrentResult(),()=>s.getCurrentResult()),d=n.useCallback((t,e)=>{s.mutate(t,e).catch(o.ZT)},[s]);if(a.error&&(0,o.L3)(s.options.throwOnError,[a.error]))throw a.error;return{...a,mutate:d,mutateAsync:a.mutate}}}},function(t){t.O(0,[253,1522,3418,742,9486,4252,3916,8651,6931,4159,3831,2224,3248,2401,9,9845,9763,1713,8709,9385,3749,2971,2117,1744],function(){return t(t.s=95247)}),_N_E=t.O()}]);