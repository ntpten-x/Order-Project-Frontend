(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2884,3749],{5022:function(e,t,n){Promise.resolve().then(n.bind(n,78560))},78560:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return E}});var r=n(57437),i=n(2265),a=n(99376),d=n(34029),s=n(50742),o=n(48651),l=n(53743),c=n(40312),u=n(49638),p=n(14362),g=n(24675),h=n(5447),x=n(39486),f=n(4156),y=n(91652),b=n(80009),m=n(33477),j=n(8900),k=n(52539),v=n(22623),w=n(96473);let{Text:_,Title:C}=x.default,S={container:{paddingBottom:160,backgroundColor:"#f8f9fc",minHeight:"100vh"},statsCard:{margin:"-40px 16px 0 16px",padding:"16px",background:"white",borderRadius:20,boxShadow:"0 8px 24px rgba(0,0,0,0.08)",display:"flex",justifyContent:"space-around",position:"relative",zIndex:10},statItem:{textAlign:"center",flex:1},statNumber:{fontSize:24,fontWeight:700,display:"block"},statLabel:{fontSize:12,color:"#8c8c8c",marginTop:2},listContainer:{padding:"20px 16px 0 16px"},itemCard:e=>({marginBottom:12,borderRadius:20,border:"none",boxShadow:e?"0 4px 16px rgba(82, 196, 26, 0.2)":"0 2px 8px rgba(0,0,0,0.04)",overflow:"hidden",transition:"all 0.3s ease"}),itemCardInner:e=>({padding:16,display:"flex",alignItems:"flex-start",background:e?"linear-gradient(135deg, #f6ffed 0%, #d9f7be 100%)":"white",position:"relative"}),itemCheckbox:{marginTop:6,marginRight:14,transform:"scale(1.3)"},itemInfo:{flex:1,minWidth:0},orderedTag:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",border:"none",borderRadius:12,padding:"4px 10px",color:"white",fontWeight:600,fontSize:12},quantitySection:{marginTop:10},quantityHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},quantityControls:{display:"flex",alignItems:"center",gap:8},quantityButton:{width:40,height:40,borderRadius:12,display:"flex",alignItems:"center",justifyContent:"center"},quantityInput:{flex:1,textAlign:"center",height:40,borderRadius:12,fontSize:16,fontWeight:600},floatingFooter:{position:"fixed",bottom:70,left:16,right:16,zIndex:99},confirmButton:e=>({height:56,borderRadius:28,fontWeight:700,fontSize:16,boxShadow:e?"0 8px 24px rgba(82, 196, 26, 0.4)":void 0,background:e?"linear-gradient(135deg, #52c41a 0%, #73d13d 100%)":void 0,border:"none"}),modalStyles:{body:{padding:0},mask:{backdropFilter:"blur(8px)",background:"rgba(0, 0, 0, 0.45)"}}},Z=()=>(0,r.jsx)("style",{children:"\n        .buying-page-modal .ant-modal-content {\n            border-radius: 24px !important;\n            overflow: hidden;\n            padding: 0 !important;\n        }\n        \n        @keyframes fadeSlideIn {\n            from {\n                opacity: 0;\n                transform: translateY(12px);\n            }\n            to {\n                opacity: 1;\n                transform: translateY(0);\n            }\n        }\n        \n        .purchase-item-card {\n            animation: fadeSlideIn 0.4s ease both;\n        }\n        \n        .purchase-item-card:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 8px 24px rgba(0,0,0,0.1) !important;\n        }\n        \n        .buying-page .ant-input-number {\n            border-radius: 12px !important;\n        }\n        \n        .buying-page .ant-input-number-input {\n            text-align: center;\n            font-weight: 600;\n            font-size: 16px;\n        }\n        \n        .buying-page .ant-checkbox-inner {\n            border-radius: 6px;\n            width: 22px;\n            height: 22px;\n        }\n        \n        .buying-page .ant-checkbox-checked .ant-checkbox-inner {\n            background: linear-gradient(135deg, #52c41a 0%, #73d13d 100%);\n            border-color: #52c41a;\n        }\n        \n        .buying-page .ant-checkbox-checked .ant-checkbox-inner::after {\n            left: 30%;\n        }\n        \n        /* Custom scrollbar */\n        .buying-page *::-webkit-scrollbar {\n            width: 6px;\n        }\n        .buying-page *::-webkit-scrollbar-track {\n            background: transparent;\n        }\n        .buying-page *::-webkit-scrollbar-thumb {\n            background: #d9d9d9;\n            border-radius: 3px;\n        }\n        .buying-page *::-webkit-scrollbar-thumb:hover {\n            background: #bfbfbf;\n        }\n    "}),P=e=>{let{totalItems:t,purchasedItems:n,notPurchasedItems:i}=e;return(0,r.jsxs)("div",{style:S.statsCard,children:[(0,r.jsxs)("div",{style:S.statItem,children:[(0,r.jsx)("span",{style:{...S.statNumber,color:"#667eea"},children:t}),(0,r.jsx)(_,{style:S.statLabel,children:"รายการทั้งหมด"})]}),(0,r.jsx)("div",{style:{width:1,background:"#f0f0f0"}}),(0,r.jsxs)("div",{style:S.statItem,children:[(0,r.jsx)("span",{style:{...S.statNumber,color:"#52c41a"},children:n}),(0,r.jsx)(_,{style:S.statLabel,children:"เลือกซื้อแล้ว"})]}),(0,r.jsx)("div",{style:{width:1,background:"#f0f0f0"}}),(0,r.jsxs)("div",{style:S.statItem,children:[(0,r.jsx)("span",{style:{...S.statNumber,color:"#faad14"},children:i}),(0,r.jsx)(_,{style:S.statLabel,children:"ยังไม่เลือก"})]})]})},I=e=>{let{item:t,index:n,onCheck:i,onQuantityChange:a,onSetFullAmount:d}=e;return(0,r.jsx)("div",{className:"purchase-item-card",style:{...S.itemCard(t.is_purchased),animationDelay:"".concat(.05*n,"s")},onClick:()=>!t.is_purchased&&i(t.ingredient_id,!0),children:(0,r.jsxs)("div",{style:S.itemCardInner(t.is_purchased),children:[(0,r.jsx)(f.Z,{checked:t.is_purchased,onChange:e=>{e.stopPropagation(),i(t.ingredient_id,e.target.checked)},style:S.itemCheckbox}),(0,r.jsx)(y.Z,{src:t.img_url||"https://placehold.co/72x72/f5f5f5/999999?text=\uD83D\uDCE6",shape:"square",size:72,style:{borderRadius:16,border:t.is_purchased?"3px solid #52c41a":"3px solid white",boxShadow:"0 4px 12px rgba(0,0,0,0.08)",marginRight:14,flexShrink:0}}),(0,r.jsxs)("div",{style:S.itemInfo,children:[(0,r.jsxs)("div",{style:{marginBottom:4},children:[(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:2},children:[(0,r.jsx)(_,{strong:!0,style:{fontSize:16,color:"#1a1a2e"},ellipsis:{tooltip:t.display_name},children:t.display_name}),t.is_purchased&&(0,r.jsx)(j.Z,{style:{color:"#52c41a",fontSize:16}})]}),t.description&&(0,r.jsx)(_,{type:"secondary",style:{fontSize:12,display:"block",marginBottom:4},ellipsis:{tooltip:t.description},children:t.description}),(0,r.jsxs)(b.Z,{style:S.orderedTag,children:["สั่ง ",t.ordered_quantity," ",t.unit_name]})]}),t.is_purchased?(0,r.jsxs)("div",{style:S.quantitySection,onClick:e=>e.stopPropagation(),children:[(0,r.jsxs)("div",{style:S.quantityHeader,children:[(0,r.jsxs)(_,{style:{fontSize:13,color:"#666"},children:["จำนวนที่ซื้อจริง (",t.unit_name,")"]}),(0,r.jsx)(s.ZP,{type:"link",size:"small",onClick:()=>d(t.ingredient_id),style:{padding:"4px 8px",fontSize:13,fontWeight:600,background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"เต็มจำนวน"})]}),(0,r.jsxs)("div",{style:S.quantityControls,children:[(0,r.jsx)(s.ZP,{icon:(0,r.jsx)(v.Z,{}),style:S.quantityButton,onClick:()=>{let e=Math.max(0,t.actual_quantity-1);a(t.ingredient_id,e)}}),(0,r.jsx)(m.Z,{min:0,value:t.actual_quantity,onChange:e=>a(t.ingredient_id,e),style:S.quantityInput,controls:!1}),(0,r.jsx)(s.ZP,{icon:(0,r.jsx)(w.Z,{}),style:S.quantityButton,onClick:()=>{let e=t.actual_quantity+1;a(t.ingredient_id,e)}})]})]}):(0,r.jsxs)(s.ZP,{size:"large",type:"dashed",block:!0,onClick:e=>{e.stopPropagation(),i(t.ingredient_id,!0)},style:{color:"#8c8c8c",borderRadius:12,marginTop:8},children:[(0,r.jsx)(k.Z,{style:{marginRight:6}}),"แตะเพื่อเลือกซื้อ"]})]})]})})},z=()=>(0,r.jsxs)("div",{style:{background:"linear-gradient(135deg, #52c41a 0%, #73d13d 100%)",padding:"24px",position:"relative",overflow:"hidden"},children:[(0,r.jsx)("div",{style:{position:"absolute",top:-30,right:-30,width:100,height:100,borderRadius:"50%",background:"rgba(255,255,255,0.1)"}}),(0,r.jsx)("div",{style:{position:"absolute",bottom:-20,left:-20,width:70,height:70,borderRadius:"50%",background:"rgba(255,255,255,0.08)"}}),(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12,position:"relative",zIndex:1},children:[(0,r.jsx)("div",{style:{width:44,height:44,borderRadius:14,background:"rgba(255,255,255,0.2)",display:"flex",alignItems:"center",justifyContent:"center",backdropFilter:"blur(8px)"},children:(0,r.jsx)(j.Z,{style:{fontSize:22,color:"white"}})}),(0,r.jsxs)("div",{children:[(0,r.jsx)(_,{style:{color:"rgba(255,255,255,0.9)",fontSize:13,display:"block"},children:"ยืนยันการสั่งซื้อ"}),(0,r.jsx)(C,{level:4,style:{color:"white",margin:0,fontWeight:700},children:"สรุปรายการ"})]})]})]}),O=e=>{let{item:t,index:n}=e,i=t.actual_quantity-t.ordered_quantity;return(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:14,padding:14,background:"#fafafa",borderRadius:16,marginBottom:10,animation:"fadeSlideIn 0.3s ease ".concat(.05*n,"s both")},children:[(0,r.jsx)(y.Z,{src:t.img_url||"https://placehold.co/56x56/f5f5f5/999999?text=\uD83D\uDCE6",shape:"square",size:56,style:{borderRadius:12,border:"2px solid white",boxShadow:"0 4px 12px rgba(0,0,0,0.08)"}}),(0,r.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,r.jsx)(_,{strong:!0,style:{fontSize:15,display:"block",color:"#1a1a2e"},ellipsis:{tooltip:t.display_name},children:t.display_name}),(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginTop:4},children:[(0,r.jsxs)(_,{style:{fontSize:13},children:["ซื้อ: ",(0,r.jsx)(_,{strong:!0,style:{color:"#52c41a"},children:t.actual_quantity})]}),(0,r.jsx)(_,{type:"secondary",children:"/"}),(0,r.jsxs)(_,{type:"secondary",style:{fontSize:13},children:["สั่ง: ",t.ordered_quantity]})]})]}),(0,r.jsxs)("div",{style:{textAlign:"right"},children:[(0,r.jsx)("div",{style:{padding:"8px 14px",borderRadius:12,fontWeight:600,fontSize:14,background:0===i?"linear-gradient(135deg, #52c41a 0%, #73d13d 100%)":i>0?"linear-gradient(135deg, #1890ff 0%, #69c0ff 100%)":"linear-gradient(135deg, #ff4d4f 0%, #ff7875 100%)",color:"white",minWidth:60,textAlign:"center"},children:0===i?"ครบ":i>0?"+".concat(i):i}),(0,r.jsx)(_,{style:{fontSize:11,color:"#8c8c8c",marginTop:2,display:"block"},children:t.unit_name})]})]})},R=e=>{let{count:t}=e;return(0,r.jsxs)("div",{style:{marginTop:16,padding:"14px 16px",background:"linear-gradient(135deg, #fffbe6 0%, #fff1b8 100%)",borderRadius:14,border:"1px solid #ffe58f",display:"flex",alignItems:"center",gap:10},children:[(0,r.jsx)("div",{style:{width:32,height:32,borderRadius:10,background:"#faad14",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:16,fontWeight:700},children:"!"}),(0,r.jsxs)(_,{style:{color:"#ad6800",fontSize:13},children:["มี ",(0,r.jsx)(_,{strong:!0,children:t})," รายการที่ ",(0,r.jsx)(_,{strong:!0,children:'"ไม่ได้เลือก"'})," (จะถูกบันทึกว่าไม่ได้ซื้อ)"]})]})};var q=n(25193),B=n(37410),T=n(27623),W=n(20148),D=n(2786),M=n(12028);function E(){let e=(0,a.useSearchParams)(),t=(0,a.useRouter)(),n=e.get("orderId"),{user:x}=(0,p.a)(),[f,y]=(0,i.useState)(null),[b,m]=(0,i.useState)([]),[j,k]=(0,i.useState)(!1),[v,w]=(0,i.useState)(!1),{socket:_}=(0,g.s)(),C=(0,i.useCallback)(async()=>{try{var e;k(!0);let t=await fetch("/api/stock/orders/".concat(n),{cache:"no-store"});if(!t.ok)throw Error("ไม่สามารถโหลดออเดอร์ได้");let r=await t.json();y(r);let i=(null===(e=r.ordersItems)||void 0===e?void 0:e.map(e=>{var t,n,r,i,a;return{ingredient_id:e.ingredient_id,actual_quantity:e.quantity_ordered,ordered_quantity:e.quantity_ordered,is_purchased:!1,display_name:(null===(t=e.ingredient)||void 0===t?void 0:t.display_name)||"Unknown",description:(null===(n=e.ingredient)||void 0===n?void 0:n.description)||"",unit_name:(null===(i=e.ingredient)||void 0===i?void 0:null===(r=i.unit)||void 0===r?void 0:r.display_name)||"-",img_url:null===(a=e.ingredient)||void 0===a?void 0:a.img_url}}))||[];m(i)}catch(e){d.ZP.error("ไม่สามารถโหลดออเดอร์ได้")}finally{k(!1)}},[n]);(0,i.useEffect)(()=>{if(!x){t.push("/login");return}if("Admin"!==x.role&&"Manager"!==x.role){d.ZP.error("คุณไม่มีสิทธิ์เข้าถึงหน้านี้"),t.push("/items");return}n&&C()},[n,x,C,t]),(0,i.useEffect)(()=>{if(!_||!n)return;let e=e=>{(null==e?void 0:e.id)===n&&(C(),d.ZP.info("Order updated."))},r=e=>{(null==e?void 0:e.id)===n&&e.status&&"pending"!==e.status&&("completed"===e.status?d.ZP.success("Purchase completed."):d.ZP.warning("Order was cancelled."),t.push("/stock/items"))},i=e=>{(null==e?void 0:e.id)===n&&(d.ZP.warning("Order was deleted."),t.push("/stock/items"))},a=e=>{(null==e?void 0:e.orderId)===n&&C()},s=e=>{var r,i,a;if("update_order"===e.action&&(null===(r=e.data)||void 0===r?void 0:r.id)===n&&(C(),d.ZP.info("Order updated.")),("update_status"===e.action||"delete"===e.action)&&((null===(i=e.data)||void 0===i?void 0:i.id)===n||e.id===n)){let n=null===(a=e.data)||void 0===a?void 0:a.status;"delete"===e.action?(d.ZP.warning("Order was deleted."),t.push("/stock/items")):n&&"pending"!==n&&("completed"===n?d.ZP.success("Purchase completed."):d.ZP.warning("Order was cancelled."),t.push("/stock/items"))}};return _.on(M.b.stockOrders.update,e),_.on(M.b.stockOrders.status,r),_.on(M.b.stockOrders.delete,i),_.on(M.b.stockOrders.detailUpdate,a),_.on(M.g.stockOrdersUpdated,s),()=>{_.off(M.b.stockOrders.update,e),_.off(M.b.stockOrders.status,r),_.off(M.b.stockOrders.delete,i),_.off(M.b.stockOrders.detailUpdate,a),_.off(M.g.stockOrdersUpdated,s)}},[_,n,C,t]);let E=(e,t)=>{m(b.map(n=>n.ingredient_id===e?{...n,is_purchased:t}:n))},H=(e,t)=>{null!==t&&m(b.map(n=>n.ingredient_id===e?{...n,actual_quantity:t}:n))},N=e=>{m(b.map(t=>t.ingredient_id===e?{...t,actual_quantity:t.ordered_quantity,is_purchased:!0}:t))},[U,L]=(0,i.useState)("");(0,i.useEffect)(()=>{(async()=>{try{let e=await h.O.getCsrfToken();L(e)}catch(e){console.error("Failed to fetch CSRF token",e)}})()},[]);let F=async()=>{if(!x){d.ZP.error("ไม่พบผู้ใช้งาน");return}try{k(!0);let e=b.map(e=>({ingredient_id:e.ingredient_id,actual_quantity:e.is_purchased?e.actual_quantity:0,is_purchased:e.is_purchased}));if(!(await fetch("/api/stock/orders/".concat(n,"/purchase"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":U},body:JSON.stringify({items:e,purchased_by_id:x.id})})).ok)throw Error("ไม่สามารถยืนยันการสั่งซื้อได้");d.ZP.success("บันทึกการสั่งซื้อเรียบร้อย"),w(!1),t.push("/stock/history")}catch(e){console.error(e),d.ZP.error("ไม่สามารถยืนยันการสั่งซื้อได้")}finally{k(!1)}},A=b.filter(e=>e.is_purchased),G=b.filter(e=>!e.is_purchased),Q=A.length>0,X=(null==f?void 0:f.id)?f.id.substring(0,8).toUpperCase():void 0;return n?j&&!f?(0,r.jsxs)("div",{className:"buying-page",style:S.container,children:[(0,r.jsx)(Z,{}),(0,r.jsx)(W.Z,{title:"รายละเอียดการสั่งซื้อสินค้า",subtitle:"กำลังโหลด",icon:(0,r.jsx)(c.Z,{}),onBack:()=>t.back()}),(0,r.jsx)(q.Z,{children:(0,r.jsx)(B.Z,{children:(0,r.jsx)("div",{style:{display:"flex",justifyContent:"center",padding:32},children:(0,r.jsx)(o.Z,{size:"large"})})})})]}):(0,r.jsxs)("div",{className:"buying-page",style:S.container,children:[(0,r.jsx)(Z,{}),(0,r.jsx)(W.Z,{title:"รายละเอียดการสั่งซื้อสินค้า",subtitle:X?"ออเดอร์ #".concat(X):void 0,icon:(0,r.jsx)(c.Z,{}),onBack:()=>t.back()}),(0,r.jsx)(q.Z,{children:(0,r.jsxs)(T.Z,{children:[(0,r.jsx)(B.Z,{title:"สรุป",children:(0,r.jsx)(P,{totalItems:b.length,purchasedItems:A.length,notPurchasedItems:G.length})}),(0,r.jsx)(B.Z,{title:"รายการสินค้า",extra:(0,r.jsx)("span",{style:{fontWeight:600},children:b.length}),children:(0,r.jsx)("div",{style:S.listContainer,children:b.length>0?b.map((e,t)=>(0,r.jsx)(I,{item:e,index:t,onCheck:E,onQuantityChange:H,onSetFullAmount:N},e.ingredient_id)):(0,r.jsx)(D.Z,{title:"ยังไม่มีรายการสินค้า",description:"ยังไม่มีรายการสินค้าในออเดอร์นี้"})})})]})}),(0,r.jsx)("div",{style:S.floatingFooter,children:(0,r.jsxs)(s.ZP,{type:"primary",size:"large",block:!0,icon:(0,r.jsx)(c.Z,{style:{fontSize:18}}),onClick:()=>w(!0),disabled:!Q,style:S.confirmButton(Q),children:["ยืนยันการสั่งซื้อ (",A.length," รายการ)"]})}),(0,r.jsxs)(l.Z,{open:v,onCancel:()=>w(!1),footer:null,width:520,centered:!0,className:"buying-page-modal",styles:S.modalStyles,closeIcon:null,children:[(0,r.jsx)(z,{}),(0,r.jsxs)("div",{style:{padding:"20px 24px 24px"},children:[(0,r.jsx)("div",{style:{maxHeight:320,overflowY:"auto",paddingRight:4,marginBottom:16},children:A.map((e,t)=>(0,r.jsx)(O,{item:e,index:t},e.ingredient_id))}),G.length>0&&(0,r.jsx)(R,{count:G.length}),(0,r.jsxs)("div",{style:{display:"flex",gap:12,marginTop:20},children:[(0,r.jsx)(s.ZP,{block:!0,size:"large",onClick:()=>w(!1),icon:(0,r.jsx)(u.Z,{}),style:{height:48,borderRadius:12,fontWeight:600},children:"กลับ"}),(0,r.jsx)(s.ZP,{type:"primary",block:!0,size:"large",onClick:F,loading:j,style:{height:48,borderRadius:12,fontWeight:600,background:"linear-gradient(135deg, #52c41a 0%, #73d13d 100%)",border:"none",boxShadow:"0 4px 16px rgba(82, 196, 26, 0.35)"},children:"ยืนยันการสั่งซื้อ"})]})]})]})]}):(0,r.jsxs)("div",{className:"buying-page",style:S.container,children:[(0,r.jsx)(Z,{}),(0,r.jsx)(W.Z,{title:"รายละเอียดการสั่งซื้อสินค้า",subtitle:"ไม่พบออเดอร์",icon:(0,r.jsx)(c.Z,{}),onBack:()=>t.back()}),(0,r.jsx)(q.Z,{children:(0,r.jsx)(B.Z,{children:(0,r.jsx)(D.Z,{title:"กรุณาเลือกออเดอร์ก่อน",description:"เลือกออเดอร์จากหน้ารายการเพื่อดำเนินการสั่งซื้อ",action:(0,r.jsx)(s.ZP,{type:"primary",onClick:()=>t.push("/stock/items"),children:"กลับหน้ารายการออเดอร์"})})})})]})}},25193:function(e,t,n){"use strict";n.d(t,{Z:function(){return d}});var r=n(57437);n(2265);var i=n(38616),a=n(87530);function d(e){let{children:t,maxWidth:n=a.H.pageMaxWidth,style:d}=e,s=i.default.useBreakpoint().md?a.H.pagePaddingXDesktop:a.H.pagePaddingXMobile;return(0,r.jsx)("div",{style:{width:"100%",maxWidth:n,margin:"0 auto",padding:"".concat(a.H.pagePaddingY,"px ").concat(s,"px"),...d},children:t})}},20148:function(e,t,n){"use strict";n.d(t,{Z:function(){return u}});var r=n(57437);n(2265);var i=n(17588),a=n(2651),d=n(38616),s=n(10868),o=n(50742),l=n(39486),c=n(87530);function u(e){let{title:t,subtitle:n,icon:u,onBack:p,actions:g,style:h}=e,{token:x}=a.default.useToken(),f=d.default.useBreakpoint().md?c.H.pagePaddingXDesktop:c.H.pagePaddingXMobile;return(0,r.jsx)("div",{style:{padding:"".concat(c.H.pagePaddingY,"px ").concat(f,"px"),background:x.colorBgContainer,borderBottom:"1px solid ".concat(x.colorBorderSecondary),...h},children:(0,r.jsxs)(s.Z,{align:"center",justify:"space-between",wrap:"wrap",gap:12,style:{maxWidth:c.H.pageMaxWidth,margin:"0 auto"},children:[(0,r.jsxs)(s.Z,{align:"center",gap:12,style:{minWidth:0},children:[p&&(0,r.jsx)(o.ZP,{type:"text","aria-label":"ย้อนกลับ",icon:(0,r.jsx)(i.Z,{}),onClick:p,style:{borderRadius:12,width:44,height:44}}),u&&(0,r.jsx)("div",{style:{width:44,height:44,borderRadius:14,display:"grid",placeItems:"center",background:x.colorFillTertiary,color:x.colorText},children:u}),(0,r.jsxs)("div",{style:{minWidth:0},children:[(0,r.jsx)(l.default.Title,{level:4,style:{margin:0},children:t}),n&&(0,r.jsx)(l.default.Text,{type:"secondary",children:n})]})]}),g&&(0,r.jsx)(s.Z,{gap:8,wrap:"wrap",children:g})]})})}},37410:function(e,t,n){"use strict";n.d(t,{Z:function(){return l}});var r=n(57437);n(2265);var i=n(2651),a=n(96931),d=n(10868),s=n(39486),o=n(87530);function l(e){let{title:t,extra:n,children:l,style:c}=e,{token:u}=i.default.useToken();return(0,r.jsx)(a.Z,{size:"small",variant:"outlined",style:{borderRadius:o.H.cardRadiusLG,...c},styles:{header:t?{borderBottomColor:u.colorBorderSecondary}:{display:"none"}},title:t?(0,r.jsxs)(d.Z,{align:"center",justify:"space-between",gap:12,children:[(0,r.jsx)(s.default.Text,{strong:!0,children:t}),n]}):void 0,children:l})}},27623:function(e,t,n){"use strict";n.d(t,{Z:function(){return d}});var r=n(57437);n(2265);var i=n(10868),a=n(87530);function d(e){let{children:t,gap:n=a.H.sectionGap,style:d}=e;return(0,r.jsx)(i.Z,{vertical:!0,gap:n,style:d,children:t})}},2786:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var r=n(57437);n(2265);var i=n(96931),a=n(85180),d=n(39486),s=n(87530);function o(e){let{title:t="ไม่มีข้อมูล",description:n,action:o,image:l}=e;return(0,r.jsx)(i.Z,{size:"small",variant:"outlined",style:{borderRadius:s.H.cardRadiusLG},bodyStyle:{padding:20},children:(0,r.jsx)(a.Z,{image:l,description:(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[(0,r.jsx)(d.default.Text,{strong:!0,children:t}),n?(0,r.jsx)(d.default.Text,{type:"secondary",children:n}):null]}),children:o})})}},87530:function(e,t,n){"use strict";n.d(t,{H:function(){return r}});let r={pageMaxWidth:1200,pagePaddingXMobile:16,pagePaddingXDesktop:24,pagePaddingY:16,sectionGap:16,cardRadius:16,cardRadiusLG:20,cardShadow:"0 10px 24px rgba(15, 23, 42, 0.08)",surfaceBg:"#ffffff",surfaceBorder:"#e2e8f0"}},14362:function(e,t,n){"use strict";n.d(t,{AuthProvider:function(){return p},a:function(){return g}});var r=n(57437),i=n(2265),a=n(99376),d=n(5447),s=n(84859),o=n(48651),l=n(3369),c=n(36799);let u=(0,i.createContext)(void 0),p=e=>{let{children:t}=e,[n,p]=(0,i.useState)(null),[g,h]=(0,i.useState)(!0),x=(0,a.useRouter)(),f=(0,a.usePathname)(),y=async()=>{try{let e=await d.O.getMe();p(e)}catch(e){p(null)}finally{h(!1)}};(0,i.useEffect)(()=>{y()},[]);let{showLoading:b,hideLoading:m}=(0,l.x)();(0,i.useEffect)(()=>{g||n||"/login"===f||x.push("/login")},[n,g,f,x]);let j=async e=>{try{b((0,c.t)("auth.loadingLogin"));let t=await d.O.getCsrfToken(),{token:n,...r}=await d.O.login(e,t);p(r),x.push("/")}catch(e){throw e}finally{m()}},k=async()=>{try{b((0,c.t)("auth.loadingLogout")),await d.O.logout(),s.x.clearQueue(),p(null),x.push("/login")}catch(e){console.error("Logout error:",e)}finally{m()}};return g?(0,r.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center",background:"#ffffff"},children:(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"12px",padding:"24px",background:"#ffffff",borderRadius:"20px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.1)"},children:[(0,r.jsx)(o.Z,{size:"large"}),(0,r.jsx)("div",{style:{color:"#64748b",fontSize:"14px",fontWeight:500},children:"กำลังตรวจสอบสิทธิ์..."})]})}):n||"/login"===f?(0,r.jsx)(u.Provider,{value:{user:n,loading:g,login:j,logout:k,checkAuth:y},children:t}):null},g=()=>{let e=(0,i.useContext)(u);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}},46252:function(e,t,n){"use strict";n.d(t,{J:function(){return o},SocketProvider:function(){return l}});var r=n(57437),i=n(2265),a=n(68680),d=n(34029),s=n(14362);let o=(0,i.createContext)({socket:null,isConnected:!1}),l=e=>{let{children:t}=e,[n,l]=(0,i.useState)(null),[c,u]=(0,i.useState)(!1),p=(0,i.useRef)(!1),{user:g}=(0,s.a)();return(0,i.useEffect)(()=>{var e;if(!g){n&&(n.disconnect(),l(null),u(!1));return}let t=(null===(e=g.branch)||void 0===e?void 0:e.id)||g.branch_id||null,r=(0,a.io)("http://localhost:3000",{transports:["websocket"],withCredentials:!0,auth:{userId:g.id,branchId:t},reconnection:!0,reconnectionAttempts:5,reconnectionDelay:800,reconnectionDelayMax:8e3});return r.on("connect",()=>{console.log("Socket Connected:",r.id),u(!0),p.current=!1,d.ZP.success({content:"เชื่อมต่อเรียลไทม์แล้ว",key:"socket-status",duration:1.5})}),r.on("disconnect",()=>{console.log("Socket Disconnected"),u(!1),p.current||(p.current=!0,d.ZP.warning({content:"การเชื่อมต่อเรียลไทม์หลุด กำลังพยายามเชื่อมต่อใหม่...",key:"socket-status",duration:2}))}),r.io.on("reconnect_attempt",e=>{console.log("Socket reconnect attempt",e),u(!1)}),r.io.on("reconnect_failed",()=>{console.log("Socket reconnect failed"),d.ZP.error({content:"เชื่อมต่อเรียลไทม์ไม่สำเร็จ",key:"socket-status",duration:2})}),l(r),()=>{r.disconnect()}},[null==g?void 0:g.id]),(0,r.jsx)(o.Provider,{value:{socket:n,isConnected:c},children:t})}},3369:function(e,t,n){"use strict";n.d(t,{GlobalLoadingProvider:function(){return o},O:function(){return c},x:function(){return l}});var r=n(57437),i=n(2265),a=n(48651);let d=(0,i.createContext)(void 0),s=(0,i.createContext)(void 0),o=e=>{let{children:t}=e,[n,o]=(0,i.useState)({}),[l,c]=(0,i.useState)(void 0),u=(0,i.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default";o(e=>({...e,[t]:(e[t]||0)+1})),e&&c(e)},[]),p=(0,i.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";o(t=>{if(!t[e])return t;let n={...t};return n[e]-=1,n[e]<=0&&delete n[e],n})},[]),g=(0,i.useCallback)(()=>{o({}),c(void 0)},[]),h=Object.keys(n).length>0,x=(0,i.useMemo)(()=>({isLoading:h,loadingMessage:l}),[h,l]),f=(0,i.useMemo)(()=>({showLoading:u,hideLoading:p,resetLoading:g}),[u,p,g]);return(0,r.jsx)(s.Provider,{value:f,children:(0,r.jsxs)(d.Provider,{value:x,children:[t,h&&(0,r.jsx)("div",{role:"status","aria-live":"polite",className:"global-loading-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:13e3,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(255, 255, 255, 0.7)",backdropFilter:"blur(6px)",WebkitBackdropFilter:"blur(6px)",transition:"opacity 0.25s ease"},children:(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:16,background:"rgba(255, 255, 255, 0.95)",padding:"28px 40px",borderRadius:20,boxShadow:"0 10px 32px rgba(15, 23, 42, 0.14)",border:"1px solid rgba(148, 163, 184, 0.35)",minWidth:240,textAlign:"center"},children:[(0,r.jsx)(a.Z,{size:"large"}),l&&(0,r.jsx)("div",{style:{fontSize:16,color:"#334155",fontWeight:600,letterSpacing:"0.01em"},children:l})]})})]})})};function l(){let e=(0,i.useContext)(d),t=(0,i.useContext)(s);if(!e||!t)throw Error("useGlobalLoading must be used within a GlobalLoadingProvider");return(0,i.useMemo)(()=>({...e,...t}),[e,t])}function c(){let e=(0,i.useContext)(s);if(!e)throw Error("useGlobalLoadingDispatch must be used within a GlobalLoadingProvider");return e}},24675:function(e,t,n){"use strict";n.d(t,{s:function(){return a}});var r=n(2265),i=n(46252);let a=()=>(0,r.useContext)(i.J)},84859:function(e,t,n){"use strict";n.d(t,{M:function(){return o},x:function(){return s}});let r="pos_offline_queue",i=()=>{let e=localStorage.getItem(r);return e?JSON.parse(e):[]},a=e=>{let t=Date.now();return e.filter(e=>t-e.timestamp<=6048e5)},d=e=>{localStorage.setItem(r,JSON.stringify(e))},s={addToQueue:(e,t)=>{let n=a(i()),r={id:"offline-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),type:e,payload:t,timestamp:Date.now(),retryCount:0};return d([...n,r]),r},getQueue:()=>i(),removeFromQueue:e=>{d(i().filter(t=>t.id!==e))},incrementRetry:(e,t)=>{d(i().map(n=>n.id===e?{...n,retryCount:n.retryCount+1,lastError:t}:n))},clearQueue:()=>{localStorage.removeItem(r)},pruneExceeded:()=>{d(a(i()).filter(e=>e.retryCount<=5))}},o={maxRetry:5,backoff:e=>Math.min(3e4,2e3*e)}},12028:function(e,t,n){"use strict";n.d(t,{b:function(){return r},g:function(){return i}});let r={system:{announcement:"system:announcement"},users:{create:"users:create",update:"users:update",delete:"users:delete",status:"users:update-status"},roles:{create:"roles:create",update:"roles:update",delete:"roles:delete"},branches:{create:"branches:create",update:"branches:update",delete:"branches:delete"},products:{create:"products:create",update:"products:update",delete:"products:delete"},productsUnit:{create:"productsUnit:create",update:"productsUnit:update",delete:"productsUnit:delete"},categories:{create:"category:create",update:"category:update",delete:"category:delete"},tables:{create:"tables:create",update:"tables:update",delete:"tables:delete"},orders:{create:"orders:create",update:"orders:update",delete:"orders:delete"},payments:{create:"payments:create",update:"payments:update",delete:"payments:delete"},discounts:{create:"discounts:create",update:"discounts:update",delete:"discounts:delete"},delivery:{create:"delivery:create",update:"delivery:update",delete:"delivery:delete"},shifts:{update:"shifts:update"},orderQueue:{added:"order-queue:added",updated:"order-queue:updated",removed:"order-queue:removed",reordered:"order-queue:reordered"},ingredients:{create:"ingredients:create",update:"ingredients:update",delete:"ingredients:delete"},ingredientsUnit:{create:"ingredientsUnit:create",update:"ingredientsUnit:update",delete:"ingredientsUnit:delete"},stock:{update:"stock:update"},stockOrders:{create:"stock:orders:create",update:"stock:orders:update",status:"stock:orders:status",delete:"stock:orders:delete",detailUpdate:"stock:orders:detail:update"},paymentAccounts:{create:"payment-accounts:create",update:"payment-accounts:update",delete:"payment-accounts:delete"},paymentMethods:{create:"paymentMethod:create",update:"paymentMethod:update",delete:"paymentMethod:delete"},shopProfile:{update:"shopProfile:update"},salesOrderItem:{create:"salesOrderItem:create",update:"salesOrderItem:update",delete:"salesOrderItem:delete"},salesOrderDetail:{create:"salesOrderDetail:create",update:"salesOrderDetail:update",delete:"salesOrderDetail:delete"}},i={stockOrdersUpdated:"orders_updated"}}},function(e){e.O(0,[253,1522,3418,742,9486,4252,3916,8651,6931,4159,3831,2224,3248,2401,9,9845,4547,1652,9600,9385,2971,2117,1744],function(){return e(e.s=5022)}),_N_E=e.O()}]);