(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[961],{25325:function(e,t,r){Promise.resolve().then(r.bind(r,84823))},84823:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return R}});var n=r(57437),i=r(2265),s=r(34029),o=r(53743),l=r(50742),d=r(48651),a=r(62297),c=r(84588),f=r(12609),x=r(57835),h=r(24675),p=r(14362),g=r(5447),u=r(25193),y=r(20148),b=r(37410),j=r(2786),m=r(19683),v=r(80009),C=r(91652),k=r(8900),w=r(39725),Z=r(6520),S=r(26349),E=r(15883),I=r(49634),D=r(52539);let{Text:_,Title:z}=m.default,T={container:{paddingBottom:100,backgroundColor:"#f8f9fc",minHeight:"100vh"},statsCard:{margin:"-40px 16px 0 16px",padding:"16px",background:"white",borderRadius:20,boxShadow:"0 8px 24px rgba(0,0,0,0.08)",display:"flex",justifyContent:"space-around",position:"relative",zIndex:10},statItem:{textAlign:"center",flex:1},statNumber:{fontSize:24,fontWeight:700,display:"block"},statLabel:{fontSize:12,color:"#8c8c8c",marginTop:2},listContainer:{padding:"20px 16px 0 16px"},orderCard:e=>({marginBottom:12,borderRadius:20,border:"none",boxShadow:"0 2px 8px rgba(0,0,0,0.04)",overflow:"hidden",transition:"all 0.3s ease",background:e===f.i.COMPLETED?"linear-gradient(to right, #f6ffed, white)":"linear-gradient(to right, #fff2f0, white)"}),orderCardInner:{padding:16,display:"flex",flexDirection:"column",gap:12},orderHeader:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},orderInfo:{display:"flex",alignItems:"center",gap:10},orderActions:{display:"flex",gap:8}},N={[f.i.PENDING]:{color:"#faad14",bgColor:"linear-gradient(135deg, #fffbe6 0%, #fff1b8 100%)",borderColor:"#ffe58f",icon:(0,n.jsx)(n.Fragment,{}),label:"รอดำเนินการ",tagColor:"gold"},[f.i.COMPLETED]:{color:"#52c41a",bgColor:"linear-gradient(135deg, #f6ffed 0%, #d9f7be 100%)",borderColor:"#b7eb8f",icon:(0,n.jsx)(k.Z,{style:{color:"#52c41a"}}),label:"เสร็จสิ้น",tagColor:"success"},[f.i.CANCELLED]:{color:"#ff4d4f",bgColor:"linear-gradient(135deg, #fff2f0 0%, #ffccc7 100%)",borderColor:"#ffa39e",icon:(0,n.jsx)(w.Z,{style:{color:"#ff4d4f"}}),label:"ยกเลิก",tagColor:"error"}},L=()=>(0,n.jsx)("style",{children:"\n        .history-page-modal .ant-modal-content {\n            border-radius: 24px !important;\n            overflow: hidden;\n            padding: 0 !important;\n        }\n        \n        @keyframes fadeSlideIn {\n            from {\n                opacity: 0;\n                transform: translateY(12px);\n            }\n            to {\n                opacity: 1;\n                transform: translateY(0);\n            }\n        }\n        \n        .history-order-card {\n            animation: fadeSlideIn 0.4s ease both;\n        }\n        \n        .history-order-card:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 8px 24px rgba(0,0,0,0.1) !important;\n        }\n        \n        .history-order-card:active {\n            transform: scale(0.98);\n        }\n        \n        /* Custom scrollbar */\n        .history-page *::-webkit-scrollbar {\n            width: 6px;\n        }\n        .history-page *::-webkit-scrollbar-track {\n            background: transparent;\n        }\n        .history-page *::-webkit-scrollbar-thumb {\n            background: #d9d9d9;\n            border-radius: 3px;\n        }\n        .history-page *::-webkit-scrollbar-thumb:hover {\n            background: #bfbfbf;\n        }\n    "}),P=e=>{let{totalOrders:t,completedOrders:r,cancelledOrders:i}=e;return(0,n.jsxs)("div",{style:T.statsCard,children:[(0,n.jsxs)("div",{style:T.statItem,children:[(0,n.jsx)("span",{style:{...T.statNumber,color:"#667eea"},children:t}),(0,n.jsx)(_,{style:T.statLabel,children:"ทั้งหมด"})]}),(0,n.jsx)("div",{style:{width:1,background:"#f0f0f0"}}),(0,n.jsxs)("div",{style:T.statItem,children:[(0,n.jsx)("span",{style:{...T.statNumber,color:"#52c41a"},children:r}),(0,n.jsx)(_,{style:T.statLabel,children:"เสร็จสิ้น"})]}),(0,n.jsx)("div",{style:{width:1,background:"#f0f0f0"}}),(0,n.jsxs)("div",{style:T.statItem,children:[(0,n.jsx)("span",{style:{...T.statNumber,color:"#ff4d4f"},children:i}),(0,n.jsx)(_,{style:T.statLabel,children:"ยกเลิก"})]})]})},O=e=>{var t,r,i,s,o;let{order:d,index:a,onView:c,onDelete:x,isAdmin:h}=e,p=N[d.status]||N[f.i.PENDING],g=(null===(t=d.ordersItems)||void 0===t?void 0:t.length)||0,u=(null===(r=d.ordersItems)||void 0===r?void 0:r.filter(e=>{var t;return null===(t=e.ordersDetail)||void 0===t?void 0:t.is_purchased}).length)||0,y=(null===(i=d.ordersItems)||void 0===i?void 0:i.slice(0,3))||[],b=g-3;return(0,n.jsx)("div",{className:"history-order-card",style:{...T.orderCard(d.status),animationDelay:"".concat(.05*a,"s")},children:(0,n.jsxs)("div",{style:T.orderCardInner,children:[(0,n.jsxs)("div",{style:T.orderHeader,children:[(0,n.jsxs)("div",{style:T.orderInfo,children:[(0,n.jsx)("div",{style:{width:44,height:44,borderRadius:12,background:p.bgColor,border:"1px solid ".concat(p.borderColor),display:"flex",alignItems:"center",justifyContent:"center",fontSize:20},children:p.icon}),(0,n.jsxs)("div",{children:[(0,n.jsxs)(_,{strong:!0,style:{fontSize:15,color:"#1a1a2e",display:"block"},children:["#",d.id.substring(0,8).toUpperCase()]}),(0,n.jsx)(v.Z,{color:p.tagColor,style:{marginTop:4,borderRadius:10,fontWeight:600},children:p.label})]})]}),(0,n.jsxs)("div",{style:T.orderActions,children:[(0,n.jsx)(l.ZP,{type:"primary",size:"small",icon:(0,n.jsx)(Z.Z,{}),onClick:()=>c(d),style:{borderRadius:10,background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",border:"none"},children:"ดู"}),h&&(0,n.jsx)(l.ZP,{danger:!0,size:"small",icon:(0,n.jsx)(S.Z,{}),onClick:()=>x(d),style:{borderRadius:10},children:"ลบ"})]})]}),(0,n.jsxs)("div",{style:{display:"flex",gap:16,padding:"12px 0",borderTop:"1px solid #f0f0f0",borderBottom:"1px solid #f0f0f0"},children:[(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:6},children:[(0,n.jsx)(E.Z,{style:{color:"#8c8c8c"}}),(0,n.jsx)(_,{type:"secondary",style:{fontSize:13},children:(null===(s=d.ordered_by)||void 0===s?void 0:s.name)||(null===(o=d.ordered_by)||void 0===o?void 0:o.username)||"Unknown"})]}),(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:6},children:[(0,n.jsx)(I.Z,{style:{color:"#8c8c8c"}}),(0,n.jsx)(_,{type:"secondary",style:{fontSize:13},children:new Date(d.create_date).toLocaleDateString("th-TH",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:6,marginBottom:10},children:[(0,n.jsx)(D.Z,{style:{color:"#667eea",fontSize:14}}),(0,n.jsx)(_,{style:{fontSize:13,color:"#666"},children:d.status===f.i.COMPLETED?"ซื้อแล้ว ".concat(u,"/").concat(g," รายการ"):"".concat(g," รายการ")})]}),(0,n.jsxs)("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[y.map(e=>{var t,r,i,s,o,l;return(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,padding:"6px 10px",background:"#f5f5f5",borderRadius:10},children:[(0,n.jsx)(C.Z,{src:(null===(t=e.ingredient)||void 0===t?void 0:t.img_url)||"https://placehold.co/32x32/f5f5f5/999999?text=\uD83D\uDCE6",size:28,shape:"square",style:{borderRadius:6}}),(0,n.jsxs)("div",{children:[(0,n.jsx)(_,{style:{fontSize:12,display:"block"},ellipsis:{tooltip:null===(r=e.ingredient)||void 0===r?void 0:r.display_name},children:null===(i=e.ingredient)||void 0===i?void 0:i.display_name}),(0,n.jsxs)(_,{type:"secondary",style:{fontSize:11},children:[(null===(s=e.ordersDetail)||void 0===s?void 0:s.is_purchased)?e.ordersDetail.actual_quantity:e.quantity_ordered," ",null===(l=e.ingredient)||void 0===l?void 0:null===(o=l.unit)||void 0===o?void 0:o.display_name]})]})]},e.id)}),b>0&&(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"6px 12px",background:"#e6f4ff",borderRadius:10,color:"#1890ff",fontWeight:600,fontSize:12},children:["+",b," อื่นๆ"]})]})]})]})})};function R(){let[e,t]=(0,i.useState)([]),[r,m]=(0,i.useState)(!0),[v,C]=(0,i.useState)(null),{socket:k}=(0,h.s)(),{user:w}=(0,p.a)(),[Z,S]=(0,i.useState)(1),[E,I]=(0,i.useState)(10),[D,_]=(0,i.useState)(0),[z,N]=(0,i.useState)("");(0,i.useEffect)(()=>{(async()=>{try{let e=await g.O.getCsrfToken();N(e)}catch(e){console.error("Failed to fetch CSRF token",e)}})()},[]);let R=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;try{m(!0);let n=await fetch("/api/stock/orders?status=completed,cancelled&page=".concat(e,"&limit=").concat(r),{cache:"no-store"});if(!n.ok)throw Error("Failed to fetch orders");let i=await n.json();Array.isArray(i)?(t(i),_(i.length)):(t(i.data),_(i.total))}catch(e){console.error("Failed to fetch orders"),s.ZP.error("ไม่สามารถโหลดประวัติออเดอร์ได้")}finally{m(!1)}},A=e=>{o.Z.confirm({title:"ยืนยันการลบ",content:"คุณต้องการลบประวัติออเดอร์ #".concat(e.id.substring(0,8).toUpperCase()," หรือไม่? ข้อมูลที่เกี่ยวข้องทั้งหมดจะถูกลบด้วย"),okText:"ลบ",okType:"danger",cancelText:"ยกเลิก",centered:!0,onOk:async()=>{try{if(!(await fetch("/api/stock/orders/".concat(e.id),{method:"DELETE",headers:{"X-CSRF-Token":z}})).ok)throw Error("Failed to delete order");s.ZP.success("ลบประวัติออเดอร์สำเร็จ"),R(Z,E)}catch(e){s.ZP.error("ลบประวัติออเดอร์ล้มเหลว")}}})};(0,i.useEffect)(()=>{R(Z,E)},[Z,E]),(0,i.useEffect)(()=>{if(k)return k.on("orders_updated",()=>{R(Z,E)}),()=>{k.off("orders_updated")}},[k,Z,E]);let F=e.filter(e=>e.status===f.i.COMPLETED),H=e.filter(e=>e.status===f.i.CANCELLED),W=(null==w?void 0:w.role)==="Admin";return r&&0===e.length?(0,n.jsxs)("div",{style:{minHeight:"100vh",background:T.container.backgroundColor},children:[(0,n.jsx)(L,{}),(0,n.jsx)(y.Z,{title:"ประวัติออเดอร์สต็อก",subtitle:"รายการที่เสร็จสิ้น/ยกเลิก",icon:(0,n.jsx)(c.Z,{}),actions:(0,n.jsx)(l.ZP,{onClick:()=>R(Z,E),loading:r,children:"รีเฟรช"})}),(0,n.jsx)(u.Z,{children:(0,n.jsx)(b.Z,{children:(0,n.jsx)("div",{style:{display:"flex",justifyContent:"center",padding:"60px 0"},children:(0,n.jsx)(d.Z,{size:"large"})})})})]}):(0,n.jsxs)("div",{className:"history-page",style:T.container,children:[(0,n.jsx)(L,{}),(0,n.jsx)(y.Z,{title:"ประวัติออเดอร์สต็อก",subtitle:"รายการที่เสร็จสิ้น/ยกเลิก",icon:(0,n.jsx)(c.Z,{}),actions:(0,n.jsx)(l.ZP,{onClick:()=>R(Z,E),loading:r,children:"รีเฟรช"})}),(0,n.jsxs)(u.Z,{children:[(0,n.jsx)(b.Z,{children:(0,n.jsx)(P,{totalOrders:D,completedOrders:F.length,cancelledOrders:H.length})}),(0,n.jsx)(b.Z,{title:"ประวัติทั้งหมด",extra:(0,n.jsxs)("span",{style:{fontWeight:600},children:[D," รายการ"]}),children:(0,n.jsx)("div",{style:T.listContainer,children:e.length>0?(0,n.jsxs)(n.Fragment,{children:[e.map((e,t)=>(0,n.jsx)(O,{order:e,index:t,onView:C,onDelete:A,isAdmin:W},e.id)),(0,n.jsx)("div",{style:{display:"flex",justifyContent:"center",marginTop:24},children:(0,n.jsx)(a.Z,{current:Z,pageSize:E,total:D,onChange:(e,t)=>{S(e),I(t)},showSizeChanger:!0,showTotal:e=>"ทั้งหมด ".concat(e," รายการ")})})]}):(0,n.jsx)(j.Z,{title:"ยังไม่มีประวัติออเดอร์",description:"เมื่อมีรายการเสร็จสิ้น/ยกเลิก จะแสดงที่หน้านี้"})})}),(0,n.jsx)(x.Z,{open:!!v,order:v,onClose:()=>C(null)})]})]})}}},function(e){e.O(0,[8024,4736,8592,1744],function(){return e(e.s=25325)}),_N_E=e.O()}]);