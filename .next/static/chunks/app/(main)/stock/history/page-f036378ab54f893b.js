(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[961],{25325:function(e,t,r){Promise.resolve().then(r.bind(r,84823))},84823:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return O}});var n=r(57437),o=r(2265),i=r(34029),s=r(53743),l=r(48651),a=r(8056),d=r(84588),c=r(12609),u=r(57835),f=r(24675),h=r(14362),g=r(5447),p=r(82646),x=r(50742),y=r(80009),b=r(91652),m=r(85180),v=r(8900),j=r(39725),S=r(6520),C=r(26349),k=r(15883),w=r(49634),E=r(52539);let{Text:I,Title:T}=p.default,D={container:{paddingBottom:100,backgroundColor:"#f8f9fc",minHeight:"100vh"},header:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",padding:"20px 20px 60px 20px",position:"relative",overflow:"hidden"},headerDecoCircle1:{position:"absolute",top:-50,right:-50,width:150,height:150,borderRadius:"50%",background:"rgba(255,255,255,0.1)"},headerDecoCircle2:{position:"absolute",bottom:-30,left:-30,width:100,height:100,borderRadius:"50%",background:"rgba(255,255,255,0.08)"},headerContent:{position:"relative",zIndex:1,display:"flex",alignItems:"center",justifyContent:"space-between"},headerLeft:{display:"flex",alignItems:"center",gap:12},headerIconBox:{width:48,height:48,borderRadius:14,background:"rgba(255,255,255,0.2)",display:"flex",alignItems:"center",justifyContent:"center",backdropFilter:"blur(8px)"},statsCard:{margin:"-40px 16px 0 16px",padding:"16px",background:"white",borderRadius:20,boxShadow:"0 8px 24px rgba(0,0,0,0.08)",display:"flex",justifyContent:"space-around",position:"relative",zIndex:10},statItem:{textAlign:"center",flex:1},statNumber:{fontSize:24,fontWeight:700,display:"block"},statLabel:{fontSize:12,color:"#8c8c8c",marginTop:2},listContainer:{padding:"20px 16px 0 16px"},sectionTitle:{display:"flex",alignItems:"center",gap:8,marginBottom:16},orderCard:e=>({marginBottom:12,borderRadius:20,border:"none",boxShadow:"0 2px 8px rgba(0,0,0,0.04)",overflow:"hidden",transition:"all 0.3s ease",background:e===c.i.COMPLETED?"linear-gradient(to right, #f6ffed, white)":"linear-gradient(to right, #fff2f0, white)"}),orderCardInner:{padding:16,display:"flex",flexDirection:"column",gap:12},orderHeader:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},orderInfo:{display:"flex",alignItems:"center",gap:10},orderActions:{display:"flex",gap:8}},R={[c.i.PENDING]:{color:"#faad14",bgColor:"linear-gradient(135deg, #fffbe6 0%, #fff1b8 100%)",borderColor:"#ffe58f",icon:(0,n.jsx)(n.Fragment,{}),label:"รอดำเนินการ",tagColor:"gold"},[c.i.COMPLETED]:{color:"#52c41a",bgColor:"linear-gradient(135deg, #f6ffed 0%, #d9f7be 100%)",borderColor:"#b7eb8f",icon:(0,n.jsx)(v.Z,{style:{color:"#52c41a"}}),label:"เสร็จสิ้น",tagColor:"success"},[c.i.CANCELLED]:{color:"#ff4d4f",bgColor:"linear-gradient(135deg, #fff2f0 0%, #ffccc7 100%)",borderColor:"#ffa39e",icon:(0,n.jsx)(j.Z,{style:{color:"#ff4d4f"}}),label:"ยกเลิก",tagColor:"error"}},_=()=>(0,n.jsx)("style",{children:"\n        .history-page-modal .ant-modal-content {\n            border-radius: 24px !important;\n            overflow: hidden;\n            padding: 0 !important;\n        }\n        \n        @keyframes fadeSlideIn {\n            from {\n                opacity: 0;\n                transform: translateY(12px);\n            }\n            to {\n                opacity: 1;\n                transform: translateY(0);\n            }\n        }\n        \n        .history-order-card {\n            animation: fadeSlideIn 0.4s ease both;\n        }\n        \n        .history-order-card:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 8px 24px rgba(0,0,0,0.1) !important;\n        }\n        \n        .history-order-card:active {\n            transform: scale(0.98);\n        }\n        \n        /* Custom scrollbar */\n        .history-page *::-webkit-scrollbar {\n            width: 6px;\n        }\n        .history-page *::-webkit-scrollbar-track {\n            background: transparent;\n        }\n        .history-page *::-webkit-scrollbar-thumb {\n            background: #d9d9d9;\n            border-radius: 3px;\n        }\n        .history-page *::-webkit-scrollbar-thumb:hover {\n            background: #bfbfbf;\n        }\n    "}),P=e=>{let{onRefresh:t,loading:r}=e;return(0,n.jsxs)("div",{style:D.header,children:[(0,n.jsx)("div",{style:D.headerDecoCircle1}),(0,n.jsx)("div",{style:D.headerDecoCircle2}),(0,n.jsxs)("div",{style:D.headerContent,children:[(0,n.jsxs)("div",{style:D.headerLeft,children:[(0,n.jsx)("div",{style:D.headerIconBox,children:(0,n.jsx)(d.Z,{style:{fontSize:24,color:"white"}})}),(0,n.jsxs)("div",{children:[(0,n.jsx)(I,{style:{color:"rgba(255,255,255,0.85)",fontSize:13,display:"block"},children:"ประวัติทั้งหมด"}),(0,n.jsx)(T,{level:4,style:{color:"white",margin:0,fontWeight:700,letterSpacing:"0.5px"},children:"รายการสั่งซื้อ"})]})]}),(0,n.jsx)(x.ZP,{type:"text",icon:(0,n.jsx)(d.Z,{style:{color:"white"}}),onClick:t,loading:r,style:{background:"rgba(255,255,255,0.2)",borderRadius:12,height:40,color:"white",fontWeight:600},children:"รีเฟรช"})]})]})},A=e=>{let{totalOrders:t,completedOrders:r,cancelledOrders:o}=e;return(0,n.jsxs)("div",{style:D.statsCard,children:[(0,n.jsxs)("div",{style:D.statItem,children:[(0,n.jsx)("span",{style:{...D.statNumber,color:"#667eea"},children:t}),(0,n.jsx)(I,{style:D.statLabel,children:"ทั้งหมด"})]}),(0,n.jsx)("div",{style:{width:1,background:"#f0f0f0"}}),(0,n.jsxs)("div",{style:D.statItem,children:[(0,n.jsx)("span",{style:{...D.statNumber,color:"#52c41a"},children:r}),(0,n.jsx)(I,{style:D.statLabel,children:"เสร็จสิ้น"})]}),(0,n.jsx)("div",{style:{width:1,background:"#f0f0f0"}}),(0,n.jsxs)("div",{style:D.statItem,children:[(0,n.jsx)("span",{style:{...D.statNumber,color:"#ff4d4f"},children:o}),(0,n.jsx)(I,{style:D.statLabel,children:"ยกเลิก"})]})]})},z=e=>{var t,r,o,i;let{order:s,index:l,onView:a,onDelete:d,isAdmin:u}=e,f=R[s.status]||R[c.i.PENDING],h=(null===(t=s.ordersItems)||void 0===t?void 0:t.length)||0,g=(null===(r=s.ordersItems)||void 0===r?void 0:r.filter(e=>{var t;return null===(t=e.ordersDetail)||void 0===t?void 0:t.is_purchased}).length)||0,p=(null===(o=s.ordersItems)||void 0===o?void 0:o.slice(0,3))||[],m=h-3;return(0,n.jsx)("div",{className:"history-order-card",style:{...D.orderCard(s.status),animationDelay:"".concat(.05*l,"s")},children:(0,n.jsxs)("div",{style:D.orderCardInner,children:[(0,n.jsxs)("div",{style:D.orderHeader,children:[(0,n.jsxs)("div",{style:D.orderInfo,children:[(0,n.jsx)("div",{style:{width:44,height:44,borderRadius:12,background:f.bgColor,border:"1px solid ".concat(f.borderColor),display:"flex",alignItems:"center",justifyContent:"center",fontSize:20},children:f.icon}),(0,n.jsxs)("div",{children:[(0,n.jsxs)(I,{strong:!0,style:{fontSize:15,color:"#1a1a2e",display:"block"},children:["#",s.id.substring(0,8).toUpperCase()]}),(0,n.jsx)(y.Z,{color:f.tagColor,style:{marginTop:4,borderRadius:10,fontWeight:600},children:f.label})]})]}),(0,n.jsxs)("div",{style:D.orderActions,children:[(0,n.jsx)(x.ZP,{type:"primary",size:"small",icon:(0,n.jsx)(S.Z,{}),onClick:()=>a(s),style:{borderRadius:10,background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",border:"none"},children:"ดู"}),u&&(0,n.jsx)(x.ZP,{danger:!0,size:"small",icon:(0,n.jsx)(C.Z,{}),onClick:()=>d(s),style:{borderRadius:10},children:"ลบ"})]})]}),(0,n.jsxs)("div",{style:{display:"flex",gap:16,padding:"12px 0",borderTop:"1px solid #f0f0f0",borderBottom:"1px solid #f0f0f0"},children:[(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:6},children:[(0,n.jsx)(k.Z,{style:{color:"#8c8c8c"}}),(0,n.jsx)(I,{type:"secondary",style:{fontSize:13},children:(null===(i=s.ordered_by)||void 0===i?void 0:i.username)||"Unknown"})]}),(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:6},children:[(0,n.jsx)(w.Z,{style:{color:"#8c8c8c"}}),(0,n.jsx)(I,{type:"secondary",style:{fontSize:13},children:new Date(s.create_date).toLocaleDateString("th-TH",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:6,marginBottom:10},children:[(0,n.jsx)(E.Z,{style:{color:"#667eea",fontSize:14}}),(0,n.jsx)(I,{style:{fontSize:13,color:"#666"},children:s.status===c.i.COMPLETED?"ซื้อแล้ว ".concat(g,"/").concat(h," รายการ"):"".concat(h," รายการ")})]}),(0,n.jsxs)("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[p.map(e=>{var t,r,o,i,s,l;return(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,padding:"6px 10px",background:"#f5f5f5",borderRadius:10},children:[(0,n.jsx)(b.Z,{src:(null===(t=e.ingredient)||void 0===t?void 0:t.img_url)||"https://placehold.co/32x32/f5f5f5/999999?text=\uD83D\uDCE6",size:28,shape:"square",style:{borderRadius:6}}),(0,n.jsxs)("div",{children:[(0,n.jsx)(I,{style:{fontSize:12,display:"block"},ellipsis:{tooltip:null===(r=e.ingredient)||void 0===r?void 0:r.display_name},children:null===(o=e.ingredient)||void 0===o?void 0:o.display_name}),(0,n.jsxs)(I,{type:"secondary",style:{fontSize:11},children:[(null===(i=e.ordersDetail)||void 0===i?void 0:i.is_purchased)?e.ordersDetail.actual_quantity:e.quantity_ordered," ",null===(l=e.ingredient)||void 0===l?void 0:null===(s=l.unit)||void 0===s?void 0:s.display_name]})]})]},e.id)}),m>0&&(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"6px 12px",background:"#e6f4ff",borderRadius:10,color:"#1890ff",fontWeight:600,fontSize:12},children:["+",m," อื่นๆ"]})]})]})]})})},L=()=>(0,n.jsx)(m.Z,{image:m.Z.PRESENTED_IMAGE_SIMPLE,description:(0,n.jsxs)("div",{style:{textAlign:"center"},children:[(0,n.jsx)(I,{type:"secondary",style:{fontSize:15},children:"ยังไม่มีประวัติการสั่งซื้อ"}),(0,n.jsx)("br",{}),(0,n.jsx)(I,{type:"secondary",style:{fontSize:13},children:"เมื่อมีการสั่งซื้อเสร็จสิ้นหรือยกเลิก จะแสดงที่นี่"})]}),style:{padding:"60px 20px",background:"white",borderRadius:20,margin:"0 16px"}});function O(){let[e,t]=(0,o.useState)([]),[r,p]=(0,o.useState)(!0),[x,y]=(0,o.useState)(null),{socket:b}=(0,f.s)(),{user:m}=(0,h.a)(),[v,j]=(0,o.useState)(1),[S,C]=(0,o.useState)(10),[k,w]=(0,o.useState)(0),[E,I]=(0,o.useState)("");(0,o.useEffect)(()=>{(async()=>{try{let e=await g.O.getCsrfToken();I(e)}catch(e){console.error("Failed to fetch CSRF token",e)}})()},[]);let T=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;try{p(!0);let n=await fetch("/api/stock/orders?status=completed,cancelled&page=".concat(e,"&limit=").concat(r),{cache:"no-store"});if(!n.ok)throw Error("Failed to fetch orders");let o=await n.json();Array.isArray(o)?(t(o),w(o.length)):(t(o.data),w(o.total))}catch(e){console.error("Failed to fetch orders"),i.ZP.error("ไม่สามารถโหลดประวัติออเดอร์ได้")}finally{p(!1)}},R=e=>{s.Z.confirm({title:"ยืนยันการลบ",content:"คุณต้องการลบประวัติออเดอร์ #".concat(e.id.substring(0,8).toUpperCase()," หรือไม่? ข้อมูลที่เกี่ยวข้องทั้งหมดจะถูกลบด้วย"),okText:"ลบ",okType:"danger",cancelText:"ยกเลิก",centered:!0,onOk:async()=>{try{if(!(await fetch("/api/stock/orders/".concat(e.id),{method:"DELETE",headers:{"X-CSRF-Token":E}})).ok)throw Error("Failed to delete order");i.ZP.success("ลบประวัติออเดอร์สำเร็จ"),T(v,S)}catch(e){i.ZP.error("ลบประวัติออเดอร์ล้มเหลว")}}})};(0,o.useEffect)(()=>{T(v,S)},[v,S]),(0,o.useEffect)(()=>{if(b)return b.on("orders_updated",()=>{T(v,S)}),()=>{b.off("orders_updated")}},[b,v,S]);let O=e.filter(e=>e.status===c.i.COMPLETED),Z=e.filter(e=>e.status===c.i.CANCELLED),N=(null==m?void 0:m.role)==="Admin";return r&&0===e.length?(0,n.jsx)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",minHeight:"100vh",flexDirection:"column",gap:16},children:(0,n.jsx)(l.Z,{size:"large"})}):(0,n.jsxs)("div",{className:"history-page",style:D.container,children:[(0,n.jsx)(_,{}),(0,n.jsx)(P,{onRefresh:()=>T(v,S),loading:r}),(0,n.jsx)(A,{totalOrders:k,completedOrders:O.length,cancelledOrders:Z.length}),(0,n.jsx)("div",{style:D.listContainer,children:e.length>0?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{style:D.sectionTitle,children:[(0,n.jsx)(d.Z,{style:{fontSize:18,color:"#667eea"}}),(0,n.jsx)("span",{style:{fontSize:16,fontWeight:600,color:"#1a1a2e"},children:"ประวัติทั้งหมด"}),(0,n.jsxs)("div",{style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",padding:"4px 12px",borderRadius:20,fontSize:12,fontWeight:600},children:[k," รายการ"]})]}),e.map((e,t)=>(0,n.jsx)(z,{order:e,index:t,onView:y,onDelete:R,isAdmin:N},e.id)),(0,n.jsx)("div",{style:{display:"flex",justifyContent:"center",marginTop:24},children:(0,n.jsx)(a.Z,{current:v,pageSize:S,total:k,onChange:(e,t)=>{j(e),C(t)},showSizeChanger:!0,showTotal:e=>"ทั้งหมด ".concat(e," รายการ")})})]}):(0,n.jsx)(L,{})}),(0,n.jsx)(u.Z,{open:!!x,order:x,onClose:()=>y(null)})]})}},57835:function(e,t,r){"use strict";r.d(t,{Z:function(){return T}});var n=r(57437);r(2265);var o=r(82646),i=r(35713),s=r(91652),l=r(89970),a=r(80009),d=r(53743),c=r(96931),u=r(23496),f=r(85180),h=r(50742),g=r(99277),p=r(8900),x=r(39725),y=r(40312),b=r(15883),m=r(49634),v=r(38434),j=r(52539),S=r(12609);let{Text:C,Title:k}=o.default,w={[S.i.PENDING]:{color:"#faad14",bgColor:"linear-gradient(135deg, #fffbe6 0%, #fff1b8 100%)",borderColor:"#ffe58f",icon:(0,n.jsx)(g.Z,{style:{color:"#faad14"}}),label:"รอดำเนินการ",tagColor:"gold"},[S.i.COMPLETED]:{color:"#52c41a",bgColor:"linear-gradient(135deg, #f6ffed 0%, #d9f7be 100%)",borderColor:"#b7eb8f",icon:(0,n.jsx)(p.Z,{style:{color:"#52c41a"}}),label:"เสร็จสิ้น",tagColor:"success"},[S.i.CANCELLED]:{color:"#ff4d4f",bgColor:"linear-gradient(135deg, #fff2f0 0%, #ffccc7 100%)",borderColor:"#ffa39e",icon:(0,n.jsx)(x.Z,{style:{color:"#ff4d4f"}}),label:"ยกเลิก",tagColor:"error"}},E=e=>{let{icon:t,label:r,value:o,valueStyle:i}=e;return(0,n.jsxs)("div",{style:{display:"flex",alignItems:"flex-start",gap:12,padding:"12px 0"},children:[(0,n.jsx)("div",{style:{width:36,height:36,borderRadius:10,background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:16,flexShrink:0},children:t}),(0,n.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,n.jsx)(C,{type:"secondary",style:{fontSize:12,display:"block"},children:r}),(0,n.jsx)("div",{style:{fontWeight:500,marginTop:2,...i},children:o})]})]})},I=e=>{var t,r,o,d,c,u,f,h;let{item:g,index:x}=e,y=null===(t=g.ordersDetail)||void 0===t?void 0:t.is_purchased,b=null===(r=g.ordersDetail)||void 0===r?void 0:r.actual_quantity,m=g.quantity_ordered,v=(null===(d=g.ingredient)||void 0===d?void 0:null===(o=d.unit)||void 0===o?void 0:o.display_name)||"",j=y&&void 0!==b&&b!==m;return(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:16,padding:16,background:"#fafafa",borderRadius:16,marginBottom:12,border:"1px solid #f0f0f0",transition:"all 0.3s ease",animation:"slideIn 0.3s ease ".concat(.05*x,"s both")},className:"item-card",children:[(0,n.jsx)(i.Z,{count:y?(0,n.jsx)(p.Z,{style:{color:"#52c41a",fontSize:16}}):0,offset:[-4,4],children:(0,n.jsx)(s.Z,{src:(null===(c=g.ingredient)||void 0===c?void 0:c.img_url)||"https://placehold.co/60x60/f5f5f5/999999?text=\uD83D\uDCE6",shape:"square",size:64,style:{borderRadius:12,border:"2px solid #fff",boxShadow:"0 4px 12px rgba(0,0,0,0.08)",objectFit:"cover"}})}),(0,n.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,n.jsx)(C,{strong:!0,style:{fontSize:15,display:"block",marginBottom:4,color:"#1a1a2e"},ellipsis:{tooltip:null===(u=g.ingredient)||void 0===u?void 0:u.display_name},children:(null===(f=g.ingredient)||void 0===f?void 0:f.display_name)||"ไม่ทราบชื่อสินค้า"}),(0,n.jsx)(C,{type:"secondary",style:{fontSize:13},children:(null===(h=g.ingredient)||void 0===h?void 0:h.description)||"ไม่มีรายละเอียดเพิ่มเติม"})]}),(0,n.jsxs)("div",{style:{textAlign:"right"},children:[(0,n.jsxs)("div",{style:{background:y?"linear-gradient(135deg, #52c41a 0%, #73d13d 100%)":"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",padding:"8px 14px",borderRadius:12,fontWeight:600,fontSize:14,minWidth:80,textAlign:"center",boxShadow:"0 4px 12px rgba(102, 126, 234, 0.25)"},children:[y?b:m," ",v]}),j&&(0,n.jsx)(l.Z,{title:"จำนวนที่สั่งเดิม",children:(0,n.jsxs)(C,{type:"secondary",style:{fontSize:11,display:"block",marginTop:4,textDecoration:"line-through"},children:["สั่ง ",m," ",v]})}),g.ordersDetail&&!y&&(0,n.jsx)(a.Z,{color:"error",style:{marginTop:4},children:"ยังไม่ได้ซื้อ"})]})]})};function T(e){var t,r,o;let{order:i,open:s,onClose:l}=e;if(!i)return null;let g=w[i.status]||w[S.i.PENDING],p=(null===(t=i.ordersItems)||void 0===t?void 0:t.length)||0,x=(null===(r=i.ordersItems)||void 0===r?void 0:r.filter(e=>{var t;return null===(t=e.ordersDetail)||void 0===t?void 0:t.is_purchased}).length)||0;return(0,n.jsxs)(d.Z,{open:s,onCancel:l,footer:null,width:520,centered:!0,className:"order-detail-modal",style:{top:20},styles:{body:{padding:0},mask:{backdropFilter:"blur(8px)",background:"rgba(0, 0, 0, 0.45)"}},closeIcon:null,children:[(0,n.jsxs)("div",{style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",padding:"28px 24px 24px",position:"relative",overflow:"hidden"},children:[(0,n.jsx)("div",{style:{position:"absolute",top:-50,right:-50,width:150,height:150,borderRadius:"50%",background:"rgba(255,255,255,0.1)"}}),(0,n.jsx)("div",{style:{position:"absolute",bottom:-30,left:-30,width:100,height:100,borderRadius:"50%",background:"rgba(255,255,255,0.08)"}}),(0,n.jsxs)("div",{style:{position:"relative",zIndex:1},children:[(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12},children:[(0,n.jsx)("div",{style:{width:48,height:48,borderRadius:14,background:"rgba(255,255,255,0.2)",display:"flex",alignItems:"center",justifyContent:"center",backdropFilter:"blur(8px)"},children:(0,n.jsx)(y.Z,{style:{fontSize:24,color:"white"}})}),(0,n.jsxs)("div",{children:[(0,n.jsx)(C,{style:{color:"rgba(255,255,255,0.8)",fontSize:13,display:"block"},children:"รายละเอียดออเดอร์"}),(0,n.jsxs)(k,{level:4,style:{color:"white",margin:0,fontWeight:700,letterSpacing:"0.5px"},children:["#",i.id.substring(0,8).toUpperCase()]})]})]}),(0,n.jsx)(a.Z,{icon:g.icon,style:{background:g.bgColor,border:"1px solid ".concat(g.borderColor),borderRadius:20,padding:"6px 14px",fontSize:13,fontWeight:600,color:g.color,display:"flex",alignItems:"center",gap:6},children:g.label})]}),p>0&&(0,n.jsxs)("div",{style:{marginTop:20},children:[(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[(0,n.jsx)(C,{style:{color:"rgba(255,255,255,0.9)",fontSize:12},children:"ความคืบหน้า"}),(0,n.jsxs)(C,{style:{color:"white",fontWeight:600,fontSize:12},children:[x,"/",p," รายการ"]})]}),(0,n.jsx)("div",{style:{height:6,background:"rgba(255,255,255,0.2)",borderRadius:3,overflow:"hidden"},children:(0,n.jsx)("div",{style:{height:"100%",width:"".concat(x/p*100,"%"),background:"white",borderRadius:3,transition:"width 0.5s ease"}})})]})]})]}),(0,n.jsxs)("div",{style:{padding:"20px 24px 24px"},children:[(0,n.jsxs)(c.Z,{size:"small",style:{borderRadius:16,border:"none",background:"#fff",boxShadow:"0 2px 12px rgba(0,0,0,0.04)",marginBottom:20},styles:{body:{padding:"8px 16px"}},children:[(0,n.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:0},children:[(0,n.jsx)(E,{icon:(0,n.jsx)(b.Z,{}),label:"ผู้สั่งซื้อ",value:(null===(o=i.ordered_by)||void 0===o?void 0:o.name)||"Unknown"}),(0,n.jsx)(E,{icon:(0,n.jsx)(m.Z,{}),label:"วันที่สั่ง",value:new Date(i.create_date).toLocaleDateString("th-TH",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})})]}),i.remark&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(u.Z,{style:{margin:"4px 0 8px"}}),(0,n.jsx)(E,{icon:(0,n.jsx)(v.Z,{}),label:"หมายเหตุ",value:i.remark,valueStyle:{color:"#8c8c8c",fontWeight:400}})]})]}),(0,n.jsxs)("div",{style:{marginBottom:20},children:[(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:16},children:[(0,n.jsx)(j.Z,{style:{fontSize:18,color:"#667eea"}}),(0,n.jsx)(C,{strong:!0,style:{fontSize:16,color:"#1a1a2e"},children:"รายการสินค้า"}),(0,n.jsxs)("div",{style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",padding:"2px 10px",borderRadius:20,fontSize:12,fontWeight:600},children:[p," รายการ"]})]}),(0,n.jsx)("div",{style:{maxHeight:300,overflowY:"auto",paddingRight:4,scrollbarWidth:"thin",scrollbarColor:"#d9d9d9 transparent"},children:i.ordersItems&&i.ordersItems.length>0?i.ordersItems.map((e,t)=>(0,n.jsx)(I,{item:e,index:t},e.id)):(0,n.jsx)(f.Z,{description:"ไม่มีรายการสินค้า",image:f.Z.PRESENTED_IMAGE_SIMPLE,style:{padding:"40px 0"}})})]}),(0,n.jsx)("div",{style:{display:"flex",gap:12},children:(0,n.jsx)(h.ZP,{type:"primary",block:!0,size:"large",onClick:l,style:{height:48,borderRadius:12,fontWeight:600,background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",border:"none",boxShadow:"0 4px 16px rgba(102, 126, 234, 0.35)"},children:"ปิด"})})]}),(0,n.jsx)("style",{children:"\n                .order-detail-modal .ant-modal-content {\n                    border-radius: 24px !important;\n                    overflow: hidden;\n                    padding: 0 !important;\n                }\n                \n                @keyframes slideIn {\n                    from {\n                        opacity: 0;\n                        transform: translateY(10px);\n                    }\n                    to {\n                        opacity: 1;\n                        transform: translateY(0);\n                    }\n                }\n                \n                .item-card:hover {\n                    background: #f0f5ff !important;\n                    border-color: #adc6ff !important;\n                    transform: translateX(4px);\n                }\n                \n                /* Custom scrollbar */\n                *::-webkit-scrollbar {\n                    width: 6px;\n                }\n                *::-webkit-scrollbar-track {\n                    background: transparent;\n                }\n                *::-webkit-scrollbar-thumb {\n                    background: #d9d9d9;\n                    border-radius: 3px;\n                }\n                *::-webkit-scrollbar-thumb:hover {\n                    background: #bfbfbf;\n                }\n            "})]})}},71567:function(e,t,r){"use strict";r.d(t,{q:function(){return o},v:function(){return n}});let n="/api",o={AUTH:{LOGIN:"/auth/login",ME:"/auth/me",CSRF:"/csrf"},POS:{PRODUCTS:"/pos/products",ORDERS:"/pos/orders",TABLES:"/pos/tables",DISCOUNTS:"/pos/discounts",DELIVERY:"/pos/delivery",PAYMENT_METHODS:"/pos/paymentMethod",PAYMENTS:"/pos/payments",CATEGORY:"/pos/category",SHIFTS:{BASE:"/pos/shifts",CURRENT:"/pos/shifts/current",OPEN:"/pos/shifts/open",CLOSE:"/pos/shifts/close"},DASHBOARD:{SALES:"/pos/dashboard/sales",TOP_ITEMS:"/pos/dashboard/top-items"},CHANNELS:{STATS:"/pos/orders/stats"},SHOP_PROFILE:"/pos/shopProfile",SALES_ORDER_ITEMS:"/pos/salesOrderItem",SALES_ORDER_DETAILS:"/pos/salesOrderDetail",PRODUCTS_UNIT:"/pos/productsUnit",PAYMENT_DETAILS:"/pos/paymentDetails",BRANCH:"/branches"}}},14362:function(e,t,r){"use strict";r.d(t,{AuthProvider:function(){return u},a:function(){return f}});var n=r(57437),o=r(2265),i=r(99376),s=r(5447),l=r(84859),a=r(48651),d=r(3369);let c=(0,o.createContext)(void 0),u=e=>{let{children:t}=e,[r,u]=(0,o.useState)(null),[f,h]=(0,o.useState)(!0),g=(0,i.useRouter)(),p=(0,i.usePathname)(),x=async()=>{try{let e="";e=localStorage.getItem("token_ws")||"";let t=await s.O.getMe(e);u(t)}catch(e){u(null)}finally{h(!1)}};(0,o.useEffect)(()=>{x()},[]);let{showLoading:y,hideLoading:b}=(0,d.x)();(0,o.useEffect)(()=>{f||r||"/login"===p||g.push("/login")},[r,f,p,g]);let m=async e=>{try{y("กำลังเข้าสู่ระบบ...");let t=await s.O.getCsrfToken(),{token:r,...n}=await s.O.login(e,t);r&&localStorage.setItem("token_ws",r),u(n),g.push("/")}catch(e){throw e}finally{b()}},v=async()=>{try{y("กำลังออกจากระบบ...");let e="";e=localStorage.getItem("token_ws")||"",await s.O.logout(e),localStorage.removeItem("token_ws"),l.x.clearQueue(),u(null),g.push("/login")}catch(e){console.error("Logout error:",e)}finally{b()}};return f?(0,n.jsx)("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-white",children:(0,n.jsx)(a.Z,{size:"large"})}):r||"/login"===p?(0,n.jsx)(c.Provider,{value:{user:r,loading:f,login:m,logout:v,checkAuth:x},children:t}):null},f=()=>{let e=(0,o.useContext)(c);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}},46252:function(e,t,r){"use strict";r.d(t,{J:function(){return l},SocketProvider:function(){return a}});var n=r(57437),o=r(2265),i=r(68680),s=r(14362);let l=(0,o.createContext)({socket:null,isConnected:!1}),a=e=>{let{children:t}=e,[r,a]=(0,o.useState)(null),[d,c]=(0,o.useState)(!1),{user:u}=(0,s.a)();return(0,o.useEffect)(()=>{if(!u){r&&(r.disconnect(),a(null),c(!1));return}let e=localStorage.getItem("token_ws"),t=(0,i.io)("http://localhost:3000",{transports:["websocket"],withCredentials:!0,auth:e?{token:e}:void 0});return t.on("connect",()=>{console.log("Socket Connected:",t.id),c(!0)}),t.on("disconnect",()=>{console.log("Socket Disconnected"),c(!1)}),a(t),()=>{t.disconnect()}},[u]),(0,n.jsx)(l.Provider,{value:{socket:r,isConnected:d},children:t})}},3369:function(e,t,r){"use strict";r.d(t,{GlobalLoadingProvider:function(){return a},O:function(){return c},x:function(){return d}});var n=r(57437),o=r(2265),i=r(48651);let s=(0,o.createContext)(void 0),l=(0,o.createContext)(void 0),a=e=>{let{children:t}=e,[r,a]=(0,o.useState)({}),[d,c]=(0,o.useState)(void 0),u=(0,o.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default";a(e=>({...e,[t]:(e[t]||0)+1})),e&&c(e)},[]),f=(0,o.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";a(t=>{if(!t[e])return t;let r={...t};return r[e]-=1,r[e]<=0&&delete r[e],r})},[]),h=(0,o.useCallback)(()=>{a({}),c(void 0)},[]),g=Object.keys(r).length>0,p=(0,o.useMemo)(()=>({isLoading:g,loadingMessage:d}),[g,d]),x=(0,o.useMemo)(()=>({showLoading:u,hideLoading:f,resetLoading:h}),[u,f,h]);return(0,n.jsx)(l.Provider,{value:x,children:(0,n.jsxs)(s.Provider,{value:p,children:[t,g&&(0,n.jsx)("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center pointer-events-auto bg-black/10 backdrop-blur-[1px]",children:(0,n.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:10,background:"rgba(255, 255, 255, 0.9)",padding:"20px 40px",borderRadius:12,boxShadow:"0 4px 12px rgba(0,0,0,0.1)"},children:[(0,n.jsx)(i.Z,{size:"large"}),d&&(0,n.jsx)("div",{style:{fontSize:14,color:"#1f1f1f",fontWeight:500},children:d})]})})]})})};function d(){let e=(0,o.useContext)(s),t=(0,o.useContext)(l);if(!e||!t)throw Error("useGlobalLoading must be used within a GlobalLoadingProvider");return(0,o.useMemo)(()=>({...e,...t}),[e,t])}function c(){let e=(0,o.useContext)(l);if(!e)throw Error("useGlobalLoadingDispatch must be used within a GlobalLoadingProvider");return e}},24675:function(e,t,r){"use strict";r.d(t,{s:function(){return i}});var n=r(2265),o=r(46252);let i=()=>(0,n.useContext)(o.J)},2913:function(e,t,r){"use strict";function n(e,t){return({GET:"".concat(o.API_BASE_URL).concat(t),POST:"".concat(o.API_BASE_URL).concat(t),PUT:"".concat(o.API_BASE_URL).concat(t),DELETE:"".concat(o.API_BASE_URL).concat(t),PATCH:"".concat(o.API_BASE_URL).concat(t)})[e]}r.d(t,{b:function(){return n}});let o={get API_BASE_URL(){return"/api"}}},5447:function(e,t,r){"use strict";r.d(t,{O:function(){return i}});var n=r(71567),o=r(2913);let i={login:async(e,t,r)=>{try{let i=(0,o.b)("POST",n.q.AUTH.LOGIN),s={"Content-Type":"application/json"};t&&(s["X-CSRF-Token"]=t),r&&(s.Cookie=r);let l=await fetch(i,{method:"POST",headers:s,credentials:"include",body:JSON.stringify(e)});if(!l.ok){let e=await l.json().catch(()=>({}));throw Error(e.message||e.detail||"เข้าสู่ระบบไม่สำเร็จ")}let a=await l.json();return{...a.user,token:a.token}}catch(e){throw Error(e.message||"เข้าสู่ระบบไม่สำเร็จ")}},logout:async(e,t,r)=>{try{let n=(0,o.b)("POST","/auth/logout"),i={"Content-Type":"application/json"};e&&(i.Authorization="Bearer ".concat(e)),t&&(i["X-CSRF-Token"]=t),r&&(i.Cookie=r),await fetch(n,{method:"POST",headers:i,credentials:"include"})}catch(e){console.error("Logout failed",e)}},getMe:async e=>{try{let t=(0,o.b)("GET",n.q.AUTH.ME),r=await fetch(t,{method:"GET",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"},credentials:"include",cache:"no-store"});if(!r.ok)throw Error("Unauthorized");return await r.json()}catch(e){throw e}},async getCsrfToken(){try{let e=await fetch("".concat(n.v).concat(n.q.AUTH.CSRF),{credentials:"include"});if(!e.ok)return"";return(await e.json()).csrfToken}catch(e){return console.error("Failed to fetch CSRF token",e),""}}}},84859:function(e,t,r){"use strict";r.d(t,{M:function(){return l},x:function(){return s}});let n="pos_offline_queue",o=()=>{let e=localStorage.getItem(n);return e?JSON.parse(e):[]},i=e=>{localStorage.setItem(n,JSON.stringify(e))},s={addToQueue:(e,t)=>{let r=o(),n={id:"offline-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),type:e,payload:t,timestamp:Date.now(),retryCount:0};return i([...r,n]),n},getQueue:()=>o(),removeFromQueue:e=>{i(o().filter(t=>t.id!==e))},incrementRetry:(e,t)=>{i(o().map(r=>r.id===e?{...r,retryCount:r.retryCount+1,lastError:t}:r))},clearQueue:()=>{localStorage.removeItem(n)},pruneExceeded:()=>{i(o().filter(e=>e.retryCount<=5))}},l={maxRetry:5,backoff:e=>Math.min(3e4,2e3*e)}},12609:function(e,t,r){"use strict";var n,o;r.d(t,{i:function(){return n}}),(o=n||(n={})).PENDING="pending",o.COMPLETED="completed",o.CANCELLED="cancelled"}},function(e){e.O(0,[5015,7717,7698,742,3211,7993,8651,2646,6207,7213,9021,2224,3248,1721,9,5496,3834,8640,6931,8056,1652,5713,9207,2971,2117,1744],function(){return e(e.s=25325)}),_N_E=e.O()}]);