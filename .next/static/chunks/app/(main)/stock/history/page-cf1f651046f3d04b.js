(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[961],{25325:function(e,t,r){Promise.resolve().then(r.bind(r,84823))},84823:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return P}});var n=r(57437),i=r(2265),o=r(34029),s=r(53743),l=r(48651),a=r(62297),d=r(84588),c=r(12609),f=r(57835),h=r(24675),x=r(14362),g=r(5447),p=r(19683),y=r(50742),u=r(80009),b=r(91652),j=r(85180),m=r(8900),v=r(39725),C=r(6520),k=r(26349),w=r(15883),S=r(49634),I=r(52539);let{Text:E,Title:z}=p.default,D={container:{paddingBottom:100,backgroundColor:"#f8f9fc",minHeight:"100vh"},header:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",padding:"20px 20px 60px 20px",position:"relative",overflow:"hidden"},headerDecoCircle1:{position:"absolute",top:-50,right:-50,width:150,height:150,borderRadius:"50%",background:"rgba(255,255,255,0.1)"},headerDecoCircle2:{position:"absolute",bottom:-30,left:-30,width:100,height:100,borderRadius:"50%",background:"rgba(255,255,255,0.08)"},headerContent:{position:"relative",zIndex:1,display:"flex",alignItems:"center",justifyContent:"space-between"},headerLeft:{display:"flex",alignItems:"center",gap:12},headerIconBox:{width:48,height:48,borderRadius:14,background:"rgba(255,255,255,0.2)",display:"flex",alignItems:"center",justifyContent:"center",backdropFilter:"blur(8px)"},statsCard:{margin:"-40px 16px 0 16px",padding:"16px",background:"white",borderRadius:20,boxShadow:"0 8px 24px rgba(0,0,0,0.08)",display:"flex",justifyContent:"space-around",position:"relative",zIndex:10},statItem:{textAlign:"center",flex:1},statNumber:{fontSize:24,fontWeight:700,display:"block"},statLabel:{fontSize:12,color:"#8c8c8c",marginTop:2},listContainer:{padding:"20px 16px 0 16px"},sectionTitle:{display:"flex",alignItems:"center",gap:8,marginBottom:16},orderCard:e=>({marginBottom:12,borderRadius:20,border:"none",boxShadow:"0 2px 8px rgba(0,0,0,0.04)",overflow:"hidden",transition:"all 0.3s ease",background:e===c.i.COMPLETED?"linear-gradient(to right, #f6ffed, white)":"linear-gradient(to right, #fff2f0, white)"}),orderCardInner:{padding:16,display:"flex",flexDirection:"column",gap:12},orderHeader:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},orderInfo:{display:"flex",alignItems:"center",gap:10},orderActions:{display:"flex",gap:8}},Z={[c.i.PENDING]:{color:"#faad14",bgColor:"linear-gradient(135deg, #fffbe6 0%, #fff1b8 100%)",borderColor:"#ffe58f",icon:(0,n.jsx)(n.Fragment,{}),label:"รอดำเนินการ",tagColor:"gold"},[c.i.COMPLETED]:{color:"#52c41a",bgColor:"linear-gradient(135deg, #f6ffed 0%, #d9f7be 100%)",borderColor:"#b7eb8f",icon:(0,n.jsx)(m.Z,{style:{color:"#52c41a"}}),label:"เสร็จสิ้น",tagColor:"success"},[c.i.CANCELLED]:{color:"#ff4d4f",bgColor:"linear-gradient(135deg, #fff2f0 0%, #ffccc7 100%)",borderColor:"#ffa39e",icon:(0,n.jsx)(v.Z,{style:{color:"#ff4d4f"}}),label:"ยกเลิก",tagColor:"error"}},_=()=>(0,n.jsx)("style",{children:"\n        .history-page-modal .ant-modal-content {\n            border-radius: 24px !important;\n            overflow: hidden;\n            padding: 0 !important;\n        }\n        \n        @keyframes fadeSlideIn {\n            from {\n                opacity: 0;\n                transform: translateY(12px);\n            }\n            to {\n                opacity: 1;\n                transform: translateY(0);\n            }\n        }\n        \n        .history-order-card {\n            animation: fadeSlideIn 0.4s ease both;\n        }\n        \n        .history-order-card:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 8px 24px rgba(0,0,0,0.1) !important;\n        }\n        \n        .history-order-card:active {\n            transform: scale(0.98);\n        }\n        \n        /* Custom scrollbar */\n        .history-page *::-webkit-scrollbar {\n            width: 6px;\n        }\n        .history-page *::-webkit-scrollbar-track {\n            background: transparent;\n        }\n        .history-page *::-webkit-scrollbar-thumb {\n            background: #d9d9d9;\n            border-radius: 3px;\n        }\n        .history-page *::-webkit-scrollbar-thumb:hover {\n            background: #bfbfbf;\n        }\n    "}),R=e=>{let{onRefresh:t,loading:r}=e;return(0,n.jsxs)("div",{style:D.header,children:[(0,n.jsx)("div",{style:D.headerDecoCircle1}),(0,n.jsx)("div",{style:D.headerDecoCircle2}),(0,n.jsxs)("div",{style:D.headerContent,children:[(0,n.jsxs)("div",{style:D.headerLeft,children:[(0,n.jsx)("div",{style:D.headerIconBox,children:(0,n.jsx)(d.Z,{style:{fontSize:24,color:"white"}})}),(0,n.jsxs)("div",{children:[(0,n.jsx)(E,{style:{color:"rgba(255,255,255,0.85)",fontSize:13,display:"block"},children:"ประวัติทั้งหมด"}),(0,n.jsx)(z,{level:4,style:{color:"white",margin:0,fontWeight:700,letterSpacing:"0.5px"},children:"รายการสั่งซื้อ"})]})]}),(0,n.jsx)(y.ZP,{type:"text",icon:(0,n.jsx)(d.Z,{style:{color:"white"}}),onClick:t,loading:r,style:{background:"rgba(255,255,255,0.2)",borderRadius:12,height:40,color:"white",fontWeight:600},children:"รีเฟรช"})]})]})},T=e=>{let{totalOrders:t,completedOrders:r,cancelledOrders:i}=e;return(0,n.jsxs)("div",{style:D.statsCard,children:[(0,n.jsxs)("div",{style:D.statItem,children:[(0,n.jsx)("span",{style:{...D.statNumber,color:"#667eea"},children:t}),(0,n.jsx)(E,{style:D.statLabel,children:"ทั้งหมด"})]}),(0,n.jsx)("div",{style:{width:1,background:"#f0f0f0"}}),(0,n.jsxs)("div",{style:D.statItem,children:[(0,n.jsx)("span",{style:{...D.statNumber,color:"#52c41a"},children:r}),(0,n.jsx)(E,{style:D.statLabel,children:"เสร็จสิ้น"})]}),(0,n.jsx)("div",{style:{width:1,background:"#f0f0f0"}}),(0,n.jsxs)("div",{style:D.statItem,children:[(0,n.jsx)("span",{style:{...D.statNumber,color:"#ff4d4f"},children:i}),(0,n.jsx)(E,{style:D.statLabel,children:"ยกเลิก"})]})]})},L=e=>{var t,r,i,o;let{order:s,index:l,onView:a,onDelete:d,isAdmin:f}=e,h=Z[s.status]||Z[c.i.PENDING],x=(null===(t=s.ordersItems)||void 0===t?void 0:t.length)||0,g=(null===(r=s.ordersItems)||void 0===r?void 0:r.filter(e=>{var t;return null===(t=e.ordersDetail)||void 0===t?void 0:t.is_purchased}).length)||0,p=(null===(i=s.ordersItems)||void 0===i?void 0:i.slice(0,3))||[],j=x-3;return(0,n.jsx)("div",{className:"history-order-card",style:{...D.orderCard(s.status),animationDelay:"".concat(.05*l,"s")},children:(0,n.jsxs)("div",{style:D.orderCardInner,children:[(0,n.jsxs)("div",{style:D.orderHeader,children:[(0,n.jsxs)("div",{style:D.orderInfo,children:[(0,n.jsx)("div",{style:{width:44,height:44,borderRadius:12,background:h.bgColor,border:"1px solid ".concat(h.borderColor),display:"flex",alignItems:"center",justifyContent:"center",fontSize:20},children:h.icon}),(0,n.jsxs)("div",{children:[(0,n.jsxs)(E,{strong:!0,style:{fontSize:15,color:"#1a1a2e",display:"block"},children:["#",s.id.substring(0,8).toUpperCase()]}),(0,n.jsx)(u.Z,{color:h.tagColor,style:{marginTop:4,borderRadius:10,fontWeight:600},children:h.label})]})]}),(0,n.jsxs)("div",{style:D.orderActions,children:[(0,n.jsx)(y.ZP,{type:"primary",size:"small",icon:(0,n.jsx)(C.Z,{}),onClick:()=>a(s),style:{borderRadius:10,background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",border:"none"},children:"ดู"}),f&&(0,n.jsx)(y.ZP,{danger:!0,size:"small",icon:(0,n.jsx)(k.Z,{}),onClick:()=>d(s),style:{borderRadius:10},children:"ลบ"})]})]}),(0,n.jsxs)("div",{style:{display:"flex",gap:16,padding:"12px 0",borderTop:"1px solid #f0f0f0",borderBottom:"1px solid #f0f0f0"},children:[(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:6},children:[(0,n.jsx)(w.Z,{style:{color:"#8c8c8c"}}),(0,n.jsx)(E,{type:"secondary",style:{fontSize:13},children:(null===(o=s.ordered_by)||void 0===o?void 0:o.username)||"Unknown"})]}),(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:6},children:[(0,n.jsx)(S.Z,{style:{color:"#8c8c8c"}}),(0,n.jsx)(E,{type:"secondary",style:{fontSize:13},children:new Date(s.create_date).toLocaleDateString("th-TH",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:6,marginBottom:10},children:[(0,n.jsx)(I.Z,{style:{color:"#667eea",fontSize:14}}),(0,n.jsx)(E,{style:{fontSize:13,color:"#666"},children:s.status===c.i.COMPLETED?"ซื้อแล้ว ".concat(g,"/").concat(x," รายการ"):"".concat(x," รายการ")})]}),(0,n.jsxs)("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[p.map(e=>{var t,r,i,o,s,l;return(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,padding:"6px 10px",background:"#f5f5f5",borderRadius:10},children:[(0,n.jsx)(b.Z,{src:(null===(t=e.ingredient)||void 0===t?void 0:t.img_url)||"https://placehold.co/32x32/f5f5f5/999999?text=\uD83D\uDCE6",size:28,shape:"square",style:{borderRadius:6}}),(0,n.jsxs)("div",{children:[(0,n.jsx)(E,{style:{fontSize:12,display:"block"},ellipsis:{tooltip:null===(r=e.ingredient)||void 0===r?void 0:r.display_name},children:null===(i=e.ingredient)||void 0===i?void 0:i.display_name}),(0,n.jsxs)(E,{type:"secondary",style:{fontSize:11},children:[(null===(o=e.ordersDetail)||void 0===o?void 0:o.is_purchased)?e.ordersDetail.actual_quantity:e.quantity_ordered," ",null===(l=e.ingredient)||void 0===l?void 0:null===(s=l.unit)||void 0===s?void 0:s.display_name]})]})]},e.id)}),j>0&&(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"6px 12px",background:"#e6f4ff",borderRadius:10,color:"#1890ff",fontWeight:600,fontSize:12},children:["+",j," อื่นๆ"]})]})]})]})})},N=()=>(0,n.jsx)(j.Z,{image:j.Z.PRESENTED_IMAGE_SIMPLE,description:(0,n.jsxs)("div",{style:{textAlign:"center"},children:[(0,n.jsx)(E,{type:"secondary",style:{fontSize:15},children:"ยังไม่มีประวัติการสั่งซื้อ"}),(0,n.jsx)("br",{}),(0,n.jsx)(E,{type:"secondary",style:{fontSize:13},children:"เมื่อมีการสั่งซื้อเสร็จสิ้นหรือยกเลิก จะแสดงที่นี่"})]}),style:{padding:"60px 20px",background:"white",borderRadius:20,margin:"0 16px"}});function P(){let[e,t]=(0,i.useState)([]),[r,p]=(0,i.useState)(!0),[y,u]=(0,i.useState)(null),{socket:b}=(0,h.s)(),{user:j}=(0,x.a)(),[m,v]=(0,i.useState)(1),[C,k]=(0,i.useState)(10),[w,S]=(0,i.useState)(0),[I,E]=(0,i.useState)("");(0,i.useEffect)(()=>{(async()=>{try{let e=await g.O.getCsrfToken();E(e)}catch(e){console.error("Failed to fetch CSRF token",e)}})()},[]);let z=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;try{p(!0);let n=await fetch("/api/stock/orders?status=completed,cancelled&page=".concat(e,"&limit=").concat(r),{cache:"no-store"});if(!n.ok)throw Error("Failed to fetch orders");let i=await n.json();Array.isArray(i)?(t(i),S(i.length)):(t(i.data),S(i.total))}catch(e){console.error("Failed to fetch orders"),o.ZP.error("ไม่สามารถโหลดประวัติออเดอร์ได้")}finally{p(!1)}},Z=e=>{s.Z.confirm({title:"ยืนยันการลบ",content:"คุณต้องการลบประวัติออเดอร์ #".concat(e.id.substring(0,8).toUpperCase()," หรือไม่? ข้อมูลที่เกี่ยวข้องทั้งหมดจะถูกลบด้วย"),okText:"ลบ",okType:"danger",cancelText:"ยกเลิก",centered:!0,onOk:async()=>{try{if(!(await fetch("/api/stock/orders/".concat(e.id),{method:"DELETE",headers:{"X-CSRF-Token":I}})).ok)throw Error("Failed to delete order");o.ZP.success("ลบประวัติออเดอร์สำเร็จ"),z(m,C)}catch(e){o.ZP.error("ลบประวัติออเดอร์ล้มเหลว")}}})};(0,i.useEffect)(()=>{z(m,C)},[m,C]),(0,i.useEffect)(()=>{if(b)return b.on("orders_updated",()=>{z(m,C)}),()=>{b.off("orders_updated")}},[b,m,C]);let P=e.filter(e=>e.status===c.i.COMPLETED),A=e.filter(e=>e.status===c.i.CANCELLED),O=(null==j?void 0:j.role)==="Admin";return r&&0===e.length?(0,n.jsx)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",minHeight:"100vh",flexDirection:"column",gap:16},children:(0,n.jsx)(l.Z,{size:"large"})}):(0,n.jsxs)("div",{className:"history-page",style:D.container,children:[(0,n.jsx)(_,{}),(0,n.jsx)(R,{onRefresh:()=>z(m,C),loading:r}),(0,n.jsx)(T,{totalOrders:w,completedOrders:P.length,cancelledOrders:A.length}),(0,n.jsx)("div",{style:D.listContainer,children:e.length>0?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{style:D.sectionTitle,children:[(0,n.jsx)(d.Z,{style:{fontSize:18,color:"#667eea"}}),(0,n.jsx)("span",{style:{fontSize:16,fontWeight:600,color:"#1a1a2e"},children:"ประวัติทั้งหมด"}),(0,n.jsxs)("div",{style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",padding:"4px 12px",borderRadius:20,fontSize:12,fontWeight:600},children:[w," รายการ"]})]}),e.map((e,t)=>(0,n.jsx)(L,{order:e,index:t,onView:u,onDelete:Z,isAdmin:O},e.id)),(0,n.jsx)("div",{style:{display:"flex",justifyContent:"center",marginTop:24},children:(0,n.jsx)(a.Z,{current:m,pageSize:C,total:w,onChange:(e,t)=>{v(e),k(t)},showSizeChanger:!0,showTotal:e=>"ทั้งหมด ".concat(e," รายการ")})})]}):(0,n.jsx)(N,{})}),(0,n.jsx)(f.Z,{open:!!y,order:y,onClose:()=>u(null)})]})}}},function(e){e.O(0,[8024,4736,8592,1744],function(){return e(e.s=25325)}),_N_E=e.O()}]);