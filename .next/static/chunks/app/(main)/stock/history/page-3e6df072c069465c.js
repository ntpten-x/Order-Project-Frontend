(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[961],{25325:function(e,t,r){Promise.resolve().then(r.bind(r,84823))},84823:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return F}});var s=r(57437),o=r(2265),i=r(34029),n=r(53743),l=r(50742),d=r(48651),a=r(8056),c=r(29827),f=r(11713),y=r(21770),u=r(84588),x=r(12609),p=r(57835),h=r(24675),g=r(14362),b=r(5447),j=r(25193),m=r(20148),k=r(37410),v=r(2786),C=r(36799),w=r(12028),Z=r(39486),H=r(80009),E=r(91652),I=r(8900),O=r(39725),S=r(6520),D=r(26349),T=r(15883),z=r(49634),_=r(52539);let{Text:L,Title:N}=Z.default,P={container:{paddingBottom:100,backgroundColor:"#f8f9fc",minHeight:"100vh"},statsCard:{margin:"-40px 16px 0 16px",padding:"16px",background:"white",borderRadius:20,boxShadow:"0 8px 24px rgba(0,0,0,0.08)",display:"flex",justifyContent:"space-around",position:"relative",zIndex:10},statItem:{textAlign:"center",flex:1},statNumber:{fontSize:24,fontWeight:700,display:"block"},statLabel:{fontSize:12,color:"#8c8c8c",marginTop:2},listContainer:{padding:"20px 16px 0 16px"},orderCard:e=>({marginBottom:12,borderRadius:20,border:"none",boxShadow:"0 2px 8px rgba(0,0,0,0.04)",overflow:"hidden",transition:"all 0.3s ease",background:e===x.i.COMPLETED?"linear-gradient(to right, #f6ffed, white)":"linear-gradient(to right, #fff2f0, white)"}),orderCardInner:{padding:16,display:"flex",flexDirection:"column",gap:12},orderHeader:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},orderInfo:{display:"flex",alignItems:"center",gap:10},orderActions:{display:"flex",gap:8}},R={[x.i.PENDING]:{color:"#faad14",bgColor:"linear-gradient(135deg, #fffbe6 0%, #fff1b8 100%)",borderColor:"#ffe58f",icon:(0,s.jsx)(s.Fragment,{}),label:"รอดำเนินการ",tagColor:"gold"},[x.i.COMPLETED]:{color:"#52c41a",bgColor:"linear-gradient(135deg, #f6ffed 0%, #d9f7be 100%)",borderColor:"#b7eb8f",icon:(0,s.jsx)(I.Z,{style:{color:"#52c41a"}}),label:"เสร็จสิ้น",tagColor:"success"},[x.i.CANCELLED]:{color:"#ff4d4f",bgColor:"linear-gradient(135deg, #fff2f0 0%, #ffccc7 100%)",borderColor:"#ffa39e",icon:(0,s.jsx)(O.Z,{style:{color:"#ff4d4f"}}),label:"ยกเลิก",tagColor:"error"}},q=()=>(0,s.jsx)("style",{children:"\n        .history-page-modal .ant-modal-content {\n            border-radius: 24px !important;\n            overflow: hidden;\n            padding: 0 !important;\n        }\n        \n        @keyframes fadeSlideIn {\n            from {\n                opacity: 0;\n                transform: translateY(12px);\n            }\n            to {\n                opacity: 1;\n                transform: translateY(0);\n            }\n        }\n        \n        .history-order-card {\n            animation: fadeSlideIn 0.4s ease both;\n        }\n        \n        .history-order-card:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 8px 24px rgba(0,0,0,0.1) !important;\n        }\n        \n        .history-order-card:active {\n            transform: scale(0.98);\n        }\n        \n        /* Custom scrollbar */\n        .history-page *::-webkit-scrollbar {\n            width: 6px;\n        }\n        .history-page *::-webkit-scrollbar-track {\n            background: transparent;\n        }\n        .history-page *::-webkit-scrollbar-thumb {\n            background: #d9d9d9;\n            border-radius: 3px;\n        }\n        .history-page *::-webkit-scrollbar-thumb:hover {\n            background: #bfbfbf;\n        }\n    "}),A=e=>{let{totalOrders:t,completedOrders:r,cancelledOrders:o}=e;return(0,s.jsxs)("div",{style:P.statsCard,children:[(0,s.jsxs)("div",{style:P.statItem,children:[(0,s.jsx)("span",{style:{...P.statNumber,color:"#667eea"},children:t}),(0,s.jsx)(L,{style:P.statLabel,children:"ทั้งหมด"})]}),(0,s.jsx)("div",{style:{width:1,background:"#f0f0f0"}}),(0,s.jsxs)("div",{style:P.statItem,children:[(0,s.jsx)("span",{style:{...P.statNumber,color:"#52c41a"},children:r}),(0,s.jsx)(L,{style:P.statLabel,children:"เสร็จสิ้น"})]}),(0,s.jsx)("div",{style:{width:1,background:"#f0f0f0"}}),(0,s.jsxs)("div",{style:P.statItem,children:[(0,s.jsx)("span",{style:{...P.statNumber,color:"#ff4d4f"},children:o}),(0,s.jsx)(L,{style:P.statLabel,children:"ยกเลิก"})]})]})},U=e=>{var t,r,o,i,n;let{order:d,index:a,onView:c,onDelete:f,isAdmin:y}=e,u=R[d.status]||R[x.i.PENDING],p=(null===(t=d.ordersItems)||void 0===t?void 0:t.length)||0,h=(null===(r=d.ordersItems)||void 0===r?void 0:r.filter(e=>{var t;return null===(t=e.ordersDetail)||void 0===t?void 0:t.is_purchased}).length)||0,g=(null===(o=d.ordersItems)||void 0===o?void 0:o.slice(0,3))||[],b=p-3;return(0,s.jsx)("div",{className:"history-order-card",style:{...P.orderCard(d.status),animationDelay:"".concat(.05*a,"s")},children:(0,s.jsxs)("div",{style:P.orderCardInner,children:[(0,s.jsxs)("div",{style:P.orderHeader,children:[(0,s.jsxs)("div",{style:P.orderInfo,children:[(0,s.jsx)("div",{style:{width:44,height:44,borderRadius:12,background:u.bgColor,border:"1px solid ".concat(u.borderColor),display:"flex",alignItems:"center",justifyContent:"center",fontSize:20},children:u.icon}),(0,s.jsxs)("div",{children:[(0,s.jsxs)(L,{strong:!0,style:{fontSize:15,color:"#1a1a2e",display:"block"},children:["#",d.id.substring(0,8).toUpperCase()]}),(0,s.jsx)(H.Z,{color:u.tagColor,style:{marginTop:4,borderRadius:10,fontWeight:600},children:u.label})]})]}),(0,s.jsxs)("div",{style:P.orderActions,children:[(0,s.jsx)(l.ZP,{type:"primary",size:"small",icon:(0,s.jsx)(S.Z,{}),onClick:()=>c(d),style:{borderRadius:10,background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",border:"none"},children:"ดู"}),y&&(0,s.jsx)(l.ZP,{danger:!0,size:"small",icon:(0,s.jsx)(D.Z,{}),onClick:()=>f(d),style:{borderRadius:10},children:"ลบ"})]})]}),(0,s.jsxs)("div",{style:{display:"flex",gap:16,padding:"12px 0",borderTop:"1px solid #f0f0f0",borderBottom:"1px solid #f0f0f0"},children:[(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:6},children:[(0,s.jsx)(T.Z,{style:{color:"#8c8c8c"}}),(0,s.jsx)(L,{type:"secondary",style:{fontSize:13},children:(null===(i=d.ordered_by)||void 0===i?void 0:i.name)||(null===(n=d.ordered_by)||void 0===n?void 0:n.username)||"Unknown"})]}),(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:6},children:[(0,s.jsx)(z.Z,{style:{color:"#8c8c8c"}}),(0,s.jsx)(L,{type:"secondary",style:{fontSize:13},children:new Date(d.create_date).toLocaleDateString("th-TH",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:6,marginBottom:10},children:[(0,s.jsx)(_.Z,{style:{color:"#667eea",fontSize:14}}),(0,s.jsx)(L,{style:{fontSize:13,color:"#666"},children:d.status===x.i.COMPLETED?"ซื้อแล้ว ".concat(h,"/").concat(p," รายการ"):"".concat(p," รายการ")})]}),(0,s.jsxs)("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[g.map(e=>{var t,r,o,i,n,l;return(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,padding:"6px 10px",background:"#f5f5f5",borderRadius:10},children:[(0,s.jsx)(E.Z,{src:(null===(t=e.ingredient)||void 0===t?void 0:t.img_url)||"https://placehold.co/32x32/f5f5f5/999999?text=\uD83D\uDCE6",size:28,shape:"square",style:{borderRadius:6}}),(0,s.jsxs)("div",{children:[(0,s.jsx)(L,{style:{fontSize:12,display:"block"},ellipsis:{tooltip:null===(r=e.ingredient)||void 0===r?void 0:r.display_name},children:null===(o=e.ingredient)||void 0===o?void 0:o.display_name}),(0,s.jsxs)(L,{type:"secondary",style:{fontSize:11},children:[(null===(i=e.ordersDetail)||void 0===i?void 0:i.is_purchased)?e.ordersDetail.actual_quantity:e.quantity_ordered," ",null===(l=e.ingredient)||void 0===l?void 0:null===(n=l.unit)||void 0===n?void 0:n.display_name]})]})]},e.id)}),b>0&&(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"6px 12px",background:"#e6f4ff",borderRadius:10,color:"#1890ff",fontWeight:600,fontSize:12},children:["+",b," อื่นๆ"]})]})]})]})})};function F(){var e,t;let[r,Z]=(0,o.useState)(null),{socket:H}=(0,h.s)(),{user:E}=(0,g.a)(),I=(0,c.NL)(),[O,S]=(0,o.useState)(1),[D,T]=(0,o.useState)(10),{data:z=""}=(0,f.a)({queryKey:["csrfToken"],queryFn:()=>b.O.getCsrfToken(),staleTime:6e5}),{data:_,isLoading:L,isFetching:N}=(0,f.a)({queryKey:["stockHistory",O,D],queryFn:async()=>{let e=await fetch("/api/stock/orders?status=completed,cancelled&page=".concat(O,"&limit=").concat(D),{cache:"no-store"});if(!e.ok)throw Error((0,C.t)("stockHistory.fetch.error"));let t=await e.json();return Array.isArray(t)?{data:t,total:t.length}:{data:t.data,total:t.total}},placeholderData:e=>e,staleTime:6e4}),R=null!==(e=null==_?void 0:_.data)&&void 0!==e?e:[],F=null!==(t=null==_?void 0:_.total)&&void 0!==t?t:0,K=(0,y.D)({mutationFn:async e=>{let t=z||await b.O.getCsrfToken();if(!(await fetch("/api/stock/orders/".concat(e),{method:"DELETE",headers:{"X-CSRF-Token":t||""}})).ok)throw Error((0,C.t)("stockHistory.delete.error"));return e},onSuccess:()=>{I.invalidateQueries({queryKey:["stockHistory"]}),i.ZP.success((0,C.t)("stockHistory.delete.success"))},onError:()=>{i.ZP.error((0,C.t)("stockHistory.delete.error"))}}),W=e=>{n.Z.confirm({title:(0,C.t)("stockHistory.delete.title"),content:(0,C.t)("stockHistory.delete.content",{code:e.id.substring(0,8).toUpperCase()}),okText:(0,C.t)("stockHistory.delete.ok"),okType:"danger",cancelText:(0,C.t)("stockHistory.delete.cancel"),centered:!0,onOk:async()=>{await K.mutateAsync(e.id)}})};(0,o.useEffect)(()=>{if(!H)return;let e=()=>{I.invalidateQueries({queryKey:["stockHistory"]})};return H.on(w.b.stockOrders.create,e),H.on(w.b.stockOrders.update,e),H.on(w.b.stockOrders.status,e),H.on(w.b.stockOrders.delete,e),H.on(w.b.stockOrders.detailUpdate,e),H.on(w.g.stockOrdersUpdated,e),()=>{H.off(w.b.stockOrders.create,e),H.off(w.b.stockOrders.update,e),H.off(w.b.stockOrders.status,e),H.off(w.b.stockOrders.delete,e),H.off(w.b.stockOrders.detailUpdate,e),H.off(w.g.stockOrdersUpdated,e)}},[H,I]);let B=R.filter(e=>e.status===x.i.COMPLETED),M=R.filter(e=>e.status===x.i.CANCELLED),Q=(null==E?void 0:E.role)==="Admin";return L&&0===R.length?(0,s.jsxs)("div",{style:{minHeight:"100vh",background:P.container.backgroundColor},children:[(0,s.jsx)(q,{}),(0,s.jsx)(m.Z,{title:(0,C.t)("stockHistory.title"),subtitle:(0,C.t)("stockHistory.subtitle"),icon:(0,s.jsx)(u.Z,{}),actions:(0,s.jsx)(l.ZP,{onClick:()=>I.invalidateQueries({queryKey:["stockHistory"]}),loading:N,children:(0,C.t)("stockHistory.refresh")})}),(0,s.jsx)(j.Z,{children:(0,s.jsx)(k.Z,{children:(0,s.jsx)("div",{style:{display:"flex",justifyContent:"center",padding:"60px 0"},children:(0,s.jsx)(d.Z,{size:"large"})})})})]}):(0,s.jsxs)("div",{className:"history-page",style:P.container,children:[(0,s.jsx)(q,{}),(0,s.jsx)(m.Z,{title:(0,C.t)("stockHistory.title"),subtitle:(0,C.t)("stockHistory.subtitle"),icon:(0,s.jsx)(u.Z,{}),actions:(0,s.jsx)(l.ZP,{onClick:()=>I.invalidateQueries({queryKey:["stockHistory"]}),loading:N,children:(0,C.t)("stockHistory.refresh")})}),(0,s.jsxs)(j.Z,{children:[(0,s.jsx)(k.Z,{children:(0,s.jsx)(A,{totalOrders:F,completedOrders:B.length,cancelledOrders:M.length})}),(0,s.jsx)(k.Z,{title:(0,C.t)("stockHistory.sectionAll"),extra:(0,s.jsx)("span",{style:{fontWeight:600},children:(0,C.t)("stockHistory.count",{total:F})}),children:(0,s.jsx)("div",{style:P.listContainer,children:R.length>0?(0,s.jsxs)(s.Fragment,{children:[R.map((e,t)=>(0,s.jsx)(U,{order:e,index:t,onView:Z,onDelete:W,isAdmin:Q},e.id)),(0,s.jsx)("div",{style:{display:"flex",justifyContent:"center",marginTop:24},children:(0,s.jsx)(a.Z,{current:O,pageSize:D,total:F,onChange:(e,t)=>{S(e),T(t)},showSizeChanger:!0,showTotal:e=>(0,C.t)("stockHistory.paginationTotal",{total:e})})})]}):(0,s.jsx)(v.Z,{title:(0,C.t)("stockHistory.empty.title"),description:(0,C.t)("stockHistory.empty.desc")})})}),(0,s.jsx)(p.Z,{open:!!r,order:r,onClose:()=>Z(null)})]})]})}},2786:function(e,t,r){"use strict";r.d(t,{Z:function(){return d}});var s=r(57437);r(2265);var o=r(96931),i=r(85180),n=r(39486),l=r(87530);function d(e){let{title:t="ไม่มีข้อมูล",description:r,action:d,image:a}=e;return(0,s.jsx)(o.Z,{size:"small",variant:"outlined",style:{borderRadius:l.H.cardRadiusLG},bodyStyle:{padding:20},children:(0,s.jsx)(i.Z,{image:a,description:(0,s.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[(0,s.jsx)(n.default.Text,{strong:!0,children:t}),r?(0,s.jsx)(n.default.Text,{type:"secondary",children:r}):null]}),children:d})})}}},function(e){e.O(0,[253,1522,3418,742,9486,4252,3916,8651,6931,4159,3831,2224,3248,2401,9,9845,3834,9763,1713,5713,8056,1652,7931,9385,2284,2971,2117,1744],function(){return e(e.s=25325)}),_N_E=e.O()}]);