(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3291],{84638:function(e,t,n){Promise.resolve().then(n.bind(n,61541))},61541:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return O}});var i=n(57437),s=n(2265),r=n(19683),a=n(34029),l=n(53743),d=n(48651),o=n(24783),c=n(50742),f=n(41169),x=n(89245),p=n(96473),g=n(99376),h=n(3369),u=n(26972),y=n(24675),m=n(14362),b=n(91652),j=n(80009),k=n(8900),v=n(39725),w=n(13377),Z=n(26349);let{Text:C,Title:S}=r.default,_={container:{paddingBottom:100,backgroundColor:"#f8f9fc",minHeight:"100vh"},statsCard:{margin:"-40px 16px 0 16px",padding:"16px",background:"white",borderRadius:20,boxShadow:"0 8px 24px rgba(0,0,0,0.08)",display:"flex",justifyContent:"space-around",position:"relative",zIndex:10},statItem:{textAlign:"center",flex:1},statNumber:{fontSize:24,fontWeight:700,display:"block"},statLabel:{fontSize:12,color:"#8c8c8c",marginTop:2},listContainer:{padding:"20px 16px 0 16px"},ingredientCard:e=>({marginBottom:12,borderRadius:20,border:"none",boxShadow:"0 2px 8px rgba(0,0,0,0.04)",overflow:"hidden",transition:"all 0.3s ease",background:e?"white":"linear-gradient(to right, #fafafa, white)",opacity:e?1:.7}),ingredientCardInner:{padding:16,display:"flex",alignItems:"center",gap:14}},I=()=>(0,i.jsx)("style",{children:"\n        @keyframes fadeSlideIn {\n            from {\n                opacity: 0;\n                transform: translateY(12px);\n            }\n            to {\n                opacity: 1;\n                transform: translateY(0);\n            }\n        }\n        \n        .ingredient-card {\n            animation: fadeSlideIn 0.4s ease both;\n        }\n        \n        .ingredient-card:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 8px 24px rgba(0,0,0,0.1) !important;\n        }\n        \n        .ingredient-card:active {\n            transform: scale(0.98);\n        }\n        \n        /* Custom scrollbar */\n        .ingredients-page *::-webkit-scrollbar {\n            width: 6px;\n        }\n        .ingredients-page *::-webkit-scrollbar-track {\n            background: transparent;\n        }\n        .ingredients-page *::-webkit-scrollbar-thumb {\n            background: #d9d9d9;\n            border-radius: 3px;\n        }\n        .ingredients-page *::-webkit-scrollbar-thumb:hover {\n            background: #bfbfbf;\n        }\n    "}),z=e=>{let{totalIngredients:t,activeIngredients:n,inactiveIngredients:s}=e;return(0,i.jsxs)("div",{style:_.statsCard,children:[(0,i.jsxs)("div",{style:_.statItem,children:[(0,i.jsx)("span",{style:{..._.statNumber,color:"#1890ff"},children:t}),(0,i.jsx)(C,{style:_.statLabel,children:"ทั้งหมด"})]}),(0,i.jsx)("div",{style:{width:1,background:"#f0f0f0"}}),(0,i.jsxs)("div",{style:_.statItem,children:[(0,i.jsx)("span",{style:{..._.statNumber,color:"#52c41a"},children:n}),(0,i.jsx)(C,{style:_.statLabel,children:"ใช้งาน"})]}),(0,i.jsx)("div",{style:{width:1,background:"#f0f0f0"}}),(0,i.jsxs)("div",{style:_.statItem,children:[(0,i.jsx)("span",{style:{..._.statNumber,color:"#ff4d4f"},children:s}),(0,i.jsx)(C,{style:_.statLabel,children:"ไม่ใช้งาน"})]})]})},E=e=>{var t;let{ingredient:n,index:s,onEdit:r,onDelete:a}=e;return(0,i.jsx)("div",{className:"ingredient-card",style:{..._.ingredientCard(n.is_active),animationDelay:"".concat(.03*s,"s")},children:(0,i.jsxs)("div",{style:_.ingredientCardInner,children:[(0,i.jsx)(b.Z,{src:n.img_url||"https://placehold.co/64x64/f5f5f5/999999?text=\uD83D\uDCE6",size:64,shape:"square",style:{borderRadius:14,border:"2px solid #f0f0f0",boxShadow:"0 4px 12px rgba(0,0,0,0.06)",flexShrink:0}}),(0,i.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4},children:[(0,i.jsx)(C,{strong:!0,style:{fontSize:16,color:"#1a1a2e"},ellipsis:{tooltip:n.display_name},children:n.display_name}),n.is_active?(0,i.jsx)(k.Z,{style:{color:"#52c41a",fontSize:14}}):(0,i.jsx)(v.Z,{style:{color:"#ff4d4f",fontSize:14}})]}),(0,i.jsx)(C,{type:"secondary",style:{fontSize:13,display:"block",marginBottom:6},ellipsis:{tooltip:n.ingredient_name},children:n.ingredient_name}),(0,i.jsxs)("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:[(0,i.jsx)(j.Z,{color:"blue",style:{borderRadius:8,margin:0,fontSize:11},children:(null===(t=n.unit)||void 0===t?void 0:t.display_name)||"-"}),n.description&&(0,i.jsx)(j.Z,{style:{borderRadius:8,margin:0,fontSize:11,background:"#f5f5f5",border:"none",color:"#666"},children:n.description.length>20?n.description.substring(0,20)+"...":n.description})]})]}),(0,i.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,i.jsx)(c.ZP,{type:"text",icon:(0,i.jsx)(w.Z,{}),onClick:e=>{e.stopPropagation(),r(n)},style:{borderRadius:10,color:"#1890ff",background:"#e6f7ff"}}),(0,i.jsx)(c.ZP,{type:"text",danger:!0,icon:(0,i.jsx)(Z.Z,{}),onClick:e=>{e.stopPropagation(),a(n)},style:{borderRadius:10,background:"#fff2f0"}})]})]})})};var T=n(5447),P=n(25193),N=n(37410),R=n(27623),D=n(20148),L=n(2786);let{Text:B}=r.default;function O(){let e=(0,g.useRouter)(),{user:t,loading:n}=(0,m.a)(),[r,b]=(0,s.useState)([]),{execute:j}=(0,u.J)(),{showLoading:k,hideLoading:v}=(0,h.x)(),{socket:w}=(0,y.s)(),[Z,C]=(0,s.useState)(""),[S,O]=(0,s.useState)(null);(0,s.useEffect)(()=>{(async()=>{C(await T.O.getCsrfToken())})()},[]);let W=(0,s.useCallback)(async()=>{j(async()=>{let e=await fetch("/api/stock/ingredients");if(!e.ok){let t=await e.json().catch(()=>({}));throw Error(t.error||t.message||"ไม่สามารถดึงข้อมูลวัตถุดิบได้")}b(await e.json())},"กำลังโหลดข้อมูลวัตถุดิบ...")},[j]);(0,s.useEffect)(()=>{n||(t?"Admin"!==t.role?(O(!1),a.ZP.error("คุณไม่มีสิทธิ์เข้าถึงหน้านี้"),setTimeout(()=>{e.replace("/stock/items")},1e3)):(O(!0),W()):(O(!1),setTimeout(()=>{e.replace("/login")},1e3)))},[t,n,e,W]),(0,s.useEffect)(()=>{if(w)return w.on("ingredients:create",e=>{b(t=>[...t,e])}),w.on("ingredients:update",e=>{b(t=>t.map(t=>t.id===e.id?e:t))}),w.on("ingredients:delete",e=>{let{id:t}=e;b(e=>e.filter(e=>e.id!==t))}),()=>{w.off("ingredients:create"),w.off("ingredients:update"),w.off("ingredients:delete")}},[w]);let Y=()=>{k(),e.push("/stock/ingredients/manage/add"),setTimeout(()=>v(),1e3)},A=t=>{k(),e.push("/stock/ingredients/manage/edit/".concat(t.id)),setTimeout(()=>v(),1e3)},q=e=>{l.Z.confirm({title:"ยืนยันการลบวัตถุดิบ",content:'คุณต้องการลบวัตถุดิบ "'.concat(e.display_name,'" หรือไม่?'),okText:"ลบ",okType:"danger",cancelText:"ยกเลิก",centered:!0,onOk:async()=>{await j(async()=>{if(!(await fetch("/api/stock/ingredients/delete/".concat(e.id),{method:"DELETE",headers:{"X-CSRF-Token":Z}})).ok)throw Error("ไม่สามารถลบวัตถุดิบได้");a.ZP.success('ลบวัตถุดิบ "'.concat(e.display_name,'" สำเร็จ'))},"กำลังลบวัตถุดิบ...")}})};if(n||null===S)return(0,i.jsxs)("div",{style:{display:"flex",height:"100vh",justifyContent:"center",alignItems:"center",flexDirection:"column",gap:16},children:[(0,i.jsx)(d.Z,{size:"large"}),(0,i.jsx)(B,{type:"secondary",children:"กำลังตรวจสอบสิทธิ์การใช้งาน..."})]});if(!1===S)return(0,i.jsxs)("div",{style:{display:"flex",height:"100vh",justifyContent:"center",alignItems:"center",flexDirection:"column",gap:16},children:[(0,i.jsx)(d.Z,{size:"large"}),(0,i.jsx)(B,{type:"danger",children:"คุณไม่มีสิทธิ์เข้าถึงหน้านี้ กำลังพากลับหน้าแรก..."})]});let F=r.filter(e=>e.is_active),H=r.filter(e=>!e.is_active);return(0,i.jsxs)("div",{className:"ingredients-page",style:_.container,children:[(0,i.jsx)(I,{}),(0,i.jsx)(D.Z,{title:"วัตถุดิบ",subtitle:"".concat(r.length," รายการ"),icon:(0,i.jsx)(f.Z,{}),actions:(0,i.jsxs)(o.Z,{size:8,wrap:!0,children:[(0,i.jsx)(c.ZP,{icon:(0,i.jsx)(x.Z,{}),onClick:W,children:"รีเฟรช"}),(0,i.jsx)(c.ZP,{type:"primary",icon:(0,i.jsx)(p.Z,{}),onClick:Y,children:"เพิ่มวัตถุดิบ"})]})}),(0,i.jsx)(P.Z,{children:(0,i.jsxs)(R.Z,{children:[(0,i.jsx)(z,{totalIngredients:r.length,activeIngredients:F.length,inactiveIngredients:H.length}),(0,i.jsx)(N.Z,{title:"รายการวัตถุดิบ",extra:(0,i.jsx)("span",{style:{fontWeight:600},children:r.length}),children:r.length>0?(0,i.jsx)("div",{style:_.listContainer,children:r.map((e,t)=>(0,i.jsx)(E,{ingredient:e,index:t,onEdit:A,onDelete:q},e.id))}):(0,i.jsx)(L.Z,{title:"ยังไม่มีวัตถุดิบ",description:"เริ่มต้นด้วยการเพิ่มวัตถุดิบแรกของคุณ",action:(0,i.jsx)(c.ZP,{type:"primary",icon:(0,i.jsx)(p.Z,{}),onClick:Y,children:"เพิ่มวัตถุดิบ"})})})]})})]})}}},function(e){e.O(0,[8024,4736,8592,1744],function(){return e(e.s=84638)}),_N_E=e.O()}]);