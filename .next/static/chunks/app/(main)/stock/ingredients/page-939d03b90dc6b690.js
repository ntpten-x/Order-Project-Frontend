(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3291],{84638:function(e,t,n){Promise.resolve().then(n.bind(n,61541))},61541:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return J}});var i=n(57437),r=n(2265),s=n(39486),a=n(34029),l=n(53743),o=n(48651),d=n(24783),c=n(50742),f=n(41169),g=n(89245),u=n(96473),p=n(99376),x=n(3369),h=n(26972),y=n(24675),m=n(14362),b=n(67697),k=n(12028),j=n(91652),v=n(80009),w=n(8900),Z=n(39725),C=n(13377),E=n(26349),S=n(36799);let{Text:I,Title:T}=s.default,_={container:{paddingBottom:100,backgroundColor:"#f8f9fc",minHeight:"100vh"},statsCard:{margin:"-40px 16px 0 16px",padding:"16px",background:"white",borderRadius:20,boxShadow:"0 8px 24px rgba(0,0,0,0.08)",display:"flex",justifyContent:"space-around",position:"relative",zIndex:10},statItem:{textAlign:"center",flex:1},statNumber:{fontSize:24,fontWeight:700,display:"block"},statLabel:{fontSize:12,color:"#8c8c8c",marginTop:2},listContainer:{padding:"20px 16px 0 16px"},ingredientCard:e=>({marginBottom:12,borderRadius:20,border:"none",boxShadow:"0 2px 8px rgba(0,0,0,0.04)",overflow:"hidden",transition:"all 0.3s ease",background:e?"white":"linear-gradient(to right, #fafafa, white)",opacity:e?1:.7}),ingredientCardInner:{padding:16,display:"flex",alignItems:"center",gap:14}},z=()=>(0,i.jsx)("style",{children:"\n        @keyframes fadeSlideIn {\n            from {\n                opacity: 0;\n                transform: translateY(12px);\n            }\n            to {\n                opacity: 1;\n                transform: translateY(0);\n            }\n        }\n        \n        .ingredient-card {\n            animation: fadeSlideIn 0.4s ease both;\n        }\n        \n        .ingredient-card:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 8px 24px rgba(0,0,0,0.1) !important;\n        }\n        \n        .ingredient-card:active {\n            transform: scale(0.98);\n        }\n        \n        /* Custom scrollbar */\n        .ingredients-page *::-webkit-scrollbar {\n            width: 6px;\n        }\n        .ingredients-page *::-webkit-scrollbar-track {\n            background: transparent;\n        }\n        .ingredients-page *::-webkit-scrollbar-thumb {\n            background: #d9d9d9;\n            border-radius: 3px;\n        }\n        .ingredients-page *::-webkit-scrollbar-thumb:hover {\n            background: #bfbfbf;\n        }\n    "}),P=e=>{let{totalIngredients:t,activeIngredients:n,inactiveIngredients:r}=e;return(0,i.jsxs)("div",{style:_.statsCard,children:[(0,i.jsxs)("div",{style:_.statItem,children:[(0,i.jsx)("span",{style:{..._.statNumber,color:"#1890ff"},children:t}),(0,i.jsx)(I,{style:_.statLabel,children:(0,S.t)("stock.ingredients.stats.total")})]}),(0,i.jsx)("div",{style:{width:1,background:"#f0f0f0"}}),(0,i.jsxs)("div",{style:_.statItem,children:[(0,i.jsx)("span",{style:{..._.statNumber,color:"#52c41a"},children:n}),(0,i.jsx)(I,{style:_.statLabel,children:(0,S.t)("stock.ingredients.stats.active")})]}),(0,i.jsx)("div",{style:{width:1,background:"#f0f0f0"}}),(0,i.jsxs)("div",{style:_.statItem,children:[(0,i.jsx)("span",{style:{..._.statNumber,color:"#ff4d4f"},children:r}),(0,i.jsx)(I,{style:_.statLabel,children:(0,S.t)("stock.ingredients.stats.inactive")})]})]})},D=e=>{var t;let{ingredient:n,index:r,onEdit:s,onDelete:a}=e;return(0,i.jsx)("div",{className:"ingredient-card",style:{..._.ingredientCard(n.is_active),animationDelay:"".concat(.03*r,"s")},children:(0,i.jsxs)("div",{style:_.ingredientCardInner,children:[(0,i.jsx)(j.Z,{src:n.img_url||"https://placehold.co/64x64/f5f5f5/999999?text=\uD83D\uDCE6",size:64,shape:"square",style:{borderRadius:14,border:"2px solid #f0f0f0",boxShadow:"0 4px 12px rgba(0,0,0,0.06)",flexShrink:0}}),(0,i.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4},children:[(0,i.jsx)(I,{strong:!0,style:{fontSize:16,color:"#1a1a2e"},ellipsis:{tooltip:n.display_name},children:n.display_name}),n.is_active?(0,i.jsx)(w.Z,{style:{color:"#52c41a",fontSize:14}}):(0,i.jsx)(Z.Z,{style:{color:"#ff4d4f",fontSize:14}})]}),(0,i.jsx)(I,{type:"secondary",style:{fontSize:13,display:"block",marginBottom:6},ellipsis:{tooltip:n.ingredient_name},children:n.ingredient_name}),(0,i.jsxs)("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:[(0,i.jsx)(v.Z,{color:"blue",style:{borderRadius:8,margin:0,fontSize:11},children:(null===(t=n.unit)||void 0===t?void 0:t.display_name)||"-"}),n.description&&(0,i.jsx)(v.Z,{style:{borderRadius:8,margin:0,fontSize:11,background:"#f5f5f5",border:"none",color:"#666"},children:n.description.length>20?n.description.substring(0,20)+"...":n.description})]})]}),(0,i.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,i.jsx)(c.ZP,{type:"text",icon:(0,i.jsx)(C.Z,{}),onClick:e=>{e.stopPropagation(),s(n)},style:{borderRadius:10,color:"#1890ff",background:"#e6f7ff"}}),(0,i.jsx)(c.ZP,{type:"text",danger:!0,icon:(0,i.jsx)(E.Z,{}),onClick:e=>{e.stopPropagation(),a(n)},style:{borderRadius:10,background:"#fff2f0"}})]})]})})};var N=n(5447),R=n(25193),A=n(37410),L=n(27623),O=n(20148),B=n(2786);let{Text:W}=s.default;function J(){let e=(0,p.useRouter)(),{user:t,loading:n}=(0,m.a)(),[s,j]=(0,r.useState)([]),{execute:v}=(0,h.J)(),{showLoading:w,hideLoading:Z}=(0,x.x)(),{socket:C}=(0,y.s)(),[E,I]=(0,r.useState)(""),[T,J]=(0,r.useState)(null);(0,r.useEffect)(()=>{(async()=>{I(await N.O.getCsrfToken())})()},[]);let Y=(0,r.useCallback)(async()=>{v(async()=>{let e=await fetch("/api/stock/ingredients");if(!e.ok){let t=await e.json().catch(()=>({}));throw Error(t.error||t.message||(0,S.t)("stock.ingredients.loadError"))}j(await e.json())},(0,S.t)("stock.ingredients.loading"))},[v]);(0,r.useEffect)(()=>{n||(t?["Admin","Manager"].includes(t.role)?(J(!0),Y()):(J(!1),a.ZP.error((0,S.t)("stock.ingredients.noPermission")),setTimeout(()=>{e.replace("/stock/items")},1e3)):(J(!1),setTimeout(()=>{e.replace("/login")},1e3)))},[t,n,e,Y]),(0,b.v)(C,{create:k.b.ingredients.create,update:k.b.ingredients.update,delete:k.b.ingredients.delete},j);let q=()=>{w(),e.push("/stock/ingredients/manage/add"),setTimeout(()=>Z(),1e3)},F=t=>{w(),e.push("/stock/ingredients/manage/edit/".concat(t.id)),setTimeout(()=>Z(),1e3)},H=e=>{l.Z.confirm({title:(0,S.t)("stock.ingredients.deleteTitle"),content:(0,S.t)("stock.ingredients.deleteContent",{name:e.display_name}),okText:(0,S.t)("branch.delete.ok"),okType:"danger",cancelText:(0,S.t)("branch.delete.cancel"),centered:!0,onOk:async()=>{await v(async()=>{if(!(await fetch("/api/stock/ingredients/delete/".concat(e.id),{method:"DELETE",headers:{"X-CSRF-Token":E}})).ok)throw Error((0,S.t)("stock.ingredients.deleteError"));a.ZP.success((0,S.t)("stock.ingredients.deleteSuccess",{name:e.display_name}))},(0,S.t)("stock.ingredients.deleting"))}})};if(n||null===T)return(0,i.jsxs)("div",{style:{display:"flex",height:"100vh",justifyContent:"center",alignItems:"center",flexDirection:"column",gap:16},children:[(0,i.jsx)(o.Z,{size:"large"}),(0,i.jsx)(W,{type:"secondary",children:(0,S.t)("stock.ingredients.checkingAuth")})]});if(!1===T)return(0,i.jsxs)("div",{style:{display:"flex",height:"100vh",justifyContent:"center",alignItems:"center",flexDirection:"column",gap:16},children:[(0,i.jsx)(o.Z,{size:"large"}),(0,i.jsx)(W,{type:"danger",children:(0,S.t)("stock.ingredients.redirecting")})]});let M=s.filter(e=>e.is_active),U=s.filter(e=>!e.is_active);return(0,i.jsxs)("div",{className:"ingredients-page",style:_.container,children:[(0,i.jsx)(z,{}),(0,i.jsx)(O.Z,{title:(0,S.t)("stock.ingredients.title"),subtitle:(0,S.t)("stock.ingredients.subtitle",{count:s.length}),icon:(0,i.jsx)(f.Z,{}),actions:(0,i.jsxs)(d.Z,{size:8,wrap:!0,children:[(0,i.jsx)(c.ZP,{icon:(0,i.jsx)(g.Z,{}),onClick:Y,children:(0,S.t)("stock.ingredients.refresh")}),(0,i.jsx)(c.ZP,{type:"primary",icon:(0,i.jsx)(u.Z,{}),onClick:q,children:(0,S.t)("stock.ingredients.add")})]})}),(0,i.jsx)(R.Z,{children:(0,i.jsxs)(L.Z,{children:[(0,i.jsx)(P,{totalIngredients:s.length,activeIngredients:M.length,inactiveIngredients:U.length}),(0,i.jsx)(A.Z,{title:(0,S.t)("stock.ingredients.listTitle"),extra:(0,i.jsx)("span",{style:{fontWeight:600},children:s.length}),children:s.length>0?(0,i.jsx)("div",{style:_.listContainer,children:s.map((e,t)=>(0,i.jsx)(D,{ingredient:e,index:t,onEdit:F,onDelete:H},e.id))}):(0,i.jsx)(B.Z,{title:(0,S.t)("stock.ingredients.emptyTitle"),description:(0,S.t)("stock.ingredients.emptyDescription"),action:(0,i.jsx)(c.ZP,{type:"primary",icon:(0,i.jsx)(u.Z,{}),onClick:q,children:(0,S.t)("stock.ingredients.emptyAction")})})})]})})]})}},26972:function(e,t,n){"use strict";n.d(t,{J:function(){return a}});var i=n(2265),r=n(53743),s=n(3369);let a=()=>{let{showLoading:e,hideLoading:t}=(0,s.x)();return{execute:(0,i.useCallback)(async function(n){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"กำลังดำเนินการ...",s=(arguments.length>2&&arguments[2],arguments.length>3&&void 0!==arguments[3]?arguments[3]:"เกิดข้อผิดพลาด");try{return e(i,"async"),await n()}catch(t){console.error("Async action error:",t);let e=s;if("string"==typeof t)e=t;else if(t instanceof Error)e=t.message;else if("object"==typeof t&&null!==t){var a,l,o,d;e=null!==(d=null!==(o=null===(l=t.response)||void 0===l?void 0:null===(a=l.data)||void 0===a?void 0:a.message)&&void 0!==o?o:t.message)&&void 0!==d?d:(()=>{try{return JSON.stringify(t)}catch(e){return"เกิดข้อผิดพลาดที่ไม่ทราบสาเหตุ (Unknown Error)"}})()}r.Z.error({title:"ข้อผิดพลาด",content:e});return}finally{t("async")}},[e,t])}}},67697:function(e,t,n){"use strict";n.d(t,{D:function(){return a},v:function(){return s}});var i=n(2265);let r=e=>{if("string"==typeof e)return e;if(e&&"object"==typeof e){var t;if("id"in e&&e.id)return e.id;if("data"in e&&(null===(t=e.data)||void 0===t?void 0:t.id))return e.data.id}};function s(e,t,n){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e=>e.id,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>!0;(0,i.useEffect)(()=>{if(!e)return;let i=e=>{if(!a(e))return;let t=s(e);n(n=>n.some(e=>s(e)===t)?n:[...n,e])},l=e=>{let t=s(e);n(n=>a(e)?n.some(e=>s(e)===t)?n.map(n=>s(n)===t?e:n):[...n,e]:n.filter(e=>s(e)!==t))},o=e=>{let t=r(e);t&&n(e=>e.filter(e=>s(e)!==t))};return e.on(t.create,i),e.on(t.update,l),e.on(t.delete,o),()=>{e.off(t.create,i),e.off(t.update,l),e.off(t.delete,o)}},[e,t.create,t.update,t.delete,s,n,a])}function a(e){let{socket:t,events:n=[],onRefresh:r,intervalMs:s,enabled:a=!0,debounceMs:l}=e;(0,i.useEffect)(()=>{if(!a||!t||0===n.length)return;let e=null,i=()=>{if(!l||l<=0){r();return}e&&clearTimeout(e),e=setTimeout(()=>{e=null,r()},l)};return n.forEach(e=>t.on(e,i)),()=>{e&&clearTimeout(e),n.forEach(e=>t.off(e,i))}},[a,t,n,r,l]),(0,i.useEffect)(()=>{if(!a||!s)return;let e=setInterval(r,s);return()=>clearInterval(e)},[a,s,r])}}},function(e){e.O(0,[253,1522,3418,742,9486,4252,3916,8651,6931,4159,3831,2224,3248,2401,9,9845,1652,8709,9385,3749,2971,2117,1744],function(){return e(e.s=84638)}),_N_E=e.O()}]);