(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8938],{29769:function(e,a,n){Promise.resolve().then(n.bind(n,21439))},21439:function(e,a,n){"use strict";n.r(a),n.d(a,{default:function(){return P}});var t=n(57437),i=n(2265),r=n(88589),s=n(19878),o=n(34029),l=n(53743),d=n(50742),c=n(48651),p=n(93834),g=n(66487),m=n(99376),u=n(19683),f=n(91652),h=n(78355);let{Text:x,Title:y}=u.default,b={paddingBottom:100,backgroundColor:"#f8f9fc",minHeight:"100vh"},j={display:"flex",gap:12,marginTop:24,paddingTop:20,borderTop:"1px solid #f0f0f0"},k=()=>(0,t.jsx)("style",{children:"\n        @keyframes fadeSlideIn {\n            from {\n                opacity: 0;\n                transform: translateY(12px);\n            }\n            to {\n                opacity: 1;\n                transform: translateY(0);\n            }\n        }\n        \n        .manage-form-card {\n            animation: fadeSlideIn 0.4s ease both;\n        }\n        \n        .manage-page .ant-input,\n        .manage-page .ant-input-number,\n        .manage-page .ant-select-selector,\n        .manage-page .ant-input-affix-wrapper {\n            border-radius: 12px !important;\n            border: 2px solid #f0f0f0 !important;\n            transition: all 0.3s ease !important;\n        }\n        \n        .manage-page .ant-input:focus,\n        .manage-page .ant-input-focused,\n        .manage-page .ant-input-number:focus,\n        .manage-page .ant-input-number-focused,\n        .manage-page .ant-select-focused .ant-select-selector,\n        .manage-page .ant-input-affix-wrapper:focus,\n        .manage-page .ant-input-affix-wrapper-focused {\n            border-color: #1890ff !important;\n            box-shadow: 0 0 0 3px rgba(24, 144, 255, 0.1) !important;\n        }\n        \n        .manage-page .ant-input-lg,\n        .manage-page .ant-select-lg .ant-select-selector {\n            padding: 12px 16px !important;\n            height: auto !important;\n        }\n        \n        .manage-page .ant-form-item-label > label {\n            font-weight: 600;\n            color: #1a1a2e;\n            font-size: 14px;\n        }\n        \n        .manage-page .ant-form-item-required::before {\n            display: none !important;\n        }\n        \n        .manage-page .ant-form-item-required::after {\n            content: '*' !important;\n            display: inline-block !important;\n            color: #ff4d4f !important;\n            margin-left: 4px !important;\n        }\n        \n        .manage-page .ant-switch {\n            min-width: 50px;\n        }\n        \n        .manage-page .ant-switch-checked {\n            background: linear-gradient(135deg, #52c41a 0%, #389e0d 100%);\n        }\n        \n        .manage-page textarea.ant-input {\n            border-radius: 12px !important;\n        }\n    "}),_=e=>{let{url:a,name:n}=e;return(0,t.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:14,padding:16,background:"#fafafa",borderRadius:16,marginTop:12},children:[(0,t.jsx)(f.Z,{src:a||"https://placehold.co/80x80/f5f5f5/999999?text=Preview",size:80,shape:"square",style:{borderRadius:14,border:"2px solid white",boxShadow:"0 4px 12px rgba(0,0,0,0.08)"}}),(0,t.jsxs)("div",{children:[(0,t.jsx)(x,{strong:!0,style:{display:"block",marginBottom:4},children:n||"ตัวอย่างรูปภาพ"}),(0,t.jsx)(x,{type:"secondary",style:{fontSize:12},children:a?"แสดงตัวอย่างจาก URL":"ยังไม่มีรูปภาพ"})]})]})},w=e=>{let{isEdit:a,loading:n,onCancel:i}=e;return(0,t.jsxs)("div",{style:j,children:[(0,t.jsx)(d.ZP,{size:"large",onClick:i,style:{flex:1,borderRadius:14,height:48},children:"ยกเลิก"}),(0,t.jsx)(d.ZP,{type:"primary",htmlType:"submit",size:"large",loading:n,icon:(0,t.jsx)(h.Z,{}),style:{flex:2,borderRadius:14,height:48,background:a?"linear-gradient(135deg, #faad14 0%, #fa8c16 100%)":"linear-gradient(135deg, #52c41a 0%, #389e0d 100%)",border:"none",fontWeight:600,boxShadow:a?"0 4px 12px rgba(250, 173, 20, 0.4)":"0 4px 12px rgba(82, 196, 26, 0.4)"},children:a?"อัปเดต":"บันทึก"})]})};var Z=n(5447),v=n(25193),S=n(37410),C=n(20148);let{TextArea:T}=r.default;function P(e){let{params:a}=e,n=(0,m.useRouter)(),[u]=s.Z.useForm(),[f,h]=(0,i.useState)(!1),[x,y]=(0,i.useState)(!1),[j,P]=(0,i.useState)([]),[E,z]=(0,i.useState)(""),[R,I]=(0,i.useState)(""),[F,N]=(0,i.useState)(""),O=a.mode[0],q=a.mode[1]||null,L="edit"===O&&!!q;(0,i.useEffect)(()=>{(async()=>{N(await Z.O.getCsrfToken())})()},[]);let B=async()=>{try{let e=await fetch("/api/stock/ingredientsUnit/getAll?active=true");if(e.ok){let a=await e.json();P(a)}}catch(e){console.error("Failed to fetch units",e)}},U=(0,i.useCallback)(async()=>{h(!0);try{let e=await fetch("/api/stock/ingredients/getById/".concat(q));if(!e.ok)throw Error("ไม่สามารถดึงข้อมูลวัตถุดิบได้");let a=await e.json();u.setFieldsValue({ingredient_name:a.ingredient_name,display_name:a.display_name,description:a.description,img_url:a.img_url,unit_id:a.unit_id,is_active:a.is_active}),z(a.img_url||""),I(a.display_name||"")}catch(e){console.error(e),o.ZP.error("ไม่สามารถดึงข้อมูลวัตถุดิบได้"),n.push("/stock/ingredients")}finally{h(!1)}},[q,u,n]);(0,i.useEffect)(()=>{B(),L&&U()},[L,q,U]);let V=async e=>{y(!0);try{if(L){let a=await fetch("/api/stock/ingredients/update/".concat(q),{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-Token":F},body:JSON.stringify(e)});if(!a.ok){let e=await a.json().catch(()=>({}));throw Error(e.error||e.message||"ไม่สามารถอัปเดตวัตถุดิบได้")}o.ZP.success("อัปเดตวัตถุดิบสำเร็จ")}else{let a=await fetch("/api/stock/ingredients/create",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":F},body:JSON.stringify(e)});if(!a.ok){let e=await a.json().catch(()=>({}));throw Error(e.error||e.message||"ไม่สามารถสร้างวัตถุดิบได้")}o.ZP.success("สร้างวัตถุดิบสำเร็จ")}n.push("/stock/ingredients")}catch(e){console.error(e),o.ZP.error(e.message||(L?"ไม่สามารถอัปเดตวัตถุดิบได้":"ไม่สามารถสร้างวัตถุดิบได้"))}finally{y(!1)}},X=()=>n.push("/stock/ingredients");return(0,t.jsxs)("div",{className:"manage-page",style:b,children:[(0,t.jsx)(k,{}),(0,t.jsx)(C.Z,{title:L?"แก้ไขวัตถุดิบ":"เพิ่มวัตถุดิบ",subtitle:"ข้อมูลวัตถุดิบในคลัง",onBack:X,actions:L?(0,t.jsx)(d.ZP,{danger:!0,onClick:()=>{q&&l.Z.confirm({title:"ยืนยันการลบวัตถุดิบ",content:'คุณต้องการลบวัตถุดิบ "'.concat(R,'" หรือไม่?'),okText:"ลบ",okType:"danger",cancelText:"ยกเลิก",centered:!0,onOk:async()=>{try{if(!(await fetch("/api/stock/ingredients/delete/".concat(q),{method:"DELETE",headers:{"X-CSRF-Token":F}})).ok)throw Error("ไม่สามารถลบวัตถุดิบได้");o.ZP.success("ลบวัตถุดิบสำเร็จ"),n.push("/stock/ingredients")}catch(e){console.error(e),o.ZP.error("ไม่สามารถลบวัตถุดิบได้")}}})},children:"ลบ"}):void 0}),(0,t.jsx)(v.Z,{maxWidth:900,children:(0,t.jsx)("div",{className:"manage-form-card",children:(0,t.jsx)(S.Z,{children:f?(0,t.jsx)("div",{style:{display:"flex",justifyContent:"center",padding:"60px 0"},children:(0,t.jsx)(c.Z,{size:"large"})}):(0,t.jsxs)(s.Z,{form:u,layout:"vertical",onFinish:V,requiredMark:!1,autoComplete:"off",initialValues:{is_active:!0},onValuesChange:e=>{"string"==typeof e.img_url&&z(e.img_url),"string"==typeof e.display_name&&I(e.display_name)},children:[(0,t.jsx)(s.Z.Item,{name:"ingredient_name",label:"ชื่อวัตถุดิบ (ภาษาอังกฤษ) *",rules:[{required:!0,message:"กรุณากรอกชื่อวัตถุดิบ"},{pattern:/^[a-zA-Z0-9\s\-_().]*$/,message:"กรุณากรอกภาษาอังกฤษเท่านั้น"},{max:100,message:"ความยาวต้องไม่เกิน 100 ตัวอักษร"}],children:(0,t.jsx)(r.default,{size:"large",placeholder:"เช่น Sugar, Salt, Flour",maxLength:100})}),(0,t.jsx)(s.Z.Item,{name:"display_name",label:"ชื่อที่แสดง (ภาษาไทย) *",rules:[{required:!0,message:"กรุณากรอกชื่อที่แสดง"},{max:100,message:"ความยาวต้องไม่เกิน 100 ตัวอักษร"}],children:(0,t.jsx)(r.default,{size:"large",placeholder:"เช่น น้ำตาล, เกลือ, แป้ง",maxLength:100})}),(0,t.jsx)(s.Z.Item,{name:"unit_id",label:"หน่วยวัตถุดิบ *",rules:[{required:!0,message:"กรุณาเลือกหน่วยวัตถุดิบ"}],children:(0,t.jsx)(p.default,{size:"large",placeholder:"เลือกหน่วย",showSearch:!0,optionFilterProp:"children",children:j.map(e=>(0,t.jsxs)(p.default.Option,{value:e.id,children:[e.display_name," (",e.unit_name,")"]},e.id))})}),(0,t.jsx)(s.Z.Item,{name:"img_url",label:"รูปภาพ URL",children:(0,t.jsx)(r.default,{size:"large",placeholder:"https://example.com/image.jpg"})}),(0,t.jsx)(_,{url:E,name:R}),(0,t.jsx)(s.Z.Item,{name:"description",label:"รายละเอียด",style:{marginTop:20},children:(0,t.jsx)(T,{rows:4,placeholder:"รายละเอียดเพิ่มเติม...",style:{borderRadius:12}})}),(0,t.jsx)(s.Z.Item,{name:"is_active",label:"สถานะการใช้งาน",valuePropName:"checked",children:(0,t.jsx)(g.Z,{checkedChildren:"ใช้งาน",unCheckedChildren:"ไม่ใช้งาน"})}),(0,t.jsx)(w,{isEdit:L,loading:x,onCancel:X})]})})})})]})}}},function(e){e.O(0,[8024,4736,8592,1744],function(){return e(e.s=29769)}),_N_E=e.O()}]);