(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8938],{29769:function(e,t,n){Promise.resolve().then(n.bind(n,21439))},26349:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});var a=n(2265),r={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M360 184h-8c4.4 0 8-3.6 8-8v8h304v-8c0 4.4 3.6 8 8 8h-8v72h72v-80c0-35.3-28.7-64-64-64H352c-35.3 0-64 28.7-64 64v80h72v-72zm504 72H160c-17.7 0-32 14.3-32 32v32c0 4.4 3.6 8 8 8h60.4l24.7 523c1.6 34.1 29.8 61 63.9 61h454c34.2 0 62.3-26.8 63.9-61l24.7-523H888c4.4 0 8-3.6 8-8v-32c0-17.7-14.3-32-32-32zM731.3 840H292.7l-24.2-512h487l-24.2 512z"}}]},name:"delete",theme:"outlined"},o=n(55015);function i(){return(i=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}var s=a.forwardRef((e,t)=>a.createElement(o.Z,i({},e,{ref:t,icon:r})))},34029:function(e,t,n){"use strict";var a=n(19103),r=n(2265),o=n(51783),i=n(52402),s=n(71744),l=n(47213),c=n(32569),d=n(12224),u=n(55582);let p=null,f=e=>e(),g=[],h={};function m(){let{getContainer:e,duration:t,rtl:n,maxCount:a,top:r}=h,o=(null==e?void 0:e())||document.body;return{getContainer:()=>o,duration:t,rtl:n,maxCount:a,top:r}}let x=r.forwardRef((e,t)=>{let{messageConfig:n,sync:a}=e,{getPrefixCls:o}=(0,r.useContext)(s.E_),l=h.prefixCls||o("message"),c=(0,r.useContext)(i.J),[u,p]=(0,d.K)({...n,prefixCls:l,...c.message});return r.useImperativeHandle(t,()=>{let e={...u};return Object.keys(e).forEach(t=>{e[t]=function(){for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];return a(),u[t].apply(u,n)}}),{instance:e,sync:a}}),p}),y=r.forwardRef((e,t)=>{let[n,a]=r.useState(m),o=()=>{a(m)};r.useEffect(o,[]);let i=(0,l.w6)(),s=i.getRootPrefixCls(),c=i.getIconPrefixCls(),d=i.getTheme(),u=r.createElement(x,{ref:t,sync:o,messageConfig:n});return r.createElement(l.ZP,{prefixCls:s,iconPrefixCls:c,theme:d},i.holderRender?i.holderRender(u):u)}),b=()=>{if(!p){let e=document.createDocumentFragment(),t={fragment:e};p=t,f(()=>{(0,o.s)(r.createElement(y,{ref:e=>{let{instance:n,sync:a}=e||{};Promise.resolve().then(()=>{!t.instance&&n&&(t.instance=n,t.sync=a,b())})}}),e)});return}p.instance&&(g.forEach(e=>{let{type:t,skipped:n}=e;if(!n)switch(t){case"open":f(()=>{let t=p.instance.open({...h,...e.config});null==t||t.then(e.resolve),e.setCloseFn(t)});break;case"destroy":f(()=>{null==p||p.instance.destroy(e.key)});break;default:f(()=>{var n;let r=(n=p.instance)[t].apply(n,(0,a.Z)(e.args));null==r||r.then(e.resolve),e.setCloseFn(r)})}}),g=[])},S={open:function(e){let t=(0,u.J)(t=>{let n;let a={type:"open",config:e,resolve:t,setCloseFn:e=>{n=e}};return g.push(a),()=>{n?f(()=>{n()}):a.skipped=!0}});return b(),t},destroy:e=>{g.push({type:"destroy",key:e}),b()},config:function(e){h={...h,...e},f(()=>{var e;null==p||null===(e=p.sync)||void 0===e||e.call(p)})},useMessage:d.Z,_InternalPanelDoNotUseOrYouWillBeFired:c.ZP};["success","info","warning","error","loading"].forEach(e=>{S[e]=function(){for(var t=arguments.length,n=Array(t),a=0;a<t;a++)n[a]=arguments[a];return function(e,t){(0,l.w6)();let n=(0,u.J)(n=>{let a;let r={type:e,args:t,resolve:n,setCloseFn:e=>{a=e}};return g.push(r),()=>{a?f(()=>{a()}):r.skipped=!0}});return b(),n}(e,n)}}),t.ZP=S},53743:function(e,t,n){"use strict";n.d(t,{Z:function(){return b}});var a=n(42535),r=n(50815),o=n(74079),i=n(2265),s=n(28975),l=n(61994),c=n(93942),d=n(71744),u=n(64024),p=n(85695),f=n(90024),g=n(4065),h=(0,c.i)(e=>{let{prefixCls:t,className:n,closeIcon:a,closable:r,type:o,title:c,children:h,footer:m,...x}=e,{getPrefixCls:y}=i.useContext(d.E_),b=y(),S=t||y("modal"),E=(0,u.Z)(b),[j,k]=(0,g.ZP)(S,E),v="".concat(S,"-confirm"),w={};return w=o?{closable:null!=r&&r,title:"",footer:"",children:i.createElement(p.O,{...e,prefixCls:S,confirmPrefixCls:v,rootPrefixCls:b,content:h})}:{closable:null==r||r,title:c,footer:null!==m&&i.createElement(f.$,{...e}),children:h},i.createElement(s.s,{prefixCls:S,className:(0,l.W)(j,"".concat(S,"-pure-panel"),o&&v,o&&"".concat(v,"-").concat(o),n,k,E),...x,closeIcon:(0,f.b)(S,a),closable:r,...w})}),m=n(23248);function x(e){return(0,a.ZP)((0,a.uW)(e))}let y=o.Z;y.useModal=m.Z,y.info=function(e){return(0,a.ZP)((0,a.cw)(e))},y.success=function(e){return(0,a.ZP)((0,a.vq)(e))},y.error=function(e){return(0,a.ZP)((0,a.AQ)(e))},y.warning=x,y.warn=x,y.confirm=function(e){return(0,a.ZP)((0,a.Au)(e))},y.destroyAll=function(){for(;r.Z.length;){let e=r.Z.pop();e&&e()}},y.config=a.ai,y._InternalPanelDoNotUseOrYouWillBeFired=h;var b=y},21439:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return N}});var a=n(57437),r=n(2265),o=n(88589),i=n(44967),s=n(34029),l=n(53743),c=n(48651),d=n(93834),u=n(80336),p=n(99376),f=n(82646),g=n(50742),h=n(91652),m=n(17588),x=n(13377),y=n(34419),b=n(26349),S=n(78355);let{Text:E,Title:j}=f.default,k={paddingBottom:100,backgroundColor:"#f8f9fc",minHeight:"100vh"},v=e=>({background:e?"linear-gradient(135deg, #faad14 0%, #fa8c16 100%)":"linear-gradient(135deg, #52c41a 0%, #389e0d 100%)",padding:"20px 20px 60px 20px",position:"relative",overflow:"hidden"}),w={position:"absolute",top:-50,right:-50,width:150,height:150,borderRadius:"50%",background:"rgba(255,255,255,0.1)"},C={position:"absolute",bottom:-30,left:-30,width:100,height:100,borderRadius:"50%",background:"rgba(255,255,255,0.08)"},T={position:"relative",zIndex:1,display:"flex",alignItems:"center",gap:12},P={width:48,height:48,borderRadius:14,background:"rgba(255,255,255,0.2)",display:"flex",alignItems:"center",justifyContent:"center",backdropFilter:"blur(8px)"},_={margin:"-40px 16px 0 16px",padding:"24px",background:"white",borderRadius:20,boxShadow:"0 8px 24px rgba(0,0,0,0.08)",position:"relative",zIndex:10},R={display:"flex",gap:12,marginTop:24,paddingTop:20,borderTop:"1px solid #f0f0f0"},Z=()=>(0,a.jsx)("style",{children:"\n        @keyframes fadeSlideIn {\n            from {\n                opacity: 0;\n                transform: translateY(12px);\n            }\n            to {\n                opacity: 1;\n                transform: translateY(0);\n            }\n        }\n        \n        .manage-form-card {\n            animation: fadeSlideIn 0.4s ease both;\n        }\n        \n        .manage-page .ant-input,\n        .manage-page .ant-input-number,\n        .manage-page .ant-select-selector,\n        .manage-page .ant-input-affix-wrapper {\n            border-radius: 12px !important;\n            border: 2px solid #f0f0f0 !important;\n            transition: all 0.3s ease !important;\n        }\n        \n        .manage-page .ant-input:focus,\n        .manage-page .ant-input-focused,\n        .manage-page .ant-input-number:focus,\n        .manage-page .ant-input-number-focused,\n        .manage-page .ant-select-focused .ant-select-selector,\n        .manage-page .ant-input-affix-wrapper:focus,\n        .manage-page .ant-input-affix-wrapper-focused {\n            border-color: #1890ff !important;\n            box-shadow: 0 0 0 3px rgba(24, 144, 255, 0.1) !important;\n        }\n        \n        .manage-page .ant-input-lg,\n        .manage-page .ant-select-lg .ant-select-selector {\n            padding: 12px 16px !important;\n            height: auto !important;\n        }\n        \n        .manage-page .ant-form-item-label > label {\n            font-weight: 600;\n            color: #1a1a2e;\n            font-size: 14px;\n        }\n        \n        .manage-page .ant-form-item-required::before {\n            display: none !important;\n        }\n        \n        .manage-page .ant-form-item-required::after {\n            content: '*' !important;\n            display: inline-block !important;\n            color: #ff4d4f !important;\n            margin-left: 4px !important;\n        }\n        \n        .manage-page .ant-switch {\n            min-width: 50px;\n        }\n        \n        .manage-page .ant-switch-checked {\n            background: linear-gradient(135deg, #52c41a 0%, #389e0d 100%);\n        }\n        \n        .manage-page textarea.ant-input {\n            border-radius: 12px !important;\n        }\n    "}),A=e=>{let{isEdit:t,onBack:n,onDelete:r}=e;return(0,a.jsxs)("div",{style:v(t),children:[(0,a.jsx)("div",{style:w}),(0,a.jsx)("div",{style:C}),(0,a.jsxs)("div",{style:T,children:[(0,a.jsx)(g.ZP,{type:"text",icon:(0,a.jsx)(m.Z,{style:{fontSize:20,color:"white"}}),onClick:n,style:{width:40,height:40,borderRadius:12,background:"rgba(255,255,255,0.2)",display:"flex",alignItems:"center",justifyContent:"center"}}),(0,a.jsx)("div",{style:P,children:t?(0,a.jsx)(x.Z,{style:{fontSize:24,color:"white"}}):(0,a.jsx)(y.Z,{style:{fontSize:24,color:"white"}})}),(0,a.jsxs)("div",{style:{flex:1},children:[(0,a.jsx)(E,{style:{color:"rgba(255,255,255,0.85)",fontSize:13,display:"block"},children:t?"แก้ไขข้อมูล":"เพิ่มข้อมูลใหม่"}),(0,a.jsx)(j,{level:4,style:{color:"white",margin:0,fontWeight:700,letterSpacing:"0.5px"},children:t?"แก้ไขวัตถุดิบ":"เพิ่มวัตถุดิบ"})]}),t&&r&&(0,a.jsx)(g.ZP,{danger:!0,icon:(0,a.jsx)(b.Z,{}),onClick:r,style:{background:"rgba(255,77,79,0.9)",borderColor:"transparent",color:"white",borderRadius:12,height:40,fontWeight:600},children:"ลบ"})]})]})},O=e=>{let{url:t,name:n}=e;return(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:14,padding:16,background:"#fafafa",borderRadius:16,marginTop:12},children:[(0,a.jsx)(h.Z,{src:t||"https://placehold.co/80x80/f5f5f5/999999?text=Preview",size:80,shape:"square",style:{borderRadius:14,border:"2px solid white",boxShadow:"0 4px 12px rgba(0,0,0,0.08)"}}),(0,a.jsxs)("div",{children:[(0,a.jsx)(E,{strong:!0,style:{display:"block",marginBottom:4},children:n||"ตัวอย่างรูปภาพ"}),(0,a.jsx)(E,{type:"secondary",style:{fontSize:12},children:t?"แสดงตัวอย่างจาก URL":"ยังไม่มีรูปภาพ"})]})]})},I=e=>{let{isEdit:t,loading:n,onCancel:r}=e;return(0,a.jsxs)("div",{style:R,children:[(0,a.jsx)(g.ZP,{size:"large",onClick:r,style:{flex:1,borderRadius:14,height:48},children:"ยกเลิก"}),(0,a.jsx)(g.ZP,{type:"primary",htmlType:"submit",size:"large",loading:n,icon:(0,a.jsx)(S.Z,{}),style:{flex:2,borderRadius:14,height:48,background:t?"linear-gradient(135deg, #faad14 0%, #fa8c16 100%)":"linear-gradient(135deg, #52c41a 0%, #389e0d 100%)",border:"none",fontWeight:600,boxShadow:t?"0 4px 12px rgba(250, 173, 20, 0.4)":"0 4px 12px rgba(82, 196, 26, 0.4)"},children:t?"อัปเดต":"บันทึก"})]})};var F=n(5447);let{TextArea:L}=o.default;function N(e){let{params:t}=e,n=(0,p.useRouter)(),[f]=i.Z.useForm(),[g,h]=(0,r.useState)(!1),[m,x]=(0,r.useState)(!1),[y,b]=(0,r.useState)([]),[S,E]=(0,r.useState)(""),[j,v]=(0,r.useState)(""),[w,C]=(0,r.useState)(""),T=t.mode[0],P=t.mode[1]||null,R="edit"===T&&!!P;(0,r.useEffect)(()=>{(async()=>{C(await F.O.getCsrfToken())})()},[]);let N=async()=>{try{let e=await fetch("/api/stock/ingredientsUnit/getAll?active=true");if(e.ok){let t=await e.json();b(t)}}catch(e){console.error("Failed to fetch units",e)}},U=(0,r.useCallback)(async()=>{h(!0);try{let e=await fetch("/api/stock/ingredients/getById/".concat(P));if(!e.ok)throw Error("ไม่สามารถดึงข้อมูลวัตถุดิบได้");let t=await e.json();f.setFieldsValue({ingredient_name:t.ingredient_name,display_name:t.display_name,description:t.description,img_url:t.img_url,unit_id:t.unit_id,is_active:t.is_active}),E(t.img_url||""),v(t.display_name||"")}catch(e){console.error(e),s.ZP.error("ไม่สามารถดึงข้อมูลวัตถุดิบได้"),n.push("/stock/ingredients")}finally{h(!1)}},[P,f,n]);(0,r.useEffect)(()=>{N(),R&&U()},[R,P,U]);let z=async e=>{x(!0);try{if(R){let t=await fetch("/api/stock/ingredients/update/".concat(P),{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-Token":w},body:JSON.stringify(e)});if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.error||e.message||"ไม่สามารถอัปเดตวัตถุดิบได้")}s.ZP.success("อัปเดตวัตถุดิบสำเร็จ")}else{let t=await fetch("/api/stock/ingredients/create",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":w},body:JSON.stringify(e)});if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.error||e.message||"ไม่สามารถสร้างวัตถุดิบได้")}s.ZP.success("สร้างวัตถุดิบสำเร็จ")}n.push("/stock/ingredients")}catch(e){console.error(e),s.ZP.error(e.message||(R?"ไม่สามารถอัปเดตวัตถุดิบได้":"ไม่สามารถสร้างวัตถุดิบได้"))}finally{x(!1)}},D=()=>n.push("/ingredients");return(0,a.jsxs)("div",{className:"manage-page",style:k,children:[(0,a.jsx)(Z,{}),(0,a.jsx)(A,{isEdit:R,onBack:D,onDelete:R?()=>{P&&l.Z.confirm({title:"ยืนยันการลบวัตถุดิบ",content:'คุณต้องการลบวัตถุดิบ "'.concat(j,'" หรือไม่?'),okText:"ลบ",okType:"danger",cancelText:"ยกเลิก",centered:!0,onOk:async()=>{try{if(!(await fetch("/api/stock/ingredients/delete/".concat(P),{method:"DELETE",headers:{"X-CSRF-Token":w}})).ok)throw Error("ไม่สามารถลบวัตถุดิบได้");s.ZP.success("ลบวัตถุดิบสำเร็จ"),n.push("/ingredients")}catch(e){console.error(e),s.ZP.error("ไม่สามารถลบวัตถุดิบได้")}}})}:void 0}),(0,a.jsx)("div",{className:"manage-form-card",style:_,children:g?(0,a.jsx)("div",{style:{display:"flex",justifyContent:"center",padding:"60px 0"},children:(0,a.jsx)(c.Z,{size:"large"})}):(0,a.jsxs)(i.Z,{form:f,layout:"vertical",onFinish:z,requiredMark:!1,autoComplete:"off",initialValues:{is_active:!0},onValuesChange:e=>{void 0!==e.img_url&&E(e.img_url),void 0!==e.display_name&&v(e.display_name)},children:[(0,a.jsx)(i.Z.Item,{name:"ingredient_name",label:"ชื่อวัตถุดิบ (ภาษาอังกฤษ) *",rules:[{required:!0,message:"กรุณากรอกชื่อวัตถุดิบ"},{pattern:/^[a-zA-Z0-9\s\-_().]*$/,message:"กรุณากรอกภาษาอังกฤษเท่านั้น"},{max:100,message:"ความยาวต้องไม่เกิน 100 ตัวอักษร"}],children:(0,a.jsx)(o.default,{size:"large",placeholder:"เช่น Sugar, Salt, Flour",maxLength:100})}),(0,a.jsx)(i.Z.Item,{name:"display_name",label:"ชื่อที่แสดง (ภาษาไทย) *",rules:[{required:!0,message:"กรุณากรอกชื่อที่แสดง"},{max:100,message:"ความยาวต้องไม่เกิน 100 ตัวอักษร"}],children:(0,a.jsx)(o.default,{size:"large",placeholder:"เช่น น้ำตาล, เกลือ, แป้ง",maxLength:100})}),(0,a.jsx)(i.Z.Item,{name:"unit_id",label:"หน่วยวัตถุดิบ *",rules:[{required:!0,message:"กรุณาเลือกหน่วยวัตถุดิบ"}],children:(0,a.jsx)(d.default,{size:"large",placeholder:"เลือกหน่วย",showSearch:!0,optionFilterProp:"children",children:y.map(e=>(0,a.jsxs)(d.default.Option,{value:e.id,children:[e.display_name," (",e.unit_name,")"]},e.id))})}),(0,a.jsx)(i.Z.Item,{name:"img_url",label:"รูปภาพ URL",children:(0,a.jsx)(o.default,{size:"large",placeholder:"https://example.com/image.jpg"})}),(0,a.jsx)(O,{url:S,name:j}),(0,a.jsx)(i.Z.Item,{name:"description",label:"รายละเอียด",style:{marginTop:20},children:(0,a.jsx)(L,{rows:4,placeholder:"รายละเอียดเพิ่มเติม...",style:{borderRadius:12}})}),(0,a.jsx)(i.Z.Item,{name:"is_active",label:"สถานะการใช้งาน",valuePropName:"checked",children:(0,a.jsx)(u.Z,{checkedChildren:"ใช้งาน",unCheckedChildren:"ไม่ใช้งาน"})}),(0,a.jsx)(I,{isEdit:R,loading:m,onCancel:D})]})})]})}},71567:function(e,t,n){"use strict";n.d(t,{q:function(){return r},v:function(){return a}});let a="/api",r={AUTH:{LOGIN:"/auth/login",ME:"/auth/me",CSRF:"/csrf"},POS:{PRODUCTS:"/pos/products",ORDERS:"/pos/orders",TABLES:"/pos/tables",DISCOUNTS:"/pos/discounts",DELIVERY:"/pos/delivery",PAYMENT_METHODS:"/pos/paymentMethod",PAYMENTS:"/pos/payments",CATEGORY:"/pos/category",SHIFTS:{BASE:"/pos/shifts",CURRENT:"/pos/shifts/current",OPEN:"/pos/shifts/open",CLOSE:"/pos/shifts/close"},DASHBOARD:{SALES:"/pos/dashboard/sales",TOP_ITEMS:"/pos/dashboard/top-items"},CHANNELS:{STATS:"/pos/orders/stats"},SHOP_PROFILE:"/pos/shopProfile",SALES_ORDER_ITEMS:"/pos/salesOrderItem",SALES_ORDER_DETAILS:"/pos/salesOrderDetail",PRODUCTS_UNIT:"/pos/productsUnit",PAYMENT_DETAILS:"/pos/paymentDetails",BRANCH:"/branches"}}},2913:function(e,t,n){"use strict";function a(e,t){return({GET:"".concat(r.API_BASE_URL).concat(t),POST:"".concat(r.API_BASE_URL).concat(t),PUT:"".concat(r.API_BASE_URL).concat(t),DELETE:"".concat(r.API_BASE_URL).concat(t),PATCH:"".concat(r.API_BASE_URL).concat(t)})[e]}n.d(t,{b:function(){return a}});let r={get API_BASE_URL(){return"/api"}}},5447:function(e,t,n){"use strict";n.d(t,{O:function(){return o}});var a=n(71567),r=n(2913);let o={login:async(e,t,n)=>{try{let o=(0,r.b)("POST",a.q.AUTH.LOGIN),i={"Content-Type":"application/json"};t&&(i["X-CSRF-Token"]=t),n&&(i.Cookie=n);let s=await fetch(o,{method:"POST",headers:i,credentials:"include",body:JSON.stringify(e)});if(!s.ok){let e=await s.json().catch(()=>({}));throw Error(e.message||e.detail||"เข้าสู่ระบบไม่สำเร็จ")}let l=await s.json();return{...l.user,token:l.token}}catch(e){throw Error(e.message||"เข้าสู่ระบบไม่สำเร็จ")}},logout:async(e,t,n)=>{try{let a=(0,r.b)("POST","/auth/logout"),o={"Content-Type":"application/json"};e&&(o.Authorization="Bearer ".concat(e)),t&&(o["X-CSRF-Token"]=t),n&&(o.Cookie=n),await fetch(a,{method:"POST",headers:o,credentials:"include"})}catch(e){console.error("Logout failed",e)}},getMe:async e=>{try{let t=(0,r.b)("GET",a.q.AUTH.ME),n=await fetch(t,{method:"GET",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"},credentials:"include",cache:"no-store"});if(!n.ok)throw Error("Unauthorized");return await n.json()}catch(e){throw e}},async getCsrfToken(){try{let e=await fetch("".concat(a.v).concat(a.q.AUTH.CSRF),{credentials:"include"});if(!e.ok)return"";return(await e.json()).csrfToken}catch(e){return console.error("Failed to fetch CSRF token",e),""}}}}},function(e){e.O(0,[5015,7717,7698,742,3211,7993,8651,2646,6207,7213,9021,2224,3248,5616,8589,5496,3834,4967,1652,5775,2971,2117,1744],function(){return e(e.s=29769)}),_N_E=e.O()}]);