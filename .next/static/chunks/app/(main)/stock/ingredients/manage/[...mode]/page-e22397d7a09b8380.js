(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8938],{29769:function(e,t,n){Promise.resolve().then(n.bind(n,21439))},21439:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return C}});var a=n(57437),r=n(2265),i=n(88589),o=n(19878),s=n(34029),c=n(53743),l=n(50742),d=n(48651),u=n(93834),p=n(80336),g=n(99376),f=n(39486),h=n(91652),m=n(78355);let{Text:y,Title:x}=f.default,b={paddingBottom:100,backgroundColor:"#f8f9fc",minHeight:"100vh"},T={display:"flex",gap:12,marginTop:24,paddingTop:20,borderTop:"1px solid #f0f0f0"},S=()=>(0,a.jsx)("style",{children:"\n        @keyframes fadeSlideIn {\n            from {\n                opacity: 0;\n                transform: translateY(12px);\n            }\n            to {\n                opacity: 1;\n                transform: translateY(0);\n            }\n        }\n        \n        .manage-form-card {\n            animation: fadeSlideIn 0.4s ease both;\n        }\n        \n        .manage-page .ant-input,\n        .manage-page .ant-input-number,\n        .manage-page .ant-select-selector,\n        .manage-page .ant-input-affix-wrapper {\n            border-radius: 12px !important;\n            border: 2px solid #f0f0f0 !important;\n            transition: all 0.3s ease !important;\n        }\n        \n        .manage-page .ant-input:focus,\n        .manage-page .ant-input-focused,\n        .manage-page .ant-input-number:focus,\n        .manage-page .ant-input-number-focused,\n        .manage-page .ant-select-focused .ant-select-selector,\n        .manage-page .ant-input-affix-wrapper:focus,\n        .manage-page .ant-input-affix-wrapper-focused {\n            border-color: #1890ff !important;\n            box-shadow: 0 0 0 3px rgba(24, 144, 255, 0.1) !important;\n        }\n        \n        .manage-page .ant-input-lg,\n        .manage-page .ant-select-lg .ant-select-selector {\n            padding: 12px 16px !important;\n            height: auto !important;\n        }\n        \n        .manage-page .ant-form-item-label > label {\n            font-weight: 600;\n            color: #1a1a2e;\n            font-size: 14px;\n        }\n        \n        .manage-page .ant-form-item-required::before {\n            display: none !important;\n        }\n        \n        .manage-page .ant-form-item-required::after {\n            content: '*' !important;\n            display: inline-block !important;\n            color: #ff4d4f !important;\n            margin-left: 4px !important;\n        }\n        \n        .manage-page .ant-switch {\n            min-width: 50px;\n        }\n        \n        .manage-page .ant-switch-checked {\n            background: linear-gradient(135deg, #52c41a 0%, #389e0d 100%);\n        }\n        \n        .manage-page textarea.ant-input {\n            border-radius: 12px !important;\n        }\n    "}),j=e=>{let{url:t,name:n}=e;return(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:14,padding:16,background:"#fafafa",borderRadius:16,marginTop:12},children:[(0,a.jsx)(h.Z,{src:t||"https://placehold.co/80x80/f5f5f5/999999?text=Preview",size:80,shape:"square",style:{borderRadius:14,border:"2px solid white",boxShadow:"0 4px 12px rgba(0,0,0,0.08)"}}),(0,a.jsxs)("div",{children:[(0,a.jsx)(y,{strong:!0,style:{display:"block",marginBottom:4},children:n||"ตัวอย่างรูปภาพ"}),(0,a.jsx)(y,{type:"secondary",style:{fontSize:12},children:t?"แสดงตัวอย่างจาก URL":"ยังไม่มีรูปภาพ"})]})]})},k=e=>{let{isEdit:t,loading:n,onCancel:r}=e;return(0,a.jsxs)("div",{style:T,children:[(0,a.jsx)(l.ZP,{size:"large",onClick:r,style:{flex:1,borderRadius:14,height:48},children:"ยกเลิก"}),(0,a.jsx)(l.ZP,{type:"primary",htmlType:"submit",size:"large",loading:n,icon:(0,a.jsx)(m.Z,{}),style:{flex:2,borderRadius:14,height:48,background:t?"linear-gradient(135deg, #faad14 0%, #fa8c16 100%)":"linear-gradient(135deg, #52c41a 0%, #389e0d 100%)",border:"none",fontWeight:600,boxShadow:t?"0 4px 12px rgba(250, 173, 20, 0.4)":"0 4px 12px rgba(82, 196, 26, 0.4)"},children:t?"อัปเดต":"บันทึก"})]})};var w=n(5447),E=n(25193),_=n(37410),P=n(20148);let{TextArea:v}=i.default;function C(e){let{params:t}=e,n=(0,g.useRouter)(),[f]=o.Z.useForm(),[h,m]=(0,r.useState)(!1),[y,x]=(0,r.useState)(!1),[T,C]=(0,r.useState)([]),[R,A]=(0,r.useState)(""),[O,Z]=(0,r.useState)(""),[H,I]=(0,r.useState)(""),L=t.mode[0],U=t.mode[1]||null,B="edit"===L&&!!U;(0,r.useEffect)(()=>{(async()=>{I(await w.O.getCsrfToken())})()},[]);let N=async()=>{try{let e=await fetch("/api/stock/ingredientsUnit/getAll?active=true");if(e.ok){let t=await e.json();C(t)}}catch(e){console.error("Failed to fetch units",e)}},D=(0,r.useCallback)(async()=>{m(!0);try{let e=await fetch("/api/stock/ingredients/getById/".concat(U));if(!e.ok)throw Error("ไม่สามารถดึงข้อมูลวัตถุดิบได้");let t=await e.json();f.setFieldsValue({ingredient_name:t.ingredient_name,display_name:t.display_name,description:t.description,img_url:t.img_url,unit_id:t.unit_id,is_active:t.is_active}),A(t.img_url||""),Z(t.display_name||"")}catch(e){console.error(e),s.ZP.error("ไม่สามารถดึงข้อมูลวัตถุดิบได้"),n.push("/stock/ingredients")}finally{m(!1)}},[U,f,n]);(0,r.useEffect)(()=>{N(),B&&D()},[B,U,D]);let F=async e=>{x(!0);try{if(B){let t=await fetch("/api/stock/ingredients/update/".concat(U),{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-Token":H},body:JSON.stringify(e)});if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.error||e.message||"ไม่สามารถอัปเดตวัตถุดิบได้")}s.ZP.success("อัปเดตวัตถุดิบสำเร็จ")}else{let t=await fetch("/api/stock/ingredients/create",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":H},body:JSON.stringify(e)});if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.error||e.message||"ไม่สามารถสร้างวัตถุดิบได้")}s.ZP.success("สร้างวัตถุดิบสำเร็จ")}n.push("/stock/ingredients")}catch(e){console.error(e),s.ZP.error(e.message||(B?"ไม่สามารถอัปเดตวัตถุดิบได้":"ไม่สามารถสร้างวัตถุดิบได้"))}finally{x(!1)}},M=()=>n.push("/stock/ingredients");return(0,a.jsxs)("div",{className:"manage-page",style:b,children:[(0,a.jsx)(S,{}),(0,a.jsx)(P.Z,{title:B?"แก้ไขวัตถุดิบ":"เพิ่มวัตถุดิบ",subtitle:"ข้อมูลวัตถุดิบในคลัง",onBack:M,actions:B?(0,a.jsx)(l.ZP,{danger:!0,onClick:()=>{U&&c.Z.confirm({title:"ยืนยันการลบวัตถุดิบ",content:'คุณต้องการลบวัตถุดิบ "'.concat(O,'" หรือไม่?'),okText:"ลบ",okType:"danger",cancelText:"ยกเลิก",centered:!0,onOk:async()=>{try{if(!(await fetch("/api/stock/ingredients/delete/".concat(U),{method:"DELETE",headers:{"X-CSRF-Token":H}})).ok)throw Error("ไม่สามารถลบวัตถุดิบได้");s.ZP.success("ลบวัตถุดิบสำเร็จ"),n.push("/stock/ingredients")}catch(e){console.error(e),s.ZP.error("ไม่สามารถลบวัตถุดิบได้")}}})},children:"ลบ"}):void 0}),(0,a.jsx)(E.Z,{maxWidth:900,children:(0,a.jsx)("div",{className:"manage-form-card",children:(0,a.jsx)(_.Z,{children:h?(0,a.jsx)("div",{style:{display:"flex",justifyContent:"center",padding:"60px 0"},children:(0,a.jsx)(d.Z,{size:"large"})}):(0,a.jsxs)(o.Z,{form:f,layout:"vertical",onFinish:F,requiredMark:!1,autoComplete:"off",initialValues:{is_active:!0},onValuesChange:e=>{"string"==typeof e.img_url&&A(e.img_url),"string"==typeof e.display_name&&Z(e.display_name)},children:[(0,a.jsx)(o.Z.Item,{name:"ingredient_name",label:"ชื่อวัตถุดิบ (ภาษาอังกฤษ) *",rules:[{required:!0,message:"กรุณากรอกชื่อวัตถุดิบ"},{pattern:/^[a-zA-Z0-9\s\-_().]*$/,message:"กรุณากรอกภาษาอังกฤษเท่านั้น"},{max:100,message:"ความยาวต้องไม่เกิน 100 ตัวอักษร"}],children:(0,a.jsx)(i.default,{size:"large",placeholder:"เช่น Sugar, Salt, Flour",maxLength:100})}),(0,a.jsx)(o.Z.Item,{name:"display_name",label:"ชื่อที่แสดง (ภาษาไทย) *",rules:[{required:!0,message:"กรุณากรอกชื่อที่แสดง"},{max:100,message:"ความยาวต้องไม่เกิน 100 ตัวอักษร"}],children:(0,a.jsx)(i.default,{size:"large",placeholder:"เช่น น้ำตาล, เกลือ, แป้ง",maxLength:100})}),(0,a.jsx)(o.Z.Item,{name:"unit_id",label:"หน่วยวัตถุดิบ *",rules:[{required:!0,message:"กรุณาเลือกหน่วยวัตถุดิบ"}],children:(0,a.jsx)(u.default,{size:"large",placeholder:"เลือกหน่วย",showSearch:!0,dropdownMatchSelectWidth:!0,getPopupContainer:e=>(null==e?void 0:e.parentElement)||document.body,optionFilterProp:"children",children:T.map(e=>(0,a.jsxs)(u.default.Option,{value:e.id,children:[e.display_name," (",e.unit_name,")"]},e.id))})}),(0,a.jsx)(o.Z.Item,{name:"img_url",label:"รูปภาพ URL",children:(0,a.jsx)(i.default,{size:"large",placeholder:"https://example.com/image.jpg"})}),(0,a.jsx)(j,{url:R,name:O}),(0,a.jsx)(o.Z.Item,{name:"description",label:"รายละเอียด",style:{marginTop:20},children:(0,a.jsx)(v,{rows:4,placeholder:"รายละเอียดเพิ่มเติม...",style:{borderRadius:12}})}),(0,a.jsx)(o.Z.Item,{name:"is_active",label:"สถานะการใช้งาน",valuePropName:"checked",children:(0,a.jsx)(p.Z,{checkedChildren:"ใช้งาน",unCheckedChildren:"ไม่ใช้งาน"})}),(0,a.jsx)(k,{isEdit:B,loading:y,onCancel:M})]})})})})]})}},25193:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var a=n(57437);n(2265);var r=n(38616),i=n(87530);function o(e){let{children:t,maxWidth:n=i.H.pageMaxWidth,style:o}=e,s=r.default.useBreakpoint().md?i.H.pagePaddingXDesktop:i.H.pagePaddingXMobile;return(0,a.jsx)("div",{style:{width:"100%",maxWidth:n,margin:"0 auto",padding:"".concat(i.H.pagePaddingY,"px ").concat(s,"px"),...o},children:t})}},20148:function(e,t,n){"use strict";n.d(t,{Z:function(){return u}});var a=n(57437);n(2265);var r=n(17588),i=n(2651),o=n(38616),s=n(10868),c=n(50742),l=n(39486),d=n(87530);function u(e){let{title:t,subtitle:n,icon:u,onBack:p,actions:g,style:f}=e,{token:h}=i.default.useToken(),m=o.default.useBreakpoint().md?d.H.pagePaddingXDesktop:d.H.pagePaddingXMobile;return(0,a.jsx)("div",{style:{padding:"".concat(d.H.pagePaddingY,"px ").concat(m,"px"),background:h.colorBgContainer,borderBottom:"1px solid ".concat(h.colorBorderSecondary),...f},children:(0,a.jsxs)(s.Z,{align:"center",justify:"space-between",wrap:"wrap",gap:12,style:{maxWidth:d.H.pageMaxWidth,margin:"0 auto"},children:[(0,a.jsxs)(s.Z,{align:"center",gap:12,style:{minWidth:0},children:[p&&(0,a.jsx)(c.ZP,{type:"text","aria-label":"ย้อนกลับ",icon:(0,a.jsx)(r.Z,{}),onClick:p,style:{borderRadius:12,width:44,height:44}}),u&&(0,a.jsx)("div",{style:{width:44,height:44,borderRadius:14,display:"grid",placeItems:"center",background:h.colorFillTertiary,color:h.colorText},children:u}),(0,a.jsxs)("div",{style:{minWidth:0},children:[(0,a.jsx)(l.default.Title,{level:4,style:{margin:0},children:t}),n&&(0,a.jsx)(l.default.Text,{type:"secondary",children:n})]})]}),g&&(0,a.jsx)(s.Z,{gap:8,wrap:"wrap",children:g})]})})}},37410:function(e,t,n){"use strict";n.d(t,{Z:function(){return l}});var a=n(57437);n(2265);var r=n(2651),i=n(96931),o=n(10868),s=n(39486),c=n(87530);function l(e){let{title:t,extra:n,children:l,style:d}=e,{token:u}=r.default.useToken();return(0,a.jsx)(i.Z,{size:"small",variant:"outlined",style:{borderRadius:c.H.cardRadiusLG,...d},styles:{header:t?{borderBottomColor:u.colorBorderSecondary}:{display:"none"}},title:t?(0,a.jsxs)(o.Z,{align:"center",justify:"space-between",gap:12,children:[(0,a.jsx)(s.default.Text,{strong:!0,children:t}),n]}):void 0,children:l})}},87530:function(e,t,n){"use strict";n.d(t,{H:function(){return a}});let a={pageMaxWidth:1200,pagePaddingXMobile:16,pagePaddingXDesktop:24,pagePaddingY:16,sectionGap:16,cardRadius:16,cardRadiusLG:20,cardShadow:"0 10px 24px rgba(15, 23, 42, 0.08)",surfaceBg:"#ffffff",surfaceBorder:"#e2e8f0"}},71567:function(e,t,n){"use strict";n.d(t,{q:function(){return r},v:function(){return a}});let a="/api",r={AUTH:{LOGIN:"/auth/login",LOGOUT:"/auth/logout",ME:"/auth/me",CSRF:"/csrf",SWITCH_BRANCH:"/auth/switch-branch"},AUDIT:{LOGS:"/audit/logs"},POS:{PRODUCTS:"/pos/products",ORDERS:"/pos/orders",TABLES:"/pos/tables",DISCOUNTS:"/pos/discounts",DELIVERY:"/pos/delivery",PAYMENT_METHODS:"/pos/paymentMethod",PAYMENTS:"/pos/payments",CATEGORY:"/pos/category",SHIFTS:{BASE:"/pos/shifts",CURRENT:"/pos/shifts/current",OPEN:"/pos/shifts/open",CLOSE:"/pos/shifts/close"},DASHBOARD:{SALES:"/pos/dashboard/sales",TOP_ITEMS:"/pos/dashboard/top-items"},CHANNELS:{STATS:"/pos/orders/stats"},SHOP_PROFILE:"/pos/shopProfile",SALES_ORDER_ITEMS:"/pos/salesOrderItem",SALES_ORDER_DETAILS:"/pos/salesOrderDetail",PRODUCTS_UNIT:"/pos/productsUnit",PAYMENT_DETAILS:"/pos/paymentDetails",BRANCH:"/branches",ORDER_QUEUE:"/pos/queue"}}},2913:function(e,t,n){"use strict";function a(e,t){return({GET:"".concat(r.API_BASE_URL).concat(t),POST:"".concat(r.API_BASE_URL).concat(t),PUT:"".concat(r.API_BASE_URL).concat(t),DELETE:"".concat(r.API_BASE_URL).concat(t),PATCH:"".concat(r.API_BASE_URL).concat(t)})[e]}n.d(t,{b:function(){return a}});let r={get API_BASE_URL(){return"/api"}}},5447:function(e,t,n){"use strict";n.d(t,{O:function(){return o}});var a=n(71567),r=n(2913),i=n(98170);let o={login:async(e,t,n)=>{try{let s=(0,r.b)("POST",a.q.AUTH.LOGIN),c={"Content-Type":"application/json"};t&&(c["X-CSRF-Token"]=t),n&&(c.Cookie=n);let l=await fetch(s,{method:"POST",headers:c,credentials:"include",body:JSON.stringify(e)});if(!l.ok){var o;let e=await l.json().catch(()=>({})),t=(null==e?void 0:null===(o=e.error)||void 0===o?void 0:o.message)||e.message||e.detail||"Login failed";throw Error(t)}let d=(0,i.hH)(await l.json());return{...d.user,token:d.token}}catch(e){throw Error(e.message||"เข้าสู่ระบบไม่สำเร็จ")}},logout:async(e,t,n)=>{try{let i=(0,r.b)("POST",a.q.AUTH.LOGOUT),o={"Content-Type":"application/json"};e&&(o.Authorization="Bearer ".concat(e)),t&&(o["X-CSRF-Token"]=t),n&&(o.Cookie=n),await fetch(i,{method:"POST",headers:o,credentials:"include"})}catch(e){console.error("Logout failed",e)}},switchBranch:async(e,t,n)=>{let o=(0,r.b)("POST",a.q.AUTH.SWITCH_BRANCH),s={"Content-Type":"application/json"};t&&(s["X-CSRF-Token"]=t),n&&(s.Cookie=n);let c=await fetch(o,{method:"POST",headers:s,credentials:"include",body:JSON.stringify({branch_id:e})});if(!c.ok){let e=await c.json().catch(()=>({}));throw Error((0,i.i_)(e,"Failed to switch branch"))}return(0,i.hH)(await c.json())},getMe:async e=>{try{let t=(0,r.b)("GET",a.q.AUTH.ME),n={"Content-Type":"application/json"};e&&(n.Authorization="Bearer ".concat(e));let o=await fetch(t,{method:"GET",headers:n,credentials:"include",cache:"no-store"});if(!o.ok)throw Error("Unauthorized");return(0,i.hH)(await o.json())}catch(e){throw e}},async getCsrfToken(){try{let e=await fetch("".concat(a.v).concat(a.q.AUTH.CSRF),{credentials:"include"});if(!e.ok){let t=await e.json().catch(()=>({}));return console.error("CSRF token fetch failed:",e.status,t),""}let t=await e.json();if(t.success&&t.csrfToken||t.csrfToken)return t.csrfToken;return""}catch(e){return console.error("Failed to fetch CSRF token",e),""}}}},98170:function(e,t,n){"use strict";function a(e){return!!e&&"object"==typeof e}function r(e){return e&&"object"==typeof e&&"success"in e&&!0===e.success&&"data"in e?e.data:e}function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Request failed";if("string"==typeof e)return e;if(!a(e))return t;if(!1===e.success){let t=e.error;if(a(t)&&"string"==typeof t.message&&t.message.trim())return t.message}if("error"in e){let t=e.error;if("string"==typeof t&&t.trim())return t;if(a(t)&&"string"==typeof t.message&&t.message.trim())return t.message}return"string"==typeof e.message&&e.message.trim()?e.message:t}function o(e){if(e&&"object"==typeof e&&"success"in e&&!0===e.success&&Array.isArray(e.data)){var t,n,a,r;let i="number"==typeof(null===(t=e.meta)||void 0===t?void 0:t.total)?e.meta.total:e.data.length,o="number"==typeof(null===(n=e.meta)||void 0===n?void 0:n.page)?e.meta.page:1,s="number"==typeof(null===(a=e.meta)||void 0===a?void 0:a.limit)?e.meta.limit:50,c="number"==typeof(null===(r=e.meta)||void 0===r?void 0:r.totalPages)?e.meta.totalPages:Math.max(Math.ceil(i/Math.max(s,1)),1);return{data:e.data,total:i,page:o,last_page:c}}return e}n.d(t,{XO:function(){return o},hH:function(){return r},i_:function(){return i}})}},function(e){e.O(0,[253,1522,3418,742,9486,4252,3916,8651,6931,4159,3831,2224,3248,8879,8589,3834,9878,1652,6616,2971,2117,1744],function(){return e(e.s=29769)}),_N_E=e.O()}]);