(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3291],{84638:function(e,t,n){Promise.resolve().then(n.bind(n,61541))},51646:function(e,t,n){"use strict";n.d(t,{N:function(){return r}});var i=n(2265);let r=()=>i.useReducer(e=>e+1,0)},6543:function(e,t,n){"use strict";n.d(t,{c4:function(){return s},m9:function(){return l}});var i=n(2265),r=n(84560);let s=["xxl","xl","lg","md","sm","xs"],a=e=>({xs:"(max-width: ".concat(e.screenXSMax,"px)"),sm:"(min-width: ".concat(e.screenSM,"px)"),md:"(min-width: ".concat(e.screenMD,"px)"),lg:"(min-width: ".concat(e.screenLG,"px)"),xl:"(min-width: ".concat(e.screenXL,"px)"),xxl:"(min-width: ".concat(e.screenXXL,"px)")}),o=e=>{let t=[].concat(s).reverse();return t.forEach((n,i)=>{let r=n.toUpperCase(),s="screen".concat(r,"Min"),a="screen".concat(r);if(!(e[s]<=e[a]))throw Error("".concat(s,"<=").concat(a," fails : !(").concat(e[s],"<=").concat(e[a],")"));if(i<t.length-1){let n="screen".concat(r,"Max");if(!(e[a]<=e[n]))throw Error("".concat(a,"<=").concat(n," fails : !(").concat(e[a],"<=").concat(e[n],")"));let s=t[i+1].toUpperCase(),o="screen".concat(s,"Min");if(!(e[n]<=e[o]))throw Error("".concat(n,"<=").concat(o," fails : !(").concat(e[n],"<=").concat(e[o],")"))}}),e},l=(e,t)=>{if(t){for(let n of s)if(e[n]&&(null==t?void 0:t[n])!==void 0)return t[n]}};t.ZP=()=>{let[,e]=(0,r.ZP)(),t=a(o(e));return i.useMemo(()=>{let e=new Map,n=-1,i={};return{responsiveMap:t,matchHandlers:{},dispatch:t=>(i=t,e.forEach(e=>e(i)),e.size>=1),subscribe(t){return e.size||this.register(),n+=1,e.set(n,t),t(i),n},unsubscribe(t){e.delete(t),e.size||this.unregister()},register(){Object.entries(t).forEach(e=>{let[t,n]=e,r=e=>{let{matches:n}=e;this.dispatch({...i,[t]:n})},s=window.matchMedia(n);"function"==typeof(null==s?void 0:s.addEventListener)&&s.addEventListener("change",r),this.matchHandlers[n]={mql:s,listener:r},r(s)})},unregister(){Object.values(t).forEach(e=>{var t;let n=this.matchHandlers[e];"function"==typeof(null==n?void 0:null===(t=n.mql)||void 0===t?void 0:t.removeEventListener)&&n.mql.removeEventListener("change",null==n?void 0:n.listener)}),e.clear()}}},[t])}},28617:function(e,t,n){"use strict";var i=n(2265),r=n(90891),s=n(51646),a=n(6543);t.Z=function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=(0,i.useRef)(t),[,o]=(0,s.N)(),l=(0,a.ZP)();return(0,r.Z)(()=>{let t=l.subscribe(t=>{n.current=t,e&&o()});return()=>l.unsubscribe(t)},[]),n.current}},61541:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return D}});var i=n(57437),r=n(2265),s=n(82646),a=n(34029),o=n(53743),l=n(48651),d=n(41169),c=n(99376),f=n(3369),h=n(26972),x=n(24675),g=n(14362),p=n(50742),u=n(91652),y=n(80009),b=n(85180),m=n(89245),j=n(96473),v=n(8900),k=n(39725),w=n(13377),C=n(26349);let{Text:S,Title:E}=s.default,Z={container:{paddingBottom:100,backgroundColor:"#f8f9fc",minHeight:"100vh"},header:{background:"linear-gradient(135deg, #1890ff 0%, #096dd9 100%)",padding:"20px 20px 60px 20px",position:"relative",overflow:"hidden"},headerDecoCircle1:{position:"absolute",top:-50,right:-50,width:150,height:150,borderRadius:"50%",background:"rgba(255,255,255,0.1)"},headerDecoCircle2:{position:"absolute",bottom:-30,left:-30,width:100,height:100,borderRadius:"50%",background:"rgba(255,255,255,0.08)"},headerContent:{position:"relative",zIndex:1,display:"flex",alignItems:"center",justifyContent:"space-between"},headerLeft:{display:"flex",alignItems:"center",gap:12},headerIconBox:{width:48,height:48,borderRadius:14,background:"rgba(255,255,255,0.2)",display:"flex",alignItems:"center",justifyContent:"center",backdropFilter:"blur(8px)"},headerActions:{display:"flex",gap:8},statsCard:{margin:"-40px 16px 0 16px",padding:"16px",background:"white",borderRadius:20,boxShadow:"0 8px 24px rgba(0,0,0,0.08)",display:"flex",justifyContent:"space-around",position:"relative",zIndex:10},statItem:{textAlign:"center",flex:1},statNumber:{fontSize:24,fontWeight:700,display:"block"},statLabel:{fontSize:12,color:"#8c8c8c",marginTop:2},listContainer:{padding:"20px 16px 0 16px"},sectionTitle:{display:"flex",alignItems:"center",gap:8,marginBottom:16},ingredientCard:e=>({marginBottom:12,borderRadius:20,border:"none",boxShadow:"0 2px 8px rgba(0,0,0,0.04)",overflow:"hidden",transition:"all 0.3s ease",background:e?"white":"linear-gradient(to right, #fafafa, white)",opacity:e?1:.7}),ingredientCardInner:{padding:16,display:"flex",alignItems:"center",gap:14}},I=()=>(0,i.jsx)("style",{children:"\n        @keyframes fadeSlideIn {\n            from {\n                opacity: 0;\n                transform: translateY(12px);\n            }\n            to {\n                opacity: 1;\n                transform: translateY(0);\n            }\n        }\n        \n        .ingredient-card {\n            animation: fadeSlideIn 0.4s ease both;\n        }\n        \n        .ingredient-card:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 8px 24px rgba(0,0,0,0.1) !important;\n        }\n        \n        .ingredient-card:active {\n            transform: scale(0.98);\n        }\n        \n        /* Custom scrollbar */\n        .ingredients-page *::-webkit-scrollbar {\n            width: 6px;\n        }\n        .ingredients-page *::-webkit-scrollbar-track {\n            background: transparent;\n        }\n        .ingredients-page *::-webkit-scrollbar-thumb {\n            background: #d9d9d9;\n            border-radius: 3px;\n        }\n        .ingredients-page *::-webkit-scrollbar-thumb:hover {\n            background: #bfbfbf;\n        }\n    "}),z=e=>{let{onRefresh:t,onAdd:n}=e;return(0,i.jsxs)("div",{style:Z.header,children:[(0,i.jsx)("div",{style:Z.headerDecoCircle1}),(0,i.jsx)("div",{style:Z.headerDecoCircle2}),(0,i.jsxs)("div",{style:Z.headerContent,children:[(0,i.jsxs)("div",{style:Z.headerLeft,children:[(0,i.jsx)("div",{style:Z.headerIconBox,children:(0,i.jsx)(d.Z,{style:{fontSize:24,color:"white"}})}),(0,i.jsxs)("div",{children:[(0,i.jsx)(S,{style:{color:"rgba(255,255,255,0.85)",fontSize:13,display:"block"},children:"จัดการข้อมูล"}),(0,i.jsx)(E,{level:4,style:{color:"white",margin:0,fontWeight:700,letterSpacing:"0.5px"},children:"วัตถุดิบ"})]})]}),(0,i.jsxs)("div",{style:Z.headerActions,children:[(0,i.jsx)(p.ZP,{type:"text",icon:(0,i.jsx)(m.Z,{style:{color:"white"}}),onClick:t,style:{background:"rgba(255,255,255,0.2)",borderRadius:12,height:40,width:40}}),(0,i.jsx)(p.ZP,{type:"primary",icon:(0,i.jsx)(j.Z,{}),onClick:n,style:{background:"white",color:"#1890ff",borderRadius:12,height:40,fontWeight:600,border:"none",boxShadow:"0 4px 12px rgba(0,0,0,0.15)"},children:"เพิ่มวัตถุดิบ"})]})]})]})},R=e=>{let{totalIngredients:t,activeIngredients:n,inactiveIngredients:r}=e;return(0,i.jsxs)("div",{style:Z.statsCard,children:[(0,i.jsxs)("div",{style:Z.statItem,children:[(0,i.jsx)("span",{style:{...Z.statNumber,color:"#1890ff"},children:t}),(0,i.jsx)(S,{style:Z.statLabel,children:"ทั้งหมด"})]}),(0,i.jsx)("div",{style:{width:1,background:"#f0f0f0"}}),(0,i.jsxs)("div",{style:Z.statItem,children:[(0,i.jsx)("span",{style:{...Z.statNumber,color:"#52c41a"},children:n}),(0,i.jsx)(S,{style:Z.statLabel,children:"ใช้งาน"})]}),(0,i.jsx)("div",{style:{width:1,background:"#f0f0f0"}}),(0,i.jsxs)("div",{style:Z.statItem,children:[(0,i.jsx)("span",{style:{...Z.statNumber,color:"#ff4d4f"},children:r}),(0,i.jsx)(S,{style:Z.statLabel,children:"ไม่ใช้งาน"})]})]})},_=e=>{var t;let{ingredient:n,index:r,onEdit:s,onDelete:a}=e;return(0,i.jsx)("div",{className:"ingredient-card",style:{...Z.ingredientCard(n.is_active),animationDelay:"".concat(.03*r,"s")},children:(0,i.jsxs)("div",{style:Z.ingredientCardInner,children:[(0,i.jsx)(u.Z,{src:n.img_url||"https://placehold.co/64x64/f5f5f5/999999?text=\uD83D\uDCE6",size:64,shape:"square",style:{borderRadius:14,border:"2px solid #f0f0f0",boxShadow:"0 4px 12px rgba(0,0,0,0.06)",flexShrink:0}}),(0,i.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4},children:[(0,i.jsx)(S,{strong:!0,style:{fontSize:16,color:"#1a1a2e"},ellipsis:{tooltip:n.display_name},children:n.display_name}),n.is_active?(0,i.jsx)(v.Z,{style:{color:"#52c41a",fontSize:14}}):(0,i.jsx)(k.Z,{style:{color:"#ff4d4f",fontSize:14}})]}),(0,i.jsx)(S,{type:"secondary",style:{fontSize:13,display:"block",marginBottom:6},ellipsis:{tooltip:n.ingredient_name},children:n.ingredient_name}),(0,i.jsxs)("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:[(0,i.jsx)(y.Z,{color:"blue",style:{borderRadius:8,margin:0,fontSize:11},children:(null===(t=n.unit)||void 0===t?void 0:t.display_name)||"-"}),n.description&&(0,i.jsx)(y.Z,{style:{borderRadius:8,margin:0,fontSize:11,background:"#f5f5f5",border:"none",color:"#666"},children:n.description.length>20?n.description.substring(0,20)+"...":n.description})]})]}),(0,i.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,i.jsx)(p.ZP,{type:"text",icon:(0,i.jsx)(w.Z,{}),onClick:e=>{e.stopPropagation(),s(n)},style:{borderRadius:10,color:"#1890ff",background:"#e6f7ff"}}),(0,i.jsx)(p.ZP,{type:"text",danger:!0,icon:(0,i.jsx)(C.Z,{}),onClick:e=>{e.stopPropagation(),a(n)},style:{borderRadius:10,background:"#fff2f0"}})]})]})})},L=e=>{let{onAdd:t}=e;return(0,i.jsx)(b.Z,{image:b.Z.PRESENTED_IMAGE_SIMPLE,description:(0,i.jsxs)("div",{style:{textAlign:"center"},children:[(0,i.jsx)(S,{type:"secondary",style:{fontSize:15},children:"ยังไม่มีวัตถุดิบ"}),(0,i.jsx)("br",{}),(0,i.jsx)(S,{type:"secondary",style:{fontSize:13},children:"เริ่มต้นเพิ่มวัตถุดิบแรกของคุณ"})]}),style:{padding:"60px 20px",background:"white",borderRadius:20,margin:"0 16px"},children:(0,i.jsx)(p.ZP,{type:"primary",icon:(0,i.jsx)(j.Z,{}),onClick:t,children:"เพิ่มวัตถุดิบ"})})};var P=n(5447);let{Text:T}=s.default;function D(){let e=(0,c.useRouter)(),{user:t,loading:n}=(0,g.a)(),[s,p]=(0,r.useState)([]),{execute:u}=(0,h.J)(),{showLoading:y,hideLoading:b}=(0,f.x)(),{socket:m}=(0,x.s)(),[j,v]=(0,r.useState)(""),[k,w]=(0,r.useState)(null);(0,r.useEffect)(()=>{(async()=>{v(await P.O.getCsrfToken())})()},[]);let C=(0,r.useCallback)(async()=>{u(async()=>{let e=await fetch("/api/stock/ingredients");if(!e.ok){let t=await e.json().catch(()=>({}));throw Error(t.error||t.message||"ไม่สามารถดึงข้อมูลวัตถุดิบได้")}p(await e.json())},"กำลังโหลดข้อมูลวัตถุดิบ...")},[u]);(0,r.useEffect)(()=>{n||(t?"Admin"!==t.role?(w(!1),a.ZP.error("คุณไม่มีสิทธิ์เข้าถึงหน้านี้"),setTimeout(()=>{e.replace("/stock/items")},1e3)):(w(!0),C()):(w(!1),setTimeout(()=>{e.replace("/login")},1e3)))},[t,n,e,C]),(0,r.useEffect)(()=>{C()},[C]),(0,r.useEffect)(()=>{if(m)return m.on("ingredients:create",e=>{p(t=>[...t,e])}),m.on("ingredients:update",e=>{p(t=>t.map(t=>t.id===e.id?e:t))}),m.on("ingredients:delete",e=>{let{id:t}=e;p(e=>e.filter(e=>e.id!==t))}),()=>{m.off("ingredients:create"),m.off("ingredients:update"),m.off("ingredients:delete")}},[m]);let S=()=>{y(),e.push("/stock/ingredients/manage/add"),setTimeout(()=>b(),1e3)},E=t=>{y(),e.push("/stock/ingredients/manage/edit/".concat(t.id)),setTimeout(()=>b(),1e3)},D=e=>{o.Z.confirm({title:"ยืนยันการลบวัตถุดิบ",content:'คุณต้องการลบวัตถุดิบ "'.concat(e.display_name,'" หรือไม่?'),okText:"ลบ",okType:"danger",cancelText:"ยกเลิก",centered:!0,onOk:async()=>{await u(async()=>{if(!(await fetch("/api/stock/ingredients/delete/".concat(e.id),{method:"DELETE",headers:{"X-CSRF-Token":j}})).ok)throw Error("ไม่สามารถลบวัตถุดิบได้");a.ZP.success('ลบวัตถุดิบ "'.concat(e.display_name,'" สำเร็จ'))},"กำลังลบวัตถุดิบ...")}})};if(n||null===k)return(0,i.jsxs)("div",{style:{display:"flex",height:"100vh",justifyContent:"center",alignItems:"center",flexDirection:"column",gap:16},children:[(0,i.jsx)(l.Z,{size:"large"}),(0,i.jsx)(T,{type:"secondary",children:"กำลังตรวจสอบสิทธิ์การใช้งาน..."})]});if(!1===k)return(0,i.jsxs)("div",{style:{display:"flex",height:"100vh",justifyContent:"center",alignItems:"center",flexDirection:"column",gap:16},children:[(0,i.jsx)(l.Z,{size:"large"}),(0,i.jsx)(T,{type:"danger",children:"คุณไม่มีสิทธิ์เข้าถึงหน้านี้ กำลังพากลับหน้าแรก..."})]});let N=s.filter(e=>e.is_active),M=s.filter(e=>!e.is_active);return(0,i.jsxs)("div",{className:"ingredients-page",style:Z.container,children:[(0,i.jsx)(I,{}),(0,i.jsx)(z,{onRefresh:C,onAdd:S}),(0,i.jsx)(R,{totalIngredients:s.length,activeIngredients:N.length,inactiveIngredients:M.length}),(0,i.jsx)("div",{style:Z.listContainer,children:s.length>0?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{style:Z.sectionTitle,children:[(0,i.jsx)(d.Z,{style:{fontSize:18,color:"#1890ff"}}),(0,i.jsx)("span",{style:{fontSize:16,fontWeight:600,color:"#1a1a2e"},children:"รายการวัตถุดิบ"}),(0,i.jsxs)("div",{style:{background:"linear-gradient(135deg, #1890ff 0%, #096dd9 100%)",color:"white",padding:"4px 12px",borderRadius:20,fontSize:12,fontWeight:600},children:[s.length," รายการ"]})]}),s.map((e,t)=>(0,i.jsx)(_,{ingredient:e,index:t,onEdit:E,onDelete:D},e.id))]}):(0,i.jsx)(L,{onAdd:S})})]})}}},function(e){e.O(0,[5015,7717,7698,742,3211,7993,8651,2646,6207,7213,9021,2224,3248,1721,9,1652,4261,2456,2971,2117,1744],function(){return e(e.s=84638)}),_N_E=e.O()}]);