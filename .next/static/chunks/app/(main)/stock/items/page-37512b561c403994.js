(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4777],{95365:function(e,t,r){Promise.resolve().then(r.bind(r,76666))},76666:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return er}});var n=r(57437),i=r(2265),a=r(82646),o=r(34029),s=r(53743),d=r(24783),l=r(91652),c=r(89970),u=r(80009),f=r(50742),g=r(50337),p=r(47451),x=r(69410),h=r(96931),b=r(45235),y=r(35713),m=r(2297),j=r(85180),v=r(81770),k=r(15883),w=r(46783),S=r(5540),C=r(49634),_=r(6520),E=r(40312),Z=r(13377),z=r(89245),T=r(12609),I=r(33477),P=r(93834),R=r(45246),D=r(52539),N=r(96473),O=r(29436),A=r(49638),L=r(78355),F=r(2913);let B={findAll:async(e,t)=>{let r=(0,F.b)("GET","/stock/ingredients");t&&(r+="?".concat(t.toString()));let n={};e&&(n.Cookie=e);let i=await fetch(r,{cache:"no-store",credentials:"include",headers:n});if(!i.ok){let e=await i.json().catch(()=>({}));throw Error(e.error||e.message||"Failed to fetch ingredients")}return i.json()}};var W=r(76155),U=r(24675),G=r(5447);let{Text:M,Title:q}=a.default,H=e=>{let{item:t,index:r,onUpdateQuantity:i,onRemove:a}=e;return(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:14,padding:14,background:"#fafafa",borderRadius:14,marginBottom:10,border:"1px solid #f0f0f0",transition:"all 0.3s ease",animation:"slideIn 0.3s ease ".concat(.05*r,"s both")},className:"editable-item-card",children:[(0,n.jsx)(y.Z,{count:r+1,color:"#667eea",size:"small",children:(0,n.jsx)(l.Z,{src:t.img_url||"https://placehold.co/56x56/f5f5f5/999999?text=\uD83D\uDCE6",shape:"square",size:56,style:{borderRadius:12,border:"2px solid #fff",boxShadow:"0 4px 12px rgba(0,0,0,0.08)",objectFit:"cover"}})}),(0,n.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,n.jsx)(M,{strong:!0,style:{fontSize:14,display:"block",marginBottom:2,color:"#1a1a2e"},ellipsis:{tooltip:t.display_name},children:t.display_name}),(0,n.jsxs)(M,{type:"secondary",style:{fontSize:12},children:["หน่วย: ",t.unit_name]})]}),(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,n.jsx)(I.Z,{min:1,value:t.quantity_ordered,onChange:e=>i(t.ingredient_id,e),style:{width:80,borderRadius:10},size:"middle"}),(0,n.jsx)(c.Z,{title:"ลบรายการ",children:(0,n.jsx)(f.ZP,{danger:!0,type:"text",icon:(0,n.jsx)(R.Z,{style:{fontSize:18}}),onClick:()=>a(t.ingredient_id),style:{width:36,height:36,borderRadius:10,display:"flex",alignItems:"center",justifyContent:"center"}})})]})]})};function J(e){let{order:t,open:r,onClose:a,onSuccess:d}=e,[l,c]=(0,i.useState)(!1),[u,g]=(0,i.useState)([]),[p,x]=(0,i.useState)([]),[h,b]=(0,i.useState)(null),{socket:y}=(0,U.s)();(0,i.useEffect)(()=>{if(!y||!t||!r)return;let e=e=>{let{action:r,data:n}=e;if(n&&n.id===t.id){if("update_order"===r||"update_item_detail"===r){var i;o.ZP.info("ข้อมูลออเดอร์มีการเปลี่ยนแปลงจากระบบ"),x((null===(i=n.ordersItems)||void 0===i?void 0:i.map(e=>{var t,r,n,i;return{ingredient_id:e.ingredient_id,quantity_ordered:e.quantity_ordered,display_name:(null===(t=e.ingredient)||void 0===t?void 0:t.display_name)||"Unknown",unit_name:(null===(n=e.ingredient)||void 0===n?void 0:null===(r=n.unit)||void 0===r?void 0:r.display_name)||"-",img_url:(null===(i=e.ingredient)||void 0===i?void 0:i.img_url)||void 0}}))||[])}else"update_status"===r&&n.status!==T.i.PENDING&&(o.ZP.warning("สถานะออเดอร์เปลี่ยนเป็น ".concat(n.status," ปิดการแก้ไข")),a())}};return y.on("orders_updated",e),()=>{y.off("orders_updated",e)}},[y,t,r,a]),(0,i.useEffect)(()=>{(async()=>{try{let e=(await B.findAll()).filter(e=>e.is_active);g(e),x(t=>t.map(t=>{let r=e.find(e=>e.id===t.ingredient_id);return{...t,img_url:t.img_url||(null==r?void 0:r.img_url)}}))}catch(e){console.error("Failed to load ingredients")}})()},[r]),(0,i.useEffect)(()=>{if(t&&r){var e;x((null===(e=t.ordersItems)||void 0===e?void 0:e.map(e=>{var t,r,n,i;return{ingredient_id:e.ingredient_id,quantity_ordered:e.quantity_ordered,display_name:(null===(t=e.ingredient)||void 0===t?void 0:t.display_name)||"Unknown",unit_name:(null===(n=e.ingredient)||void 0===n?void 0:null===(r=n.unit)||void 0===r?void 0:r.display_name)||"-",img_url:(null===(i=e.ingredient)||void 0===i?void 0:i.img_url)||void 0}}))||[])}},[t,r]);let m=e=>{x(p.filter(t=>t.ingredient_id!==e))},v=(e,t)=>{null!==t&&x(p.map(r=>r.ingredient_id===e?{...r,quantity_ordered:t}:r))},[k,w]=(0,i.useState)("");(0,i.useEffect)(()=>{(async()=>{w(await G.O.getCsrfToken())})()},[]);let S=async()=>{if(t){if(0===p.length){o.ZP.error("ออเดอร์ต้องมีสินค้าอย่างน้อย 1 ชิ้น");return}c(!0);try{let e=p.map(e=>({ingredient_id:e.ingredient_id,quantity_ordered:e.quantity_ordered}));await W.x.updateOrder(t.id,e,void 0,k),o.ZP.success("แก้ไขออเดอร์สำเร็จ"),d(),a()}catch(t){let e="แก้ไขออเดอร์ล้มเหลว";t instanceof Error&&(e=t.message),o.ZP.error(e)}finally{c(!1)}}},C=u.filter(e=>!p.some(t=>t.ingredient_id===e.id));return(0,n.jsxs)(s.Z,{open:r,onCancel:a,footer:null,width:560,centered:!0,className:"edit-order-modal",style:{top:20},styles:{body:{padding:0},mask:{backdropFilter:"blur(8px)",background:"rgba(0, 0, 0, 0.45)"}},closeIcon:null,children:[(0,n.jsxs)("div",{style:{background:"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)",padding:"24px 24px 20px",position:"relative",overflow:"hidden"},children:[(0,n.jsx)("div",{style:{position:"absolute",top:-50,right:-50,width:150,height:150,borderRadius:"50%",background:"rgba(255,255,255,0.1)"}}),(0,n.jsx)("div",{style:{position:"absolute",bottom:-30,left:-30,width:100,height:100,borderRadius:"50%",background:"rgba(255,255,255,0.08)"}}),(0,n.jsxs)("div",{style:{position:"relative",zIndex:1},children:[(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12},children:[(0,n.jsx)("div",{style:{width:48,height:48,borderRadius:14,background:"rgba(255,255,255,0.2)",display:"flex",alignItems:"center",justifyContent:"center",backdropFilter:"blur(8px)"},children:(0,n.jsx)(Z.Z,{style:{fontSize:24,color:"white"}})}),(0,n.jsxs)("div",{children:[(0,n.jsx)(M,{style:{color:"rgba(255,255,255,0.8)",fontSize:13,display:"block"},children:"แก้ไขออเดอร์"}),(0,n.jsxs)(q,{level:4,style:{color:"white",margin:0,fontWeight:700,letterSpacing:"0.5px"},children:["#",null==t?void 0:t.id.substring(0,8).toUpperCase()]})]})]}),(0,n.jsx)("div",{style:{marginTop:16,display:"flex",alignItems:"center",gap:8},children:(0,n.jsxs)("div",{style:{background:"rgba(255,255,255,0.2)",borderRadius:20,padding:"6px 14px",display:"flex",alignItems:"center",gap:6,backdropFilter:"blur(4px)"},children:[(0,n.jsx)(D.Z,{style:{color:"white",fontSize:14}}),(0,n.jsxs)(M,{style:{color:"white",fontWeight:600,fontSize:13},children:[p.length," รายการ"]})]})})]})]}),(0,n.jsxs)("div",{style:{padding:"20px 24px 24px"},children:[(0,n.jsxs)("div",{style:{background:"linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%)",borderRadius:16,padding:16,marginBottom:20},children:[(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:12},children:[(0,n.jsx)(N.Z,{style:{fontSize:16,color:"#d4380d"}}),(0,n.jsx)(M,{strong:!0,style:{fontSize:14,color:"#d4380d"},children:"เพิ่มสินค้าใหม่"})]}),(0,n.jsxs)("div",{style:{display:"flex",gap:10},children:[(0,n.jsx)(P.default,{style:{flex:1},placeholder:"ค้นหาและเลือกสินค้า...",showSearch:!0,allowClear:!0,value:h,onChange:b,suffixIcon:(0,n.jsx)(O.Z,{style:{color:"#d4380d"}}),filterOption:(e,t)=>{var r;return(null!==(r=null==t?void 0:t.searchText)&&void 0!==r?r:"").toLowerCase().includes(e.toLowerCase())},notFoundContent:(0,n.jsx)(j.Z,{image:j.Z.PRESENTED_IMAGE_SIMPLE,description:"ไม่พบสินค้า",style:{padding:"12px 0"}}),options:C.map(e=>{var t;return{value:e.id,searchText:e.display_name,label:(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:10,padding:"4px 0"},children:[(0,n.jsx)("img",{src:e.img_url||"https://placehold.co/36x36?text=\uD83D\uDCE6",alt:e.display_name,style:{width:36,height:36,objectFit:"cover",borderRadius:8,border:"1px solid #f0f0f0"}}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{style:{fontWeight:500,fontSize:13},children:e.display_name}),(0,n.jsx)("div",{style:{fontSize:11,color:"#8c8c8c"},children:(null===(t=e.unit)||void 0===t?void 0:t.display_name)||"-"})]})]})}}),styles:{popup:{root:{borderRadius:12}}}}),(0,n.jsx)(f.ZP,{type:"primary",icon:(0,n.jsx)(N.Z,{}),onClick:()=>{var e;if(!h)return;let t=u.find(e=>e.id===h);if(t){if(p.find(e=>e.ingredient_id===h)){o.ZP.warning("สินค้านี้มีอยู่ในรายการแล้ว");return}x([...p,{ingredient_id:t.id,quantity_ordered:1,display_name:t.display_name,unit_name:(null===(e=t.unit)||void 0===e?void 0:e.display_name)||"-",img_url:t.img_url}]),b(null)}},disabled:!h,style:{height:40,borderRadius:10,background:h?"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)":void 0,border:"none",fontWeight:600,boxShadow:h?"0 4px 12px rgba(245, 87, 108, 0.35)":void 0},children:"เพิ่ม"})]})]}),(0,n.jsxs)("div",{style:{marginBottom:20},children:[(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:14},children:[(0,n.jsx)(D.Z,{style:{fontSize:16,color:"#667eea"}}),(0,n.jsx)(M,{strong:!0,style:{fontSize:15,color:"#1a1a2e"},children:"รายการสินค้าในออเดอร์"})]}),(0,n.jsx)("div",{style:{maxHeight:280,overflowY:"auto",paddingRight:4,scrollbarWidth:"thin",scrollbarColor:"#d9d9d9 transparent"},children:p.length>0?p.map((e,t)=>(0,n.jsx)(H,{item:e,index:t,onUpdateQuantity:v,onRemove:m},e.ingredient_id)):(0,n.jsx)(j.Z,{description:(0,n.jsxs)("div",{children:[(0,n.jsx)(M,{type:"secondary",children:"ยังไม่มีสินค้าในออเดอร์"}),(0,n.jsx)("br",{}),(0,n.jsx)(M,{type:"secondary",style:{fontSize:12},children:"เพิ่มสินค้าจากด้านบน"})]}),image:j.Z.PRESENTED_IMAGE_SIMPLE,style:{padding:"40px 0",background:"#fafafa",borderRadius:16}})})]}),(0,n.jsxs)("div",{style:{display:"flex",gap:12},children:[(0,n.jsx)(f.ZP,{block:!0,size:"large",onClick:a,icon:(0,n.jsx)(A.Z,{}),style:{height:48,borderRadius:12,fontWeight:600},children:"ยกเลิก"}),(0,n.jsx)(f.ZP,{type:"primary",block:!0,size:"large",onClick:S,loading:l,icon:(0,n.jsx)(L.Z,{}),disabled:0===p.length,style:{height:48,borderRadius:12,fontWeight:600,background:p.length>0?"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)":void 0,border:"none",boxShadow:p.length>0?"0 4px 16px rgba(245, 87, 108, 0.35)":void 0},children:"บันทึกการแก้ไข"})]})]}),(0,n.jsx)("style",{children:"\n                .edit-order-modal .ant-modal-content {\n                    border-radius: 24px !important;\n                    overflow: hidden;\n                    padding: 0 !important;\n                }\n                \n                @keyframes slideIn {\n                    from {\n                        opacity: 0;\n                        transform: translateY(10px);\n                    }\n                    to {\n                        opacity: 1;\n                        transform: translateY(0);\n                    }\n                }\n                \n                .editable-item-card:hover {\n                    background: #fff0f6 !important;\n                    border-color: #ffadd2 !important;\n                    transform: translateX(4px);\n                }\n                \n                .edit-order-modal .ant-select-selector {\n                    border-radius: 10px !important;\n                    height: 40px !important;\n                }\n                \n                .edit-order-modal .ant-select-selection-placeholder,\n                .edit-order-modal .ant-select-selection-item {\n                    line-height: 38px !important;\n                }\n                \n                .edit-order-modal .ant-input-number {\n                    border-radius: 10px !important;\n                }\n                \n                .edit-order-modal .ant-input-number-handler-wrap {\n                    border-radius: 0 10px 10px 0 !important;\n                }\n                \n                /* Custom scrollbar */\n                *::-webkit-scrollbar {\n                    width: 6px;\n                }\n                *::-webkit-scrollbar-track {\n                    background: transparent;\n                }\n                *::-webkit-scrollbar-thumb {\n                    background: #d9d9d9;\n                    border-radius: 3px;\n                }\n                *::-webkit-scrollbar-thumb:hover {\n                    background: #bfbfbf;\n                }\n            "})]})}var Y=r(57835),X=r(99376),Q=r(14362),K=r(29),V=r.n(K);function $(){return(0,n.jsx)(V(),{id:"8c68ddb7935f151e",children:".items-table .ant-table{background:transparent!important;-webkit-border-radius:16px;-moz-border-radius:16px;border-radius:16px;overflow:hidden}.items-table .ant-table-thead>tr>th{background:-webkit-linear-gradient(315deg,#667eea 0%,#764ba2 100%)!important;background:-moz-linear-gradient(315deg,#667eea 0%,#764ba2 100%)!important;background:-o-linear-gradient(315deg,#667eea 0%,#764ba2 100%)!important;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%)!important;color:#fff!important;font-weight:600;font-size:14px;padding:16px 12px;border:none!important}.items-table .ant-table-thead>tr>th::before{display:none!important}.items-table .ant-table-tbody>tr>td{padding:16px 12px;vertical-align:middle;border-bottom:1px solid rgba(0,0,0,.04);-webkit-transition:all.2s ease;-moz-transition:all.2s ease;-o-transition:all.2s ease;transition:all.2s ease}.items-table .ant-table-tbody>tr:hover>td{background:rgba(102,126,234,.04)!important}.items-table .ant-table-tbody>tr:last-child>td{border-bottom:none}.status-card{background:-webkit-linear-gradient(315deg,#fff 0%,#f8f9fe 100%);background:-moz-linear-gradient(315deg,#fff 0%,#f8f9fe 100%);background:-o-linear-gradient(315deg,#fff 0%,#f8f9fe 100%);background:linear-gradient(135deg,#fff 0%,#f8f9fe 100%);-webkit-border-radius:16px;-moz-border-radius:16px;border-radius:16px;border:1px solid rgba(102,126,234,.12);-webkit-box-shadow:0 4px 20px rgba(102,126,234,.08);-moz-box-shadow:0 4px 20px rgba(102,126,234,.08);box-shadow:0 4px 20px rgba(102,126,234,.08);-webkit-transition:all.3s ease;-moz-transition:all.3s ease;-o-transition:all.3s ease;transition:all.3s ease}.status-card:hover{-webkit-box-shadow:0 8px 32px rgba(102,126,234,.15);-moz-box-shadow:0 8px 32px rgba(102,126,234,.15);box-shadow:0 8px 32px rgba(102,126,234,.15);-webkit-transform:translatey(-2px);-moz-transform:translatey(-2px);-ms-transform:translatey(-2px);-o-transform:translatey(-2px);transform:translatey(-2px)}.empty-state-card{background:-webkit-linear-gradient(top,#f8f9fe 0%,#fff 100%);background:-moz-linear-gradient(top,#f8f9fe 0%,#fff 100%);background:-o-linear-gradient(top,#f8f9fe 0%,#fff 100%);background:linear-gradient(180deg,#f8f9fe 0%,#fff 100%);-webkit-border-radius:20px;-moz-border-radius:20px;border-radius:20px;border:2px dashed rgba(102,126,234,.2)}.action-btn{-webkit-border-radius:10px;-moz-border-radius:10px;border-radius:10px;font-weight:500;-webkit-transition:all.3s ease;-moz-transition:all.3s ease;-o-transition:all.3s ease;transition:all.3s ease}.action-btn:hover{-webkit-transform:translatey(-1px);-moz-transform:translatey(-1px);-ms-transform:translatey(-1px);-o-transform:translatey(-1px);transform:translatey(-1px);-webkit-box-shadow:0 4px 12px rgba(0,0,0,.1);-moz-box-shadow:0 4px 12px rgba(0,0,0,.1);box-shadow:0 4px 12px rgba(0,0,0,.1)}.order-item-badge{display:-webkit-inline-box;display:-webkit-inline-flex;display:-moz-inline-box;display:-ms-inline-flexbox;display:inline-flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;background:-webkit-linear-gradient(315deg,#f0f5ff 0%,#e8f0ff 100%);background:-moz-linear-gradient(315deg,#f0f5ff 0%,#e8f0ff 100%);background:-o-linear-gradient(315deg,#f0f5ff 0%,#e8f0ff 100%);background:linear-gradient(135deg,#f0f5ff 0%,#e8f0ff 100%);padding:6px 12px;-webkit-border-radius:20px;-moz-border-radius:20px;border-radius:20px;margin:3px 4px 3px 0;border:1px solid rgba(102,126,234,.15);font-size:13px;-webkit-transition:all.2s ease;-moz-transition:all.2s ease;-o-transition:all.2s ease;transition:all.2s ease}.order-item-badge:hover{background:-webkit-linear-gradient(315deg,#e8f0ff 0%,#d9e4ff 100%);background:-moz-linear-gradient(315deg,#e8f0ff 0%,#d9e4ff 100%);background:-o-linear-gradient(315deg,#e8f0ff 0%,#d9e4ff 100%);background:linear-gradient(135deg,#e8f0ff 0%,#d9e4ff 100%);border-color:rgba(102,126,234,.3)}@media screen and (max-width:768px){.items-table .ant-table-thead>tr>th{font-size:12px;padding:12px 8px}.items-table .ant-table-tbody>tr>td{font-size:13px;padding:12px 8px}.order-item-badge{font-size:12px;padding:4px 10px}}.items-table .ant-pagination{padding:16px 24px}.items-table .ant-pagination-item-active{background:-webkit-linear-gradient(315deg,#667eea 0%,#764ba2 100%);background:-moz-linear-gradient(315deg,#667eea 0%,#764ba2 100%);background:-o-linear-gradient(315deg,#667eea 0%,#764ba2 100%);background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);border-color:transparent}.items-table .ant-pagination-item-active a{color:#fff}"})}let{Title:ee,Text:et}=a.default;function er(){let[e,t]=(0,i.useState)([]),[r,a]=(0,i.useState)(!0),{socket:I}=(0,U.s)(),P=(0,X.useRouter)(),{user:R}=(0,Q.a)(),D=(0,i.useCallback)(async()=>{try{a(!0);let e=await fetch("/api/stock/orders?status=pending",{cache:"no-store",headers:{"Content-Type":"application/json"}});if(!e.ok)throw Error("Failed to fetch orders");let r=await e.json();t(Array.isArray(r)?r:r.data||[])}catch(e){console.error("Failed to fetch orders"),o.ZP.error("ไม่สามารถโหลดรายการออเดอร์ได้")}finally{a(!1)}},[]);(0,i.useEffect)(()=>{D()},[D]),(0,i.useEffect)(()=>{if(I)return I.on("orders_updated",e=>{let{action:r,data:n,id:i,orderId:a}=e;switch(r){case"create":n&&n.status===T.i.PENDING&&(t(e=>[n,...e]),o.ZP.success("\uD83C\uDD95 มีออเดอร์ใหม่เข้ามา"));break;case"update_status":n&&(n.status===T.i.PENDING?t(e=>e.map(e=>e.id===n.id?n:e)):t(e=>e.filter(e=>e.id!==n.id)),o.ZP.info("อัปเดตสถานะออเดอร์"));break;case"delete":i&&(t(e=>e.filter(e=>e.id!==i)),o.ZP.warning("ลบออเดอร์แล้ว"));break;case"update_item_detail":a&&D();break;default:D()}}),()=>{I.off("orders_updated")}},[I,D]);let[N,O]=(0,i.useState)(null),[A,L]=(0,i.useState)(null),[F,B]=(0,i.useState)("");(0,i.useEffect)(()=>{(async()=>{try{let e=await G.O.getCsrfToken();B(e)}catch(e){console.error("Failed to fetch CSRF token",e)}})()},[]);let W=e=>{var t;s.Z.confirm({title:(0,n.jsxs)(d.Z,{children:[(0,n.jsx)(v.Z,{style:{color:"#ff4d4f"}}),(0,n.jsx)("span",{children:"ยืนยันการยกเลิกออเดอร์"})]}),content:(0,n.jsxs)("div",{style:{marginTop:16},children:[(0,n.jsx)(et,{children:"คุณต้องการยกเลิกออเดอร์นี้หรือไม่?"}),(0,n.jsx)("div",{style:{marginTop:12,padding:12,background:"rgba(255, 77, 79, 0.05)",borderRadius:8,border:"1px solid rgba(255, 77, 79, 0.1)"},children:(0,n.jsxs)(et,{type:"secondary",style:{fontSize:13},children:["ผู้สั่ง: ",(0,n.jsx)("strong",{children:null===(t=e.ordered_by)||void 0===t?void 0:t.username})]})})]}),okText:"ยืนยันยกเลิก",cancelText:"ไม่ยกเลิก",okButtonProps:{danger:!0},centered:!0,onOk:async()=>{try{if(!(await fetch("/api/stock/orders/".concat(e.id,"/status"),{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-Token":F},body:JSON.stringify({status:T.i.CANCELLED})})).ok)throw Error("Failed to cancel order");o.ZP.success("ยกเลิกออเดอร์สำเร็จ")}catch(e){o.ZP.error("ยกเลิกออเดอร์ล้มเหลว")}}})},M=e.reduce((e,t)=>{var r;return e+((null===(r=t.ordersItems)||void 0===r?void 0:r.length)||0)},0),q=[{title:(0,n.jsxs)(d.Z,{children:[(0,n.jsx)(k.Z,{}),(0,n.jsx)("span",{children:"ผู้สั่ง"})]}),dataIndex:["ordered_by","username"],key:"ordered_by",width:140,render:e=>{var t;return(0,n.jsxs)(d.Z,{children:[(0,n.jsx)("div",{style:{width:32,height:32,borderRadius:"50%",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontWeight:600,fontSize:14},children:(null==e?void 0:null===(t=e.charAt(0))||void 0===t?void 0:t.toUpperCase())||"?"}),(0,n.jsx)(et,{strong:!0,style:{fontSize:14},children:e||"Unknown"})]})}},{title:(0,n.jsxs)(d.Z,{children:[(0,n.jsx)(w.Z,{}),(0,n.jsx)("span",{children:"รายการสินค้า"})]}),dataIndex:"ordersItems",key:"items",render:e=>(0,n.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",gap:4},children:[(e||[]).slice(0,3).map(e=>{var t,r,i,a;return(0,n.jsxs)("span",{className:"order-item-badge",children:[(0,n.jsx)(l.Z,{src:(null===(t=e.ingredient)||void 0===t?void 0:t.img_url)||"https://placehold.co/32x32/f5f5f5/999999?text=\uD83D\uDCE6",size:24,shape:"square",style:{borderRadius:6,marginRight:8}}),(0,n.jsx)(et,{strong:!0,style:{color:"#5b6af8",fontSize:13},children:null===(r=e.ingredient)||void 0===r?void 0:r.display_name}),(0,n.jsxs)(et,{style:{color:"#8c8c8c",marginLeft:6,fontSize:12},children:["\xd7",e.quantity_ordered," ",null===(a=e.ingredient)||void 0===a?void 0:null===(i=a.unit)||void 0===i?void 0:i.display_name]})]},e.id)}),e&&e.length>3&&(0,n.jsx)(c.Z,{title:e.slice(3).map(e=>{var t;return null===(t=e.ingredient)||void 0===t?void 0:t.display_name}).join(", "),children:(0,n.jsxs)(u.Z,{color:"purple",style:{borderRadius:20,cursor:"pointer"},children:["+",e.length-3," รายการ"]})})]})},{title:"สถานะ",dataIndex:"status",key:"status",width:110,render:e=>{let t={color:"default",icon:(0,n.jsx)(S.Z,{}),text:e};return e===T.i.PENDING&&(t={color:"warning",icon:(0,n.jsx)(S.Z,{}),text:"รอดำเนินการ"}),e===T.i.COMPLETED&&(t={color:"success",icon:(0,n.jsx)(w.Z,{}),text:"เสร็จสิ้น"}),e===T.i.CANCELLED&&(t={color:"error",icon:(0,n.jsx)(v.Z,{}),text:"ยกเลิก"}),(0,n.jsx)(u.Z,{color:t.color,icon:t.icon,style:{borderRadius:20,padding:"4px 12px",fontWeight:500,fontSize:13},children:t.text})}},{title:(0,n.jsxs)(d.Z,{children:[(0,n.jsx)(C.Z,{}),(0,n.jsx)("span",{children:"วันที่สั่ง"})]}),dataIndex:"create_date",key:"create_date",width:150,render:e=>(0,n.jsxs)(et,{type:"secondary",style:{fontSize:13},children:[new Date(e).toLocaleDateString("th-TH",{day:"numeric",month:"short",year:"numeric"}),(0,n.jsx)("br",{}),(0,n.jsx)(et,{style:{fontSize:12,color:"#bfbfbf"},children:new Date(e).toLocaleTimeString("th-TH",{hour:"2-digit",minute:"2-digit"})})]})},{title:"การจัดการ",key:"actions",width:280,render:(e,t)=>(0,n.jsxs)(d.Z,{size:8,wrap:!0,children:[(0,n.jsx)(c.Z,{title:"ดูรายละเอียด",children:(0,n.jsx)(f.ZP,{className:"action-btn",size:"middle",icon:(0,n.jsx)(_.Z,{}),onClick:()=>L(t),style:{borderColor:"#667eea",color:"#667eea"},children:"ดู"})}),((null==R?void 0:R.role)==="Admin"||(null==R?void 0:R.role)==="Manager")&&(0,n.jsx)(c.Z,{title:"ดำเนินการสั่งซื้อ",children:(0,n.jsx)(f.ZP,{className:"action-btn",type:"primary",size:"middle",icon:(0,n.jsx)(E.Z,{}),disabled:t.status!==T.i.PENDING,onClick:()=>P.push("/stock/buying?orderId=".concat(t.id)),style:{background:"linear-gradient(135deg, #52c41a 0%, #389e0d 100%)",borderColor:"transparent",boxShadow:"0 2px 8px rgba(82, 196, 26, 0.3)"},children:"สั่งซื้อ"})}),(0,n.jsx)(c.Z,{title:"แก้ไขออเดอร์",children:(0,n.jsx)(f.ZP,{className:"action-btn",type:"primary",ghost:!0,size:"middle",icon:(0,n.jsx)(Z.Z,{}),disabled:t.status!==T.i.PENDING,onClick:()=>O(t),children:"แก้ไข"})}),(0,n.jsx)(c.Z,{title:"ยกเลิกออเดอร์",children:(0,n.jsx)(f.ZP,{className:"action-btn",danger:!0,size:"middle",icon:(0,n.jsx)(v.Z,{}),disabled:t.status!==T.i.PENDING,onClick:()=>W(t),children:"ยกเลิก"})})]})}];return(0,n.jsxs)("div",{style:{padding:"24px",paddingBottom:120,minHeight:"100vh",background:"linear-gradient(180deg, #f8f9fc 0%, #f0f2f5 100%)"},children:[(0,n.jsxs)("div",{style:{maxWidth:1400,margin:"0 auto"},children:[(0,n.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:24,marginBottom:24},children:[(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",flexWrap:"wrap",gap:16},children:[(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:16},children:[(0,n.jsx)("div",{style:{width:56,height:56,borderRadius:16,background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 8px 24px rgba(102, 126, 234, 0.35)"},children:(0,n.jsx)(S.Z,{style:{fontSize:28,color:"#fff"}})}),(0,n.jsxs)("div",{children:[(0,n.jsx)(ee,{level:2,style:{margin:0,marginBottom:4,background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",fontWeight:700},children:"รายการรอสั่งซื้อ"}),(0,n.jsx)(et,{type:"secondary",style:{fontSize:14},children:"จัดการออเดอร์ที่รอการดำเนินการ"})]})]}),(0,n.jsx)(f.ZP,{icon:(0,n.jsx)(z.Z,{}),onClick:D,loading:r,size:"large",style:{borderRadius:10,height:44,paddingInline:20,fontWeight:500},children:"รีเฟรช"})]}),(0,n.jsxs)(p.Z,{gutter:[16,16],children:[(0,n.jsx)(x.Z,{xs:12,sm:8,md:6,children:(0,n.jsx)(h.Z,{className:"status-card",size:"small",styles:{body:{padding:16}},children:(0,n.jsx)(b.Z,{title:(0,n.jsx)(et,{type:"secondary",style:{fontSize:13},children:"ออเดอร์ทั้งหมด"}),value:r?"-":e.length,prefix:(0,n.jsx)(y.Z,{status:"processing"}),styles:{content:{color:"#667eea",fontWeight:700,fontSize:28}}})})}),(0,n.jsx)(x.Z,{xs:12,sm:8,md:6,children:(0,n.jsx)(h.Z,{className:"status-card",size:"small",styles:{body:{padding:16}},children:(0,n.jsx)(b.Z,{title:(0,n.jsx)(et,{type:"secondary",style:{fontSize:13},children:"รายการสินค้า"}),value:r?"-":M,prefix:(0,n.jsx)(y.Z,{status:"success"}),styles:{content:{color:"#52c41a",fontWeight:700,fontSize:28}}})})})]})]}),(0,n.jsx)(h.Z,{variant:"borderless",style:{borderRadius:20,boxShadow:"0 4px 24px rgba(0, 0, 0, 0.06)",overflow:"hidden"},styles:{body:{padding:0}},children:r?(0,n.jsx)(()=>(0,n.jsx)("div",{children:[1,2,3].map(e=>(0,n.jsxs)("div",{style:{padding:16,borderBottom:"1px solid rgba(0,0,0,0.04)",display:"flex",alignItems:"center",gap:16},children:[(0,n.jsx)(g.Z.Avatar,{active:!0,size:40}),(0,n.jsx)(g.Z,{active:!0,paragraph:{rows:1,width:["80%"]},title:!1})]},e))}),{}):0===e.length?(0,n.jsx)(()=>(0,n.jsxs)("div",{className:"empty-state-card",style:{padding:"60px 24px",textAlign:"center"},children:[(0,n.jsx)("div",{style:{width:100,height:100,margin:"0 auto 24px",borderRadius:"50%",background:"linear-gradient(135deg, #f0f5ff 0%, #e8f0ff 100%)",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,n.jsx)(w.Z,{style:{fontSize:48,color:"#667eea"}})}),(0,n.jsx)(ee,{level:4,style:{color:"#262626",marginBottom:8},children:"ไม่มีรายการรอดำเนินการ"}),(0,n.jsx)(et,{type:"secondary",style:{fontSize:15,display:"block",marginBottom:24},children:"ยังไม่มีออเดอร์ที่รอการสั่งซื้อในขณะนี้"}),(0,n.jsx)(f.ZP,{type:"primary",icon:(0,n.jsx)(E.Z,{}),size:"large",onClick:()=>P.push("/"),style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",borderColor:"transparent",borderRadius:10,height:48,paddingInline:32,fontWeight:600,boxShadow:"0 4px 16px rgba(102, 126, 234, 0.4)"},children:"เลือกวัตถุดิบเพื่อสั่งซื้อ"})]}),{}):(0,n.jsx)(m.Z,{dataSource:e,columns:q,rowKey:"id",scroll:{x:900},pagination:{pageSize:10,showSizeChanger:!0,showTotal:(e,t)=>(0,n.jsxs)(et,{type:"secondary",children:["แสดง ",t[0],"-",t[1]," จาก ",e," รายการ"]})},className:"items-table",locale:{emptyText:(0,n.jsx)(j.Z,{description:"ไม่มีข้อมูล"})}})})]}),(0,n.jsx)(J,{open:!!N,order:N,onClose:()=>O(null),onSuccess:D}),(0,n.jsx)(Y.Z,{open:!!A,order:A,onClose:()=>L(null)}),(0,n.jsx)($,{})]})}},57835:function(e,t,r){"use strict";r.d(t,{Z:function(){return Z}});var n=r(57437);r(2265);var i=r(82646),a=r(35713),o=r(91652),s=r(89970),d=r(80009),l=r(53743),c=r(96931),u=r(23496),f=r(85180),g=r(50742),p=r(99277),x=r(8900),h=r(39725),b=r(40312),y=r(15883),m=r(49634),j=r(38434),v=r(52539),k=r(12609);let{Text:w,Title:S}=i.default,C={[k.i.PENDING]:{color:"#faad14",bgColor:"linear-gradient(135deg, #fffbe6 0%, #fff1b8 100%)",borderColor:"#ffe58f",icon:(0,n.jsx)(p.Z,{style:{color:"#faad14"}}),label:"รอดำเนินการ",tagColor:"gold"},[k.i.COMPLETED]:{color:"#52c41a",bgColor:"linear-gradient(135deg, #f6ffed 0%, #d9f7be 100%)",borderColor:"#b7eb8f",icon:(0,n.jsx)(x.Z,{style:{color:"#52c41a"}}),label:"เสร็จสิ้น",tagColor:"success"},[k.i.CANCELLED]:{color:"#ff4d4f",bgColor:"linear-gradient(135deg, #fff2f0 0%, #ffccc7 100%)",borderColor:"#ffa39e",icon:(0,n.jsx)(h.Z,{style:{color:"#ff4d4f"}}),label:"ยกเลิก",tagColor:"error"}},_=e=>{let{icon:t,label:r,value:i,valueStyle:a}=e;return(0,n.jsxs)("div",{style:{display:"flex",alignItems:"flex-start",gap:12,padding:"12px 0"},children:[(0,n.jsx)("div",{style:{width:36,height:36,borderRadius:10,background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:16,flexShrink:0},children:t}),(0,n.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,n.jsx)(w,{type:"secondary",style:{fontSize:12,display:"block"},children:r}),(0,n.jsx)("div",{style:{fontWeight:500,marginTop:2,...a},children:i})]})]})},E=e=>{var t,r,i,l,c,u,f,g;let{item:p,index:h}=e,b=null===(t=p.ordersDetail)||void 0===t?void 0:t.is_purchased,y=null===(r=p.ordersDetail)||void 0===r?void 0:r.actual_quantity,m=p.quantity_ordered,j=(null===(l=p.ingredient)||void 0===l?void 0:null===(i=l.unit)||void 0===i?void 0:i.display_name)||"",v=b&&void 0!==y&&y!==m;return(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:16,padding:16,background:"#fafafa",borderRadius:16,marginBottom:12,border:"1px solid #f0f0f0",transition:"all 0.3s ease",animation:"slideIn 0.3s ease ".concat(.05*h,"s both")},className:"item-card",children:[(0,n.jsx)(a.Z,{count:b?(0,n.jsx)(x.Z,{style:{color:"#52c41a",fontSize:16}}):0,offset:[-4,4],children:(0,n.jsx)(o.Z,{src:(null===(c=p.ingredient)||void 0===c?void 0:c.img_url)||"https://placehold.co/60x60/f5f5f5/999999?text=\uD83D\uDCE6",shape:"square",size:64,style:{borderRadius:12,border:"2px solid #fff",boxShadow:"0 4px 12px rgba(0,0,0,0.08)",objectFit:"cover"}})}),(0,n.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,n.jsx)(w,{strong:!0,style:{fontSize:15,display:"block",marginBottom:4,color:"#1a1a2e"},ellipsis:{tooltip:null===(u=p.ingredient)||void 0===u?void 0:u.display_name},children:(null===(f=p.ingredient)||void 0===f?void 0:f.display_name)||"ไม่ทราบชื่อสินค้า"}),(0,n.jsx)(w,{type:"secondary",style:{fontSize:13},children:(null===(g=p.ingredient)||void 0===g?void 0:g.description)||"ไม่มีรายละเอียดเพิ่มเติม"})]}),(0,n.jsxs)("div",{style:{textAlign:"right"},children:[(0,n.jsxs)("div",{style:{background:b?"linear-gradient(135deg, #52c41a 0%, #73d13d 100%)":"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",padding:"8px 14px",borderRadius:12,fontWeight:600,fontSize:14,minWidth:80,textAlign:"center",boxShadow:"0 4px 12px rgba(102, 126, 234, 0.25)"},children:[b?y:m," ",j]}),v&&(0,n.jsx)(s.Z,{title:"จำนวนที่สั่งเดิม",children:(0,n.jsxs)(w,{type:"secondary",style:{fontSize:11,display:"block",marginTop:4,textDecoration:"line-through"},children:["สั่ง ",m," ",j]})}),p.ordersDetail&&!b&&(0,n.jsx)(d.Z,{color:"error",style:{marginTop:4},children:"ยังไม่ได้ซื้อ"})]})]})};function Z(e){var t,r,i;let{order:a,open:o,onClose:s}=e;if(!a)return null;let p=C[a.status]||C[k.i.PENDING],x=(null===(t=a.ordersItems)||void 0===t?void 0:t.length)||0,h=(null===(r=a.ordersItems)||void 0===r?void 0:r.filter(e=>{var t;return null===(t=e.ordersDetail)||void 0===t?void 0:t.is_purchased}).length)||0;return(0,n.jsxs)(l.Z,{open:o,onCancel:s,footer:null,width:520,centered:!0,className:"order-detail-modal",style:{top:20},styles:{body:{padding:0},mask:{backdropFilter:"blur(8px)",background:"rgba(0, 0, 0, 0.45)"}},closeIcon:null,children:[(0,n.jsxs)("div",{style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",padding:"28px 24px 24px",position:"relative",overflow:"hidden"},children:[(0,n.jsx)("div",{style:{position:"absolute",top:-50,right:-50,width:150,height:150,borderRadius:"50%",background:"rgba(255,255,255,0.1)"}}),(0,n.jsx)("div",{style:{position:"absolute",bottom:-30,left:-30,width:100,height:100,borderRadius:"50%",background:"rgba(255,255,255,0.08)"}}),(0,n.jsxs)("div",{style:{position:"relative",zIndex:1},children:[(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12},children:[(0,n.jsx)("div",{style:{width:48,height:48,borderRadius:14,background:"rgba(255,255,255,0.2)",display:"flex",alignItems:"center",justifyContent:"center",backdropFilter:"blur(8px)"},children:(0,n.jsx)(b.Z,{style:{fontSize:24,color:"white"}})}),(0,n.jsxs)("div",{children:[(0,n.jsx)(w,{style:{color:"rgba(255,255,255,0.8)",fontSize:13,display:"block"},children:"รายละเอียดออเดอร์"}),(0,n.jsxs)(S,{level:4,style:{color:"white",margin:0,fontWeight:700,letterSpacing:"0.5px"},children:["#",a.id.substring(0,8).toUpperCase()]})]})]}),(0,n.jsx)(d.Z,{icon:p.icon,style:{background:p.bgColor,border:"1px solid ".concat(p.borderColor),borderRadius:20,padding:"6px 14px",fontSize:13,fontWeight:600,color:p.color,display:"flex",alignItems:"center",gap:6},children:p.label})]}),x>0&&(0,n.jsxs)("div",{style:{marginTop:20},children:[(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[(0,n.jsx)(w,{style:{color:"rgba(255,255,255,0.9)",fontSize:12},children:"ความคืบหน้า"}),(0,n.jsxs)(w,{style:{color:"white",fontWeight:600,fontSize:12},children:[h,"/",x," รายการ"]})]}),(0,n.jsx)("div",{style:{height:6,background:"rgba(255,255,255,0.2)",borderRadius:3,overflow:"hidden"},children:(0,n.jsx)("div",{style:{height:"100%",width:"".concat(h/x*100,"%"),background:"white",borderRadius:3,transition:"width 0.5s ease"}})})]})]})]}),(0,n.jsxs)("div",{style:{padding:"20px 24px 24px"},children:[(0,n.jsxs)(c.Z,{size:"small",style:{borderRadius:16,border:"none",background:"#fff",boxShadow:"0 2px 12px rgba(0,0,0,0.04)",marginBottom:20},styles:{body:{padding:"8px 16px"}},children:[(0,n.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:0},children:[(0,n.jsx)(_,{icon:(0,n.jsx)(y.Z,{}),label:"ผู้สั่งซื้อ",value:(null===(i=a.ordered_by)||void 0===i?void 0:i.name)||"Unknown"}),(0,n.jsx)(_,{icon:(0,n.jsx)(m.Z,{}),label:"วันที่สั่ง",value:new Date(a.create_date).toLocaleDateString("th-TH",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})})]}),a.remark&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(u.Z,{style:{margin:"4px 0 8px"}}),(0,n.jsx)(_,{icon:(0,n.jsx)(j.Z,{}),label:"หมายเหตุ",value:a.remark,valueStyle:{color:"#8c8c8c",fontWeight:400}})]})]}),(0,n.jsxs)("div",{style:{marginBottom:20},children:[(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:16},children:[(0,n.jsx)(v.Z,{style:{fontSize:18,color:"#667eea"}}),(0,n.jsx)(w,{strong:!0,style:{fontSize:16,color:"#1a1a2e"},children:"รายการสินค้า"}),(0,n.jsxs)("div",{style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",padding:"2px 10px",borderRadius:20,fontSize:12,fontWeight:600},children:[x," รายการ"]})]}),(0,n.jsx)("div",{style:{maxHeight:300,overflowY:"auto",paddingRight:4,scrollbarWidth:"thin",scrollbarColor:"#d9d9d9 transparent"},children:a.ordersItems&&a.ordersItems.length>0?a.ordersItems.map((e,t)=>(0,n.jsx)(E,{item:e,index:t},e.id)):(0,n.jsx)(f.Z,{description:"ไม่มีรายการสินค้า",image:f.Z.PRESENTED_IMAGE_SIMPLE,style:{padding:"40px 0"}})})]}),(0,n.jsx)("div",{style:{display:"flex",gap:12},children:(0,n.jsx)(g.ZP,{type:"primary",block:!0,size:"large",onClick:s,style:{height:48,borderRadius:12,fontWeight:600,background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",border:"none",boxShadow:"0 4px 16px rgba(102, 126, 234, 0.35)"},children:"ปิด"})})]}),(0,n.jsx)("style",{children:"\n                .order-detail-modal .ant-modal-content {\n                    border-radius: 24px !important;\n                    overflow: hidden;\n                    padding: 0 !important;\n                }\n                \n                @keyframes slideIn {\n                    from {\n                        opacity: 0;\n                        transform: translateY(10px);\n                    }\n                    to {\n                        opacity: 1;\n                        transform: translateY(0);\n                    }\n                }\n                \n                .item-card:hover {\n                    background: #f0f5ff !important;\n                    border-color: #adc6ff !important;\n                    transform: translateX(4px);\n                }\n                \n                /* Custom scrollbar */\n                *::-webkit-scrollbar {\n                    width: 6px;\n                }\n                *::-webkit-scrollbar-track {\n                    background: transparent;\n                }\n                *::-webkit-scrollbar-thumb {\n                    background: #d9d9d9;\n                    border-radius: 3px;\n                }\n                *::-webkit-scrollbar-thumb:hover {\n                    background: #bfbfbf;\n                }\n            "})]})}},71567:function(e,t,r){"use strict";r.d(t,{q:function(){return i},v:function(){return n}});let n="/api",i={AUTH:{LOGIN:"/auth/login",ME:"/auth/me",CSRF:"/csrf"},POS:{PRODUCTS:"/pos/products",ORDERS:"/pos/orders",TABLES:"/pos/tables",DISCOUNTS:"/pos/discounts",DELIVERY:"/pos/delivery",PAYMENT_METHODS:"/pos/paymentMethod",PAYMENTS:"/pos/payments",CATEGORY:"/pos/category",SHIFTS:{BASE:"/pos/shifts",CURRENT:"/pos/shifts/current",OPEN:"/pos/shifts/open",CLOSE:"/pos/shifts/close"},DASHBOARD:{SALES:"/pos/dashboard/sales",TOP_ITEMS:"/pos/dashboard/top-items"},CHANNELS:{STATS:"/pos/orders/stats"},SHOP_PROFILE:"/pos/shopProfile",SALES_ORDER_ITEMS:"/pos/salesOrderItem",SALES_ORDER_DETAILS:"/pos/salesOrderDetail",PRODUCTS_UNIT:"/pos/productsUnit",PAYMENT_DETAILS:"/pos/paymentDetails",BRANCH:"/branches"}}},14362:function(e,t,r){"use strict";r.d(t,{AuthProvider:function(){return u},a:function(){return f}});var n=r(57437),i=r(2265),a=r(99376),o=r(5447),s=r(84859),d=r(48651),l=r(3369);let c=(0,i.createContext)(void 0),u=e=>{let{children:t}=e,[r,u]=(0,i.useState)(null),[f,g]=(0,i.useState)(!0),p=(0,a.useRouter)(),x=(0,a.usePathname)(),h=async()=>{try{let e="";e=localStorage.getItem("token_ws")||"";let t=await o.O.getMe(e);u(t)}catch(e){u(null)}finally{g(!1)}};(0,i.useEffect)(()=>{h()},[]);let{showLoading:b,hideLoading:y}=(0,l.x)();(0,i.useEffect)(()=>{f||r||"/login"===x||p.push("/login")},[r,f,x,p]);let m=async e=>{try{b("กำลังเข้าสู่ระบบ...");let t=await o.O.getCsrfToken(),{token:r,...n}=await o.O.login(e,t);r&&localStorage.setItem("token_ws",r),u(n),p.push("/")}catch(e){throw e}finally{y()}},j=async()=>{try{b("กำลังออกจากระบบ...");let e="";e=localStorage.getItem("token_ws")||"",await o.O.logout(e),localStorage.removeItem("token_ws"),s.x.clearQueue(),u(null),p.push("/login")}catch(e){console.error("Logout error:",e)}finally{y()}};return f?(0,n.jsx)("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-white",children:(0,n.jsx)(d.Z,{size:"large"})}):r||"/login"===x?(0,n.jsx)(c.Provider,{value:{user:r,loading:f,login:m,logout:j,checkAuth:h},children:t}):null},f=()=>{let e=(0,i.useContext)(c);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}},46252:function(e,t,r){"use strict";r.d(t,{J:function(){return s},SocketProvider:function(){return d}});var n=r(57437),i=r(2265),a=r(68680),o=r(14362);let s=(0,i.createContext)({socket:null,isConnected:!1}),d=e=>{let{children:t}=e,[r,d]=(0,i.useState)(null),[l,c]=(0,i.useState)(!1),{user:u}=(0,o.a)();return(0,i.useEffect)(()=>{if(!u){r&&(r.disconnect(),d(null),c(!1));return}let e=localStorage.getItem("token_ws"),t=(0,a.io)("http://localhost:3000",{transports:["websocket"],withCredentials:!0,auth:e?{token:e}:void 0});return t.on("connect",()=>{console.log("Socket Connected:",t.id),c(!0)}),t.on("disconnect",()=>{console.log("Socket Disconnected"),c(!1)}),d(t),()=>{t.disconnect()}},[u]),(0,n.jsx)(s.Provider,{value:{socket:r,isConnected:l},children:t})}},3369:function(e,t,r){"use strict";r.d(t,{GlobalLoadingProvider:function(){return d},O:function(){return c},x:function(){return l}});var n=r(57437),i=r(2265),a=r(48651);let o=(0,i.createContext)(void 0),s=(0,i.createContext)(void 0),d=e=>{let{children:t}=e,[r,d]=(0,i.useState)({}),[l,c]=(0,i.useState)(void 0),u=(0,i.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default";d(e=>({...e,[t]:(e[t]||0)+1})),e&&c(e)},[]),f=(0,i.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";d(t=>{if(!t[e])return t;let r={...t};return r[e]-=1,r[e]<=0&&delete r[e],r})},[]),g=(0,i.useCallback)(()=>{d({}),c(void 0)},[]),p=Object.keys(r).length>0,x=(0,i.useMemo)(()=>({isLoading:p,loadingMessage:l}),[p,l]),h=(0,i.useMemo)(()=>({showLoading:u,hideLoading:f,resetLoading:g}),[u,f,g]);return(0,n.jsx)(s.Provider,{value:h,children:(0,n.jsxs)(o.Provider,{value:x,children:[t,p&&(0,n.jsx)("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center pointer-events-auto bg-black/10 backdrop-blur-[1px]",children:(0,n.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:10,background:"rgba(255, 255, 255, 0.9)",padding:"20px 40px",borderRadius:12,boxShadow:"0 4px 12px rgba(0,0,0,0.1)"},children:[(0,n.jsx)(a.Z,{size:"large"}),l&&(0,n.jsx)("div",{style:{fontSize:14,color:"#1f1f1f",fontWeight:500},children:l})]})})]})})};function l(){let e=(0,i.useContext)(o),t=(0,i.useContext)(s);if(!e||!t)throw Error("useGlobalLoading must be used within a GlobalLoadingProvider");return(0,i.useMemo)(()=>({...e,...t}),[e,t])}function c(){let e=(0,i.useContext)(s);if(!e)throw Error("useGlobalLoadingDispatch must be used within a GlobalLoadingProvider");return e}},24675:function(e,t,r){"use strict";r.d(t,{s:function(){return a}});var n=r(2265),i=r(46252);let a=()=>(0,n.useContext)(i.J)},2913:function(e,t,r){"use strict";function n(e,t){return({GET:"".concat(i.API_BASE_URL).concat(t),POST:"".concat(i.API_BASE_URL).concat(t),PUT:"".concat(i.API_BASE_URL).concat(t),DELETE:"".concat(i.API_BASE_URL).concat(t),PATCH:"".concat(i.API_BASE_URL).concat(t)})[e]}r.d(t,{b:function(){return n}});let i={get API_BASE_URL(){return"/api"}}},5447:function(e,t,r){"use strict";r.d(t,{O:function(){return a}});var n=r(71567),i=r(2913);let a={login:async(e,t,r)=>{try{let a=(0,i.b)("POST",n.q.AUTH.LOGIN),o={"Content-Type":"application/json"};t&&(o["X-CSRF-Token"]=t),r&&(o.Cookie=r);let s=await fetch(a,{method:"POST",headers:o,credentials:"include",body:JSON.stringify(e)});if(!s.ok){let e=await s.json().catch(()=>({}));throw Error(e.message||e.detail||"เข้าสู่ระบบไม่สำเร็จ")}let d=await s.json();return{...d.user,token:d.token}}catch(e){throw Error(e.message||"เข้าสู่ระบบไม่สำเร็จ")}},logout:async(e,t,r)=>{try{let n=(0,i.b)("POST","/auth/logout"),a={"Content-Type":"application/json"};e&&(a.Authorization="Bearer ".concat(e)),t&&(a["X-CSRF-Token"]=t),r&&(a.Cookie=r),await fetch(n,{method:"POST",headers:a,credentials:"include"})}catch(e){console.error("Logout failed",e)}},getMe:async e=>{try{let t=(0,i.b)("GET",n.q.AUTH.ME),r=await fetch(t,{method:"GET",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"},credentials:"include",cache:"no-store"});if(!r.ok)throw Error("Unauthorized");return await r.json()}catch(e){throw e}},async getCsrfToken(){try{let e=await fetch("".concat(n.v).concat(n.q.AUTH.CSRF),{credentials:"include"});if(!e.ok)return"";return(await e.json()).csrfToken}catch(e){return console.error("Failed to fetch CSRF token",e),""}}}},84859:function(e,t,r){"use strict";r.d(t,{M:function(){return s},x:function(){return o}});let n="pos_offline_queue",i=()=>{let e=localStorage.getItem(n);return e?JSON.parse(e):[]},a=e=>{localStorage.setItem(n,JSON.stringify(e))},o={addToQueue:(e,t)=>{let r=i(),n={id:"offline-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),type:e,payload:t,timestamp:Date.now(),retryCount:0};return a([...r,n]),n},getQueue:()=>i(),removeFromQueue:e=>{a(i().filter(t=>t.id!==e))},incrementRetry:(e,t)=>{a(i().map(r=>r.id===e?{...r,retryCount:r.retryCount+1,lastError:t}:r))},clearQueue:()=>{localStorage.removeItem(n)},pruneExceeded:()=>{a(i().filter(e=>e.retryCount<=5))}},s={maxRetry:5,backoff:e=>Math.min(3e4,2e3*e)}},76155:function(e,t,r){"use strict";r.d(t,{x:function(){return o}});var n=r(2913);let i="/stock/orders",a=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"application/json",r={};return t&&(r["Content-Type"]=t),e&&(r.Cookie=e),r},o={createOrder:async(e,t,r)=>{let o=(0,n.b)("POST",i),s=a(t);r&&(s["X-CSRF-Token"]=r);let d=await fetch(o,{method:"POST",headers:s,body:JSON.stringify(e)});if(!d.ok){let e=await d.text();console.error("Backend Error [createOrder]:",{status:d.status,statusText:d.statusText,url:o,body:e});let t={};try{t=JSON.parse(e)}catch(e){}throw Error(t.error||t.message||"ไม่สามารถสร้างออเดอร์ได้ (".concat(d.status,")"))}return d.json()},getAllOrders:async(e,t)=>{let r=(0,n.b)("GET",i);t&&(r+="?".concat(t.toString()));let o=a(e,""),s=await fetch(r,{cache:"no-store",headers:o});if(!s.ok){let e=await s.json().catch(()=>({}));throw Error(e.error||e.message||"ไม่สามารถดึงข้อมูลออเดอร์ได้")}return s.json()},getOrderById:async(e,t)=>{let r=(0,n.b)("GET","".concat(i,"/").concat(e)),o=a(t,""),s=await fetch(r,{cache:"no-store",headers:o});if(!s.ok){let e=await s.json().catch(()=>({}));throw Error(e.error||e.message||"ไม่สามารถดึงข้อมูลออเดอร์ได้")}return s.json()},updateStatus:async(e,t,r,o)=>{let s=(0,n.b)("PUT","".concat(i,"/").concat(e,"/status")),d=a(r);o&&(d["X-CSRF-Token"]=o);let l=await fetch(s,{method:"PUT",headers:d,body:JSON.stringify({status:t})});if(!l.ok){let e=await l.json().catch(()=>({}));throw Error(e.error||e.message||"ไม่สามารถอัปเดตสถานะออเดอร์ได้")}return l.json()},updateOrder:async(e,t,r,o)=>{let s=(0,n.b)("PUT","".concat(i,"/").concat(e)),d=a(r);o&&(d["X-CSRF-Token"]=o);let l=await fetch(s,{method:"PUT",headers:d,body:JSON.stringify({items:t})});if(!l.ok){let e=await l.text();throw Error("Failed to update order: ".concat(l.status," ").concat(e))}return l.json()},confirmPurchase:async(e,t,r,o,s)=>{let d=(0,n.b)("POST","".concat(i,"/").concat(e,"/purchase")),l=a(o);s&&(l["X-CSRF-Token"]=s);let c=await fetch(d,{method:"POST",headers:l,body:JSON.stringify({items:t,purchased_by_id:r})});if(!c.ok){let e=await c.text();throw Error("Failed to confirm purchase: ".concat(c.status," ").concat(e))}return c.json()},updatePurchaseDetail:async(e,t)=>{let r=(0,n.b)("POST","/stock/ordersDetail/update"),i=a(t),o=await fetch(r,{method:"POST",headers:i,body:JSON.stringify(e)});if(!o.ok){let e=await o.json().catch(()=>({}));throw Error(e.error||e.message||"ไม่สามารถอัปเดตข้อมูลการซื้อได้")}return o.json()},deleteOrder:async(e,t,r)=>{let o=(0,n.b)("DELETE","".concat(i,"/").concat(e)),s=a(t,"");r&&(s["X-CSRF-Token"]=r);let d=await fetch(o,{method:"DELETE",headers:s});if(!d.ok){let e=await d.text();throw Error("Failed to delete order: ".concat(d.status," ").concat(e))}}}},12609:function(e,t,r){"use strict";var n,i;r.d(t,{i:function(){return n}}),(i=n||(n={})).PENDING="pending",i.COMPLETED="completed",i.CANCELLED="cancelled"}},function(e){e.O(0,[5015,7717,7698,742,3211,7993,8651,2646,6207,7213,9021,2224,3248,1721,9,5616,5496,3834,8640,6931,8056,1652,4547,5713,3410,2297,5162,2971,2117,1744],function(){return e(e.s=95365)}),_N_E=e.O()}]);