(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[797],{83970:function(e,t,a){Promise.resolve().then(a.bind(a,62841))},62841:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return D}});var n=a(57437),r=a(2265),s=a(8949),l=a(28006),o=a(99376),i=a(5311),c=a(62376),d=a(38434),p=a(88009),u=a(441),x=a(93132),b=a(29107),f=a(71891),h=a(99458),m=a(55322),y=a(39760),g=a(72285),v=a(35713),w=a(14362);let j=(0,a(30166).default)(()=>Promise.all([a.e(4736),a.e(8592)]).then(a.bind(a,15718)),{loadableGenerated:{webpack:()=>[15718]},ssr:!1});var k=()=>{let e=(0,o.useRouter)(),t=(0,o.usePathname)(),{user:a}=(0,w.a)(),{currentShift:s}=(0,l.S)(),[k,E]=(0,r.useState)(!1),[_,Z]=(0,r.useState)(!1),N=(0,r.useRef)(null);(0,r.useEffect)(()=>{let e=e=>{N.current&&!N.current.contains(e.target)&&Z(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);let T=(0,r.useMemo)(()=>[{key:"home",label:"หน้าแรก",icon:i.Z,path:"/"},{key:"pos",label:"ขาย",icon:c.Z,path:"/pos"},{key:"orders",label:"ออเดอร์",icon:d.Z,path:"/pos/orders"},{key:"dashboard",label:"สรุป",icon:p.Z,path:"/pos/dashboard"}],[]),C=(0,r.useMemo)(()=>{let e=[{key:"kitchen",label:"ครัว",icon:u.Z,path:"/pos/kitchen"},{key:"tables",label:"โต๊ะ",icon:x.Z,path:"/pos/tables"},{key:"delivery",label:"เดลิเวอรี่",icon:b.Z,path:"/pos/delivery"}];return(null==a?void 0:a.role)==="Admin"&&e.push({key:"discounts",label:"ส่วนลด",icon:f.Z,path:"/pos/discounts"},{key:"payment",label:"ชำระเงิน",icon:h.Z,path:"/pos/paymentMethod"},{key:"settings",label:"ตั้งค่า",icon:m.Z,path:"/pos/settings"}),e},[null==a?void 0:a.role]),P=e=>"/"===e?"/"===t:"/pos"===e?"/pos"===t||t.startsWith("/pos/channels"):t===e||t.startsWith(e+"/"),R=C.some(e=>P(e.path)),S=t=>{e.push(t),Z(!1)};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"fixed z-[1000] bottom-5 left-1/2 -translate-x-1/2 w-[calc(100%-20px)] max-w-[420px]",children:(0,n.jsxs)("div",{className:"flex justify-between items-center h-[80px] px-3 bg-[#0f172a]/95 backdrop-blur-xl shadow-[0_25px_50px_-12px_rgba(0,0,0,0.5)] border border-white/10 rounded-[32px]",style:{transition:"all 0.3s cubic-bezier(0.23, 1, 0.32, 1)"},children:[T.map(e=>{let t=P(e.path),a=e.icon;return(0,n.jsxs)("button",{onClick:()=>S(e.path),className:"flex flex-col items-center justify-center flex-1 h-full bg-transparent border-none cursor-pointer relative group",children:[(0,n.jsx)("div",{className:"\n                    flex items-center justify-center w-[48px] h-[48px] rounded-[16px] mb-1\n                    transition-all duration-300 ease-[cubic-bezier(0.23,1,0.32,1)]\n                    ".concat(t?"bg-emerald-500/20 -translate-y-1 scale-105":"bg-transparent","\n                    group-active:scale-90\n                  "),children:(0,n.jsx)(a,{style:{fontSize:24,color:t?"#34d399":"#94a3b8",filter:t?"drop-shadow(0 0 10px rgba(52, 211, 153, 0.4))":"none",transition:"all 0.3s ease"}})}),(0,n.jsx)("span",{className:"text-[10px] font-bold transition-all duration-300 ".concat(t?"text-[#34d399]":"text-[#94a3b8] opacity-60"),children:e.label})]},e.key)}),(0,n.jsxs)("div",{ref:N,className:"relative flex-1 h-full flex items-center justify-center",children:[(0,n.jsxs)("button",{onClick:()=>Z(!_),className:"flex flex-col items-center justify-center h-full bg-transparent border-none cursor-pointer relative group",children:[(0,n.jsx)("div",{className:"\n                  flex items-center justify-center w-[48px] h-[48px] rounded-[16px] mb-1\n                  transition-all duration-300 ease-[cubic-bezier(0.23,1,0.32,1)]\n                  ".concat(_||R?"bg-amber-500/20 -translate-y-1 scale-105":"bg-transparent","\n                  group-active:scale-90\n                "),children:(0,n.jsx)(y.Z,{style:{fontSize:24,color:_||R?"#fbbf24":"#94a3b8",filter:_||R?"drop-shadow(0 0 10px rgba(251, 191, 36, 0.4))":"none",transition:"all 0.3s ease"}})}),(0,n.jsx)("span",{className:"text-[10px] font-bold transition-all duration-300 ".concat(_||R?"text-[#fbbf24]":"text-[#94a3b8] opacity-60"),children:"เพิ่มเติม"})]}),_&&(0,n.jsxs)("div",{className:"absolute bottom-full mb-3 right-0 w-[180px] bg-[#0f172a]/90 backdrop-blur-xl rounded-[20px] border border-white/15 shadow-[0_20px_40px_-10px_rgba(0,0,0,0.7)] overflow-hidden animate-in fade-in slide-in-from-bottom-2 duration-200",children:[C.map((e,t)=>{let a=P(e.path),r=e.icon;return(0,n.jsxs)("button",{onClick:()=>S(e.path),className:"\n                        flex items-center gap-3 w-full px-4 py-3 border-none cursor-pointer transition-all duration-200\n                        ".concat(a?"bg-emerald-500/15 text-emerald-400":"bg-transparent text-slate-300 hover:bg-white/5","\n                        ").concat(t!==C.length-1?"border-b border-white/5":"","\n                      "),children:[(0,n.jsx)(r,{style:{fontSize:18,color:a?"#34d399":"#94a3b8"}}),(0,n.jsx)("span",{className:"text-[13px] font-medium",children:e.label})]},e.key)}),s&&(0,n.jsxs)("button",{onClick:()=>{E(!0),Z(!1)},className:"flex items-center gap-3 w-full px-4 py-3 border-t border-white/10 bg-red-500/10 hover:bg-red-500/20 transition-all",children:[(0,n.jsx)(v.Z,{dot:!0,status:"processing",color:"#ef4444",children:(0,n.jsx)(g.Z,{style:{fontSize:18,color:"#ef4444"}})}),(0,n.jsx)("span",{className:"text-[13px] font-bold text-red-400",children:"ปิดกะ"})]})]})]})]})}),(0,n.jsx)(j,{open:k,onCancel:()=>E(!1)})]})},E=a(34029),_=a(52717),Z=a(20920),N=a(84859),T=a(53286),C=a(54528),P=a(86198),R=a(5447),S=a(98748);let M=e=>new Promise(t=>setTimeout(t,e)),z=()=>{let e=(0,Z.L)(),[t,a]=(0,r.useState)(!1),s=(0,r.useCallback)(async()=>{if(t||0===N.x.getQueue().length)return;a(!0);let e=E.ZP.loading("กำลังซิงค์รายการที่ค้างอยู่...",0),n=0,r=0;N.x.pruneExceeded();let s=N.x.getQueue();try{let e=await R.O.getCsrfToken();for(let t of s)try{let a=N.M.backoff(t.retryCount);if(a>0&&await M(a),"CREATE_ORDER"===t.type)await T.x.create(t.payload,void 0,e);else if("UPDATE_ORDER"===t.type){let{orderId:a,data:n}=t.payload;await T.x.update(a,n,void 0,e)}else if("ADD_ITEM"===t.type){let{orderId:a,itemData:n}=t.payload;await T.x.addItem(a,n,void 0,e)}else if("UPDATE_ITEM"===t.type){let{itemId:a,itemData:n}=t.payload;await T.x.updateItem(a,n,void 0,e)}else if("DELETE_ITEM"===t.type){let{itemId:a}=t.payload;await T.x.deleteItem(a,void 0,e)}else if("PAYMENT"===t.type){let{orderId:a,paymentData:n}=t.payload;await C.U.create({...n,order_id:a},void 0,e)}else if("UPDATE_QUEUE_STATUS"===t.type){let{queueId:e,status:a}=t.payload;await P.e.updateStatus(e,{status:a},void 0)}N.x.removeFromQueue(t.id),n++}catch(e){if(t.retryCount+1>N.M.maxRetry)N.x.removeFromQueue(t.id),r++;else{let a=e instanceof Error?e.message:void 0;N.x.incrementRetry(t.id,a)}}}finally{e(),a(!1),n>0&&E.ZP.success("ซิงค์สำเร็จ ".concat(n," รายการ")),r>0&&_.ZP.error({message:"ซิงค์บางรายการไม่สำเร็จ",description:"".concat(r," รายการเกินจำนวน retry ที่กำหนด"),placement:"bottomRight",duration:3})}},[t]);return(0,r.useEffect)(()=>{e?s():_.ZP.warning({message:"ออฟไลน์",description:"รายการจะถูกเก็บเข้าคิวและซิงค์ให้อัตโนมัติเมื่อออนไลน์",icon:(0,n.jsx)(S.Z,{style:{color:"#faad14"}}),duration:2,placement:"bottomRight"})},[e,s]),null};var A=a(54343);function D(e){let{children:t}=e;return(0,n.jsxs)(l.r,{children:[(0,n.jsx)(z,{}),(0,n.jsx)(A.Z,{}),(0,n.jsxs)(s.Z,{children:[t,(0,n.jsx)(k,{})]})]})}}},function(e){e.O(0,[8024,4736,8592,1744],function(){return e(e.s=83970)}),_N_E=e.O()}]);