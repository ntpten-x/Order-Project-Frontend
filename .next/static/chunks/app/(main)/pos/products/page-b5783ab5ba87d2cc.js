(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3843],{50304:function(e,t,r){Promise.resolve().then(r.bind(r,92837))},92837:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return et}});var i=r(57437),s=r(29),n=r.n(s),a=r(2265),l=r(60283),o=r(80009),c=r(50742),d=r(34029),p=r(53743),u=r(24783),h=r(89970),g=r(88589),x=r(61778),y=r(33145),m=r(62376),f=r(8900),j=r(39725),b=r(13377),v=r(26349),w=r(89245),Z=r(96473),k=r(29436),F=r(99376),E=r(3369),C=r(26972),_=r(24675),S=r(97235),P=r(67918),R=r(67697),z=r(73814),N=r(69397);let U={...(0,N.yf)("linear-gradient(135deg, #4F46E5 0%, #4338CA 100%)"),productCard:N.YO,productCardInner:N.lv},I="\n  ".concat((0,N.IU)(".products-page",".product-card"),"\n\n  @media (max-width: 576px) {\n    .products-header-content {\n      flex-direction: column !important;\n      align-items: stretch !important;\n      gap: 16px !important;\n    }\n    \n    .products-header-left {\n      width: 100%;\n    }\n\n    .products-header-actions {\n      width: 100%;\n      display: flex;\n      gap: 8px;\n    }\n\n    .products-search-input {\n      width: 100% !important;\n      flex: 1;\n    }\n\n    .products-add-btn-text {\n      display: none;\n    }\n    \n    .ant-empty-description {\n        padding: 0 20px;\n    }\n\n    .product-card-inner {\n        padding: 12px !important;\n        gap: 10px !important;\n    }\n  }\n");var T=r(79657),B=r(11713),L=r(2913),A=r(98170);let D=async(e,t)=>{let r=(0,L.b)("GET","/pos/productsUnit");t&&(r+="?".concat(t.toString()));let i={};e&&(i.Cookie=e);let s=await fetch(r,{cache:"no-store",credentials:"include",headers:i});if(!s.ok){var n;let e=await s.json().catch(()=>({}));throw Error((null==e?void 0:null===(n=e.error)||void 0===n?void 0:n.message)||e.error||e.message||"Failed to fetch products units")}return(0,A.hH)(await s.json())},W="pos:products-units";var O=r(67338);function M(e,t){let r=e.length>0,i=t.length>0;return{hasCategories:r,hasUnits:i,isReady:r&&i,missingFields:[!r&&"หมวดหมู่สินค้า",!i&&"หน่วยสินค้า"].filter(Boolean)}}function q(e,t){let r=M(e,t);return r.isReady?"":"กรุณาเพิ่ม".concat(r.missingFields.join("และ"),"ให้เรียบร้อยก่อนใช้งาน")}var H=r(12028),G=r(2938),J=r(25193),K=r(37410),X=r(27623),Y=r(20148),Q=r(2786);let{Text:V}=l.default,$=e=>{let{totalProducts:t,activeProducts:r,inactiveProducts:s}=e;return(0,i.jsxs)("div",{style:U.statsCard,children:[(0,i.jsxs)("div",{style:U.statItem,children:[(0,i.jsx)("span",{style:{...U.statNumber,color:"#4F46E5"},children:t}),(0,i.jsx)(V,{style:U.statLabel,children:"ทั้งหมด"})]}),(0,i.jsx)("div",{style:{width:1,height:24,background:"#f0f0f0",alignSelf:"center"}}),(0,i.jsxs)("div",{style:U.statItem,children:[(0,i.jsx)("span",{style:{...U.statNumber,color:"#10B981"},children:r}),(0,i.jsx)(V,{style:U.statLabel,children:"ใช้งาน"})]}),(0,i.jsx)("div",{style:{width:1,height:24,background:"#f0f0f0",alignSelf:"center"}}),(0,i.jsxs)("div",{style:U.statItem,children:[(0,i.jsx)("span",{style:{...U.statNumber,color:"#F59E0B"},children:s}),(0,i.jsx)(V,{style:U.statLabel,children:"ไม่ใช้งาน"})]})]})},ee=e=>{var t,r,s;let{product:n,index:a,onEdit:l,onDelete:d}=e;return(0,i.jsx)("div",{className:"product-card",style:{...U.productCard(n.is_active),animationDelay:"".concat(.03*a,"s")},onClick:()=>l(n),children:(0,i.jsxs)("div",{className:"product-card-inner",style:U.productCardInner,children:[(0,i.jsx)("div",{style:{width:72,height:72,borderRadius:16,border:"1px solid #F1F5F9",boxShadow:"0 4px 12px rgba(0,0,0,0.04)",flexShrink:0,overflow:"hidden",position:"relative",background:"#F8FAFC"},children:n.img_url?(0,i.jsx)(y.default,{src:n.img_url,alt:n.display_name||n.product_name,fill:!0,style:{objectFit:"cover"},sizes:"72px"}):(0,i.jsx)("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #EEF2FF 0%, #E0E7FF 100%)"},children:(0,i.jsx)(m.Z,{style:{fontSize:24,color:"#6366F1",opacity:.8}})})}),(0,i.jsxs)("div",{style:{flex:1,minWidth:0,padding:"0 4px"},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:6,marginBottom:4},children:[(0,i.jsx)(V,{strong:!0,style:{fontSize:16,color:"#1E293B",flex:1},ellipsis:!0,children:n.display_name}),n.is_active?(0,i.jsx)(f.Z,{style:{color:"#10B981",fontSize:14}}):(0,i.jsx)(j.Z,{style:{color:"#94A3B8",fontSize:14}})]}),(0,i.jsx)(V,{type:"secondary",style:{fontSize:13,display:"block",marginBottom:8,color:"#64748B"},ellipsis:!0,children:n.product_name}),(0,i.jsxs)("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:[(0,i.jsx)(o.Z,{style:{borderRadius:6,margin:0,fontSize:11,fontWeight:700,color:"#059669",background:"#ECFDF5",border:"none",padding:"0 8px"},children:(0,O.T4)(Number(n.price))}),Number(null!==(r=n.price_delivery)&&void 0!==r?r:n.price)!==Number(n.price)&&(0,i.jsxs)(o.Z,{style:{borderRadius:6,margin:0,fontSize:11,fontWeight:700,color:"#db2777",background:"#fdf2f8",border:"none",padding:"0 8px"},children:["Delivery ",(0,O.T4)(Number(null!==(s=n.price_delivery)&&void 0!==s?s:n.price))]}),(null===(t=n.category)||void 0===t?void 0:t.display_name)&&(0,i.jsx)(o.Z,{style:{borderRadius:6,margin:0,fontSize:10,color:"#4F46E5",background:"#EEF2FF",border:"none"},children:n.category.display_name})]})]}),(0,i.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,i.jsx)(c.ZP,{type:"text",icon:(0,i.jsx)(b.Z,{}),onClick:e=>{e.stopPropagation(),l(n)},style:{borderRadius:12,color:"#4F46E5",background:"#F5F3FF",width:36,height:36}}),(0,i.jsx)(c.ZP,{type:"text",danger:!0,icon:(0,i.jsx)(v.Z,{}),onClick:e=>{e.stopPropagation(),d(n)},style:{borderRadius:12,background:"#FEF2F2",width:36,height:36}})]})]})})};function et(){let e=(0,F.useRouter)(),[t,r]=(0,a.useState)([]),[s,l]=(0,a.useState)(0),[o,y]=(0,a.useState)(null),[f,j]=(0,a.useState)(1),[b,N]=(0,a.useState)(1),[L,A]=(0,a.useState)(!1),[O,et]=(0,a.useState)(""),{execute:er}=(0,C.J)(),{showLoading:ei}=(0,E.x)(),{socket:es}=(0,_.s)(),{isAuthorized:en,isChecking:ea}=(0,P.e)({allowedRoles:["Admin","Manager"]}),el=(0,a.useRef)(null),eo=(0,a.useRef)(!1),[ec,ed]=(0,a.useState)([]),[ep,eu]=(0,a.useState)([]),{data:eh=[],isLoading:eg}=(0,T.L)(),{data:ex=[],isLoading:ey}=(0,B.a)({queryKey:["products-units"],queryFn:async()=>{let e=await D();return(null==e?void 0:e.length)&&(0,z.v)(W,e),e},initialData:()=>(0,z.t)(W,3e5)||void 0,staleTime:3e5,refetchOnWindowFocus:!1,retry:1});(0,a.useEffect)(()=>{eh.length>0&&ed(eh)},[eh]),(0,a.useEffect)(()=>{ex.length>0&&eu(ex)},[ex]),(0,a.useEffect)(()=>{(0,S.P)()},[]),(0,a.useEffect)(()=>{let e=(0,z.t)("pos:products:v2",6e5);if((null==e?void 0:e.items)&&Array.isArray(e.items)){r(e.items),l("number"==typeof e.total?e.total:e.items.length),j(1),N("number"==typeof e.last_page?e.last_page:1),y("number"==typeof e.active_total?e.active_total:null);return}let t=(0,z.t)("pos:products",6e5);t&&Array.isArray(t)&&(r(t),l(t.length),j(1),N(1))},[]);let em=(0,a.useCallback)(async()=>{er(async()=>{let e=new URLSearchParams;e.set("page","1"),e.set("limit","50"),O.trim()&&e.set("q",O.trim());let t=new URLSearchParams(e);t.set("limit","1"),t.set("is_active","true");let[i,s]=await Promise.all([fetch("/api/pos/products?".concat(e.toString())),fetch("/api/pos/products?".concat(t.toString()))]);if(!i.ok){let e=await i.json().catch(()=>({}));throw Error(e.error||e.message||"ไม่สามารถดึงข้อมูลสินค้าได้")}if(!s.ok){let e=await s.json().catch(()=>({}));throw Error(e.error||e.message||"ไม่สามารถดึงจำนวนสินค้าได้")}let n=await i.json(),a=await s.json(),o=n.data||[],c="number"==typeof n.total?n.total:o.length,d="number"==typeof n.page?n.page:1,p="number"==typeof n.last_page?n.last_page:1;r(o),l(c),j(d),N(p),y("number"==typeof a.total?a.total:null),O.trim()||(0,z.v)("pos:products:v2",{items:o,total:c,last_page:p,active_total:"number"==typeof a.total?a.total:void 0})},"กำลังโหลดข้อมูลสินค้า...")},[er,O]);(0,a.useEffect)(()=>{if(!en)return;if(!eo.current){eo.current=!0,em();return}let e=setTimeout(()=>{em()},300);return()=>clearTimeout(e)},[en,em,O]),(0,R.D)({socket:es,events:[H.b.products.create,H.b.products.update,H.b.products.delete],onRefresh:em,enabled:en,debounceMs:400});let ef=(0,a.useCallback)(async()=>{if(!L&&!(f>=b)){A(!0);try{let e=O.trim(),t=f+1,i=new URLSearchParams;i.set("page",t.toString()),i.set("limit","50"),e&&i.set("q",e);let n=await fetch("/api/pos/products?".concat(i.toString()));if(!n.ok){let e=await n.json().catch(()=>({}));throw Error(e.error||e.message||"โหลดข้อมูลเพิ่มเติมไม่สำเร็จ")}let a=await n.json(),o=a.data||[],c="number"==typeof a.total?a.total:s,d="number"==typeof a.page?a.page:t,p="number"==typeof a.last_page?a.last_page:b;r(e=>{if(0===o.length)return e;let t=new Map(e.map((e,t)=>[e.id,t])),r=[...e];for(let e of o){let i=t.get(e.id);void 0===i?r.push(e):r[i]=e}return r}),l(c),j(d),N(p)}catch(e){d.ZP.error(e instanceof Error?e.message:"โหลดข้อมูลเพิ่มเติมไม่สำเร็จ")}finally{A(!1)}}},[L,f,b,O,s]);(0,a.useEffect)(()=>{let e=el.current;if(!e)return;let t=new IntersectionObserver(e=>{let t=e[0];(null==t?void 0:t.isIntersecting)&&ef()},{root:null,rootMargin:"400px 0px",threshold:0});return t.observe(e),()=>t.disconnect()},[ef]),(0,R.v)(es,{create:H.b.categories.create,update:H.b.categories.update,delete:H.b.categories.delete},ed),(0,R.v)(es,{create:H.b.productsUnit.create,update:H.b.productsUnit.update,delete:H.b.productsUnit.delete},eu);let ej=e=>{et(e)},eb=()=>{ei("กำลังเปิดหน้าจัดการสินค้า..."),e.push("/pos/products/manage/add")},ev=t=>{ei("กำลังเปิดหน้าแก้ไขสินค้า..."),e.push("/pos/products/manage/edit/".concat(t.id))},ew=e=>{p.Z.confirm({title:"ยืนยันการลบสินค้า",content:'คุณต้องการลบสินค้า "'.concat(e.display_name,'" หรือไม่?'),okText:"ลบ",okType:"danger",cancelText:"ยกเลิก",centered:!0,icon:(0,i.jsx)(v.Z,{style:{color:"#EF4444"}}),maskClosable:!0,onOk:async()=>{await er(async()=>{let t=await (0,S.P)();if(!(await fetch("/api/pos/products/delete/".concat(e.id),{method:"DELETE",headers:{"X-CSRF-Token":t}})).ok)throw Error("ไม่สามารถลบสินค้าได้");d.ZP.success('ลบสินค้า "'.concat(e.display_name,'" สำเร็จ'))},"กำลังลบสินค้า...")}})};if(ea)return(0,i.jsx)(G.H,{message:"กำลังตรวจสอบสิทธิ์การใช้งาน..."});if(!en)return(0,i.jsx)(G.H,{message:"คุณไม่มีสิทธิ์เข้าถึงหน้านี้ กำลังพากลับ...",tone:"danger"});let eZ=null!=o?o:t.filter(e=>e.is_active).length,ek=Math.max((s||t.length)-eZ,0),eF=M(ec,ep),eE=eF.isReady,eC=eg||ey;return eC||eE||0!==t.length?(0,i.jsxs)("div",{style:U.container,className:"jsx-8322c199646c885 products-page",children:[(0,i.jsx)("style",{children:I}),(0,i.jsx)(n(),{id:"8322c199646c885",children:".search-input-placeholder-white input::-webkit-input-placeholder{color:rgba(255,255,255,.6)!important}.search-input-placeholder-white input:-moz-placeholder{color:rgba(255,255,255,.6)!important}.search-input-placeholder-white input::-moz-placeholder{color:rgba(255,255,255,.6)!important}.search-input-placeholder-white input:-ms-input-placeholder{color:rgba(255,255,255,.6)!important}.search-input-placeholder-white input::-ms-input-placeholder{color:rgba(255,255,255,.6)!important}.search-input-placeholder-white input::placeholder{color:rgba(255,255,255,.6)!important}.search-input-placeholder-white input{color:white!important}.product-card{cursor:pointer;-webkit-tap-highlight-color:transparent;content-visibility:auto;contain-intrinsic-size:160px 120px}"}),(0,i.jsx)(Y.Z,{title:"สินค้า",subtitle:"".concat(s||t.length," รายการ"),icon:(0,i.jsx)(m.Z,{}),actions:(0,i.jsxs)(u.Z,{size:8,wrap:!0,children:[(0,i.jsx)(g.default,{prefix:(0,i.jsx)(k.Z,{style:{color:"#94A3B8"}}),allowClear:!0,placeholder:"ค้นหาสินค้า (ชื่อ, หมวดหมู่)...",onChange:e=>ej(e.target.value),style:{minWidth:240}}),(0,i.jsx)(c.ZP,{icon:(0,i.jsx)(w.Z,{}),onClick:em}),(0,i.jsx)(c.ZP,{type:"primary",icon:(0,i.jsx)(Z.Z,{}),onClick:eb,disabled:!eE,children:"เพิ่มสินค้า"})]})}),(0,i.jsx)(J.Z,{children:(0,i.jsxs)(X.Z,{children:[!eC&&!eE&&t.length>0&&(0,i.jsx)(K.Z,{title:"ต้องตั้งค่าก่อนเพิ่มสินค้า",children:(0,i.jsx)(x.Z,{message:"ยังตั้งค่าระบบไม่ครบ",description:q(ec,ep),type:"warning",showIcon:!0,action:(0,i.jsxs)("div",{style:{display:"flex",gap:8},className:"jsx-8322c199646c885",children:[!eF.hasCategories&&(0,i.jsx)(c.ZP,{size:"small",type:"primary",ghost:!0,onClick:()=>e.push("/pos/category"),children:"เพิ่มหมวดหมู่"}),!eF.hasUnits&&(0,i.jsx)(c.ZP,{size:"small",type:"primary",ghost:!0,onClick:()=>e.push("/pos/productsUnit"),children:"เพิ่มหน่วยสินค้า"})]})})}),(0,i.jsx)($,{totalProducts:s||t.length,activeProducts:eZ,inactiveProducts:ek}),(0,i.jsx)(K.Z,{title:"รายการสินค้า",extra:(0,i.jsx)("span",{style:{fontWeight:600},className:"jsx-8322c199646c885",children:s?"".concat(t.length,"/").concat(s):t.length}),children:t.length>0?(0,i.jsxs)(i.Fragment,{children:[t.map((e,t)=>(0,i.jsx)(ee,{product:e,index:t,onEdit:ev,onDelete:ew},e.id)),(0,i.jsx)("div",{style:{display:"flex",justifyContent:"center",padding:"16px 0 4px"},className:"jsx-8322c199646c885",children:f<b?(0,i.jsx)(c.ZP,{onClick:ef,loading:L,style:{borderRadius:12},children:"โหลดเพิ่ม"}):(0,i.jsx)(V,{type:"secondary",style:{fontSize:12},children:"ไม่มีสินค้าเพิ่มเติม"})}),(0,i.jsx)("div",{ref:el,style:{height:1},className:"jsx-8322c199646c885"})]}):(0,i.jsx)(Q.Z,{title:O.trim()?"ไม่พบสินค้าที่ค้นหา":"ยังไม่มีสินค้า",description:O.trim()?"ลองค้นหาด้วยคำอื่นหรือล้างการค้นหา":"เพิ่มสินค้ารายการแรกเพื่อเริ่มต้นขาย",action:O.trim()?null:(0,i.jsx)(c.ZP,{type:"primary",icon:(0,i.jsx)(Z.Z,{}),onClick:eb,disabled:!eE,children:"เพิ่มสินค้า"})})})]})})]}):(0,i.jsxs)("div",{className:"products-page",style:U.container,children:[(0,i.jsx)("style",{children:I}),(0,i.jsx)(Y.Z,{title:"สินค้า",subtitle:"ตั้งค่าระบบก่อนเพิ่มสินค้า",icon:(0,i.jsx)(m.Z,{}),actions:(0,i.jsxs)(u.Z,{size:8,wrap:!0,children:[(0,i.jsx)(c.ZP,{icon:(0,i.jsx)(w.Z,{}),onClick:em}),(0,i.jsx)(h.Z,{title:"ต้องเพิ่มหมวดหมู่สินค้าและหน่วยสินค้าก่อน",children:(0,i.jsx)(c.ZP,{type:"primary",icon:(0,i.jsx)(Z.Z,{}),disabled:!0,children:"เพิ่มสินค้า"})})]})}),(0,i.jsx)(J.Z,{children:(0,i.jsx)(X.Z,{children:(0,i.jsx)(Q.Z,{title:"ยังไม่พร้อมเพิ่มสินค้า",description:q(ec,ep),action:(0,i.jsxs)(u.Z,{size:12,wrap:!0,children:[!eF.hasCategories&&(0,i.jsx)(c.ZP,{type:"primary",onClick:()=>e.push("/pos/category"),children:"เพิ่มหมวดหมู่สินค้า"}),!eF.hasUnits&&(0,i.jsx)(c.ZP,{type:"primary",onClick:()=>e.push("/pos/productsUnit"),children:"เพิ่มหน่วยสินค้า"}),(0,i.jsx)(h.Z,{title:"ต้องเพิ่มหมวดหมู่สินค้าและหน่วยสินค้าก่อน",children:(0,i.jsx)(c.ZP,{type:"primary",icon:(0,i.jsx)(Z.Z,{}),disabled:!0,children:"เพิ่มสินค้า"})})]})})})})]})}}},function(e){e.O(0,[8024,4736,8592,1744],function(){return e(e.s=50304)}),_N_E=e.O()}]);