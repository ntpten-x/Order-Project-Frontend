(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6775],{64659:function(e,i,t){Promise.resolve().then(t.bind(t,98108))},98108:function(e,i,t){"use strict";t.r(i),t.d(i,{default:function(){return Z}});var s=t(57437),r=t(2265),l=t(88589),a=t(19878),d=t(34029),n=t(53743),o=t(48651),c=t(90136),p=t(66487),u=t(19683),g=t(99376),h=t(33145),x=t(62376),m=t(72175),y=t(80009),f=t(8900);let{Text:j}=u.default,{pageStyles:b,ManagePageStyles:F}=(0,m.dg)({focusColor:"#4F46E5",focusShadow:"rgba(79, 70, 229, 0.1)",switchGradient:"linear-gradient(135deg, #4F46E5 0%, #4338CA 100%)"}),v=e=>{let{isEdit:i,onBack:t,onDelete:r}=e;return(0,s.jsx)(m.oI,{pageStyles:b,isEdit:i,onBack:t,onDelete:r,titleCreate:"เพิ่มสินค้าใหม่",titleEdit:"แก้ไขข้อมูลสินค้า"})},_=e=>{let{name:i,productName:t,imageUrl:r,price:l,category:a,unit:d}=e;return(0,s.jsxs)("div",{style:{marginTop:24,marginBottom:24,padding:20,background:"#F8FAFC",borderRadius:20,border:"1px dashed #E2E8F0"},children:[(0,s.jsx)(j,{type:"secondary",style:{display:"block",marginBottom:12,fontSize:13,textAlign:"center"},children:"ตัวอย่างการแสดงผล (Live Preview)"}),(0,s.jsx)("div",{style:{width:"100%",maxWidth:280,margin:"0 auto",background:"white",borderRadius:20,overflow:"hidden",boxShadow:"0 10px 30px rgba(0,0,0,0.06)",border:"1px solid #F1F5F9",transition:"all 0.3s ease"},children:(0,s.jsxs)("div",{style:{padding:12,display:"flex",gap:12,alignItems:"center"},children:[(0,s.jsx)("div",{style:{width:72,height:72,borderRadius:16,border:"1px solid #F1F5F9",overflow:"hidden",position:"relative",background:"#F8FAFC",flexShrink:0},children:r&&r.match(/^https?:\/\/.+/)?(0,s.jsx)(h.default,{src:r,alt:"Preview",fill:!0,style:{objectFit:"cover"},sizes:"72px",onError:e=>{e.target.style.display="none"}}):(0,s.jsx)("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #EEF2FF 0%, #E0E7FF 100%)"},children:(0,s.jsx)(x.Z,{style:{fontSize:24,color:"#6366F1",opacity:.8}})})}),(0,s.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:6},children:[(0,s.jsx)(j,{strong:!0,style:{fontSize:16,color:"#1E293B",flex:1},ellipsis:!0,children:i||"ชื่อสินค้า (ไทย)"}),(0,s.jsx)(f.Z,{style:{color:"#10B981",fontSize:14}})]}),(0,s.jsx)(j,{type:"secondary",style:{fontSize:13,display:"block",marginBottom:6,color:"#64748B"},ellipsis:!0,children:t||"Product Name (EN)"}),(0,s.jsxs)("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:[(0,s.jsxs)(y.Z,{style:{borderRadius:6,margin:0,fontSize:11,fontWeight:700,color:"#059669",background:"#ECFDF5",border:"none",padding:"0 8px"},children:["฿",(l||0).toLocaleString()]}),a&&(0,s.jsx)(y.Z,{style:{borderRadius:6,margin:0,fontSize:10,color:"#4F46E5",background:"#EEF2FF",border:"none"},children:a}),d&&(0,s.jsx)(y.Z,{style:{borderRadius:6,margin:0,fontSize:10,color:"#0891B2",background:"#CFFAFE",border:"none"},children:d})]})]})]})})]})},w=e=>{let{isEdit:i,loading:t,onCancel:r}=e;return(0,s.jsx)(m.uM,{pageStyles:b,isEdit:i,loading:t,onCancel:r})};var E=t(97235),k=t(3286),C=t(2938);let{TextArea:S}=l.default;function Z(e){var i,t,h,x;let{params:m}=e,y=(0,g.useRouter)(),[f]=a.Z.useForm(),[j,Z]=(0,r.useState)(!1),[B,I]=(0,r.useState)(!1),[R,z]=(0,r.useState)([]),[V,T]=(0,r.useState)([]),[P,N]=(0,r.useState)(""),[A,W]=(0,r.useState)(""),[D,q]=(0,r.useState)(""),[L,O]=(0,r.useState)(!1),[H,U]=(0,r.useState)(!1),[,X]=(0,r.useState)({}),J=m.mode[0],M=m.mode[1]||null,Y="edit"===J&&!!M,{isAuthorized:$,isChecking:G}=(0,k.e)({requiredRole:"Admin"});(0,r.useEffect)(()=>{(async()=>{q(await (0,E.P)())})()},[]);let K=async()=>{try{let e=await fetch("/api/pos/category");if(e.ok){let i=await e.json();z(i.filter(e=>e.is_active))}}catch(e){console.error("Failed to fetch categories",e)}},Q=async()=>{try{let e=await fetch("/api/pos/productsUnit");if(e.ok){let i=await e.json();T(i.filter(e=>e.is_active))}}catch(e){console.error("Failed to fetch units",e)}},ee=(0,r.useCallback)(async()=>{Z(!0);try{let e=await fetch("/api/pos/products/getById/".concat(M));if(!e.ok)throw Error("ไม่สามารถดึงข้อมูลสินค้าได้");let i=await e.json();f.setFieldsValue({product_name:i.product_name,display_name:i.display_name,description:i.description,img_url:i.img_url,price:parseFloat(i.price),category_id:i.category_id,unit_id:i.unit_id,is_active:i.is_active}),N(i.img_url||""),W(i.display_name||"")}catch(e){console.error(e),d.ZP.error("ไม่สามารถดึงข้อมูลสินค้าได้"),y.push("/pos/products")}finally{Z(!1)}},[M,f,y]);(0,r.useEffect)(()=>{K(),Q(),Y&&ee()},[Y,M,ee]);let ei=async e=>{I(!0);try{if(Y){let i=await fetch("/api/pos/products/update/".concat(M),{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-Token":D},body:JSON.stringify(e)});if(!i.ok){let e=await i.json().catch(()=>({}));throw Error(e.error||e.message||"ไม่สามารถอัปเดตสินค้าได้")}d.ZP.success("อัปเดตสินค้าสำเร็จ")}else{let i=await fetch("/api/pos/products/create",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":D},body:JSON.stringify(e)});if(!i.ok){let e=await i.json().catch(()=>({}));throw Error(e.error||e.message||"ไม่สามารถสร้างสินค้าได้")}d.ZP.success("สร้างสินค้าสำเร็จ")}y.push("/pos/products")}catch(e){console.error(e),d.ZP.error(e.message||(Y?"ไม่สามารถอัปเดตสินค้าได้":"ไม่สามารถสร้างสินค้าได้"))}finally{I(!1)}},et=()=>y.push("/pos/products");return G?(0,s.jsx)(C.H,{message:"กำลังตรวจสอบสิทธิ์..."}):$?(0,s.jsxs)("div",{className:"manage-page",style:b.container,children:[(0,s.jsx)(F,{}),(0,s.jsx)(v,{isEdit:Y,onBack:et,onDelete:Y?()=>{M&&n.Z.confirm({title:"ยืนยันการลบสินค้า",content:'คุณต้องการลบสินค้า "'.concat(A,'" หรือไม่?'),okText:"ลบ",okType:"danger",cancelText:"ยกเลิก",centered:!0,onOk:async()=>{try{if(!(await fetch("/api/pos/products/delete/".concat(M),{method:"DELETE",headers:{"X-CSRF-Token":D}})).ok)throw Error("ไม่สามารถลบสินค้าได้");d.ZP.success("ลบสินค้าสำเร็จ"),y.push("/pos/products")}catch(e){console.error(e),d.ZP.error("ไม่สามารถลบสินค้าได้")}}})}:void 0}),(0,s.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 340px",gap:24,alignItems:"start",maxWidth:1200,margin:"0 auto"},children:[(0,s.jsx)("div",{className:"manage-form-card",style:{...b.formCard,gridColumn:"1 / span 1",margin:0},children:j?(0,s.jsx)("div",{style:{display:"flex",justifyContent:"center",padding:"60px 0"},children:(0,s.jsx)(o.Z,{size:"large"})}):(0,s.jsxs)(a.Z,{form:f,layout:"vertical",onFinish:ei,requiredMark:!1,autoComplete:"off",initialValues:{is_active:!0,price:0},onValuesChange:e=>{void 0!==e.img_url&&N(e.img_url),void 0!==e.display_name&&W(e.display_name),X({})},children:[(0,s.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16},children:[(0,s.jsx)(a.Z.Item,{name:"display_name",label:"ชื่อที่แสดง (ภาษาไทย) *",rules:[{required:!0,message:"กรุณากรอกชื่อที่แสดง"},{max:100,message:"ความยาวต้องไม่เกิน 100 ตัวอักษร"}],children:(0,s.jsx)(l.default,{size:"large",placeholder:"เช่น น้ำเปล่า, กาแฟ",maxLength:100})}),(0,s.jsx)(a.Z.Item,{name:"product_name",label:"ชื่อสินค้า (ภาษาอังกฤษ) *",rules:[{required:!0,message:"กรุณากรอกชื่อสินค้า"},{pattern:/^[a-zA-Z0-9\s\-_().]*$/,message:"กรุณากรอกภาษาอังกฤษเท่านั้น"},{max:100,message:"ความยาวต้องไม่เกิน 100 ตัวอักษร"}],children:(0,s.jsx)(l.default,{size:"large",placeholder:"如 Water, Coffee",maxLength:100})})]}),(0,s.jsx)(a.Z.Item,{name:"price",label:"ราคา (บาท) *",rules:[{required:!0,message:"กรุณากรอกราคา"},{type:"number",min:0,message:"ราคาต้องไม่ติดลบ"}],children:(0,s.jsx)(c.Z,{size:"large",placeholder:"0.00",min:0,precision:2,style:{width:"100%",height:45,fontSize:16,borderRadius:12},formatter:e=>"".concat(e).replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:e=>e?parseFloat(e.replace(/\$\s?|(,*)/g,"")):0,controls:!1})}),(0,s.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16},children:[(0,s.jsxs)(a.Z.Item,{name:"category_id",label:"หมวดหมู่ *",rules:[{required:!0,message:"กรุณาเลือกหมวดหมู่"}],children:[(0,s.jsxs)("div",{className:"custom-select",onClick:()=>O(!0),style:{border:"1px solid #d9d9d9",borderRadius:12,padding:"10px 16px",cursor:"pointer",height:45,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,s.jsx)("span",{style:{color:f.getFieldValue("category_id")?"#1E293B":"#bfbfbf"},children:(null===(i=R.find(e=>e.id===f.getFieldValue("category_id")))||void 0===i?void 0:i.display_name)||"เลือกหมวดหมู่"}),(0,s.jsx)("span",{style:{color:"#94A3B8"},children:"▼"})]}),(0,s.jsx)(a.Z.Item,{name:"category_id",hidden:!0,children:(0,s.jsx)(l.default,{})})]}),(0,s.jsxs)(a.Z.Item,{name:"unit_id",label:"หน่วยสินค้า *",rules:[{required:!0,message:"กรุณาเลือกหน่วยสินค้า"}],children:[(0,s.jsxs)("div",{className:"custom-select",onClick:()=>U(!0),style:{border:"1px solid #d9d9d9",borderRadius:12,padding:"10px 16px",cursor:"pointer",height:45,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,s.jsx)("span",{style:{color:f.getFieldValue("unit_id")?"#1E293B":"#bfbfbf"},children:(null===(t=V.find(e=>e.id===f.getFieldValue("unit_id")))||void 0===t?void 0:t.display_name)||"เลือกหน่วย"}),(0,s.jsx)("span",{style:{color:"#94A3B8"},children:"▼"})]}),(0,s.jsx)(a.Z.Item,{name:"unit_id",hidden:!0,children:(0,s.jsx)(l.default,{})})]})]}),(0,s.jsx)(a.Z.Item,{name:"img_url",label:"รูปภาพ URL",children:(0,s.jsx)(l.default,{size:"large",placeholder:"https://example.com/image.jpg"})}),(0,s.jsx)(a.Z.Item,{name:"description",label:"รายละเอียดเพิ่มเติม",children:(0,s.jsx)(S,{rows:4,placeholder:"รายละเอียด...",style:{borderRadius:12}})}),(0,s.jsx)(a.Z.Item,{name:"is_active",label:"สถานะ",valuePropName:"checked",children:(0,s.jsx)(p.Z,{checkedChildren:"เปิดใช้งาน",unCheckedChildren:"ปิดใช้งาน"})}),(0,s.jsx)(w,{isEdit:Y,loading:B,onCancel:et})]})}),(0,s.jsx)("div",{style:{position:"sticky",top:24,display:"flex",flexDirection:"column",gap:16},children:(0,s.jsxs)("div",{style:{background:"white",borderRadius:24,padding:24,boxShadow:"0 4px 20px rgba(0,0,0,0.04)",border:"1px solid #F1F5F9"},children:[(0,s.jsx)(u.default.Title,{level:5,style:{margin:0,marginBottom:16,color:"#475569"},children:"ตัวอย่างการแสดงผล"}),(0,s.jsx)(_,{name:A,productName:f.getFieldValue("product_name"),imageUrl:P,price:f.getFieldValue("price"),category:null===(h=R.find(e=>e.id===f.getFieldValue("category_id")))||void 0===h?void 0:h.display_name,unit:null===(x=V.find(e=>e.id===f.getFieldValue("unit_id")))||void 0===x?void 0:x.display_name})]})})]}),(0,s.jsx)(n.Z,{title:"เลือกหมวดหมู่",open:L,onCancel:()=>O(!1),footer:null,centered:!0,width:400,zIndex:10001,styles:{body:{borderRadius:20,overflow:"hidden",padding:0}},children:(0,s.jsx)("div",{style:{maxHeight:"60vh",overflowY:"auto",padding:16,background:"#F8FAFC"},children:(0,s.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:8},children:R.map(e=>(0,s.jsxs)("div",{onClick:()=>{f.setFieldsValue({category_id:e.id}),O(!1)},style:{padding:"16px",border:"1px solid ".concat(f.getFieldValue("category_id")===e.id?"#4F46E5":"#E2E8F0"),borderRadius:16,cursor:"pointer",background:f.getFieldValue("category_id")===e.id?"#F5F3FF":"#fff",display:"flex",alignItems:"center",justifyContent:"space-between",transition:"all 0.2s",boxShadow:"0 2px 4px rgba(0,0,0,0.02)"},children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{style:{fontWeight:600,color:"#1E293B"},children:e.display_name}),(0,s.jsx)("div",{style:{fontSize:12,color:"#64748B"},children:e.category_name})]}),f.getFieldValue("category_id")===e.id&&(0,s.jsx)("span",{style:{color:"#4F46E5",fontWeight:"bold"},children:"✓"})]},e.id))})})}),(0,s.jsx)(n.Z,{title:"เลือกหน่วยสินค้า",open:H,onCancel:()=>U(!1),footer:null,centered:!0,width:400,zIndex:10001,styles:{body:{borderRadius:20,overflow:"hidden",padding:0}},children:(0,s.jsx)("div",{style:{maxHeight:"60vh",overflowY:"auto",padding:16,background:"#F8FAFC"},children:(0,s.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:8},children:V.map(e=>(0,s.jsxs)("div",{onClick:()=>{f.setFieldsValue({unit_id:e.id}),U(!1)},style:{padding:"16px",border:"1px solid ".concat(f.getFieldValue("unit_id")===e.id?"#10B981":"#E2E8F0"),borderRadius:16,cursor:"pointer",background:f.getFieldValue("unit_id")===e.id?"#ECFDF5":"#fff",display:"flex",alignItems:"center",justifyContent:"space-between",transition:"all 0.2s",boxShadow:"0 2px 4px rgba(0,0,0,0.02)"},children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{style:{fontWeight:600,color:"#1E293B"},children:e.display_name}),(0,s.jsx)("div",{style:{fontSize:12,color:"#64748B"},children:e.unit_name})]}),f.getFieldValue("unit_id")===e.id&&(0,s.jsx)("span",{style:{color:"#10B981",fontWeight:"bold"},children:"✓"})]},e.id))})})})]}):(0,s.jsx)(C.H,{message:"คุณไม่มีสิทธิ์เข้าถึงหน้านี้",tone:"danger"})}}},function(e){e.O(0,[8024,4736,8592,1744],function(){return e(e.s=64659)}),_N_E=e.O()}]);