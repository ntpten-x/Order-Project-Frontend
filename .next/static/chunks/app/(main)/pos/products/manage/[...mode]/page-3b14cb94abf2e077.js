(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6775],{64659:function(e,t,a){Promise.resolve().then(a.bind(a,98108))},96473:function(e,t,a){"use strict";a.d(t,{Z:function(){return l}});var r=a(2265),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M482 152h60q8 0 8 8v704q0 8-8 8h-60q-8 0-8-8V160q0-8 8-8z"}},{tag:"path",attrs:{d:"M192 474h672q8 0 8 8v60q0 8-8 8H160q-8 0-8-8v-60q0-8 8-8z"}}]},name:"plus",theme:"outlined"},i=a(55015);function n(){return(n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}var l=r.forwardRef((e,t)=>r.createElement(i.Z,n({},e,{ref:t,icon:s})))},62376:function(e,t,a){"use strict";a.d(t,{Z:function(){return l}});var r=a(2265),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M882 272.1V144c0-17.7-14.3-32-32-32H174c-17.7 0-32 14.3-32 32v128.1c-16.7 1-30 14.9-30 31.9v131.7a177 177 0 0014.4 70.4c4.3 10.2 9.6 19.8 15.6 28.9v345c0 17.6 14.3 32 32 32h676c17.7 0 32-14.3 32-32V535a175 175 0 0015.6-28.9c9.5-22.3 14.4-46 14.4-70.4V304c0-17-13.3-30.9-30-31.9zM214 184h596v88H214v-88zm362 656.1H448V736h128v104.1zm234 0H640V704c0-17.7-14.3-32-32-32H416c-17.7 0-32 14.3-32 32v136.1H214V597.9c2.9 1.4 5.9 2.8 9 4 22.3 9.4 46 14.1 70.4 14.1s48-4.7 70.4-14.1c13.8-5.8 26.8-13.2 38.7-22.1.2-.1.4-.1.6 0a180.4 180.4 0 0038.7 22.1c22.3 9.4 46 14.1 70.4 14.1 24.4 0 48-4.7 70.4-14.1 13.8-5.8 26.8-13.2 38.7-22.1.2-.1.4-.1.6 0a180.4 180.4 0 0038.7 22.1c22.3 9.4 46 14.1 70.4 14.1 24.4 0 48-4.7 70.4-14.1 3-1.3 6-2.6 9-4v242.2zm30-404.4c0 59.8-49 108.3-109.3 108.3-40.8 0-76.4-22.1-95.2-54.9-2.9-5-8.1-8.1-13.9-8.1h-.6c-5.7 0-11 3.1-13.9 8.1A109.24 109.24 0 01512 544c-40.7 0-76.2-22-95-54.7-3-5.1-8.4-8.3-14.3-8.3s-11.4 3.2-14.3 8.3a109.63 109.63 0 01-95.1 54.7C233 544 184 495.5 184 435.7v-91.2c0-.3.2-.5.5-.5h655c.3 0 .5.2.5.5v91.2z"}}]},name:"shop",theme:"outlined"},i=a(55015);function n(){return(n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}var l=r.forwardRef((e,t)=>r.createElement(i.Z,n({},e,{ref:t,icon:s})))},98108:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return E}});var r=a(57437),s=a(2265),i=a(88589),n=a(44967),l=a(34029),o=a(53743),c=a(48651),d=a(33477),u=a(93834),p=a(80336),h=a(99376),f=a(33145),m=a(82646),g=a(62376),y=a(72175);let{Text:v}=m.default,{pageStyles:x,ManagePageStyles:j}=(0,y.dg)({focusColor:"#1890ff",focusShadow:"rgba(24, 144, 255, 0.1)",switchGradient:"linear-gradient(135deg, #52c41a 0%, #389e0d 100%)"}),w=e=>{let{isEdit:t,onBack:a,onDelete:s}=e;return(0,r.jsx)(y.oI,{pageStyles:x,isEdit:t,onBack:a,onDelete:s,titleCreate:"เพิ่มสินค้า",titleEdit:"แก้ไขสินค้า"})},b=e=>{let{url:t,name:a}=e;return(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:14,padding:16,background:"#fafafa",borderRadius:16,marginTop:12},children:[(0,r.jsx)("div",{style:{width:80,height:80,borderRadius:14,border:"2px solid white",boxShadow:"0 4px 12px rgba(0,0,0,0.08)",overflow:"hidden",position:"relative",flexShrink:0},children:t?(0,r.jsx)(f.default,{src:t,alt:a||"Preview",fill:!0,style:{objectFit:"cover"},sizes:"80px"}):(0,r.jsx)("div",{style:{width:"100%",height:"100%",background:"linear-gradient(135deg, #e6f7ff 0%, #bae7ff 100%)",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,r.jsx)(g.Z,{style:{fontSize:28,color:"#1890ff",opacity:.5}})})}),(0,r.jsxs)("div",{children:[(0,r.jsx)(v,{strong:!0,style:{display:"block",marginBottom:4},children:a||"ตัวอย่างรูปภาพ"}),(0,r.jsx)(v,{type:"secondary",style:{fontSize:12},children:t?"แสดงตัวอย่างจาก URL":"ยังไม่มีรูปภาพ"})]})]})},_=e=>{let{isEdit:t,loading:a,onCancel:s}=e;return(0,r.jsx)(y.uM,{pageStyles:x,isEdit:t,loading:a,onCancel:s})};var k=a(97235),Z=a(3286),S=a(2938);let{TextArea:C}=i.default;function E(e){let{params:t}=e,a=(0,h.useRouter)(),[f]=n.Z.useForm(),[m,g]=(0,s.useState)(!1),[y,v]=(0,s.useState)(!1),[E,z]=(0,s.useState)([]),[O,P]=(0,s.useState)([]),[q,T]=(0,s.useState)(""),[F,R]=(0,s.useState)(""),[I,V]=(0,s.useState)(""),H=t.mode[0],B=t.mode[1]||null,N="edit"===H&&!!B,{isAuthorized:D,isChecking:M}=(0,Z.e)({requiredRole:"Admin"});(0,s.useEffect)(()=>{(async()=>{V(await (0,k.P)())})()},[]);let L=async()=>{try{let e=await fetch("/api/pos/category");if(e.ok){let t=await e.json();z(t.filter(e=>e.is_active))}}catch(e){console.error("Failed to fetch categories",e)}},A=async()=>{try{let e=await fetch("/api/pos/productsUnit");if(e.ok){let t=await e.json();P(t.filter(e=>e.is_active))}}catch(e){console.error("Failed to fetch units",e)}},U=(0,s.useCallback)(async()=>{g(!0);try{let e=await fetch("/api/pos/products/getById/".concat(B));if(!e.ok)throw Error("ไม่สามารถดึงข้อมูลสินค้าได้");let t=await e.json();f.setFieldsValue({product_name:t.product_name,display_name:t.display_name,description:t.description,img_url:t.img_url,price:parseFloat(t.price),category_id:t.category_id,unit_id:t.unit_id,is_active:t.is_active}),T(t.img_url||""),R(t.display_name||"")}catch(e){console.error(e),l.ZP.error("ไม่สามารถดึงข้อมูลสินค้าได้"),a.push("/pos/products")}finally{g(!1)}},[B,f,a]);(0,s.useEffect)(()=>{L(),A(),N&&U()},[N,B,U]);let X=async e=>{v(!0);try{if(N){let t=await fetch("/api/pos/products/update/".concat(B),{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-Token":I},body:JSON.stringify(e)});if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.error||e.message||"ไม่สามารถอัปเดตสินค้าได้")}l.ZP.success("อัปเดตสินค้าสำเร็จ")}else{let t=await fetch("/api/pos/products/create",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":I},body:JSON.stringify(e)});if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.error||e.message||"ไม่สามารถสร้างสินค้าได้")}l.ZP.success("สร้างสินค้าสำเร็จ")}a.push("/pos/products")}catch(e){console.error(e),l.ZP.error(e.message||(N?"ไม่สามารถอัปเดตสินค้าได้":"ไม่สามารถสร้างสินค้าได้"))}finally{v(!1)}},$=()=>a.push("/pos/products");return M?(0,r.jsx)(S.H,{message:"กำลังตรวจสอบสิทธิ์..."}):D?(0,r.jsxs)("div",{className:"manage-page",style:x.container,children:[(0,r.jsx)(j,{}),(0,r.jsx)(w,{isEdit:N,onBack:$,onDelete:N?()=>{B&&o.Z.confirm({title:"ยืนยันการลบสินค้า",content:'คุณต้องการลบสินค้า "'.concat(F,'" หรือไม่?'),okText:"ลบ",okType:"danger",cancelText:"ยกเลิก",centered:!0,onOk:async()=>{try{if(!(await fetch("/api/pos/products/delete/".concat(B),{method:"DELETE",headers:{"X-CSRF-Token":I}})).ok)throw Error("ไม่สามารถลบสินค้าได้");l.ZP.success("ลบสินค้าสำเร็จ"),a.push("/pos/products")}catch(e){console.error(e),l.ZP.error("ไม่สามารถลบสินค้าได้")}}})}:void 0}),(0,r.jsx)("div",{className:"manage-form-card",style:x.formCard,children:m?(0,r.jsx)("div",{style:{display:"flex",justifyContent:"center",padding:"60px 0"},children:(0,r.jsx)(c.Z,{size:"large"})}):(0,r.jsxs)(n.Z,{form:f,layout:"vertical",onFinish:X,requiredMark:!1,autoComplete:"off",initialValues:{is_active:!0,price:0},onValuesChange:e=>{void 0!==e.img_url&&T(e.img_url),void 0!==e.display_name&&R(e.display_name)},children:[(0,r.jsx)(n.Z.Item,{name:"product_name",label:"ชื่อสินค้า (ภาษาอังกฤษ) *",rules:[{required:!0,message:"กรุณากรอกชื่อสินค้า"},{pattern:/^[a-zA-Z0-9\s\-_().]*$/,message:"กรุณากรอกภาษาอังกฤษเท่านั้น"},{max:100,message:"ความยาวต้องไม่เกิน 100 ตัวอักษร"}],children:(0,r.jsx)(i.default,{size:"large",placeholder:"เช่น Water, Coffee, Tea",maxLength:100})}),(0,r.jsx)(n.Z.Item,{name:"display_name",label:"ชื่อที่แสดง (ภาษาไทย) *",rules:[{required:!0,message:"กรุณากรอกชื่อที่แสดง"},{max:100,message:"ความยาวต้องไม่เกิน 100 ตัวอักษร"}],children:(0,r.jsx)(i.default,{size:"large",placeholder:"เช่น น้ำเปล่า, กาแฟ, ชา",maxLength:100})}),(0,r.jsx)(n.Z.Item,{name:"price",label:"ราคา (บาท) *",rules:[{required:!0,message:"กรุณากรอกราคา"},{type:"number",min:0,message:"ราคาต้องไม่ติดลบ"}],children:(0,r.jsx)(d.Z,{size:"large",placeholder:"0.00",min:0,precision:2,style:{width:"100%",height:45,fontSize:16},inputMode:"decimal",controls:!1,formatter:e=>"".concat(e).replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:e=>e.replace(/\$\s?|(,*)/g,""),onKeyDown:e=>{var t;/^[0-9]$/.test(e.key)||["Backspace","Delete","ArrowLeft","ArrowRight","Tab","Enter","."].includes(e.key)||e.preventDefault(),"."===e.key&&(null===(t=f.getFieldValue("price"))||void 0===t?void 0:t.toString().includes("."))&&e.preventDefault()}})}),(0,r.jsx)(n.Z.Item,{name:"category_id",label:"หมวดหมู่ *",rules:[{required:!0,message:"กรุณาเลือกหมวดหมู่"}],children:(0,r.jsx)(u.default,{size:"large",placeholder:"เลือกหมวดหมู่",showSearch:!0,optionFilterProp:"children",children:E.map(e=>(0,r.jsxs)(u.default.Option,{value:e.id,children:[e.display_name," (",e.category_name,")"]},e.id))})}),(0,r.jsx)(n.Z.Item,{name:"unit_id",label:"หน่วยสินค้า *",rules:[{required:!0,message:"กรุณาเลือกหน่วยสินค้า"}],children:(0,r.jsx)(u.default,{size:"large",placeholder:"เลือกหน่วย",showSearch:!0,optionFilterProp:"children",children:O.map(e=>(0,r.jsxs)(u.default.Option,{value:e.id,children:[e.display_name," (",e.unit_name,")"]},e.id))})}),(0,r.jsx)(n.Z.Item,{name:"img_url",label:"รูปภาพ URL",children:(0,r.jsx)(i.default,{size:"large",placeholder:"https://example.com/image.jpg"})}),(0,r.jsx)(b,{url:q,name:F}),(0,r.jsx)(n.Z.Item,{name:"description",label:"รายละเอียด",style:{marginTop:20},children:(0,r.jsx)(C,{rows:4,placeholder:"รายละเอียดเพิ่มเติม...",style:{borderRadius:12}})}),(0,r.jsx)(n.Z.Item,{name:"is_active",label:"สถานะการใช้งาน",valuePropName:"checked",children:(0,r.jsx)(p.Z,{checkedChildren:"ใช้งาน",unCheckedChildren:"ไม่ใช้งาน"})}),(0,r.jsx)(_,{isEdit:N,loading:y,onCancel:$})]})})]}):(0,r.jsx)(S.H,{message:"คุณไม่มีสิทธิ์เข้าถึงหน้านี้",tone:"danger"})}}},function(e){e.O(0,[5015,7717,7698,742,3211,7993,8651,2646,6207,7213,9021,2224,3248,5616,8589,5496,3834,4967,4547,9356,5775,4243,2971,2117,1744],function(){return e(e.s=64659)}),_N_E=e.O()}]);