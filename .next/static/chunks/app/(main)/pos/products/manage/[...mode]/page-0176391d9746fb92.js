(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6775],{64659:function(e,i,r){Promise.resolve().then(r.bind(r,98108))},98108:function(e,i,r){"use strict";r.r(i),r.d(i,{default:function(){return B}});var l=r(57437),t=r(2265),s=r(88589),d=r(19878),a=r(34029),n=r(53743),o=r(50742),c=r(48651),p=r(90136),u=r(66487),g=r(60283),h=r(99376),m=r(25193),y=r(37410),x=r(20148),f=r(33145),j=r(62376),b=r(72175),v=r(80009),F=r(8900);let{Text:_}=g.default,{pageStyles:w,ManagePageStyles:k}=(0,b.dg)({focusColor:"#4F46E5",focusShadow:"rgba(79, 70, 229, 0.1)",switchGradient:"linear-gradient(135deg, #4F46E5 0%, #4338CA 100%)"}),C=e=>{var i;let{name:r,productName:t,imageUrl:s,price:d,priceDelivery:a,category:n,unit:o}=e;return(0,l.jsxs)("div",{style:{marginTop:24,marginBottom:24,padding:20,background:"#F8FAFC",borderRadius:20,border:"1px dashed #E2E8F0"},children:[(0,l.jsx)(_,{type:"secondary",style:{display:"block",marginBottom:12,fontSize:13,textAlign:"center"},children:"ตัวอย่างการแสดงผล (Live Preview)"}),(0,l.jsx)("div",{style:{width:"100%",maxWidth:280,margin:"0 auto",background:"white",borderRadius:20,overflow:"hidden",boxShadow:"0 10px 30px rgba(0,0,0,0.06)",border:"1px solid #F1F5F9",transition:"all 0.3s ease"},children:(0,l.jsxs)("div",{style:{padding:12,display:"flex",gap:12,alignItems:"center"},children:[(0,l.jsx)("div",{style:{width:72,height:72,borderRadius:16,border:"1px solid #F1F5F9",overflow:"hidden",position:"relative",background:"#F8FAFC",flexShrink:0},children:s&&s.match(/^https?:\/\/.+/)?(0,l.jsx)(f.default,{src:s,alt:"Preview",fill:!0,style:{objectFit:"cover"},sizes:"72px",onError:e=>{e.target.style.display="none"}}):(0,l.jsx)("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #EEF2FF 0%, #E0E7FF 100%)"},children:(0,l.jsx)(j.Z,{style:{fontSize:24,color:"#6366F1",opacity:.8}})})}),(0,l.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,l.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:6},children:[(0,l.jsx)(_,{strong:!0,style:{fontSize:16,color:"#1E293B",flex:1},ellipsis:!0,children:r||"ชื่อสินค้า (ไทย)"}),(0,l.jsx)(F.Z,{style:{color:"#10B981",fontSize:14}})]}),(0,l.jsx)(_,{type:"secondary",style:{fontSize:13,display:"block",marginBottom:6,color:"#64748B"},ellipsis:!0,children:t||"Product Name (EN)"}),(0,l.jsxs)("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:[(0,l.jsxs)(v.Z,{style:{borderRadius:6,margin:0,fontSize:11,fontWeight:700,color:"#059669",background:"#ECFDF5",border:"none",padding:"0 8px"},children:["฿",(d||0).toLocaleString()]}),(0,l.jsxs)(v.Z,{style:{borderRadius:6,margin:0,fontSize:11,fontWeight:700,color:"#db2777",background:"#fdf2f8",border:"none",padding:"0 8px"},children:["Delivery ฿",Number(null!==(i=null!=a?a:d)&&void 0!==i?i:0).toLocaleString()]}),n&&(0,l.jsx)(v.Z,{style:{borderRadius:6,margin:0,fontSize:10,color:"#4F46E5",background:"#EEF2FF",border:"none"},children:n}),o&&(0,l.jsx)(v.Z,{style:{borderRadius:6,margin:0,fontSize:10,color:"#0891B2",background:"#CFFAFE",border:"none"},children:o})]})]})]})})]})},E=e=>{let{isEdit:i,loading:r,onCancel:t}=e;return(0,l.jsx)(b.uM,{pageStyles:w,isEdit:i,loading:r,onCancel:t})};var S=r(97235),Z=r(67918),z=r(2938);let{TextArea:R}=s.default;function B(e){var i,r,f,j;let{params:b}=e,v=(0,h.useRouter)(),[F]=d.Z.useForm(),[_,B]=(0,t.useState)(!1),[I,V]=(0,t.useState)(!1),[T,N]=(0,t.useState)([]),[P,A]=(0,t.useState)([]),[W,D]=(0,t.useState)(""),[q,L]=(0,t.useState)(""),[O,H]=(0,t.useState)(""),[U,M]=(0,t.useState)(!1),[X,$]=(0,t.useState)(!1),[,J]=(0,t.useState)({}),Y=b.mode[0],G=b.mode[1]||null,K="edit"===Y&&!!G,{isAuthorized:Q,isChecking:ee}=(0,Z.e)({allowedRoles:["Admin","Manager"]});(0,t.useEffect)(()=>{(async()=>{H(await (0,S.P)())})()},[]);let ei=async()=>{try{let e=await fetch("/api/pos/category");if(e.ok){let i=await e.json();N(i.filter(e=>e.is_active))}}catch(e){console.error("Failed to fetch categories",e)}},er=async()=>{try{let e=await fetch("/api/pos/productsUnit");if(e.ok){let i=await e.json();A(i.filter(e=>e.is_active))}}catch(e){console.error("Failed to fetch units",e)}},el=(0,t.useCallback)(async()=>{B(!0);try{var e,i;let r=await fetch("/api/pos/products/getById/".concat(G));if(!r.ok)throw Error("ไม่สามารถดึงข้อมูลสินค้าได้");let l=await r.json();F.setFieldsValue({product_name:l.product_name,display_name:l.display_name,description:l.description,img_url:l.img_url,price:parseFloat(l.price),price_delivery:Number(null!==(i=null!==(e=l.price_delivery)&&void 0!==e?e:l.price)&&void 0!==i?i:0),category_id:l.category_id,unit_id:l.unit_id,is_active:l.is_active}),D(l.img_url||""),L(l.display_name||"")}catch(e){console.error(e),a.ZP.error("ไม่สามารถดึงข้อมูลสินค้าได้"),v.push("/pos/products")}finally{B(!1)}},[G,F,v]);(0,t.useEffect)(()=>{ei(),er(),K&&el()},[K,G,el]);let et=async e=>{V(!0);try{if(K){let i=await fetch("/api/pos/products/update/".concat(G),{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-Token":O},body:JSON.stringify(e)});if(!i.ok){let e=await i.json().catch(()=>({}));throw Error(e.error||e.message||"ไม่สามารถอัปเดตสินค้าได้")}a.ZP.success("อัปเดตสินค้าสำเร็จ")}else{let i=await fetch("/api/pos/products/create",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":O},body:JSON.stringify(e)});if(!i.ok){let e=await i.json().catch(()=>({}));throw Error(e.error||e.message||"ไม่สามารถสร้างสินค้าได้")}a.ZP.success("สร้างสินค้าสำเร็จ")}v.push("/pos/products")}catch(e){console.error(e),a.ZP.error(e.message||(K?"ไม่สามารถอัปเดตสินค้าได้":"ไม่สามารถสร้างสินค้าได้"))}finally{V(!1)}},es=()=>v.push("/pos/products");return ee?(0,l.jsx)(z.H,{message:"กำลังตรวจสอบสิทธิ์..."}):Q?(0,l.jsxs)("div",{className:"manage-page",style:w.container,children:[(0,l.jsx)(k,{}),(0,l.jsx)(x.Z,{title:K?"แก้ไขสินค้า":"เพิ่มสินค้า",subtitle:K?"แก้ไขข้อมูลสินค้า":"สร้างสินค้าใหม่",onBack:es,actions:K?(0,l.jsx)(o.ZP,{danger:!0,onClick:()=>{G&&n.Z.confirm({title:"ยืนยันการลบสินค้า",content:'คุณต้องการลบสินค้า "'.concat(q,'" หรือไม่?'),okText:"ลบ",okType:"danger",cancelText:"ยกเลิก",centered:!0,onOk:async()=>{try{if(!(await fetch("/api/pos/products/delete/".concat(G),{method:"DELETE",headers:{"X-CSRF-Token":O}})).ok)throw Error("ไม่สามารถลบสินค้าได้");a.ZP.success("ลบสินค้าสำเร็จ"),v.push("/pos/products")}catch(e){console.error(e),a.ZP.error("ไม่สามารถลบสินค้าได้")}}})},children:"ลบ"}):null}),(0,l.jsx)(m.Z,{maxWidth:1200,children:(0,l.jsx)(y.Z,{style:{background:"transparent",border:"none"},children:(0,l.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 340px",gap:24,alignItems:"start",margin:0},children:[(0,l.jsx)("div",{className:"manage-form-card",style:{...w.formCard,gridColumn:"1 / span 1",margin:0},children:_?(0,l.jsx)("div",{style:{display:"flex",justifyContent:"center",padding:"60px 0"},children:(0,l.jsx)(c.Z,{size:"large"})}):(0,l.jsxs)(d.Z,{form:F,layout:"vertical",onFinish:et,requiredMark:!1,autoComplete:"off",initialValues:{is_active:!0,price:0,price_delivery:0},onValuesChange:e=>{void 0!==e.img_url&&D(e.img_url),void 0!==e.display_name&&L(e.display_name),K||void 0===e.price||F.isFieldTouched("price_delivery")||F.setFieldsValue({price_delivery:e.price}),J({})},children:[(0,l.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16},children:[(0,l.jsx)(d.Z.Item,{name:"display_name",label:"ชื่อที่แสดง (ภาษาไทย) *",rules:[{required:!0,message:"กรุณากรอกชื่อที่แสดง"},{max:100,message:"ความยาวต้องไม่เกิน 100 ตัวอักษร"}],children:(0,l.jsx)(s.default,{size:"large",placeholder:"เช่น น้ำเปล่า, กาแฟ",maxLength:100})}),(0,l.jsx)(d.Z.Item,{name:"product_name",label:"ชื่อสินค้า (ภาษาอังกฤษ) *",rules:[{required:!0,message:"กรุณากรอกชื่อสินค้า"},{pattern:/^[a-zA-Z0-9\s\-_().]*$/,message:"กรุณากรอกภาษาอังกฤษเท่านั้น"},{max:100,message:"ความยาวต้องไม่เกิน 100 ตัวอักษร"}],children:(0,l.jsx)(s.default,{size:"large",placeholder:"如 Water, Coffee",maxLength:100})})]}),(0,l.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16},children:[(0,l.jsx)(d.Z.Item,{name:"price",label:"ราคา (หน้าร้าน) *",rules:[{required:!0,message:"กรุณากรอกราคา"},{type:"number",min:0,message:"ราคาต้องไม่ติดลบ"}],children:(0,l.jsx)(p.Z,{size:"large",placeholder:"0.00",min:0,precision:2,style:{width:"100%",height:45,fontSize:16,borderRadius:12},formatter:e=>"".concat(e).replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:e=>e?parseFloat(e.replace(/\$\s?|(,*)/g,"")):0,controls:!1})}),(0,l.jsx)(d.Z.Item,{name:"price_delivery",label:"ราคา (Delivery) *",rules:[{required:!0,message:"กรุณากรอกราคา Delivery"},{type:"number",min:0,message:"ราคาต้องไม่ติดลบ"}],children:(0,l.jsx)(p.Z,{size:"large",placeholder:"0.00",min:0,precision:2,style:{width:"100%",height:45,fontSize:16,borderRadius:12},formatter:e=>"".concat(e).replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:e=>e?parseFloat(e.replace(/\$\s?|(,*)/g,"")):0,controls:!1})})]}),(0,l.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16},children:[(0,l.jsxs)(d.Z.Item,{name:"category_id",label:"หมวดหมู่ *",rules:[{required:!0,message:"กรุณาเลือกหมวดหมู่"}],children:[(0,l.jsxs)("div",{className:"custom-select",onClick:()=>M(!0),style:{border:"1px solid #d9d9d9",borderRadius:12,padding:"10px 16px",cursor:"pointer",height:45,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,l.jsx)("span",{style:{color:F.getFieldValue("category_id")?"#1E293B":"#bfbfbf"},children:(null===(i=T.find(e=>e.id===F.getFieldValue("category_id")))||void 0===i?void 0:i.display_name)||"เลือกหมวดหมู่"}),(0,l.jsx)("span",{style:{color:"#94A3B8"},children:"▼"})]}),(0,l.jsx)(d.Z.Item,{name:"category_id",hidden:!0,children:(0,l.jsx)(s.default,{})})]}),(0,l.jsxs)(d.Z.Item,{name:"unit_id",label:"หน่วยสินค้า *",rules:[{required:!0,message:"กรุณาเลือกหน่วยสินค้า"}],children:[(0,l.jsxs)("div",{className:"custom-select",onClick:()=>$(!0),style:{border:"1px solid #d9d9d9",borderRadius:12,padding:"10px 16px",cursor:"pointer",height:45,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,l.jsx)("span",{style:{color:F.getFieldValue("unit_id")?"#1E293B":"#bfbfbf"},children:(null===(r=P.find(e=>e.id===F.getFieldValue("unit_id")))||void 0===r?void 0:r.display_name)||"เลือกหน่วย"}),(0,l.jsx)("span",{style:{color:"#94A3B8"},children:"▼"})]}),(0,l.jsx)(d.Z.Item,{name:"unit_id",hidden:!0,children:(0,l.jsx)(s.default,{})})]})]}),(0,l.jsx)(d.Z.Item,{name:"img_url",label:"รูปภาพ URL",children:(0,l.jsx)(s.default,{size:"large",placeholder:"https://example.com/image.jpg"})}),(0,l.jsx)(d.Z.Item,{name:"description",label:"รายละเอียดเพิ่มเติม",children:(0,l.jsx)(R,{rows:4,placeholder:"รายละเอียด...",style:{borderRadius:12}})}),(0,l.jsx)(d.Z.Item,{name:"is_active",label:"สถานะ",valuePropName:"checked",children:(0,l.jsx)(u.Z,{checkedChildren:"เปิดใช้งาน",unCheckedChildren:"ปิดใช้งาน"})}),(0,l.jsx)(E,{isEdit:K,loading:I,onCancel:es})]})}),(0,l.jsx)("div",{style:{position:"sticky",top:24,display:"flex",flexDirection:"column",gap:16},children:(0,l.jsxs)("div",{style:{background:"white",borderRadius:24,padding:24,boxShadow:"0 4px 20px rgba(0,0,0,0.04)",border:"1px solid #F1F5F9"},children:[(0,l.jsx)(g.default.Title,{level:5,style:{margin:0,marginBottom:16,color:"#475569"},children:"ตัวอย่างการแสดงผล"}),(0,l.jsx)(C,{name:q,productName:F.getFieldValue("product_name"),imageUrl:W,price:F.getFieldValue("price"),priceDelivery:F.getFieldValue("price_delivery"),category:null===(f=T.find(e=>e.id===F.getFieldValue("category_id")))||void 0===f?void 0:f.display_name,unit:null===(j=P.find(e=>e.id===F.getFieldValue("unit_id")))||void 0===j?void 0:j.display_name})]})})]})})}),(0,l.jsx)(n.Z,{title:"เลือกหมวดหมู่",open:U,onCancel:()=>M(!1),footer:null,centered:!0,width:400,zIndex:10001,styles:{body:{borderRadius:20,overflow:"hidden",padding:0}},children:(0,l.jsx)("div",{style:{maxHeight:"60vh",overflowY:"auto",padding:16,background:"#F8FAFC"},children:(0,l.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:8},children:T.map(e=>(0,l.jsxs)("div",{onClick:()=>{F.setFieldsValue({category_id:e.id}),M(!1)},style:{padding:"16px",border:"1px solid ".concat(F.getFieldValue("category_id")===e.id?"#4F46E5":"#E2E8F0"),borderRadius:16,cursor:"pointer",background:F.getFieldValue("category_id")===e.id?"#F5F3FF":"#fff",display:"flex",alignItems:"center",justifyContent:"space-between",transition:"all 0.2s",boxShadow:"0 2px 4px rgba(0,0,0,0.02)"},children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{style:{fontWeight:600,color:"#1E293B"},children:e.display_name}),(0,l.jsx)("div",{style:{fontSize:12,color:"#64748B"},children:e.category_name})]}),F.getFieldValue("category_id")===e.id&&(0,l.jsx)("span",{style:{color:"#4F46E5",fontWeight:"bold"},children:"✓"})]},e.id))})})}),(0,l.jsx)(n.Z,{title:"เลือกหน่วยสินค้า",open:X,onCancel:()=>$(!1),footer:null,centered:!0,width:400,zIndex:10001,styles:{body:{borderRadius:20,overflow:"hidden",padding:0}},children:(0,l.jsx)("div",{style:{maxHeight:"60vh",overflowY:"auto",padding:16,background:"#F8FAFC"},children:(0,l.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:8},children:P.map(e=>(0,l.jsxs)("div",{onClick:()=>{F.setFieldsValue({unit_id:e.id}),$(!1)},style:{padding:"16px",border:"1px solid ".concat(F.getFieldValue("unit_id")===e.id?"#10B981":"#E2E8F0"),borderRadius:16,cursor:"pointer",background:F.getFieldValue("unit_id")===e.id?"#ECFDF5":"#fff",display:"flex",alignItems:"center",justifyContent:"space-between",transition:"all 0.2s",boxShadow:"0 2px 4px rgba(0,0,0,0.02)"},children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{style:{fontWeight:600,color:"#1E293B"},children:e.display_name}),(0,l.jsx)("div",{style:{fontSize:12,color:"#64748B"},children:e.unit_name})]}),F.getFieldValue("unit_id")===e.id&&(0,l.jsx)("span",{style:{color:"#10B981",fontWeight:"bold"},children:"✓"})]},e.id))})})})]}):(0,l.jsx)(z.H,{message:"คุณไม่มีสิทธิ์เข้าถึงหน้านี้",tone:"danger"})}}},function(e){e.O(0,[8024,4736,8592,1744],function(){return e(e.s=64659)}),_N_E=e.O()}]);