(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3843],{50304:function(e,t,r){Promise.resolve().then(r.bind(r,92837))},92837:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return Y}});var s=r(57437),i=r(29),n=r.n(i),a=r(2265),d=r(19683),o=r(50742),l=r(88589),c=r(80009),p=r(85180),h=r(53743),x=r(34029),u=r(61778),g=r(33145),y=r(62376),b=r(89245),f=r(96473),j=r(29436),m=r(8900),v=r(39725),w=r(13377),k=r(26349),E=r(99376),F=r(3369),S=r(26972),C=r(24675),Z=r(97235),N=r(3286),R=r(67697),_=r(73814),z=r(69397);let P={...(0,z.yf)("linear-gradient(135deg, #4F46E5 0%, #4338CA 100%)"),productCard:z.YO,productCardInner:z.lv},A="\n  ".concat((0,z.IU)(".products-page",".product-card"),"\n\n  @media (max-width: 576px) {\n    .products-header-content {\n      flex-direction: column !important;\n      align-items: stretch !important;\n      gap: 16px !important;\n    }\n    \n    .products-header-left {\n      width: 100%;\n    }\n\n    .products-header-actions {\n      width: 100%;\n      display: flex;\n      gap: 8px;\n    }\n\n    .products-search-input {\n      width: 100% !important;\n      flex: 1;\n    }\n\n    .products-add-btn-text {\n      display: none;\n    }\n    \n    .ant-empty-description {\n        padding: 0 20px;\n    }\n\n    .product-card-inner {\n        padding: 12px !important;\n        gap: 10px !important;\n    }\n  }\n");var I=r(79657),L=r(11713),T=r(2913);let B=async(e,t)=>{let r=(0,T.b)("GET","/pos/productsUnit");t&&(r+="?".concat(t.toString()));let s={};e&&(s.Cookie=e);let i=await fetch(r,{cache:"no-store",credentials:"include",headers:s});if(!i.ok){let e=await i.json().catch(()=>({}));throw Error(e.error||e.message||"Failed to fetch products units")}return i.json()},U="pos:products-units";var D=r(67338);function W(e,t){let r=e.length>0,s=t.length>0;return{hasCategories:r,hasUnits:s,isReady:r&&s,missingFields:[!r&&"หมวดหมู่สินค้า",!s&&"หน่วยสินค้า"].filter(Boolean)}}function O(e,t){let r=W(e,t);return r.isReady?"":"กรุณาเพิ่ม".concat(r.missingFields.join("และ"),"ให้เรียบร้อยก่อนใช้งาน")}var M=r(2938);let{Text:q,Title:G}=d.default,H=e=>{let{onRefresh:t,onAdd:r,onSearch:i,disabledAdd:n}=e;return(0,s.jsxs)("div",{style:P.header,children:[(0,s.jsx)("div",{style:P.headerDecoCircle1}),(0,s.jsx)("div",{style:P.headerDecoCircle2}),(0,s.jsxs)("div",{className:"products-header-content",style:P.headerContent,children:[(0,s.jsxs)("div",{className:"products-header-left",style:P.headerLeft,children:[(0,s.jsx)("div",{style:P.headerIconBox,children:(0,s.jsx)(y.Z,{style:{fontSize:24,color:"white"}})}),(0,s.jsxs)("div",{children:[(0,s.jsx)(q,{style:{color:"rgba(255,255,255,0.85)",fontSize:13,display:"block",textShadow:"0 1px 2px rgba(0,0,0,0.1)"},children:"จัดการข้อมูล"}),(0,s.jsx)(G,{level:4,style:{color:"white",margin:0,fontWeight:700,letterSpacing:"0.5px",textShadow:"0 2px 4px rgba(0,0,0,0.1)"},children:"สินค้า"})]})]}),(0,s.jsxs)("div",{className:"products-header-actions",style:P.headerActions,children:[(0,s.jsx)(o.ZP,{type:"text",icon:(0,s.jsx)(b.Z,{style:{color:"white"}}),onClick:t,style:{background:"rgba(255,255,255,0.2)",backdropFilter:"blur(4px)",borderRadius:12,height:40,width:40,flexShrink:0,border:"1px solid rgba(255,255,255,0.3)"}}),!n&&(0,s.jsx)(o.ZP,{type:"primary",icon:(0,s.jsx)(f.Z,{}),onClick:r,style:{background:"white",color:"#4F46E5",borderRadius:12,height:40,fontWeight:600,border:"none",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",flexShrink:0},children:(0,s.jsx)("span",{className:"products-add-btn-text",children:"เพิ่มสินค้า"})})]})]}),(0,s.jsx)("div",{style:{marginTop:24,padding:"0 4px"},children:(0,s.jsx)(l.default,{prefix:(0,s.jsx)(j.Z,{style:{color:"#fff",opacity:.7}}),placeholder:"ค้นหาสินค้า (ชื่อ, บาร์โค้ด)...",onChange:e=>i(e.target.value),bordered:!1,style:{background:"rgba(255,255,255,0.15)",backdropFilter:"blur(8px)",borderRadius:14,padding:"8px 16px",color:"white",fontSize:15},className:"search-input-placeholder-white"})})]})},J=e=>{let{totalProducts:t,activeProducts:r,inactiveProducts:i}=e;return(0,s.jsxs)("div",{style:P.statsCard,children:[(0,s.jsxs)("div",{style:P.statItem,children:[(0,s.jsx)("span",{style:{...P.statNumber,color:"#4F46E5"},children:t}),(0,s.jsx)(q,{style:P.statLabel,children:"ทั้งหมด"})]}),(0,s.jsx)("div",{style:{width:1,height:24,background:"#f0f0f0",alignSelf:"center"}}),(0,s.jsxs)("div",{style:P.statItem,children:[(0,s.jsx)("span",{style:{...P.statNumber,color:"#10B981"},children:r}),(0,s.jsx)(q,{style:P.statLabel,children:"ใช้งาน"})]}),(0,s.jsx)("div",{style:{width:1,height:24,background:"#f0f0f0",alignSelf:"center"}}),(0,s.jsxs)("div",{style:P.statItem,children:[(0,s.jsx)("span",{style:{...P.statNumber,color:"#F59E0B"},children:i}),(0,s.jsx)(q,{style:P.statLabel,children:"ไม่ใช้งาน"})]})]})},K=e=>{var t;let{product:r,index:i,onEdit:n,onDelete:a}=e;return(0,s.jsx)("div",{className:"product-card",style:{...P.productCard(r.is_active),animationDelay:"".concat(.03*i,"s")},onClick:()=>n(r),children:(0,s.jsxs)("div",{className:"product-card-inner",style:P.productCardInner,children:[(0,s.jsx)("div",{style:{width:72,height:72,borderRadius:16,border:"1px solid #F1F5F9",boxShadow:"0 4px 12px rgba(0,0,0,0.04)",flexShrink:0,overflow:"hidden",position:"relative",background:"#F8FAFC"},children:r.img_url?(0,s.jsx)(g.default,{src:r.img_url,alt:r.display_name||r.product_name,fill:!0,style:{objectFit:"cover"},sizes:"72px"}):(0,s.jsx)("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #EEF2FF 0%, #E0E7FF 100%)"},children:(0,s.jsx)(y.Z,{style:{fontSize:24,color:"#6366F1",opacity:.8}})})}),(0,s.jsxs)("div",{style:{flex:1,minWidth:0,padding:"0 4px"},children:[(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:6,marginBottom:4},children:[(0,s.jsx)(q,{strong:!0,style:{fontSize:16,color:"#1E293B",flex:1},ellipsis:!0,children:r.display_name}),r.is_active?(0,s.jsx)(m.Z,{style:{color:"#10B981",fontSize:14}}):(0,s.jsx)(v.Z,{style:{color:"#94A3B8",fontSize:14}})]}),(0,s.jsx)(q,{type:"secondary",style:{fontSize:13,display:"block",marginBottom:8,color:"#64748B"},ellipsis:!0,children:r.product_name}),(0,s.jsxs)("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:[(0,s.jsx)(c.Z,{style:{borderRadius:6,margin:0,fontSize:11,fontWeight:700,color:"#059669",background:"#ECFDF5",border:"none",padding:"0 8px"},children:(0,D.T4)(Number(r.price))}),(null===(t=r.category)||void 0===t?void 0:t.display_name)&&(0,s.jsx)(c.Z,{style:{borderRadius:6,margin:0,fontSize:10,color:"#4F46E5",background:"#EEF2FF",border:"none"},children:r.category.display_name})]})]}),(0,s.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,s.jsx)(o.ZP,{type:"text",icon:(0,s.jsx)(w.Z,{}),onClick:e=>{e.stopPropagation(),n(r)},style:{borderRadius:12,color:"#4F46E5",background:"#F5F3FF",width:36,height:36}}),(0,s.jsx)(o.ZP,{type:"text",danger:!0,icon:(0,s.jsx)(k.Z,{}),onClick:e=>{e.stopPropagation(),a(r)},style:{borderRadius:12,background:"#FEF2F2",width:36,height:36}})]})]})})},X=e=>{let{onAdd:t,showAdd:r=!0,isSearch:i}=e;return(0,s.jsx)(p.Z,{image:p.Z.PRESENTED_IMAGE_SIMPLE,description:(0,s.jsxs)("div",{style:{textAlign:"center"},children:[(0,s.jsx)(q,{type:"secondary",style:{fontSize:15},children:i?"ไม่พบสินค้าที่ค้นหา":"ยังไม่มีสินค้า"}),(0,s.jsx)("br",{}),!i&&(0,s.jsx)(q,{type:"secondary",style:{fontSize:13},children:"เริ่มต้นเพิ่มสินค้าแรกของคุณ"})]}),style:{padding:"60px 20px",background:"white",borderRadius:24,margin:"24px 16px",boxShadow:"0 4px 24px rgba(0,0,0,0.04)"},children:r&&!i&&(0,s.jsx)(o.ZP,{type:"primary",icon:(0,s.jsx)(f.Z,{}),onClick:t,size:"large",style:{background:"#4F46E5",borderRadius:12,height:48,padding:"0 32px",boxShadow:"0 4px 12px rgba(79, 70, 229, 0.3)",border:"none"},children:"เพิ่มสินค้า"})})};function Y(){let e=(0,E.useRouter)(),[t,r]=(0,a.useState)([]),[i,d]=(0,a.useState)([]),[l,c]=(0,a.useState)(""),{execute:g}=(0,S.J)(),{showLoading:y}=(0,F.x)(),{socket:b}=(0,C.s)(),{isAuthorized:f,isChecking:j}=(0,N.e)({requiredRole:"Admin"}),[m,v]=(0,a.useState)([]),[w,z]=(0,a.useState)([]),{data:T=[],isLoading:D}=(0,I.L)(),{data:Y=[],isLoading:Q}=(0,L.a)({queryKey:["products-units"],queryFn:async()=>{let e=await B();return(null==e?void 0:e.length)&&(0,_.v)(U,e),e},initialData:()=>(0,_.t)(U,3e5)||void 0,staleTime:3e5,refetchOnWindowFocus:!1,retry:1});(0,a.useEffect)(()=>{T.length>0&&v(T)},[T]),(0,a.useEffect)(()=>{Y.length>0&&z(Y)},[Y]),(0,a.useEffect)(()=>{(0,Z.P)()},[]),(0,a.useEffect)(()=>{let e=(0,_.t)("pos:products",6e5);e&&Array.isArray(e)&&r(e)},[]);let V=(0,a.useCallback)(async()=>{g(async()=>{let e=new URLSearchParams;e.set("limit","500");let t=await fetch("/api/pos/products?".concat(e.toString()));if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.error||e.message||"ไม่สามารถดึงข้อมูลสินค้าได้")}let s=(await t.json()).data||[];r(s),(0,_.v)("pos:products",s)},"กำลังโหลดข้อมูลสินค้า...")},[g]);(0,a.useEffect)(()=>{f&&V()},[f,V]),(0,R.v)(b,{create:"products:create",update:"products:update",delete:"products:delete"},r),(0,a.useEffect)(()=>{if(l){let e=l.toLowerCase();d(t.filter(t=>{var r,s;return(null===(r=t.display_name)||void 0===r?void 0:r.toLowerCase().includes(e))||(null===(s=t.product_name)||void 0===s?void 0:s.toLowerCase().includes(e))}))}else d(t)},[t,l]),(0,R.v)(b,{create:"category:create",update:"category:update",delete:"category:delete"},v),(0,R.v)(b,{create:"productsUnit:create",update:"productsUnit:update",delete:"productsUnit:delete"},z);let $=e=>{c(e)},ee=()=>{y("กำลังเปิดหน้าจัดการสินค้า..."),e.push("/pos/products/manage/add")},et=t=>{y("กำลังเปิดหน้าแก้ไขสินค้า..."),e.push("/pos/products/manage/edit/".concat(t.id))},er=e=>{h.Z.confirm({title:"ยืนยันการลบสินค้า",content:'คุณต้องการลบสินค้า "'.concat(e.display_name,'" หรือไม่?'),okText:"ลบ",okType:"danger",cancelText:"ยกเลิก",centered:!0,icon:(0,s.jsx)(k.Z,{style:{color:"#EF4444"}}),maskClosable:!0,onOk:async()=>{await g(async()=>{let t=await (0,Z.P)();if(!(await fetch("/api/pos/products/delete/".concat(e.id),{method:"DELETE",headers:{"X-CSRF-Token":t}})).ok)throw Error("ไม่สามารถลบสินค้าได้");x.ZP.success('ลบสินค้า "'.concat(e.display_name,'" สำเร็จ'))},"กำลังลบสินค้า...")}})};if(j)return(0,s.jsx)(M.H,{message:"กำลังตรวจสอบสิทธิ์การใช้งาน..."});if(!f)return(0,s.jsx)(M.H,{message:"คุณไม่มีสิทธิ์เข้าถึงหน้านี้ กำลังพากลับ...",tone:"danger"});let es=t.filter(e=>e.is_active),ei=t.filter(e=>!e.is_active),en=W(m,w),ea=en.isReady,ed=D||Q;return ed||ea||0!==t.length?(0,s.jsxs)("div",{style:P.container,className:"jsx-67deb991b643d0ef products-page",children:[(0,s.jsx)("style",{children:A}),(0,s.jsx)(n(),{id:"67deb991b643d0ef",children:".search-input-placeholder-white input::-webkit-input-placeholder{color:rgba(255,255,255,.6)!important}.search-input-placeholder-white input:-moz-placeholder{color:rgba(255,255,255,.6)!important}.search-input-placeholder-white input::-moz-placeholder{color:rgba(255,255,255,.6)!important}.search-input-placeholder-white input:-ms-input-placeholder{color:rgba(255,255,255,.6)!important}.search-input-placeholder-white input::-ms-input-placeholder{color:rgba(255,255,255,.6)!important}.search-input-placeholder-white input::placeholder{color:rgba(255,255,255,.6)!important}.search-input-placeholder-white input{color:white!important}.product-card{cursor:pointer;-webkit-tap-highlight-color:transparent}"}),(0,s.jsx)(H,{onRefresh:V,onAdd:ee,onSearch:$,disabledAdd:!ea}),!ed&&!ea&&t.length>0&&(0,s.jsx)("div",{style:{margin:"0 16px 20px",position:"relative",zIndex:10},className:"jsx-67deb991b643d0ef",children:(0,s.jsx)(u.Z,{message:"ตั้งค่าไม่สมบูรณ์",description:O(m,w),type:"warning",showIcon:!0,style:{borderRadius:16,border:"none",boxShadow:"0 4px 12px rgba(251, 146, 60, 0.1)"},action:(0,s.jsxs)("div",{style:{display:"flex",gap:8},className:"jsx-67deb991b643d0ef",children:[!en.hasCategories&&(0,s.jsx)(o.ZP,{size:"small",type:"primary",ghost:!0,onClick:()=>e.push("/pos/category"),children:"เพิ่มหมวดหมู่"}),!en.hasUnits&&(0,s.jsx)(o.ZP,{size:"small",type:"primary",ghost:!0,onClick:()=>e.push("/pos/productsUnit"),children:"เพิ่มหน่วยสินค้า"})]})})}),(0,s.jsx)("div",{style:{marginTop:-32,padding:"0 16px",position:"relative",zIndex:10},className:"jsx-67deb991b643d0ef",children:(0,s.jsx)(J,{totalProducts:t.length,activeProducts:es.length,inactiveProducts:ei.length})}),(0,s.jsx)("div",{style:P.listContainer,className:"jsx-67deb991b643d0ef",children:i.length>0?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{style:P.sectionTitle,className:"jsx-67deb991b643d0ef",children:[(0,s.jsx)("div",{style:{width:4,height:16,background:"#4F46E5",borderRadius:2},className:"jsx-67deb991b643d0ef"}),(0,s.jsx)("span",{style:{fontSize:16,fontWeight:700,color:"#1E293B"},className:"jsx-67deb991b643d0ef",children:"รายการสินค้า"}),(0,s.jsx)("div",{style:{background:"#EEF2FF",color:"#4F46E5",padding:"2px 10px",borderRadius:12,fontSize:12,fontWeight:700,marginLeft:"auto"},className:"jsx-67deb991b643d0ef",children:i.length})]}),i.map((e,t)=>(0,s.jsx)(K,{product:e,index:t,onEdit:et,onDelete:er},e.id))]}):(0,s.jsx)(X,{onAdd:ee,showAdd:ea,isSearch:!!l})}),(0,s.jsx)("div",{style:{height:40},className:"jsx-67deb991b643d0ef"})]}):(0,s.jsxs)("div",{className:"products-page",style:P.container,children:[(0,s.jsx)("style",{children:A}),(0,s.jsx)(H,{onRefresh:V,onAdd:ee,onSearch:$,disabledAdd:!ea}),(0,s.jsx)("div",{style:{...P.listContainer,padding:"40px 20px"},children:(0,s.jsx)("div",{style:{background:"#fff",borderRadius:24,padding:"80px 24px",textAlign:"center",boxShadow:"0 4px 24px rgba(0,0,0,0.04)"},children:(0,s.jsx)(p.Z,{image:p.Z.PRESENTED_IMAGE_SIMPLE,description:(0,s.jsxs)("div",{style:{marginTop:20},children:[(0,s.jsx)(G,{level:4,style:{marginBottom:8,color:"#334155"},children:"ยังไม่พร้อมเพิ่มสินค้า"}),(0,s.jsx)(q,{type:"secondary",style:{fontSize:16},children:O(m,w)})]}),children:(0,s.jsxs)("div",{style:{display:"flex",gap:16,justifyContent:"center",marginTop:24,flexWrap:"wrap"},children:[!en.hasCategories&&(0,s.jsx)(o.ZP,{type:"primary",size:"large",onClick:()=>e.push("/pos/category"),style:{height:45,borderRadius:12,background:"#4F46E5",border:"none"},children:"เพิ่มหมวดหมู่สินค้า"}),!en.hasUnits&&(0,s.jsx)(o.ZP,{type:"primary",size:"large",onClick:()=>e.push("/pos/productsUnit"),style:{height:45,borderRadius:12,background:"#10B981",border:"none"},children:"เพิ่มหน่วยสินค้า"})]})})})})]})}}},function(e){e.O(0,[8024,4736,8592,1744],function(){return e(e.s=50304)}),_N_E=e.O()}]);