(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9776],{81316:function(e,t,a){Promise.resolve().then(a.bind(a,53544))},53544:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return T}});var n=a(57437),s=a(2265),i=a(19878),o=a(34029),d=a(53743),l=a(50742),r=a(48651),c=a(47451),p=a(69410),m=a(88589),h=a(93834),y=a(66487),u=a(99376),f=a(25193),x=a(37410),g=a(20148),_=a(60283),b=a(99458),j=a(72175);let{pageStyles:v,ManagePageStyles:w}=(0,j.dg)({focusColor:"#10b981",focusShadow:"rgba(16, 185, 129, 0.1)",switchGradient:"linear-gradient(135deg, #10b981 0%, #059669 100%)"}),S=e=>{let{name:t,displayName:a}=e,s="linear-gradient(135deg, #10b981 0%, #059669 100%)",i=(t||"").toLowerCase();return i.includes("cash")||i.includes("เงินสด")?s="linear-gradient(135deg, #65a30d 0%, #4d7c0f 100%)":i.includes("promptpay")||i.includes("พร้อมเพย์")?s="linear-gradient(135deg, #0f172a 0%, #1e293b 100%)":i.includes("delivery")&&(s="linear-gradient(135deg, #f59e0b 0%, #d97706 100%)"),(0,n.jsxs)("div",{children:[(0,n.jsx)(_.default.Text,{type:"secondary",style:{display:"block",marginBottom:12,fontSize:13,textAlign:"center"},children:"ตัวอย่างการแสดงผล (Preview)"}),(0,n.jsxs)("div",{style:{background:s,borderRadius:20,padding:24,boxShadow:"0 10px 30px rgba(0,0,0,0.15)",color:"white",position:"relative",overflow:"hidden",minHeight:180,display:"flex",flexDirection:"column",maxWidth:340,margin:"0 auto"},children:[(0,n.jsx)("div",{style:{position:"absolute",top:-20,right:-20,width:120,height:120,borderRadius:"50%",background:"rgba(255,255,255,0.1)",zIndex:1}}),(0,n.jsx)("div",{style:{position:"absolute",bottom:-30,left:-30,width:100,height:100,borderRadius:"50%",background:"rgba(255,255,255,0.08)",zIndex:1}}),(0,n.jsxs)("div",{style:{position:"relative",zIndex:2,flex:1},children:[(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[(0,n.jsx)(b.Z,{style:{fontSize:32,opacity:.9}}),(0,n.jsx)("div",{style:{fontSize:16,fontWeight:700,opacity:.9,letterSpacing:"1px",textTransform:"uppercase"},children:"PAYMENT"})]}),(0,n.jsxs)("div",{style:{marginTop:40},children:[(0,n.jsx)("div",{style:{fontSize:12,opacity:.7,marginBottom:4},children:"Payment Method"}),(0,n.jsx)("div",{style:{fontSize:24,fontWeight:700,letterSpacing:"0.5px",textShadow:"0 2px 4px rgba(0,0,0,0.1)"},children:a||"Display Name"})]}),(0,n.jsx)("div",{style:{marginTop:"auto",paddingTop:20,display:"flex",justifyContent:"flex-end"},children:(0,n.jsx)("div",{style:{fontSize:14,opacity:.8,background:"rgba(255,255,255,0.2)",padding:"4px 12px",borderRadius:12,fontWeight:500},children:t||"CODE"})})]})]})]})},k=e=>{let{isEdit:t,loading:a,onCancel:s}=e;return(0,n.jsx)(j.uM,{pageStyles:v,isEdit:t,loading:a,onCancel:s})};var C=a(97235),Z=a(67918),P=a(2938),z=a(63836);let E=[{payment_method_name:"PromptPay",display_name:"พร้อมเพย์"},{payment_method_name:"Delivery",display_name:"เดริเวอรี่"},{payment_method_name:"Cash",display_name:"เงินสด"}];function T(e){let{params:t}=e,a=(0,u.useRouter)(),[_]=i.Z.useForm(),[b,j]=(0,s.useState)(!1),[T,I]=(0,s.useState)(!1),[M,R]=(0,s.useState)(""),[N,F]=(0,s.useState)(""),[O,W]=(0,s.useState)(""),[D,q]=(0,s.useState)([]),[A,B]=(0,s.useState)(!1),V=t.mode[0],H=t.mode[1]||null,X="edit"===V&&!!H,{isAuthorized:J,isChecking:L}=(0,Z.e)({allowedRoles:["Admin","Manager"]});(0,s.useEffect)(()=>{(async()=>{W(await (0,C.P)())})()},[]);let G=(0,s.useCallback)(async()=>{try{let e=await z.E.getAll();q(e.data||[])}catch(e){console.error("ไม่สามารถดึงข้อมูล payment methods ได้:",e)}},[]);(0,s.useEffect)(()=>{J&&G()},[J,G]);let U=(0,s.useCallback)(async()=>{j(!0);try{let e=await fetch("/api/pos/paymentMethod/getById/".concat(H));if(!e.ok)throw Error("ไม่สามารถดึงข้อมูลวิธีการชำระเงินได้");let t=await e.json();_.setFieldsValue({payment_method_name:t.payment_method_name,display_name:t.display_name,is_active:t.is_active}),R(t.payment_method_name||""),F(t.display_name||"")}catch(e){console.error(e),o.ZP.error("ไม่สามารถดึงข้อมูลวิธีการชำระเงินได้"),a.push("/pos/paymentMethod")}finally{j(!1)}},[H,_,a]);(0,s.useEffect)(()=>{X&&U()},[X,H,U]);let Y=(0,s.useCallback)(e=>!!e&&!!D&&0!==D.length&&(X?D.some(t=>t.payment_method_name===e&&t.id!==H):D.some(t=>t.payment_method_name===e)),[D,X,H]),K=async e=>{if(Y(e.payment_method_name)){o.ZP.error('วิธีการชำระเงิน "'.concat(e.display_name,'" มีอยู่ในระบบแล้ว'));return}I(!0);try{if(X){let t=await fetch("/api/pos/paymentMethod/update/".concat(H),{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-Token":O},body:JSON.stringify(e)});if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.error||e.message||"ไม่สามารถอัปเดตวิธีการชำระเงินได้")}o.ZP.success("อัปเดตวิธีการชำระเงินสำเร็จ")}else{let t=await fetch("/api/pos/paymentMethod/create",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":O},body:JSON.stringify(e)});if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.error||e.message||"ไม่สามารถสร้างวิธีการชำระเงินได้")}o.ZP.success("สร้างวิธีการชำระเงินสำเร็จ")}a.push("/pos/paymentMethod")}catch(e){console.error(e),o.ZP.error(e.message||(X?"ไม่สามารถอัปเดตวิธีการชำระเงินได้":"ไม่สามารถสร้างวิธีการชำระเงินได้"))}finally{I(!1)}},Q=()=>a.push("/pos/paymentMethod");return L?(0,n.jsx)(P.H,{message:"กำลังตรวจสอบสิทธิ์..."}):J?(0,n.jsxs)("div",{className:"manage-page",style:v.container,children:[(0,n.jsx)(w,{}),(0,n.jsx)(g.Z,{title:X?"แก้ไขวิธีการชำระเงิน":"เพิ่มวิธีการชำระเงิน",subtitle:X?"แก้ไขข้อมูลวิธีการชำระเงิน":"สร้างวิธีการชำระเงินใหม่",onBack:Q,actions:X?(0,n.jsx)(l.ZP,{danger:!0,onClick:()=>{H&&d.Z.confirm({title:"ยืนยันการลบวิธีการชำระเงิน",content:'คุณต้องการลบวิธีการชำระเงิน "'.concat(N||M,'" หรือไม่?'),okText:"ลบ",okType:"danger",cancelText:"ยกเลิก",centered:!0,onOk:async()=>{try{if(!(await fetch("/api/pos/paymentMethod/delete/".concat(H),{method:"DELETE",headers:{"X-CSRF-Token":O}})).ok)throw Error("ไม่สามารถลบวิธีการชำระเงินได้");o.ZP.success("ลบวิธีการชำระเงินสำเร็จ"),a.push("/pos/paymentMethod")}catch(e){console.error(e),o.ZP.error("ไม่สามารถลบวิธีการชำระเงินได้")}}})},children:"ลบ"}):null}),(0,n.jsx)(f.Z,{maxWidth:1e3,children:(0,n.jsx)(x.Z,{children:b?(0,n.jsx)("div",{style:{display:"flex",justifyContent:"center",padding:"60px 0"},children:(0,n.jsx)(r.Z,{size:"large"})}):(0,n.jsx)(i.Z,{form:_,layout:"vertical",onFinish:K,requiredMark:!1,autoComplete:"off",initialValues:{is_active:!0},onValuesChange:e=>{void 0!==e.payment_method_name&&R(e.payment_method_name),void 0!==e.display_name&&F(e.display_name)},children:(0,n.jsxs)(c.Z,{gutter:[32,24],children:[(0,n.jsxs)(p.Z,{xs:24,lg:14,xl:15,children:[(0,n.jsxs)("div",{style:v.formSection,children:[(0,n.jsx)(i.Z.Item,{name:"payment_method_name",label:"รหัสวิธีการชำระเงิน *",rules:[{required:!0,message:"กรุณาเลือกวิธีการชำระเงิน"}],children:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{style:{border:"1px solid ".concat(M?"#10b981":"#d9d9d9"),borderRadius:12,padding:"12px 16px",cursor:X?"not-allowed":"pointer",background:X?"#f5f5f5":"#fff",display:"flex",justifyContent:"space-between",alignItems:"center",height:48,transition:"all 0.2s",boxShadow:M?"0 0 0 2px rgba(16, 185, 129, 0.1)":"none"},onClick:()=>{X||B(!0)},children:[(0,n.jsx)("span",{style:{color:M?"#1a1a2e":"#bfbfbf",fontSize:16},children:M?"".concat(N," (").concat(M,")"):"เลือกวิธีการชำระเงิน"}),(0,n.jsx)("span",{style:{color:"#bfbfbf"},children:"▼"})]}),(0,n.jsx)(i.Z.Item,{name:"payment_method_name",style:{display:"none"},rules:[{required:!0,message:"กรุณาเลือกวิธีการชำระเงิน"}],children:(0,n.jsx)(m.default,{})})]})}),(0,n.jsx)(d.Z,{title:"เลือกวิธีการชำระเงิน",open:A,onCancel:()=>B(!1),footer:null,centered:!0,width:400,zIndex:10001,children:(0,n.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:12},children:E.map(e=>{let t=!X&&Y(e.payment_method_name),a=M===e.payment_method_name;return(0,n.jsxs)("div",{onClick:()=>{t||(_.setFieldsValue({payment_method_name:e.payment_method_name,display_name:e.display_name}),R(e.payment_method_name),F(e.display_name),B(!1))},style:{padding:"16px",border:"1px solid ".concat(a?"#10b981":"#e5e7eb"),borderRadius:12,cursor:t?"not-allowed":"pointer",background:a?"#ecfdf5":t?"#f5f5f5":"#fff",display:"flex",alignItems:"center",justifyContent:"space-between",opacity:t?.6:1},children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{style:{fontWeight:600,color:a?"#047857":"#1f2937",fontSize:16},children:e.display_name}),(0,n.jsx)("div",{style:{fontSize:13,color:a?"#059669":"#6b7280"},children:e.payment_method_name})]}),t&&(0,n.jsx)("span",{style:{fontSize:12,color:"#ef4444"},children:"มีอยู่แล้ว"}),a&&!t&&(0,n.jsx)("span",{style:{color:"#10b981",fontSize:18},children:"✓"})]},e.payment_method_name)})})}),(0,n.jsx)(i.Z.Item,{name:"display_name",label:"ชื่อที่แสดง *",rules:[{required:!0,message:"กรุณาเลือกชื่อที่แสดง"}],children:(0,n.jsx)(h.default,{size:"large",placeholder:"ชื่อที่แสดงจะถูกตั้งค่าอัตโนมัติ",disabled:!0,dropdownMatchSelectWidth:!0,getPopupContainer:()=>document.body,dropdownStyle:{zIndex:9999},children:E.map(e=>(0,n.jsx)(h.default.Option,{value:e.display_name,children:e.display_name},e.display_name))})}),(0,n.jsx)(i.Z.Item,{name:"is_active",label:"สถานะการใช้งาน",valuePropName:"checked",style:{marginTop:24},children:(0,n.jsx)(y.Z,{checkedChildren:"เปิดใช้งาน",unCheckedChildren:"ปิดใช้งาน",style:{transform:"scale(1.1)"}})})]}),(0,n.jsx)(k,{isEdit:X,loading:T,onCancel:Q})]}),(0,n.jsx)(p.Z,{xs:24,lg:10,xl:9,children:(0,n.jsx)("div",{style:{position:"sticky",top:24,background:"rgba(250, 250, 250, 0.5)",padding:24,borderRadius:20,border:"1px solid #f0f0f0"},children:(0,n.jsx)(i.Z.Item,{noStyle:!0,dependencies:["payment_method_name","display_name"],children:e=>{let{getFieldValue:t}=e;return(0,n.jsx)(S,{name:t("payment_method_name"),displayName:t("display_name")})}})})})]})})})})]}):(0,n.jsx)(P.H,{message:"คุณไม่มีสิทธิ์เข้าถึงหน้านี้",tone:"danger"})}}},function(e){e.O(0,[8024,4736,8592,1744],function(){return e(e.s=81316)}),_N_E=e.O()}]);