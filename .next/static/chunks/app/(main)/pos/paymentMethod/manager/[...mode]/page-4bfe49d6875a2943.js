(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9776],{81316:function(e,t,a){Promise.resolve().then(a.bind(a,53544))},53544:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return E}});var n=a(57437),i=a(2265),s=a(19878),o=a(34029),d=a(53743),l=a(48651),r=a(47451),c=a(69410),p=a(88589),m=a(93834),y=a(66487),h=a(99376),f=a(19683),u=a(99458),x=a(72175);let{pageStyles:g,ManagePageStyles:_}=(0,x.dg)({focusColor:"#10b981",focusShadow:"rgba(16, 185, 129, 0.1)",switchGradient:"linear-gradient(135deg, #10b981 0%, #059669 100%)"}),b=e=>{let{isEdit:t,onBack:a,onDelete:i}=e;return(0,n.jsx)(x.oI,{pageStyles:g,isEdit:t,onBack:a,onDelete:i,titleCreate:"เพิ่มวิธีชำระเงิน",titleEdit:"แก้ไขวิธีชำระเงิน"})},j=e=>{let{name:t,displayName:a}=e,i="linear-gradient(135deg, #10b981 0%, #059669 100%)",s=(t||"").toLowerCase();return s.includes("cash")||s.includes("เงินสด")?i="linear-gradient(135deg, #65a30d 0%, #4d7c0f 100%)":s.includes("promptpay")||s.includes("พร้อมเพย์")?i="linear-gradient(135deg, #0f172a 0%, #1e293b 100%)":s.includes("delivery")&&(i="linear-gradient(135deg, #f59e0b 0%, #d97706 100%)"),(0,n.jsxs)("div",{children:[(0,n.jsx)(f.default.Text,{type:"secondary",style:{display:"block",marginBottom:12,fontSize:13,textAlign:"center"},children:"ตัวอย่างการแสดงผล (Preview)"}),(0,n.jsxs)("div",{style:{background:i,borderRadius:20,padding:24,boxShadow:"0 10px 30px rgba(0,0,0,0.15)",color:"white",position:"relative",overflow:"hidden",minHeight:180,display:"flex",flexDirection:"column",maxWidth:340,margin:"0 auto"},children:[(0,n.jsx)("div",{style:{position:"absolute",top:-20,right:-20,width:120,height:120,borderRadius:"50%",background:"rgba(255,255,255,0.1)",zIndex:1}}),(0,n.jsx)("div",{style:{position:"absolute",bottom:-30,left:-30,width:100,height:100,borderRadius:"50%",background:"rgba(255,255,255,0.08)",zIndex:1}}),(0,n.jsxs)("div",{style:{position:"relative",zIndex:2,flex:1},children:[(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[(0,n.jsx)(u.Z,{style:{fontSize:32,opacity:.9}}),(0,n.jsx)("div",{style:{fontSize:16,fontWeight:700,opacity:.9,letterSpacing:"1px",textTransform:"uppercase"},children:"PAYMENT"})]}),(0,n.jsxs)("div",{style:{marginTop:40},children:[(0,n.jsx)("div",{style:{fontSize:12,opacity:.7,marginBottom:4},children:"Payment Method"}),(0,n.jsx)("div",{style:{fontSize:24,fontWeight:700,letterSpacing:"0.5px",textShadow:"0 2px 4px rgba(0,0,0,0.1)"},children:a||"Display Name"})]}),(0,n.jsx)("div",{style:{marginTop:"auto",paddingTop:20,display:"flex",justifyContent:"flex-end"},children:(0,n.jsx)("div",{style:{fontSize:14,opacity:.8,background:"rgba(255,255,255,0.2)",padding:"4px 12px",borderRadius:12,fontWeight:500},children:t||"CODE"})})]})]})]})},v=e=>{let{isEdit:t,loading:a,onCancel:i}=e;return(0,n.jsx)(x.uM,{pageStyles:g,isEdit:t,loading:a,onCancel:i})};var S=a(97235),k=a(3286),w=a(2938),C=a(63836);let Z=[{payment_method_name:"PromptPay",display_name:"พร้อมเพย์"},{payment_method_name:"Delivery",display_name:"เดริเวอรี่"},{payment_method_name:"Cash",display_name:"เงินสด"}];function E(e){let{params:t}=e,a=(0,h.useRouter)(),[f]=s.Z.useForm(),[u,x]=(0,i.useState)(!1),[E,z]=(0,i.useState)(!1),[P,T]=(0,i.useState)(""),[I,M]=(0,i.useState)(""),[R,N]=(0,i.useState)(""),[D,F]=(0,i.useState)([]),[O,q]=(0,i.useState)(!1),B=t.mode[0],W=t.mode[1]||null,A="edit"===B&&!!W,{isAuthorized:V,isChecking:H}=(0,k.e)({requiredRole:"Admin"});(0,i.useEffect)(()=>{(async()=>{N(await (0,S.P)())})()},[]);let X=(0,i.useCallback)(async()=>{try{let e=await C.E.getAll();F(e.data||[])}catch(e){console.error("ไม่สามารถดึงข้อมูล payment methods ได้:",e)}},[]);(0,i.useEffect)(()=>{V&&X()},[V,X]);let J=(0,i.useCallback)(async()=>{x(!0);try{let e=await fetch("/api/pos/paymentMethod/getById/".concat(W));if(!e.ok)throw Error("ไม่สามารถดึงข้อมูลวิธีการชำระเงินได้");let t=await e.json();f.setFieldsValue({payment_method_name:t.payment_method_name,display_name:t.display_name,is_active:t.is_active}),T(t.payment_method_name||""),M(t.display_name||"")}catch(e){console.error(e),o.ZP.error("ไม่สามารถดึงข้อมูลวิธีการชำระเงินได้"),a.push("/pos/paymentMethod")}finally{x(!1)}},[W,f,a]);(0,i.useEffect)(()=>{A&&J()},[A,W,J]);let L=(0,i.useCallback)(e=>!!e&&!!D&&0!==D.length&&(A?D.some(t=>t.payment_method_name===e&&t.id!==W):D.some(t=>t.payment_method_name===e)),[D,A,W]),G=async e=>{if(L(e.payment_method_name)){o.ZP.error('วิธีการชำระเงิน "'.concat(e.display_name,'" มีอยู่ในระบบแล้ว'));return}z(!0);try{if(A){let t=await fetch("/api/pos/paymentMethod/update/".concat(W),{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-Token":R},body:JSON.stringify(e)});if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.error||e.message||"ไม่สามารถอัปเดตวิธีการชำระเงินได้")}o.ZP.success("อัปเดตวิธีการชำระเงินสำเร็จ")}else{let t=await fetch("/api/pos/paymentMethod/create",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":R},body:JSON.stringify(e)});if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.error||e.message||"ไม่สามารถสร้างวิธีการชำระเงินได้")}o.ZP.success("สร้างวิธีการชำระเงินสำเร็จ")}a.push("/pos/paymentMethod")}catch(e){console.error(e),o.ZP.error(e.message||(A?"ไม่สามารถอัปเดตวิธีการชำระเงินได้":"ไม่สามารถสร้างวิธีการชำระเงินได้"))}finally{z(!1)}},U=()=>a.push("/pos/paymentMethod");return H?(0,n.jsx)(w.H,{message:"กำลังตรวจสอบสิทธิ์..."}):V?(0,n.jsxs)("div",{className:"manage-page",style:g.container,children:[(0,n.jsx)(_,{}),(0,n.jsx)(b,{isEdit:A,onBack:U,onDelete:A?()=>{W&&d.Z.confirm({title:"ยืนยันการลบวิธีการชำระเงิน",content:'คุณต้องการลบวิธีการชำระเงิน "'.concat(I||P,'" หรือไม่?'),okText:"ลบ",okType:"danger",cancelText:"ยกเลิก",centered:!0,onOk:async()=>{try{if(!(await fetch("/api/pos/paymentMethod/delete/".concat(W),{method:"DELETE",headers:{"X-CSRF-Token":R}})).ok)throw Error("ไม่สามารถลบวิธีการชำระเงินได้");o.ZP.success("ลบวิธีการชำระเงินสำเร็จ"),a.push("/pos/paymentMethod")}catch(e){console.error(e),o.ZP.error("ไม่สามารถลบวิธีการชำระเงินได้")}}})}:void 0}),(0,n.jsx)("div",{style:g.formCard,children:u?(0,n.jsx)("div",{style:{display:"flex",justifyContent:"center",padding:"60px 0"},children:(0,n.jsx)(l.Z,{size:"large"})}):(0,n.jsx)(s.Z,{form:f,layout:"vertical",onFinish:G,requiredMark:!1,autoComplete:"off",initialValues:{is_active:!0},onValuesChange:e=>{void 0!==e.payment_method_name&&T(e.payment_method_name),void 0!==e.display_name&&M(e.display_name)},children:(0,n.jsxs)(r.Z,{gutter:[32,24],children:[(0,n.jsxs)(c.Z,{xs:24,lg:14,xl:15,children:[(0,n.jsxs)("div",{style:g.formSection,children:[(0,n.jsx)(s.Z.Item,{name:"payment_method_name",label:"รหัสวิธีการชำระเงิน *",rules:[{required:!0,message:"กรุณาเลือกวิธีการชำระเงิน"}],children:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{style:{border:"1px solid ".concat(P?"#10b981":"#d9d9d9"),borderRadius:12,padding:"12px 16px",cursor:A?"not-allowed":"pointer",background:A?"#f5f5f5":"#fff",display:"flex",justifyContent:"space-between",alignItems:"center",height:48,transition:"all 0.2s",boxShadow:P?"0 0 0 2px rgba(16, 185, 129, 0.1)":"none"},onClick:()=>{A||q(!0)},children:[(0,n.jsx)("span",{style:{color:P?"#1a1a2e":"#bfbfbf",fontSize:16},children:P?"".concat(I," (").concat(P,")"):"เลือกวิธีการชำระเงิน"}),(0,n.jsx)("span",{style:{color:"#bfbfbf"},children:"▼"})]}),(0,n.jsx)(s.Z.Item,{name:"payment_method_name",style:{display:"none"},rules:[{required:!0,message:"กรุณาเลือกวิธีการชำระเงิน"}],children:(0,n.jsx)(p.default,{})})]})}),(0,n.jsx)(d.Z,{title:"เลือกวิธีการชำระเงิน",open:O,onCancel:()=>q(!1),footer:null,centered:!0,width:400,zIndex:10001,children:(0,n.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:12},children:Z.map(e=>{let t=!A&&L(e.payment_method_name),a=P===e.payment_method_name;return(0,n.jsxs)("div",{onClick:()=>{t||(f.setFieldsValue({payment_method_name:e.payment_method_name,display_name:e.display_name}),T(e.payment_method_name),M(e.display_name),q(!1))},style:{padding:"16px",border:"1px solid ".concat(a?"#10b981":"#e5e7eb"),borderRadius:12,cursor:t?"not-allowed":"pointer",background:a?"#ecfdf5":t?"#f5f5f5":"#fff",display:"flex",alignItems:"center",justifyContent:"space-between",opacity:t?.6:1},children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{style:{fontWeight:600,color:a?"#047857":"#1f2937",fontSize:16},children:e.display_name}),(0,n.jsx)("div",{style:{fontSize:13,color:a?"#059669":"#6b7280"},children:e.payment_method_name})]}),t&&(0,n.jsx)("span",{style:{fontSize:12,color:"#ef4444"},children:"มีอยู่แล้ว"}),a&&!t&&(0,n.jsx)("span",{style:{color:"#10b981",fontSize:18},children:"✓"})]},e.payment_method_name)})})}),(0,n.jsx)(s.Z.Item,{name:"display_name",label:"ชื่อที่แสดง *",rules:[{required:!0,message:"กรุณาเลือกชื่อที่แสดง"}],children:(0,n.jsx)(m.default,{size:"large",placeholder:"ชื่อที่แสดงจะถูกตั้งค่าอัตโนมัติ",disabled:!0,getPopupContainer:()=>document.body,dropdownStyle:{zIndex:9999},children:Z.map(e=>(0,n.jsx)(m.default.Option,{value:e.display_name,children:e.display_name},e.display_name))})}),(0,n.jsx)(s.Z.Item,{name:"is_active",label:"สถานะการใช้งาน",valuePropName:"checked",style:{marginTop:24},children:(0,n.jsx)(y.Z,{checkedChildren:"เปิดใช้งาน",unCheckedChildren:"ปิดใช้งาน",style:{transform:"scale(1.1)"}})})]}),(0,n.jsx)(v,{isEdit:A,loading:E,onCancel:U})]}),(0,n.jsx)(c.Z,{xs:24,lg:10,xl:9,children:(0,n.jsx)("div",{style:{position:"sticky",top:24,background:"rgba(250, 250, 250, 0.5)",padding:24,borderRadius:20,border:"1px solid #f0f0f0"},children:(0,n.jsx)(s.Z.Item,{noStyle:!0,dependencies:["payment_method_name","display_name"],children:e=>{let{getFieldValue:t}=e;return(0,n.jsx)(j,{name:t("payment_method_name"),displayName:t("display_name")})}})})})]})})})]}):(0,n.jsx)(w.H,{message:"คุณไม่มีสิทธิ์เข้าถึงหน้านี้",tone:"danger"})}}},function(e){e.O(0,[8024,4736,8592,1744],function(){return e(e.s=81316)}),_N_E=e.O()}]);