(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9776],{81316:function(e,t,a){Promise.resolve().then(a.bind(a,44589))},44589:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return O}});var n=a(57437),o=a(2265),r=a(39486),i=a(51653),s=a(19878),d=a(34029),l=a(53743),c=a(50742),m=a(48651),p=a(47451),h=a(69410),y=a(96931),g=a(88589),u=a(80336),x=a(80009),f=a(99376),b=a(25193),_=a(37410),j=a(20148),v=a(99458),w=a(8900),F=a(26349),k=a(88009),C=a(70464),S=a(15424),Z=a(78355),E=a(29271),B=a(83669),I=a(97235),R=a(67918),P=a(2938),z=a(55170);let{Title:T,Text:M}=r.default,D=[{payment_method_name:"Cash",display_name:"เงินสด"},{payment_method_name:"PromptPay",display_name:"พร้อมเพย์"},{payment_method_name:"Delivery",display_name:"เดลิเวอรี่"}],L=new Set(D.map(e=>e.payment_method_name)),N=e=>L.has(e),A=e=>{if(!e)return"-";let t=new Date(e);return Number.isNaN(t.getTime())?"-":new Intl.DateTimeFormat("th-TH",{dateStyle:"medium",timeStyle:"short"}).format(t)},W=e=>{let{displayName:t,methodName:a,isActive:o}=e;return(0,n.jsxs)("div",{style:{background:"white",borderRadius:20,padding:20,boxShadow:"0 10px 30px rgba(0,0,0,0.05)",border:"1px solid #F1F5F9"},children:[(0,n.jsx)(T,{level:5,style:{color:"#059669",marginBottom:16,fontWeight:700},children:"ตัวอย่างการแสดงผล"}),(0,n.jsxs)("div",{style:{borderRadius:16,border:"1px solid ".concat(o?"#bbf7d0":"#e2e8f0"),padding:14,background:o?"#f0fdf4":"#f8fafc",display:"flex",alignItems:"center",gap:12,marginBottom:16},children:[(0,n.jsx)("div",{style:{width:48,height:48,borderRadius:12,background:o?"linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%)":"#e2e8f0",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:(0,n.jsx)(v.Z,{style:{fontSize:20,color:o?"#059669":"#64748b"}})}),(0,n.jsxs)("div",{style:{textAlign:"left",flex:1},children:[(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,n.jsx)(M,{strong:!0,style:{fontSize:16,color:"#0f172a"},children:t||"ชื่อแสดงผล"}),o&&(0,n.jsx)(w.Z,{style:{color:"#10B981",fontSize:14}})]}),(0,n.jsx)(M,{type:"secondary",style:{fontSize:13,display:"block"},children:a||"payment_method_name"})]})]}),(0,n.jsx)(i.Z,{type:o?"success":"warning",showIcon:!0,message:o?"ช่องทางนี้พร้อมใช้งานในการรับชำระ":"ช่องทางนี้จะไม่แสดงให้เลือกชำระเงิน"})]})};function O(e){var t,a,r;let{params:v}=e,w=(0,f.useRouter)(),[L]=s.Z.useForm(),[O,H]=(0,o.useState)(!1),[U,V]=(0,o.useState)(!1),[Y,q]=(0,o.useState)(""),[X,J]=(0,o.useState)(""),[G,K]=(0,o.useState)(!0),[Q,$]=(0,o.useState)(""),[ee,et]=(0,o.useState)(null),[ea,en]=(0,o.useState)(""),[eo,er]=(0,o.useState)(!1),[ei,es]=(0,o.useState)([]),ed=null===(t=v.mode)||void 0===t?void 0:t[0],el=(null===(a=v.mode)||void 0===a?void 0:a[1])||null,ec="add"===ed||"edit"===ed,em="edit"===ed&&!!el,{isAuthorized:ep,isChecking:eh}=(0,R.e)({allowedRoles:["Admin","Manager"]}),ey=(0,o.useMemo)(()=>em?"แก้ไขวิธีการชำระเงิน":"เพิ่มวิธีการชำระเงิน",[em]);(0,o.useEffect)(()=>{ec&&("edit"!==ed||el)||(d.ZP.warning("รูปแบบ URL ไม่ถูกต้อง"),w.replace("/pos/paymentMethod"))},[ec,ed,el,w]),(0,o.useEffect)(()=>{let e=async()=>{try{let e=await fetch("/api/pos/paymentMethod?limit=100");if(e.ok){let t=await e.json();(null==t?void 0:t.data)&&es(t.data.map(e=>e.payment_method_name.trim().toLowerCase()))}}catch(e){console.error("Failed to fetch existing methods:",e)}};(async()=>{$(await (0,I.P)())})(),e()},[]);let eg=(0,o.useCallback)(async()=>{if(el){H(!0);try{let e=await fetch("/api/pos/paymentMethod/getById/".concat(el));if(!e.ok)throw Error("ไม่สามารถดึงข้อมูลวิธีการชำระเงินได้");let t=await e.json();L.setFieldsValue({payment_method_name:t.payment_method_name,display_name:t.display_name,is_active:t.is_active}),q(t.display_name||""),J(t.payment_method_name||""),K(t.is_active),en((t.payment_method_name||"").toLowerCase()),et(t)}catch(e){console.error(e),d.ZP.error("ไม่สามารถดึงข้อมูลวิธีการชำระเงินได้"),w.replace("/pos/paymentMethod")}finally{H(!1)}}},[el,L,w]);(0,o.useEffect)(()=>{em&&eg()},[em,eg]);let eu=(0,o.useCallback)(async e=>{let t=e.trim();if(!t||em&&t.toLowerCase()===ea)return!1;try{let e=await fetch("/api/pos/paymentMethod/getByName/".concat(encodeURIComponent(t)));if(!e.ok)return!1;let a=await e.json();if(!(null==a?void 0:a.id)||em&&a.id===el)return!1;return!0}catch(e){return!1}},[ea,el,em]),ex=async e=>{V(!0);try{if(!N(e.payment_method_name.trim()))throw Error("ชื่อในระบบต้องเป็น Cash, PromptPay หรือ Delivery เท่านั้น");let t={payment_method_name:e.payment_method_name.trim(),display_name:e.display_name.trim(),is_active:e.is_active},a=em?"/api/pos/paymentMethod/update/".concat(el):"/api/pos/paymentMethod/create",n=em?"PUT":"POST",o=await fetch(a,{method:n,headers:{"Content-Type":"application/json","X-CSRF-Token":Q},body:JSON.stringify(t)});if(!o.ok){let e=await o.json().catch(()=>({}));throw Error(e.error||e.message||(em?"ไม่สามารถอัปเดตวิธีการชำระเงินได้":"ไม่สามารถสร้างวิธีการชำระเงินได้"))}d.ZP.success(em?"อัปเดตวิธีการชำระเงินสำเร็จ":"สร้างวิธีการชำระเงินสำเร็จ"),w.push("/pos/paymentMethod")}catch(e){console.error(e),d.ZP.error(e instanceof Error?e.message:"ไม่สามารถบันทึกข้อมูลได้")}finally{V(!1)}},ef=()=>w.push("/pos/paymentMethod");return eh?(0,n.jsx)(P.H,{message:"กำลังตรวจสอบสิทธิ์..."}):ep?(0,n.jsxs)("div",{className:"manage-page",style:z.R.container,children:[(0,n.jsx)(j.Z,{title:ey,subtitle:em?"ปรับแก้ชื่อและสถานะวิธีการชำระเงิน":"สร้างวิธีการชำระเงินใหม่ให้พร้อมใช้งาน",onBack:ef,actions:em?(0,n.jsx)(c.ZP,{danger:!0,onClick:()=>{el&&l.Z.confirm({title:"ยืนยันการลบวิธีการชำระเงิน",content:'คุณต้องการลบวิธีการชำระเงิน "'.concat(Y||X||"-",'" หรือไม่?'),okText:"ลบ",okType:"danger",cancelText:"ยกเลิก",centered:!0,icon:(0,n.jsx)(F.Z,{style:{color:"#EF4444"}}),onOk:async()=>{try{if(!(await fetch("/api/pos/paymentMethod/delete/".concat(el),{method:"DELETE",headers:{"X-CSRF-Token":Q}})).ok)throw Error("ไม่สามารถลบวิธีการชำระเงินได้");d.ZP.success("ลบวิธีการชำระเงินสำเร็จ"),w.push("/pos/paymentMethod")}catch(e){console.error(e),d.ZP.error("ไม่สามารถลบวิธีการชำระเงินได้")}}})},icon:(0,n.jsx)(F.Z,{}),children:"ลบ"}):null}),(0,n.jsx)(b.Z,{maxWidth:1040,children:(0,n.jsx)(_.Z,{style:{background:"transparent",border:"none"},children:O?(0,n.jsx)("div",{style:{display:"flex",justifyContent:"center",padding:"90px 0"},children:(0,n.jsx)(m.Z,{size:"large",tip:"กำลังโหลดข้อมูล..."})}):(0,n.jsxs)(p.Z,{gutter:[20,20],children:[(0,n.jsx)(h.Z,{xs:24,lg:15,children:(0,n.jsxs)(y.Z,{bordered:!1,style:{borderRadius:20,boxShadow:"0 4px 20px rgba(0,0,0,0.04)",overflow:"hidden"},styles:{body:{padding:24}},children:[(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:10,marginBottom:20},children:[(0,n.jsx)(k.Z,{style:{fontSize:20,color:"#059669"}}),(0,n.jsx)(T,{level:5,style:{margin:0},children:"ข้อมูลวิธีการชำระเงิน"})]}),(0,n.jsxs)(s.Z,{form:L,layout:"vertical",onFinish:ex,requiredMark:!1,autoComplete:"off",initialValues:{is_active:!0},onValuesChange:e=>{void 0!==e.display_name&&q(e.display_name),void 0!==e.payment_method_name&&J(e.payment_method_name),void 0!==e.is_active&&K(e.is_active)},children:[(0,n.jsx)(s.Z.Item,{name:"payment_method_name",label:(0,n.jsx)("span",{style:{fontWeight:600,color:"#334155"},children:"ชื่อในระบบ (payment_method_name)"}),validateTrigger:["onBlur","onSubmit"],rules:[{required:!0,message:"กรุณากรอกชื่อในระบบ"},{validator:async(e,t)=>{if(null==t?void 0:t.trim()){if(!N(t.trim()))throw Error("เลือกได้เฉพาะ Cash, PromptPay หรือ Delivery");if(await eu(t))throw Error("ชื่อวิธีชำระเงินนี้ถูกใช้งานแล้ว")}}}],children:em?(0,n.jsx)(g.default,{size:"large",disabled:!0,style:{borderRadius:12,height:46,backgroundColor:"#F8FAFC",border:"1px solid #E2E8F0"}}):(0,n.jsxs)("div",{onClick:()=>er(!0),style:{padding:"10px 16px",borderRadius:12,border:"2px solid",cursor:"pointer",background:X?"linear-gradient(135deg, #ECFDF5 0%, #D1FAE5 100%)":"#fff",borderColor:X?"#059669":"#e2e8f0",display:"flex",justifyContent:"space-between",alignItems:"center",minHeight:46},children:[(0,n.jsx)("span",{style:{color:X?"#1e293b":"#94a3b8",fontWeight:X?600:400},children:X?"".concat(X," (").concat(null===(r=D.find(e=>e.payment_method_name===X))||void 0===r?void 0:r.display_name,")"):"เลือกชื่อในระบบ"}),(0,n.jsx)(C.Z,{style:{fontSize:12,color:"#94a3b8"}})]})}),(0,n.jsx)(s.Z.Item,{name:"display_name",label:(0,n.jsx)("span",{style:{fontWeight:600,color:"#334155"},children:"ชื่อที่แสดง"}),rules:[{required:!0,message:"กรุณากรอกชื่อที่แสดง"},{max:100,message:"ความยาวต้องไม่เกิน 100 ตัวอักษร"}],children:(0,n.jsx)(g.default,{size:"large",disabled:!0,maxLength:100,style:{borderRadius:12,height:46,backgroundColor:"#F8FAFC",border:"1px solid #E2E8F0"}})}),(0,n.jsx)("div",{style:{padding:"16px",background:"#F8FAFC",borderRadius:14,marginTop:16,marginBottom:18},children:(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:12},children:[(0,n.jsxs)("div",{children:[(0,n.jsx)(M,{strong:!0,style:{fontSize:15,display:"block"},children:"สถานะการใช้งาน"}),(0,n.jsx)(M,{type:"secondary",style:{fontSize:13},children:"เปิดเพื่อให้ใช้งานในหน้า POS"})]}),(0,n.jsx)(s.Z.Item,{name:"is_active",valuePropName:"checked",noStyle:!0,children:(0,n.jsx)(u.Z,{style:{background:G?"#10B981":void 0}})})]})}),(0,n.jsx)(i.Z,{showIcon:!0,type:"info",icon:(0,n.jsx)(S.Z,{}),message:"ข้อมูลที่จำเป็น",description:"ชื่อในระบบเลือกได้เฉพาะ 3 แบบ: Cash, PromptPay, Delivery และระบบจะตั้งชื่อที่แสดงให้อัตโนมัติ",style:{marginBottom:24}}),(0,n.jsxs)("div",{style:{marginTop:12,display:"flex",gap:12},children:[(0,n.jsx)(c.ZP,{size:"large",onClick:ef,style:{flex:1,borderRadius:12,height:46,fontWeight:600},children:"ยกเลิก"}),(0,n.jsx)(c.ZP,{type:"primary",htmlType:"submit",loading:U,icon:(0,n.jsx)(Z.Z,{}),style:{flex:2,borderRadius:12,height:46,fontWeight:600,background:"#059669",boxShadow:"0 4px 12px rgba(5, 150, 105, 0.25)"},children:"บันทึกข้อมูล"})]})]})]})}),(0,n.jsx)(h.Z,{xs:24,lg:9,children:(0,n.jsxs)("div",{style:{display:"grid",gap:14},children:[(0,n.jsx)(W,{displayName:Y,methodName:X,isActive:G}),em?(0,n.jsxs)(y.Z,{style:{borderRadius:16},children:[(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:10},children:[(0,n.jsx)(E.Z,{style:{color:"#0369a1"}}),(0,n.jsx)(M,{strong:!0,children:"รายละเอียดรายการ"})]}),(0,n.jsxs)("div",{style:{display:"grid",gap:8},children:[(0,n.jsxs)(M,{type:"secondary",children:["ID: ",(null==ee?void 0:ee.id)||"-"]}),(0,n.jsxs)(M,{type:"secondary",children:["สร้างเมื่อ: ",A(null==ee?void 0:ee.create_date)]})]})]}):null]})})]})})}),(0,n.jsx)(l.Z,{title:"เลือกชื่อในระบบ",open:eo,onCancel:()=>er(!1),footer:null,centered:!0,width:400,styles:{body:{padding:"12px 16px 24px"}},children:(0,n.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:10,maxHeight:"60vh",overflowY:"auto"},children:D.map(e=>{let t=e.payment_method_name.trim().toLowerCase(),a=ei.includes(t);return(0,n.jsxs)("div",{onClick:()=>{a||(L.setFieldsValue({payment_method_name:e.payment_method_name,display_name:e.display_name}),q(e.display_name),J(e.payment_method_name),er(!1))},style:{padding:"14px 18px",border:"2px solid",borderRadius:12,cursor:a?"not-allowed":"pointer",background:X===e.payment_method_name?"#f0fdf4":a?"#f8fafc":"#fff",borderColor:X===e.payment_method_name?"#10B981":a?"#e2e8f0":"#e5e7eb",display:"flex",justifyContent:"space-between",alignItems:"center",minHeight:54,opacity:a?.6:1},children:[(0,n.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,n.jsx)("span",{style:{fontWeight:X===e.payment_method_name?600:400,fontSize:16,textDecoration:a?"line-through":"none",color:a?"#94a3b8":"inherit"},children:e.payment_method_name}),(0,n.jsx)("span",{style:{fontSize:12,color:a?"#cbd5e1":"#64748b"},children:a?"มีในระบบแล้ว":e.display_name})]}),X===e.payment_method_name&&(0,n.jsx)(B.Z,{style:{color:"#10B981",fontSize:18}}),a&&(0,n.jsx)(x.Z,{bordered:!1,color:"default",children:"มีแล้ว"})]},e.payment_method_name)})})})]}):(0,n.jsx)(P.H,{message:"คุณไม่มีสิทธิ์เข้าถึงหน้านี้",tone:"danger"})}},55170:function(e,t,a){"use strict";a.d(t,{R:function(){return o},W:function(){return r}});var n=a(69397);let o={...(0,n.yf)("linear-gradient(135deg, #10b981 0%, #059669 100%)"),paymentMethodCard:n.YO,paymentMethodCardInner:n.lv},r=(0,n.IU)(".payment-method-page",".payment-method-card")},69397:function(e,t,a){"use strict";a.d(t,{IU:function(){return d},YO:function(){return i},lv:function(){return s},yf:function(){return r}});let n={colors:{primary:"#6366F1",primaryLight:"#EEF2FF",success:"#10B981",successLight:"#ECFDF5",warning:"#F59E0B",warningLight:"#FFFBEB",error:"#EF4444",errorLight:"#FEF2F2",info:"#3B82F6",infoLight:"#EFF6FF",bg:"#F8FAFC",card:"#FFFFFF",border:"#E2E8F0",borderLight:"#F1F5F9",text:"#1E293B",textSecondary:"#64748B",textMuted:"#94A3B8"},radius:{sm:8,md:12,lg:16,xl:20},shadow:{sm:"0 1px 2px rgba(0, 0, 0, 0.04)",md:"0 4px 12px rgba(0, 0, 0, 0.06)",lg:"0 8px 24px rgba(0, 0, 0, 0.08)"}},o={container:{paddingBottom:100,backgroundColor:n.colors.bg,minHeight:"100dvh",width:"100%",overflowX:"hidden"},header:{background:"linear-gradient(135deg, ".concat(n.colors.primary," 0%, #4F46E5 100%)"),padding:"16px 16px 48px 16px",position:"relative",overflow:"hidden",borderBottomLeftRadius:n.radius.xl,borderBottomRightRadius:n.radius.xl},headerDecoCircle1:{position:"absolute",top:-40,right:-40,width:120,height:120,borderRadius:"50%",background:"rgba(255,255,255,0.08)"},headerDecoCircle2:{position:"absolute",bottom:-20,left:-20,width:80,height:80,borderRadius:"50%",background:"rgba(255,255,255,0.06)"},headerContent:{position:"relative",zIndex:1,display:"flex",alignItems:"center",justifyContent:"space-between",gap:12},headerLeft:{display:"flex",alignItems:"center",gap:12,flex:1},headerIconBox:{width:44,height:44,borderRadius:n.radius.md,background:"rgba(255,255,255,0.15)",display:"flex",alignItems:"center",justifyContent:"center",backdropFilter:"blur(8px)",flexShrink:0},headerTitle:{color:"#fff",margin:0,fontSize:18,fontWeight:600},headerSubtitle:{color:"rgba(255,255,255,0.8)",fontSize:13,margin:0},headerActions:{display:"flex",gap:8,flexShrink:0},statsCard:{margin:"-32px 16px 0 16px",padding:16,background:n.colors.card,borderRadius:n.radius.lg,boxShadow:n.shadow.md,display:"flex",justifyContent:"space-around",position:"relative",zIndex:10},statItem:{textAlign:"center",flex:1},statNumber:{fontSize:22,fontWeight:700,display:"block",color:n.colors.text},statLabel:{fontSize:12,color:n.colors.textMuted,marginTop:2},listContainer:{padding:"16px 16px 0 16px"},sectionTitle:{display:"flex",alignItems:"center",gap:8,marginBottom:12,fontSize:15,fontWeight:600,color:n.colors.text}},r=e=>({...o,header:{...o.header,background:e}}),i=e=>({marginBottom:12,borderRadius:n.radius.lg,border:"1px solid ".concat(e?n.colors.border:n.colors.borderLight),boxShadow:e?n.shadow.sm:"none",overflow:"hidden",transition:"all 0.2s ease",background:n.colors.card,opacity:e?1:.6}),s={padding:16,display:"flex",alignItems:"center",gap:12};n.radius.md;let d=(e,t)=>"\n  /* Card animations */\n  ".concat(t," {\n    animation: fadeSlideIn 0.3s ease both;\n  }\n  \n  ").concat(t,":hover {\n    transform: translateY(-2px);\n    box-shadow: ").concat(n.shadow.md," !important;\n  }\n  \n  ").concat(t,":active {\n    transform: scale(0.99);\n  }\n  \n  /* Scrollbar */\n  ").concat(e," *::-webkit-scrollbar {\n    width: 5px;\n    height: 5px;\n  }\n  ").concat(e," *::-webkit-scrollbar-track {\n    background: transparent;\n  }\n  ").concat(e," *::-webkit-scrollbar-thumb {\n    background: #CBD5E1;\n    border-radius: 3px;\n  }\n  ").concat(e," *::-webkit-scrollbar-thumb:hover {\n    background: #94A3B8;\n  }\n")}},function(e){e.O(0,[253,1522,3418,742,9486,4252,3916,8651,6931,4159,3831,2224,3248,9,8879,8589,4221,9878,2243,4591,9385,4390,2971,2117,1744],function(){return e(e.s=81316)}),_N_E=e.O()}]);