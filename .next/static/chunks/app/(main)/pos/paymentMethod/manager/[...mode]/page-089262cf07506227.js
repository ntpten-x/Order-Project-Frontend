(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9776],{81316:function(e,t,a){Promise.resolve().then(a.bind(a,44589))},44589:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return O}});var s=a(57437),n=a(2265),i=a(60283),r=a(61778),o=a(19878),l=a(34029),d=a(53743),c=a(50742),m=a(48651),y=a(47451),p=a(69410),h=a(96931),u=a(88589),g=a(93834),x=a(66487),f=a(99376),_=a(25193),j=a(37410),b=a(20148),v=a(99458),Z=a(8900),w=a(26349),k=a(88009),S=a(15424),C=a(78355),P=a(29271),F=a(97235),E=a(67918),R=a(2938),T=a(55170);let{Title:I,Text:M}=i.default,z=[{payment_method_name:"Cash",display_name:"เงินสด"},{payment_method_name:"PromptPay",display_name:"พร้อมเพย์"},{payment_method_name:"Delivery",display_name:"เดลิเวอรี่"}],B=new Set(z.map(e=>e.payment_method_name)),N=e=>B.has(e),D=e=>{if(!e)return"-";let t=new Date(e);return Number.isNaN(t.getTime())?"-":new Intl.DateTimeFormat("th-TH",{dateStyle:"medium",timeStyle:"short"}).format(t)},A=e=>{let{displayName:t,methodName:a,isActive:n}=e;return(0,s.jsxs)("div",{style:{background:"white",borderRadius:20,padding:20,boxShadow:"0 10px 30px rgba(0,0,0,0.05)",border:"1px solid #F1F5F9"},children:[(0,s.jsx)(I,{level:5,style:{color:"#059669",marginBottom:16,fontWeight:700},children:"ตัวอย่างการแสดงผล"}),(0,s.jsxs)("div",{style:{borderRadius:16,border:"1px solid ".concat(n?"#bbf7d0":"#e2e8f0"),padding:14,background:n?"#f0fdf4":"#f8fafc",display:"flex",alignItems:"center",gap:12,marginBottom:16},children:[(0,s.jsx)("div",{style:{width:48,height:48,borderRadius:12,background:n?"linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%)":"#e2e8f0",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:(0,s.jsx)(v.Z,{style:{fontSize:20,color:n?"#059669":"#64748b"}})}),(0,s.jsxs)("div",{style:{textAlign:"left",flex:1},children:[(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,s.jsx)(M,{strong:!0,style:{fontSize:16,color:"#0f172a"},children:t||"ชื่อแสดงผล"}),n&&(0,s.jsx)(Z.Z,{style:{color:"#10B981",fontSize:14}})]}),(0,s.jsx)(M,{type:"secondary",style:{fontSize:13,display:"block"},children:a||"payment_method_name"})]})]}),(0,s.jsx)(r.Z,{type:n?"success":"warning",showIcon:!0,message:n?"ช่องทางนี้พร้อมใช้งานในการรับชำระ":"ช่องทางนี้จะไม่แสดงให้เลือกชำระเงิน"})]})};function O(e){var t,a;let{params:i}=e,v=(0,f.useRouter)(),[Z]=o.Z.useForm(),[B,O]=(0,n.useState)(!1),[W,L]=(0,n.useState)(!1),[V,q]=(0,n.useState)(""),[H,U]=(0,n.useState)(""),[X,J]=(0,n.useState)(!0),[G,K]=(0,n.useState)(""),[Q,Y]=(0,n.useState)(null),[$,ee]=(0,n.useState)(""),et=null===(t=i.mode)||void 0===t?void 0:t[0],ea=(null===(a=i.mode)||void 0===a?void 0:a[1])||null,es="add"===et||"edit"===et,en="edit"===et&&!!ea,{isAuthorized:ei,isChecking:er}=(0,E.e)({allowedRoles:["Admin","Manager"]}),eo=(0,n.useMemo)(()=>en?"แก้ไขวิธีการชำระเงิน":"เพิ่มวิธีการชำระเงิน",[en]);(0,n.useEffect)(()=>{es&&("edit"!==et||ea)||(l.ZP.warning("รูปแบบ URL ไม่ถูกต้อง"),v.replace("/pos/paymentMethod"))},[es,et,ea,v]),(0,n.useEffect)(()=>{(async()=>{K(await (0,F.P)())})()},[]);let el=(0,n.useCallback)(async()=>{if(ea){O(!0);try{let e=await fetch("/api/pos/paymentMethod/getById/".concat(ea));if(!e.ok)throw Error("ไม่สามารถดึงข้อมูลวิธีการชำระเงินได้");let t=await e.json();Z.setFieldsValue({payment_method_name:t.payment_method_name,display_name:t.display_name,is_active:t.is_active}),q(t.display_name||""),U(t.payment_method_name||""),J(t.is_active),ee((t.payment_method_name||"").toLowerCase()),Y(t)}catch(e){console.error(e),l.ZP.error("ไม่สามารถดึงข้อมูลวิธีการชำระเงินได้"),v.replace("/pos/paymentMethod")}finally{O(!1)}}},[ea,Z,v]);(0,n.useEffect)(()=>{en&&el()},[en,el]);let ed=(0,n.useCallback)(async e=>{let t=e.trim();if(!t||en&&t.toLowerCase()===$)return!1;try{let e=await fetch("/api/pos/paymentMethod/getByName/".concat(encodeURIComponent(t)));if(!e.ok)return!1;let a=await e.json();if(!(null==a?void 0:a.id)||en&&a.id===ea)return!1;return!0}catch(e){return!1}},[$,ea,en]),ec=async e=>{L(!0);try{if(!N(e.payment_method_name.trim()))throw Error("ชื่อในระบบต้องเป็น Cash, PromptPay หรือ Delivery เท่านั้น");let t={payment_method_name:e.payment_method_name.trim(),display_name:e.display_name.trim(),is_active:e.is_active},a=en?"/api/pos/paymentMethod/update/".concat(ea):"/api/pos/paymentMethod/create",s=en?"PUT":"POST",n=await fetch(a,{method:s,headers:{"Content-Type":"application/json","X-CSRF-Token":G},body:JSON.stringify(t)});if(!n.ok){let e=await n.json().catch(()=>({}));throw Error(e.error||e.message||(en?"ไม่สามารถอัปเดตวิธีการชำระเงินได้":"ไม่สามารถสร้างวิธีการชำระเงินได้"))}l.ZP.success(en?"อัปเดตวิธีการชำระเงินสำเร็จ":"สร้างวิธีการชำระเงินสำเร็จ"),v.push("/pos/paymentMethod")}catch(e){console.error(e),l.ZP.error(e instanceof Error?e.message:"ไม่สามารถบันทึกข้อมูลได้")}finally{L(!1)}},em=()=>v.push("/pos/paymentMethod");return er?(0,s.jsx)(R.H,{message:"กำลังตรวจสอบสิทธิ์..."}):ei?(0,s.jsxs)("div",{className:"manage-page",style:T.R.container,children:[(0,s.jsx)(b.Z,{title:eo,subtitle:en?"ปรับแก้ชื่อและสถานะวิธีการชำระเงิน":"สร้างวิธีการชำระเงินใหม่ให้พร้อมใช้งาน",onBack:em,actions:en?(0,s.jsx)(c.ZP,{danger:!0,onClick:()=>{ea&&d.Z.confirm({title:"ยืนยันการลบวิธีการชำระเงิน",content:'คุณต้องการลบวิธีการชำระเงิน "'.concat(V||H||"-",'" หรือไม่?'),okText:"ลบ",okType:"danger",cancelText:"ยกเลิก",centered:!0,icon:(0,s.jsx)(w.Z,{style:{color:"#EF4444"}}),onOk:async()=>{try{if(!(await fetch("/api/pos/paymentMethod/delete/".concat(ea),{method:"DELETE",headers:{"X-CSRF-Token":G}})).ok)throw Error("ไม่สามารถลบวิธีการชำระเงินได้");l.ZP.success("ลบวิธีการชำระเงินสำเร็จ"),v.push("/pos/paymentMethod")}catch(e){console.error(e),l.ZP.error("ไม่สามารถลบวิธีการชำระเงินได้")}}})},icon:(0,s.jsx)(w.Z,{}),children:"ลบ"}):null}),(0,s.jsx)(_.Z,{maxWidth:1040,children:(0,s.jsx)(j.Z,{style:{background:"transparent",border:"none"},children:B?(0,s.jsx)("div",{style:{display:"flex",justifyContent:"center",padding:"90px 0"},children:(0,s.jsx)(m.Z,{size:"large",tip:"กำลังโหลดข้อมูล..."})}):(0,s.jsxs)(y.Z,{gutter:[20,20],children:[(0,s.jsx)(p.Z,{xs:24,lg:15,children:(0,s.jsxs)(h.Z,{bordered:!1,style:{borderRadius:20,boxShadow:"0 4px 20px rgba(0,0,0,0.04)",overflow:"hidden"},styles:{body:{padding:24}},children:[(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:10,marginBottom:20},children:[(0,s.jsx)(k.Z,{style:{fontSize:20,color:"#059669"}}),(0,s.jsx)(I,{level:5,style:{margin:0},children:"ข้อมูลวิธีการชำระเงิน"})]}),(0,s.jsxs)(o.Z,{form:Z,layout:"vertical",onFinish:ec,requiredMark:!1,autoComplete:"off",initialValues:{is_active:!0},onValuesChange:e=>{void 0!==e.display_name&&q(e.display_name),void 0!==e.payment_method_name&&U(e.payment_method_name),void 0!==e.is_active&&J(e.is_active)},children:[(0,s.jsx)(o.Z.Item,{name:"payment_method_name",label:(0,s.jsx)("span",{style:{fontWeight:600,color:"#334155"},children:"ชื่อในระบบ (payment_method_name)"}),validateTrigger:["onBlur","onSubmit"],rules:[{required:!0,message:"กรุณากรอกชื่อในระบบ"},{validator:async(e,t)=>{if(null==t?void 0:t.trim()){if(!N(t.trim()))throw Error("เลือกได้เฉพาะ Cash, PromptPay หรือ Delivery");if(await ed(t))throw Error("ชื่อวิธีชำระเงินนี้ถูกใช้งานแล้ว")}}}],children:en?(0,s.jsx)(u.default,{size:"large",disabled:!0,style:{borderRadius:12,height:46,backgroundColor:"#F8FAFC",border:"1px solid #E2E8F0"}}):(0,s.jsx)(g.default,{size:"large",placeholder:"เลือกชื่อในระบบ",getPopupContainer:()=>document.body,style:{borderRadius:12},options:z.map(e=>({value:e.payment_method_name,label:"".concat(e.payment_method_name," (").concat(e.display_name,")")})),onChange:e=>{let t=z.find(t=>t.payment_method_name===e);t&&(Z.setFieldsValue({display_name:t.display_name}),q(t.display_name),U(t.payment_method_name))}})}),(0,s.jsx)(o.Z.Item,{name:"display_name",label:(0,s.jsx)("span",{style:{fontWeight:600,color:"#334155"},children:"ชื่อที่แสดง"}),rules:[{required:!0,message:"กรุณากรอกชื่อที่แสดง"},{max:100,message:"ความยาวต้องไม่เกิน 100 ตัวอักษร"}],children:(0,s.jsx)(u.default,{size:"large",disabled:!0,maxLength:100,style:{borderRadius:12,height:46,backgroundColor:"#F8FAFC",border:"1px solid #E2E8F0"}})}),(0,s.jsx)("div",{style:{padding:"16px",background:"#F8FAFC",borderRadius:14,marginTop:16,marginBottom:18},children:(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:12},children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(M,{strong:!0,style:{fontSize:15,display:"block"},children:"สถานะการใช้งาน"}),(0,s.jsx)(M,{type:"secondary",style:{fontSize:13},children:"เปิดเพื่อให้ใช้งานในหน้า POS"})]}),(0,s.jsx)(o.Z.Item,{name:"is_active",valuePropName:"checked",noStyle:!0,children:(0,s.jsx)(x.Z,{style:{background:X?"#10B981":void 0}})})]})}),(0,s.jsx)(r.Z,{showIcon:!0,type:"info",icon:(0,s.jsx)(S.Z,{}),message:"ข้อมูลที่จำเป็น",description:"ชื่อในระบบเลือกได้เฉพาะ 3 แบบ: Cash, PromptPay, Delivery และระบบจะตั้งชื่อที่แสดงให้อัตโนมัติ",style:{marginBottom:24}}),(0,s.jsxs)("div",{style:{marginTop:12,display:"flex",gap:12},children:[(0,s.jsx)(c.ZP,{size:"large",onClick:em,style:{flex:1,borderRadius:12,height:46,fontWeight:600},children:"ยกเลิก"}),(0,s.jsx)(c.ZP,{type:"primary",htmlType:"submit",loading:W,icon:(0,s.jsx)(C.Z,{}),style:{flex:2,borderRadius:12,height:46,fontWeight:600,background:"#059669",boxShadow:"0 4px 12px rgba(5, 150, 105, 0.25)"},children:"บันทึกข้อมูล"})]})]})]})}),(0,s.jsx)(p.Z,{xs:24,lg:9,children:(0,s.jsxs)("div",{style:{display:"grid",gap:14},children:[(0,s.jsx)(A,{displayName:V,methodName:H,isActive:X}),en?(0,s.jsxs)(h.Z,{style:{borderRadius:16},children:[(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:10},children:[(0,s.jsx)(P.Z,{style:{color:"#0369a1"}}),(0,s.jsx)(M,{strong:!0,children:"รายละเอียดรายการ"})]}),(0,s.jsxs)("div",{style:{display:"grid",gap:8},children:[(0,s.jsxs)(M,{type:"secondary",children:["ID: ",(null==Q?void 0:Q.id)||"-"]}),(0,s.jsxs)(M,{type:"secondary",children:["สร้างเมื่อ: ",D(null==Q?void 0:Q.create_date)]})]})]}):null]})})]})})})]}):(0,s.jsx)(R.H,{message:"คุณไม่มีสิทธิ์เข้าถึงหน้านี้",tone:"danger"})}}},function(e){e.O(0,[8024,4736,8592,1744],function(){return e(e.s=81316)}),_N_E=e.O()}]);