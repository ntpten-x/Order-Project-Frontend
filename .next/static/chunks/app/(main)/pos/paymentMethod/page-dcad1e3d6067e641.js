(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3468],{67601:function(e,t,n){Promise.resolve().then(n.bind(n,74841))},74841:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return K}});var i=n(57437),s=n(2265),a=n(60283),l=n(69410),d=n(80009),o=n(50742),r=n(53743),c=n(34029),p=n(24783),h=n(88589),x=n(47451),y=n(62297),g=n(20955),f=n(86955),m=n(37527),u=n(99458),j=n(8900),b=n(39725),v=n(13377),Z=n(26349),k=n(29436),S=n(89245),_=n(96473),w=n(99376),C=n(3369),z=n(26972),E=n(24675),F=n(97235),M=n(67918),P=n(67697),R=n(73814),A=n(12028),B=n(63836),T=n(69397);({...(0,T.yf)("linear-gradient(135deg, #10b981 0%, #059669 100%)"),paymentMethodCard:T.YO,paymentMethodCardInner:T.lv});let I=(0,T.IU)(".payment-method-page",".payment-method-card");var W=n(12093),L=n(2938),N=n(25193),O=n(37410),D=n(27623),H=n(20148),q=n(2786);let{Text:U}=a.default,J="pos:payment-methods",X=e=>{let{totalPaymentMethods:t,activePaymentMethods:n,inactivePaymentMethods:s}=e;return(0,i.jsxs)("div",{className:"grid grid-cols-3 gap-2 md:gap-4",style:{background:"white",borderRadius:16,boxShadow:"0 2px 12px rgba(0,0,0,0.04)",padding:"12px 8px",marginBottom:20},children:[(0,i.jsxs)("div",{style:{textAlign:"center",padding:"8px 4px"},children:[(0,i.jsx)("span",{style:{fontSize:20,fontWeight:700,color:"#10b981",display:"block"},children:t}),(0,i.jsx)(U,{style:{fontSize:11,color:"#64748b"},children:"ทั้งหมด"})]}),(0,i.jsxs)("div",{style:{textAlign:"center",padding:"8px 4px",borderLeft:"1px solid #f0f0f0",borderRight:"1px solid #f0f0f0"},children:[(0,i.jsx)("span",{style:{fontSize:20,fontWeight:700,color:"#52c41a",display:"block"},children:n}),(0,i.jsx)(U,{style:{fontSize:11,color:"#64748b"},children:"เปิดใช้"})]}),(0,i.jsxs)("div",{style:{textAlign:"center",padding:"8px 4px"},children:[(0,i.jsx)("span",{style:{fontSize:20,fontWeight:700,color:"#ff4d4f",display:"block"},children:s}),(0,i.jsx)(U,{style:{fontSize:11,color:"#64748b"},children:"ปิดใช้"})]})]})},Y=e=>{let t=e.toLowerCase();return t.includes("cash")||t.includes("เงินสด")?(0,i.jsx)(g.Z,{}):t.includes("promptpay")||t.includes("พร้อมเพย์")||t.includes("qr")?(0,i.jsx)(f.Z,{}):t.includes("bank")||t.includes("โอน")?(0,i.jsx)(m.Z,{}):(0,i.jsx)(u.Z,{})},G=e=>{let{paymentMethod:t,onEdit:n,onDelete:s}=e,a=Y(t.payment_method_name);return(0,i.jsx)(l.Z,{xs:24,sm:12,lg:8,children:(0,i.jsxs)("div",{style:{background:"white",borderRadius:14,padding:14,boxShadow:"0 2px 6px rgba(0,0,0,0.04)",border:"1px solid #F1F5F9",display:"flex",alignItems:"center",gap:12,opacity:t.is_active?1:.7},onClick:()=>n(t),children:[(0,i.jsx)("div",{style:{width:44,height:44,borderRadius:10,background:t.is_active?"linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%)":"#F1F5F9",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:(0,i.jsx)("div",{style:{fontSize:20,color:t.is_active?"#059669":"#94A3B8"},children:a})}),(0,i.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:6},children:[(0,i.jsx)(U,{strong:!0,ellipsis:!0,style:{fontSize:14,color:"#1E293B"},children:t.display_name||t.payment_method_name}),t.is_active?(0,i.jsx)(j.Z,{style:{color:"#10B981",fontSize:13,flexShrink:0}}):(0,i.jsx)(b.Z,{style:{color:"#EF4444",fontSize:13,flexShrink:0}})]}),(0,i.jsx)(d.Z,{style:{borderRadius:4,margin:0,marginTop:4,fontSize:10,padding:"1px 6px",border:"none",background:"#F1F5F9",color:"#64748B"},children:t.payment_method_name})]}),(0,i.jsxs)("div",{style:{display:"flex",gap:4,flexShrink:0},children:[(0,i.jsx)(o.ZP,{type:"text",size:"small",icon:(0,i.jsx)(v.Z,{}),onClick:e=>{e.stopPropagation(),n(t)},style:{borderRadius:6,color:"#10B981",width:32,height:32,padding:0}}),(0,i.jsx)(o.ZP,{type:"text",size:"small",icon:(0,i.jsx)(Z.Z,{}),onClick:e=>{e.stopPropagation(),s(t)},style:{borderRadius:6,color:"#EF4444",width:32,height:32,padding:0}})]})]})})};function K(){let e=(0,w.useRouter)(),[t,n]=(0,s.useState)([]),[a,l]=(0,s.useState)(1),[d,g]=(0,s.useState)(0),[f,m]=(0,s.useState)(1),[j,b]=(0,s.useState)(""),v=(0,W.c)(j.trim(),400),{execute:T}=(0,z.J)(),{showLoading:U}=(0,C.x)(),{socket:Y}=(0,E.s)(),{isAuthorized:K,isChecking:Q}=(0,M.e)({allowedRoles:["Admin","Manager"]});(0,s.useEffect)(()=>{(0,F.P)()},[]),(0,s.useEffect)(()=>{l(1)},[v]),(0,s.useEffect)(()=>{var e;if(v||1!==a)return;let t=(0,R.t)(J,3e5);(null==t?void 0:null===(e=t.data)||void 0===e?void 0:e.length)&&(n(t.data),g(t.total),m(t.last_page))},[v,a]);let V=(0,s.useCallback)(async()=>{T(async()=>{let e=new URLSearchParams;e.set("page",a.toString()),e.set("limit","50"),v&&e.set("q",v);let t=await B.E.getAll(void 0,e);n(t.data),g(t.total),m(t.last_page),v||1!==a||(0,R.v)(J,t)},"กำลังโหลดข้อมูลวิธีการชำระเงิน...")},[v,T,a]);(0,s.useEffect)(()=>{K&&V()},[K,V]),(0,P.D)({socket:Y,events:[A.b.paymentMethods.create,A.b.paymentMethods.update,A.b.paymentMethods.delete],onRefresh:()=>V(),intervalMs:2e4,debounceMs:1e3});let $=()=>{U("กำลังเปิดหน้าจัดการวิธีชำระเงิน..."),e.push("/pos/paymentMethod/manager/add")},ee=t=>{U("กำลังเปิดหน้าแก้ไขวิธีชำระเงิน..."),e.push("/pos/paymentMethod/manager/edit/".concat(t.id))},et=e=>{r.Z.confirm({title:"ยืนยันการลบวิธีชำระเงิน",content:'คุณต้องการลบวิธีชำระเงิน "'.concat(e.display_name||e.payment_method_name,'" หรือไม่?'),okText:"ลบ",okType:"danger",cancelText:"ยกเลิก",centered:!0,icon:(0,i.jsx)(Z.Z,{style:{color:"#ff4d4f"}}),onOk:async()=>{await T(async()=>{let t=await (0,F.P)();if(!(await fetch("/api/pos/paymentMethod/delete/".concat(e.id),{method:"DELETE",headers:{"X-CSRF-Token":t}})).ok)throw Error("ไม่สามารถลบวิธีชำระเงินได้");c.ZP.success('ลบวิธีชำระเงิน "'.concat(e.display_name||e.payment_method_name,'" สำเร็จ'))},"กำลังลบวิธีชำระเงิน...")}})};if(Q)return(0,i.jsx)(L.H,{message:"กำลังตรวจสอบสิทธิ์การใช้งาน..."});if(!K)return(0,i.jsx)(L.H,{message:"คุณไม่มีสิทธิ์เข้าถึงหน้านี้ กำลังพากลับ...",tone:"danger"});let en=t.filter(e=>e.is_active),ei=t.filter(e=>!e.is_active);return(0,i.jsxs)("div",{style:{padding:16,background:"#F8FAFC",minHeight:"100vh"},children:[(0,i.jsx)("style",{children:I}),(0,i.jsx)(H.Z,{title:"วิธีชำระเงิน",subtitle:"".concat(d," รายการ"),icon:(0,i.jsx)(u.Z,{}),actions:(0,i.jsxs)(p.Z,{size:8,wrap:!0,children:[(0,i.jsx)(h.default,{allowClear:!0,placeholder:"ค้นหาวิธีชำระเงิน...",prefix:(0,i.jsx)(k.Z,{style:{color:"#94A3B8"}}),value:j,onChange:e=>b(e.target.value),style:{minWidth:220}}),(0,i.jsx)(o.ZP,{icon:(0,i.jsx)(S.Z,{}),onClick:V}),(0,i.jsx)(o.ZP,{type:"primary",icon:(0,i.jsx)(_.Z,{}),onClick:$,children:"เพิ่มวิธีชำระเงิน"})]})}),(0,i.jsx)(N.Z,{children:(0,i.jsxs)(D.Z,{children:[(0,i.jsx)(X,{totalPaymentMethods:t.length,activePaymentMethods:en.length,inactivePaymentMethods:ei.length}),(0,i.jsx)(O.Z,{title:"รายการ",children:t.length>0?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(x.Z,{gutter:[12,12],children:t.map(e=>(0,i.jsx)(G,{paymentMethod:e,onEdit:ee,onDelete:et},e.id))}),f>1&&(0,i.jsx)("div",{style:{marginTop:16,display:"flex",justifyContent:"center"},children:(0,i.jsx)(y.Z,{current:a,total:d,pageSize:50,onChange:e=>l(e),showSizeChanger:!1})})]}):(0,i.jsx)(q.Z,{title:j.trim()?"ไม่พบรายการที่ค้นหา":"ยังไม่มีวิธีชำระเงิน",description:j.trim()?"ลองเปลี่ยนคำค้นหาใหม่":"เพิ่มวิธีชำระเงินแรกเพื่อเริ่มใช้งาน",action:j.trim()?null:(0,i.jsx)(o.ZP,{type:"primary",icon:(0,i.jsx)(_.Z,{}),onClick:$,children:"เพิ่มวิธีชำระเงิน"})})})]})})]})}}},function(e){e.O(0,[8024,4736,8592,1744],function(){return e(e.s=67601)}),_N_E=e.O()}]);