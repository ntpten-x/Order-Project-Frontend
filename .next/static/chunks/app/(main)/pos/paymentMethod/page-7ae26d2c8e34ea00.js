(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3468],{67601:function(e,t,i){Promise.resolve().then(i.bind(i,75563))},75563:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return G}});var s=i(57437),n=i(2265),a=i(60283),l=i(80009),o=i(66487),r=i(50742),d=i(53743),c=i(34029),h=i(24783),p=i(88589),u=i(24738),y=i(62297),f=i(20955),x=i(86955),m=i(37527),g=i(99458),j=i(13377),v=i(26349),b=i(89245),Z=i(96473),_=i(29436),k=i(99376),S=i(3369),C=i(26972),w=i(24675),P=i(97235),E=i(67918),M=i(67697),T=i(73814),R=i(12028),z=i(63836),N=i(55170),A=i(12093),I=i(2938),W=i(25193),D=i(37410),F=i(27623),O=i(20148),B=i(2786);let{Text:H}=a.default,L="pos:payment-methods:v2",q=e=>{let{total:t,active:i,inactive:n}=e;return(0,s.jsxs)("div",{style:{background:"#fff",borderRadius:16,border:"1px solid #e2e8f0",display:"grid",gridTemplateColumns:"repeat(3, minmax(0, 1fr))",gap:8,padding:14},children:[(0,s.jsxs)("div",{style:{textAlign:"center"},children:[(0,s.jsx)("span",{style:{fontSize:24,fontWeight:700,color:"#0f172a",display:"block"},children:t}),(0,s.jsx)(H,{style:{fontSize:12,color:"#64748b"},children:"ทั้งหมด"})]}),(0,s.jsxs)("div",{style:{textAlign:"center"},children:[(0,s.jsx)("span",{style:{fontSize:24,fontWeight:700,color:"#0f766e",display:"block"},children:i}),(0,s.jsx)(H,{style:{fontSize:12,color:"#64748b"},children:"ใช้งาน"})]}),(0,s.jsxs)("div",{style:{textAlign:"center"},children:[(0,s.jsx)("span",{style:{fontSize:24,fontWeight:700,color:"#b91c1c",display:"block"},children:n}),(0,s.jsx)(H,{style:{fontSize:12,color:"#64748b"},children:"ปิดใช้งาน"})]})]})},J=e=>{let t=e.toLowerCase();return t.includes("cash")||t.includes("เงินสด")?(0,s.jsx)(f.Z,{}):t.includes("promptpay")||t.includes("พร้อมเพย์")||t.includes("qr")?(0,s.jsx)(x.Z,{}):t.includes("bank")||t.includes("โอน")?(0,s.jsx)(m.Z,{}):(0,s.jsx)(g.Z,{})},U=e=>{if(!e)return"-";let t=new Date(e);return Number.isNaN(t.getTime())?"-":new Intl.DateTimeFormat("th-TH",{dateStyle:"medium",timeStyle:"short"}).format(t)},X=e=>{let{paymentMethod:t,onEdit:i,onDelete:n,onToggleActive:a,updatingStatusId:d}=e,c=J(t.payment_method_name);return(0,s.jsx)("div",{className:"payment-method-card",style:{...N.R.paymentMethodCard(t.is_active),borderRadius:16},onClick:()=>i(t),children:(0,s.jsxs)("div",{style:N.R.paymentMethodCardInner,children:[(0,s.jsx)("div",{style:{width:52,height:52,borderRadius:14,background:t.is_active?"linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%)":"#f1f5f9",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,boxShadow:t.is_active?"0 4px 10px rgba(16, 185, 129, 0.18)":"none"},children:(0,s.jsx)("div",{style:{fontSize:20,color:t.is_active?"#059669":"#94a3b8"},children:c})}),(0,s.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4},children:[(0,s.jsx)(H,{strong:!0,style:{fontSize:16,color:"#0f172a"},ellipsis:{tooltip:t.display_name},children:t.display_name}),(0,s.jsx)(l.Z,{color:t.is_active?"green":"default",children:t.is_active?"ใช้งาน":"ปิดใช้งาน"})]}),(0,s.jsx)(H,{type:"secondary",style:{display:"block",marginBottom:4},ellipsis:{tooltip:t.payment_method_name},children:t.payment_method_name}),(0,s.jsxs)(H,{type:"secondary",style:{fontSize:12},children:["สร้างเมื่อ ",U(t.create_date)]})]}),(0,s.jsxs)("div",{style:{display:"flex",gap:6,alignItems:"center"},children:[(0,s.jsx)(o.Z,{size:"small",checked:t.is_active,loading:d===t.id,onClick:(e,i)=>{null==i||i.stopPropagation(),a(t,e)}}),(0,s.jsx)(r.ZP,{type:"text",icon:(0,s.jsx)(j.Z,{}),onClick:e=>{e.stopPropagation(),i(t)},style:{borderRadius:10,color:"#065f46",background:"#ecfdf5",width:36,height:36}}),(0,s.jsx)(r.ZP,{type:"text",danger:!0,icon:(0,s.jsx)(v.Z,{}),onClick:e=>{e.stopPropagation(),n(t)},style:{borderRadius:10,background:"#fef2f2",width:36,height:36}})]})]})})};function G(){let e=(0,k.useRouter)(),[t,i]=(0,n.useState)([]),[a,l]=(0,n.useState)(1),[o,f]=(0,n.useState)(0),[x,m]=(0,n.useState)(1),[j,H]=(0,n.useState)(""),[J,U]=(0,n.useState)("all"),[G,K]=(0,n.useState)(null),Q=(0,A.c)(j.trim(),350),{execute:V}=(0,C.J)(),{showLoading:Y}=(0,S.x)(),{socket:$}=(0,w.s)(),{isAuthorized:ee,isChecking:et}=(0,E.e)({allowedRoles:["Admin","Manager"]});(0,n.useEffect)(()=>{(0,P.P)()},[]),(0,n.useEffect)(()=>{l(1)},[Q]),(0,n.useEffect)(()=>{var e;if(Q||1!==a)return;let t=(0,T.t)(L,3e5);(null==t?void 0:null===(e=t.data)||void 0===e?void 0:e.length)&&(i(t.data),f(t.total),m(t.last_page))},[Q,a]);let ei=(0,n.useCallback)(async()=>{V(async()=>{let e=new URLSearchParams;e.set("page",a.toString()),e.set("limit","50"),Q&&e.set("q",Q);let t=await z.E.getAll(void 0,e);i(t.data||[]),f(t.total||0),m(t.last_page||1),Q||1!==a||(0,T.v)(L,t)},"กำลังโหลดข้อมูลวิธีการชำระเงิน...")},[Q,V,a]);(0,n.useEffect)(()=>{ee&&ei()},[ee,ei]),(0,M.D)({socket:$,events:[R.b.paymentMethods.create,R.b.paymentMethods.update,R.b.paymentMethods.delete],onRefresh:()=>ei(),intervalMs:2e4,debounceMs:800});let es=(0,n.useMemo)(()=>"all"===J?t:"active"===J?t.filter(e=>e.is_active):t.filter(e=>!e.is_active),[t,J]),en=()=>{Y("กำลังเปิดหน้าจัดการวิธีการชำระเงิน..."),e.push("/pos/paymentMethod/manager/add")},ea=t=>{Y("กำลังเปิดหน้าแก้ไขวิธีการชำระเงิน..."),e.push("/pos/paymentMethod/manager/edit/".concat(t.id))},el=e=>{d.Z.confirm({title:"ยืนยันการลบวิธีการชำระเงิน",content:'คุณต้องการลบวิธีการชำระเงิน "'.concat(e.display_name,'" หรือไม่?'),okText:"ลบ",okType:"danger",cancelText:"ยกเลิก",centered:!0,icon:(0,s.jsx)(v.Z,{style:{color:"#ff4d4f"}}),onOk:async()=>{await V(async()=>{let t=await (0,P.P)();if(!(await fetch("/api/pos/paymentMethod/delete/".concat(e.id),{method:"DELETE",headers:{"X-CSRF-Token":t}})).ok)throw Error("ไม่สามารถลบวิธีการชำระเงินได้");i(t=>t.filter(t=>t.id!==e.id)),f(e=>Math.max(e-1,0)),c.ZP.success('ลบวิธีการชำระเงิน "'.concat(e.display_name,'" สำเร็จ'))},"กำลังลบวิธีการชำระเงิน...")}})},eo=async(e,t)=>{K(e.id);try{let s=await (0,P.P)(),n=await fetch("/api/pos/paymentMethod/update/".concat(e.id),{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-Token":s},body:JSON.stringify({is_active:t})});if(!n.ok){let e=await n.json().catch(()=>({}));throw Error(e.error||e.message||"ไม่สามารถเปลี่ยนสถานะวิธีการชำระเงินได้")}let a=await n.json();i(t=>t.map(t=>t.id===e.id?a:t)),c.ZP.success(t?"เปิดใช้งานวิธีชำระเงินแล้ว":"ปิดใช้งานวิธีชำระเงินแล้ว")}catch(e){console.error(e),c.ZP.error(e instanceof Error?e.message:"ไม่สามารถเปลี่ยนสถานะวิธีการชำระเงินได้")}finally{K(null)}};if(et)return(0,s.jsx)(I.H,{message:"กำลังตรวจสอบสิทธิ์การใช้งาน..."});if(!ee)return(0,s.jsx)(I.H,{message:"คุณไม่มีสิทธิ์เข้าถึงหน้านี้ กำลังพากลับ...",tone:"danger"});let er=t.filter(e=>e.is_active).length,ed=t.filter(e=>!e.is_active).length;return(0,s.jsxs)("div",{className:"payment-method-page",style:N.R.container,children:[(0,s.jsx)("style",{children:N.W}),(0,s.jsx)(O.Z,{title:"วิธีการชำระเงิน",subtitle:"ทั้งหมด ".concat(o," รายการ"),icon:(0,s.jsx)(g.Z,{}),actions:(0,s.jsxs)(h.Z,{size:8,wrap:!0,children:[(0,s.jsx)(r.ZP,{icon:(0,s.jsx)(b.Z,{}),onClick:ei}),(0,s.jsx)(r.ZP,{type:"primary",icon:(0,s.jsx)(Z.Z,{}),onClick:en,children:"เพิ่มวิธีชำระเงิน"})]})}),(0,s.jsx)(W.Z,{children:(0,s.jsxs)(F.Z,{children:[(0,s.jsx)(q,{total:t.length,active:er,inactive:ed}),(0,s.jsx)(D.Z,{title:"ค้นหาและตัวกรอง",children:(0,s.jsxs)("div",{style:{display:"grid",gap:10,gridTemplateColumns:"1fr"},children:[(0,s.jsx)(p.default,{allowClear:!0,placeholder:"ค้นหาวิธีการชำระเงิน...",prefix:(0,s.jsx)(_.Z,{style:{color:"#94A3B8"}}),value:j,onChange:e=>H(e.target.value)}),(0,s.jsx)(u.Z,{options:[{label:"ทั้งหมด",value:"all"},{label:"ใช้งาน",value:"active"},{label:"ปิดใช้งาน",value:"inactive"}],value:J,onChange:e=>U(e)})]})}),(0,s.jsx)(D.Z,{title:"รายการวิธีการชำระเงิน",extra:(0,s.jsx)("span",{style:{fontWeight:600},children:es.length}),children:es.length>0?(0,s.jsxs)(s.Fragment,{children:[es.map(e=>(0,s.jsx)(X,{paymentMethod:e,onEdit:ea,onDelete:el,onToggleActive:eo,updatingStatusId:G},e.id)),x>1?(0,s.jsx)("div",{style:{marginTop:16,display:"flex",justifyContent:"center"},children:(0,s.jsx)(y.Z,{current:a,total:o,pageSize:50,onChange:e=>l(e),showSizeChanger:!1})}):null]}):(0,s.jsx)(B.Z,{title:j.trim()?"ไม่พบรายการที่ค้นหา":"ยังไม่มีวิธีการชำระเงิน",description:j.trim()?"ลองเปลี่ยนคำค้น หรือตัวกรองสถานะ":"เพิ่มวิธีการชำระเงินแรกเพื่อเริ่มใช้งาน",action:j.trim()?null:(0,s.jsx)(r.ZP,{type:"primary",icon:(0,s.jsx)(Z.Z,{}),onClick:en,children:"เพิ่มวิธีชำระเงิน"})})})]})})]})}}},function(e){e.O(0,[8024,4736,8592,1744],function(){return e(e.s=67601)}),_N_E=e.O()}]);