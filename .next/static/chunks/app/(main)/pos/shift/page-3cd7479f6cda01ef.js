(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7322],{25116:function(e,n,i){Promise.resolve().then(i.bind(i,94004))},94004:function(e,n,i){"use strict";i.r(n),i.d(n,{default:function(){return W}});var t=i(57437),a=i(2265),r=i(29827),l=i(11713),o=i(60283),s=i(48651),d=i(24783),c=i(50742),u=i(96931),p=i(80009),x=i(5540),h=i(89245),m=i(84588),f=i(28595),g=i(8881),y=i(29332),b=i(52539),j=i(20955),v=i(95159),Z=i(99376),k=i(71096),_=i.n(k),w=i(13257),C=i.n(w);i(6729);var S=i(24675),R=i(14362),z=i(67918),L=i(59226),I=i(12028),M=i(2938),Y=i(54343),B=i(15718),H=i(25193),T=i(37410),D=i(27623),q=i(20148),F=i(2786);let A={container:{paddingBottom:100,backgroundColor:i(44225).X1.background,minHeight:"100vh",fontFamily:"var(--font-sans), 'Sarabun', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif"},header:{background:"linear-gradient(135deg, #10B981 0%, #059669 100%)",padding:"16px 16px 48px 16px",position:"relative",overflow:"hidden",borderBottomLeftRadius:20,borderBottomRightRadius:20,boxShadow:"0 4px 16px rgba(16, 185, 129, 0.2)"},headerDecoCircle1:{position:"absolute",top:-50,right:-50,width:150,height:150,borderRadius:"50%",background:"rgba(255,255,255,0.1)"},headerDecoCircle2:{position:"absolute",bottom:-30,left:-30,width:100,height:100,borderRadius:"50%",background:"rgba(255,255,255,0.08)"},headerContent:{position:"relative",zIndex:1,display:"flex",alignItems:"center",justifyContent:"space-between",maxWidth:1200,margin:"0 auto"},headerLeft:{display:"flex",alignItems:"center",gap:16},headerIconBox:{width:56,height:56,borderRadius:16,background:"rgba(255,255,255,0.2)",display:"flex",alignItems:"center",justifyContent:"center",backdropFilter:"blur(8px)",boxShadow:"0 4px 12px rgba(0,0,0,0.1)"},headerTitleBox:{display:"flex",flexDirection:"column"},headerTitle:{color:"white",fontSize:24,margin:0,fontWeight:700,letterSpacing:"0.5px",lineHeight:1.2},headerSubtitle:{color:"rgba(255,255,255,0.9)",fontSize:14,display:"block"},contentContainer:{maxWidth:1200,margin:"0 auto",padding:"0 24px",position:"relative",zIndex:10},card:{borderRadius:24,border:"none",boxShadow:"0 10px 25px rgba(0,0,0,0.05)",background:"white",overflow:"hidden",height:"100%"},activeShiftCard:{background:"linear-gradient(135deg, #10b981 0%, #059669 100%)",color:"white",textAlign:"center",padding:"40px 24px",position:"relative",overflow:"hidden"},summaryCard:{background:"white",padding:"24px"},statisticValue:e=>({color:e,fontWeight:600}),noShiftCard:{textAlign:"center",padding:"60px 20px",background:"rgba(255,255,255,0.8)",backdropFilter:"blur(10px)",borderRadius:24,border:"1px dashed #d9d9d9"},sectionDivider:{margin:"24px 0"},trendUp:{color:"#52c41a"},trendDown:{color:"#ff4d4f"}},P="\n    @keyframes pulse {\n        0% { transform: scale(1); }\n        50% { transform: scale(1.05); }\n        100% { transform: scale(1); }\n    }\n\n    @keyframes fadeInUp {\n        from {\n            opacity: 0;\n            transform: translateY(20px);\n        }\n        to {\n            opacity: 1;\n            transform: translateY(0);\n        }\n    }\n    \n    .pulse-animation {\n        animation: pulse 2s infinite ease-in-out;\n    }\n\n    .shift-card-animate {\n        animation: fadeInUp 0.5s ease forwards;\n        opacity: 0;\n    }\n\n    .shift-card-delay-1 { animation-delay: 0.1s; }\n    .shift-card-delay-2 { animation-delay: 0.2s; }\n    \n    .shift-modal .ant-modal-content {\n        border-radius: 20px;\n        overflow: hidden;\n    }\n    \n    .shift-modal .ant-modal-header {\n        background: transparent;\n    }\n\n    .stat-card-inner {\n        transition: all 0.3s ease;\n        padding: 16px;\n        border-radius: 16px;\n        background: #f8fafc;\n    }\n    \n    .stat-card-inner:hover {\n        background: #f1f5f9;\n        transform: translateY(-2px);\n    }\n\n    /* Mobile-first responsive */\n    .shift-header-mobile {\n        flex-direction: column !important;\n        align-items: flex-start !important;\n        gap: 16px !important;\n    }\n\n    .shift-content-mobile {\n        padding: 0 16px !important;\n    }\n\n    .shift-stat-grid {\n        display: grid;\n        grid-template-columns: repeat(2, 1fr);\n        gap: 12px;\n    }\n\n    @media (max-width: 576px) {\n        .shift-header-mobile {\n            padding: 16px 16px 40px !important;\n        }\n\n        .shift-stat-grid {\n            grid-template-columns: 1fr;\n        }\n\n        .shift-action-btn {\n            width: 100% !important;\n            height: 52px !important;\n            font-size: 16px !important;\n        }\n\n        .shift-modal .ant-modal {\n            max-width: calc(100vw - 32px) !important;\n            margin: 16px !important;\n        }\n    }\n\n    @media (min-width: 768px) {\n        .shift-stat-grid {\n            grid-template-columns: repeat(3, 1fr);\n        }\n    }\n\n    @media (min-width: 1024px) {\n        .shift-stat-grid {\n            grid-template-columns: repeat(4, 1fr);\n        }\n    }\n\n    /* Touch-friendly */\n    .shift-action-btn {\n        -webkit-tap-highlight-color: rgba(16, 185, 129, 0.1);\n        touch-action: manipulation;\n    }\n";_().extend(C()),_().locale("th");let{Title:E,Text:N}=o.default,O=e=>Number(e||0);function W(){var e,n,i,o,k,w,C,W,Q,V,X,G,J,$;let ee=(0,Z.useRouter)(),en=(0,r.NL)(),{user:ei}=(0,R.a)(),{socket:et}=(0,S.s)(),{isAuthorized:ea,isChecking:er}=(0,z.e)({allowedRoles:["Admin","Manager","Employee"]}),[el,eo]=(0,a.useState)(!1),[es,ed]=(0,a.useState)(!1),{data:ec=null,isLoading:eu,refetch:ep}=(0,l.a)({queryKey:["shiftCurrent"],queryFn:async()=>L.t.getCurrentShift(),staleTime:2e3}),{data:ex,isLoading:eh,refetch:em}=(0,l.a)({queryKey:["shiftSummary",(null==ec?void 0:ec.id)||"none"],queryFn:async()=>await L.t.getCurrentSummary(),enabled:!!ec,staleTime:2e3}),ef=eu||!!ec&&eh,eg=!!ec&&!!ei&&("Admin"===ei.role||"Manager"===ei.role||ec.opened_by_user_id===ei.id||!ec.opened_by_user_id&&ec.user_id===ei.id);(0,a.useEffect)(()=>{if(!et)return;let e=()=>{en.invalidateQueries({queryKey:["shiftCurrent"]}),en.invalidateQueries({queryKey:["shiftSummary"]})};return et.on(I.b.shifts.update,e),()=>{et.off(I.b.shifts.update,e)}},[et,en]);let ey=async()=>{await ep(),ec&&await em()},eb=(0,a.useMemo)(()=>{if(!ec)return"-";let e=_().duration(_()().diff(_()(ec.open_time))),n=Math.floor(e.asHours()),i=e.minutes();return"".concat(n," ชม. ").concat(i," นาที")},[ec]),ej=ec?ex:null,ev=O(null==ej?void 0:null===(e=ej.summary)||void 0===e?void 0:e.total_sales),eZ=O(null==ej?void 0:null===(n=ej.summary)||void 0===n?void 0:n.net_profit),ek=O(null!==(X=null==ej?void 0:null===(i=ej.shift_info)||void 0===i?void 0:i.start_amount)&&void 0!==X?X:null==ec?void 0:ec.start_amount),e_=O(null!==(G=null==ej?void 0:null===(o=ej.shift_info)||void 0===o?void 0:o.end_amount)&&void 0!==G?G:null==ec?void 0:ec.end_amount),ew=O(null!==(J=null==ej?void 0:null===(k=ej.shift_info)||void 0===k?void 0:k.expected_amount)&&void 0!==J?J:null==ec?void 0:ec.expected_amount),eC=O(null!==($=null==ej?void 0:null===(w=ej.shift_info)||void 0===w?void 0:w.diff_amount)&&void 0!==$?$:null==ec?void 0:ec.diff_amount),eS=(null==ej?void 0:null===(C=ej.summary)||void 0===C?void 0:C.payment_methods)||{},eR=Object.entries(eS).reduce((e,n)=>{let[i,t]=n;return i.toLowerCase().includes("cash")||i.includes("เงินสด")?e+O(t):e},0);return er?(0,t.jsx)(M.H,{message:"กำลังตรวจสอบสิทธิ์การใช้งาน..."}):ea?ef?(0,t.jsxs)("div",{style:A.container,children:[(0,t.jsx)("style",{children:P}),(0,t.jsx)(q.Z,{title:"กะการทำงาน",subtitle:"กำลังโหลดข้อมูล...",icon:(0,t.jsx)(x.Z,{}),onBack:()=>ee.back()}),(0,t.jsx)(H.Z,{children:(0,t.jsx)(T.Z,{children:(0,t.jsx)("div",{style:{display:"flex",justifyContent:"center",padding:"64px 0"},children:(0,t.jsx)(s.Z,{size:"large"})})})})]}):(0,t.jsxs)("div",{style:A.container,children:[(0,t.jsx)("style",{children:P}),(0,t.jsx)(q.Z,{title:"กะการทำงาน",subtitle:ec?"เปิดกะเมื่อ ".concat(_()(ec.open_time).format("DD/MM/YYYY HH:mm")," น."):"ยังไม่เปิดกะ",icon:(0,t.jsx)(x.Z,{}),onBack:()=>ee.back(),actions:(0,t.jsxs)(d.Z,{size:8,children:[(0,t.jsx)(c.ZP,{icon:(0,t.jsx)(h.Z,{}),onClick:ey}),(0,t.jsx)(c.ZP,{icon:(0,t.jsx)(m.Z,{}),onClick:()=>ee.push("/pos/shiftHistory"),children:"ประวัติกะ"}),ec?eg?(0,t.jsx)(c.ZP,{danger:!0,icon:(0,t.jsx)(g.Z,{}),onClick:()=>ed(!0),children:"ปิดกะ"}):null:(0,t.jsx)(c.ZP,{type:"primary",icon:(0,t.jsx)(f.Z,{}),onClick:()=>eo(!0),children:"เปิดกะ"})]})}),(0,t.jsx)(H.Z,{children:(0,t.jsx)(D.Z,{children:ec?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(T.Z,{title:"สถานะกะปัจจุบัน",children:[(0,t.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:12},children:[(0,t.jsxs)(u.Z,{size:"small",style:{borderRadius:14},children:[(0,t.jsx)(N,{type:"secondary",children:"สถานะ"}),(0,t.jsx)("div",{style:{marginTop:6},children:(0,t.jsx)(p.Z,{color:"success",style:{borderRadius:6},children:"เปิดกะอยู่"})})]}),(0,t.jsxs)(u.Z,{size:"small",style:{borderRadius:14},children:[(0,t.jsx)(N,{type:"secondary",children:"ระยะเวลากะ"}),(0,t.jsx)(E,{level:5,style:{margin:"6px 0 0"},children:eb})]}),(0,t.jsxs)(u.Z,{size:"small",style:{borderRadius:14},children:[(0,t.jsx)(N,{type:"secondary",children:"ผู้เปิดกะ"}),(0,t.jsx)(E,{level:5,style:{margin:"6px 0 0"},children:(null===(W=ec.user)||void 0===W?void 0:W.display_name)||(null===(Q=ec.user)||void 0===Q?void 0:Q.username)||"-"})]}),(0,t.jsxs)(u.Z,{size:"small",style:{borderRadius:14},children:[(0,t.jsx)(N,{type:"secondary",children:"เวลาเปิดกะ"}),(0,t.jsxs)(E,{level:5,style:{margin:"6px 0 0"},children:[_()(ec.open_time).format("DD/MM/YYYY HH:mm")," น."]})]})]}),eg?null:(0,t.jsx)(U,{text:"คุณไม่มีสิทธิ์ปิดกะนี้ (เฉพาะ Admin/Manager หรือผู้เปิดกะ)"})]}),(0,t.jsx)(T.Z,{title:"สรุปยอดกะปัจจุบัน",children:ej?(0,t.jsxs)("div",{style:{display:"grid",gap:12,gridTemplateColumns:"repeat(auto-fit, minmax(220px, 1fr))"},children:[(0,t.jsx)(K,{icon:(0,t.jsx)(y.Z,{}),label:"ยอดขายรวม",value:"฿".concat(ev.toLocaleString()),color:"#10b981"}),(0,t.jsx)(K,{icon:(0,t.jsx)(b.Z,{}),label:"กำไรสุทธิ",value:"฿".concat(eZ.toLocaleString()),color:"#0ea5e9"}),(0,t.jsx)(K,{icon:(0,t.jsx)(j.Z,{}),label:"เงินทอนเริ่มต้น",value:"฿".concat(ek.toLocaleString()),color:"#f59e0b"}),(0,t.jsx)(K,{icon:(0,t.jsx)(v.Z,{}),label:"เงินสดในลิ้นชัก",value:"฿".concat((ek+eR).toLocaleString()),color:"#7c3aed"}),(0,t.jsx)(K,{icon:(0,t.jsx)(v.Z,{}),label:"ยอดคาดหวังปิดกะ",value:"฿".concat(ew.toLocaleString()),color:"#334155"}),(0,t.jsx)(K,{icon:(0,t.jsx)(v.Z,{}),label:"ผลต่างปิดกะ",value:"฿".concat(eC.toLocaleString()),color:eC>=0?"#059669":"#dc2626"}),(0,t.jsx)(K,{icon:(0,t.jsx)(j.Z,{}),label:"ยอดนับจริงล่าสุด",value:e_>0?"฿".concat(e_.toLocaleString()):"-",color:"#64748b"})]}):(0,t.jsx)("div",{style:{padding:"24px 0",textAlign:"center"},children:(0,t.jsx)(s.Z,{})})}),(0,t.jsx)(T.Z,{title:"รายละเอียดวิธีชำระเงิน",children:Object.keys(eS).length>0?(0,t.jsx)("div",{style:{display:"grid",gap:10,gridTemplateColumns:"repeat(auto-fit, minmax(180px, 1fr))"},children:Object.entries(eS).map(e=>{let[n,i]=e;return(0,t.jsxs)(u.Z,{size:"small",style:{borderRadius:12},children:[(0,t.jsx)(N,{type:"secondary",children:n}),(0,t.jsxs)(E,{level:5,style:{margin:"6px 0 0"},children:["฿",O(i).toLocaleString()]})]},n)})}):(0,t.jsx)(N,{type:"secondary",children:"ยังไม่มีข้อมูลวิธีชำระเงินในกะนี้"})}),(0,t.jsx)(T.Z,{title:"สินค้าขายดี",children:(null==ej?void 0:null===(V=ej.top_products)||void 0===V?void 0:V.length)?(0,t.jsx)("div",{style:{display:"grid",gap:10},children:ej.top_products.slice(0,5).map((e,n)=>(0,t.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",border:"1px solid #e2e8f0",borderRadius:12,padding:"10px 12px"},children:[(0,t.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:10},children:[(0,t.jsx)("div",{style:{width:26,height:26,borderRadius:"50%",background:"#f1f5f9",display:"flex",alignItems:"center",justifyContent:"center",fontSize:12,fontWeight:700,color:"#475569"},children:n+1}),(0,t.jsxs)("div",{children:[(0,t.jsx)(N,{strong:!0,children:e.name}),(0,t.jsxs)(N,{type:"secondary",style:{display:"block",fontSize:12},children:["จำนวน ",e.quantity," ",e.unit||"หน่วย"]})]})]}),(0,t.jsxs)(N,{strong:!0,children:["฿",O(e.revenue).toLocaleString()]})]},"".concat(e.id,"-").concat(n)))}):(0,t.jsx)(N,{type:"secondary",children:"ยังไม่มีข้อมูลสินค้าขายดีในกะนี้"})})]}):(0,t.jsx)(T.Z,{children:(0,t.jsx)(F.Z,{title:"ยังไม่มีกะที่เปิดใช้งาน",description:"กรุณาเปิดกะเพื่อเริ่มต้นการขายและบันทึกสรุปรายวัน",action:(0,t.jsx)(c.ZP,{type:"primary",icon:(0,t.jsx)(f.Z,{}),onClick:()=>eo(!0),children:"เปิดกะการทำงาน"})})})})}),(0,t.jsx)(Y.Z,{open:el,onCancel:()=>eo(!1)}),(0,t.jsx)(B.Z,{open:es,onCancel:()=>ed(!1),onSuccess:()=>ed(!1)})]}):(0,t.jsx)(M.H,{message:"คุณไม่มีสิทธิ์เข้าถึงหน้านี้",tone:"danger"})}function K(e){let{icon:n,label:i,value:a,color:r}=e;return(0,t.jsxs)(u.Z,{size:"small",style:{borderRadius:14},children:[(0,t.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:6,color:r},children:[n,(0,t.jsx)(N,{type:"secondary",children:i})]}),(0,t.jsx)(E,{level:4,style:{margin:0,color:r},children:a})]})}function U(e){let{text:n}=e;return(0,t.jsx)("div",{style:{marginTop:12,borderRadius:10,border:"1px solid #fecaca",background:"#fef2f2",padding:"10px 12px"},children:(0,t.jsx)(N,{style:{color:"#b91c1c"},children:n})})}}},function(e){e.O(0,[8024,4736,8592,1744],function(){return e(e.s=25116)}),_N_E=e.O()}]);