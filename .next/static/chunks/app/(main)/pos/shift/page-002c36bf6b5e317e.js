(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7322],{25116:function(e,t,n){Promise.resolve().then(n.bind(n,94004))},94004:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return W}});var r=n(57437),i=n(2265),a=n(29827),o=n(11713),s=n(39486),d=n(48651),l=n(24783),c=n(50742),u=n(96931),p=n(80009),x=n(5540),f=n(89245),m=n(84588),h=n(28595),g=n(8881),b=n(29332),y=n(52539),k=n(20955),v=n(95159),j=n(99376),w=n(71096),F=n.n(w),S=n(13257),C=n.n(S);n(6729);var Z=n(24675),B=n(14362),z=n(67918),E=n(59226),_=n(12028),D=n(2938),R=n(54343),T=n(15718),I=n(25193),P=n(37410),L=n(27623),N=n(20148),H=n(2786);let A={container:{paddingBottom:100,backgroundColor:n(44225).X1.background,minHeight:"100vh",fontFamily:"var(--font-sans), 'Sarabun', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif"},header:{background:"linear-gradient(135deg, #10B981 0%, #059669 100%)",padding:"16px 16px 48px 16px",position:"relative",overflow:"hidden",borderBottomLeftRadius:20,borderBottomRightRadius:20,boxShadow:"0 4px 16px rgba(16, 185, 129, 0.2)"},headerDecoCircle1:{position:"absolute",top:-50,right:-50,width:150,height:150,borderRadius:"50%",background:"rgba(255,255,255,0.1)"},headerDecoCircle2:{position:"absolute",bottom:-30,left:-30,width:100,height:100,borderRadius:"50%",background:"rgba(255,255,255,0.08)"},headerContent:{position:"relative",zIndex:1,display:"flex",alignItems:"center",justifyContent:"space-between",maxWidth:1200,margin:"0 auto"},headerLeft:{display:"flex",alignItems:"center",gap:16},headerIconBox:{width:56,height:56,borderRadius:16,background:"rgba(255,255,255,0.2)",display:"flex",alignItems:"center",justifyContent:"center",backdropFilter:"blur(8px)",boxShadow:"0 4px 12px rgba(0,0,0,0.1)"},headerTitleBox:{display:"flex",flexDirection:"column"},headerTitle:{color:"white",fontSize:24,margin:0,fontWeight:700,letterSpacing:"0.5px",lineHeight:1.2},headerSubtitle:{color:"rgba(255,255,255,0.9)",fontSize:14,display:"block"},contentContainer:{maxWidth:1200,margin:"0 auto",padding:"0 24px",position:"relative",zIndex:10},card:{borderRadius:24,border:"none",boxShadow:"0 10px 25px rgba(0,0,0,0.05)",background:"white",overflow:"hidden",height:"100%"},activeShiftCard:{background:"linear-gradient(135deg, #10b981 0%, #059669 100%)",color:"white",textAlign:"center",padding:"40px 24px",position:"relative",overflow:"hidden"},summaryCard:{background:"white",padding:"24px"},statisticValue:e=>({color:e,fontWeight:600}),noShiftCard:{textAlign:"center",padding:"60px 20px",background:"rgba(255,255,255,0.8)",backdropFilter:"blur(10px)",borderRadius:24,border:"1px dashed #d9d9d9"},sectionDivider:{margin:"24px 0"},trendUp:{color:"#52c41a"},trendDown:{color:"#ff4d4f"}},M="\n    @keyframes pulse {\n        0% { transform: scale(1); }\n        50% { transform: scale(1.05); }\n        100% { transform: scale(1); }\n    }\n\n    @keyframes fadeInUp {\n        from {\n            opacity: 0;\n            transform: translateY(20px);\n        }\n        to {\n            opacity: 1;\n            transform: translateY(0);\n        }\n    }\n    \n    .pulse-animation {\n        animation: pulse 2s infinite ease-in-out;\n    }\n\n    .shift-card-animate {\n        animation: fadeInUp 0.5s ease forwards;\n        opacity: 0;\n    }\n\n    .shift-card-delay-1 { animation-delay: 0.1s; }\n    .shift-card-delay-2 { animation-delay: 0.2s; }\n    \n    .shift-modal .ant-modal-content {\n        border-radius: 20px;\n        overflow: hidden;\n    }\n    \n    .shift-modal .ant-modal-header {\n        background: transparent;\n    }\n\n    .stat-card-inner {\n        transition: all 0.3s ease;\n        padding: 16px;\n        border-radius: 16px;\n        background: #f8fafc;\n    }\n    \n    .stat-card-inner:hover {\n        background: #f1f5f9;\n        transform: translateY(-2px);\n    }\n\n    /* Mobile-first responsive */\n    .shift-header-mobile {\n        flex-direction: column !important;\n        align-items: flex-start !important;\n        gap: 16px !important;\n    }\n\n    .shift-content-mobile {\n        padding: 0 16px !important;\n    }\n\n    .shift-stat-grid {\n        display: grid;\n        grid-template-columns: repeat(2, 1fr);\n        gap: 12px;\n    }\n\n    @media (max-width: 576px) {\n        .shift-header-mobile {\n            padding: 16px 16px 40px !important;\n        }\n\n        .shift-stat-grid {\n            grid-template-columns: 1fr;\n        }\n\n        .shift-action-btn {\n            width: 100% !important;\n            height: 52px !important;\n            font-size: 16px !important;\n        }\n\n        .shift-modal .ant-modal {\n            max-width: calc(100vw - 32px) !important;\n            margin: 16px !important;\n        }\n    }\n\n    @media (min-width: 768px) {\n        .shift-stat-grid {\n            grid-template-columns: repeat(3, 1fr);\n        }\n    }\n\n    @media (min-width: 1024px) {\n        .shift-stat-grid {\n            grid-template-columns: repeat(4, 1fr);\n        }\n    }\n\n    /* Touch-friendly */\n    .shift-action-btn {\n        -webkit-tap-highlight-color: rgba(16, 185, 129, 0.1);\n        touch-action: manipulation;\n    }\n";F().extend(C()),F().locale("th");let{Title:O,Text:U}=s.default,q=e=>Number(e||0);function W(){var e,t,n,s,w,S,C,W,G,J,X,Q,V,$;let ee=(0,j.useRouter)(),et=(0,a.NL)(),{user:en}=(0,B.a)(),{socket:er}=(0,Z.s)(),{isAuthorized:ei,isChecking:ea}=(0,z.e)({allowedRoles:["Admin","Manager","Employee"]}),[eo,es]=(0,i.useState)(!1),[ed,el]=(0,i.useState)(!1),{data:ec=null,isLoading:eu,refetch:ep}=(0,o.a)({queryKey:["shiftCurrent"],queryFn:async()=>E.t.getCurrentShift(),staleTime:2e3}),{data:ex,isLoading:ef,refetch:em}=(0,o.a)({queryKey:["shiftSummary",(null==ec?void 0:ec.id)||"none"],queryFn:async()=>await E.t.getCurrentSummary(),enabled:!!ec,staleTime:2e3}),eh=eu||!!ec&&ef,eg=!!ec&&!!en&&("Admin"===en.role||"Manager"===en.role||ec.opened_by_user_id===en.id||!ec.opened_by_user_id&&ec.user_id===en.id);(0,i.useEffect)(()=>{if(!er)return;let e=()=>{et.invalidateQueries({queryKey:["shiftCurrent"]}),et.invalidateQueries({queryKey:["shiftSummary"]})};return er.on(_.b.shifts.update,e),()=>{er.off(_.b.shifts.update,e)}},[er,et]);let eb=async()=>{await ep(),ec&&await em()},ey=(0,i.useMemo)(()=>{if(!ec)return"-";let e=F().duration(F()().diff(F()(ec.open_time))),t=Math.floor(e.asHours()),n=e.minutes();return"".concat(t," ชม. ").concat(n," นาที")},[ec]),ek=ec?ex:null,ev=q(null==ek?void 0:null===(e=ek.summary)||void 0===e?void 0:e.total_sales),ej=q(null==ek?void 0:null===(t=ek.summary)||void 0===t?void 0:t.net_profit),ew=q(null!==(X=null==ek?void 0:null===(n=ek.shift_info)||void 0===n?void 0:n.start_amount)&&void 0!==X?X:null==ec?void 0:ec.start_amount),eF=q(null!==(Q=null==ek?void 0:null===(s=ek.shift_info)||void 0===s?void 0:s.end_amount)&&void 0!==Q?Q:null==ec?void 0:ec.end_amount),eS=q(null!==(V=null==ek?void 0:null===(w=ek.shift_info)||void 0===w?void 0:w.expected_amount)&&void 0!==V?V:null==ec?void 0:ec.expected_amount),eC=q(null!==($=null==ek?void 0:null===(S=ek.shift_info)||void 0===S?void 0:S.diff_amount)&&void 0!==$?$:null==ec?void 0:ec.diff_amount),eZ=(null==ek?void 0:null===(C=ek.summary)||void 0===C?void 0:C.payment_methods)||{},eB=Object.entries(eZ).reduce((e,t)=>{let[n,r]=t;return n.toLowerCase().includes("cash")||n.includes("เงินสด")?e+q(r):e},0);return ea?(0,r.jsx)(D.H,{message:"กำลังตรวจสอบสิทธิ์การใช้งาน..."}):ei?eh?(0,r.jsxs)("div",{style:A.container,children:[(0,r.jsx)("style",{children:M}),(0,r.jsx)(N.Z,{title:"กะการทำงาน",subtitle:"กำลังโหลดข้อมูล...",icon:(0,r.jsx)(x.Z,{}),onBack:()=>ee.back()}),(0,r.jsx)(I.Z,{children:(0,r.jsx)(P.Z,{children:(0,r.jsx)("div",{style:{display:"flex",justifyContent:"center",padding:"64px 0"},children:(0,r.jsx)(d.Z,{size:"large"})})})})]}):(0,r.jsxs)("div",{style:A.container,children:[(0,r.jsx)("style",{children:M}),(0,r.jsx)(N.Z,{title:"กะการทำงาน",subtitle:ec?"เปิดกะเมื่อ ".concat(F()(ec.open_time).format("DD/MM/YYYY HH:mm")," น."):"ยังไม่เปิดกะ",icon:(0,r.jsx)(x.Z,{}),onBack:()=>ee.back(),actions:(0,r.jsxs)(l.Z,{size:8,children:[(0,r.jsx)(c.ZP,{icon:(0,r.jsx)(f.Z,{}),onClick:eb}),(0,r.jsx)(c.ZP,{icon:(0,r.jsx)(m.Z,{}),onClick:()=>ee.push("/pos/shiftHistory"),children:"ประวัติกะ"}),ec?eg?(0,r.jsx)(c.ZP,{danger:!0,icon:(0,r.jsx)(g.Z,{}),onClick:()=>el(!0),children:"ปิดกะ"}):null:(0,r.jsx)(c.ZP,{type:"primary",icon:(0,r.jsx)(h.Z,{}),onClick:()=>es(!0),children:"เปิดกะ"})]})}),(0,r.jsx)(I.Z,{children:(0,r.jsx)(L.Z,{children:ec?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(P.Z,{title:"สถานะกะปัจจุบัน",children:[(0,r.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:12},children:[(0,r.jsxs)(u.Z,{size:"small",style:{borderRadius:14},children:[(0,r.jsx)(U,{type:"secondary",children:"สถานะ"}),(0,r.jsx)("div",{style:{marginTop:6},children:(0,r.jsx)(p.Z,{color:"success",style:{borderRadius:6},children:"เปิดกะอยู่"})})]}),(0,r.jsxs)(u.Z,{size:"small",style:{borderRadius:14},children:[(0,r.jsx)(U,{type:"secondary",children:"ระยะเวลากะ"}),(0,r.jsx)(O,{level:5,style:{margin:"6px 0 0"},children:ey})]}),(0,r.jsxs)(u.Z,{size:"small",style:{borderRadius:14},children:[(0,r.jsx)(U,{type:"secondary",children:"ผู้เปิดกะ"}),(0,r.jsx)(O,{level:5,style:{margin:"6px 0 0"},children:(null===(W=ec.user)||void 0===W?void 0:W.display_name)||(null===(G=ec.user)||void 0===G?void 0:G.username)||"-"})]}),(0,r.jsxs)(u.Z,{size:"small",style:{borderRadius:14},children:[(0,r.jsx)(U,{type:"secondary",children:"เวลาเปิดกะ"}),(0,r.jsxs)(O,{level:5,style:{margin:"6px 0 0"},children:[F()(ec.open_time).format("DD/MM/YYYY HH:mm")," น."]})]})]}),eg?null:(0,r.jsx)(K,{text:"คุณไม่มีสิทธิ์ปิดกะนี้ (เฉพาะ Admin/Manager หรือผู้เปิดกะ)"})]}),(0,r.jsx)(P.Z,{title:"สรุปยอดกะปัจจุบัน",children:ek?(0,r.jsxs)("div",{style:{display:"grid",gap:12,gridTemplateColumns:"repeat(auto-fit, minmax(220px, 1fr))"},children:[(0,r.jsx)(Y,{icon:(0,r.jsx)(b.Z,{}),label:"ยอดขายรวม",value:"฿".concat(ev.toLocaleString()),color:"#10b981"}),(0,r.jsx)(Y,{icon:(0,r.jsx)(y.Z,{}),label:"กำไรสุทธิ",value:"฿".concat(ej.toLocaleString()),color:"#0ea5e9"}),(0,r.jsx)(Y,{icon:(0,r.jsx)(k.Z,{}),label:"เงินทอนเริ่มต้น",value:"฿".concat(ew.toLocaleString()),color:"#f59e0b"}),(0,r.jsx)(Y,{icon:(0,r.jsx)(v.Z,{}),label:"เงินสดในลิ้นชัก",value:"฿".concat((ew+eB).toLocaleString()),color:"#7c3aed"}),(0,r.jsx)(Y,{icon:(0,r.jsx)(v.Z,{}),label:"ยอดคาดหวังปิดกะ",value:"฿".concat(eS.toLocaleString()),color:"#334155"}),(0,r.jsx)(Y,{icon:(0,r.jsx)(v.Z,{}),label:"ผลต่างปิดกะ",value:"฿".concat(eC.toLocaleString()),color:eC>=0?"#059669":"#dc2626"}),(0,r.jsx)(Y,{icon:(0,r.jsx)(k.Z,{}),label:"ยอดนับจริงล่าสุด",value:eF>0?"฿".concat(eF.toLocaleString()):"-",color:"#64748b"})]}):(0,r.jsx)("div",{style:{padding:"24px 0",textAlign:"center"},children:(0,r.jsx)(d.Z,{})})}),(0,r.jsx)(P.Z,{title:"รายละเอียดวิธีชำระเงิน",children:Object.keys(eZ).length>0?(0,r.jsx)("div",{style:{display:"grid",gap:10,gridTemplateColumns:"repeat(auto-fit, minmax(180px, 1fr))"},children:Object.entries(eZ).map(e=>{let[t,n]=e;return(0,r.jsxs)(u.Z,{size:"small",style:{borderRadius:12},children:[(0,r.jsx)(U,{type:"secondary",children:t}),(0,r.jsxs)(O,{level:5,style:{margin:"6px 0 0"},children:["฿",q(n).toLocaleString()]})]},t)})}):(0,r.jsx)(U,{type:"secondary",children:"ยังไม่มีข้อมูลวิธีชำระเงินในกะนี้"})}),(0,r.jsx)(P.Z,{title:"สินค้าขายดี",children:(null==ek?void 0:null===(J=ek.top_products)||void 0===J?void 0:J.length)?(0,r.jsx)("div",{style:{display:"grid",gap:10},children:ek.top_products.slice(0,5).map((e,t)=>(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",border:"1px solid #e2e8f0",borderRadius:12,padding:"10px 12px"},children:[(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:10},children:[(0,r.jsx)("div",{style:{width:26,height:26,borderRadius:"50%",background:"#f1f5f9",display:"flex",alignItems:"center",justifyContent:"center",fontSize:12,fontWeight:700,color:"#475569"},children:t+1}),(0,r.jsxs)("div",{children:[(0,r.jsx)(U,{strong:!0,children:e.name}),(0,r.jsxs)(U,{type:"secondary",style:{display:"block",fontSize:12},children:["จำนวน ",e.quantity," ",e.unit||"หน่วย"]})]})]}),(0,r.jsxs)(U,{strong:!0,children:["฿",q(e.revenue).toLocaleString()]})]},"".concat(e.id,"-").concat(t)))}):(0,r.jsx)(U,{type:"secondary",children:"ยังไม่มีข้อมูลสินค้าขายดีในกะนี้"})})]}):(0,r.jsx)(P.Z,{children:(0,r.jsx)(H.Z,{title:"ยังไม่มีกะที่เปิดใช้งาน",description:"กรุณาเปิดกะเพื่อเริ่มต้นการขายและบันทึกสรุปรายวัน",action:(0,r.jsx)(c.ZP,{type:"primary",icon:(0,r.jsx)(h.Z,{}),onClick:()=>es(!0),children:"เปิดกะการทำงาน"})})})})}),(0,r.jsx)(R.Z,{open:eo,onCancel:()=>es(!1)}),(0,r.jsx)(T.Z,{open:ed,onCancel:()=>el(!1),onSuccess:()=>el(!1)})]}):(0,r.jsx)(D.H,{message:"คุณไม่มีสิทธิ์เข้าถึงหน้านี้",tone:"danger"})}function Y(e){let{icon:t,label:n,value:i,color:a}=e;return(0,r.jsxs)(u.Z,{size:"small",style:{borderRadius:14},children:[(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:6,color:a},children:[t,(0,r.jsx)(U,{type:"secondary",children:n})]}),(0,r.jsx)(O,{level:4,style:{margin:0,color:a},children:i})]})}function K(e){let{text:t}=e;return(0,r.jsx)("div",{style:{marginTop:12,borderRadius:10,border:"1px solid #fecaca",background:"#fef2f2",padding:"10px 12px"},children:(0,r.jsx)(U,{style:{color:"#b91c1c"},children:t})})}},15718:function(e,t,n){"use strict";n.d(t,{Z:function(){return b}});var r=n(57437),i=n(29),a=n.n(i),o=n(2265),s=n(39486),d=n(19878),l=n(53743),c=n(33477),u=n(50742),p=n(28006),x=n(62670),f=n(71096),m=n.n(f);let{Title:h,Text:g}=s.default;function b(e){let{open:t,onCancel:n,onSuccess:i}=e,{currentShift:s,closeShift:f}=(0,p.S)(),[b,y]=(0,o.useState)(!1),[k]=d.Z.useForm(),v=async e=>{y(!0);try{await f(e.endAmount),n(),k.resetFields(),i&&i()}catch(e){}finally{y(!1)}};return(0,r.jsxs)(l.Z,{open:t,onCancel:n,title:null,centered:!0,footer:null,width:480,className:"soft-modal",styles:{body:{padding:0,borderRadius:24,overflow:"hidden",boxShadow:"0 20px 50px rgba(0,0,0,0.1)"},mask:{backdropFilter:"blur(5px)"}},children:[(0,r.jsxs)("div",{className:"jsx-513b4b5890b57a8a modal-header-close",children:[(0,r.jsx)("div",{className:"jsx-513b4b5890b57a8a icon-wrapper-close",children:(0,r.jsx)(x.Z,{style:{fontSize:32,color:"#ef4444"}})}),(0,r.jsx)(h,{level:3,style:{margin:0,color:"#1f1f1f",fontWeight:700},children:"ปิดรอบการขาย"}),(0,r.jsx)(g,{type:"secondary",style:{fontSize:16},children:"Close Shift"})]}),(0,r.jsx)("div",{style:{padding:"0 32px 32px 32px"},className:"jsx-513b4b5890b57a8a",children:s&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"jsx-513b4b5890b57a8a info-card",children:[(0,r.jsxs)("div",{className:"jsx-513b4b5890b57a8a info-row",children:[(0,r.jsx)(g,{type:"secondary",children:"เวลาเปิดกะ"}),(0,r.jsx)(g,{strong:!0,children:m()(s.open_time).format("DD/MM/YYYY HH:mm")})]}),(0,r.jsx)("div",{className:"jsx-513b4b5890b57a8a info-divider"}),(0,r.jsxs)("div",{className:"jsx-513b4b5890b57a8a info-row",children:[(0,r.jsx)(g,{type:"secondary",children:"เงินทอนเริ่มต้น"}),(0,r.jsxs)(g,{strong:!0,children:[Number(s.start_amount).toLocaleString()," บาท"]})]})]}),(0,r.jsxs)(d.Z,{form:k,layout:"vertical",onFinish:v,children:[(0,r.jsx)(d.Z.Item,{name:"endAmount",label:(0,r.jsx)("span",{style:{fontSize:16,fontWeight:500,color:"#4b5563"},className:"jsx-513b4b5890b57a8a",children:"ยอดเงินสดที่นับได้ (Cash Counted)"}),rules:[{required:!0,message:"กรุณาระบุจำนวนเงิน"}],children:(0,r.jsx)(c.Z,{style:{width:"100%",height:"80px",borderRadius:16,border:"2px solid #e5e7eb"},size:"large",min:0,precision:2,placeholder:"0.00",autoFocus:!0,controls:!1,inputMode:"decimal",className:"huge-input-close",formatter:e=>"".concat(e).replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:e=>null==e?void 0:e.replace(/\$\s?|(,*)/g,""),onKeyDown:e=>{if([8,46,9,27,13,190,110].includes(e.keyCode)||!0===e.ctrlKey||!0===e.metaKey||e.keyCode>=35&&e.keyCode<=39){(190===e.keyCode||110===e.keyCode)&&e.currentTarget.value.includes(".")&&e.preventDefault();return}(e.shiftKey||e.keyCode<48||e.keyCode>57)&&(e.keyCode<96||e.keyCode>105)&&e.preventDefault()}})}),(0,r.jsxs)("div",{style:{display:"flex",gap:12,marginTop:24},className:"jsx-513b4b5890b57a8a flex gap-4",children:[(0,r.jsx)(u.ZP,{block:!0,size:"large",onClick:n,disabled:b,style:{height:56,borderRadius:16,fontSize:16,fontWeight:600,background:"#f3f4f6",border:"none",color:"#4b5563"},children:"ยกเลิก"}),(0,r.jsx)(u.ZP,{type:"primary",htmlType:"submit",block:!0,size:"large",loading:b,style:{height:56,borderRadius:16,fontSize:16,fontWeight:600,background:"#ef4444",border:"none",boxShadow:"0 4px 14px rgba(239, 68, 68, 0.4)"},children:"ยืนยันปิดกะ"})]})]})]})}),(0,r.jsx)(a(),{id:"513b4b5890b57a8a",children:".modal-header-close{background:-webkit-linear-gradient(top,#fef2f2 0%,#fff 100%);background:-moz-linear-gradient(top,#fef2f2 0%,#fff 100%);background:-o-linear-gradient(top,#fef2f2 0%,#fff 100%);background:linear-gradient(180deg,#fef2f2 0%,#fff 100%);padding:32px 24px 24px 24px;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-moz-box-orient:vertical;-moz-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;gap:8px;text-align:center}.icon-wrapper-close{width:64px;height:64px;background:#fee2e2;-webkit-border-radius:50%;-moz-border-radius:50%;border-radius:50%;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center;margin-bottom:8px;-webkit-box-shadow:0 4px 12px rgba(239,68,68,.15);-moz-box-shadow:0 4px 12px rgba(239,68,68,.15);box-shadow:0 4px 12px rgba(239,68,68,.15)}.info-card{background:#f8fafc;-webkit-border-radius:16px;-moz-border-radius:16px;border-radius:16px;padding:16px;margin-bottom:24px}.info-row{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-moz-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center}.info-divider{height:1px;background:#e2e8f0;margin:12px 0}.huge-input-close input{font-size:36px!important;font-weight:700!important;text-align:center!important;color:#ef4444!important;height:100%!important}.huge-input-close:focus-within{border-color:#ef4444!important;-webkit-box-shadow:0 0 0 4px rgba(239,68,68,.1)!important;-moz-box-shadow:0 0 0 4px rgba(239,68,68,.1)!important;box-shadow:0 0 0 4px rgba(239,68,68,.1)!important}"})]})}},54343:function(e,t,n){"use strict";n.d(t,{Z:function(){return g}});var r=n(57437),i=n(29),a=n.n(i),o=n(2265),s=n(39486),d=n(19878),l=n(53743),c=n(33477),u=n(50742),p=n(28006),x=n(62670),f=n(99376);let{Title:m,Text:h}=s.default;function g(){let{open:e,onCancel:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{currentShift:n,loading:i,openShift:s}=(0,p.S)(),[g,b]=(0,o.useState)(!1),[y]=d.Z.useForm(),k=(0,f.usePathname)(),v=async e=>{b(!0);try{await s(e.startAmount)}catch(e){}finally{b(!1)}};return i?null:(0,r.jsxs)(l.Z,{open:void 0!==e?e:!i&&!n&&"/pos/shift"!==k,onCancel:t,title:null,centered:!0,closable:!1,maskClosable:!1,footer:null,width:400,className:"soft-modal",styles:{body:{padding:0,borderRadius:24,overflow:"hidden",boxShadow:"0 20px 50px rgba(0,0,0,0.1)"}},children:[(0,r.jsxs)("div",{className:"jsx-986e1bd238b3f1c5 modal-header",children:[(0,r.jsx)("div",{className:"jsx-986e1bd238b3f1c5 icon-wrapper",children:(0,r.jsx)(x.Z,{style:{fontSize:32,color:"#10b981"}})}),(0,r.jsx)(m,{level:3,style:{margin:0,color:"#1f1f1f",fontWeight:700},children:"เปิดรอบการขาย"}),(0,r.jsx)(h,{type:"secondary",style:{fontSize:16},children:"Open Shift"})]}),(0,r.jsx)("div",{style:{padding:"0 32px 32px 32px"},className:"jsx-986e1bd238b3f1c5",children:(0,r.jsxs)(d.Z,{form:y,layout:"vertical",onFinish:v,initialValues:{startAmount:0},children:[(0,r.jsx)(d.Z.Item,{name:"startAmount",label:(0,r.jsx)("span",{style:{fontSize:16,fontWeight:500,color:"#4b5563"},className:"jsx-986e1bd238b3f1c5",children:"ระบุเงินทอนเริ่มต้น (บาท)"}),rules:[{required:!0,message:"กรุณาระบุจำนวนเงิน"}],children:(0,r.jsx)(c.Z,{style:{width:"100%",height:"80px",borderRadius:16,border:"2px solid #e5e7eb"},size:"large",min:0,precision:2,placeholder:"0.00",autoFocus:!0,controls:!1,inputMode:"decimal",className:"huge-input",formatter:e=>"".concat(e).replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:e=>null==e?void 0:e.replace(/\$\s?|(,*)/g,""),onKeyDown:e=>{if([8,46,9,27,13,190,110].includes(e.keyCode)||!0===e.ctrlKey||!0===e.metaKey||e.keyCode>=35&&e.keyCode<=39){var t;(190===e.keyCode||110===e.keyCode)&&(null===(t=e.target.value)||void 0===t?void 0:t.includes("."))&&e.preventDefault();return}(e.shiftKey||e.keyCode<48||e.keyCode>57)&&(e.keyCode<96||e.keyCode>105)&&e.preventDefault()}})}),(0,r.jsx)(u.ZP,{type:"primary",htmlType:"submit",block:!0,size:"large",loading:g,style:{height:56,borderRadius:16,fontSize:18,fontWeight:600,background:"#10b981",boxShadow:"0 4px 14px rgba(16, 185, 129, 0.4)",border:"none",marginTop:16},children:"ยืนยันเปิดกะ"})]})}),(0,r.jsx)(a(),{id:"986e1bd238b3f1c5",children:".soft-modal .ant-modal-content{padding:0!important}.modal-header{background:-webkit-linear-gradient(top,#f0fdf4 0%,#fff 100%);background:-moz-linear-gradient(top,#f0fdf4 0%,#fff 100%);background:-o-linear-gradient(top,#f0fdf4 0%,#fff 100%);background:linear-gradient(180deg,#f0fdf4 0%,#fff 100%);padding:40px 24px 24px 24px;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-moz-box-orient:vertical;-moz-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;gap:8px;text-align:center}.icon-wrapper{width:72px;height:72px;background:#d1fae5;-webkit-border-radius:50%;-moz-border-radius:50%;border-radius:50%;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center;margin-bottom:8px;-webkit-box-shadow:0 4px 12px rgba(16,185,129,.15);-moz-box-shadow:0 4px 12px rgba(16,185,129,.15);box-shadow:0 4px 12px rgba(16,185,129,.15)}.huge-input input{font-size:36px!important;font-weight:700!important;text-align:center!important;color:#10b981!important;height:100%!important}.huge-input:focus-within{border-color:#10b981!important;-webkit-box-shadow:0 0 0 4px rgba(16,185,129,.1)!important;-moz-box-shadow:0 0 0 4px rgba(16,185,129,.1)!important;box-shadow:0 0 0 4px rgba(16,185,129,.1)!important}"})]})}},27623:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var r=n(57437);n(2265);var i=n(10868),a=n(87530);function o(e){let{children:t,gap:n=a.H.sectionGap,style:o}=e;return(0,r.jsx)(i.Z,{vertical:!0,gap:n,style:o,children:t})}},2786:function(e,t,n){"use strict";n.d(t,{Z:function(){return d}});var r=n(57437);n(2265);var i=n(96931),a=n(85180),o=n(39486),s=n(87530);function d(e){let{title:t="ไม่มีข้อมูล",description:n,action:d,image:l}=e;return(0,r.jsx)(i.Z,{size:"small",variant:"outlined",style:{borderRadius:s.H.cardRadiusLG},bodyStyle:{padding:20},children:(0,r.jsx)(a.Z,{image:l,description:(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[(0,r.jsx)(o.default.Text,{strong:!0,children:t}),n?(0,r.jsx)(o.default.Text,{type:"secondary",children:n}):null]}),children:d})})}},46252:function(e,t,n){"use strict";n.d(t,{J:function(){return d},SocketProvider:function(){return l}});var r=n(57437),i=n(2265),a=n(68680),o=n(34029),s=n(14362);let d=(0,i.createContext)({socket:null,isConnected:!1}),l=e=>{let{children:t}=e,[n,l]=(0,i.useState)(null),[c,u]=(0,i.useState)(!1),p=(0,i.useRef)(!1),{user:x}=(0,s.a)();return(0,i.useEffect)(()=>{var e;if(!x){n&&(n.disconnect(),l(null),u(!1));return}let t=(null===(e=x.branch)||void 0===e?void 0:e.id)||x.branch_id||null,r=(0,a.io)("http://localhost:3000",{transports:["websocket"],withCredentials:!0,auth:{userId:x.id,branchId:t},reconnection:!0,reconnectionAttempts:5,reconnectionDelay:800,reconnectionDelayMax:8e3});return r.on("connect",()=>{console.log("Socket Connected:",r.id),u(!0),p.current=!1,o.ZP.success({content:"เชื่อมต่อเรียลไทม์แล้ว",key:"socket-status",duration:1.5})}),r.on("disconnect",()=>{console.log("Socket Disconnected"),u(!1),p.current||(p.current=!0,o.ZP.warning({content:"การเชื่อมต่อเรียลไทม์หลุด กำลังพยายามเชื่อมต่อใหม่...",key:"socket-status",duration:2}))}),r.io.on("reconnect_attempt",e=>{console.log("Socket reconnect attempt",e),u(!1)}),r.io.on("reconnect_failed",()=>{console.log("Socket reconnect failed"),o.ZP.error({content:"เชื่อมต่อเรียลไทม์ไม่สำเร็จ",key:"socket-status",duration:2})}),l(r),()=>{r.disconnect()}},[null==x?void 0:x.id]),(0,r.jsx)(d.Provider,{value:{socket:n,isConnected:c},children:t})}},28006:function(e,t,n){"use strict";n.d(t,{S:function(){return c},r:function(){return l}});var r=n(57437),i=n(2265),a=n(14362),o=n(59226),s=n(34029);let d=(0,i.createContext)(void 0),l=e=>{let{children:t}=e,{user:n}=(0,a.a)(),[l,c]=(0,i.useState)(null),[u,p]=(0,i.useState)(!0),x=(0,i.useCallback)(async()=>{if(n)try{let e=await o.t.getCurrentShift();c(e)}catch(e){console.error("Error fetching shift:",e)}finally{p(!1)}},[n]);(0,i.useEffect)(()=>{x()},[x]);let f=async e=>{if(n)try{let t=await o.t.openShift(e);c(t),s.ZP.success("เปิดกะเรียบร้อยแล้ว")}catch(e){throw s.ZP.error(e instanceof Error?e.message:"เปิดกะไม่สำเร็จ"),e}},m=async e=>{if(n)try{await o.t.closeShift(e),c(null),s.ZP.success("ปิดกะเรียบร้อยแล้ว")}catch(e){throw s.ZP.error(e instanceof Error?e.message:"ปิดกะไม่สำเร็จ"),e}};return(0,r.jsx)(d.Provider,{value:{currentShift:l,loading:u,openShift:f,closeShift:m,refreshShift:x},children:t})},c=()=>{let e=(0,i.useContext)(d);if(!e)throw Error("useShift must be used within a ShiftProvider");return e}},24675:function(e,t,n){"use strict";n.d(t,{s:function(){return a}});var r=n(2265),i=n(46252);let a=()=>(0,r.useContext)(i.J)},59226:function(e,t,n){"use strict";n.d(t,{t:function(){return a}});var r=n(97235),i=n(98170);let a={getCurrentShift:async()=>{let e=await fetch("/api/pos/shifts/current",{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"});if(404===e.status)return null;if(!e.ok)throw Error("Failed to fetch current shift");return(0,i.hH)(await e.json())},openShift:async e=>{let t=await (0,r.P)(),n=await fetch("/api/pos/shifts/open",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":t},credentials:"include",body:JSON.stringify({start_amount:e})});if(!n.ok){var a;let e=await n.json().catch(()=>({}));throw Error((null==e?void 0:null===(a=e.error)||void 0===a?void 0:a.message)||e.message||"Failed to open shift")}return(0,i.hH)(await n.json())},closeShift:async e=>{let t=await (0,r.P)(),n=await fetch("/api/pos/shifts/close",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":t},credentials:"include",body:JSON.stringify({end_amount:e})});if(!n.ok){var a;let e=await n.json().catch(()=>({}));throw Error((null==e?void 0:null===(a=e.error)||void 0===a?void 0:a.message)||e.message||"Failed to close shift")}return(0,i.hH)(await n.json())},getCurrentSummary:async()=>{let e=await fetch("/api/pos/shifts/current/summary",{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"});if(!e.ok)throw Error("Failed to fetch shift summary");return(0,i.hH)(await e.json())},getSummary:async e=>{let t=await fetch("/api/pos/shifts/summary/".concat(e),{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"});if(!t.ok)throw Error("Failed to fetch shift summary");return(0,i.hH)(await t.json())},getHistory:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new URLSearchParams;e.page&&t.set("page",String(e.page)),e.limit&&t.set("limit",String(e.limit)),e.q&&t.set("q",e.q),e.status&&t.set("status",e.status),e.date_from&&t.set("date_from",e.date_from),e.date_to&&t.set("date_to",e.date_to);let n=t.toString(),r=await fetch("/api/pos/shifts/history".concat(n?"?".concat(n):""),{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"});if(!r.ok){var a;let e=await r.json().catch(()=>({}));throw Error((null==e?void 0:null===(a=e.error)||void 0===a?void 0:a.message)||(null==e?void 0:e.error)||e.message||"Failed to fetch shift history")}return(0,i.hH)(await r.json())}}},44225:function(e,t,n){"use strict";n.d(t,{Np:function(){return o},X1:function(){return r},ax:function(){return a},hS:function(){return i}});let r={primary:"#6366F1",primaryLight:"#EEF2FF",primaryDark:"#4F46E5",success:"#10B981",successLight:"#ECFDF5",warning:"#F59E0B",warningLight:"#FFFBEB",error:"#EF4444",errorLight:"#FEF2F2",info:"#3B82F6",infoLight:"#EFF6FF",background:"#F8FAFC",cardBg:"#FFFFFF",border:"#E2E8F0",borderLight:"#F1F5F9",text:"#1E293B",textSecondary:"#64748B",textMuted:"#94A3B8",textInverse:"#FFFFFF",dineIn:"#3B82F6",takeaway:"#10B981",delivery:"#8B5CF6",kitchen:"#F97316",shift:"#10B981",kitchenBg:"#0F172A",kitchenCard:"rgba(30, 41, 59, 0.8)",kitchenBorder:"rgba(255, 255, 255, 0.1)"},i={dineIn:{primary:"#3B82F6",light:"#EFF6FF",border:"#BFDBFE",gradient:"linear-gradient(135deg, #3B82F6 0%, #2563EB 100%)",iconBg:"rgba(59, 130, 246, 0.1)"},takeaway:{primary:"#10B981",light:"#ECFDF5",border:"#A7F3D0",gradient:"linear-gradient(135deg, #10B981 0%, #059669 100%)",iconBg:"rgba(16, 185, 129, 0.1)"},delivery:{primary:"#8B5CF6",light:"#F5F3FF",border:"#DDD6FE",gradient:"linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%)",iconBg:"rgba(139, 92, 246, 0.1)"}},a={available:{primary:"#10B981",light:"#ECFDF5",border:"#A7F3D0",gradient:"linear-gradient(135deg, #10B981 0%, #059669 100%)",text:"#065F46"},occupied:{primary:"#F59E0B",light:"#FFFBEB",border:"#FCD34D",gradient:"linear-gradient(135deg, #F59E0B 0%, #D97706 100%)",text:"#92400E"},inactive:{primary:"#94A3B8",light:"#F8FAFC",border:"#CBD5E1",gradient:"linear-gradient(135deg, #94A3B8 0%, #64748B 100%)",text:"#475569"},waitingForPayment:{primary:"#3B82F6",light:"#EFF6FF",border:"#BFDBFE",gradient:"linear-gradient(135deg, #3B82F6 0%, #2563EB 100%)",text:"#1E40AF"}},o={container:{minHeight:"100vh",background:r.background,fontFamily:"var(--font-sans), 'Sarabun', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif",paddingBottom:100},header:{background:"linear-gradient(135deg, ".concat(r.primary," 0%, ").concat(r.primaryDark," 100%)"),padding:"16px 16px 48px",position:"relative",borderBottomLeftRadius:20,borderBottomRightRadius:20,overflow:"hidden"},heroHeader:{background:"linear-gradient(135deg, ".concat(r.primary," 0%, ").concat(r.primaryDark," 100%)"),padding:"24px 20px 56px",position:"relative",borderBottomLeftRadius:24,borderBottomRightRadius:24,boxShadow:"0 4px 20px rgba(99, 102, 241, 0.2)",marginBottom:-40,zIndex:1,overflow:"hidden"},contentWrapper:{maxWidth:1200,margin:"-32px auto 0",padding:"0 16px",position:"relative",zIndex:10},card:{borderRadius:16,boxShadow:"0 2px 8px rgba(0, 0, 0, 0.04)",border:"1px solid ".concat(r.border),overflow:"hidden",background:r.cardBg},itemCard:{marginBottom:8,borderRadius:12,border:"1px solid ".concat(r.borderLight),transition:"all 0.2s ease",background:r.cardBg},kitchenContainer:{minHeight:"100vh",background:r.kitchenBg,padding:"16px 16px 100px",color:"#F8FAFC",fontFamily:"var(--font-sans), 'Sarabun', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif"},kitchenGlassCard:{background:r.kitchenCard,backdropFilter:"blur(12px)",border:"1px solid ".concat(r.kitchenBorder),borderRadius:16,boxShadow:"0 8px 32px rgba(0, 0, 0, 0.3)",overflow:"hidden"},kitchenHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20,flexWrap:"wrap",gap:12},sectionTitle:{display:"flex",alignItems:"center",gap:10,marginBottom:16,fontSize:16,fontWeight:600,color:r.text}}},12028:function(e,t,n){"use strict";n.d(t,{b:function(){return r},g:function(){return i}});let r={system:{announcement:"system:announcement"},users:{create:"users:create",update:"users:update",delete:"users:delete",status:"users:update-status"},roles:{create:"roles:create",update:"roles:update",delete:"roles:delete"},branches:{create:"branches:create",update:"branches:update",delete:"branches:delete"},products:{create:"products:create",update:"products:update",delete:"products:delete"},productsUnit:{create:"productsUnit:create",update:"productsUnit:update",delete:"productsUnit:delete"},categories:{create:"category:create",update:"category:update",delete:"category:delete"},tables:{create:"tables:create",update:"tables:update",delete:"tables:delete"},orders:{create:"orders:create",update:"orders:update",delete:"orders:delete"},payments:{create:"payments:create",update:"payments:update",delete:"payments:delete"},discounts:{create:"discounts:create",update:"discounts:update",delete:"discounts:delete"},delivery:{create:"delivery:create",update:"delivery:update",delete:"delivery:delete"},shifts:{update:"shifts:update"},orderQueue:{added:"order-queue:added",updated:"order-queue:updated",removed:"order-queue:removed",reordered:"order-queue:reordered"},ingredients:{create:"ingredients:create",update:"ingredients:update",delete:"ingredients:delete"},ingredientsUnit:{create:"ingredientsUnit:create",update:"ingredientsUnit:update",delete:"ingredientsUnit:delete"},stock:{update:"stock:update"},stockOrders:{create:"stock:orders:create",update:"stock:orders:update",status:"stock:orders:status",delete:"stock:orders:delete",detailUpdate:"stock:orders:detail:update"},paymentAccounts:{create:"payment-accounts:create",update:"payment-accounts:update",delete:"payment-accounts:delete"},paymentMethods:{create:"paymentMethod:create",update:"paymentMethod:update",delete:"paymentMethod:delete"},shopProfile:{update:"shopProfile:update"},salesOrderItem:{create:"salesOrderItem:create",update:"salesOrderItem:update",delete:"salesOrderItem:delete"},salesOrderDetail:{create:"salesOrderDetail:create",update:"salesOrderDetail:update",delete:"salesOrderDetail:delete"}},i={stockOrdersUpdated:"orders_updated"}}},function(e){e.O(0,[253,1522,3418,742,9486,4252,3916,8651,6931,4159,3831,2224,3248,2401,9,9845,9763,9878,1713,4547,7855,4397,9385,4390,2971,2117,1744],function(){return e(e.s=25116)}),_N_E=e.O()}]);