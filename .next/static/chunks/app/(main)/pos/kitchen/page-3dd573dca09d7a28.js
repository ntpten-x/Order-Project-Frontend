(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5628],{85226:function(e,a,s){Promise.resolve().then(s.bind(s,35384))},35384:function(e,a,s){"use strict";s.r(a),s.d(a,{default:function(){return q}});var r=s(57437),t=s(29),o=s.n(t),i=s(2265),l=s(29827),n=s(11713),d=s(60283),c=s(34029),b=s(80009),x=s(50742),f=s(89970),g=s(48651),p=s(85180),h=s(47451),m=s(69410),u=s(5649),y=s(441),j=s(95044),v=s(25980),w=s(89245),k=s(5540),N=s(19574),S=s(9738),_=s(38576),C=s(46252),z=s(53286),Z=s(68779),I=s(3369),M=s(97235),P=s(12028),R=s(71096),O=s.n(R);s(6729);var W=s(45721),E=s.n(W),T=s(25193),D=s(36799);O().extend(E()),O().locale("th");let{Title:L,Text:A}=d.default,B={container:{minHeight:"100vh",background:"radial-gradient(circle at 20% 20%, rgba(59,130,246,0.08), transparent 25%), radial-gradient(circle at 80% 0%, rgba(16,185,129,0.08), transparent 22%), #0b1020",padding:"24px",color:"#f8fafc",fontFamily:"var(--font-sans), 'Sarabun', sans-serif",position:"relative",overflow:"hidden"},header:{marginBottom:28,background:"linear-gradient(135deg, rgba(30,41,59,0.9) 0%, rgba(15,23,42,0.9) 40%, rgba(28,43,68,0.92) 100%)",padding:"18px 22px",borderRadius:24,display:"flex",justifyContent:"space-between",alignItems:"center",border:"1px solid rgba(255,255,255,0.08)",boxShadow:"0 20px 50px rgba(0,0,0,0.25)",position:"relative",overflow:"hidden"},card:(e,a)=>({background:"linear-gradient(180deg, rgba(30,41,59,0.96) 0%, rgba(17,24,39,0.94) 100%)",borderRadius:18,overflow:"hidden",border:"1px solid ".concat(a?e:"rgba(255,255,255,0.08)"),boxShadow:a?"0 0 0 2px ".concat(e,"33, 0 16px 32px rgba(0,0,0,0.28)"):"0 12px 30px rgba(0,0,0,0.18)",height:"100%",display:"flex",flexDirection:"column",transition:"transform 0.25s ease, box-shadow 0.25s ease, border-color 0.25s ease",animation:a?"pulse-border 1.8s infinite":"none"}),itemRow:e=>({padding:"12px",background:e===Z.M.Cooking?"rgba(16, 185, 129, 0.12)":"rgba(255,255,255,0.05)",marginBottom:10,borderRadius:10,borderLeft:"5px solid ".concat(e===Z.M.Cooking?"#10b981":e===Z.M.Served?"#64748b":"#f59e0b"),display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:10})},F=e=>{let a=O()().diff(O()(e),"minute");return a<10?{color:"#10b981",bgColor:"rgba(16, 185, 129, 0.2)",label:"ปกติ",level:1}:a<20?{color:"#f59e0b",bgColor:"rgba(245, 158, 11, 0.2)",label:"เริ่มช้า",level:2}:{color:"#ef4444",bgColor:"rgba(239, 68, 68, 0.2)",label:"ด่วน!",level:3}};function q(){let{socket:e,isConnected:a}=(0,i.useContext)(C.J),{showLoading:s,hideLoading:t}=(0,I.O)(),d=(0,l.NL)(),[R,W]=(0,i.useState)(!0),E=(0,i.useRef)(null),[q,H]=(0,i.useState)("all");(0,i.useEffect)(()=>{E.current=new Audio("https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3"),E.current.volume=.6},[]);let K=(0,i.useCallback)(()=>{R&&E.current&&(E.current.currentTime=0,E.current.play().catch(e=>{console.error(e),c.ZP.warning((0,D.t)("kitchen.soundBlocked"))}))},[R]),{data:Q=[],isLoading:G,refetch:J,error:U}=(0,n.a)({queryKey:["orderItems","kitchen"],queryFn:async()=>{let[e,a]=await Promise.all([z.x.getItems(Z.M.Pending),z.x.getItems(Z.M.Cooking)]);return[...e,...a].filter(e=>e.status!==Z.M.Served&&e.status!==Z.M.Cancelled)},staleTime:2e3,refetchInterval:3e4}),V=(0,i.useMemo)(()=>{let e={};return("all"===q?Q.filter(e=>e.status!==Z.M.Served&&e.status!==Z.M.Cancelled):Q.filter(e=>e.status===q)).forEach(a=>{let s=a.order_id;if(!e[s]){var r,t,o,i,l;let n=(null===(r=a.order)||void 0===r?void 0:r.create_date)||new Date().toISOString();e[s]={order_id:s,order_no:(null===(t=a.order)||void 0===t?void 0:t.order_no)||"N/A",table_name:(null===(i=a.order)||void 0===i?void 0:null===(o=i.table)||void 0===o?void 0:o.table_name)||null,order_type:(null===(l=a.order)||void 0===l?void 0:l.order_type)||"Unknown",created_at:n,items:[]}}e[s].items.push(a)}),Object.values(e).sort((e,a)=>O()(e.created_at).valueOf()-O()(a.created_at).valueOf())},[Q,q]);(0,i.useEffect)(()=>{if(!e)return;let a=e=>{console.log("New Order Received:",e),J(),K(),c.ZP.open({type:"info",content:"ออเดอร์ใหม่: #".concat(e.order_no),icon:(0,r.jsx)(u.Z,{style:{color:"#10b981"}}),className:"kds-notification",duration:5})},s=()=>{J()};return e.on(P.b.orders.create,a),e.on(P.b.orders.update,s),e.on(P.b.salesOrderItem.create,s),e.on(P.b.salesOrderItem.update,s),e.on(P.b.salesOrderItem.delete,s),e.on(P.b.salesOrderDetail.create,s),e.on(P.b.salesOrderDetail.update,s),e.on(P.b.salesOrderDetail.delete,s),()=>{e.off(P.b.orders.create,a),e.off(P.b.orders.update,s),e.off(P.b.salesOrderItem.create,s),e.off(P.b.salesOrderItem.update,s),e.off(P.b.salesOrderItem.delete,s),e.off(P.b.salesOrderDetail.create,s),e.off(P.b.salesOrderDetail.update,s),e.off(P.b.salesOrderDetail.delete,s)}},[e,J,K]);let Y=async(e,a)=>{try{d.setQueryData(["orderItems","kitchen"],function(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return s.map(s=>s.id===e?{...s,status:a}:s)});let s=await (0,M.P)();await z.x.updateItemStatus(e,a,void 0,s)}catch(e){c.ZP.error("อัปเดตสถานะไม่สำเร็จ"),J()}},X=async e=>{try{s("กำลังเสิร์ฟทั้งหมด...");let a=V.find(a=>a.order_id===e);if(!a)return;let r=await (0,M.P)(),t=a.items.map(e=>z.x.updateItemStatus(e.id,Z.M.Served,void 0,r));await Promise.all(t),d.setQueryData(["orderItems","kitchen"],function(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return a.filter(a=>a.order_id!==e)}),c.ZP.success("เสิร์ฟออเดอร์ #".concat(a.order_no," เรียบร้อย"))}catch(e){c.ZP.error("เกิดข้อผิดพลาดในการเสิร์ฟทั้งหมด"),J()}finally{t()}},$=Q.filter(e=>e.status===Z.M.Pending).length,ee=Q.filter(e=>e.status===Z.M.Cooking).length;return(0,r.jsx)(T.Z,{maxWidth:99999,style:{padding:0},children:(0,r.jsxs)("div",{style:B.container,className:"jsx-6fa0245e60aa494b",children:[(0,r.jsx)(o(),{id:"6fa0245e60aa494b",children:"@-webkit-keyframes pulse-border{0%{-webkit-box-shadow:0 0 0 0 rgba(239,68,68,.4);box-shadow:0 0 0 0 rgba(239,68,68,.4)}70%{-webkit-box-shadow:0 0 0 10px rgba(239,68,68,0);box-shadow:0 0 0 10px rgba(239,68,68,0)}100%{-webkit-box-shadow:0 0 0 0 rgba(239,68,68,0);box-shadow:0 0 0 0 rgba(239,68,68,0)}}@-moz-keyframes pulse-border{0%{-moz-box-shadow:0 0 0 0 rgba(239,68,68,.4);box-shadow:0 0 0 0 rgba(239,68,68,.4)}70%{-moz-box-shadow:0 0 0 10px rgba(239,68,68,0);box-shadow:0 0 0 10px rgba(239,68,68,0)}100%{-moz-box-shadow:0 0 0 0 rgba(239,68,68,0);box-shadow:0 0 0 0 rgba(239,68,68,0)}}@-o-keyframes pulse-border{0%{box-shadow:0 0 0 0 rgba(239,68,68,.4)}70%{box-shadow:0 0 0 10px rgba(239,68,68,0)}100%{box-shadow:0 0 0 0 rgba(239,68,68,0)}}@keyframes pulse-border{0%{-webkit-box-shadow:0 0 0 0 rgba(239,68,68,.4);-moz-box-shadow:0 0 0 0 rgba(239,68,68,.4);box-shadow:0 0 0 0 rgba(239,68,68,.4)}70%{-webkit-box-shadow:0 0 0 10px rgba(239,68,68,0);-moz-box-shadow:0 0 0 10px rgba(239,68,68,0);box-shadow:0 0 0 10px rgba(239,68,68,0)}100%{-webkit-box-shadow:0 0 0 0 rgba(239,68,68,0);-moz-box-shadow:0 0 0 0 rgba(239,68,68,0);box-shadow:0 0 0 0 rgba(239,68,68,0)}}.kds-notification .ant-message-custom-content{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;font-size:16px;font-weight:600}"}),(0,r.jsxs)("div",{style:B.header,className:"jsx-6fa0245e60aa494b",children:[(0,r.jsx)("div",{style:{position:"absolute",inset:0,opacity:.6,pointerEvents:"none"},className:"jsx-6fa0245e60aa494b header-pattern"}),(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:18,flexWrap:"wrap",position:"relative",zIndex:2},className:"jsx-6fa0245e60aa494b",children:[(0,r.jsx)("div",{style:{width:62,height:62,borderRadius:18,background:"linear-gradient(135deg, #f59e0b 0%, #f97316 60%, #fb923c 100%)",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 0 24px rgba(249, 115, 22, 0.4)",position:"relative",overflow:"hidden"},className:"jsx-6fa0245e60aa494b",children:(0,r.jsx)(y.Z,{style:{fontSize:30,color:"#fff"},className:"header-icon-animate"})}),(0,r.jsxs)("div",{style:{minWidth:0},className:"jsx-6fa0245e60aa494b",children:[(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:10,flexWrap:"wrap"},className:"jsx-6fa0245e60aa494b",children:[(0,r.jsx)(L,{level:2,style:{margin:0,color:"#fff",fontSize:28,letterSpacing:"0.5px"},children:"Kitchen Pulse"}),a?(0,r.jsx)(b.Z,{icon:(0,r.jsx)(j.Z,{}),color:"#10b981",style:{margin:0,borderRadius:12,padding:"2px 12px",fontWeight:700},children:"LIVE"}):(0,r.jsx)(b.Z,{icon:(0,r.jsx)(j.Z,{}),color:"#ef4444",style:{margin:0,borderRadius:12,padding:"2px 12px",fontWeight:700},children:"OFFLINE"})]}),(0,r.jsx)(A,{style:{color:"#cbd5e1",fontSize:14},children:"มอนิเตอร์งานครัวแบบเรียลไทม์ • เน้นงานด่วนก่อน"})]})]}),(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:14,flexWrap:"wrap",justifyContent:"flex-end",position:"relative",zIndex:2},className:"jsx-6fa0245e60aa494b",children:[(0,r.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(120px, 1fr))",gap:10,background:"rgba(255,255,255,0.04)",padding:"10px 12px",borderRadius:16,border:"1px solid rgba(255,255,255,0.08)",minWidth:320},className:"jsx-6fa0245e60aa494b",children:[{label:"คิวทั้งหมด",value:Q.length,color:"#38bdf8"},{label:"รอทำ",value:$,color:"#f59e0b"},{label:"กำลังทำ",value:ee,color:"#10b981"}].map(e=>(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:2},className:"jsx-6fa0245e60aa494b",children:[(0,r.jsx)(A,{style:{color:"#cbd5e1",fontSize:12},children:e.label}),(0,r.jsx)(A,{strong:!0,style:{color:e.color,fontSize:18},children:e.value})]},e.label))}),(0,r.jsx)("div",{style:{display:"flex",alignItems:"center",gap:8,background:"#0b1222",padding:6,borderRadius:14,border:"1px solid rgba(255,255,255,0.06)"},className:"jsx-6fa0245e60aa494b",children:["all",Z.M.Pending,Z.M.Cooking].map(e=>{let a=q===e,s=Q.length,t="ทั้งหมด",o="#38bdf8";return e===Z.M.Pending?(s=$,t="รอทำ",o="#f59e0b"):e===Z.M.Cooking&&(s=ee,t="กำลังทำ",o="#10b981"),(0,r.jsxs)(x.ZP,{type:"text",onClick:()=>H(e),style:{color:a?"#0b1222":"#cbd5e1",background:a?o:"transparent",borderRadius:10,fontWeight:a?700:500,height:36,padding:"0 14px"},children:[t," ",(0,r.jsx)("span",{style:{opacity:.7,marginLeft:6,fontSize:12},className:"jsx-6fa0245e60aa494b",children:s})]},e)})}),(0,r.jsx)(f.Z,{title:"เปิด/ปิดเสียงแจ้งเตือน",children:(0,r.jsx)(x.ZP,{type:"text",icon:(0,r.jsx)(v.Z,{style:{fontSize:18}}),onClick:()=>W(!R),style:{color:R?"#10b981":"#94a3b8",background:R?"rgba(16, 185, 129, 0.15)":"rgba(255,255,255,0.05)",width:44,height:44,borderRadius:12}})}),(0,r.jsx)(x.ZP,{icon:(0,r.jsx)(w.Z,{}),onClick:()=>J(),loading:G,style:{background:"linear-gradient(135deg, #38bdf8 0%, #6366f1 100%)",border:"none",color:"white",borderRadius:12,height:44,boxShadow:"0 10px 24px rgba(99,102,241,0.3)"},children:"รีเฟรช"})]})]}),U&&(0,r.jsxs)("div",{style:{textAlign:"center",padding:"60px 16px",color:"#cbd5e1"},className:"jsx-6fa0245e60aa494b",children:[(0,r.jsx)(A,{style:{color:"#fca5a5"},children:"โหลดข้อมูลไม่สำเร็จ"}),(0,r.jsx)("div",{style:{marginTop:10},className:"jsx-6fa0245e60aa494b",children:(0,r.jsx)(x.ZP,{onClick:()=>J(),type:"primary",children:"ลองใหม่"})})]}),!U&&G?(0,r.jsx)("div",{style:{display:"flex",justifyContent:"center",paddingTop:100},className:"jsx-6fa0245e60aa494b",children:(0,r.jsx)(g.Z,{size:"large"})}):0===V.length?(0,r.jsx)(p.Z,{image:p.Z.PRESENTED_IMAGE_SIMPLE,description:(0,r.jsx)(A,{style:{color:"#64748b",fontSize:18},children:"ไม่มีออเดอร์ในครัวขณะนี้"}),style:{marginTop:100}}):(0,r.jsx)(h.Z,{gutter:[20,20],children:V.map(e=>{let a=F(e.created_at),s=3===a.level,t=Math.min(1,Math.max(.1,O()().diff(O()(e.created_at),"minute")/25));return(0,r.jsx)(m.Z,{xs:24,sm:24,md:12,lg:8,xl:6,children:(0,r.jsxs)("div",{style:B.card(a.color,s),className:"jsx-6fa0245e60aa494b",children:[(0,r.jsxs)("div",{style:{padding:"16px",background:s?"rgba(239, 68, 68, 0.1)":"transparent",borderBottom:"1px solid rgba(255,255,255,0.05)"},className:"jsx-6fa0245e60aa494b",children:[(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},className:"jsx-6fa0245e60aa494b",children:[(0,r.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"center"},className:"jsx-6fa0245e60aa494b",children:[(0,r.jsxs)("span",{style:{background:"#fff",color:"#0f172a",fontWeight:800,padding:"2px 8px",borderRadius:6,fontSize:16},className:"jsx-6fa0245e60aa494b",children:["#",e.order_no]}),e.table_name&&(0,r.jsxs)("span",{style:{color:"#94a3b8",fontSize:16,fontWeight:600},className:"jsx-6fa0245e60aa494b",children:["โต๊ะ ",e.table_name]})]}),(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:6,color:a.color},className:"jsx-6fa0245e60aa494b",children:[(0,r.jsx)(k.Z,{}),(0,r.jsx)("span",{style:{fontWeight:700,fontSize:14},className:"jsx-6fa0245e60aa494b",children:O()(e.created_at).fromNow(!0)})]})]}),(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},className:"jsx-6fa0245e60aa494b",children:[(0,r.jsx)(b.Z,{color:s?"red":"blue",style:{margin:0,border:"none"},children:e.order_type}),s&&(0,r.jsx)("span",{style:{color:"#ef4444",fontWeight:700,fontSize:12,textTransform:"uppercase",letterSpacing:1},className:"jsx-6fa0245e60aa494b",children:"LATE"})]}),(0,r.jsx)("div",{style:{marginTop:10,height:6,background:"rgba(255,255,255,0.08)",borderRadius:999,overflow:"hidden"},className:"jsx-6fa0245e60aa494b",children:(0,r.jsx)("div",{style:{width:"".concat(100*t,"%"),height:"100%",background:a.color,transition:"width 0.3s ease"},className:"jsx-6fa0245e60aa494b"})})]}),(0,r.jsx)("div",{style:{flex:1,padding:16,overflowY:"auto",maxHeight:"50vh"},className:"jsx-6fa0245e60aa494b",children:e.items.map(e=>{var a;return(0,r.jsxs)("div",{style:B.itemRow(e.status),className:"jsx-6fa0245e60aa494b",children:[(0,r.jsx)("div",{style:{flex:1},className:"jsx-6fa0245e60aa494b",children:(0,r.jsxs)("div",{style:{display:"flex",gap:12},className:"jsx-6fa0245e60aa494b",children:[(0,r.jsx)("span",{style:{fontSize:18,fontWeight:800,color:"#f8fafc",minWidth:32},className:"jsx-6fa0245e60aa494b",children:e.quantity}),(0,r.jsxs)("div",{style:{flex:1},className:"jsx-6fa0245e60aa494b",children:[(0,r.jsx)("div",{style:{fontSize:16,fontWeight:600,color:"#f1f5f9",lineHeight:1.4},className:"jsx-6fa0245e60aa494b",children:null===(a=e.product)||void 0===a?void 0:a.display_name}),e.notes&&(0,r.jsxs)("div",{style:{marginTop:8,background:"#f59e0b",color:"#000",padding:"4px 8px",borderRadius:6,fontWeight:600,fontSize:13,display:"inline-block"},className:"jsx-6fa0245e60aa494b",children:["⚠️ ",e.notes]}),(0,r.jsxs)("div",{style:{marginTop:6,fontSize:12,color:"#94a3b8"},className:"jsx-6fa0245e60aa494b",children:[e.status===Z.M.Cooking&&"กำลังปรุง...",e.status===Z.M.Pending&&"รอคิว"]})]})]})}),(0,r.jsxs)("div",{style:{marginLeft:8},className:"jsx-6fa0245e60aa494b",children:[e.status===Z.M.Pending&&(0,r.jsx)(x.ZP,{type:"text",icon:(0,r.jsx)(N.Z,{style:{fontSize:18}}),onClick:()=>Y(e.id,Z.M.Cooking),style:{color:"#f59e0b",background:"rgba(245, 158, 11, 0.1)",width:44,height:44,borderRadius:12}}),e.status===Z.M.Cooking&&(0,r.jsx)(x.ZP,{type:"text",icon:(0,r.jsx)(S.Z,{style:{fontSize:20}}),onClick:()=>Y(e.id,Z.M.Served),style:{color:"#10b981",background:"rgba(16, 185, 129, 0.2)",width:44,height:44,borderRadius:12,border:"1px solid rgba(16, 185, 129, 0.3)"}})]})]},e.id)})}),(0,r.jsx)("div",{style:{padding:16,borderTop:"1px solid rgba(255,255,255,0.05)"},className:"jsx-6fa0245e60aa494b",children:(0,r.jsx)(x.ZP,{block:!0,type:"primary",size:"large",icon:(0,r.jsx)(_.Z,{}),onClick:()=>X(e.order_id),style:{background:"#10b981",borderColor:"#10b981",borderRadius:12,height:48,fontWeight:700,fontSize:16},children:"เสิร์ฟทั้งหมด"})})]})},e.order_id)})})]})})}}},function(e){e.O(0,[8024,4736,8592,1744],function(){return e(e.s=85226)}),_N_E=e.O()}]);