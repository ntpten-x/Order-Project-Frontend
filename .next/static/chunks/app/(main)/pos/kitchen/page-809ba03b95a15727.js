(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5628],{85226:function(e,a,s){Promise.resolve().then(s.bind(s,35384))},35384:function(e,a,s){"use strict";s.r(a),s.d(a,{default:function(){return B}});var t=s(57437),r=s(29),o=s.n(r),i=s(2265),l=s(29827),n=s(11713),d=s(19683),c=s(34029),b=s(80009),x=s(24783),f=s(50742),g=s(89970),p=s(48651),h=s(85180),u=s(47451),m=s(69410),y=s(5649),j=s(441),v=s(95044),w=s(25980),k=s(89245),N=s(5540),S=s(19574),_=s(9738),C=s(38576),z=s(46252),Z=s(53286),I=s(68779),M=s(3369),P=s(97235),R=s(71096),E=s.n(R);s(6729);var T=s(45721),W=s.n(T);E().extend(W()),E().locale("th");let{Title:L,Text:O}=d.default,D={container:{minHeight:"100vh",background:"#0f172a",padding:"24px",color:"#f8fafc",fontFamily:"'Inter', 'Sarabun', sans-serif"},header:{marginBottom:32,background:"#1e293b",padding:"16px 24px",borderRadius:20,display:"flex",justifyContent:"space-between",alignItems:"center",border:"1px solid rgba(255,255,255,0.05)",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)"},card:(e,a)=>({background:"#1e293b",borderRadius:16,overflow:"hidden",border:"2px solid ".concat(a?e:"rgba(255,255,255,0.05)"),boxShadow:a?"0 0 0 2px ".concat(e,", 0 10px 15px -3px rgba(0, 0, 0, 0.1)"):"0 4px 6px -1px rgba(0, 0, 0, 0.1)",height:"100%",display:"flex",flexDirection:"column",transition:"all 0.3s ease",animation:a?"pulse-border 2s infinite":"none"}),itemRow:e=>({padding:"12px",background:e===I.M.Cooking?"rgba(16, 185, 129, 0.1)":"rgba(255,255,255,0.03)",marginBottom:8,borderRadius:8,borderLeft:"4px solid ".concat(e===I.M.Cooking?"#10b981":e===I.M.Served?"#64748b":"#f59e0b"),display:"flex",justifyContent:"space-between",alignItems:"flex-start"})},A=e=>{let a=E()().diff(E()(e),"minute");return a<10?{color:"#10b981",bgColor:"rgba(16, 185, 129, 0.2)",label:"ปกติ",level:1}:a<20?{color:"#f59e0b",bgColor:"rgba(245, 158, 11, 0.2)",label:"เริ่มช้า",level:2}:{color:"#ef4444",bgColor:"rgba(239, 68, 68, 0.2)",label:"ด่วน!",level:3}};function B(){let{socket:e,isConnected:a}=(0,i.useContext)(z.J),{showLoading:s,hideLoading:r}=(0,M.x)(),d=(0,l.NL)(),[R,T]=(0,i.useState)(!0),W=(0,i.useRef)(null),[B,F]=(0,i.useState)("all");(0,i.useEffect)(()=>{W.current=new Audio("https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3"),W.current.volume=.6},[]);let H=(0,i.useCallback)(()=>{R&&W.current&&(W.current.currentTime=0,W.current.play().catch(console.error))},[R]),{data:q=[],isLoading:K,refetch:Q}=(0,n.a)({queryKey:["orderItems","kitchen"],queryFn:async()=>(await Z.x.getItems()).filter(e=>e.status!==I.M.Served&&e.status!==I.M.Cancelled),staleTime:2e3,refetchInterval:3e4}),Y=(0,i.useMemo)(()=>{let e={};return("all"===B?q.filter(e=>e.status!==I.M.Served&&e.status!==I.M.Cancelled):q.filter(e=>e.status===B)).forEach(a=>{let s=a.order_id;if(!e[s]){var t,r,o,i,l;let n=(null===(t=a.order)||void 0===t?void 0:t.create_date)||new Date().toISOString();e[s]={order_id:s,order_no:(null===(r=a.order)||void 0===r?void 0:r.order_no)||"N/A",table_name:(null===(i=a.order)||void 0===i?void 0:null===(o=i.table)||void 0===o?void 0:o.table_name)||null,order_type:(null===(l=a.order)||void 0===l?void 0:l.order_type)||"Unknown",created_at:n,items:[]}}e[s].items.push(a)}),Object.values(e).sort((e,a)=>E()(e.created_at).valueOf()-E()(a.created_at).valueOf())},[q,B]);(0,i.useEffect)(()=>{if(!e)return;let a=e=>{console.log("New Order Received:",e),Q(),H(),c.ZP.open({type:"info",content:"ออเดอร์ใหม่: #".concat(e.order_no),icon:(0,t.jsx)(y.Z,{style:{color:"#10b981"}}),className:"kds-notification",duration:5})},s=()=>{Q()};return e.on("orders:create",a),e.on("orders:update",s),()=>{e.off("orders:create",a),e.off("orders:update",s)}},[e,Q,H]);let G=async(e,a)=>{try{d.setQueryData(["orderItems","kitchen"],function(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return s.map(s=>s.id===e?{...s,status:a}:s)});let s=await (0,P.P)();await Z.x.updateItemStatus(e,a,void 0,s)}catch(e){c.ZP.error("อัปเดตสถานะไม่สำเร็จ"),Q()}},J=async e=>{try{s("กำลังเสิร์ฟทั้งหมด...");let a=Y.find(a=>a.order_id===e);if(!a)return;let t=await (0,P.P)(),r=a.items.map(e=>Z.x.updateItemStatus(e.id,I.M.Served,void 0,t));await Promise.all(r),d.setQueryData(["orderItems","kitchen"],function(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return a.filter(a=>a.order_id!==e)}),c.ZP.success("เสิร์ฟออเดอร์ #".concat(a.order_no," เรียบร้อย"))}catch(e){c.ZP.error("เกิดข้อผิดพลาดในการเสิร์ฟทั้งหมด"),Q()}finally{r()}},U=q.filter(e=>e.status===I.M.Pending).length,V=q.filter(e=>e.status===I.M.Cooking).length;return(0,t.jsxs)("div",{style:D.container,className:"jsx-6fa0245e60aa494b",children:[(0,t.jsx)(o(),{id:"6fa0245e60aa494b",children:"@-webkit-keyframes pulse-border{0%{-webkit-box-shadow:0 0 0 0 rgba(239,68,68,.4);box-shadow:0 0 0 0 rgba(239,68,68,.4)}70%{-webkit-box-shadow:0 0 0 10px rgba(239,68,68,0);box-shadow:0 0 0 10px rgba(239,68,68,0)}100%{-webkit-box-shadow:0 0 0 0 rgba(239,68,68,0);box-shadow:0 0 0 0 rgba(239,68,68,0)}}@-moz-keyframes pulse-border{0%{-moz-box-shadow:0 0 0 0 rgba(239,68,68,.4);box-shadow:0 0 0 0 rgba(239,68,68,.4)}70%{-moz-box-shadow:0 0 0 10px rgba(239,68,68,0);box-shadow:0 0 0 10px rgba(239,68,68,0)}100%{-moz-box-shadow:0 0 0 0 rgba(239,68,68,0);box-shadow:0 0 0 0 rgba(239,68,68,0)}}@-o-keyframes pulse-border{0%{box-shadow:0 0 0 0 rgba(239,68,68,.4)}70%{box-shadow:0 0 0 10px rgba(239,68,68,0)}100%{box-shadow:0 0 0 0 rgba(239,68,68,0)}}@keyframes pulse-border{0%{-webkit-box-shadow:0 0 0 0 rgba(239,68,68,.4);-moz-box-shadow:0 0 0 0 rgba(239,68,68,.4);box-shadow:0 0 0 0 rgba(239,68,68,.4)}70%{-webkit-box-shadow:0 0 0 10px rgba(239,68,68,0);-moz-box-shadow:0 0 0 10px rgba(239,68,68,0);box-shadow:0 0 0 10px rgba(239,68,68,0)}100%{-webkit-box-shadow:0 0 0 0 rgba(239,68,68,0);-moz-box-shadow:0 0 0 0 rgba(239,68,68,0);box-shadow:0 0 0 0 rgba(239,68,68,0)}}.kds-notification .ant-message-custom-content{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;font-size:16px;font-weight:600}"}),(0,t.jsxs)("div",{style:D.header,className:"jsx-6fa0245e60aa494b",children:[(0,t.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:20},className:"jsx-6fa0245e60aa494b",children:[(0,t.jsx)("div",{style:{width:56,height:56,borderRadius:16,background:"linear-gradient(135deg, #f59e0b 0%, #d97706 100%)",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 0 20px rgba(245, 158, 11, 0.3)"},className:"jsx-6fa0245e60aa494b",children:(0,t.jsx)(j.Z,{style:{fontSize:30,color:"#fff"}})}),(0,t.jsxs)("div",{className:"jsx-6fa0245e60aa494b",children:[(0,t.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12},className:"jsx-6fa0245e60aa494b",children:[(0,t.jsx)(L,{level:2,style:{margin:0,color:"#fff",fontSize:28,letterSpacing:"0.5px"},children:"KITCHEN DISPLAY"}),a?(0,t.jsx)(b.Z,{icon:(0,t.jsx)(v.Z,{}),color:"#10b981",style:{margin:0,borderRadius:12,padding:"2px 10px"},children:"LIVE"}):(0,t.jsx)(b.Z,{icon:(0,t.jsx)(v.Z,{}),color:"#ef4444",style:{margin:0,borderRadius:12,padding:"2px 10px"},children:"OFFLINE"})]}),(0,t.jsx)(O,{style:{color:"#94a3b8",fontSize:14},children:"ระบบจัดการออเดอร์ในครัวอัจฉริยะ"})]})]}),(0,t.jsxs)(x.Z,{size:16,children:[(0,t.jsx)("div",{style:{background:"#020617",padding:6,borderRadius:14,display:"flex",gap:4},className:"jsx-6fa0245e60aa494b",children:["all",I.M.Pending,I.M.Cooking].map(e=>{let a=B===e,s=q.length,r="ทั้งหมด",o="#3b82f6";return e===I.M.Pending?(s=U,r="รอทำ",o="#f59e0b"):e===I.M.Cooking&&(s=V,r="กำลังทำ",o="#10b981"),(0,t.jsxs)(f.ZP,{type:"text",onClick:()=>F(e),style:{color:a?"#fff":"#64748b",background:a?o:"transparent",borderRadius:10,fontWeight:a?600:400,height:36,padding:"0 16px"},children:[r," ",(0,t.jsx)("span",{style:{opacity:.7,marginLeft:6,fontSize:12},className:"jsx-6fa0245e60aa494b",children:s})]},e)})}),(0,t.jsx)("div",{style:{width:1,height:32,background:"rgba(255,255,255,0.1)"},className:"jsx-6fa0245e60aa494b"}),(0,t.jsx)(g.Z,{title:"เปิด/ปิดเสียง",children:(0,t.jsx)(f.ZP,{type:"text",icon:(0,t.jsx)(w.Z,{style:{fontSize:18}}),onClick:()=>T(!R),style:{color:R?"#10b981":"#64748b",background:R?"rgba(16, 185, 129, 0.1)":"rgba(255,255,255,0.05)",width:44,height:44,borderRadius:12}})}),(0,t.jsx)(f.ZP,{icon:(0,t.jsx)(k.Z,{}),onClick:()=>Q(),loading:K,style:{background:"#334155",border:"none",color:"white",borderRadius:12,height:44},children:"รีเฟรช"})]})]}),K?(0,t.jsx)("div",{style:{display:"flex",justifyContent:"center",paddingTop:100},className:"jsx-6fa0245e60aa494b",children:(0,t.jsx)(p.Z,{size:"large"})}):0===Y.length?(0,t.jsx)(h.Z,{image:h.Z.PRESENTED_IMAGE_SIMPLE,description:(0,t.jsx)(O,{style:{color:"#64748b",fontSize:18},children:"ไม่มีออเดอร์ในครัวขณะนี้"}),style:{marginTop:100}}):(0,t.jsx)(u.Z,{gutter:[20,20],children:Y.map(e=>{let a=A(e.created_at),s=3===a.level;return(0,t.jsx)(m.Z,{xs:24,sm:12,lg:8,xl:6,children:(0,t.jsxs)("div",{style:D.card(a.color,s),className:"jsx-6fa0245e60aa494b",children:[(0,t.jsxs)("div",{style:{padding:"16px",background:s?"rgba(239, 68, 68, 0.1)":"transparent",borderBottom:"1px solid rgba(255,255,255,0.05)"},className:"jsx-6fa0245e60aa494b",children:[(0,t.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},className:"jsx-6fa0245e60aa494b",children:[(0,t.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"center"},className:"jsx-6fa0245e60aa494b",children:[(0,t.jsxs)("span",{style:{background:"#fff",color:"#0f172a",fontWeight:800,padding:"2px 8px",borderRadius:6,fontSize:16},className:"jsx-6fa0245e60aa494b",children:["#",e.order_no]}),e.table_name&&(0,t.jsxs)("span",{style:{color:"#94a3b8",fontSize:16,fontWeight:600},className:"jsx-6fa0245e60aa494b",children:["โต๊ะ ",e.table_name]})]}),(0,t.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:6,color:a.color},className:"jsx-6fa0245e60aa494b",children:[(0,t.jsx)(N.Z,{}),(0,t.jsx)("span",{style:{fontWeight:700,fontSize:14},className:"jsx-6fa0245e60aa494b",children:E()(e.created_at).fromNow(!0)})]})]}),(0,t.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},className:"jsx-6fa0245e60aa494b",children:[(0,t.jsx)(b.Z,{color:s?"red":"blue",style:{margin:0,border:"none"},children:e.order_type}),s&&(0,t.jsx)("span",{style:{color:"#ef4444",fontWeight:700,fontSize:12,textTransform:"uppercase",letterSpacing:1},className:"jsx-6fa0245e60aa494b",children:"LATE"})]})]}),(0,t.jsx)("div",{style:{flex:1,padding:16,overflowY:"auto",maxHeight:"50vh"},className:"jsx-6fa0245e60aa494b",children:e.items.map(e=>{var a;return(0,t.jsxs)("div",{style:D.itemRow(e.status),className:"jsx-6fa0245e60aa494b",children:[(0,t.jsx)("div",{style:{flex:1},className:"jsx-6fa0245e60aa494b",children:(0,t.jsxs)("div",{style:{display:"flex",gap:12},className:"jsx-6fa0245e60aa494b",children:[(0,t.jsx)("span",{style:{fontSize:18,fontWeight:800,color:"#f8fafc",minWidth:32},className:"jsx-6fa0245e60aa494b",children:e.quantity}),(0,t.jsxs)("div",{style:{flex:1},className:"jsx-6fa0245e60aa494b",children:[(0,t.jsx)("div",{style:{fontSize:16,fontWeight:600,color:"#f1f5f9",lineHeight:1.4},className:"jsx-6fa0245e60aa494b",children:null===(a=e.product)||void 0===a?void 0:a.display_name}),e.notes&&(0,t.jsxs)("div",{style:{marginTop:8,background:"#f59e0b",color:"#000",padding:"4px 8px",borderRadius:6,fontWeight:600,fontSize:13,display:"inline-block"},className:"jsx-6fa0245e60aa494b",children:["⚠️ ",e.notes]}),(0,t.jsxs)("div",{style:{marginTop:6,fontSize:12,color:"#94a3b8"},className:"jsx-6fa0245e60aa494b",children:[e.status===I.M.Cooking&&"กำลังปรุง...",e.status===I.M.Pending&&"รอคิว"]})]})]})}),(0,t.jsxs)("div",{style:{marginLeft:8},className:"jsx-6fa0245e60aa494b",children:[e.status===I.M.Pending&&(0,t.jsx)(f.ZP,{type:"text",icon:(0,t.jsx)(S.Z,{style:{fontSize:18}}),onClick:()=>G(e.id,I.M.Cooking),style:{color:"#f59e0b",background:"rgba(245, 158, 11, 0.1)",width:44,height:44,borderRadius:12}}),e.status===I.M.Cooking&&(0,t.jsx)(f.ZP,{type:"text",icon:(0,t.jsx)(_.Z,{style:{fontSize:20}}),onClick:()=>G(e.id,I.M.Served),style:{color:"#10b981",background:"rgba(16, 185, 129, 0.2)",width:44,height:44,borderRadius:12,border:"1px solid rgba(16, 185, 129, 0.3)"}})]})]},e.id)})}),(0,t.jsx)("div",{style:{padding:16,borderTop:"1px solid rgba(255,255,255,0.05)"},className:"jsx-6fa0245e60aa494b",children:(0,t.jsx)(f.ZP,{block:!0,type:"primary",size:"large",icon:(0,t.jsx)(C.Z,{}),onClick:()=>J(e.order_id),style:{background:"#10b981",borderColor:"#10b981",borderRadius:12,height:48,fontWeight:700,fontSize:16},children:"เสิร์ฟทั้งหมด"})})]})},e.order_id)})})]})}}},function(e){e.O(0,[8024,4736,8592,1744],function(){return e(e.s=85226)}),_N_E=e.O()}]);