(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3358],{62761:function(e,t,r){Promise.resolve().then(r.bind(r,64922))},64922:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return L}});var a=r(57437),n=r(2265),o=r(39486),i=r(51653),s=r(19878),l=r(34029),d=r(53743),c=r(50742),g=r(48651),u=r(47451),p=r(69410),h=r(96931),x=r(88589),y=r(80336),m=r(99376),f=r(25193),b=r(37410),j=r(20148),v=r(71891),F=r(8900),w=r(26349),k=r(88009),S=r(15424),C=r(78355),_=r(29271),Z=r(97235),E=r(67918),B=r(2938),I=r(33417);let{Title:R,Text:z}=o.default,T=e=>{if(!e)return"-";let t=new Date(e);return Number.isNaN(t.getTime())?"-":new Intl.DateTimeFormat("th-TH",{dateStyle:"medium",timeStyle:"short"}).format(t)},P=e=>{let{displayName:t,categoryName:r,isActive:n}=e;return(0,a.jsxs)("div",{style:{background:"white",borderRadius:20,padding:20,boxShadow:"0 10px 30px rgba(0,0,0,0.05)",border:"1px solid #F1F5F9"},children:[(0,a.jsx)(R,{level:5,style:{color:"#0f766e",marginBottom:16,fontWeight:700},children:"ตัวอย่างการแสดงผล"}),(0,a.jsxs)("div",{style:{borderRadius:16,border:"1px solid ".concat(n?"#bae6fd":"#e2e8f0"),padding:14,background:n?"#f0fdfa":"#f8fafc",display:"flex",alignItems:"center",gap:12,marginBottom:16},children:[(0,a.jsx)("div",{style:{width:48,height:48,borderRadius:12,background:n?"linear-gradient(135deg, #ccfbf1 0%, #99f6e4 100%)":"#e2e8f0",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:(0,a.jsx)(v.Z,{style:{fontSize:20,color:n?"#0f766e":"#64748b"}})}),(0,a.jsxs)("div",{style:{textAlign:"left",flex:1},children:[(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,a.jsx)(z,{strong:!0,style:{fontSize:16,color:"#0f172a"},children:t||"ชื่อหมวดหมู่"}),n&&(0,a.jsx)(F.Z,{style:{color:"#10B981",fontSize:14}})]}),(0,a.jsx)(z,{type:"secondary",style:{fontSize:13,display:"block"},children:r||"category_name"})]})]}),(0,a.jsx)(i.Z,{type:n?"success":"warning",showIcon:!0,message:n?"หมวดหมู่นี้พร้อมใช้งานในหน้า POS":"หมวดหมู่นี้จะไม่แสดงในหน้า POS"})]})};function L(e){var t,r;let{params:o}=e,v=(0,m.useRouter)(),[F]=s.Z.useForm(),[L,A]=(0,n.useState)(!1),[N,O]=(0,n.useState)(!1),[W,D]=(0,n.useState)(""),[M,U]=(0,n.useState)(""),[H,q]=(0,n.useState)(!0),[V,X]=(0,n.useState)(""),[Y,J]=(0,n.useState)(null),$=null===(t=o.mode)||void 0===t?void 0:t[0],G=(null===(r=o.mode)||void 0===r?void 0:r[1])||null,K="add"===$||"edit"===$,Q="edit"===$&&!!G,{isAuthorized:ee,isChecking:et}=(0,E.e)({allowedRoles:["Admin","Manager"]}),er=(0,n.useMemo)(()=>Q?"แก้ไขหมวดหมู่":"เพิ่มหมวดหมู่",[Q]);(0,n.useEffect)(()=>{K&&("edit"!==$||G)||(l.ZP.warning("รูปแบบ URL ไม่ถูกต้อง"),v.replace("/pos/category"))},[K,$,G,v]),(0,n.useEffect)(()=>{(async()=>{X(await (0,Z.P)())})()},[]);let ea=(0,n.useCallback)(async()=>{if(G){A(!0);try{let e=await fetch("/api/pos/category/getById/".concat(G));if(!e.ok)throw Error("ไม่สามารถดึงข้อมูลหมวดหมู่ได้");let t=await e.json();F.setFieldsValue({category_name:t.category_name,display_name:t.display_name,is_active:t.is_active}),D(t.display_name||""),U(t.category_name||""),q(t.is_active),J(t)}catch(e){console.error(e),l.ZP.error("ไม่สามารถดึงข้อมูลหมวดหมู่ได้"),v.replace("/pos/category")}finally{A(!1)}}},[G,F,v]);(0,n.useEffect)(()=>{Q&&ea()},[Q,ea]);let en=(0,n.useCallback)(async e=>{var t;let r=e.trim();if(!r||Q&&(null==Y?void 0:null===(t=Y.category_name)||void 0===t?void 0:t.toLowerCase())===r.toLowerCase())return!1;try{let e=await fetch("/api/pos/category/getByName/".concat(encodeURIComponent(r)));if(!e.ok)return!1;let t=await e.json();if(!(null==t?void 0:t.id)||Q&&t.id===G)return!1;return!0}catch(e){return!1}},[G,Q,Y]),eo=async e=>{O(!0);try{let t={category_name:e.category_name.trim(),display_name:e.display_name.trim(),is_active:e.is_active},r=Q?"/api/pos/category/update/".concat(G):"/api/pos/category/create",a=Q?"PUT":"POST",n=await fetch(r,{method:a,headers:{"Content-Type":"application/json","X-CSRF-Token":V},body:JSON.stringify(t)});if(!n.ok){let e=await n.json().catch(()=>({}));throw Error(e.error||e.message||(Q?"ไม่สามารถอัปเดตหมวดหมู่ได้":"ไม่สามารถสร้างหมวดหมู่ได้"))}l.ZP.success(Q?"อัปเดตหมวดหมู่สำเร็จ":"สร้างหมวดหมู่สำเร็จ"),v.push("/pos/category")}catch(e){console.error(e),l.ZP.error(e.message)}finally{O(!1)}},ei=()=>v.push("/pos/category");return et?(0,a.jsx)(B.H,{message:"กำลังตรวจสอบสิทธิ์..."}):ee?(0,a.jsxs)("div",{className:"manage-page",style:I.R.container,children:[(0,a.jsx)(j.Z,{title:er,subtitle:Q?"ปรับแก้ชื่อหมวดหมู่และสถานะการใช้งาน":"สร้างหมวดหมู่ใหม่ให้พร้อมใช้งานในระบบ POS",onBack:ei,actions:Q?(0,a.jsx)(c.ZP,{danger:!0,onClick:()=>{G&&d.Z.confirm({title:"ยืนยันการลบหมวดหมู่",content:'คุณต้องการลบหมวดหมู่ "'.concat(W||(null==Y?void 0:Y.display_name)||"-",'" หรือไม่?'),okText:"ลบ",okType:"danger",cancelText:"ยกเลิก",centered:!0,icon:(0,a.jsx)(w.Z,{style:{color:"#EF4444"}}),onOk:async()=>{try{if(!(await fetch("/api/pos/category/delete/".concat(G),{method:"DELETE",headers:{"X-CSRF-Token":V}})).ok)throw Error("ไม่สามารถลบหมวดหมู่ได้");l.ZP.success("ลบหมวดหมู่สำเร็จ"),v.push("/pos/category")}catch(e){console.error(e),l.ZP.error("ไม่สามารถลบหมวดหมู่ได้")}}})},icon:(0,a.jsx)(w.Z,{}),children:"ลบ"}):null}),(0,a.jsx)(f.Z,{maxWidth:1040,children:(0,a.jsx)(b.Z,{style:{background:"transparent",border:"none"},children:L?(0,a.jsx)("div",{style:{display:"flex",justifyContent:"center",padding:"90px 0"},children:(0,a.jsx)(g.Z,{size:"large",tip:"กำลังโหลดข้อมูล..."})}):(0,a.jsxs)(u.Z,{gutter:[20,20],children:[(0,a.jsx)(p.Z,{xs:24,lg:15,children:(0,a.jsxs)(h.Z,{bordered:!1,style:{borderRadius:20,boxShadow:"0 4px 20px rgba(0,0,0,0.04)",overflow:"hidden"},styles:{body:{padding:24}},children:[(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:10,marginBottom:20},children:[(0,a.jsx)(k.Z,{style:{fontSize:20,color:"#0f766e"}}),(0,a.jsx)(R,{level:5,style:{margin:0},children:"ข้อมูลหมวดหมู่"})]}),(0,a.jsxs)(s.Z,{form:F,layout:"vertical",onFinish:eo,requiredMark:!1,autoComplete:"off",initialValues:{is_active:!0},onValuesChange:e=>{void 0!==e.display_name&&D(e.display_name),void 0!==e.category_name&&U(e.category_name),void 0!==e.is_active&&q(e.is_active)},children:[(0,a.jsx)(s.Z.Item,{name:"category_name",label:(0,a.jsx)("span",{style:{fontWeight:600,color:"#334155"},children:"ชื่อระบบ (category_name)"}),validateTrigger:["onBlur","onSubmit"],rules:[{required:!0,message:"กรุณากรอกชื่อระบบ"},{pattern:/^[a-zA-Z0-9\s\-_().]*$/,message:"กรอกได้เฉพาะภาษาอังกฤษ ตัวเลข และ - _ ( ) ."},{max:100,message:"ความยาวต้องไม่เกิน 100 ตัวอักษร"},{validator:async(e,t)=>{if((null==t?void 0:t.trim())&&await en(t))throw Error("ชื่อระบบนี้ถูกใช้งานแล้ว")}}],children:(0,a.jsx)(x.default,{size:"large",placeholder:"เช่น beverage, main-course",style:{borderRadius:12,height:46,backgroundColor:"#F8FAFC",border:"1px solid #E2E8F0"},maxLength:100})}),(0,a.jsx)(s.Z.Item,{name:"display_name",label:(0,a.jsx)("span",{style:{fontWeight:600,color:"#334155"},children:"ชื่อที่แสดง"}),rules:[{required:!0,message:"กรุณากรอกชื่อที่แสดง"},{max:100,message:"ความยาวต้องไม่เกิน 100 ตัวอักษร"}],children:(0,a.jsx)(x.default,{size:"large",placeholder:"เช่น เครื่องดื่ม, อาหารจานหลัก",style:{borderRadius:12,height:46,backgroundColor:"#F8FAFC",border:"1px solid #E2E8F0"},maxLength:100})}),(0,a.jsx)("div",{style:{padding:"16px",background:"#F8FAFC",borderRadius:14,marginTop:16,marginBottom:18},children:(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:12},children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(z,{strong:!0,style:{fontSize:15,display:"block"},children:"สถานะการใช้งาน"}),(0,a.jsx)(z,{type:"secondary",style:{fontSize:13},children:"เปิดเพื่อให้แสดงในหน้าขายสินค้า POS"})]}),(0,a.jsx)(s.Z.Item,{name:"is_active",valuePropName:"checked",noStyle:!0,children:(0,a.jsx)(y.Z,{style:{background:H?"#10B981":void 0}})})]})}),(0,a.jsx)(i.Z,{showIcon:!0,type:"info",icon:(0,a.jsx)(S.Z,{}),message:"ข้อมูลที่จำเป็น",description:"ต้องกรอกชื่อระบบและชื่อที่แสดง โดยชื่อระบบจะถูกตรวจสอบไม่ให้ซ้ำในสาขาเดียวกัน",style:{marginBottom:24}}),(0,a.jsxs)("div",{style:{marginTop:12,display:"flex",gap:12},children:[(0,a.jsx)(c.ZP,{size:"large",onClick:ei,style:{flex:1,borderRadius:12,height:46,fontWeight:600},children:"ยกเลิก"}),(0,a.jsx)(c.ZP,{type:"primary",htmlType:"submit",loading:N,icon:(0,a.jsx)(C.Z,{}),style:{flex:2,borderRadius:12,height:46,fontWeight:600,background:"#0f766e",boxShadow:"0 4px 12px rgba(15, 118, 110, 0.25)"},children:"บันทึกข้อมูล"})]})]})]})}),(0,a.jsx)(p.Z,{xs:24,lg:9,children:(0,a.jsxs)("div",{style:{display:"grid",gap:14},children:[(0,a.jsx)(P,{displayName:W,categoryName:M,isActive:H}),Q?(0,a.jsxs)(h.Z,{style:{borderRadius:16},children:[(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:10},children:[(0,a.jsx)(_.Z,{style:{color:"#0369a1"}}),(0,a.jsx)(z,{strong:!0,children:"รายละเอียดรายการ"})]}),(0,a.jsxs)("div",{style:{display:"grid",gap:8},children:[(0,a.jsxs)(z,{type:"secondary",children:["ID: ",(null==Y?void 0:Y.id)||"-"]}),(0,a.jsxs)(z,{type:"secondary",children:["สร้างเมื่อ: ",T(null==Y?void 0:Y.create_date)]}),(0,a.jsxs)(z,{type:"secondary",children:["อัปเดตเมื่อ: ",T(null==Y?void 0:Y.update_date)]})]})]}):null]})})]})})})]}):(0,a.jsx)(B.H,{message:"คุณไม่มีสิทธิ์เข้าถึงหน้านี้",tone:"danger"})}},33417:function(e,t,r){"use strict";r.d(t,{R:function(){return n},W:function(){return o}});var a=r(69397);let n={...(0,a.yf)("linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%)"),categoryCard:a.YO,categoryCardInner:a.lv},o=(0,a.IU)(".category-page",".category-card")},69397:function(e,t,r){"use strict";r.d(t,{IU:function(){return l},YO:function(){return i},lv:function(){return s},yf:function(){return o}});let a={colors:{primary:"#6366F1",primaryLight:"#EEF2FF",success:"#10B981",successLight:"#ECFDF5",warning:"#F59E0B",warningLight:"#FFFBEB",error:"#EF4444",errorLight:"#FEF2F2",info:"#3B82F6",infoLight:"#EFF6FF",bg:"#F8FAFC",card:"#FFFFFF",border:"#E2E8F0",borderLight:"#F1F5F9",text:"#1E293B",textSecondary:"#64748B",textMuted:"#94A3B8"},radius:{sm:8,md:12,lg:16,xl:20},shadow:{sm:"0 1px 2px rgba(0, 0, 0, 0.04)",md:"0 4px 12px rgba(0, 0, 0, 0.06)",lg:"0 8px 24px rgba(0, 0, 0, 0.08)"}},n={container:{paddingBottom:100,backgroundColor:a.colors.bg,minHeight:"100dvh",width:"100%",overflowX:"hidden"},header:{background:"linear-gradient(135deg, ".concat(a.colors.primary," 0%, #4F46E5 100%)"),padding:"16px 16px 48px 16px",position:"relative",overflow:"hidden",borderBottomLeftRadius:a.radius.xl,borderBottomRightRadius:a.radius.xl},headerDecoCircle1:{position:"absolute",top:-40,right:-40,width:120,height:120,borderRadius:"50%",background:"rgba(255,255,255,0.08)"},headerDecoCircle2:{position:"absolute",bottom:-20,left:-20,width:80,height:80,borderRadius:"50%",background:"rgba(255,255,255,0.06)"},headerContent:{position:"relative",zIndex:1,display:"flex",alignItems:"center",justifyContent:"space-between",gap:12},headerLeft:{display:"flex",alignItems:"center",gap:12,flex:1},headerIconBox:{width:44,height:44,borderRadius:a.radius.md,background:"rgba(255,255,255,0.15)",display:"flex",alignItems:"center",justifyContent:"center",backdropFilter:"blur(8px)",flexShrink:0},headerTitle:{color:"#fff",margin:0,fontSize:18,fontWeight:600},headerSubtitle:{color:"rgba(255,255,255,0.8)",fontSize:13,margin:0},headerActions:{display:"flex",gap:8,flexShrink:0},statsCard:{margin:"-32px 16px 0 16px",padding:16,background:a.colors.card,borderRadius:a.radius.lg,boxShadow:a.shadow.md,display:"flex",justifyContent:"space-around",position:"relative",zIndex:10},statItem:{textAlign:"center",flex:1},statNumber:{fontSize:22,fontWeight:700,display:"block",color:a.colors.text},statLabel:{fontSize:12,color:a.colors.textMuted,marginTop:2},listContainer:{padding:"16px 16px 0 16px"},sectionTitle:{display:"flex",alignItems:"center",gap:8,marginBottom:12,fontSize:15,fontWeight:600,color:a.colors.text}},o=e=>({...n,header:{...n.header,background:e}}),i=e=>({marginBottom:12,borderRadius:a.radius.lg,border:"1px solid ".concat(e?a.colors.border:a.colors.borderLight),boxShadow:e?a.shadow.sm:"none",overflow:"hidden",transition:"all 0.2s ease",background:a.colors.card,opacity:e?1:.6}),s={padding:16,display:"flex",alignItems:"center",gap:12};a.radius.md;let l=(e,t)=>"\n  /* Card animations */\n  ".concat(t," {\n    animation: fadeSlideIn 0.3s ease both;\n  }\n  \n  ").concat(t,":hover {\n    transform: translateY(-2px);\n    box-shadow: ").concat(a.shadow.md," !important;\n  }\n  \n  ").concat(t,":active {\n    transform: scale(0.99);\n  }\n  \n  /* Scrollbar */\n  ").concat(e," *::-webkit-scrollbar {\n    width: 5px;\n    height: 5px;\n  }\n  ").concat(e," *::-webkit-scrollbar-track {\n    background: transparent;\n  }\n  ").concat(e," *::-webkit-scrollbar-thumb {\n    background: #CBD5E1;\n    border-radius: 3px;\n  }\n  ").concat(e," *::-webkit-scrollbar-thumb:hover {\n    background: #94A3B8;\n  }\n")}},function(e){e.O(0,[253,1522,3418,742,9486,4252,3916,8651,6931,4159,3831,2224,3248,8879,8589,4221,9878,115,6930,9385,4390,2971,2117,1744],function(){return e(e.s=62761)}),_N_E=e.O()}]);