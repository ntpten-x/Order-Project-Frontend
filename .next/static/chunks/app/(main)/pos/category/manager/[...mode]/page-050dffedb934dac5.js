(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3358],{62761:function(e,a,t){Promise.resolve().then(t.bind(t,46353))},46353:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return E}});var s=t(57437),r=t(2265),n=t(44967),o=t(34029),i=t(53743),l=t(48651),c=t(88589),d=t(80336),g=t(99376),u=t(82646),y=t(71891),m=t(72175);let{Text:h}=u.default,{pageStyles:f,ManagePageStyles:p}=(0,m.dg)({focusColor:"#722ed1",focusShadow:"rgba(114, 46, 209, 0.1)",switchGradient:"linear-gradient(135deg, #52c41a 0%, #389e0d 100%)"}),x=e=>{let{isEdit:a,onBack:t,onDelete:r}=e;return(0,s.jsx)(m.oI,{pageStyles:f,isEdit:a,onBack:t,onDelete:r,titleCreate:"เพิ่มหมวดหมู่",titleEdit:"แก้ไขหมวดหมู่"})},j=e=>{let{displayName:a,categoryName:t}=e;return(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:14,padding:16,background:"#fafafa",borderRadius:16,marginTop:12},children:[(0,s.jsx)("div",{style:{width:60,height:60,borderRadius:14,background:"linear-gradient(135deg, #f9f0ff 0%, #efdbff 100%)",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:(0,s.jsx)(y.Z,{style:{fontSize:24,color:"#722ed1"}})}),(0,s.jsxs)("div",{children:[(0,s.jsx)(h,{strong:!0,style:{display:"block",marginBottom:4},children:a||"ชื่อที่แสดง"}),(0,s.jsx)(h,{type:"secondary",style:{fontSize:12},children:t||"ชื่อหมวดหมู่ (EN)"})]})]})},k=e=>{let{isEdit:a,loading:t,onCancel:r}=e;return(0,s.jsx)(m.uM,{pageStyles:f,isEdit:a,loading:t,onCancel:r})};var _=t(97235),C=t(3286),v=t(2938);function E(e){let{params:a}=e,t=(0,g.useRouter)(),[u]=n.Z.useForm(),[y,m]=(0,r.useState)(!1),[h,E]=(0,r.useState)(!1),[S,w]=(0,r.useState)(""),[b,Z]=(0,r.useState)(""),[T,N]=(0,r.useState)(""),P=a.mode[0],F=a.mode[1]||null,I="edit"===P&&!!F,{isAuthorized:R,isChecking:z}=(0,C.e)({requiredRole:"Admin"});(0,r.useEffect)(()=>{(async()=>{N(await (0,_.P)())})()},[]);let O=(0,r.useCallback)(async()=>{m(!0);try{let e=await fetch("/api/pos/category/getById/".concat(F));if(!e.ok)throw Error("ไม่สามารถดึงข้อมูลหมวดหมู่ได้");let a=await e.json();u.setFieldsValue({category_name:a.category_name,display_name:a.display_name,is_active:a.is_active}),w(a.display_name||""),Z(a.category_name||"")}catch(e){console.error(e),o.ZP.error("ไม่สามารถดึงข้อมูลหมวดหมู่ได้"),t.push("/pos/category")}finally{m(!1)}},[F,u,t]);(0,r.useEffect)(()=>{I&&O()},[I,F,O]);let B=async e=>{E(!0);try{if(I){let a=await fetch("/api/pos/category/update/".concat(F),{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-Token":T},body:JSON.stringify(e)});if(!a.ok){let e=await a.json().catch(()=>({}));throw Error(e.error||e.message||"ไม่สามารถอัปเดตหมวดหมู่ได้")}o.ZP.success("อัปเดตหมวดหมู่สำเร็จ")}else{let a=await fetch("/api/pos/category/create",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":T},body:JSON.stringify(e)});if(!a.ok){let e=await a.json().catch(()=>({}));throw Error(e.error||e.message||"ไม่สามารถสร้างหมวดหมู่ได้")}o.ZP.success("สร้างหมวดหมู่สำเร็จ")}t.push("/pos/category")}catch(e){console.error(e),o.ZP.error(e.message||(I?"ไม่สามารถอัปเดตหมวดหมู่ได้":"ไม่สามารถสร้างหมวดหมู่ได้"))}finally{E(!1)}},q=()=>t.push("/pos/category");return z?(0,s.jsx)(v.H,{message:"กำลังตรวจสอบสิทธิ์..."}):R?(0,s.jsxs)("div",{className:"manage-page",style:f.container,children:[(0,s.jsx)(p,{}),(0,s.jsx)(x,{isEdit:I,onBack:q,onDelete:I?()=>{F&&i.Z.confirm({title:"ยืนยันการลบหมวดหมู่",content:'คุณต้องการลบหมวดหมู่ "'.concat(S,'" หรือไม่?'),okText:"ลบ",okType:"danger",cancelText:"ยกเลิก",centered:!0,onOk:async()=>{try{if(!(await fetch("/api/pos/category/delete/".concat(F),{method:"DELETE",headers:{"X-CSRF-Token":T}})).ok)throw Error("ไม่สามารถลบหมวดหมู่ได้");o.ZP.success("ลบหมวดหมู่สำเร็จ"),t.push("/pos/category")}catch(e){console.error(e),o.ZP.error("ไม่สามารถลบหมวดหมู่ได้")}}})}:void 0}),(0,s.jsx)("div",{className:"manage-form-card",style:f.formCard,children:y?(0,s.jsx)("div",{style:{display:"flex",justifyContent:"center",padding:"60px 0"},children:(0,s.jsx)(l.Z,{size:"large"})}):(0,s.jsxs)(n.Z,{form:u,layout:"vertical",onFinish:B,requiredMark:!1,autoComplete:"off",initialValues:{is_active:!0},onValuesChange:e=>{void 0!==e.display_name&&w(e.display_name),void 0!==e.category_name&&Z(e.category_name)},children:[(0,s.jsx)(n.Z.Item,{name:"category_name",label:"ชื่อหมวดหมู่ (ภาษาอังกฤษ) *",rules:[{required:!0,message:"กรุณากรอกชื่อหมวดหมู่"},{pattern:/^[a-zA-Z0-9\s\-_().]*$/,message:"กรุณากรอกภาษาอังกฤษเท่านั้น"},{max:100,message:"ความยาวต้องไม่เกิน 100 ตัวอักษร"}],children:(0,s.jsx)(c.default,{size:"large",placeholder:"เช่น Beverage, Food, Snack",maxLength:100})}),(0,s.jsx)(n.Z.Item,{name:"display_name",label:"ชื่อที่แสดง (ภาษาไทย) *",rules:[{required:!0,message:"กรุณากรอกชื่อที่แสดง"},{max:100,message:"ความยาวต้องไม่เกิน 100 ตัวอักษร"}],children:(0,s.jsx)(c.default,{size:"large",placeholder:"เช่น เครื่องดื่ม, อาหาร, ขนม",maxLength:100})}),(0,s.jsx)(j,{displayName:S,categoryName:b}),(0,s.jsx)(n.Z.Item,{name:"is_active",label:"สถานะการใช้งาน",valuePropName:"checked",style:{marginTop:20},children:(0,s.jsx)(d.Z,{checkedChildren:"ใช้งาน",unCheckedChildren:"ไม่ใช้งาน"})}),(0,s.jsx)(k,{isEdit:I,loading:h,onCancel:q})]})})]}):(0,s.jsx)(v.H,{message:"คุณไม่มีสิทธิ์เข้าถึงหน้านี้",tone:"danger"})}}},function(e){e.O(0,[5015,7717,7698,742,3211,7993,8651,2646,6207,7213,9021,2224,3248,5616,8589,4967,5775,5514,4243,2971,2117,1744],function(){return e(e.s=62761)}),_N_E=e.O()}]);