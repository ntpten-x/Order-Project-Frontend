(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4049],{59968:function(e,t,i){Promise.resolve().then(i.bind(i,75676))},75676:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return H}});var a=i(57437),s=i(2265),l=i(60283),n=i(80009),r=i(66487),o=i(50742),c=i(53743),d=i(34029),g=i(24783),h=i(88589),p=i(24738),y=i(71891),f=i(13377),u=i(26349),x=i(62376),j=i(89245),m=i(96473),v=i(29436),b=i(99376),k=i(3369),Z=i(26972),w=i(24675),C=i(97235),_=i(67918),S=i(67697),E=i(73814),P=i(33417),T=i(2938),R=i(25193),z=i(37410),A=i(27623),N=i(20148),I=i(2786),W=i(12028);let{Text:D}=l.default,F=e=>{let{totalCategories:t,activeCategories:i,inactiveCategories:s}=e;return(0,a.jsxs)("div",{style:{background:"#fff",borderRadius:16,border:"1px solid #e2e8f0",display:"grid",gridTemplateColumns:"repeat(3, minmax(0, 1fr))",gap:8,padding:14},children:[(0,a.jsxs)("div",{style:{textAlign:"center"},children:[(0,a.jsx)("span",{style:{fontSize:24,fontWeight:700,color:"#0f172a",display:"block"},children:t}),(0,a.jsx)(D,{style:{fontSize:12,color:"#64748b"},children:"ทั้งหมด"})]}),(0,a.jsxs)("div",{style:{textAlign:"center"},children:[(0,a.jsx)("span",{style:{fontSize:24,fontWeight:700,color:"#0f766e",display:"block"},children:i}),(0,a.jsx)(D,{style:{fontSize:12,color:"#64748b"},children:"ใช้งาน"})]}),(0,a.jsxs)("div",{style:{textAlign:"center"},children:[(0,a.jsx)("span",{style:{fontSize:24,fontWeight:700,color:"#b91c1c",display:"block"},children:s}),(0,a.jsx)(D,{style:{fontSize:12,color:"#64748b"},children:"ปิดใช้งาน"})]})]})},L=e=>{let t=new Date(e);return Number.isNaN(t.getTime())?"-":new Intl.DateTimeFormat("th-TH",{dateStyle:"medium",timeStyle:"short"}).format(t)},O=e=>{let{category:t,onEdit:i,onDelete:s,onToggleActive:l,updatingStatusId:c}=e;return(0,a.jsx)("div",{className:"category-card",style:{...P.R.categoryCard(t.is_active),borderRadius:16},onClick:()=>i(t),children:(0,a.jsxs)("div",{style:P.R.categoryCardInner,children:[(0,a.jsx)("div",{style:{width:52,height:52,borderRadius:14,background:t.is_active?"linear-gradient(135deg, #ccfbf1 0%, #99f6e4 100%)":"#f1f5f9",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,boxShadow:t.is_active?"0 4px 10px rgba(15, 118, 110, 0.18)":"none"},children:(0,a.jsx)(y.Z,{style:{fontSize:22,color:t.is_active?"#0f766e":"#94a3b8"}})}),(0,a.jsxs)("div",{style:{flex:1,minWidth:0,paddingRight:8},children:[(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4},children:[(0,a.jsx)(D,{strong:!0,style:{fontSize:16,color:"#0f172a"},ellipsis:{tooltip:t.display_name},children:t.display_name}),(0,a.jsx)(n.Z,{color:t.is_active?"green":"default",children:t.is_active?"ใช้งาน":"ปิดใช้งาน"})]}),(0,a.jsx)(D,{type:"secondary",style:{fontSize:13,display:"block",color:"#334155"},ellipsis:{tooltip:t.category_name},children:t.category_name}),(0,a.jsxs)(D,{type:"secondary",style:{fontSize:12,display:"block",marginTop:4},children:["อัปเดตล่าสุด ",L(t.update_date)]})]}),(0,a.jsxs)("div",{style:{display:"flex",gap:6,alignItems:"center"},children:[(0,a.jsx)(r.Z,{size:"small",checked:t.is_active,loading:c===t.id,onClick:(e,i)=>{null==i||i.stopPropagation(),l(t,e)}}),(0,a.jsx)(o.ZP,{type:"text",icon:(0,a.jsx)(f.Z,{}),onClick:e=>{e.stopPropagation(),i(t)},style:{borderRadius:10,color:"#0369a1",background:"#e0f2fe",width:36,height:36}}),(0,a.jsx)(o.ZP,{type:"text",danger:!0,icon:(0,a.jsx)(u.Z,{}),onClick:e=>{e.stopPropagation(),s(t)},style:{borderRadius:10,background:"#fef2f2",width:36,height:36}})]})]})})};function H(){let e=(0,b.useRouter)(),[t,i]=(0,s.useState)([]),[l,n]=(0,s.useState)(""),[r,f]=(0,s.useState)("all"),[D,L]=(0,s.useState)(null),{execute:H}=(0,Z.J)(),{showLoading:B}=(0,k.x)(),{socket:J}=(0,w.s)(),{isAuthorized:M,isChecking:X}=(0,_.e)({allowedRoles:["Admin","Manager"]});(0,s.useEffect)(()=>{(0,C.P)()},[]),(0,s.useEffect)(()=>{let e=(0,E.t)("pos:categories",3e5);e&&e.length>0&&i(e)},[]);let U=(0,s.useCallback)(async()=>{H(async()=>{let e=await fetch("/api/pos/category");if(!e.ok){let t=await e.json().catch(()=>({}));throw Error(t.error||t.message||"ไม่สามารถดึงข้อมูลหมวดหมู่ได้")}let t=await e.json(),a=Array.isArray(t)?t:null==t?void 0:t.data;if(!Array.isArray(a))throw Error("รูปแบบข้อมูลไม่ถูกต้อง");i(a)},"กำลังโหลดข้อมูลหมวดหมู่...")},[H]);(0,s.useEffect)(()=>{M&&U()},[M,U]),(0,S.v)(J,{create:W.b.categories.create,update:W.b.categories.update,delete:W.b.categories.delete},i);let q=(0,s.useMemo)(()=>{let e=t;"active"===r?e=e.filter(e=>e.is_active):"inactive"===r&&(e=e.filter(e=>!e.is_active));let i=l.trim().toLowerCase();return i&&(e=e.filter(e=>e.display_name.toLowerCase().includes(i)||e.category_name.toLowerCase().includes(i))),e},[t,l,r]);(0,s.useEffect)(()=>{t.length>0&&(0,E.v)("pos:categories",t)},[t]);let G=()=>{B("กำลังเปิดหน้าจัดการหมวดหมู่..."),e.push("/pos/category/manager/add")},K=t=>{B("กำลังเปิดหน้าแก้ไขหมวดหมู่..."),e.push("/pos/category/manager/edit/".concat(t.id))},Q=e=>{c.Z.confirm({title:"ยืนยันการลบหมวดหมู่",content:'คุณต้องการลบหมวดหมู่ "'.concat(e.display_name,'" หรือไม่?'),okText:"ลบ",okType:"danger",cancelText:"ยกเลิก",centered:!0,icon:(0,a.jsx)(u.Z,{style:{color:"#EF4444"}}),onOk:async()=>{await H(async()=>{let t=await (0,C.P)();if(!(await fetch("/api/pos/category/delete/".concat(e.id),{method:"DELETE",headers:{"X-CSRF-Token":t}})).ok)throw Error("ไม่สามารถลบหมวดหมู่ได้");i(t=>t.filter(t=>t.id!==e.id)),d.ZP.success('ลบหมวดหมู่ "'.concat(e.display_name,'" สำเร็จ'))},"กำลังลบหมวดหมู่...")}})},V=async(e,t)=>{L(e.id);try{let a=await (0,C.P)(),s=await fetch("/api/pos/category/update/".concat(e.id),{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-Token":a},body:JSON.stringify({is_active:t})});if(!s.ok){let e=await s.json().catch(()=>({}));throw Error(e.error||e.message||"ไม่สามารถเปลี่ยนสถานะหมวดหมู่ได้")}let l=await s.json();i(t=>t.map(t=>t.id===e.id?l:t)),d.ZP.success(t?"เปิดใช้งานหมวดหมู่แล้ว":"ปิดใช้งานหมวดหมู่แล้ว")}catch(e){console.error(e),d.ZP.error(e instanceof Error?e.message:"ไม่สามารถเปลี่ยนสถานะหมวดหมู่ได้")}finally{L(null)}};if(X)return(0,a.jsx)(T.H,{message:"กำลังตรวจสอบสิทธิ์การใช้งาน..."});if(!M)return(0,a.jsx)(T.H,{message:"คุณไม่มีสิทธิ์เข้าถึงหน้านี้ กำลังพากลับ...",tone:"danger"});let Y=t.filter(e=>e.is_active),$=t.filter(e=>!e.is_active);return(0,a.jsxs)("div",{className:"category-page",style:P.R.container,children:[(0,a.jsx)("style",{children:P.W}),(0,a.jsx)(N.Z,{title:"หมวดหมู่สินค้า",subtitle:"ทั้งหมด ".concat(t.length," รายการ"),icon:(0,a.jsx)(y.Z,{}),actions:(0,a.jsxs)(g.Z,{size:8,wrap:!0,children:[(0,a.jsx)(o.ZP,{icon:(0,a.jsx)(x.Z,{}),onClick:()=>e.push("/pos/products"),children:"ไปหน้าสินค้า"}),(0,a.jsx)(o.ZP,{icon:(0,a.jsx)(j.Z,{}),onClick:U}),(0,a.jsx)(o.ZP,{type:"primary",icon:(0,a.jsx)(m.Z,{}),onClick:G,children:"เพิ่มหมวดหมู่"})]})}),(0,a.jsx)(R.Z,{children:(0,a.jsxs)(A.Z,{children:[(0,a.jsx)(F,{totalCategories:t.length,activeCategories:Y.length,inactiveCategories:$.length}),(0,a.jsx)(z.Z,{title:"ค้นหาและตัวกรอง",children:(0,a.jsxs)("div",{style:{display:"grid",gap:10,gridTemplateColumns:"1fr",alignItems:"center"},children:[(0,a.jsx)(h.default,{prefix:(0,a.jsx)(v.Z,{style:{color:"#94A3B8"}}),allowClear:!0,placeholder:"ค้นหาจากชื่อแสดงหรือชื่อระบบ...",value:l,onChange:e=>n(e.target.value)}),(0,a.jsx)(p.Z,{options:[{label:"ทั้งหมด (".concat(t.length,")"),value:"all"},{label:"ใช้งาน (".concat(Y.length,")"),value:"active"},{label:"ปิดใช้งาน (".concat($.length,")"),value:"inactive"}],value:r,onChange:e=>f(e)})]})}),(0,a.jsx)(z.Z,{title:"รายการหมวดหมู่",extra:(0,a.jsx)("span",{style:{fontWeight:600},children:q.length}),children:q.length>0?q.map(e=>(0,a.jsx)(O,{category:e,onEdit:K,onDelete:Q,onToggleActive:V,updatingStatusId:D},e.id)):(0,a.jsx)(I.Z,{title:l.trim()?"ไม่พบหมวดหมู่ตามคำค้น":"ยังไม่มีหมวดหมู่",description:l.trim()?"ลองเปลี่ยนคำค้น หรือตัวกรองสถานะ":"เพิ่มหมวดหมู่แรกเพื่อเริ่มใช้งาน",action:l.trim()?null:(0,a.jsx)(o.ZP,{type:"primary",icon:(0,a.jsx)(m.Z,{}),onClick:G,children:"เพิ่มหมวดหมู่"})})})]})})]})}}},function(e){e.O(0,[8024,4736,8592,1744],function(){return e(e.s=59968)}),_N_E=e.O()}]);