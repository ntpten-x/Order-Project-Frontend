(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3368],{48492:function(e,t,a){Promise.resolve().then(a.bind(a,36699))},36699:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return ed}});var n=a(57437),r=a(29),i=a.n(r),s=a(2265),o=a(99376),l=a(39486),c=a(34029),d=a(85180),u=a(50742),m=a(80009),p=a(47451),y=a(69410),h=a(91652),f=a(96931),x=a(23496),g=a(51653),b=a(33477),j=a(53743),v=a(62670),w=a(86955),k=a(99458),_=a(17588),S=a(13377),N=a(59352),T=a(70464),C=a(62376),P=a(83669),E=a(55322),Z=a(13429),z=a(35398),O=a(14621),A=a.n(O),F=a(53286),B=a(63836),R=a(2913),G=a(71567),I=a(98170);let L=G.q.POS.DISCOUNTS,D=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"application/json",a={};return t&&(a["Content-Type"]=t),e&&(a.Cookie=e),a},q={getAll:async(e,t)=>{let a=(0,R.b)("GET",L),n=new URLSearchParams(t||"");n.toString()&&(a+="?".concat(n.toString()));let r=D(e,""),i=await fetch(a,{cache:"no-store",headers:r,credentials:"include"});if(!i.ok){let e=await i.json().catch(()=>({}));throw Error((0,I.i_)(e,"ไม่สามารถดึงข้อมูลส่วนลดได้"))}let s=await i.json();if(Array.isArray(s))return s;if((null==s?void 0:s.success)&&Array.isArray(s.data)||(null==s?void 0:s.data)&&Array.isArray(s.data))return s.data;if(s&&"object"==typeof s&&!Array.isArray(s)){if(s.success&&s.data&&"object"==typeof s.data&&!Array.isArray(s.data)&&s.data.id&&(s.data.discount_name||s.data.display_name))return[s.data];if(s.id&&(s.discount_name||s.display_name))return[s]}return[]}};var H=a(54528),M=a(66290),U=a(19135),X=a(97235),W=a(7806),J=a(32446),Q=a(34962),V=a(69477),$=a(94532),Y=a(45963),K=a(49747),ee=a(71096),et=a.n(ee);a(6729);var ea=a(61414),en=a(60300),er=a(3369),ei=a(24675),es=a(67697),eo=a(12028);let{Title:el,Text:ec}=l.default;function ed(){let e=(0,o.useRouter)(),t=(0,o.useParams)(),[a,r]=c.ZP.useMessage(),l=Array.isArray(null==t?void 0:t.paymentId)?t.paymentId[0]:null==t?void 0:t.paymentId,[O,R]=(0,s.useState)(null),[G,I]=(0,s.useState)(!0),[L,D]=(0,s.useState)([]),[ee,et]=(0,s.useState)([]),[ed,eu]=(0,s.useState)(null),[em,ep]=(0,s.useState)(!1),[ey,eh]=(0,s.useState)(null),[ef,ex]=(0,s.useState)(0),[eg,eb]=(0,s.useState)(null),[ej,ev]=(0,s.useState)(!1),{showLoading:ew,hideLoading:ek}=(0,er.x)(),{socket:e_}=(0,ei.s)(),[eS,eN]=(0,s.useState)({open:!1,type:"confirm",title:"",content:"",onOk:()=>{}}),eT=()=>eN(e=>({...e,open:!1})),eC=(0,s.useCallback)(async function(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(l)try{t||(I(!0),ew("กำลังโหลดข้อมูลการชำระเงิน..."));let a=await U.n.getProfile().catch(()=>null),[n,r,i]=await Promise.all([F.x.getById(l),B.E.getAll(),q.getAll()]);if([J.i.Paid,J.i.Cancelled].includes(n.status)){e.push("/pos/channels");return}R(n);let s=(r.data||[]).filter(e=>n.order_type===J.m.Delivery||"Delivery"!==e.payment_method_name);D(s);let o=[];if(Array.isArray(i))o=i;else if(i&&"object"==typeof i){if("id"in i&&("string"==typeof i.discount_name||"string"==typeof i.display_name))o=[i];else if(Array.isArray(i.data))o=i.data;else if(!0===i.success&&Array.isArray(i.data))o=i.data;else{let e;if(!0===i.success&&(e=i.data)&&"object"==typeof e){let e=i.data;"id"in e&&("string"==typeof e.discount_name||"string"==typeof e.display_name)&&(o=[e])}}}et(o),eu(a),n.discount&&eb(n.discount),n&&ex(Number(n.total_amount))}catch(e){t||a.error("ไม่สามารถโหลดข้อมูลการชำระเงินได้")}finally{t||(I(!1),ek())}},[a,l,e,ew,ek]),eP=(0,s.useMemo)(()=>{if(!ee||!Array.isArray(ee)||0===ee.length)return[];let e=ee.filter(e=>!!e&&(!0===e.is_active||void 0===e.is_active));return 0===e.length?[]:e.map(e=>{let t=e.display_name||e.discount_name;return t&&e.id?{label:"".concat(t," (").concat(e.discount_type===V.L.Percentage?"".concat(e.discount_amount,"%"):"-".concat(e.discount_amount,"฿"),")"),value:e.id}:null}).filter(e=>null!==e)},[ee]);(0,s.useEffect)(()=>{l&&eC(!1)},[eC,l]);let eE=!ej&&!eS.open;(0,es.D)({socket:e_,events:[eo.b.orders.update,eo.b.orders.delete,eo.b.payments.create,eo.b.payments.update,eo.b.paymentMethods.create,eo.b.paymentMethods.update,eo.b.discounts.create,eo.b.discounts.update,eo.b.discounts.delete,eo.b.shopProfile.update,eo.b.salesOrderItem.create,eo.b.salesOrderItem.update,eo.b.salesOrderItem.delete,eo.b.salesOrderDetail.create,eo.b.salesOrderDetail.update,eo.b.salesOrderDetail.delete],onRefresh:async()=>{l&&await eC(!0)},enabled:!!l&&eE,debounceMs:800}),(0,s.useEffect)(()=>{"scrollRestoration"in window.history&&(window.history.scrollRestoration="manual")},[]);let{subtotal:eZ,discount:ez,vat:eO,total:eA,change:eF}=(0,K.hs)(O,ef),eB=(0,s.useMemo)(()=>{if(!(null==O?void 0:O.items))return[];let e=O.items.filter(e=>e.status!==J.i.Cancelled);return(0,W.S)(e)},[null==O?void 0:O.items]),eR=async e=>{if(O)try{ew("กำลังอัปเดตส่วนลด...");let t=await (0,X.P)(),n=await F.x.update(O.id,{discount_id:e||null},void 0,t);if(R(n),e){let t=ee.find(t=>t.id===e);t&&(eb(t),a.success('ใช้ส่วนลด "'.concat(t.display_name,'" เรียบร้อย')))}else eb(null),a.info("ยกเลิกการใช้ส่วนลด");ex(Number(n.total_amount))}catch(e){a.error("ไม่สามารถบันทึกส่วนลดได้")}finally{ek()}},eG=async()=>{if(!ey){a.error("กรุณาเลือกวิธีการชำระเงิน");return}if(ef<eA){a.error("ยอดเงินที่รับต้องมากกว่าหรือเท่ากับยอดชำระ");return}let t=L.find(e=>e.id===ey),r=(null==t?void 0:t.display_name)||"ไม่ระบุ";eN({open:!0,type:"success",title:"ยืนยันการชำระเงิน",content:(0,n.jsxs)("div",{style:{textAlign:"center"},children:[(0,n.jsxs)("div",{style:{fontSize:16,marginBottom:8},children:["วิธีการชำระเงิน: ",(0,n.jsx)(ec,{strong:!0,children:r})]}),(0,n.jsxs)("div",{style:{fontSize:24,fontWeight:700,color:Y.QF.primary},children:["ยอดสุทธิ ",(0,ea.xG)(eA)]}),eF>0&&(0,n.jsxs)("div",{style:{color:Y.QF.success,fontSize:18,marginTop:4},children:["เงินทอน ",(0,ea.xG)(eF)]})]}),okText:"ยืนยัน",cancelText:"ยกเลิก",onOk:async()=>{try{ew("กำลังดำเนินการชำระเงิน..."),eT();let t=await (0,X.P)(),n={order_id:O.id,payment_method_id:ey,amount:eA,amount_received:ef,change_amount:eF,status:$.b.Success};await H.U.create(n,void 0,t),await F.x.updateStatus(O.id,J.i.Paid,t),O.table_id&&await M.$.update(O.table_id,{status:Q.c.Available},void 0,t),a.success("ชำระเงินเรียบร้อย"),e.push("/pos/dashboard/".concat(O.id))}catch(e){a.error("การชำระเงินล้มเหลว")}finally{ek()}}})},eI=async()=>{O&&eN({open:!0,type:"warning",title:"ย้อนกลับไปแก้ไขออเดอร์?",content:'สถานะออเดอร์จะถูกเปลี่ยนกลับเป็น "กำลังดำเนินการ" เพื่อให้คุณสามารถแก้ไขรายการอาหารได้ คุณแน่ใจหรือไม่?',okText:"ตกลง",cancelText:"ยกเลิก",onOk:async()=>{try{var t;ew("กำลังดำเนินการ..."),eT();let n=await (0,X.P)(),r=(null===(t=O.items)||void 0===t?void 0:t.filter(e=>e.status!==J.i.Cancelled))||[];await Promise.all(r.map(e=>F.x.updateItemStatus(e.id,J.i.Served,void 0,n))),await F.x.updateStatus(O.id,J.i.Pending,n),a.success("ย้อนกลับไปแก้ไขออเดอร์เรียบร้อย"),e.push((0,K.T_)(O.id))}catch(e){a.error("ไม่สามารถเปลี่ยนสถานะออเดอร์ได้")}finally{ek()}}})},eL=(e,t)=>(0,K.cc)(e,t)?(0,n.jsx)(v.Z,{}):(0,K.Od)(e,t)?(0,n.jsx)(w.Z,{}):(0,n.jsx)(k.Z,{}),eD=(e,t)=>(0,K.cc)(e,t)?"ชำระด้วยเงินสด":(0,K.Od)(e,t)?"สแกน QR Code":"ชำระด้วยบัตร";if(G&&!O)return null;if(!O)return(0,n.jsx)(d.Z,{description:"ไม่พบข้อมูลออเดอร์"});let eq=L.find(e=>e.id===ey),eH=(0,K.cc)(null==eq?void 0:eq.payment_method_name,null==eq?void 0:eq.display_name),eM=(0,K.Od)(null==eq?void 0:eq.payment_method_name,null==eq?void 0:eq.display_name),eU=ey&&ef>=eA&&(0,K.VX)(null==eq?void 0:eq.payment_method_name,null==eq?void 0:eq.display_name,ed);return(0,n.jsxs)("div",{className:"payment-page-container",children:[(0,n.jsx)(i(),{id:Y.um.__hash,children:Y.um}),r,(0,n.jsxs)("div",{className:"payment-hero-mobile",children:[(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12,marginBottom:12},children:[(0,n.jsx)(u.ZP,{type:"text",icon:(0,n.jsx)(_.Z,{style:{fontSize:18,color:"#fff"}}),style:{height:40,width:40,borderRadius:12,background:"rgba(255,255,255,0.15)",display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>{(null==O?void 0:O.order_type)===J.m.DineIn?e.push("/pos/channels/dine-in"):(null==O?void 0:O.order_type)===J.m.TakeAway?e.push("/pos/channels/takeaway"):(null==O?void 0:O.order_type)===J.m.Delivery?e.push("/pos/channels/delivery"):e.back()}}),(0,n.jsxs)("div",{style:{flex:1},children:[(0,n.jsx)(el,{level:4,style:{margin:0,color:"#fff",fontSize:20},children:"ชำระเงิน"}),(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginTop:4,flexWrap:"wrap"},children:[(0,n.jsxs)(m.Z,{color:"rgba(255,255,255,0.2)",style:{border:"none",color:"#fff",fontSize:12},children:[(0,ea.mz)(O.order_type)," ",(0,ea.jN)(O)]}),(0,n.jsxs)(ec,{style:{color:"rgba(255,255,255,0.85)",fontSize:12},children:["#",O.order_no]})]})]})]}),(0,n.jsxs)("div",{className:"action-buttons-row",children:[(0,n.jsx)(u.ZP,{icon:(0,n.jsx)(S.Z,{}),onClick:eI,className:"action-btn",style:{background:"rgba(255,255,255,0.15)",border:"none",color:"#fff"},children:"แก้ไข"}),(0,n.jsx)(u.ZP,{danger:!0,onClick:()=>{O&&eN({open:!0,type:"danger",title:"ยืนยันการยกเลิกออเดอร์?",content:"การดำเนินการนี้จะยกเลิกสินค้าทุกรายการและคืนสถานะโต๊ะ (หากมี) คุณแน่ใจหรือไม่?",okText:"ยืนยันการยกเลิก",cancelText:"ยกเลิก",onOk:async()=>{try{var t;ew("กำลังดำเนินการยกเลิก..."),eT();let n=await (0,X.P)(),r=(null===(t=O.items)||void 0===t?void 0:t.filter(e=>e.status!==J.i.Cancelled))||[];await Promise.all(r.map(e=>F.x.updateItemStatus(e.id,J.i.Cancelled,void 0,n))),await F.x.updateStatus(O.id,J.i.Cancelled,n),O.table_id&&await M.$.update(O.table_id,{status:Q.c.Available},void 0,n),a.success("ยกเลิกออเดอร์เรียบร้อย"),e.push((0,K.wv)())}catch(e){a.error("ไม่สามารถยกเลิกออเดอร์ได้")}finally{ek()}}})},className:"action-btn",children:"ยกเลิก"})]})]}),(0,n.jsx)("div",{style:{padding:"16px",maxWidth:1200,margin:"0 auto"},children:(0,n.jsxs)(p.Z,{gutter:[20,20],children:[(0,n.jsxs)(y.Z,{xs:24,lg:12,children:[(0,n.jsxs)("div",{className:"order-summary-collapsible",children:[(0,n.jsxs)("div",{onClick:()=>ep(!em),className:"order-summary-header",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)(ec,{strong:!0,style:{fontSize:16},children:"รายการสรุป"}),(0,n.jsxs)(ec,{type:"secondary",style:{marginLeft:8},children:["(",eB.length," รายการ)"]})]}),(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12},children:[(0,n.jsx)(ec,{strong:!0,style:{fontSize:18,color:Y.QF.primary},children:(0,ea.xG)(eZ)}),em?(0,n.jsx)(N.Z,{}):(0,n.jsx)(T.Z,{})]})]}),(0,n.jsx)("div",{className:"order-summary-content ".concat(em?"expanded":""),children:(0,n.jsx)("div",{className:"order-summary-items",children:eB.map((e,t)=>{var a,r;return(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:14,paddingBottom:14,borderBottom:"1px solid ".concat(Y.QF.borderLight)},children:[(0,n.jsxs)("div",{style:{display:"flex",gap:12,flex:1,minWidth:0},children:[(0,n.jsx)(h.Z,{shape:"square",size:48,src:null===(a=e.product)||void 0===a?void 0:a.img_url,icon:(0,n.jsx)(C.Z,{}),style:{backgroundColor:Y.QF.backgroundSecondary,flexShrink:0,borderRadius:10}}),(0,n.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,n.jsx)(ec,{strong:!0,style:{display:"block",fontSize:14},ellipsis:!0,children:null===(r=e.product)||void 0===r?void 0:r.display_name}),(0,n.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[(0,n.jsx)(ec,{type:"secondary",style:{fontSize:12},children:(0,ea.xG)(e.price)}),(0,n.jsxs)(m.Z,{style:{margin:0,fontSize:10,padding:"0 6px"},children:["x",e.quantity]})]}),e.notes&&(0,n.jsxs)(ec,{style:{display:"block",fontSize:11,fontStyle:"italic",color:"#ef4444",marginTop:2},children:["* ",e.notes]}),e.details&&e.details.length>0&&(0,n.jsx)("div",{style:{marginTop:2},children:e.details.map((e,t)=>(0,n.jsxs)(ec,{style:{color:"#10b981",fontSize:11,display:"block"},children:["+ ",e.detail_name," ",Number(e.extra_price)>0?"(+".concat(Number(e.extra_price),")"):""]},t))})]})]}),(0,n.jsx)(ec,{strong:!0,style:{fontSize:14},children:(0,ea.xG)(Number(e.total_price||Number(e.price)*e.quantity))})]},t)})})})]}),(0,n.jsxs)(f.Z,{style:{borderRadius:20,marginBottom:16},styles:{body:{padding:20}},children:[(0,n.jsxs)(p.Z,{justify:"space-between",style:{marginBottom:8},children:[(0,n.jsx)(ec,{type:"secondary",children:"ยอดรวม"}),(0,n.jsx)(ec,{children:(0,ea.xG)(eZ)})]}),ez>0&&(0,n.jsxs)(p.Z,{justify:"space-between",style:{marginBottom:8},children:[(0,n.jsx)(ec,{type:"success",children:"ส่วนลด"}),(0,n.jsxs)(ec,{type:"success",children:["-",(0,ea.xG)(ez)]})]}),eO>0&&(0,n.jsxs)(p.Z,{justify:"space-between",style:{marginBottom:8},children:[(0,n.jsx)(ec,{type:"secondary",children:"VAT (7%)"}),(0,n.jsx)(ec,{children:(0,ea.xG)(eO)})]}),(0,n.jsx)(x.Z,{style:{margin:"12px 0"}}),(0,n.jsxs)(p.Z,{justify:"space-between",align:"middle",children:[(0,n.jsx)(el,{level:5,style:{margin:0},children:"ยอดสุทธิ"}),(0,n.jsx)(el,{level:3,style:{color:Y.QF.primary,margin:0},children:(0,ea.xG)(eA)})]})]}),(0,n.jsxs)("div",{onClick:()=>!G&&ev(!0),className:"discount-selector ".concat(eg?"has-discount":""),children:[(0,n.jsx)("span",{style:{color:eg?"#1f2937":"#9ca3af"},children:eg?"\uD83C\uDF81 ".concat(eg.display_name||eg.discount_name," (").concat("Percentage"===eg.discount_type?"".concat(eg.discount_amount,"%"):"-".concat(eg.discount_amount,"฿"),")"):"เลือกส่วนลด (ถ้ามี)"}),eg?(0,n.jsx)("span",{onClick:e=>{e.stopPropagation(),eR(void 0)},style:{color:"#ef4444",padding:8},children:"✕"}):(0,n.jsx)("span",{style:{color:"#9ca3af"},children:"▼"})]})]}),(0,n.jsx)(y.Z,{xs:24,lg:12,children:(0,n.jsxs)(f.Z,{style:{borderRadius:20},styles:{body:{padding:20}},children:[(0,n.jsx)(ec,{strong:!0,style:{display:"block",marginBottom:16,fontSize:16},children:"เลือกวิธีการชำระเงิน"}),0===L.length?(0,n.jsx)(g.Z,{message:"ยังไม่มีวิธีการชำระเงิน",description:"กรุณาเพิ่มวิธีการชำระเงินในเมนูตั้งค่าก่อนทำรายการ",type:"warning",showIcon:!0}):(0,n.jsx)("div",{className:"payment-method-grid",children:L.map(e=>{let t=ey===e.id;return(0,n.jsxs)("div",{onClick:()=>{eh(e.id),(0,K.Od)(e.payment_method_name,e.display_name)?ex(eA):(0,K.cc)(e.payment_method_name,e.display_name)?ex(0):ex(eA)},className:"payment-method-card ".concat(t?"selected":""),children:[(0,n.jsx)("div",{className:"payment-method-icon",children:eL(e.payment_method_name,e.display_name)}),(0,n.jsxs)("div",{className:"payment-method-info",children:[(0,n.jsx)("div",{className:"payment-method-name",children:e.display_name}),(0,n.jsx)("div",{className:"payment-method-desc",children:eD(e.payment_method_name,e.display_name)})]}),t&&(0,n.jsx)(P.Z,{style:{fontSize:20,color:"#4F46E5"}})]},e.id)})}),ey&&(0,n.jsxs)("div",{style:{marginTop:20},children:[(0,n.jsx)(x.Z,{style:{margin:"0 0 20px"}}),eM&&(0,n.jsx)(n.Fragment,{children:(null==ed?void 0:ed.promptpay_number)?(0,n.jsxs)("div",{className:"qr-display-wrapper",children:[(0,n.jsx)(ec,{style:{display:"block",marginBottom:16,fontSize:14,color:"#6b7280"},children:"สแกน QR Code เพื่อชำระเงิน"}),(0,n.jsx)(z.t,{value:A()(ed.promptpay_number,{amount:eA}),size:200,level:"L",includeMargin:!0}),(0,n.jsx)("div",{className:"qr-amount",children:(0,ea.xG)(eA)}),(0,n.jsxs)("div",{className:"qr-account-info",children:[ed.promptpay_number,ed.promptpay_name&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("br",{}),"(",ed.promptpay_name,")"]})]})]}):(0,n.jsxs)("div",{style:{textAlign:"center",padding:"20px 0"},children:[(0,n.jsx)("div",{style:{color:"#ff4d4f",marginBottom:12,fontWeight:500},children:"กรุณาตั้งค่าเบอร์ PromptPay ในระบบก่อน"}),(0,n.jsx)(u.ZP,{type:"primary",danger:!0,ghost:!0,icon:(0,n.jsx)(E.Z,{}),onClick:()=>e.push("/pos/settings"),children:"ไปตั้งค่าที่ Shop Profile"})]})}),eH&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"amount-input-wrapper",children:[(0,n.jsx)(ec,{style:{display:"block",marginBottom:12,fontSize:14,fontWeight:500},children:"รับเงินมา"}),(0,n.jsx)(b.Z,{style:{width:"100%"},size:"large",min:0,value:ef,onChange:e=>ex(e||0),formatter:e=>"฿ ".concat(e).replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:e=>Number(e.replace(/฿\s?|(,*)/g,"")),onFocus:e=>e.target.select(),controls:!1,inputMode:"decimal"})]}),(0,n.jsxs)("div",{className:"quick-cash-grid",children:[(0,n.jsxs)(u.ZP,{onClick:()=>ex(eA),type:"primary",className:"quick-cash-btn quick-cash-btn-exact",children:["พอดี (",(0,ea.xG)(eA),")"]}),K.si.map(e=>(0,n.jsxs)(u.ZP,{onClick:()=>ex(e),className:"quick-cash-btn",children:["฿",e.toLocaleString()]},e)),(0,n.jsx)(u.ZP,{icon:(0,n.jsx)(Z.Z,{}),onClick:()=>ex(0),danger:!0,className:"quick-cash-btn"})]}),(0,n.jsxs)("div",{className:"change-display ".concat(eF<0?"insufficient":""),children:[(0,n.jsx)("div",{className:"change-label",children:eF>=0?"เงินทอน":"ยังขาดอีก"}),(0,n.jsx)("div",{className:"change-amount",children:(0,ea.xG)(Math.abs(eF))})]})]}),!eH&&!eM&&(0,n.jsxs)("div",{style:{textAlign:"center",padding:20},children:[(0,n.jsx)(ec,{type:"secondary",children:"ตรวจสอบยอดเงินและชำระผ่านช่องทางที่เลือก"}),(0,n.jsx)("div",{style:{marginTop:16},children:(0,n.jsx)(b.Z,{style:{width:"100%",fontSize:24},value:ef,onChange:e=>ex(e||0),formatter:e=>"฿ ".concat(e).replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:e=>Number(e.replace(/฿\s?|(,*)/g,"")),controls:!1,inputMode:"decimal"})})]})]}),(0,n.jsx)("div",{style:{marginTop:20},className:"payment-sticky-footer",children:(0,n.jsxs)(u.ZP,{type:"primary",size:"large",block:!0,className:"payment-confirm-btn",onClick:eG,disabled:!eU,icon:(0,n.jsx)(P.Z,{}),children:["ยืนยันการชำระเงิน ",eU&&"(".concat((0,ea.xG)(eA),")")]})})]})})]})}),(0,n.jsx)("div",{style:{display:"block"},className:"payment-sticky-footer",children:(0,n.jsxs)("div",{className:"payment-sticky-footer-content",children:[(0,n.jsxs)("div",{className:"payment-total-row",children:[(0,n.jsx)("span",{className:"payment-total-label",children:"ยอดสุทธิ"}),(0,n.jsx)("span",{className:"payment-total-amount",children:(0,ea.xG)(eA)})]}),(0,n.jsx)(u.ZP,{type:"primary",size:"large",block:!0,className:"payment-confirm-btn",onClick:eG,disabled:!eU,icon:(0,n.jsx)(P.Z,{}),children:"ยืนยันการชำระเงิน"})]})}),(0,n.jsx)(j.Z,{title:"เลือกส่วนลด",open:ej,onCancel:()=>ev(!1),footer:null,centered:!0,width:400,zIndex:10001,children:(0,n.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:10,maxHeight:"60vh",overflowY:"auto"},children:[0===eP.length?(0,n.jsx)("div",{style:{textAlign:"center",padding:24,color:"#9ca3af"},children:"ไม่มีส่วนลดที่ใช้งานได้"}):eP.map(e=>(0,n.jsxs)("div",{onClick:()=>{eR(e.value),ev(!1)},style:{padding:"14px 18px",border:"2px solid",borderRadius:12,cursor:"pointer",background:(null==eg?void 0:eg.id)===e.value?"#eff6ff":"#fff",borderColor:(null==eg?void 0:eg.id)===e.value?"#3b82f6":"#e5e7eb",display:"flex",justifyContent:"space-between",alignItems:"center",minHeight:54},children:[(0,n.jsx)("span",{style:{fontWeight:(null==eg?void 0:eg.id)===e.value?600:400},children:e.label}),(null==eg?void 0:eg.id)===e.value&&(0,n.jsx)(P.Z,{style:{color:"#3b82f6",fontSize:18}})]},e.value)),(0,n.jsx)("div",{onClick:()=>{eR(void 0),ev(!1)},style:{padding:"14px 18px",marginTop:8,textAlign:"center",color:"#ef4444",cursor:"pointer",border:"2px dashed #ef4444",borderRadius:12,minHeight:54,display:"flex",alignItems:"center",justifyContent:"center"},children:"ไม่ใช้ส่วนลด"})]})}),(0,n.jsx)(en.Z,{open:eS.open,type:eS.type,title:eS.title,content:eS.content,okText:eS.okText,cancelText:eS.cancelText,onOk:eS.onOk,onCancel:eT})]})}et().locale("th")},60300:function(e,t,a){"use strict";var n=a(57437),r=a(29),i=a.n(r);a(2265);var s=a(39486),o=a(47213),l=a(53743),c=a(50742),d=a(54537),u=a(15516),m=a(8900),p=a(55726),y=a(91619);let{Title:h,Text:f}=s.default;t.Z=e=>{let{open:t,type:a="confirm",title:r,content:s,okText:x="ยืนยัน",cancelText:g="ยกเลิก",onOk:b,onCancel:j,loading:v=!1,icon:w}=e,k=()=>{switch(a){case"danger":return"#ff4d4f";case"warning":return"#faad14";case"success":return"#52c41a";default:return"#1890ff"}},_=k();return(0,n.jsx)(o.ZP,{theme:{components:{Modal:{contentBg:"#ffffff",headerBg:"#ffffff",borderRadiusLG:24},Button:{borderRadius:12,controlHeightLG:48,fontSizeLG:16,fontWeight:600}}},children:(0,n.jsxs)(l.Z,{open:t,onCancel:j,footer:null,centered:!0,width:360,closable:!1,styles:{mask:{backdropFilter:"blur(8px)",background:"rgba(0, 0, 0, 0.25)"}},className:"soft-confirm-modal",children:[(0,n.jsxs)("div",{style:{padding:"32px 24px",display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center"},className:"jsx-14a62d28233e1b8c",children:[(0,n.jsx)("div",{style:{marginBottom:20,width:80,height:80,borderRadius:"40%",backgroundColor:"".concat(_,"15"),display:"flex",alignItems:"center",justifyContent:"center",animation:"float 3s ease-in-out infinite"},className:"jsx-14a62d28233e1b8c",children:(()=>{if(w)return w;let e={fontSize:48,color:k()};switch(a){case"danger":return(0,n.jsx)(d.Z,{style:e});case"warning":return(0,n.jsx)(u.Z,{style:e});case"success":return(0,n.jsx)(m.Z,{style:e});case"info":return(0,n.jsx)(p.Z,{style:e});default:return(0,n.jsx)(y.Z,{style:e})}})()}),(0,n.jsx)(h,{level:4,style:{marginBottom:12,fontWeight:700,color:"#1f1f1f"},children:r}),(0,n.jsx)("div",{style:{marginBottom:32,width:"100%"},className:"jsx-14a62d28233e1b8c",children:"string"==typeof s?(0,n.jsx)(f,{type:"secondary",style:{fontSize:16,lineHeight:1.6},children:s}):s}),(0,n.jsxs)("div",{style:{width:"100%",display:"flex",gap:12,flexDirection:"row"},className:"jsx-14a62d28233e1b8c",children:[(0,n.jsx)(c.ZP,{block:!0,size:"large",onClick:j,disabled:v,style:{border:"none",background:"#f5f5f5",color:"#595959",boxShadow:"none"},className:"hover-scale",children:g}),(0,n.jsx)(c.ZP,{block:!0,type:"primary",size:"large",onClick:b,loading:v,style:{background:_,border:"none",boxShadow:"0 8px 20px ".concat(_,"40")},className:"hover-scale",children:x})]})]}),(0,n.jsx)(i(),{id:"14a62d28233e1b8c",children:"@-webkit-keyframes float{0%{-webkit-transform:translatey(0px);transform:translatey(0px)}50%{-webkit-transform:translatey(-5px);transform:translatey(-5px)}100%{-webkit-transform:translatey(0px);transform:translatey(0px)}}@-moz-keyframes float{0%{-moz-transform:translatey(0px);transform:translatey(0px)}50%{-moz-transform:translatey(-5px);transform:translatey(-5px)}100%{-moz-transform:translatey(0px);transform:translatey(0px)}}@-o-keyframes float{0%{-o-transform:translatey(0px);transform:translatey(0px)}50%{-o-transform:translatey(-5px);transform:translatey(-5px)}100%{-o-transform:translatey(0px);transform:translatey(0px)}}@keyframes float{0%{-webkit-transform:translatey(0px);-moz-transform:translatey(0px);-o-transform:translatey(0px);transform:translatey(0px)}50%{-webkit-transform:translatey(-5px);-moz-transform:translatey(-5px);-o-transform:translatey(-5px);transform:translatey(-5px)}100%{-webkit-transform:translatey(0px);-moz-transform:translatey(0px);-o-transform:translatey(0px);transform:translatey(0px)}}.hover-scale{-webkit-transition:-webkit-transform.2s cubic-bezier(.34,1.56,.64,1);-moz-transition:-moz-transform.2s cubic-bezier(.34,1.56,.64,1);-o-transition:-o-transform.2s cubic-bezier(.34,1.56,.64,1);transition:-webkit-transform.2s cubic-bezier(.34,1.56,.64,1);transition:-moz-transform.2s cubic-bezier(.34,1.56,.64,1);transition:-o-transform.2s cubic-bezier(.34,1.56,.64,1);transition:transform.2s cubic-bezier(.34,1.56,.64,1)}.hover-scale:active{-webkit-transform:scale(.96);-moz-transform:scale(.96);-ms-transform:scale(.96);-o-transform:scale(.96);transform:scale(.96)}@media(max-width:480px){.soft-confirm-modal .ant-modal-content{-webkit-border-radius:20px!important;-moz-border-radius:20px!important;border-radius:20px!important}}.soft-confirm-modal .ant-modal-content{-webkit-box-shadow:0 20px 50px rgba(0,0,0,.1)!important;-moz-box-shadow:0 20px 50px rgba(0,0,0,.1)!important;box-shadow:0 20px 50px rgba(0,0,0,.1)!important;padding:0!important}"})]})})}},63836:function(e,t,a){"use strict";a.d(t,{E:function(){return l}});var n=a(2913),r=a(71567),i=a(98170);let s=r.q.POS.PAYMENT_METHODS,o=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"application/json",a={};return t&&(a["Content-Type"]=t),e&&(a.Cookie=e),a},l={getAll:async(e,t)=>{let a=(0,n.b)("GET",s),r=new URLSearchParams(t||"");r.has("page")||r.set("page","1"),r.has("limit")||r.set("limit","200");let l=r.toString();l&&(a+="?".concat(l));let c=o(e,""),d=await fetch(a,{cache:"no-store",headers:c,credentials:"include"});if(!d.ok){var u;let e=await d.json().catch(()=>({}));throw Error((null==e?void 0:null===(u=e.error)||void 0===u?void 0:u.message)||e.error||e.message||"Failed to fetch payment methods")}return(0,i.XO)(await d.json())},getById:async(e,t)=>{let a=(0,n.b)("GET","".concat(s,"/").concat(e)),r=o(t,""),l=await fetch(a,{cache:"no-store",headers:r,credentials:"include"});if(!l.ok){var c;let e=await l.json().catch(()=>({}));throw Error((null==e?void 0:null===(c=e.error)||void 0===c?void 0:c.message)||e.error||e.message||"Failed to fetch payment method")}return(0,i.hH)(await l.json())},getByName:async(e,t)=>{let a=(0,n.b)("GET","".concat(s,"/getByName/").concat(e)),r=o(t,""),l=await fetch(a,{cache:"no-store",headers:r,credentials:"include"});if(!l.ok){var c;let e=await l.json().catch(()=>({}));throw Error((null==e?void 0:null===(c=e.error)||void 0===c?void 0:c.message)||e.error||e.message||"Failed to fetch payment method")}return(0,i.hH)(await l.json())},create:async(e,t,a)=>{let r=(0,n.b)("POST","".concat(s)),l=o(t);a&&(l["X-CSRF-Token"]=a);let c=await fetch(r,{method:"POST",headers:l,credentials:"include",body:JSON.stringify(e)});if(!c.ok){var d;let e=await c.json().catch(()=>({}));throw Error((null==e?void 0:null===(d=e.error)||void 0===d?void 0:d.message)||e.error||e.message||"Failed to create payment method")}return(0,i.hH)(await c.json())},update:async(e,t,a,r)=>{let l=(0,n.b)("PUT","".concat(s,"/").concat(e)),c=o(a);r&&(c["X-CSRF-Token"]=r);let d=await fetch(l,{method:"PUT",headers:c,credentials:"include",body:JSON.stringify(t)});if(!d.ok){var u;let e=await d.json().catch(()=>({}));throw Error((null==e?void 0:null===(u=e.error)||void 0===u?void 0:u.message)||e.error||e.message||"Failed to update payment method")}return(0,i.hH)(await d.json())},delete:async(e,t,a)=>{let r=(0,n.b)("DELETE","".concat(s,"/").concat(e)),i=o(t,"");a&&(i["X-CSRF-Token"]=a);let l=await fetch(r,{method:"DELETE",headers:i,credentials:"include"});if(!l.ok){var c;let e=await l.json().catch(()=>({}));throw Error((null==e?void 0:null===(c=e.error)||void 0===c?void 0:c.message)||e.error||e.message||"Failed to delete payment method")}}}},54528:function(e,t,a){"use strict";a.d(t,{U:function(){return o}});var n=a(2913),r=a(98170);let i="/pos/payments",s=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"application/json",a={};return t&&(a["Content-Type"]=t),e&&(a.Cookie=e),a},o={getAll:async e=>{let t=(0,n.b)("GET",i),a=s(e,""),o=await fetch(t,{cache:"no-store",headers:a});if(!o.ok){let e=await o.json().catch(()=>({}));throw Error((0,r.i_)(e,"ไม่สามารถดึงข้อมูลการชำระเงินได้"))}return(0,r.hH)(await o.json())},getById:async(e,t)=>{let a=(0,n.b)("GET","".concat(i,"/").concat(e)),o=s(t,""),l=await fetch(a,{cache:"no-store",headers:o});if(!l.ok){let e=await l.json().catch(()=>({}));throw Error((0,r.i_)(e,"ไม่สามารถดึงข้อมูลการชำระเงินได้"))}return(0,r.hH)(await l.json())},create:async(e,t,a)=>{let o=(0,n.b)("POST","".concat(i)),l=s(t);a&&(l["X-CSRF-Token"]=a);let c=await fetch(o,{method:"POST",headers:l,credentials:"include",body:JSON.stringify(e)});if(!c.ok){let e=await c.json().catch(()=>({}));throw Error((0,r.i_)(e,"ไม่สามารถสร้างรายการชำระเงินได้"))}return(0,r.hH)(await c.json())},update:async(e,t,a,o)=>{let l=(0,n.b)("PUT","".concat(i,"/").concat(e)),c=s(a);o&&(c["X-CSRF-Token"]=o);let d=await fetch(l,{method:"PUT",headers:c,credentials:"include",body:JSON.stringify(t)});if(!d.ok){let e=await d.json().catch(()=>({}));throw Error((0,r.i_)(e,"ไม่สามารถแก้ไขรายการชำระเงินได้"))}return(0,r.hH)(await d.json())},delete:async(e,t,a)=>{let o=(0,n.b)("DELETE","".concat(i,"/").concat(e)),l=s(t,"");a&&(l["X-CSRF-Token"]=a);let c=await fetch(o,{method:"DELETE",headers:l,credentials:"include"});if(!c.ok){let e=await c.json().catch(()=>({}));throw Error((0,r.i_)(e,"ไม่สามารถลบรายการชำระเงินได้"))}}}},19135:function(e,t,a){"use strict";a.d(t,{n:function(){return o}});var n=a(2913),r=a(98170);let i="/pos/shopProfile",s=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"application/json",a={};return t&&(a["Content-Type"]=t),e&&(a.Cookie=e),a},o={getProfile:async e=>{let t=(0,n.b)("GET",i),a=s(e,""),o=await fetch(t,{cache:"no-store",headers:a,credentials:"include"});if(!o.ok){let e=await o.json().catch(()=>({}));throw Error((0,r.i_)(e,"ไม่สามารถดึงข้อมูลร้านค้าได้"))}return(0,r.hH)(await o.json())},updateProfile:async(e,t,a)=>{let o=(0,n.b)("PUT",i),l=s(t);a&&(l["X-CSRF-Token"]=a);let c=await fetch(o,{method:"PUT",headers:l,credentials:"include",body:JSON.stringify(e)});if(!c.ok){let e=await c.json().catch(()=>({}));throw Error((0,r.i_)(e,"ไม่สามารถอัปเดตข้อมูลร้านค้าได้"))}return(0,r.hH)(await c.json())}}},66290:function(e,t,a){"use strict";a.d(t,{$:function(){return l}});var n=a(2913),r=a(71567),i=a(98170);let s=r.q.POS.TABLES,o=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"application/json",a={};return t&&(a["Content-Type"]=t),e&&(a.Cookie=e),a},l={getAll:async(e,t)=>{let a=(0,n.b)("GET",s),r=new URLSearchParams(t||"");r.has("page")||r.set("page","1"),r.has("limit")||r.set("limit","200");let l=r.toString();l&&(a+="?".concat(l));let c=o(e,""),d=await fetch(a,{cache:"no-store",headers:c,credentials:"include"});if(!d.ok){let e=await d.json().catch(()=>({}));throw Error((0,i.i_)(e,"Failed to fetch tables"))}return(0,i.XO)(await d.json())},getById:async(e,t)=>{let a=(0,n.b)("GET","".concat(s,"/").concat(e)),r=o(t,""),l=await fetch(a,{cache:"no-store",headers:r,credentials:"include"});if(!l.ok){let e=await l.json().catch(()=>({}));throw Error((0,i.i_)(e,"Failed to fetch tables"))}return(0,i.hH)(await l.json())},getByName:async(e,t)=>{let a=(0,n.b)("GET","".concat(s,"/getByName/").concat(e)),r=o(t,""),l=await fetch(a,{cache:"no-store",headers:r,credentials:"include"});if(!l.ok){let e=await l.json().catch(()=>({}));throw Error((0,i.i_)(e,"Failed to fetch tables"))}return(0,i.hH)(await l.json())},create:async(e,t,a)=>{let r=(0,n.b)("POST","".concat(s)),l=o(t);a&&(l["X-CSRF-Token"]=a);let c=await fetch(r,{method:"POST",headers:l,credentials:"include",body:JSON.stringify(e)});if(!c.ok){let e=await c.json().catch(()=>({}));throw Error((0,i.i_)(e,"Failed to create table"))}return(0,i.hH)(await c.json())},update:async(e,t,a,r)=>{let l=(0,n.b)("PUT","".concat(s,"/").concat(e)),c=o(a);r&&(c["X-CSRF-Token"]=r);let d=await fetch(l,{method:"PUT",headers:c,credentials:"include",body:JSON.stringify(t)});if(!d.ok){let e=await d.json().catch(()=>({}));throw Error((0,i.i_)(e,"Failed to update table"))}return(0,i.hH)(await d.json())},delete:async(e,t,a)=>{let r=(0,n.b)("DELETE","".concat(s,"/").concat(e)),l=o(t,"");a&&(l["X-CSRF-Token"]=a);let c=await fetch(r,{method:"DELETE",headers:l,credentials:"include"});if(!c.ok){let e=await c.json().catch(()=>({}));throw Error((0,i.i_)(e,"Failed to delete table"))}}}},69477:function(e,t,a){"use strict";var n,r;a.d(t,{L:function(){return n}}),(r=n||(n={})).Fixed="Fixed",r.Percentage="Percentage"},94532:function(e,t,a){"use strict";var n,r;a.d(t,{b:function(){return n}}),(r=n||(n={})).Pending="Pending",r.Success="Success",r.Failed="Failed"},7806:function(e,t,a){"use strict";a.d(t,{S:function(){return n}});let n=e=>{if(!(null==e?void 0:e.length))return[];let t=new Map;for(let u of e){var a,n,r,i,s,o,l,c,d;let e=(null===(a=u.details)||void 0===a?void 0:a.length)?JSON.stringify(u.details.map(e=>({n:e.detail_name,p:e.extra_price})).sort((e,t)=>e.n.localeCompare(t.n))):"[]",m=(null!==(r=u.notes)&&void 0!==r?r:"").trim().toLowerCase(),p=String(null!==(i=u.status)&&void 0!==i?i:""),y=null!==(o=null!==(s=null===(n=u.product)||void 0===n?void 0:n.id)&&void 0!==s?s:u.product_id)&&void 0!==o?o:"unknown",h="".concat(y,"|").concat(e,"|").concat(m,"|").concat(p),f=t.get(h);if(f){f.quantity+=Number(u.quantity),f.total_price+=Number(null!==(l=u.total_price)&&void 0!==l?l:0),f.originalItems.push(u);continue}let x={...u,id:String(null!==(c=null==u?void 0:u.id)&&void 0!==c?c:h),quantity:Number(u.quantity),total_price:Number(null!==(d=u.total_price)&&void 0!==d?d:0),originalItems:[u]};t.set(h,x)}return Array.from(t.values())}},49747:function(e,t,a){"use strict";a.d(t,{Od:function(){return i},T_:function(){return c},VX:function(){return s},cc:function(){return r},hs:function(){return n},si:function(){return o},wv:function(){return l}});let n=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!e)return{subtotal:0,discount:0,vat:0,total:0,change:0};let a=Number(e.sub_total||0),n=Number(e.discount_amount||0),r=Number(e.vat||0),i=Number(e.total_amount||0);return{subtotal:a,discount:n,vat:r,total:i,change:Math.max(0,t-i)}},r=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=e.toLowerCase(),n=t.toLowerCase();return a.includes("cash")||n.includes("สด")},i=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=e.toLowerCase(),n=t.toLowerCase();return a.includes("qr")||a.includes("prompt")||n.includes("qr")||n.includes("พร้อมเพย์")},s=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return!i(e,t)||!!(null==a?void 0:a.promptpay_number)},o=[20,50,100,500,1e3],l=()=>"/pos/channels",c=e=>"/pos/orders/".concat(e)},97235:function(e,t,a){"use strict";a.d(t,{P:function(){return o}});var n=a(5447);let r=null,i=0,s=null;async function o(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=Date.now();return!e&&r&&t-i<6e5?r:(s||(s=n.O.getCsrfToken().then(e=>(r=e||"",i=Date.now(),r)).finally(()=>{s=null})),s)}}},function(e){e.O(0,[253,1522,3418,742,9486,4252,3916,8651,6931,4159,3831,2224,3248,2401,9,19,4221,4547,1652,2957,8090,8627,2942,9385,4191,6320,2971,2117,1744],function(){return e(e.s=48492)}),_N_E=e.O()}]);