(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6834],{41019:function(e,t,r){Promise.resolve().then(r.bind(r,82043))},29107:function(e,t,r){"use strict";r.d(t,{Z:function(){return c}});var n=r(2265),a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M380 704h264c4.4 0 8-3.6 8-8v-84c0-4.4-3.6-8-8-8h-40c-4.4 0-8 3.6-8 8v36H428v-36c0-4.4-3.6-8-8-8h-40c-4.4 0-8 3.6-8 8v84c0 4.4 3.6 8 8 8zm340-123a40 40 0 1080 0 40 40 0 10-80 0zm239-167.6L935.3 372a8 8 0 00-10.9-2.9l-50.7 29.6-78.3-216.2a63.9 63.9 0 00-60.9-44.4H301.2c-34.7 0-65.5 22.4-76.2 55.5l-74.6 205.2-50.8-29.6a8 8 0 00-10.9 2.9L65 413.4c-2.2 3.8-.9 8.6 2.9 10.8l60.4 35.2-14.5 40c-1.2 3.2-1.8 6.6-1.8 10v348.2c0 15.7 11.8 28.4 26.3 28.4h67.6c12.3 0 23-9.3 25.6-22.3l7.7-37.7h545.6l7.7 37.7c2.7 13 13.3 22.3 25.6 22.3h67.6c14.5 0 26.3-12.7 26.3-28.4V509.4c0-3.4-.6-6.8-1.8-10l-14.5-40 60.3-35.2a8 8 0 003-10.8zM840 517v237H184V517l15.6-43h624.8l15.6 43zM292.7 218.1l.5-1.3.4-1.3c1.1-3.3 4.1-5.5 7.6-5.5h427.6l75.4 208H220l72.7-199.9zM224 581a40 40 0 1080 0 40 40 0 10-80 0z"}}]},name:"car",theme:"outlined"},i=r(55015);function o(){return(o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var c=n.forwardRef((e,t)=>n.createElement(i.Z,o({},e,{ref:t,icon:a})))},93942:function(e,t,r){"use strict";r.d(t,{i:function(){return c}});var n=r(2265),a=r(73627),i=r(47213),o=r(71744);function c(e){return t=>n.createElement(i.ZP,{theme:{token:{motion:!1,zIndexPopupBase:0}}},n.createElement(e,{...t}))}t.Z=(e,t,r,i,s)=>c(c=>{let{prefixCls:l,style:d}=c,u=n.useRef(null),[f,h]=n.useState(0),[m,p]=n.useState(0),[v,g]=(0,a.zk)(!1,c.open),{getPrefixCls:x}=n.useContext(o.E_),y=x(i||"select",l);n.useEffect(()=>{if(g(!0),"undefined"!=typeof ResizeObserver){let e=new ResizeObserver(e=>{let t=e[0].target;h(t.offsetHeight+8),p(t.offsetWidth)}),t=setInterval(()=>{var r;let n=s?".".concat(s(y)):".".concat(y,"-dropdown"),a=null===(r=u.current)||void 0===r?void 0:r.querySelector(n);a&&(clearInterval(t),e.observe(a))},10);return()=>{clearInterval(t),e.disconnect()}}},[y]);let w={...c,style:{...d,margin:0},open:v,getPopupContainer:()=>u.current};return r&&(w=r(w)),t&&Object.assign(w,{[t]:{overflow:{adjustX:!1,adjustY:!1}}}),n.createElement("div",{ref:u,style:{paddingBottom:f,position:"relative",minWidth:m}},n.createElement(e,{...w}))})},51646:function(e,t,r){"use strict";r.d(t,{N:function(){return a}});var n=r(2265);let a=()=>n.useReducer(e=>e+1,0)},6543:function(e,t,r){"use strict";r.d(t,{c4:function(){return i},m9:function(){return s}});var n=r(2265),a=r(84560);let i=["xxl","xl","lg","md","sm","xs"],o=e=>({xs:"(max-width: ".concat(e.screenXSMax,"px)"),sm:"(min-width: ".concat(e.screenSM,"px)"),md:"(min-width: ".concat(e.screenMD,"px)"),lg:"(min-width: ".concat(e.screenLG,"px)"),xl:"(min-width: ".concat(e.screenXL,"px)"),xxl:"(min-width: ".concat(e.screenXXL,"px)")}),c=e=>{let t=[].concat(i).reverse();return t.forEach((r,n)=>{let a=r.toUpperCase(),i="screen".concat(a,"Min"),o="screen".concat(a);if(!(e[i]<=e[o]))throw Error("".concat(i,"<=").concat(o," fails : !(").concat(e[i],"<=").concat(e[o],")"));if(n<t.length-1){let r="screen".concat(a,"Max");if(!(e[o]<=e[r]))throw Error("".concat(o,"<=").concat(r," fails : !(").concat(e[o],"<=").concat(e[r],")"));let i=t[n+1].toUpperCase(),c="screen".concat(i,"Min");if(!(e[r]<=e[c]))throw Error("".concat(r,"<=").concat(c," fails : !(").concat(e[r],"<=").concat(e[c],")"))}}),e},s=(e,t)=>{if(t){for(let r of i)if(e[r]&&(null==t?void 0:t[r])!==void 0)return t[r]}};t.ZP=()=>{let[,e]=(0,a.ZP)(),t=o(c(e));return n.useMemo(()=>{let e=new Map,r=-1,n={};return{responsiveMap:t,matchHandlers:{},dispatch:t=>(n=t,e.forEach(e=>e(n)),e.size>=1),subscribe(t){return e.size||this.register(),r+=1,e.set(r,t),t(n),r},unsubscribe(t){e.delete(t),e.size||this.unregister()},register(){Object.entries(t).forEach(e=>{let[t,r]=e,a=e=>{let{matches:r}=e;this.dispatch({...n,[t]:r})},i=window.matchMedia(r);"function"==typeof(null==i?void 0:i.addEventListener)&&i.addEventListener("change",a),this.matchHandlers[r]={mql:i,listener:a},a(i)})},unregister(){Object.values(t).forEach(e=>{var t;let r=this.matchHandlers[e];"function"==typeof(null==r?void 0:null===(t=r.mql)||void 0===t?void 0:t.removeEventListener)&&r.mql.removeEventListener("change",null==r?void 0:r.listener)}),e.clear()}}},[t])}},28617:function(e,t,r){"use strict";var n=r(2265),a=r(90891),i=r(51646),o=r(6543);t.Z=function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=(0,n.useRef)(t),[,c]=(0,i.N)(),s=(0,o.ZP)();return(0,a.Z)(()=>{let t=s.subscribe(t=>{r.current=t,e&&c()});return()=>s.unsubscribe(t)},[]),r.current}},53743:function(e,t,r){"use strict";r.d(t,{Z:function(){return y}});var n=r(42535),a=r(50815),i=r(74079),o=r(2265),c=r(28975),s=r(61994),l=r(93942),d=r(71744),u=r(64024),f=r(85695),h=r(90024),m=r(4065),p=(0,l.i)(e=>{let{prefixCls:t,className:r,closeIcon:n,closable:a,type:i,title:l,children:p,footer:v,...g}=e,{getPrefixCls:x}=o.useContext(d.E_),y=x(),w=t||x("modal"),b=(0,u.Z)(y),[j,E]=(0,m.ZP)(w,b),Z="".concat(w,"-confirm"),C={};return C=i?{closable:null!=a&&a,title:"",footer:"",children:o.createElement(f.O,{...e,prefixCls:w,confirmPrefixCls:Z,rootPrefixCls:y,content:p})}:{closable:null==a||a,title:l,footer:null!==v&&o.createElement(h.$,{...e}),children:p},o.createElement(c.s,{prefixCls:w,className:(0,s.W)(j,"".concat(w,"-pure-panel"),i&&Z,i&&"".concat(Z,"-").concat(i),r,E,b),...g,closeIcon:(0,h.b)(w,n),closable:a,...C})}),v=r(23248);function g(e){return(0,n.ZP)((0,n.uW)(e))}let x=i.Z;x.useModal=v.Z,x.info=function(e){return(0,n.ZP)((0,n.cw)(e))},x.success=function(e){return(0,n.ZP)((0,n.vq)(e))},x.error=function(e){return(0,n.ZP)((0,n.AQ)(e))},x.warning=g,x.warn=g,x.confirm=function(e){return(0,n.ZP)((0,n.Au)(e))},x.destroyAll=function(){for(;a.Z.length;){let e=a.Z.pop();e&&e()}},x.config=n.ai,x._InternalPanelDoNotUseOrYouWillBeFired=p;var y=x},82043:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return C}});var n=r(57437),a=r(2265),i=r(44967),o=r(34029),c=r(53743),s=r(48651),l=r(88589),d=r(80336),u=r(99376),f=r(33145),h=r(82646),m=r(29107),p=r(72175);let{Text:v}=h.default,{pageStyles:g,ManagePageStyles:x}=(0,p.dg)({focusColor:"#13c2c2",focusShadow:"rgba(19, 194, 194, 0.1)",switchGradient:"linear-gradient(135deg, #13c2c2 0%, #08979c 100%)"}),y=e=>{let{isEdit:t,onBack:r,onDelete:a}=e;return(0,n.jsx)(p.oI,{pageStyles:g,isEdit:t,onBack:r,onDelete:a,titleCreate:"เพิ่มบริการส่ง",titleEdit:"แก้ไขบริการส่ง"})},w=e=>{let{name:t,logo:r}=e;return(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:14,padding:16,background:"#fafafa",borderRadius:16,marginTop:12},children:[(0,n.jsx)("div",{style:{width:80,height:80,borderRadius:14,border:"2px solid white",boxShadow:"0 4px 12px rgba(0,0,0,0.08)",overflow:"hidden",position:"relative",flexShrink:0,background:"linear-gradient(135deg, #e6fffb 0%, #b5f5ec 100%)",display:"flex",alignItems:"center",justifyContent:"center"},children:r?(0,n.jsx)(f.default,{src:r,alt:t||"Delivery Logo",fill:!0,sizes:"(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw",style:{objectFit:"contain",background:"white"}}):(0,n.jsx)(m.Z,{style:{fontSize:28,color:"#13c2c2",opacity:.7}})}),(0,n.jsxs)("div",{children:[(0,n.jsx)(v,{strong:!0,style:{display:"block",marginBottom:4},children:t||"ตัวอย่างบริการส่ง"}),(0,n.jsx)(v,{type:"secondary",style:{fontSize:12},children:"บริการส่งอาหาร"})]})]})},b=e=>{let{isEdit:t,loading:r,onCancel:a}=e;return(0,n.jsx)(p.uM,{pageStyles:g,isEdit:t,loading:r,onCancel:a})};var j=r(97235),E=r(3286),Z=r(2938);function C(e){let{params:t}=e,r=(0,u.useRouter)(),[f]=i.Z.useForm(),[h,m]=(0,a.useState)(!1),[p,v]=(0,a.useState)(!1),[C,P]=(0,a.useState)(""),[k,_]=(0,a.useState)(""),S=t.mode[0],z=t.mode[1]||null,L="edit"===S&&!!z,{isAuthorized:M,isChecking:O}=(0,E.e)({requiredRole:"Admin"});(0,a.useEffect)(()=>{(async()=>{_(await (0,j.P)())})()},[]);let R=(0,a.useCallback)(async()=>{m(!0);try{let e=await fetch("/api/pos/delivery/getById/".concat(z));if(!e.ok)throw Error("ไม่สามารถดึงข้อมูลบริการส่งได้");let t=await e.json();f.setFieldsValue({delivery_name:t.delivery_name,delivery_prefix:t.delivery_prefix,logo:t.logo,is_active:t.is_active}),P(t.delivery_name||"")}catch(e){console.error(e),o.ZP.error("ไม่สามารถดึงข้อมูลบริการส่งได้"),r.push("/pos/delivery")}finally{m(!1)}},[z,f,r]);(0,a.useEffect)(()=>{L&&R()},[L,z,R]);let I=async e=>{v(!0);try{if(L){let t=await fetch("/api/pos/delivery/update/".concat(z),{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-Token":k},body:JSON.stringify(e)});if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.error||e.message||"ไม่สามารถอัปเดตบริการส่งได้")}o.ZP.success("อัปเดตบริการส่งสำเร็จ")}else{let t=await fetch("/api/pos/delivery/create",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":k},body:JSON.stringify(e)});if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.error||e.message||"ไม่สามารถสร้างบริการส่งได้")}o.ZP.success("สร้างบริการส่งสำเร็จ")}r.push("/pos/delivery")}catch(e){console.error(e),o.ZP.error(e.message||(L?"ไม่สามารถอัปเดตบริการส่งได้":"ไม่สามารถสร้างบริการส่งได้"))}finally{v(!1)}},T=()=>r.push("/pos/delivery");return O?(0,n.jsx)(Z.H,{message:"กำลังตรวจสอบสิทธิ์..."}):M?(0,n.jsxs)("div",{className:"manage-page",style:g.container,children:[(0,n.jsx)(x,{}),(0,n.jsx)(y,{isEdit:L,onBack:T,onDelete:L?()=>{z&&c.Z.confirm({title:"ยืนยันการลบบริการส่ง",content:'คุณต้องการลบบริการส่ง "'.concat(C,'" หรือไม่?'),okText:"ลบ",okType:"danger",cancelText:"ยกเลิก",centered:!0,onOk:async()=>{try{if(!(await fetch("/api/pos/delivery/delete/".concat(z),{method:"DELETE",headers:{"X-CSRF-Token":k}})).ok)throw Error("ไม่สามารถลบบริการส่งได้");o.ZP.success("ลบบริการส่งสำเร็จ"),r.push("/pos/delivery")}catch(e){console.error(e),o.ZP.error("ไม่สามารถลบบริการส่งได้")}}})}:void 0}),(0,n.jsx)("div",{className:"manage-form-card",style:g.formCard,children:h?(0,n.jsx)("div",{style:{display:"flex",justifyContent:"center",padding:"60px 0"},children:(0,n.jsx)(s.Z,{size:"large"})}):(0,n.jsxs)(i.Z,{form:f,layout:"vertical",onFinish:I,requiredMark:!1,autoComplete:"off",initialValues:{is_active:!0},onValuesChange:e=>{void 0!==e.delivery_name&&P(e.delivery_name)},children:[(0,n.jsx)(i.Z.Item,{name:"delivery_name",label:"ชื่อบริการส่ง *",rules:[{required:!0,message:"กรุณากรอกชื่อบริการส่ง"},{max:100,message:"ความยาวต้องไม่เกิน 100 ตัวอักษร"}],children:(0,n.jsx)(l.default,{size:"large",placeholder:"เช่น Grab, Lineman, Food Panda",maxLength:100})}),(0,n.jsx)(i.Z.Item,{name:"delivery_prefix",label:"รหัสย่อ (Prefix)",rules:[{max:10,message:"ความยาวต้องไม่เกิน 10 ตัวอักษร"}],normalize:e=>(e||"").toUpperCase(),children:(0,n.jsx)(l.default,{size:"large",placeholder:"เช่น GF, LM (สำหรับสร้างรหัสออเดอร์อัตโนมัติ)",maxLength:10,style:{textTransform:"uppercase"}})}),(0,n.jsx)(i.Z.Item,{name:"logo",label:"โลโก้ (URL)",rules:[{validator:async(e,t)=>{if(t&&!t.startsWith("data:image"))try{new URL(t);return}catch(e){throw Error("กรุณากรอก URL หรือ Data URI ที่ถูกต้อง")}}}],children:(0,n.jsx)(l.default,{size:"large",placeholder:"https://example.com/logo.png"})}),(0,n.jsx)(i.Z.Item,{noStyle:!0,dependencies:["delivery_name","logo"],children:e=>{let{getFieldValue:t}=e;return(0,n.jsx)(w,{name:t("delivery_name"),logo:t("logo")})}}),(0,n.jsx)(i.Z.Item,{name:"is_active",label:"สถานะการใช้งาน",valuePropName:"checked",style:{marginTop:20},children:(0,n.jsx)(d.Z,{checkedChildren:"เปิดใช้งาน",unCheckedChildren:"ปิดใช้งาน"})}),(0,n.jsx)(b,{isEdit:L,loading:p,onCancel:T})]})})]}):(0,n.jsx)(Z.H,{message:"คุณไม่มีสิทธิ์เข้าถึงหน้านี้",tone:"danger"})}}},function(e){e.O(0,[5015,7717,7698,742,3211,7993,8651,2646,6207,7213,9021,2224,3248,5616,8589,4967,9356,5775,4243,2971,2117,1744],function(){return e(e.s=41019)}),_N_E=e.O()}]);