(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6834],{41019:function(e,r,t){Promise.resolve().then(t.bind(t,79688))},79688:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return A}});var i=t(57437),o=t(2265),a=t(39486),n=t(91652),s=t(51653),l=t(19878),d=t(34029),c=t(53743),g=t(50742),p=t(48651),u=t(47451),x=t(69410),h=t(96931),f=t(88589),y=t(80336),m=t(99376),b=t(25193),v=t(37410),j=t(20148),F=t(29107),w=t(8900),k=t(26349),S=t(88009),C=t(15424),Z=t(78355),_=t(29271),E=t(97235),B=t(67918),R=t(2938),I=t(82967);let{Title:L,Text:P}=a.default,z=e=>{if(!e)return"-";let r=new Date(e);return Number.isNaN(r.getTime())?"-":new Intl.DateTimeFormat("th-TH",{dateStyle:"medium",timeStyle:"short"}).format(r)},T=e=>{let{deliveryName:r,deliveryPrefix:t,logo:o,isActive:a}=e;return(0,i.jsxs)("div",{style:{background:"white",borderRadius:20,padding:20,boxShadow:"0 10px 30px rgba(0,0,0,0.05)",border:"1px solid #F1F5F9"},children:[(0,i.jsx)(L,{level:5,style:{color:"#0891B2",marginBottom:16,fontWeight:700},children:"ตัวอย่างการแสดงผล"}),(0,i.jsxs)("div",{style:{borderRadius:16,border:"1px solid ".concat(a?"#a5f3fc":"#e2e8f0"),padding:14,background:a?"#ecfeff":"#f8fafc",display:"flex",alignItems:"center",gap:12,marginBottom:16},children:[(0,i.jsx)(n.Z,{shape:"square",size:48,src:o||void 0,icon:(0,i.jsx)(F.Z,{}),style:{borderRadius:12,background:a?"linear-gradient(135deg, #cffafe 0%, #a5f3fc 100%)":"#e2e8f0",color:a?"#0891B2":"#64748b"}}),(0,i.jsxs)("div",{style:{textAlign:"left",flex:1},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,i.jsx)(P,{strong:!0,style:{fontSize:16,color:"#0f172a"},children:r||"ชื่อช่องทางจัดส่ง"}),a&&(0,i.jsx)(w.Z,{style:{color:"#10B981",fontSize:14}})]}),(0,i.jsxs)(P,{type:"secondary",style:{fontSize:13,display:"block"},children:["Prefix: ",t||"-"]})]})]}),(0,i.jsx)(s.Z,{type:a?"success":"warning",showIcon:!0,message:a?"ช่องทางนี้พร้อมใช้งานในหน้า POS":"ช่องทางนี้จะไม่แสดงให้เลือกใช้งาน"})]})};function A(e){var r,t;let{params:a}=e,n=(0,m.useRouter)(),[F]=l.Z.useForm(),[w,A]=(0,o.useState)(!1),[N,W]=(0,o.useState)(!1),[O,D]=(0,o.useState)(""),[U,M]=(0,o.useState)(""),[H,q]=(0,o.useState)(""),[V,X]=(0,o.useState)(!0),[Y,G]=(0,o.useState)(""),[J,$]=(0,o.useState)(null),[K,Q]=(0,o.useState)(""),ee=null===(r=a.mode)||void 0===r?void 0:r[0],er=(null===(t=a.mode)||void 0===t?void 0:t[1])||null,et="add"===ee||"edit"===ee,ei="edit"===ee&&!!er,{isAuthorized:eo,isChecking:ea}=(0,B.e)({allowedRoles:["Admin","Manager"]}),en=(0,o.useMemo)(()=>ei?"แก้ไขช่องทางจัดส่ง":"เพิ่มช่องทางจัดส่ง",[ei]);(0,o.useEffect)(()=>{et&&("edit"!==ee||er)||(d.ZP.warning("รูปแบบ URL ไม่ถูกต้อง"),n.replace("/pos/delivery"))},[et,ee,er,n]),(0,o.useEffect)(()=>{(async()=>{G(await (0,E.P)())})()},[]);let es=(0,o.useCallback)(async()=>{if(er){A(!0);try{let e=await fetch("/api/pos/delivery/getById/".concat(er));if(!e.ok)throw Error("ไม่สามารถดึงข้อมูลช่องทางจัดส่งได้");let r=await e.json();F.setFieldsValue({delivery_name:r.delivery_name,delivery_prefix:r.delivery_prefix,logo:r.logo,is_active:r.is_active}),D(r.delivery_name||""),M(r.delivery_prefix||""),q(r.logo||""),X(!!r.is_active),Q((r.delivery_name||"").toLowerCase()),$(r)}catch(e){console.error(e),d.ZP.error("ไม่สามารถดึงข้อมูลช่องทางจัดส่งได้"),n.replace("/pos/delivery")}finally{A(!1)}}},[er,F,n]);(0,o.useEffect)(()=>{ei&&es()},[ei,es]);let el=(0,o.useCallback)(async e=>{let r=e.trim();if(!r||ei&&r.toLowerCase()===K)return!1;try{let e=await fetch("/api/pos/delivery/getByName/".concat(encodeURIComponent(r)));if(!e.ok)return!1;let t=await e.json();if(!(null==t?void 0:t.id)||ei&&t.id===er)return!1;return!0}catch(e){return!1}},[K,er,ei]),ed=async e=>{W(!0);try{var r,t;let i={delivery_name:e.delivery_name.trim(),delivery_prefix:(null===(r=e.delivery_prefix)||void 0===r?void 0:r.trim().toUpperCase())||void 0,logo:(null===(t=e.logo)||void 0===t?void 0:t.trim())||void 0,is_active:e.is_active},o=ei?"/api/pos/delivery/update/".concat(er):"/api/pos/delivery/create",a=ei?"PUT":"POST",s=await fetch(o,{method:a,headers:{"Content-Type":"application/json","X-CSRF-Token":Y},body:JSON.stringify(i)});if(!s.ok){let e=await s.json().catch(()=>({}));throw Error(e.error||e.message||(ei?"ไม่สามารถอัปเดตช่องทางจัดส่งได้":"ไม่สามารถสร้างช่องทางจัดส่งได้"))}d.ZP.success(ei?"อัปเดตช่องทางจัดส่งสำเร็จ":"สร้างช่องทางจัดส่งสำเร็จ"),n.push("/pos/delivery")}catch(e){console.error(e),d.ZP.error(e instanceof Error?e.message:"ไม่สามารถบันทึกข้อมูลได้")}finally{W(!1)}},ec=()=>n.push("/pos/delivery");return ea?(0,i.jsx)(R.H,{message:"กำลังตรวจสอบสิทธิ์..."}):eo?(0,i.jsxs)("div",{className:"manage-page",style:I.R.container,children:[(0,i.jsx)(j.Z,{title:en,subtitle:ei?"ปรับแก้ชื่อ Prefix รูปโลโก้ และสถานะการใช้งาน":"สร้างช่องทางจัดส่งใหม่ให้พร้อมใช้งานในระบบ POS",onBack:ec,actions:ei?(0,i.jsx)(g.ZP,{danger:!0,onClick:()=>{er&&c.Z.confirm({title:"ยืนยันการลบช่องทางจัดส่ง",content:'คุณต้องการลบช่องทางจัดส่ง "'.concat(O||"-",'" หรือไม่?'),okText:"ลบ",okType:"danger",cancelText:"ยกเลิก",centered:!0,icon:(0,i.jsx)(k.Z,{style:{color:"#EF4444"}}),onOk:async()=>{try{if(!(await fetch("/api/pos/delivery/delete/".concat(er),{method:"DELETE",headers:{"X-CSRF-Token":Y}})).ok)throw Error("ไม่สามารถลบช่องทางจัดส่งได้");d.ZP.success("ลบช่องทางจัดส่งสำเร็จ"),n.push("/pos/delivery")}catch(e){console.error(e),d.ZP.error("ไม่สามารถลบช่องทางจัดส่งได้")}}})},icon:(0,i.jsx)(k.Z,{}),children:"ลบ"}):null}),(0,i.jsx)(b.Z,{maxWidth:1040,children:(0,i.jsx)(v.Z,{style:{background:"transparent",border:"none"},children:w?(0,i.jsx)("div",{style:{display:"flex",justifyContent:"center",padding:"90px 0"},children:(0,i.jsx)(p.Z,{size:"large",tip:"กำลังโหลดข้อมูล..."})}):(0,i.jsxs)(u.Z,{gutter:[20,20],children:[(0,i.jsx)(x.Z,{xs:24,lg:15,children:(0,i.jsxs)(h.Z,{bordered:!1,style:{borderRadius:20,boxShadow:"0 4px 20px rgba(0,0,0,0.04)",overflow:"hidden"},styles:{body:{padding:24}},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:10,marginBottom:20},children:[(0,i.jsx)(S.Z,{style:{fontSize:20,color:"#0891B2"}}),(0,i.jsx)(L,{level:5,style:{margin:0},children:"ข้อมูลช่องทางจัดส่ง"})]}),(0,i.jsxs)(l.Z,{form:F,layout:"vertical",onFinish:ed,requiredMark:!1,autoComplete:"off",initialValues:{is_active:!0},onValuesChange:e=>{void 0!==e.delivery_name&&D(e.delivery_name),void 0!==e.delivery_prefix&&M(e.delivery_prefix),void 0!==e.logo&&q(e.logo),void 0!==e.is_active&&X(e.is_active)},children:[(0,i.jsx)(l.Z.Item,{name:"delivery_name",label:(0,i.jsx)("span",{style:{fontWeight:600,color:"#334155"},children:"ชื่อระบบ (delivery_name)"}),validateTrigger:["onBlur","onSubmit"],rules:[{required:!0,message:"กรุณากรอกชื่อระบบ"},{max:100,message:"ความยาวต้องไม่เกิน 100 ตัวอักษร"},{validator:async(e,r)=>{if((null==r?void 0:r.trim())&&await el(r))throw Error("ชื่อระบบนี้ถูกใช้งานแล้ว")}}],children:(0,i.jsx)(f.default,{size:"large",placeholder:"เช่น GrabFood, LINE MAN, ShopeeFood",style:{borderRadius:12,height:46,backgroundColor:"#F8FAFC",border:"1px solid #E2E8F0"},maxLength:100})}),(0,i.jsx)(l.Z.Item,{name:"delivery_prefix",label:(0,i.jsx)("span",{style:{fontWeight:600,color:"#334155"},children:"Prefix"}),rules:[{max:10,message:"ความยาวต้องไม่เกิน 10 ตัวอักษร"},{pattern:/^[A-Za-z0-9_-]*$/,message:"กรอกได้เฉพาะตัวอักษรภาษาอังกฤษ ตัวเลข _ และ -"}],children:(0,i.jsx)(f.default,{size:"large",placeholder:"เช่น GF, LM",style:{borderRadius:12,height:46,backgroundColor:"#F8FAFC",border:"1px solid #E2E8F0",textTransform:"uppercase"},maxLength:10})}),(0,i.jsx)(l.Z.Item,{name:"logo",label:(0,i.jsx)("span",{style:{fontWeight:600,color:"#334155"},children:"URL โลโก้"}),rules:[{validator:async(e,r)=>{if(null==r?void 0:r.trim())try{new URL(r.trim())}catch(e){throw Error("กรุณากรอก URL ที่ถูกต้อง")}}}],children:(0,i.jsx)(f.default,{size:"large",placeholder:"https://example.com/logo.png",style:{borderRadius:12,height:46,backgroundColor:"#F8FAFC",border:"1px solid #E2E8F0"},maxLength:255})}),(0,i.jsx)("div",{style:{padding:"16px",background:"#F8FAFC",borderRadius:14,marginTop:16,marginBottom:18},children:(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:12},children:[(0,i.jsxs)("div",{children:[(0,i.jsx)(P,{strong:!0,style:{fontSize:15,display:"block"},children:"สถานะการใช้งาน"}),(0,i.jsx)(P,{type:"secondary",style:{fontSize:13},children:"เปิดเพื่อให้แสดงในหน้า POS ที่เกี่ยวข้องกับเดลิเวอรี่"})]}),(0,i.jsx)(l.Z.Item,{name:"is_active",valuePropName:"checked",noStyle:!0,children:(0,i.jsx)(y.Z,{style:{background:V?"#10B981":void 0}})})]})}),(0,i.jsx)(s.Z,{showIcon:!0,type:"info",icon:(0,i.jsx)(C.Z,{}),message:"ข้อมูลที่จำเป็น",description:"ต้องกรอกชื่อระบบ และควรกำหนด Prefix ให้สั้นเพื่อใช้อ้างอิงรหัสออเดอร์",style:{marginBottom:24}}),(0,i.jsxs)("div",{style:{marginTop:12,display:"flex",gap:12},children:[(0,i.jsx)(g.ZP,{size:"large",onClick:ec,style:{flex:1,borderRadius:12,height:46,fontWeight:600},children:"ยกเลิก"}),(0,i.jsx)(g.ZP,{type:"primary",htmlType:"submit",loading:N,icon:(0,i.jsx)(Z.Z,{}),style:{flex:2,borderRadius:12,height:46,fontWeight:600,background:"#0891B2",boxShadow:"0 4px 12px rgba(8, 145, 178, 0.25)"},children:"บันทึกข้อมูล"})]})]})]})}),(0,i.jsx)(x.Z,{xs:24,lg:9,children:(0,i.jsxs)("div",{style:{display:"grid",gap:14},children:[(0,i.jsx)(T,{deliveryName:O,deliveryPrefix:U,logo:H,isActive:V}),ei?(0,i.jsxs)(h.Z,{style:{borderRadius:16},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:10},children:[(0,i.jsx)(_.Z,{style:{color:"#0369a1"}}),(0,i.jsx)(P,{strong:!0,children:"รายละเอียดรายการ"})]}),(0,i.jsxs)("div",{style:{display:"grid",gap:8},children:[(0,i.jsxs)(P,{type:"secondary",children:["ID: ",(null==J?void 0:J.id)||"-"]}),(0,i.jsxs)(P,{type:"secondary",children:["สร้างเมื่อ: ",z(null==J?void 0:J.create_date)]}),(0,i.jsxs)(P,{type:"secondary",children:["อัปเดตเมื่อ: ",z(null==J?void 0:J.update_date)]})]})]}):null]})})]})})})]}):(0,i.jsx)(R.H,{message:"คุณไม่มีสิทธิ์เข้าถึงหน้านี้",tone:"danger"})}},82967:function(e,r,t){"use strict";t.d(r,{R:function(){return o},W:function(){return a}});var i=t(69397);let o={...(0,i.yf)("linear-gradient(135deg, #06B6D4 0%, #0891B2 100%)"),deliveryCard:i.YO,deliveryCardInner:i.lv},a=(0,i.IU)(".delivery-page",".delivery-card")},69397:function(e,r,t){"use strict";t.d(r,{IU:function(){return l},YO:function(){return n},lv:function(){return s},yf:function(){return a}});let i={colors:{primary:"#6366F1",primaryLight:"#EEF2FF",success:"#10B981",successLight:"#ECFDF5",warning:"#F59E0B",warningLight:"#FFFBEB",error:"#EF4444",errorLight:"#FEF2F2",info:"#3B82F6",infoLight:"#EFF6FF",bg:"#F8FAFC",card:"#FFFFFF",border:"#E2E8F0",borderLight:"#F1F5F9",text:"#1E293B",textSecondary:"#64748B",textMuted:"#94A3B8"},radius:{sm:8,md:12,lg:16,xl:20},shadow:{sm:"0 1px 2px rgba(0, 0, 0, 0.04)",md:"0 4px 12px rgba(0, 0, 0, 0.06)",lg:"0 8px 24px rgba(0, 0, 0, 0.08)"}},o={container:{paddingBottom:100,backgroundColor:i.colors.bg,minHeight:"100dvh",width:"100%",overflowX:"hidden"},header:{background:"linear-gradient(135deg, ".concat(i.colors.primary," 0%, #4F46E5 100%)"),padding:"16px 16px 48px 16px",position:"relative",overflow:"hidden",borderBottomLeftRadius:i.radius.xl,borderBottomRightRadius:i.radius.xl},headerDecoCircle1:{position:"absolute",top:-40,right:-40,width:120,height:120,borderRadius:"50%",background:"rgba(255,255,255,0.08)"},headerDecoCircle2:{position:"absolute",bottom:-20,left:-20,width:80,height:80,borderRadius:"50%",background:"rgba(255,255,255,0.06)"},headerContent:{position:"relative",zIndex:1,display:"flex",alignItems:"center",justifyContent:"space-between",gap:12},headerLeft:{display:"flex",alignItems:"center",gap:12,flex:1},headerIconBox:{width:44,height:44,borderRadius:i.radius.md,background:"rgba(255,255,255,0.15)",display:"flex",alignItems:"center",justifyContent:"center",backdropFilter:"blur(8px)",flexShrink:0},headerTitle:{color:"#fff",margin:0,fontSize:18,fontWeight:600},headerSubtitle:{color:"rgba(255,255,255,0.8)",fontSize:13,margin:0},headerActions:{display:"flex",gap:8,flexShrink:0},statsCard:{margin:"-32px 16px 0 16px",padding:16,background:i.colors.card,borderRadius:i.radius.lg,boxShadow:i.shadow.md,display:"flex",justifyContent:"space-around",position:"relative",zIndex:10},statItem:{textAlign:"center",flex:1},statNumber:{fontSize:22,fontWeight:700,display:"block",color:i.colors.text},statLabel:{fontSize:12,color:i.colors.textMuted,marginTop:2},listContainer:{padding:"16px 16px 0 16px"},sectionTitle:{display:"flex",alignItems:"center",gap:8,marginBottom:12,fontSize:15,fontWeight:600,color:i.colors.text}},a=e=>({...o,header:{...o.header,background:e}}),n=e=>({marginBottom:12,borderRadius:i.radius.lg,border:"1px solid ".concat(e?i.colors.border:i.colors.borderLight),boxShadow:e?i.shadow.sm:"none",overflow:"hidden",transition:"all 0.2s ease",background:i.colors.card,opacity:e?1:.6}),s={padding:16,display:"flex",alignItems:"center",gap:12};i.radius.md;let l=(e,r)=>"\n  /* Card animations */\n  ".concat(r," {\n    animation: fadeSlideIn 0.3s ease both;\n  }\n  \n  ").concat(r,":hover {\n    transform: translateY(-2px);\n    box-shadow: ").concat(i.shadow.md," !important;\n  }\n  \n  ").concat(r,":active {\n    transform: scale(0.99);\n  }\n  \n  /* Scrollbar */\n  ").concat(e," *::-webkit-scrollbar {\n    width: 5px;\n    height: 5px;\n  }\n  ").concat(e," *::-webkit-scrollbar-track {\n    background: transparent;\n  }\n  ").concat(e," *::-webkit-scrollbar-thumb {\n    background: #CBD5E1;\n    border-radius: 3px;\n  }\n  ").concat(e," *::-webkit-scrollbar-thumb:hover {\n    background: #94A3B8;\n  }\n")}},function(e){e.O(0,[253,1522,3418,742,9486,4252,3916,8651,6931,4159,3831,2224,3248,8879,8589,4221,9878,1652,7134,6796,9385,4390,2971,2117,1744],function(){return e(e.s=41019)}),_N_E=e.O()}]);