(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6834],{41019:function(e,r,i){Promise.resolve().then(i.bind(i,79688))},79688:function(e,r,i){"use strict";i.r(r),i.d(r,{default:function(){return L}});var t=i(57437),s=i(2265),l=i(60283),o=i(91652),a=i(61778),n=i(19878),d=i(34029),c=i(53743),y=i(50742),x=i(48651),p=i(47451),u=i(69410),g=i(96931),h=i(88589),f=i(66487),m=i(99376),v=i(25193),j=i(37410),b=i(20148),Z=i(29107),_=i(8900),k=i(26349),w=i(88009),S=i(15424),F=i(78355),C=i(29271),E=i(97235),P=i(67918),R=i(2938),T=i(82967);let{Title:B,Text:I}=l.default,z=e=>{if(!e)return"-";let r=new Date(e);return Number.isNaN(r.getTime())?"-":new Intl.DateTimeFormat("th-TH",{dateStyle:"medium",timeStyle:"short"}).format(r)},N=e=>{let{deliveryName:r,deliveryPrefix:i,logo:s,isActive:l}=e;return(0,t.jsxs)("div",{style:{background:"white",borderRadius:20,padding:20,boxShadow:"0 10px 30px rgba(0,0,0,0.05)",border:"1px solid #F1F5F9"},children:[(0,t.jsx)(B,{level:5,style:{color:"#0891B2",marginBottom:16,fontWeight:700},children:"ตัวอย่างการแสดงผล"}),(0,t.jsxs)("div",{style:{borderRadius:16,border:"1px solid ".concat(l?"#a5f3fc":"#e2e8f0"),padding:14,background:l?"#ecfeff":"#f8fafc",display:"flex",alignItems:"center",gap:12,marginBottom:16},children:[(0,t.jsx)(o.Z,{shape:"square",size:48,src:s||void 0,icon:(0,t.jsx)(Z.Z,{}),style:{borderRadius:12,background:l?"linear-gradient(135deg, #cffafe 0%, #a5f3fc 100%)":"#e2e8f0",color:l?"#0891B2":"#64748b"}}),(0,t.jsxs)("div",{style:{textAlign:"left",flex:1},children:[(0,t.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,t.jsx)(I,{strong:!0,style:{fontSize:16,color:"#0f172a"},children:r||"ชื่อช่องทางจัดส่ง"}),l&&(0,t.jsx)(_.Z,{style:{color:"#10B981",fontSize:14}})]}),(0,t.jsxs)(I,{type:"secondary",style:{fontSize:13,display:"block"},children:["Prefix: ",i||"-"]})]})]}),(0,t.jsx)(a.Z,{type:l?"success":"warning",showIcon:!0,message:l?"ช่องทางนี้พร้อมใช้งานในหน้า POS":"ช่องทางนี้จะไม่แสดงให้เลือกใช้งาน"})]})};function L(e){var r,i;let{params:l}=e,o=(0,m.useRouter)(),[Z]=n.Z.useForm(),[_,L]=(0,s.useState)(!1),[A,O]=(0,s.useState)(!1),[U,W]=(0,s.useState)(""),[M,D]=(0,s.useState)(""),[q,H]=(0,s.useState)(""),[V,G]=(0,s.useState)(!0),[X,J]=(0,s.useState)(""),[$,K]=(0,s.useState)(null),[Q,Y]=(0,s.useState)(""),ee=null===(r=l.mode)||void 0===r?void 0:r[0],er=(null===(i=l.mode)||void 0===i?void 0:i[1])||null,ei="add"===ee||"edit"===ee,et="edit"===ee&&!!er,{isAuthorized:es,isChecking:el}=(0,P.e)({allowedRoles:["Admin","Manager"]}),eo=(0,s.useMemo)(()=>et?"แก้ไขช่องทางจัดส่ง":"เพิ่มช่องทางจัดส่ง",[et]);(0,s.useEffect)(()=>{ei&&("edit"!==ee||er)||(d.ZP.warning("รูปแบบ URL ไม่ถูกต้อง"),o.replace("/pos/delivery"))},[ei,ee,er,o]),(0,s.useEffect)(()=>{(async()=>{J(await (0,E.P)())})()},[]);let ea=(0,s.useCallback)(async()=>{if(er){L(!0);try{let e=await fetch("/api/pos/delivery/getById/".concat(er));if(!e.ok)throw Error("ไม่สามารถดึงข้อมูลช่องทางจัดส่งได้");let r=await e.json();Z.setFieldsValue({delivery_name:r.delivery_name,delivery_prefix:r.delivery_prefix,logo:r.logo,is_active:r.is_active}),W(r.delivery_name||""),D(r.delivery_prefix||""),H(r.logo||""),G(!!r.is_active),Y((r.delivery_name||"").toLowerCase()),K(r)}catch(e){console.error(e),d.ZP.error("ไม่สามารถดึงข้อมูลช่องทางจัดส่งได้"),o.replace("/pos/delivery")}finally{L(!1)}}},[er,Z,o]);(0,s.useEffect)(()=>{et&&ea()},[et,ea]);let en=(0,s.useCallback)(async e=>{let r=e.trim();if(!r||et&&r.toLowerCase()===Q)return!1;try{let e=await fetch("/api/pos/delivery/getByName/".concat(encodeURIComponent(r)));if(!e.ok)return!1;let i=await e.json();if(!(null==i?void 0:i.id)||et&&i.id===er)return!1;return!0}catch(e){return!1}},[Q,er,et]),ed=async e=>{O(!0);try{var r,i;let t={delivery_name:e.delivery_name.trim(),delivery_prefix:(null===(r=e.delivery_prefix)||void 0===r?void 0:r.trim().toUpperCase())||void 0,logo:(null===(i=e.logo)||void 0===i?void 0:i.trim())||void 0,is_active:e.is_active},s=et?"/api/pos/delivery/update/".concat(er):"/api/pos/delivery/create",l=et?"PUT":"POST",a=await fetch(s,{method:l,headers:{"Content-Type":"application/json","X-CSRF-Token":X},body:JSON.stringify(t)});if(!a.ok){let e=await a.json().catch(()=>({}));throw Error(e.error||e.message||(et?"ไม่สามารถอัปเดตช่องทางจัดส่งได้":"ไม่สามารถสร้างช่องทางจัดส่งได้"))}d.ZP.success(et?"อัปเดตช่องทางจัดส่งสำเร็จ":"สร้างช่องทางจัดส่งสำเร็จ"),o.push("/pos/delivery")}catch(e){console.error(e),d.ZP.error(e instanceof Error?e.message:"ไม่สามารถบันทึกข้อมูลได้")}finally{O(!1)}},ec=()=>o.push("/pos/delivery");return el?(0,t.jsx)(R.H,{message:"กำลังตรวจสอบสิทธิ์..."}):es?(0,t.jsxs)("div",{className:"manage-page",style:T.R.container,children:[(0,t.jsx)(b.Z,{title:eo,subtitle:et?"ปรับแก้ชื่อ Prefix รูปโลโก้ และสถานะการใช้งาน":"สร้างช่องทางจัดส่งใหม่ให้พร้อมใช้งานในระบบ POS",onBack:ec,actions:et?(0,t.jsx)(y.ZP,{danger:!0,onClick:()=>{er&&c.Z.confirm({title:"ยืนยันการลบช่องทางจัดส่ง",content:'คุณต้องการลบช่องทางจัดส่ง "'.concat(U||"-",'" หรือไม่?'),okText:"ลบ",okType:"danger",cancelText:"ยกเลิก",centered:!0,icon:(0,t.jsx)(k.Z,{style:{color:"#EF4444"}}),onOk:async()=>{try{if(!(await fetch("/api/pos/delivery/delete/".concat(er),{method:"DELETE",headers:{"X-CSRF-Token":X}})).ok)throw Error("ไม่สามารถลบช่องทางจัดส่งได้");d.ZP.success("ลบช่องทางจัดส่งสำเร็จ"),o.push("/pos/delivery")}catch(e){console.error(e),d.ZP.error("ไม่สามารถลบช่องทางจัดส่งได้")}}})},icon:(0,t.jsx)(k.Z,{}),children:"ลบ"}):null}),(0,t.jsx)(v.Z,{maxWidth:1040,children:(0,t.jsx)(j.Z,{style:{background:"transparent",border:"none"},children:_?(0,t.jsx)("div",{style:{display:"flex",justifyContent:"center",padding:"90px 0"},children:(0,t.jsx)(x.Z,{size:"large",tip:"กำลังโหลดข้อมูล..."})}):(0,t.jsxs)(p.Z,{gutter:[20,20],children:[(0,t.jsx)(u.Z,{xs:24,lg:15,children:(0,t.jsxs)(g.Z,{bordered:!1,style:{borderRadius:20,boxShadow:"0 4px 20px rgba(0,0,0,0.04)",overflow:"hidden"},styles:{body:{padding:24}},children:[(0,t.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:10,marginBottom:20},children:[(0,t.jsx)(w.Z,{style:{fontSize:20,color:"#0891B2"}}),(0,t.jsx)(B,{level:5,style:{margin:0},children:"ข้อมูลช่องทางจัดส่ง"})]}),(0,t.jsxs)(n.Z,{form:Z,layout:"vertical",onFinish:ed,requiredMark:!1,autoComplete:"off",initialValues:{is_active:!0},onValuesChange:e=>{void 0!==e.delivery_name&&W(e.delivery_name),void 0!==e.delivery_prefix&&D(e.delivery_prefix),void 0!==e.logo&&H(e.logo),void 0!==e.is_active&&G(e.is_active)},children:[(0,t.jsx)(n.Z.Item,{name:"delivery_name",label:(0,t.jsx)("span",{style:{fontWeight:600,color:"#334155"},children:"ชื่อระบบ (delivery_name)"}),validateTrigger:["onBlur","onSubmit"],rules:[{required:!0,message:"กรุณากรอกชื่อระบบ"},{max:100,message:"ความยาวต้องไม่เกิน 100 ตัวอักษร"},{validator:async(e,r)=>{if((null==r?void 0:r.trim())&&await en(r))throw Error("ชื่อระบบนี้ถูกใช้งานแล้ว")}}],children:(0,t.jsx)(h.default,{size:"large",placeholder:"เช่น GrabFood, LINE MAN, ShopeeFood",style:{borderRadius:12,height:46,backgroundColor:"#F8FAFC",border:"1px solid #E2E8F0"},maxLength:100})}),(0,t.jsx)(n.Z.Item,{name:"delivery_prefix",label:(0,t.jsx)("span",{style:{fontWeight:600,color:"#334155"},children:"Prefix"}),rules:[{max:10,message:"ความยาวต้องไม่เกิน 10 ตัวอักษร"},{pattern:/^[A-Za-z0-9_-]*$/,message:"กรอกได้เฉพาะตัวอักษรภาษาอังกฤษ ตัวเลข _ และ -"}],children:(0,t.jsx)(h.default,{size:"large",placeholder:"เช่น GF, LM",style:{borderRadius:12,height:46,backgroundColor:"#F8FAFC",border:"1px solid #E2E8F0",textTransform:"uppercase"},maxLength:10})}),(0,t.jsx)(n.Z.Item,{name:"logo",label:(0,t.jsx)("span",{style:{fontWeight:600,color:"#334155"},children:"URL โลโก้"}),rules:[{validator:async(e,r)=>{if(null==r?void 0:r.trim())try{new URL(r.trim())}catch(e){throw Error("กรุณากรอก URL ที่ถูกต้อง")}}}],children:(0,t.jsx)(h.default,{size:"large",placeholder:"https://example.com/logo.png",style:{borderRadius:12,height:46,backgroundColor:"#F8FAFC",border:"1px solid #E2E8F0"},maxLength:255})}),(0,t.jsx)("div",{style:{padding:"16px",background:"#F8FAFC",borderRadius:14,marginTop:16,marginBottom:18},children:(0,t.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:12},children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(I,{strong:!0,style:{fontSize:15,display:"block"},children:"สถานะการใช้งาน"}),(0,t.jsx)(I,{type:"secondary",style:{fontSize:13},children:"เปิดเพื่อให้แสดงในหน้า POS ที่เกี่ยวข้องกับเดลิเวอรี่"})]}),(0,t.jsx)(n.Z.Item,{name:"is_active",valuePropName:"checked",noStyle:!0,children:(0,t.jsx)(f.Z,{style:{background:V?"#10B981":void 0}})})]})}),(0,t.jsx)(a.Z,{showIcon:!0,type:"info",icon:(0,t.jsx)(S.Z,{}),message:"ข้อมูลที่จำเป็น",description:"ต้องกรอกชื่อระบบ และควรกำหนด Prefix ให้สั้นเพื่อใช้อ้างอิงรหัสออเดอร์",style:{marginBottom:24}}),(0,t.jsxs)("div",{style:{marginTop:12,display:"flex",gap:12},children:[(0,t.jsx)(y.ZP,{size:"large",onClick:ec,style:{flex:1,borderRadius:12,height:46,fontWeight:600},children:"ยกเลิก"}),(0,t.jsx)(y.ZP,{type:"primary",htmlType:"submit",loading:A,icon:(0,t.jsx)(F.Z,{}),style:{flex:2,borderRadius:12,height:46,fontWeight:600,background:"#0891B2",boxShadow:"0 4px 12px rgba(8, 145, 178, 0.25)"},children:"บันทึกข้อมูล"})]})]})]})}),(0,t.jsx)(u.Z,{xs:24,lg:9,children:(0,t.jsxs)("div",{style:{display:"grid",gap:14},children:[(0,t.jsx)(N,{deliveryName:U,deliveryPrefix:M,logo:q,isActive:V}),et?(0,t.jsxs)(g.Z,{style:{borderRadius:16},children:[(0,t.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:10},children:[(0,t.jsx)(C.Z,{style:{color:"#0369a1"}}),(0,t.jsx)(I,{strong:!0,children:"รายละเอียดรายการ"})]}),(0,t.jsxs)("div",{style:{display:"grid",gap:8},children:[(0,t.jsxs)(I,{type:"secondary",children:["ID: ",(null==$?void 0:$.id)||"-"]}),(0,t.jsxs)(I,{type:"secondary",children:["สร้างเมื่อ: ",z(null==$?void 0:$.create_date)]}),(0,t.jsxs)(I,{type:"secondary",children:["อัปเดตเมื่อ: ",z(null==$?void 0:$.update_date)]})]})]}):null]})})]})})})]}):(0,t.jsx)(R.H,{message:"คุณไม่มีสิทธิ์เข้าถึงหน้านี้",tone:"danger"})}}},function(e){e.O(0,[8024,4736,8592,1744],function(){return e(e.s=41019)}),_N_E=e.O()}]);