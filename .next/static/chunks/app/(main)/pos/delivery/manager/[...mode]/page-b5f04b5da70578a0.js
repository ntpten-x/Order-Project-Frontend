(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6834],{41019:function(e,r,t){Promise.resolve().then(t.bind(t,79688))},79688:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return P}});var i=t(57437),o=t(29),s=t.n(o),l=t(2265),a=t(60283),n=t(50742),d=t(19878),c=t(34029),p=t(53743),x=t(48651),g=t(88589),h=t(66487),m=t(99376),u=t(25193),y=t(37410),f=t(20148),b=t(29107),j=t(8900),v=t(78355),w=t(26349),k=t(33145),F=t(82967),E=t(97235),C=t(67918),S=t(2938),Z=t(3369);let{Title:B,Text:z}=a.default,T=()=>(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("style",{children:F.W}),(0,i.jsx)(s(),{id:"2eebb3b1f226f246",children:".ant-form-item-label>label{font-size:15px;font-weight:500;color:#334155}.ant-input-lg,.ant-input-number-lg{-webkit-border-radius:12px;-moz-border-radius:12px;border-radius:12px;padding:10px 16px;font-size:16px;border-color:#E2E8F0}.ant-input-lg:hover,.ant-input-number-lg:hover{border-color:#0891B2}.ant-input-lg:focus,.ant-input-number-lg:focus{border-color:#0891B2;-webkit-box-shadow:0 0 0 2px rgba(8,145,178,.1);-moz-box-shadow:0 0 0 2px rgba(8,145,178,.1);box-shadow:0 0 0 2px rgba(8,145,178,.1)}.ant-card-bordered{border-color:#E2E8F0}"})]}),_=e=>{let{name:r,logo:t}=e;return(0,i.jsxs)("div",{style:{background:"white",borderRadius:24,padding:24,boxShadow:"0 10px 30px rgba(0,0,0,0.05)",border:"1px solid #F1F5F9",height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},children:[(0,i.jsx)(B,{level:5,style:{color:"#94A3B8",marginBottom:20,fontWeight:600,width:"100%",textAlign:"left"},children:"ตัวอย่างการแสดงผล"}),(0,i.jsxs)("div",{style:{width:"100%",background:"white",borderRadius:16,border:"1px solid #E2E8F0",padding:"16px",display:"flex",alignItems:"center",boxShadow:"0 4px 12px rgba(0,0,0,0.03)",maxWidth:400},children:[(0,i.jsx)("div",{style:{width:56,height:56,borderRadius:16,background:"linear-gradient(135deg, #CFFAFE 0%, #A5F3FC 100%)",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,marginRight:16,overflow:"hidden",position:"relative",boxShadow:"0 4px 10px rgba(8, 145, 178, 0.1)"},children:t?(0,i.jsx)(k.default,{src:t,alt:r||"Logo",fill:!0,sizes:"56px",style:{objectFit:"contain",padding:8},onError:e=>{e.target.style.display="none"}}):(0,i.jsx)(b.Z,{style:{fontSize:24,color:"#0891B2"}})}),(0,i.jsx)("div",{style:{flex:1,minWidth:0},children:(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4},children:[(0,i.jsx)(z,{strong:!0,style:{fontSize:16,color:"#1E293B"},children:r||"ชื่อบริการส่ง"}),(0,i.jsx)(j.Z,{style:{color:"#10B981",fontSize:14}})]})})]}),(0,i.jsx)("div",{style:{marginTop:24,textAlign:"center"},children:(0,i.jsx)(z,{type:"secondary",style:{fontSize:13},children:"นี่คือลักษณะที่จะแสดงในรายการ"})})]})},R=e=>{let{isEdit:r,loading:t,onCancel:o}=e;return(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:12,marginTop:40,borderTop:"1px solid #F1F5F9",paddingTop:24},children:[(0,i.jsx)(n.ZP,{size:"large",onClick:o,style:{borderRadius:12,height:48,padding:"0 32px",border:"1px solid #E2E8F0",color:"#64748B",fontWeight:600},children:"ยกเลิก"}),(0,i.jsx)(n.ZP,{type:"primary",htmlType:"submit",loading:t,icon:(0,i.jsx)(v.Z,{}),size:"large",style:{borderRadius:12,height:48,padding:"0 32px",background:"#0891B2",boxShadow:"0 4px 12px rgba(8, 145, 178, 0.3)",fontWeight:600,border:"none"},children:r?"บันทึกการแก้ไข":"สร้างบริการส่ง"})]})};function P(e){let{params:r}=e,t=(0,m.useRouter)(),[o]=d.Z.useForm(),[s,a]=(0,l.useState)(!1),[b,j]=(0,l.useState)(!1),[v,B]=(0,l.useState)(""),[P,N]=(0,l.useState)(""),[I,L]=(0,l.useState)(""),{showLoading:W,hideLoading:A}=(0,Z.x)(),O=r.mode[0],U=r.mode[1]||null,V="edit"===O&&!!U,{isAuthorized:G,isChecking:M}=(0,C.e)({allowedRoles:["Admin","Manager"]});(0,l.useEffect)(()=>{(async()=>{L(await (0,E.P)())})()},[]);let X=(0,l.useCallback)(async()=>{a(!0),W();try{let e=await fetch("/api/pos/delivery/getById/".concat(U));if(!e.ok)throw Error("ไม่สามารถดึงข้อมูลบริการส่งได้");let r=await e.json();o.setFieldsValue({delivery_name:r.delivery_name,delivery_prefix:r.delivery_prefix,logo:r.logo,is_active:r.is_active}),B(r.delivery_name||""),N(r.logo||"")}catch(e){console.error(e),c.ZP.error("ไม่สามารถดึงข้อมูลบริการส่งได้"),t.push("/pos/delivery")}finally{a(!1),A()}},[U,o,t,W,A]);(0,l.useEffect)(()=>{V?X():A()},[V,U,X,A]);let q=async e=>{j(!0);try{if(V){let r=await fetch("/api/pos/delivery/update/".concat(U),{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-Token":I},body:JSON.stringify(e)});if(!r.ok){let e=await r.json().catch(()=>({}));throw Error(e.error||e.message||"ไม่สามารถอัปเดตบริการส่งได้")}c.ZP.success("อัปเดตบริการส่งสำเร็จ")}else{let r=await fetch("/api/pos/delivery/create",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":I},body:JSON.stringify(e)});if(!r.ok){let e=await r.json().catch(()=>({}));throw Error(e.error||e.message||"ไม่สามารถสร้างบริการส่งได้")}c.ZP.success("สร้างบริการส่งสำเร็จ")}t.push("/pos/delivery")}catch(e){console.error(e),c.ZP.error(e.message||(V?"ไม่สามารถอัปเดตบริการส่งได้":"ไม่สามารถสร้างบริการส่งได้"))}finally{j(!1)}},D=()=>t.push("/pos/delivery");return M?(0,i.jsx)(S.H,{message:"กำลังตรวจสอบสิทธิ์..."}):G?(0,i.jsxs)("div",{className:"manage-page",style:F.R.container,children:[(0,i.jsx)(T,{}),(0,i.jsx)(f.Z,{title:V?"แก้ไขบริการส่ง":"เพิ่มบริการส่ง",subtitle:V?"แก้ไขข้อมูลบริการส่ง":"สร้างบริการส่งใหม่",onBack:D,actions:V?(0,i.jsx)(n.ZP,{danger:!0,onClick:()=>{U&&p.Z.confirm({title:"ยืนยันการลบบริการส่ง",content:'คุณต้องการลบบริการส่ง "'.concat(v,'" หรือไม่?'),okText:"ลบ",okType:"danger",cancelText:"ยกเลิก",centered:!0,icon:(0,i.jsx)(w.Z,{style:{color:"#EF4444"}}),maskClosable:!0,onOk:async()=>{try{let e=await fetch("/api/pos/delivery/delete/".concat(U),{method:"DELETE",headers:{"X-CSRF-Token":I}});if(!e.ok){let r=await e.json().catch(()=>({}));throw Error(r.error||r.message||"ไม่สามารถลบบริการส่งได้")}c.ZP.success("ลบบริการส่งสำเร็จ"),t.push("/pos/delivery")}catch(e){console.error(e),c.ZP.error("ไม่สามารถลบบริการส่งได้")}}})},icon:(0,i.jsx)(w.Z,{}),children:"ลบ"}):null}),(0,i.jsx)(u.Z,{maxWidth:1e3,children:(0,i.jsx)(y.Z,{style:{background:"transparent",border:"none"},children:(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,i.jsx)("div",{className:"md:col-span-2",children:(0,i.jsx)("div",{style:{background:"white",borderRadius:24,padding:32,boxShadow:"0 4px 24px rgba(0,0,0,0.04)"},children:s?(0,i.jsx)("div",{style:{display:"flex",justifyContent:"center",padding:"60px 0"},children:(0,i.jsx)(x.Z,{size:"large"})}):(0,i.jsxs)(d.Z,{form:o,layout:"vertical",onFinish:q,requiredMark:!1,autoComplete:"off",initialValues:{is_active:!0},onValuesChange:e=>{void 0!==e.delivery_name&&B(e.delivery_name),void 0!==e.logo&&N(e.logo)},children:[(0,i.jsxs)("div",{style:{marginBottom:24},children:[(0,i.jsx)(z,{strong:!0,style:{fontSize:18,color:"#1E293B",display:"block",marginBottom:16},children:"ข้อมูลทั่วไป"}),(0,i.jsxs)("div",{className:"grid grid-cols-1 gap-6",children:[(0,i.jsx)(d.Z.Item,{name:"delivery_name",label:"ชื่อบริการส่ง *",rules:[{required:!0,message:"กรุณากรอกชื่อบริการส่ง"},{max:100,message:"ความยาวต้องไม่เกิน 100 ตัวอักษร"}],children:(0,i.jsx)(g.default,{size:"large",placeholder:"เช่น Grab, Lineman, Shopee Food",maxLength:100})}),(0,i.jsx)(d.Z.Item,{name:"delivery_prefix",label:"รหัสย่อ (Prefix)",rules:[{max:10,message:"ความยาวต้องไม่เกิน 10 ตัวอักษร"}],normalize:e=>(e||"").toUpperCase(),extra:"ใช้สำหรับสร้างรหัสออเดอร์ (เช่น GF-123)",children:(0,i.jsx)(g.default,{size:"large",placeholder:"เช่น GR, LM",maxLength:10,style:{textTransform:"uppercase",letterSpacing:"1px"}})})]})]}),(0,i.jsxs)("div",{style:{marginBottom:24,borderTop:"1px solid #F1F5F9",paddingTop:24},children:[(0,i.jsx)(z,{strong:!0,style:{fontSize:18,color:"#1E293B",display:"block",marginBottom:16},children:"การแสดงผล"}),(0,i.jsx)(d.Z.Item,{name:"logo",label:"รูป (URL)",rules:[{validator:async(e,r)=>{if(r&&!r.startsWith("data:image"))try{new URL(r);return}catch(e){throw Error("กรุณากรอก URL ที่ถูกต้อง")}}}],children:(0,i.jsx)(g.default,{size:"large",placeholder:"https://example.com/logo.png",allowClear:!0})}),P&&(0,i.jsxs)("div",{style:{marginTop:-16,marginBottom:24,padding:16,background:"#F8FAFC",borderRadius:12,border:"1px dashed #E2E8F0"},children:[(0,i.jsx)(z,{type:"secondary",style:{fontSize:12,display:"block",marginBottom:12},children:"ตัวอย่างรูป"}),(0,i.jsx)("div",{style:{width:80,height:80,borderRadius:12,overflow:"hidden",background:"white",border:"1px solid #E2E8F0",display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:(0,i.jsx)(k.default,{src:P,alt:"Logo Preview",fill:!0,sizes:"80px",style:{objectFit:"contain",padding:8},onError:e=>{e.target.style.display="none"}})})]}),(0,i.jsx)(d.Z.Item,{name:"is_active",label:"สถานะการใช้งาน",valuePropName:"checked",style:{marginBottom:0},children:(0,i.jsx)(h.Z,{checkedChildren:"เปิดใช้งาน",unCheckedChildren:"ปิดใช้งาน",style:{background:o.getFieldValue("is_active")?"#10B981":void 0}})})]}),(0,i.jsx)(R,{isEdit:V,loading:b,onCancel:D})]})})}),(0,i.jsx)("div",{className:"md:col-span-1 hidden md:block",children:(0,i.jsx)("div",{style:{position:"sticky",top:24},children:(0,i.jsx)(_,{name:v,logo:P})})})]})})})]}):(0,i.jsx)(S.H,{message:"คุณไม่มีสิทธิ์เข้าถึงหน้านี้",tone:"danger"})}}},function(e){e.O(0,[8024,4736,8592,1744],function(){return e(e.s=41019)}),_N_E=e.O()}]);