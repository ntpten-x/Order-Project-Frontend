(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6834],{41019:function(e,t,i){Promise.resolve().then(i.bind(i,79688))},79688:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return _}});var r=i(57437),o=i(29),s=i.n(o),l=i(2265),n=i(19683),a=i(50742),d=i(19878),c=i(34029),p=i(53743),x=i(48651),g=i(88589),h=i(66487),y=i(99376),m=i(15327),u=i(26349),f=i(29107),b=i(8900),j=i(78355),v=i(33145),w=i(82967),k=i(97235),F=i(3286),E=i(2938),C=i(3369);let{Title:S,Text:B}=n.default,Z=()=>(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("style",{children:w.W}),(0,r.jsx)(s(),{id:"2eebb3b1f226f246",children:".ant-form-item-label>label{font-size:15px;font-weight:500;color:#334155}.ant-input-lg,.ant-input-number-lg{-webkit-border-radius:12px;-moz-border-radius:12px;border-radius:12px;padding:10px 16px;font-size:16px;border-color:#E2E8F0}.ant-input-lg:hover,.ant-input-number-lg:hover{border-color:#0891B2}.ant-input-lg:focus,.ant-input-number-lg:focus{border-color:#0891B2;-webkit-box-shadow:0 0 0 2px rgba(8,145,178,.1);-moz-box-shadow:0 0 0 2px rgba(8,145,178,.1);box-shadow:0 0 0 2px rgba(8,145,178,.1)}.ant-card-bordered{border-color:#E2E8F0}"})]}),z=e=>{let{isEdit:t,onBack:i,onDelete:o}=e;return(0,r.jsxs)("div",{style:{marginBottom:32,display:"flex",alignItems:"center",justifyContent:"space-between",position:"relative",zIndex:10},children:[(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:16},children:[(0,r.jsx)(a.ZP,{icon:(0,r.jsx)(m.Z,{}),onClick:i,style:{borderRadius:"50%",width:44,height:44,border:"none",background:"white",boxShadow:"0 4px 12px rgba(0,0,0,0.08)",color:"#64748B",display:"flex",alignItems:"center",justifyContent:"center"}}),(0,r.jsxs)("div",{children:[(0,r.jsx)(S,{level:3,style:{margin:0,fontWeight:700,color:"#1E293B",fontSize:24},children:t?"แก้ไขบริการส่ง":"เพิ่มบริการส่งใหม่"}),(0,r.jsx)(B,{type:"secondary",style:{fontSize:14},children:t?"แก้ไขข้อมูลบริการส่งที่มีอยู่":"สร้างบริการส่งใหม่สำหรับร้านของคุณ"})]})]}),t&&o&&(0,r.jsx)(a.ZP,{danger:!0,type:"text",icon:(0,r.jsx)(u.Z,{}),onClick:o,style:{borderRadius:12,height:44,padding:"0 20px",background:"#FEF2F2",color:"#EF4444",fontWeight:600},children:"ลบบริการส่ง"})]})},R=e=>{let{name:t,logo:i}=e;return(0,r.jsxs)("div",{style:{background:"white",borderRadius:24,padding:24,boxShadow:"0 10px 30px rgba(0,0,0,0.05)",border:"1px solid #F1F5F9",height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},children:[(0,r.jsx)(S,{level:5,style:{color:"#94A3B8",marginBottom:20,fontWeight:600,width:"100%",textAlign:"left"},children:"ตัวอย่างการแสดงผล"}),(0,r.jsxs)("div",{style:{width:"100%",background:"white",borderRadius:16,border:"1px solid #E2E8F0",padding:"16px",display:"flex",alignItems:"center",boxShadow:"0 4px 12px rgba(0,0,0,0.03)",maxWidth:400},children:[(0,r.jsx)("div",{style:{width:56,height:56,borderRadius:16,background:"linear-gradient(135deg, #CFFAFE 0%, #A5F3FC 100%)",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,marginRight:16,overflow:"hidden",position:"relative",boxShadow:"0 4px 10px rgba(8, 145, 178, 0.1)"},children:i?(0,r.jsx)(v.default,{src:i,alt:t||"Logo",fill:!0,sizes:"56px",style:{objectFit:"contain",padding:8},onError:e=>{e.target.style.display="none"}}):(0,r.jsx)(f.Z,{style:{fontSize:24,color:"#0891B2"}})}),(0,r.jsx)("div",{style:{flex:1,minWidth:0},children:(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4},children:[(0,r.jsx)(B,{strong:!0,style:{fontSize:16,color:"#1E293B"},children:t||"ชื่อบริการส่ง"}),(0,r.jsx)(b.Z,{style:{color:"#10B981",fontSize:14}})]})})]}),(0,r.jsx)("div",{style:{marginTop:24,textAlign:"center"},children:(0,r.jsx)(B,{type:"secondary",style:{fontSize:13},children:"นี่คือลักษณะที่จะแสดงในรายการ"})})]})},T=e=>{let{isEdit:t,loading:i,onCancel:o}=e;return(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:12,marginTop:40,borderTop:"1px solid #F1F5F9",paddingTop:24},children:[(0,r.jsx)(a.ZP,{size:"large",onClick:o,style:{borderRadius:12,height:48,padding:"0 32px",border:"1px solid #E2E8F0",color:"#64748B",fontWeight:600},children:"ยกเลิก"}),(0,r.jsx)(a.ZP,{type:"primary",htmlType:"submit",loading:i,icon:(0,r.jsx)(j.Z,{}),size:"large",style:{borderRadius:12,height:48,padding:"0 32px",background:"#0891B2",boxShadow:"0 4px 12px rgba(8, 145, 178, 0.3)",fontWeight:600,border:"none"},children:t?"บันทึกการแก้ไข":"สร้างบริการส่ง"})]})};function _(e){let{params:t}=e,i=(0,y.useRouter)(),[o]=d.Z.useForm(),[s,n]=(0,l.useState)(!1),[a,m]=(0,l.useState)(!1),[f,b]=(0,l.useState)(""),[j,S]=(0,l.useState)(""),[_,P]=(0,l.useState)(""),{showLoading:I,hideLoading:N}=(0,C.x)(),L=t.mode[0],W=t.mode[1]||null,A="edit"===L&&!!W,{isAuthorized:O,isChecking:U}=(0,F.e)({requiredRole:"Admin"});(0,l.useEffect)(()=>{(async()=>{P(await (0,k.P)())})()},[]);let V=(0,l.useCallback)(async()=>{n(!0),I();try{let e=await fetch("/api/pos/delivery/getById/".concat(W));if(!e.ok)throw Error("ไม่สามารถดึงข้อมูลบริการส่งได้");let t=await e.json();o.setFieldsValue({delivery_name:t.delivery_name,delivery_prefix:t.delivery_prefix,logo:t.logo,is_active:t.is_active}),b(t.delivery_name||""),S(t.logo||"")}catch(e){console.error(e),c.ZP.error("ไม่สามารถดึงข้อมูลบริการส่งได้"),i.push("/pos/delivery")}finally{n(!1),N()}},[W,o,i,I,N]);(0,l.useEffect)(()=>{A?V():N()},[A,W,V,N]);let q=async e=>{m(!0);try{if(A){let t=await fetch("/api/pos/delivery/update/".concat(W),{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-Token":_},body:JSON.stringify(e)});if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.error||e.message||"ไม่สามารถอัปเดตบริการส่งได้")}c.ZP.success("อัปเดตบริการส่งสำเร็จ")}else{let t=await fetch("/api/pos/delivery/create",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":_},body:JSON.stringify(e)});if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.error||e.message||"ไม่สามารถสร้างบริการส่งได้")}c.ZP.success("สร้างบริการส่งสำเร็จ")}i.push("/pos/delivery")}catch(e){console.error(e),c.ZP.error(e.message||(A?"ไม่สามารถอัปเดตบริการส่งได้":"ไม่สามารถสร้างบริการส่งได้"))}finally{m(!1)}},D=()=>i.push("/pos/delivery");return U?(0,r.jsx)(E.H,{message:"กำลังตรวจสอบสิทธิ์..."}):O?(0,r.jsxs)("div",{className:"manage-page",style:w.R.container,children:[(0,r.jsx)(Z,{}),(0,r.jsxs)("div",{style:{maxWidth:1e3,margin:"0 auto",position:"relative",zIndex:1,paddingBottom:40},children:[(0,r.jsx)(z,{isEdit:A,onBack:D,onDelete:A?()=>{W&&p.Z.confirm({title:"ยืนยันการลบบริการส่ง",content:'คุณต้องการลบบริการส่ง "'.concat(f,'" หรือไม่?'),okText:"ลบ",okType:"danger",cancelText:"ยกเลิก",centered:!0,icon:(0,r.jsx)(u.Z,{style:{color:"#EF4444"}}),maskClosable:!0,onOk:async()=>{try{let e=await fetch("/api/pos/delivery/delete/".concat(W),{method:"DELETE",headers:{"X-CSRF-Token":_}});if(!e.ok){let t=await e.json().catch(()=>({}));throw Error(t.error||t.message||"ไม่สามารถลบบริการส่งได้")}c.ZP.success("ลบบริการส่งสำเร็จ"),i.push("/pos/delivery")}catch(e){console.error(e),c.ZP.error("ไม่สามารถลบบริการส่งได้")}}})}:void 0}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,r.jsx)("div",{className:"md:col-span-2",children:(0,r.jsx)("div",{style:{background:"white",borderRadius:24,padding:32,boxShadow:"0 4px 24px rgba(0,0,0,0.04)"},children:s?(0,r.jsx)("div",{style:{display:"flex",justifyContent:"center",padding:"60px 0"},children:(0,r.jsx)(x.Z,{size:"large"})}):(0,r.jsxs)(d.Z,{form:o,layout:"vertical",onFinish:q,requiredMark:!1,autoComplete:"off",initialValues:{is_active:!0},onValuesChange:e=>{void 0!==e.delivery_name&&b(e.delivery_name),void 0!==e.logo&&S(e.logo)},children:[(0,r.jsxs)("div",{style:{marginBottom:24},children:[(0,r.jsx)(B,{strong:!0,style:{fontSize:18,color:"#1E293B",display:"block",marginBottom:16},children:"ข้อมูลทั่วไป"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 gap-6",children:[(0,r.jsx)(d.Z.Item,{name:"delivery_name",label:"ชื่อบริการส่ง *",rules:[{required:!0,message:"กรุณากรอกชื่อบริการส่ง"},{max:100,message:"ความยาวต้องไม่เกิน 100 ตัวอักษร"}],children:(0,r.jsx)(g.default,{size:"large",placeholder:"เช่น Grab, Lineman, Shopee Food",maxLength:100})}),(0,r.jsx)(d.Z.Item,{name:"delivery_prefix",label:"รหัสย่อ (Prefix)",rules:[{max:10,message:"ความยาวต้องไม่เกิน 10 ตัวอักษร"}],normalize:e=>(e||"").toUpperCase(),extra:"ใช้สำหรับสร้างรหัสออเดอร์ (เช่น GF-123)",children:(0,r.jsx)(g.default,{size:"large",placeholder:"เช่น GR, LM",maxLength:10,style:{textTransform:"uppercase",letterSpacing:"1px"}})})]})]}),(0,r.jsxs)("div",{style:{marginBottom:24,borderTop:"1px solid #F1F5F9",paddingTop:24},children:[(0,r.jsx)(B,{strong:!0,style:{fontSize:18,color:"#1E293B",display:"block",marginBottom:16},children:"การแสดงผล"}),(0,r.jsx)(d.Z.Item,{name:"logo",label:"รูป (URL)",rules:[{validator:async(e,t)=>{if(t&&!t.startsWith("data:image"))try{new URL(t);return}catch(e){throw Error("กรุณากรอก URL ที่ถูกต้อง")}}}],children:(0,r.jsx)(g.default,{size:"large",placeholder:"https://example.com/logo.png",allowClear:!0})}),j&&(0,r.jsxs)("div",{style:{marginTop:-16,marginBottom:24,padding:16,background:"#F8FAFC",borderRadius:12,border:"1px dashed #E2E8F0"},children:[(0,r.jsx)(B,{type:"secondary",style:{fontSize:12,display:"block",marginBottom:12},children:"ตัวอย่างรูป"}),(0,r.jsx)("div",{style:{width:80,height:80,borderRadius:12,overflow:"hidden",background:"white",border:"1px solid #E2E8F0",display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:(0,r.jsx)(v.default,{src:j,alt:"Logo Preview",fill:!0,sizes:"80px",style:{objectFit:"contain",padding:8},onError:e=>{e.target.style.display="none"}})})]}),(0,r.jsx)(d.Z.Item,{name:"is_active",label:"สถานะการใช้งาน",valuePropName:"checked",style:{marginBottom:0},children:(0,r.jsx)(h.Z,{checkedChildren:"เปิดใช้งาน",unCheckedChildren:"ปิดใช้งาน",style:{background:o.getFieldValue("is_active")?"#10B981":void 0}})})]}),(0,r.jsx)(T,{isEdit:A,loading:a,onCancel:D})]})})}),(0,r.jsx)("div",{className:"md:col-span-1 hidden md:block",children:(0,r.jsx)("div",{style:{position:"sticky",top:24},children:(0,r.jsx)(R,{name:f,logo:j})})})]})]})]}):(0,r.jsx)(E.H,{message:"คุณไม่มีสิทธิ์เข้าถึงหน้านี้",tone:"danger"})}}},function(e){e.O(0,[8024,4736,8592,1744],function(){return e(e.s=41019)}),_N_E=e.O()}]);