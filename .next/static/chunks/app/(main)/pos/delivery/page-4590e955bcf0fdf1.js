(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[561],{80329:function(e,t,i){Promise.resolve().then(i.bind(i,95905))},95905:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return H}});var l=i(57437),r=i(2265),s=i(60283),a=i(91652),n=i(80009),o=i(66487),c=i(50742),d=i(53743),y=i(34029),f=i(24783),p=i(88589),h=i(24738),x=i(29107),u=i(13377),v=i(26349),g=i(62376),j=i(89245),m=i(96473),b=i(29436),k=i(99376),Z=i(3369),w=i(26972),_=i(24675),C=i(97235),S=i(67918),P=i(67697),E=i(73814),T=i(12028),R=i(82967),z=i(2938),A=i(25193),N=i(37410),D=i(27623),I=i(20148),W=i(2786);let{Text:B}=s.default,F=e=>{let t=new Date(e);return Number.isNaN(t.getTime())?"-":new Intl.DateTimeFormat("th-TH",{dateStyle:"medium",timeStyle:"short"}).format(t)},L=e=>{let{totalDelivery:t,activeDelivery:i,inactiveDelivery:r}=e;return(0,l.jsxs)("div",{style:{background:"#fff",borderRadius:16,border:"1px solid #e2e8f0",display:"grid",gridTemplateColumns:"repeat(3, minmax(0, 1fr))",gap:8,padding:14},children:[(0,l.jsxs)("div",{style:{textAlign:"center"},children:[(0,l.jsx)("span",{style:{fontSize:24,fontWeight:700,color:"#0f172a",display:"block"},children:t}),(0,l.jsx)(B,{style:{fontSize:12,color:"#64748b"},children:"ทั้งหมด"})]}),(0,l.jsxs)("div",{style:{textAlign:"center"},children:[(0,l.jsx)("span",{style:{fontSize:24,fontWeight:700,color:"#0891B2",display:"block"},children:i}),(0,l.jsx)(B,{style:{fontSize:12,color:"#64748b"},children:"ใช้งาน"})]}),(0,l.jsxs)("div",{style:{textAlign:"center"},children:[(0,l.jsx)("span",{style:{fontSize:24,fontWeight:700,color:"#b91c1c",display:"block"},children:r}),(0,l.jsx)(B,{style:{fontSize:12,color:"#64748b"},children:"ปิดใช้งาน"})]})]})},O=e=>{let{delivery:t,onEdit:i,onDelete:r,onToggleActive:s,updatingStatusId:d}=e;return(0,l.jsx)("div",{className:"delivery-card",style:{...R.R.deliveryCard(t.is_active),borderRadius:16},onClick:()=>i(t),children:(0,l.jsxs)("div",{style:R.R.deliveryCardInner,children:[(0,l.jsx)(a.Z,{shape:"square",size:52,src:t.logo||void 0,icon:(0,l.jsx)(x.Z,{}),style:{borderRadius:14,background:t.is_active?"linear-gradient(135deg, #cffafe 0%, #a5f3fc 100%)":"#f1f5f9",color:t.is_active?"#0891B2":"#94a3b8",boxShadow:t.is_active?"0 4px 10px rgba(8, 145, 178, 0.18)":"none"}}),(0,l.jsxs)("div",{style:{flex:1,minWidth:0,paddingRight:8},children:[(0,l.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4},children:[(0,l.jsx)(B,{strong:!0,style:{fontSize:16,color:"#0f172a"},ellipsis:{tooltip:t.delivery_name},children:t.delivery_name}),(0,l.jsx)(n.Z,{color:t.is_active?"green":"default",children:t.is_active?"ใช้งาน":"ปิดใช้งาน"})]}),(0,l.jsxs)(B,{type:"secondary",style:{fontSize:13,display:"block",color:"#334155"},children:["Prefix: ",t.delivery_prefix||"-"]}),(0,l.jsxs)(B,{type:"secondary",style:{fontSize:12,display:"block",marginTop:2},children:["อัปเดตล่าสุด ",F(t.update_date)]})]}),(0,l.jsxs)("div",{style:{display:"flex",gap:6,alignItems:"center"},children:[(0,l.jsx)(o.Z,{size:"small",checked:t.is_active,loading:d===t.id,onClick:(e,i)=>{null==i||i.stopPropagation(),s(t,e)}}),(0,l.jsx)(c.ZP,{type:"text",icon:(0,l.jsx)(u.Z,{}),onClick:e=>{e.stopPropagation(),i(t)},style:{borderRadius:10,color:"#0891B2",background:"#ecfeff",width:36,height:36}}),(0,l.jsx)(c.ZP,{type:"text",danger:!0,icon:(0,l.jsx)(v.Z,{}),onClick:e=>{e.stopPropagation(),r(t)},style:{borderRadius:10,background:"#fef2f2",width:36,height:36}})]})]})})};function H(){let e=(0,k.useRouter)(),[t,i]=(0,r.useState)([]),[s,a]=(0,r.useState)(""),[n,o]=(0,r.useState)("all"),[u,B]=(0,r.useState)(null),{execute:F}=(0,w.J)(),{showLoading:H}=(0,Z.x)(),{socket:J}=(0,_.s)(),{isAuthorized:M,isChecking:X}=(0,S.e)({allowedRoles:["Admin","Manager"]});(0,r.useEffect)(()=>{(0,C.P)()},[]),(0,r.useEffect)(()=>{let e=(0,E.t)("pos:delivery-providers",3e5);e&&e.length>0&&i(e)},[]);let q=(0,r.useCallback)(async()=>{F(async()=>{let e=await fetch("/api/pos/delivery?limit=200");if(!e.ok){let t=await e.json().catch(()=>({}));throw Error(t.error||t.message||"ไม่สามารถดึงข้อมูลช่องทางจัดส่งได้")}let t=await e.json(),l=Array.isArray(t)?t:null==t?void 0:t.data;if(!Array.isArray(l))throw Error("รูปแบบข้อมูลไม่ถูกต้อง");i(l)},"กำลังโหลดข้อมูลช่องทางจัดส่ง...")},[F]);(0,r.useEffect)(()=>{M&&q()},[M,q]),(0,P.v)(J,{create:T.b.delivery.create,update:T.b.delivery.update,delete:T.b.delivery.delete},i),(0,r.useEffect)(()=>{t.length>0&&(0,E.v)("pos:delivery-providers",t)},[t]);let U=(0,r.useMemo)(()=>{let e=t;"active"===n?e=e.filter(e=>e.is_active):"inactive"===n&&(e=e.filter(e=>!e.is_active));let i=s.trim().toLowerCase();return i&&(e=e.filter(e=>e.delivery_name.toLowerCase().includes(i)||(e.delivery_prefix||"").toLowerCase().includes(i))),e},[t,s,n]),G=()=>{H("กำลังเปิดหน้าจัดการช่องทางจัดส่ง..."),e.push("/pos/delivery/manager/add")},K=t=>{H("กำลังเปิดหน้าแก้ไขช่องทางจัดส่ง..."),e.push("/pos/delivery/manager/edit/".concat(t.id))},Q=e=>{d.Z.confirm({title:"ยืนยันการลบช่องทางจัดส่ง",content:'คุณต้องการลบช่องทางจัดส่ง "'.concat(e.delivery_name,'" หรือไม่?'),okText:"ลบ",okType:"danger",cancelText:"ยกเลิก",centered:!0,icon:(0,l.jsx)(v.Z,{style:{color:"#EF4444"}}),onOk:async()=>{await F(async()=>{let t=await (0,C.P)();if(!(await fetch("/api/pos/delivery/delete/".concat(e.id),{method:"DELETE",headers:{"X-CSRF-Token":t}})).ok)throw Error("ไม่สามารถลบช่องทางจัดส่งได้");i(t=>t.filter(t=>t.id!==e.id)),y.ZP.success('ลบช่องทางจัดส่ง "'.concat(e.delivery_name,'" สำเร็จ'))},"กำลังลบช่องทางจัดส่ง...")}})},V=async(e,t)=>{B(e.id);try{let l=await (0,C.P)(),r=await fetch("/api/pos/delivery/update/".concat(e.id),{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-Token":l},body:JSON.stringify({is_active:t})});if(!r.ok){let e=await r.json().catch(()=>({}));throw Error(e.error||e.message||"ไม่สามารถเปลี่ยนสถานะช่องทางจัดส่งได้")}let s=await r.json();i(t=>t.map(t=>t.id===e.id?s:t)),y.ZP.success(t?"เปิดใช้งานช่องทางจัดส่งแล้ว":"ปิดใช้งานช่องทางจัดส่งแล้ว")}catch(e){console.error(e),y.ZP.error(e instanceof Error?e.message:"ไม่สามารถเปลี่ยนสถานะช่องทางจัดส่งได้")}finally{B(null)}};if(X)return(0,l.jsx)(z.H,{message:"กำลังตรวจสอบสิทธิ์การใช้งาน..."});if(!M)return(0,l.jsx)(z.H,{message:"คุณไม่มีสิทธิ์เข้าถึงหน้านี้ กำลังพากลับ...",tone:"danger"});let Y=t.filter(e=>e.is_active).length,$=t.filter(e=>!e.is_active).length;return(0,l.jsxs)("div",{className:"delivery-page",style:R.R.container,children:[(0,l.jsx)("style",{children:R.W}),(0,l.jsx)(I.Z,{title:"ช่องทางจัดส่ง",subtitle:"ทั้งหมด ".concat(t.length," รายการ"),icon:(0,l.jsx)(x.Z,{}),actions:(0,l.jsxs)(f.Z,{size:8,wrap:!0,children:[(0,l.jsx)(c.ZP,{icon:(0,l.jsx)(g.Z,{}),onClick:()=>e.push("/pos/orders"),children:"ไปหน้าออเดอร์"}),(0,l.jsx)(c.ZP,{icon:(0,l.jsx)(j.Z,{}),onClick:q}),(0,l.jsx)(c.ZP,{type:"primary",icon:(0,l.jsx)(m.Z,{}),onClick:G,children:"เพิ่มช่องทางจัดส่ง"})]})}),(0,l.jsx)(A.Z,{children:(0,l.jsxs)(D.Z,{children:[(0,l.jsx)(L,{totalDelivery:t.length,activeDelivery:Y,inactiveDelivery:$}),(0,l.jsx)(N.Z,{title:"ค้นหาและตัวกรอง",children:(0,l.jsxs)("div",{style:{display:"grid",gap:10,gridTemplateColumns:"1fr",alignItems:"center"},children:[(0,l.jsx)(p.default,{prefix:(0,l.jsx)(b.Z,{style:{color:"#94A3B8"}}),allowClear:!0,placeholder:"ค้นหาจากชื่อช่องทาง หรือ prefix...",value:s,onChange:e=>a(e.target.value)}),(0,l.jsx)(h.Z,{options:[{label:"ทั้งหมด (".concat(t.length,")"),value:"all"},{label:"ใช้งาน (".concat(Y,")"),value:"active"},{label:"ปิดใช้งาน (".concat($,")"),value:"inactive"}],value:n,onChange:e=>o(e)})]})}),(0,l.jsx)(N.Z,{title:"รายการช่องทางจัดส่ง",extra:(0,l.jsx)("span",{style:{fontWeight:600},children:U.length}),children:U.length>0?U.map(e=>(0,l.jsx)(O,{delivery:e,onEdit:K,onDelete:Q,onToggleActive:V,updatingStatusId:u},e.id)):(0,l.jsx)(W.Z,{title:s.trim()?"ไม่พบช่องทางจัดส่งตามคำค้น":"ยังไม่มีช่องทางจัดส่ง",description:s.trim()?"ลองเปลี่ยนคำค้น หรือตัวกรองสถานะ":"เพิ่มช่องทางจัดส่งแรกเพื่อเริ่มใช้งาน",action:s.trim()?null:(0,l.jsx)(c.ZP,{type:"primary",icon:(0,l.jsx)(m.Z,{}),onClick:G,children:"เพิ่มช่องทางจัดส่ง"})})})]})})]})}}},function(e){e.O(0,[8024,4736,8592,1744],function(){return e(e.s=80329)}),_N_E=e.O()}]);