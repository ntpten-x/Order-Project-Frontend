(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4900],{62121:function(e,r,t){Promise.resolve().then(t.bind(t,34841))},34841:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return T}});var s=t(57437),l=t(29),a=t.n(l),n=t(42785),o=t(2265),d=t(19683),i=t(38616),c=t(80009),y=t(23496),m=t(50742),h=t(88589),u=t(96931),x=t(73179),p=t(85180),j=t(35631),g=t(6520),f=t(17588),v=t(63680),b=t(89245),_=t(5540),S=t(99376),L=t(32446),k=t(61414),w=t(1165),N=t(12093),Z=t(29827),C=t(11713),D=t(45345),z=t(46252),I=t(53286),R=t(71096),P=t.n(R);t(6729);let{Title:E,Text:W}=d.default,{useBreakpoint:H}=i.default;function T(){let e=(0,S.useRouter)(),r=!H().md;(0,n.yV)();let[t,l]=(0,o.useState)(1),[d,i]=(0,o.useState)(""),R=(0,N.c)(d.trim(),400);(0,o.useEffect)(()=>{l(1)},[R]);let{orders:T,total:B,isLoading:O,refetch:Y}=function(e){let{page:r=1,limit:t=50,status:s,type:l,query:a}=e,{socket:n}=(0,o.useContext)(z.J),d=(0,Z.NL)(),{data:i,error:c,isLoading:y,isFetching:m,refetch:h}=(0,C.a)({queryKey:["ordersSummary",r,t,s||"all",l||"all",a||""],queryFn:async()=>await I.x.getAllSummary(void 0,r,t,s,l,a),placeholderData:D.Wk,staleTime:3e3});return(0,o.useEffect)(()=>{if(!n)return;let e=()=>{d.invalidateQueries({queryKey:["ordersSummary"]})};return n.on("orders:create",e),n.on("orders:update",e),n.on("orders:delete",e),n.on("payments:create",e),n.on("payments:update",e),()=>{n.off("orders:create",e),n.off("orders:update",e),n.off("orders:delete",e),n.off("payments:create",e),n.off("payments:update",e)}},[n,d]),{orders:(null==i?void 0:i.data)||[],total:(null==i?void 0:i.total)||0,currentPage:(null==i?void 0:i.page)||r,lastPage:(null==i?void 0:i.last_page)||1,isLoading:y,isFetching:m,isError:c,refetch:h}}({page:t,limit:10,status:"Pending,Cooking,Served,WaitingForPayment",query:R||void 0}),A=[{title:"เลขที่ออเดอร์",dataIndex:"order_no",key:"order_no",align:"center",render:e=>(0,s.jsx)(W,{strong:!0,style:{whiteSpace:"nowrap"},children:e})},{title:"วันเวลา",dataIndex:"create_date",key:"date",align:"center",render:e=>(0,s.jsxs)("div",{style:{whiteSpace:"nowrap"},children:[(0,s.jsx)(W,{children:P()(e).format("DD MMM YYYY")}),(0,s.jsx)("br",{}),(0,s.jsx)(W,{type:"secondary",style:{fontSize:12},children:P()(e).format("HH:mm")})]})},{title:"ประเภท",dataIndex:"order_type",key:"type",align:"center",render:e=>(0,s.jsx)(c.Z,{color:(0,k.Gs)(e),style:{margin:0},children:(0,k.mz)(e)})},{title:"โต๊ะ / รหัสอ้างอิง",key:"reference",align:"center",render:(e,r)=>{let t=(0,k.jN)(r),l="default";return r.order_type===L.m.DineIn&&(l="cyan"),r.order_type===L.m.Delivery&&(l="orange"),(0,s.jsx)(c.Z,{color:l,style:{margin:0},children:t})}},{title:"รายละเอียดรายการ",key:"items_summary",width:200,align:"center",render:(e,r)=>{let t=r.items_summary||{},l=r.items_count||0,a=Object.entries(t);return 0===l?(0,s.jsx)(W,{type:"secondary",children:"-"}):(0,s.jsxs)("div",{style:{fontSize:13,lineHeight:"1.6",textAlign:"left",display:"inline-block",minWidth:140},children:[a.length>0?(0,s.jsxs)(s.Fragment,{children:[a.map(e=>{let[r,t]=e;return(0,s.jsxs)("div",{style:w.L2.summaryRow,children:[(0,s.jsx)(W,{type:"secondary",children:r}),(0,s.jsxs)(W,{strong:!0,children:[t," รายการ"]})]},r)}),(0,s.jsx)(y.Z,{style:{margin:"4px 0"}})]}):null,(0,s.jsxs)("div",{style:w.L2.summaryRowBold,children:[(0,s.jsx)(W,{strong:!0,children:"รวม"}),(0,s.jsxs)(W,{strong:!0,style:{color:w.mv.primary},children:[l," รายการ"]})]})]})}},{title:"ยอดรวม",dataIndex:"total_amount",key:"total",align:"center",render:e=>(0,s.jsx)(W,{strong:!0,style:{whiteSpace:"nowrap"},children:(0,k.xG)(e)})},{title:"สถานะ",dataIndex:"status",key:"status",align:"center",render:e=>(0,s.jsx)(c.Z,{color:(0,k.OY)(e),style:{margin:0},children:(0,k.d7)(e)})},{title:"จัดการ",key:"action",align:"center",render:(r,t)=>(0,s.jsx)(m.ZP,{type:"primary",icon:(0,s.jsx)(g.Z,{}),onClick:()=>e.push("/pos/orders/".concat(t.id)),style:{whiteSpace:"nowrap"},children:"ดูรายละเอียด"})}];return(0,s.jsxs)("div",{style:w.L2.container,children:[(0,s.jsx)(a(),{id:w.$k.__hash,children:w.$k}),(0,s.jsx)("header",{style:w.L2.header,role:"banner",className:"orders-header",children:(0,s.jsxs)("div",{style:w.L2.headerContent,className:"orders-content orders-header-content-mobile",children:[(0,s.jsx)(m.ZP,{icon:(0,s.jsx)(f.Z,{}),onClick:()=>e.push("/pos"),type:"text",className:"orders-back-button-mobile","aria-label":"กลับไปหน้า POS",style:{color:"#fff",fontSize:18,marginRight:12,width:44,height:44,borderRadius:14,background:"rgba(255,255,255,0.15)",backdropFilter:"blur(8px)",border:"1px solid rgba(255,255,255,0.25)",display:"flex",alignItems:"center",justifyContent:"center"}}),(0,s.jsx)("div",{style:w.L2.headerIcon,className:"orders-header-icon",children:(0,s.jsx)(v.Z,{style:{color:"#fff",fontSize:24}})}),(0,s.jsxs)("div",{style:w.L2.headerTextContainer,className:"orders-header-text-mobile",children:[(0,s.jsx)(E,{level:2,style:w.L2.headerTitle,className:"orders-page-title",children:"รายการออเดอร์ปัจจุบัน"}),(0,s.jsx)(W,{style:w.L2.headerSubtitle,className:"orders-page-subtitle",children:"จัดการและติดตามสถานะออเดอร์ที่กำลังดำเนินการ"})]}),(0,s.jsxs)("div",{style:{display:"flex",gap:10,flexWrap:"wrap"},className:"orders-header-actions-mobile",children:[(0,s.jsx)(h.default,{allowClear:!0,placeholder:"ค้นหาออเดอร์...",value:d,onChange:e=>i(e.target.value),size:r?"middle":"large",className:"orders-search-input-mobile",style:{width:r?140:280,minWidth:120,borderRadius:12}}),(0,s.jsx)(m.ZP,{icon:(0,s.jsx)(b.Z,{}),onClick:()=>Y(),size:r?"middle":"large",ghost:!0,className:"orders-refresh-button-mobile scale-hover",style:{borderRadius:12,border:"1px solid rgba(255,255,255,0.4)"},children:(0,s.jsx)("span",{className:"hide-on-mobile",children:"รีเฟรช"})})]})]})}),(0,s.jsx)("main",{style:w.L2.contentWrapper,className:"orders-content-wrapper",children:(0,s.jsx)(u.Z,{bordered:!1,style:{borderRadius:20,boxShadow:w.mv.cardShadow,border:"1px solid rgba(226, 232, 240, 0.8)"},styles:{body:w.L2.cardBody},children:r?(0,s.jsx)(j.Z,{loading:O,dataSource:T,renderItem:r=>{let t=r.items_count||0;return(0,s.jsxs)("article",{style:{...w.L2.orderCard,marginBottom:14},onClick:()=>e.push("/pos/orders/".concat(r.id)),role:"button",tabIndex:0,"aria-label":"ออเดอร์ ".concat(r.order_no),onKeyDown:t=>"Enter"===t.key&&e.push("/pos/orders/".concat(r.id)),className:"orders-card fade-in",children:[(0,s.jsxs)("div",{style:w.L2.cardHeader,className:"orders-card-header",children:[(0,s.jsxs)("div",{style:w.L2.cardHeaderLeft,children:[(0,s.jsxs)(W,{strong:!0,style:{fontSize:17,color:w.mv.text},children:["#",r.order_no]}),(0,s.jsx)(c.Z,{color:(0,k.OY)(r.status),style:{margin:0,borderRadius:8,fontWeight:600},children:(0,k.d7)(r.status)})]}),(0,s.jsx)(c.Z,{color:(0,k.Gs)(r.order_type),style:{borderRadius:8,fontWeight:600},children:(0,k.mz)(r.order_type)})]}),(0,s.jsxs)("div",{style:w.L2.cardBody,className:"orders-card-body",children:[(0,s.jsxs)("div",{style:w.L2.refSection,children:[r.order_type===L.m.DineIn&&r.table&&(0,s.jsxs)("div",{style:w.L2.refValue,className:"orders-ref-value",children:["\uD83E\uDE91 โต๊ะ ",r.table.table_name]}),(r.order_type===L.m.Delivery||r.order_type===L.m.TakeAway)&&(0,s.jsxs)("div",{style:w.L2.refValue,className:"orders-ref-value",children:["\uD83D\uDCCB ",r.delivery_code?"Ref: ".concat(r.delivery_code):"-"]})]}),(0,s.jsxs)("div",{style:w.L2.itemsSummary,children:[(0,s.jsxs)("div",{style:w.L2.metaSection,children:[(0,s.jsx)(v.Z,{style:{color:w.mv.primary}}),(0,s.jsxs)(W,{strong:!0,style:{color:w.mv.text},children:[t," รายการ"]})]}),(0,s.jsxs)("div",{style:w.L2.metaSection,children:[(0,s.jsx)(_.Z,{style:{color:w.mv.textSecondary}}),(0,s.jsx)(W,{style:{color:w.mv.textSecondary},children:P()(r.create_date).format("HH:mm น.")})]})]}),(0,s.jsxs)("div",{style:w.L2.totalSection,children:[(0,s.jsx)(W,{style:w.L2.totalLabel,children:"ยอดรวม"}),(0,s.jsx)("div",{style:w.L2.totalAmount,className:"orders-total-amount",children:(0,k.xG)(Number(r.total_amount))})]}),(0,s.jsx)(m.ZP,{type:"primary",ghost:!0,icon:(0,s.jsx)(g.Z,{}),style:w.L2.actionButton,className:"scale-hover",children:"ดูรายละเอียด"})]})]})},pagination:{current:t,pageSize:10,total:B,onChange:e=>l(e),size:"small",style:{textAlign:"center",marginTop:16}}}):(0,s.jsx)(x.Z,{columns:A,dataSource:T,loading:O,rowKey:"id",virtual:!0,scroll:{y:600},pagination:{current:t,pageSize:10,total:B,onChange:e=>l(e),showTotal:e=>"ทั้งหมด ".concat(e," รายการ")},locale:{emptyText:(0,s.jsx)(p.Z,{description:"ไม่พบรายการออเดอร์"})}})})})]})}P().locale("th")}},function(e){e.O(0,[8024,4736,8592,1744],function(){return e(e.s=62121)}),_N_E=e.O()}]);