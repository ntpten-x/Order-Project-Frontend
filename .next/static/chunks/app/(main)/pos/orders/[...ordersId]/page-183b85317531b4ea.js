(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1304,3490],{8118:function(e,t,n){Promise.resolve().then(n.bind(n,536))},89245:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var r=n(2265),i={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M909.1 209.3l-56.4 44.1C775.8 155.1 656.2 92 521.9 92 290 92 102.3 279.5 102 511.5 101.7 743.7 289.8 932 521.9 932c181.3 0 335.8-115 394.6-276.1 1.5-4.2-.7-8.9-4.9-10.3l-56.7-19.5a8 8 0 00-10.1 4.8c-1.8 5-3.8 10-5.9 14.9-17.3 41-42.1 77.8-73.7 109.4A344.77 344.77 0 01655.9 829c-42.3 17.9-87.4 27-133.8 27-46.5 0-91.5-9.1-133.8-27A341.5 341.5 0 01279 755.2a342.16 342.16 0 01-73.7-109.4c-17.9-42.4-27-87.4-27-133.9s9.1-91.5 27-133.9c17.3-41 42.1-77.8 73.7-109.4 31.6-31.6 68.4-56.4 109.3-73.8 42.3-17.9 87.4-27 133.8-27 46.5 0 91.5 9.1 133.8 27a341.5 341.5 0 01109.3 73.8c9.9 9.9 19.2 20.4 27.8 31.4l-60.2 47a8 8 0 003 14.1l175.6 43c5 1.2 9.9-2.6 9.9-7.7l.8-180.9c-.1-6.6-7.8-10.3-13-6.2z"}}]},name:"reload",theme:"outlined"},l=n(55015);function o(){return(o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var a=r.forwardRef((e,t)=>r.createElement(l.Z,o({},e,{ref:t,icon:i})))},67605:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var r=n(2265),i={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M864 736c0-111.6-65.4-208-160-252.9V317.3c0-15.1-5.3-29.7-15.1-41.2L536.5 95.4C530.1 87.8 521 84 512 84s-18.1 3.8-24.5 11.4L335.1 276.1a63.97 63.97 0 00-15.1 41.2v165.8C225.4 528 160 624.4 160 736h156.5c-2.3 7.2-3.5 15-3.5 23.8 0 22.1 7.6 43.7 21.4 60.8a97.2 97.2 0 0043.1 30.6c23.1 54 75.6 88.8 134.5 88.8 29.1 0 57.3-8.6 81.4-24.8 23.6-15.8 41.9-37.9 53-64a97 97 0 0043.1-30.5 97.52 97.52 0 0021.4-60.8c0-8.4-1.1-16.4-3.1-23.8H864zM762.3 621.4c9.4 14.6 17 30.3 22.5 46.6H700V558.7a211.6 211.6 0 0162.3 62.7zM388 483.1V318.8l124-147 124 147V668H388V483.1zM239.2 668c5.5-16.3 13.1-32 22.5-46.6 16.3-25.2 37.5-46.5 62.3-62.7V668h-84.8zm388.9 116.2c-5.2 3-11.2 4.2-17.1 3.4l-19.5-2.4-2.8 19.4c-5.4 37.9-38.4 66.5-76.7 66.5-38.3 0-71.3-28.6-76.7-66.5l-2.8-19.5-19.5 2.5a27.7 27.7 0 01-17.1-3.5c-8.7-5-14.1-14.3-14.1-24.4 0-10.6 5.9-19.4 14.6-23.8h231.3c8.8 4.5 14.6 13.3 14.6 23.8-.1 10.2-5.5 19.6-14.2 24.5zM464 400a48 48 0 1096 0 48 48 0 10-96 0z"}}]},name:"rocket",theme:"outlined"},l=n(55015);function o(){return(o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var a=r.forwardRef((e,t)=>r.createElement(l.Z,o({},e,{ref:t,icon:i})))},78355:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var r=n(2265),i={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M893.3 293.3L730.7 130.7c-7.5-7.5-16.7-13-26.7-16V112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V338.5c0-17-6.7-33.2-18.7-45.2zM384 184h256v104H384V184zm456 656H184V184h136v136c0 17.7 14.3 32 32 32h320c17.7 0 32-14.3 32-32V205.8l136 136V840zM512 442c-79.5 0-144 64.5-144 144s64.5 144 144 144 144-64.5 144-144-64.5-144-144-144zm0 224c-44.2 0-80-35.8-80-80s35.8-80 80-80 80 35.8 80 80-35.8 80-80 80z"}}]},name:"save",theme:"outlined"},l=n(55015);function o(){return(o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var a=r.forwardRef((e,t)=>r.createElement(l.Z,o({},e,{ref:t,icon:i})))},40312:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var r=n(2265),i={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M922.9 701.9H327.4l29.9-60.9 496.8-.9c16.8 0 31.2-12 34.2-28.6l68.8-385.1c1.8-10.1-.9-20.5-7.5-28.4a34.99 34.99 0 00-26.6-12.5l-632-2.1-5.4-25.4c-3.4-16.2-18-28-34.6-28H96.5a35.3 35.3 0 100 70.6h125.9L246 312.8l58.1 281.3-74.8 122.1a34.96 34.96 0 00-3 36.8c6 11.9 18.1 19.4 31.5 19.4h62.8a102.43 102.43 0 00-20.6 61.7c0 56.6 46 102.6 102.6 102.6s102.6-46 102.6-102.6c0-22.3-7.4-44-20.6-61.7h161.1a102.43 102.43 0 00-20.6 61.7c0 56.6 46 102.6 102.6 102.6s102.6-46 102.6-102.6c0-22.3-7.4-44-20.6-61.7H923c19.4 0 35.3-15.8 35.3-35.3a35.42 35.42 0 00-35.4-35.2zM305.7 253l575.8 1.9-56.4 315.8-452.3.8L305.7 253zm96.9 612.7c-17.4 0-31.6-14.2-31.6-31.6 0-17.4 14.2-31.6 31.6-31.6s31.6 14.2 31.6 31.6a31.6 31.6 0 01-31.6 31.6zm325.1 0c-17.4 0-31.6-14.2-31.6-31.6 0-17.4 14.2-31.6 31.6-31.6s31.6 14.2 31.6 31.6a31.6 31.6 0 01-31.6 31.6z"}}]},name:"shopping-cart",theme:"outlined"},l=n(55015);function o(){return(o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var a=r.forwardRef((e,t)=>r.createElement(l.Z,o({},e,{ref:t,icon:i})))},52539:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var r=n(2265),i={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 312H696v-16c0-101.6-82.4-184-184-184s-184 82.4-184 184v16H192c-17.7 0-32 14.3-32 32v536c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V344c0-17.7-14.3-32-32-32zm-432-16c0-61.9 50.1-112 112-112s112 50.1 112 112v16H400v-16zm392 544H232V384h96v88c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-88h224v88c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-88h96v456z"}}]},name:"shopping",theme:"outlined"},l=n(55015);function o(){return(o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var a=r.forwardRef((e,t)=>r.createElement(l.Z,o({},e,{ref:t,icon:i})))},41598:function(e,t,n){"use strict";n.d(t,{S:function(){return s},Z:function(){return d}});var r=n(2265),i=n(64928),l=n(52631),o=n(89056),a=n(13861);function s(e){return(0,a.qo)(e).join("_")}function c(e,t){let n=t.getFieldInstance(e),r=(0,l.bn)(n);if(r)return r;let i=(0,a.dD)((0,a.qo)(e),t.__INTERNAL__.name);if(i)return document.getElementById(i)}function d(e){let[t]=(0,i.cI)(),n=r.useRef({}),l=r.useMemo(()=>null!=e?e:{...t,__INTERNAL__:{itemRef:e=>t=>{let r=s(e);t?n.current[r]=t:delete n.current[r]}},scrollToField:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{focus:n,...r}=t,i=c(e,l);i&&((0,o.Z)(i,{scrollMode:"if-needed",block:"nearest",...r}),n&&l.focusField(e))},focusField:e=>{let t=l.getFieldInstance(e);if("function"==typeof(null==t?void 0:t.focus))t.focus();else{var n,r;null===(r=c(e,l))||void 0===r||null===(n=r.focus)||void 0===n||n.call(r)}},getFieldInstance:e=>{let t=s(e);return n.current[t]}},[e,t]);return[l]}},13861:function(e,t,n){"use strict";n.d(t,{dD:function(){return l},lR:function(){return o},qo:function(){return i}});let r=["parentNode"];function i(e){return void 0===e||!1===e?[]:Array.isArray(e)?e:[e]}function l(e,t){if(!e.length)return;let n=e.join("_");return t?"".concat(t,"_").concat(n):r.includes(n)?"".concat("form_item","_").concat(n):n}function o(e,t,n,r,i,l){let o=r;return void 0!==l?o=l:n.validating?o="validating":e.length?o="error":t.length?o="warning":(n.touched||i&&n.validated)&&(o="success"),o}},536:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return ep}});var r=n(57437),i=n(29),l=n.n(i),o=n(2265),a=n(99376),s=n(82646),c=n(34029),d=n(85180),u=n(24783),h=n(80009),p=n(89970),y=n(50742),g=n(47451),f=n(69410),m=n(96931),x=n(4156),j=n(2297),v=n(23496),b=n(62376),w=n(15424),S=n(9738),_=n(13377),k=n(26349),C=n(49638),Z=n(17588),T=n(52539),P=n(67605),B=n(89245),E=n(96473),z=n(83669),A=n(53286),R=n(97235),O=n(66290),N=n(32446),I=n(34962),L=n(1165),D=n(61414),F=n(71096),M=n.n(F);n(6729);var H=n(33145),W=n(53743),q=n(88589),G=n(33477),U=n(29436),V=n(40312),X=n(22623),Y=n(2838),J=n(47799),$=n(3369);let{Text:Q,Title:K}=s.default,ee=e=>{let{isOpen:t,onClose:n,onAddItem:i}=e,[a,s]=(0,o.useState)([]),[u,h]=(0,o.useState)([]),[p,g]=(0,o.useState)([]),[f,m]=(0,o.useState)(null),[x,j]=(0,o.useState)(""),{showLoading:b,hideLoading:w}=(0,$.x)(),[S,_]=(0,o.useState)(null),[T,P]=(0,o.useState)(1),[B,z]=(0,o.useState)(""),[A,R]=(0,o.useState)([]),O=(0,o.useCallback)(async()=>{try{b("กำลังโหลดข้อมูลสินค้า...");let[e,t]=await Promise.all([J.R.findAll(1,100),Y.G.findAll()]);s(e.data),h(e.data),g(t)}catch(e){c.ZP.error("ไม่สามารถโหลดข้อมูลได้")}finally{w()}},[b,w]),N=(0,o.useCallback)(()=>{P(1),z(""),R([]),_(null),j("")},[]);(0,o.useEffect)(()=>{t&&(O(),N())},[O,t,N]);let I=e=>{m(e),F(x,e)},F=(e,t)=>{let n=a;t&&(n=n.filter(e=>e.category_id===t)),e&&(n=n.filter(t=>t.display_name.toLowerCase().includes(e.toLowerCase()))),h(n)},M=e=>{_(e),P(1),z(""),R([])},ee=(e,t,n)=>{R(r=>r.map(r=>{if(r.id!==e)return r;if("price"===t){let e="number"==typeof n?n:Number(n)||0;return{...r,price:e}}return{...r,name:String(n)}}))},et=e=>{R(t=>t.filter(t=>t.id!==e))},en=async()=>{if(S)try{b("กำลังเพิ่มรายการ...");let e=A.filter(e=>""!==e.name.trim()).map(e=>({detail_name:e.name,extra_price:e.price}));await i(S,T,B,e),c.ZP.success("เพิ่มรายการเรียบร้อย"),n(),_(null)}catch(e){}finally{w()}};return(0,r.jsxs)(W.Z,{className:"mobile-fullscreen-modal",title:null,open:t,onCancel:n,footer:null,width:850,destroyOnClose:!0,centered:!0,children:[(0,r.jsx)(l(),{id:L.$k.__hash,children:L.$k}),(0,r.jsxs)("div",{style:L.il.modalHeader,children:[S?(0,r.jsx)(y.ZP,{type:"text",icon:(0,r.jsx)(Z.Z,{}),onClick:()=>_(null),style:{height:40,width:40,borderRadius:"50%"}}):(0,r.jsx)(y.ZP,{type:"text",icon:(0,r.jsx)(C.Z,{}),onClick:n,style:{height:40,width:40,borderRadius:"50%"}}),(0,r.jsx)(Q,{strong:!0,style:{fontSize:20,flex:1},children:S?"ระบุรายละเอียด":"เลือกสินค้า"})]}),S?(0,r.jsx)("div",{style:L.m4.detailSection,children:(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:20},children:[(0,r.jsxs)("div",{style:{display:"flex",gap:16,alignItems:"flex-start"},children:[S.img_url?(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(H.default,{src:S.img_url,alt:S.display_name,width:100,height:100,style:{objectFit:"cover",borderRadius:12}})}):(0,r.jsx)("div",{style:{width:100,height:100,background:L._A.backgroundSecondary,borderRadius:12,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:(0,r.jsx)(V.Z,{style:{fontSize:32,opacity:.2}})}),(0,r.jsxs)("div",{children:[(0,r.jsx)(K,{level:4,style:{margin:"0 0 4px 0",fontSize:22},children:S.display_name}),(0,r.jsxs)(Q,{style:{fontSize:22,fontWeight:700,color:L._A.primary},children:["฿",Number(S.price).toLocaleString()]})]})]}),(0,r.jsx)(v.Z,{style:{margin:"0"}}),(0,r.jsxs)("div",{children:[(0,r.jsx)(Q,{strong:!0,style:{display:"block",marginBottom:12,fontSize:16},children:"จำนวน"}),(0,r.jsxs)("div",{style:L.il.quantityControl,children:[(0,r.jsx)(y.ZP,{type:"primary",icon:(0,r.jsx)(X.Z,{}),onClick:()=>P(e=>Math.max(1,e-1)),disabled:T<=1,style:{...L.il.quantityButton,background:L._A.white,color:L._A.primary,border:"1px solid ".concat(L._A.primary)}}),(0,r.jsx)("div",{style:L.il.quantityDisplay,children:T}),(0,r.jsx)(y.ZP,{type:"primary",icon:(0,r.jsx)(E.Z,{}),onClick:()=>P(e=>e+1),style:L.il.quantityButton})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[(0,r.jsx)(Q,{strong:!0,style:{fontSize:16},children:"ตัวเลือกเพิ่มเติม (Optional)"}),(0,r.jsx)(y.ZP,{size:"small",type:"dashed",onClick:()=>{R(e=>[...e,{id:Date.now(),name:"",price:0}])},icon:(0,r.jsx)(E.Z,{}),children:"เพิ่ม"})]}),A.map(e=>(0,r.jsxs)("div",{style:L.m4.detailItemRow,children:[(0,r.jsx)(q.default,{placeholder:"ไข่ดาว, พิเศษ...",value:e.name,onChange:t=>ee(e.id,"name",t.target.value),style:{flex:1,borderRadius:8}}),(0,r.jsx)(G.Z,{placeholder:"0.00",value:e.price,onChange:t=>ee(e.id,"price",t||0),style:{width:100,borderRadius:8,height:40},inputMode:"decimal",controls:!1,min:0,precision:2,formatter:e=>"".concat(e).replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:e=>e.replace(/\$\s?|(,*)/g,""),onKeyDown:t=>{/^[0-9]$/.test(t.key)||["Backspace","Delete","ArrowLeft","ArrowRight","Tab","Enter","."].includes(t.key)||t.preventDefault(),"."===t.key&&e.price.toString().includes(".")&&t.preventDefault()}}),(0,r.jsx)(y.ZP,{type:"text",danger:!0,icon:(0,r.jsx)(k.Z,{}),onClick:()=>et(e.id)})]},e.id))]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(Q,{strong:!0,style:{display:"block",marginBottom:8,fontSize:16},children:"หมายเหตุ"}),(0,r.jsx)(q.default.TextArea,{rows:2,value:B,onChange:e=>z(e.target.value),placeholder:"เช่น ไม่ใส่ผัก, เผ็ดน้อย...",style:{borderRadius:12,fontSize:16,padding:"10px"}})]}),(0,r.jsxs)("div",{style:{marginTop:20},children:[(0,r.jsxs)("div",{style:{...L.il.priceCard,marginBottom:16,padding:"16px"},children:[(0,r.jsx)(Q,{strong:!0,style:{fontSize:16},children:"ยอดรวมรายการนี้"}),(0,r.jsx)(Q,{style:{...L.il.priceValue,fontSize:24},children:(0,D.xG)((()=>{if(!S)return 0;let e=A.map(e=>({detail_name:e.name,extra_price:e.price}));return(0,D.ku)(S.price,T,e)})())})]}),(0,r.jsxs)("div",{style:{display:"flex",gap:12},children:[(0,r.jsx)(y.ZP,{onClick:()=>_(null),style:L.il.secondaryButton,children:"ย้อนกลับ"}),(0,r.jsx)(y.ZP,{type:"primary",onClick:en,icon:(0,r.jsx)(E.Z,{}),style:L.il.primaryButton,children:"เพิ่มลงออเดอร์"})]})]})]})}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{style:{...L.m4.searchBar,paddingBottom:8},children:[(0,r.jsx)(q.default,{placeholder:"ค้นหาสินค้าหรือรหัส...",prefix:(0,r.jsx)(U.Z,{style:{color:L._A.textSecondary}}),value:x,onChange:e=>{let t=e.target.value;j(t),F(t,f)},allowClear:!0,style:{...L.m4.searchInput,marginBottom:12}}),(0,r.jsxs)("div",{style:{display:"flex",overflowX:"auto",gap:8,paddingBottom:4,scrollBehavior:"smooth",scrollbarWidth:"none",msOverflowStyle:"none"},className:"hide-scrollbar",children:[(0,r.jsx)(y.ZP,{size:"middle",type:null===f?"primary":"default",onClick:()=>I(null),style:{borderRadius:20,minWidth:70,border:null===f?"none":"1px solid ".concat(L._A.border)},children:"ทั้งหมด"}),p.map(e=>(0,r.jsx)(y.ZP,{size:"middle",type:f===e.id?"primary":"default",onClick:()=>I(e.id),style:{borderRadius:20,border:f===e.id?"none":"1px solid ".concat(L._A.border)},children:e.display_name||e.category_name},e.id))]})]}),(0,r.jsxs)("div",{style:{maxHeight:"calc(100vh - 130px)",overflowY:"auto"},className:"order-detail-content",children:[(0,r.jsx)("div",{style:L.m4.productGrid,className:"product-grid",children:u.map(e=>(0,r.jsxs)("div",{style:L.m4.productCard,onClick:()=>M(e),className:"product-card-hoverable scale-in",children:[(0,r.jsx)("div",{style:{position:"relative",width:"100%",height:120},children:e.img_url?(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(H.default,{alt:e.display_name,src:e.img_url,fill:!0,style:{objectFit:"cover",borderRadius:"12px 12px 0 0"},sizes:"(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw"})}):(0,r.jsx)("div",{style:L.m4.productPlaceholder,children:(0,r.jsx)(V.Z,{style:{fontSize:24,opacity:.3}})})}),(0,r.jsxs)("div",{style:L.m4.productInfo,children:[(0,r.jsx)("div",{style:{...L.m4.productName,fontSize:18,lineHeight:1.3},children:e.display_name}),(0,r.jsx)(Q,{style:{...L.m4.productPrice,fontSize:16},children:(0,D.xG)(e.price)})]})]},e.id))}),0===u.length&&(0,r.jsx)(d.Z,{description:"ไม่พบสินค้าที่คุณต้องการ",style:{marginTop:60}})]})]})]})};var et=n(78355);let{Text:en,Title:er}=s.default,{TextArea:ei}=q.default,el=e=>{var t,n,i,l,a,s;let{item:c,isOpen:d,onClose:p,onSave:g}=e,[f,m]=(0,o.useState)(1),[x,j]=(0,o.useState)(""),[b,S]=(0,o.useState)([]),{showLoading:_,hideLoading:Z}=(0,$.x)();(0,o.useEffect)(()=>{c&&d&&(m(c.quantity),j(c.notes||""),S(c.details?[...c.details.map(e=>({...e}))]:[]))},[c,d]);let T=async()=>{if(c)try{_("กำลังบันทึกแก้ไข..."),await g(c.id,f,x,b),p()}catch(e){}finally{Z()}},P=e=>{S(b.filter((t,n)=>n!==e))},B=(e,t,n)=>{let r=[...b];r[e]={...r[e],[t]:n},S(r)};return c?(0,r.jsxs)(W.Z,{className:"mobile-fullscreen-modal",title:null,open:d,onCancel:p,footer:null,width:480,destroyOnClose:!0,centered:!0,closable:!1,children:[(0,r.jsxs)("div",{style:{...L.il.modalHeader,padding:"12px 16px"},children:[(0,r.jsx)(en,{strong:!0,style:{fontSize:18,flex:1},children:"แก้ไขรายการ"}),(0,r.jsx)(y.ZP,{type:"text",icon:(0,r.jsx)(C.Z,{}),onClick:p,style:{height:32,width:32,display:"flex",alignItems:"center",justifyContent:"center",marginRight:-8}})]}),(0,r.jsxs)("div",{style:{padding:"16px",maxHeight:"70vh",overflowY:"auto"},children:[(0,r.jsxs)("div",{style:{display:"flex",gap:16,marginBottom:20,alignItems:"center"},children:[(0,r.jsx)("div",{style:{flexShrink:0},children:(null===(t=c.product)||void 0===t?void 0:t.img_url)?(0,r.jsx)(H.default,{src:c.product.img_url,alt:null!==(s=null===(n=c.product)||void 0===n?void 0:n.display_name)&&void 0!==s?s:"สินค้า",width:80,height:80,style:{borderRadius:12,objectFit:"cover",border:"1px solid ".concat(L._A.border)}}):(0,r.jsx)("div",{style:{width:80,height:80,borderRadius:12,background:L._A.backgroundSecondary,display:"flex",alignItems:"center",justifyContent:"center"},children:(0,r.jsx)(w.Z,{style:{fontSize:24,color:L._A.textSecondary}})})}),(0,r.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,r.jsx)(er,{level:5,style:{margin:0,fontSize:18},children:(null===(i=c.product)||void 0===i?void 0:i.display_name)||"ไม่ระบุ"}),(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginTop:4},children:[(null===(a=c.product)||void 0===a?void 0:null===(l=a.category)||void 0===l?void 0:l.display_name)&&(0,r.jsx)(h.Z,{color:"cyan",style:{fontSize:10,margin:0,borderRadius:4},children:c.product.category.display_name}),(0,r.jsx)(en,{type:"secondary",style:{fontSize:14},children:(0,D.xG)(c.price)})]})]})]}),(0,r.jsx)(v.Z,{style:{margin:"16px 0"}}),(0,r.jsxs)("div",{style:{marginBottom:24},children:[(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[(0,r.jsx)(en,{strong:!0,style:{fontSize:16},children:"รายการเพิ่มเติม (Topping)"}),(0,r.jsx)(y.ZP,{type:"text",icon:(0,r.jsx)(E.Z,{style:{fontSize:12}}),onClick:()=>{S([...b,{detail_name:"",extra_price:0}])},style:{borderRadius:"30px",background:L._A.primaryLight,color:L._A.primary,fontWeight:700,fontSize:"13px",height:"32px",padding:"0 16px",border:"1px solid ".concat(L._A.primary,"40"),display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.3s ease"},className:"scale-hover",children:"เพิ่มรายการ"})]}),0===b.length?(0,r.jsx)("div",{style:{textAlign:"center",padding:"12px",background:"#f9f9f9",borderRadius:8},children:(0,r.jsx)(en,{type:"secondary",style:{fontSize:13},children:"ไม่มีรายการเพิ่มเติม"})}):(0,r.jsx)(u.Z,{direction:"vertical",style:{width:"100%"},size:10,children:b.map((e,t)=>(0,r.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"flex-start"},children:[(0,r.jsx)(q.default,{placeholder:"รายการ",value:e.detail_name,onChange:e=>B(t,"detail_name",e.target.value),style:{flex:2,borderRadius:8}}),(0,r.jsx)(G.Z,{placeholder:"ราคา",value:e.extra_price,onChange:e=>B(t,"extra_price",e||0),style:{flex:1,borderRadius:8,height:40},inputMode:"decimal",controls:!1,min:0,precision:2,formatter:e=>"".concat(e).replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:e=>e.replace(/\$\s?|(,*)/g,""),onKeyDown:t=>{/^[0-9]$/.test(t.key)||["Backspace","Delete","ArrowLeft","ArrowRight","Tab","Enter","."].includes(t.key)||t.preventDefault(),"."===t.key&&e.extra_price.toString().includes(".")&&t.preventDefault()}}),(0,r.jsx)(y.ZP,{danger:!0,type:"text",icon:(0,r.jsx)(k.Z,{}),onClick:()=>P(t),style:{color:L._A.danger}})]},t))})]}),(0,r.jsxs)("div",{style:{marginBottom:24},children:[(0,r.jsx)(en,{strong:!0,style:{display:"block",marginBottom:12,fontSize:16},children:"ปรับจำนวน"}),(0,r.jsxs)("div",{style:{...L.il.quantityControl,padding:"8px",borderRadius:12},children:[(0,r.jsx)(y.ZP,{type:"primary",icon:(0,r.jsx)(X.Z,{}),onClick:()=>{m(e=>Math.max(1,e-1))},disabled:f<=1,style:{...L.il.quantityButton,background:L._A.white,color:L._A.primary,border:"1px solid ".concat(L._A.primary)}}),(0,r.jsx)("div",{style:L.il.quantityDisplay,children:f}),(0,r.jsx)(y.ZP,{type:"primary",icon:(0,r.jsx)(E.Z,{}),onClick:()=>{m(e=>e+1)},style:L.il.quantityButton})]})]}),(0,r.jsxs)("div",{style:{marginBottom:24},children:[(0,r.jsx)(en,{strong:!0,style:{display:"block",marginBottom:8,fontSize:16},children:"หมายเหตุ / คำแนะนำพิเศษ"}),(0,r.jsx)(ei,{value:x,onChange:e=>j(e.target.value),placeholder:"เช่น หวานน้อย, ไม่ใส่น้ำตาล...",rows:2,style:{borderRadius:10,padding:"10px 14px",fontSize:16}})]}),(0,r.jsxs)("div",{style:{...L.il.priceCard,padding:"12px 16px",borderRadius:12,background:L._A.primaryLight},children:[(0,r.jsx)(en,{strong:!0,style:{fontSize:16},children:"ยอดรวมรายการนี้"}),(0,r.jsxs)(er,{level:4,style:{margin:0,color:L._A.primary},children:["฿",(0,D.ku)(Number(c.price),f,b).toLocaleString()]})]})]}),(0,r.jsxs)("div",{style:{...L.il.actionButtons,padding:"16px",borderTop:"1px solid ".concat(L._A.border)},children:[(0,r.jsx)(y.ZP,{onClick:p,style:{...L.il.secondaryButton,flex:1},children:"ยกเลิก"}),(0,r.jsx)(y.ZP,{type:"primary",onClick:T,icon:(0,r.jsx)(et.Z,{}),style:{...L.il.primaryButton,flex:2},children:"บันทึกแก้ไข"})]})]}):null};var eo=n(60300),ea=n(20920),es=n(84859),ec=n(24675),ed=n(67697);let{Title:eu,Text:eh}=s.default;function ep(){var e,t,n;let i=(0,a.useRouter)(),s=(0,a.useParams)(),F=Array.isArray(null==s?void 0:s.ordersId)?s.ordersId[0]:null==s?void 0:s.ordersId,[H,W]=(0,o.useState)(null),[q,G]=(0,o.useState)(!0),[U,V]=(0,o.useState)(!1),{showLoading:X,hideLoading:Y}=(0,$.x)(),{socket:J}=(0,ec.s)(),Q=(0,ea.L)(),[K,et]=(0,o.useState)([]),[en,er]=(0,o.useState)(!1),[ei,ep]=(0,o.useState)(null),[ey,eg]=(0,o.useState)(!1),[ef,em]=(0,o.useState)({open:!1,type:"confirm",title:"",content:"",onOk:()=>{}}),ex=()=>em(e=>({...e,open:!1})),ej=(0,o.useCallback)(async e=>{try{G(!0),X("กำลังโหลดข้อมูลออเดอร์...");let t=await A.x.getById(e);if([N.i.Paid,N.i.Cancelled,N.i.WaitingForPayment].includes(t.status)){let e=(0,D.EO)(t);i.push(e);return}W(t)}catch(e){console.error("Failed to fetch order:",e),c.ZP.error("ไม่สามารถโหลดข้อมูลออเดอร์ได้")}finally{G(!1),Y()}},[i,X,Y]);(0,o.useEffect)(()=>{F&&ej(F)},[F,ej]),(0,ed.D)({socket:J,events:["orders:update","orders:delete","orders:create","payments:create","payments:update"],onRefresh:()=>{F&&ej(F)},intervalMs:15e3,enabled:!!F});let ev=async e=>{try{V(!0),X("กำลังดำเนินการเสิร์ฟ...");let t=await (0,R.P)();await A.x.updateItemStatus(e,N.i.Served,void 0,t),c.ZP.success("เสิร์ฟรายการเรียบร้อย"),ej(F)}catch(e){c.ZP.error("เกิดข้อผิดพลาดในการเสิร์ฟ")}finally{V(!1),Y()}},eb=async()=>{if(0!==K.length)try{V(!0),X("กำลังดำเนินการเสิร์ฟ ".concat(K.length," รายการ..."));let e=await (0,R.P)();await Promise.all(K.map(t=>A.x.updateItemStatus(t.toString(),N.i.Served,void 0,e))),c.ZP.success("เสิร์ฟรายการที่เลือกเรียบร้อย"),et([]),ej(F)}catch(e){c.ZP.error("เกิดข้อผิดพลาดในการเสิร์ฟ")}finally{V(!1),Y()}},ew=async()=>{0!==K.length&&em({open:!0,type:"danger",title:"ยืนยันการยกเลิก",content:"คุณต้องการยกเลิก ".concat(K.length," รายการที่เลือกใช่หรือไม่?"),okText:"ยืนยันยกเลิก",cancelText:"ไม่ยกเลิก",onOk:async()=>{try{V(!0),X("กำลังดำเนินการยกเลิก..."),ex();let e=await (0,R.P)();await Promise.all(K.map(t=>A.x.updateItemStatus(t.toString(),N.i.Cancelled,void 0,e))),c.ZP.success("ยกเลิกรายการที่เลือกเรียบร้อย"),et([]),ej(F)}catch(e){c.ZP.error("เกิดข้อผิดพลาดในการยกเลิก")}finally{V(!1),Y()}}})},eS=async e=>{try{V(!0),X("กำลังย้อนกลับสถานะ...");let t=await (0,R.P)();await A.x.updateItemStatus(e,N.i.Cooking,void 0,t),c.ZP.success("ยกเลิกการเสิร์ฟ (กลับไปปรุง)"),ej(F)}finally{V(!1),Y()}},e_=async e=>{em({open:!0,type:"danger",title:"ยืนยันการลบ",content:"คุณต้องการลบรายการสินค้านี้ใช่หรือไม่?",okText:"ลบ",cancelText:"ยกเลิก",onOk:async()=>{try{V(!0),X("กำลังลบรายการ..."),ex();let t=await (0,R.P)();await A.x.deleteItem(e,void 0,t),c.ZP.success("ลบรายการเรียบร้อย"),ej(F)}catch(e){c.ZP.error("ไม่สามารถลบรายการได้")}finally{V(!1),Y()}}})},ek=async function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];try{V(!0),X("กำลังบันทึกข้อมูล...");let i=await (0,R.P)();await A.x.updateItem(e,{quantity:t,notes:n,details:r},void 0,i),c.ZP.success("แก้ไขรายการเรียบร้อย"),ej(F)}catch(e){throw c.ZP.error("ไม่สามารถแก้ไขรายการได้"),e}finally{V(!1),Y()}},eC=e=>{ep(e),er(!0)},eZ=async function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],i=(Number(e.price)+r.reduce((e,t)=>e+t.extra_price,0))*t;if(!Q){es.x.addToQueue("ADD_ITEM",{orderId:F,itemData:{product_id:e.id,quantity:t,price:e.price,notes:n,discount_amount:0,total_price:i,details:r}}),c.ZP.warning("บันทึกข้อมูลแบบ Offline แล้ว"),ej(F);return}try{V(!0),X("กำลังเพิ่มสินค้า...");let l=await (0,R.P)();await A.x.addItem(F,{product_id:e.id,quantity:t,price:e.price,notes:n,discount_amount:0,total_price:i,details:r,status:N.i.Cooking},void 0,l),c.ZP.success("เพิ่มสินค้าเรียบร้อย"),ej(F)}catch(e){throw c.ZP.error("เพิ่มสินค้าไม่สำเร็จ"),e}finally{V(!1),Y()}},eT=async()=>{let e=(null==H?void 0:H.order_type)===N.m.Delivery;em({open:!0,type:"success",title:e?"ยืนยันจัดออเดอร์เสร็จสิ้น":"ยืนยันการ".concat((0,D.qO)(null==H?void 0:H.order_type),"ทั้งหมด"),content:e?"จัดเตรียมอาหารเรียบร้อยแล้ว ต้องการส่งมอบให้ไรเดอร์หรือไม่?":"รายการทั้งหมดเสร็จสิ้นแล้ว ต้องการเข้าสู่ขั้นตอนการชำระเงินหรือไม่?",okText:"ยืนยัน",cancelText:"ยกเลิก",onOk:async()=>{try{V(!0),X("กำลังยืนยันรายการ..."),ex();let e=await (0,R.P)();if(await A.x.updateStatus(F,N.i.WaitingForPayment,e),c.ZP.success("ยืนยันออเดอร์เรียบร้อย"),H){let e=(0,D.EO)(H);i.push(e)}else i.push("/pos/orders")}catch(e){c.ZP.error("เกิดข้อผิดพลาดในการยืนยัน")}finally{V(!1),Y()}}})};if(q&&!H)return null;if(!H)return(0,r.jsx)(d.Z,{description:"ไม่พบข้อมูล"});let eP=[{title:"",key:"image",width:70,align:"center",render:(e,t)=>{var n,i,l;return(null===(n=t.product)||void 0===n?void 0:n.img_url)?(0,r.jsx)(r.Fragment,{children:(0,r.jsx)("img",{src:t.product.img_url,alt:null!==(l=null===(i=t.product)||void 0===i?void 0:i.display_name)&&void 0!==l?l:"สินค้า",style:L.B9.productThumb})}):(0,r.jsx)("div",{style:L.B9.productThumbPlaceholder,children:(0,r.jsx)(b.Z,{})})}},{title:"รายการ",key:"product",align:"center",render:(e,t)=>{var n;return(0,r.jsxs)(u.Z,{direction:"vertical",size:2,align:"center",children:[(0,r.jsx)(eh,{strong:!0,style:{fontSize:15,lineHeight:"1.2"},children:null===(n=t.product)||void 0===n?void 0:n.display_name}),t.details&&t.details.length>0&&(0,r.jsx)("div",{style:{fontSize:13,color:L._A.served,textAlign:"center"},children:t.details.map((e,t)=>(0,r.jsxs)("div",{style:{lineHeight:"1.4"},children:["+ ",e.detail_name]},t))}),t.notes&&(0,r.jsxs)(eh,{style:{fontSize:13,color:L._A.cancelled},children:[(0,r.jsx)(w.Z,{})," ",t.notes]})]})}},{title:"หมวดหมู่",key:"category",width:120,align:"center",render:(e,t)=>{var n,i;return(0,r.jsx)(u.Z,{direction:"vertical",size:0,align:"center",children:(null===(i=t.product)||void 0===i?void 0:null===(n=i.category)||void 0===n?void 0:n.display_name)?(0,r.jsx)(h.Z,{color:"cyan",style:L.B9.categoryTag,children:t.product.category.display_name}):"-"})}},{title:"ราคา",key:"price",width:110,align:"center",render:(e,t)=>(0,r.jsxs)(u.Z,{direction:"vertical",size:0,align:"center",children:[(0,r.jsxs)(eh,{style:{...L.B9.priceTag,fontSize:18},children:["฿",Number(t.price).toLocaleString()]}),t.details&&t.details.length>0&&t.details.map((e,t)=>(0,r.jsxs)(eh,{style:{fontSize:13,color:L._A.priceTotal,display:"block",lineHeight:"1.4"},children:["+ ฿",Number(e.extra_price).toLocaleString()]},t))]})},{title:"สถานะ",dataIndex:"status",key:"status",width:120,align:"center",render:e=>(0,r.jsx)(h.Z,{color:e===N.i.Pending?"orange":e===N.i.Cooking?"blue":"green",children:(0,D.d7)(e,H.order_type)})},{title:"จำนวน",dataIndex:"quantity",key:"quantity",width:80,align:"center",render:e=>(0,r.jsxs)(eh,{strong:!0,style:{fontSize:16},children:["x",e]})},{title:"จัดการ",key:"actions",width:130,align:"right",render:(e,t)=>(0,r.jsxs)(u.Z,{children:[(0,r.jsx)(p.Z,{title:(0,D.qO)(H.order_type),children:(0,r.jsxs)(y.ZP,{type:"primary",onClick:()=>ev(t.id),style:{background:L._A.served,borderColor:L._A.served,height:"auto",padding:"4px 8px",display:"flex",flexDirection:"column",alignItems:"center",gap:2,minWidth:60,borderRadius:10},children:[(0,r.jsx)(S.Z,{style:{fontSize:16}}),(0,r.jsx)("span",{style:{fontSize:10,fontWeight:700},children:(0,D.qO)(H.order_type)})]})}),(0,r.jsx)(p.Z,{title:"แก้ไข",children:(0,r.jsx)(y.ZP,{type:"text",icon:(0,r.jsx)(_.Z,{}),onClick:()=>eC(t)})}),(0,r.jsx)(p.Z,{title:"ลบ",children:(0,r.jsx)(y.ZP,{type:"text",danger:!0,icon:(0,r.jsx)(k.Z,{}),onClick:()=>e_(t.id)})})]})}],eB=[{title:"",key:"image",width:70,align:"center",render:(e,t)=>{var n,i,l;return(null===(n=t.product)||void 0===n?void 0:n.img_url)?(0,r.jsx)(r.Fragment,{children:(0,r.jsx)("img",{src:t.product.img_url,alt:null!==(l=null===(i=t.product)||void 0===i?void 0:i.display_name)&&void 0!==l?l:"สินค้า",style:{...L.B9.productThumb,opacity:.7}})}):(0,r.jsx)("div",{style:L.B9.productThumbPlaceholder,children:(0,r.jsx)(b.Z,{})})}},{title:"รายการ",key:"product",align:"center",render:(e,t)=>{var n;return(0,r.jsxs)(u.Z,{direction:"vertical",size:2,align:"center",children:[(0,r.jsx)(eh,{strong:!0,style:{fontSize:15,lineHeight:"1.2",textDecoration:t.status===N.i.Cancelled?"line-through":"none",color:t.status===N.i.Cancelled?L._A.textLight:L._A.text},children:null===(n=t.product)||void 0===n?void 0:n.display_name}),t.details&&t.details.length>0&&(0,r.jsx)("div",{style:{fontSize:12,color:L._A.served,opacity:.7,textAlign:"center"},children:t.details.map((e,t)=>(0,r.jsxs)("div",{style:{lineHeight:"1.4"},children:["+ ",e.detail_name]},t))}),t.notes&&(0,r.jsxs)(eh,{style:{fontSize:12,opacity:.7,color:L._A.cancelled},children:[(0,r.jsx)(w.Z,{})," ",t.notes]})]})}},{title:"หมวดหมู่",key:"category",width:120,align:"center",render:(e,t)=>{var n,i;return(0,r.jsx)(u.Z,{direction:"vertical",size:0,align:"center",children:(null===(i=t.product)||void 0===i?void 0:null===(n=i.category)||void 0===n?void 0:n.display_name)?(0,r.jsx)(h.Z,{color:"cyan",style:{...L.B9.categoryTag,opacity:.7},children:t.product.category.display_name}):"-"})}},{title:"ราคา",key:"price",width:110,align:"center",render:(e,t)=>(0,r.jsxs)(u.Z,{direction:"vertical",size:0,align:"center",children:[(0,r.jsxs)(eh,{style:{...L.B9.priceTag,opacity:.7},children:["฿",Number(t.price).toLocaleString()]}),t.details&&t.details.length>0&&t.details.map((e,t)=>(0,r.jsxs)(eh,{style:{fontSize:11,opacity:.7,color:L._A.priceTotal,display:"block",lineHeight:"1.4"},children:["+ ฿",Number(e.extra_price).toLocaleString()]},t))]})},{title:"ราคารวม",key:"total",width:120,align:"center",render:(e,t)=>(0,r.jsxs)(eh,{strong:!0,style:{color:t.status===N.i.Cancelled?L._A.textLight:L._A.priceTotal,fontSize:16,textDecoration:t.status===N.i.Cancelled?"line-through":"none"},children:["฿",Number(t.total_price).toLocaleString()]})},{title:"สถานะ",dataIndex:"status",key:"status",width:120,align:"center",render:e=>(0,r.jsx)(h.Z,{color:(0,D.OY)(e),children:(0,D.d7)(e,H.order_type)})},{title:"จำนวน",dataIndex:"quantity",key:"quantity",width:80,align:"center",render:e=>(0,r.jsxs)(eh,{strong:!0,style:{fontSize:16},children:["x",e]})},{title:"จัดการ",key:"actions",width:130,align:"right",render:(e,t)=>t.status===N.i.Served?(0,r.jsx)(y.ZP,{size:"small",className:"unserve-button",style:L.B9.unserveButton,icon:(0,r.jsx)(C.Z,{}),onClick:()=>eS(t.id),children:H.order_type===N.m.DineIn?"ยกเลิกเสิร์ฟ":"ยกเลิกปรุงเสร็จ"}):null}],eE=(null===(e=H.items)||void 0===e?void 0:e.filter(e=>e.status===N.i.Pending||e.status===N.i.Cooking))||[],ez=((null===(t=H.items)||void 0===t?void 0:t.filter(e=>e.status===N.i.Served||e.status===N.i.Cancelled||e.status===N.i.WaitingForPayment))||[]).sort((e,t)=>e.status===N.i.Cancelled&&t.status!==N.i.Cancelled?1:e.status!==N.i.Cancelled&&t.status===N.i.Cancelled?-1:0),eA=(0,D.Nz)(H.items),eR=(0,D.yj)(H.items),eO=0===eE.length&&((null===(n=H.items)||void 0===n?void 0:n.length)||0)>0,eN=eE.length>12,eI=ez.length>12;return(0,r.jsxs)("div",{style:L.B9.container,className:"order-detail-page",children:[(0,r.jsx)(l(),{id:L.$k.__hash,children:L.$k}),(0,r.jsx)("header",{style:L.B9.header,className:"order-detail-header",children:(0,r.jsxs)("div",{style:L.B9.headerContent,children:[(0,r.jsx)(y.ZP,{type:"text",icon:(0,r.jsx)(Z.Z,{}),onClick:()=>{(null==H?void 0:H.order_type)===N.m.DineIn?i.push("/pos/channels/dine-in"):i.back()},style:{height:40,width:40,borderRadius:"50%"}}),(0,r.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:10},children:[(0,r.jsx)(eu,{level:4,style:{margin:0,fontSize:18,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:H.order_no}),H.order_type===N.m.DineIn&&H.table&&(0,r.jsxs)(h.Z,{style:L.B9.tableNameBadge,children:["โต๊ะ ",H.table.table_name]}),H.order_type===N.m.Delivery&&H.delivery_code&&(0,r.jsxs)(h.Z,{style:L.B9.tableNameBadge,children:["รหัสออเดอร์ : ",H.delivery_code]})]}),(0,r.jsxs)("div",{style:L.B9.headerMetaRow,children:[(0,r.jsx)(h.Z,{icon:H.order_type===N.m.DineIn?(0,r.jsx)(b.Z,{}):H.order_type===N.m.TakeAway?(0,r.jsx)(T.Z,{}):(0,r.jsx)(P.Z,{}),style:{...L.B9.channelBadge,background:(0,D.Gs)(H.order_type)+"15",color:(0,D.Gs)(H.order_type)},children:(0,D.mz)(H.order_type)}),(0,r.jsx)("div",{style:L.B9.headerMetaSeparator}),(0,r.jsx)(eh,{type:"secondary",style:{fontSize:13},children:M()(H.create_date).format("HH:mm | D MMM YY")})]})]}),(0,r.jsx)(h.Z,{color:(0,D.OY)(H.status),className:"status-badge",style:{margin:0,fontSize:12},children:(0,D.d7)(H.status,H.order_type)})]})}),(0,r.jsx)("main",{style:L.B9.contentWrapper,className:"order-detail-content",children:(0,r.jsxs)(g.Z,{gutter:[20,20],children:[(0,r.jsxs)(f.Z,{xs:24,lg:16,children:[(0,r.jsx)(m.Z,{className:"order-detail-card fade-in",style:L.B9.card,title:(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,r.jsxs)(u.Z,{align:"center",size:12,children:[(0,r.jsx)("div",{style:L.B9.masterCheckboxWrapper,children:(0,r.jsx)(x.Z,{indeterminate:K.length>0&&K.length<eE.length,checked:eE.length>0&&K.length===eE.length,onChange:e=>{e.target.checked?et(eE.map(e=>e.id)):et([])},style:L.B9.masterCheckbox})}),(0,r.jsxs)(eh,{strong:!0,style:L.Qo.sectionTitle,children:["กำลังทำอาหาร (",eE.length,")"]})]}),(0,r.jsxs)(u.Z,{wrap:!0,children:[K.length>0&&(0,r.jsxs)(u.Z,{style:{gap:8},children:[(0,r.jsxs)(y.ZP,{danger:!0,icon:(0,r.jsx)(k.Z,{}),onClick:ew,style:L.B9.bulkActionButtonDesktop,className:"bulk-action-btn",children:[(0,r.jsxs)("span",{className:"hide-on-mobile",children:["ยกเลิกรายการ (",K.length,")"]}),(0,r.jsxs)("span",{className:"show-on-mobile-inline",children:["ยกเลิกรายการ (",K.length,")"]})]}),(0,r.jsxs)(y.ZP,{type:"primary",icon:(0,r.jsx)(S.Z,{}),onClick:eb,loading:U,style:{...L.B9.bulkActionButtonDesktop,background:L._A.served,borderColor:L._A.served},className:"bulk-action-btn",children:[(0,r.jsxs)("span",{className:"hide-on-mobile",children:[(0,D.qO)(H.order_type)," (",K.length,")"]}),(0,r.jsxs)("span",{className:"show-on-mobile-inline",children:[(0,D.qO)(H.order_type)," (",K.length,")"]})]})]}),(0,r.jsx)(y.ZP,{icon:(0,r.jsx)(B.Z,{}),onClick:()=>ej(F),style:L.B9.actionButtonSecondary}),(0,r.jsx)(y.ZP,{type:"primary",icon:(0,r.jsx)(E.Z,{}),onClick:()=>eg(!0),style:L.B9.actionButtonPrimary,children:"เพิ่ม"})]})]}),children:eE.length>0?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"order-detail-table-desktop",children:(0,r.jsx)(j.Z,{dataSource:eE,columns:eP,rowKey:"id",virtual:eN,scroll:eN?{y:420}:void 0,pagination:!1,size:"middle",className:"order-items-table",rowSelection:{selectedRowKeys:K,onChange:e=>{et(e)},hideSelectAll:!0}})}),(0,r.jsx)("div",{className:"order-detail-cards-mobile",children:eE.map(e=>{var t,n,i,l,o,a;return(0,r.jsxs)("div",{style:{...L.B9.itemCard,...L.B9.itemCardActive,padding:12},className:"order-item-card scale-in",children:[(0,r.jsxs)("div",{style:{display:"flex",gap:12,marginBottom:8},children:[(0,r.jsx)("div",{style:{flexShrink:0},children:(null===(t=e.product)||void 0===t?void 0:t.img_url)?(0,r.jsx)(r.Fragment,{children:(0,r.jsx)("img",{src:e.product.img_url,alt:null!==(a=null===(n=e.product)||void 0===n?void 0:n.display_name)&&void 0!==a?a:"สินค้า",style:{...L.B9.productThumb,width:60,height:60}})}):(0,r.jsx)("div",{style:{...L.B9.productThumbPlaceholder,width:60,height:60},children:(0,r.jsx)(b.Z,{})})}),(0,r.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[(0,r.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,r.jsx)(x.Z,{checked:K.includes(e.id),onChange:t=>{et(t.target.checked?[...K,e.id]:K.filter(t=>t!==e.id))},children:(0,r.jsx)(eh,{strong:!0,style:{fontSize:16},children:null===(i=e.product)||void 0===i?void 0:i.display_name})}),(0,r.jsx)("div",{style:{paddingLeft:24,marginTop:2},children:(null===(o=e.product)||void 0===o?void 0:null===(l=o.category)||void 0===l?void 0:l.display_name)&&(0,r.jsx)(h.Z,{color:"cyan",style:{...L.B9.categoryTag,fontSize:9},children:e.product.category.display_name})})]}),(0,r.jsxs)(eh,{strong:!0,style:{fontSize:18,color:L._A.primary,marginLeft:8},children:["x",e.quantity]})]}),(0,r.jsxs)("div",{style:{paddingLeft:24,marginTop:2},children:[e.details&&e.details.length>0&&(0,r.jsx)("div",{style:{fontSize:12,color:L._A.served,marginBottom:4},children:e.details.map(e=>"".concat(e.detail_name," (+ ฿").concat(Number(e.extra_price).toLocaleString(),")")).join(", ")}),(0,r.jsx)(u.Z,{direction:"vertical",size:2,children:(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,r.jsxs)(eh,{style:L.B9.priceTag,children:["฿",Number(e.price).toLocaleString()]}),(0,r.jsxs)(eh,{strong:!0,style:{color:L._A.priceTotal},children:["รวม ฿",Number(e.total_price).toLocaleString()]})]})}),e.notes&&(0,r.jsx)("div",{style:{marginTop:4},children:(0,r.jsxs)(eh,{style:{fontSize:12,color:L._A.cancelled},children:[(0,r.jsx)(w.Z,{})," ",e.notes]})})]})]})]}),(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",borderTop:"1px solid ".concat(L._A.borderLight),paddingTop:8,gap:8},children:[(0,r.jsx)(y.ZP,{size:"small",type:"text",danger:!0,icon:(0,r.jsx)(k.Z,{}),onClick:()=>e_(e.id),children:"ลบ"}),(0,r.jsx)(y.ZP,{size:"small",type:"text",icon:(0,r.jsx)(_.Z,{}),onClick:()=>eC(e),children:"แก้ไข"}),(0,r.jsxs)(y.ZP,{size:"small",type:"primary",onClick:()=>ev(e.id),style:{background:L._A.served,borderColor:L._A.served,height:"auto",padding:"4px 10px",display:"flex",flexDirection:"column",alignItems:"center",gap:2,borderRadius:10},children:[(0,r.jsx)(S.Z,{style:{fontSize:16}}),(0,r.jsx)("span",{style:{fontSize:10,fontWeight:700},children:(0,D.qO)(H.order_type)})]})]})]},e.id)})})]}):(0,r.jsxs)("div",{style:L.B9.emptyState,children:[(0,r.jsx)(z.Z,{className:"empty-state-icon"}),(0,r.jsx)(eh,{className:"empty-state-text",children:"ไม่มีรายการที่กำลังรอ"})]})}),(0,r.jsx)(m.Z,{className:"order-detail-card fade-in",style:L.B9.card,title:(0,r.jsxs)(eh,{strong:!0,style:{...L.Qo.sectionTitle,color:L._A.textSecondary},children:[(0,D.zP)(H.order_type)," (",ez.length,")"]}),children:ez.length>0?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"order-detail-table-desktop",children:(0,r.jsx)(j.Z,{dataSource:ez,columns:eB,rowKey:"id",virtual:eI,scroll:eI?{y:360}:void 0,pagination:!1,size:"small",className:"order-items-table",rowClassName:e=>e.status===N.i.Cancelled?"row-cancelled":""})}),(0,r.jsx)("div",{className:"order-detail-cards-mobile",children:ez.map(e=>{var t,n,i,l,o,a;return(0,r.jsxs)("div",{style:{...L.B9.itemCard,...L.B9.itemCardServed,padding:12,backgroundColor:e.status===N.i.Cancelled?L._A.cancelledLight:L._A.white,borderColor:e.status===N.i.Cancelled?L._A.cancelled+"30":L._A.border,position:"relative"},children:[(0,r.jsx)("div",{style:{position:"absolute",top:8,right:12},children:(0,r.jsx)(h.Z,{color:(0,D.OY)(e.status),style:{margin:0},children:(0,D.d7)(e.status,H.order_type)})}),(0,r.jsxs)("div",{style:{display:"flex",gap:12},children:[(0,r.jsx)("div",{style:{flexShrink:0},children:(null===(t=e.product)||void 0===t?void 0:t.img_url)?(0,r.jsx)(r.Fragment,{children:(0,r.jsx)("img",{src:e.product.img_url,alt:null!==(a=null===(n=e.product)||void 0===n?void 0:n.display_name)&&void 0!==a?a:"สินค้า",style:{...L.B9.productThumb,width:50,height:50,opacity:.7}})}):(0,r.jsx)("div",{style:{...L.B9.productThumbPlaceholder,width:50,height:50},children:(0,r.jsx)(b.Z,{})})}),(0,r.jsx)("div",{style:{flex:1,minWidth:0,paddingRight:60},children:(0,r.jsx)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:(0,r.jsxs)("div",{style:{flex:1},children:[(0,r.jsx)(eh,{strong:!0,style:{fontSize:15,textDecoration:e.status===N.i.Cancelled?"line-through":"none",color:e.status===N.i.Cancelled?L._A.textLight:L._A.text},children:null===(i=e.product)||void 0===i?void 0:i.display_name}),(0,r.jsx)("div",{style:{marginTop:2},children:(null===(o=e.product)||void 0===o?void 0:null===(l=o.category)||void 0===l?void 0:l.display_name)&&(0,r.jsx)(h.Z,{color:"cyan",style:{...L.B9.categoryTag,fontSize:9},children:e.product.category.display_name})}),e.details&&e.details.length>0&&(0,r.jsx)("div",{style:{fontSize:12,color:L._A.served,opacity:.7,marginBottom:4},children:e.details.map(e=>"".concat(e.detail_name," (+ ฿").concat(Number(e.extra_price).toLocaleString(),")")).join(", ")}),(0,r.jsx)(u.Z,{direction:"vertical",size:2,style:{marginTop:4,width:"100%"},children:(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)(eh,{style:{...L.B9.priceTag,opacity:.7},children:["฿",Number(e.price).toLocaleString()]}),(0,r.jsxs)(eh,{strong:!0,style:{marginLeft:8,color:L._A.textSecondary,opacity:.7},children:["รวม ฿",Number(e.total_price).toLocaleString()]})]}),(0,r.jsxs)(eh,{strong:!0,style:{color:L._A.textSecondary},children:["x",e.quantity]})]})}),e.notes&&(0,r.jsx)("div",{style:{marginTop:4},children:(0,r.jsxs)(eh,{style:{fontSize:12,opacity:.7,color:L._A.cancelled},children:[(0,r.jsx)(w.Z,{})," ",e.notes]})})]})})})]}),e.status===N.i.Served&&(0,r.jsx)("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:8},children:(0,r.jsx)(y.ZP,{size:"small",className:"unserve-button",style:L.B9.unserveButton,icon:(0,r.jsx)(C.Z,{}),onClick:()=>eS(e.id),children:(null==H?void 0:H.order_type)===N.m.DineIn?"ยกเลิกเสิร์ฟ":"ยกเลิกปรุงเสร็จ"})})]},e.id)})})]}):(0,r.jsx)("div",{style:{textAlign:"center",padding:"20px 0"},children:(0,r.jsx)(eh,{type:"secondary",children:"ยังไม่มีรายการที่ดำเนินการแล้ว"})})})]}),(0,r.jsx)(f.Z,{xs:24,lg:8,children:(0,r.jsxs)(m.Z,{className:"order-detail-card",style:L.B9.summaryCard,children:[(0,r.jsx)(eu,{level:5,style:{marginBottom:16},children:"สรุปการสั่งซื้อ"}),(0,r.jsxs)("div",{style:{...L.B9.summaryList,background:"white"},children:[(0,r.jsx)(eh,{strong:!0,style:{fontSize:13,marginBottom:8,display:"block",color:L._A.textSecondary},children:"รายการสินค้า"}),eA.map((e,t)=>{var n,i,l;return(0,r.jsxs)("div",{style:L.B9.summaryItemRow,children:[(null===(n=e.product)||void 0===n?void 0:n.img_url)?(0,r.jsx)(r.Fragment,{children:(0,r.jsx)("img",{src:e.product.img_url,alt:(null===(i=e.product)||void 0===i?void 0:i.display_name)||"สินค้า",style:L.B9.summaryItemImage})}):(0,r.jsx)("div",{style:{...L.B9.summaryItemImage,display:"flex",alignItems:"center",justifyContent:"center",background:"#f8fafc"},children:(0,r.jsx)(b.Z,{style:{fontSize:16,color:"#bfbfbf"}})}),(0,r.jsxs)("div",{style:L.B9.summaryItemContent,children:[(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[(0,r.jsx)(eh,{strong:!0,style:{fontSize:13,flex:1},children:null===(l=e.product)||void 0===l?void 0:l.display_name}),(0,r.jsxs)(eh,{strong:!0,style:{fontSize:13,color:L._A.primary},children:["฿",Number(e.total_price).toLocaleString()]})]}),(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:2},children:[(0,r.jsxs)(eh,{type:"secondary",style:{fontSize:11},children:["จำนวน : ",e.quantity]}),(0,r.jsxs)(eh,{type:"secondary",style:{fontSize:11},children:["ราคา : ",Number(e.price).toLocaleString()]})]}),e.details&&e.details.length>0&&(0,r.jsxs)("div",{style:L.B9.summaryDetailText,children:[(0,r.jsx)(E.Z,{style:{fontSize:10}})," ",e.details.map(e=>"".concat(e.detail_name," (+").concat(Number(e.extra_price).toLocaleString(),")")).join(", ")]}),e.notes&&(0,r.jsxs)("div",{style:{...L.B9.summaryDetailText,color:L._A.cancelled,fontStyle:"italic"},children:["โน้ต: ",e.notes]})]})]},e.id||t)})]}),(0,r.jsxs)("div",{style:L.B9.summaryList,children:[(0,r.jsx)(eh,{strong:!0,style:{fontSize:13,marginBottom:8,display:"block",color:L._A.textSecondary},children:"แยกตามหมวดหมู่"}),Object.entries((0,D.Rr)((null==H?void 0:H.items)||[])).map(e=>{let[t,n]=e;return(0,r.jsxs)("div",{style:L.B9.summaryRow,children:[(0,r.jsx)(eh,{type:"secondary",style:{fontSize:13},children:t}),(0,r.jsxs)(eh,{strong:!0,style:{fontSize:13},children:[String(n)," รายการ"]})]},t)}),(0,r.jsx)(v.Z,{style:{margin:"8px 0"}}),(0,r.jsxs)("div",{style:L.B9.summaryRow,children:[(0,r.jsx)(eh,{type:"secondary",style:{fontSize:13},children:"จำนวนรายการทั้งหมด"}),(0,r.jsxs)(eh,{strong:!0,style:{fontSize:13},children:[eA.length," รายการ"]})]})]}),(0,r.jsx)("div",{style:{padding:"0 4px"},children:(0,r.jsxs)("div",{style:L.B9.summaryMainRow,children:[(0,r.jsx)(eh,{strong:!0,style:{fontSize:18},children:"ยอดรวมทั้งสิ้น"}),(0,r.jsxs)(eh,{strong:!0,style:{fontSize:26,color:L._A.primary},children:["฿",eR.toLocaleString()]})]})}),eO&&(0,r.jsx)(y.ZP,{type:"primary",block:!0,size:"large",onClick:eT,style:{marginTop:24,height:52,borderRadius:14,fontWeight:700,fontSize:16},children:(0,D.iN)(H.order_type)}),(0,r.jsx)(y.ZP,{danger:!0,block:!0,size:"large",onClick:()=>{H&&em({open:!0,type:"danger",title:"ยืนยันการยกเลิกออเดอร์?",content:"การดำเนินการนี้จะยกเลิกสินค้าทุกรายการและคืนสถานะโต๊ะ (หากมี) คุณแน่ใจหรือไม่?",okText:"ยืนยันการยกเลิก",cancelText:"ยกเลิก",onOk:async()=>{try{var e;V(!0),X("กำลังดำเนินการยกเลิก..."),ex();let t=await (0,R.P)(),n=(null===(e=H.items)||void 0===e?void 0:e.filter(e=>e.status!==N.i.Cancelled))||[];await Promise.all(n.map(e=>A.x.updateItemStatus(e.id,N.i.Cancelled,void 0,t))),await A.x.updateStatus(H.id,N.i.Cancelled,t),H.table_id&&await O.$.update(H.table_id,{status:I.c.Available},void 0,t),c.ZP.success("ยกเลิกออเดอร์เรียบร้อย"),i.push((0,D.d$)(H.order_type))}catch(e){console.error("Cancel failed:",e),c.ZP.error("ไม่สามารถยกเลิกออเดอร์ได้")}finally{V(!1),Y()}}})},style:{marginTop:12,height:45,borderRadius:14,fontWeight:600,fontSize:15},disabled:U,children:"ยกเลิกออเดอร์"})]})})]})}),(0,r.jsx)(ee,{isOpen:ey,onClose:()=>eg(!1),onAddItem:eZ}),(0,r.jsx)(el,{item:ei,isOpen:en,onClose:()=>{er(!1),ep(null)},onSave:ek}),(0,r.jsx)(eo.Z,{open:ef.open,type:ef.type,title:ef.title,content:ef.content,okText:ef.okText,cancelText:ef.cancelText,onOk:ef.onOk,onCancel:ex,loading:U})]})}M().locale("th")},60300:function(e,t,n){"use strict";var r=n(57437),i=n(29),l=n.n(i);n(2265);var o=n(82646),a=n(53743),s=n(50742),c=n(29271),d=n(35291),u=n(83669),h=n(15424),p=n(67187);let{Title:y,Text:g}=o.default;t.Z=e=>{let{open:t,type:n="confirm",title:i,content:o,okText:f="ยืนยัน",cancelText:m="ยกเลิก",onOk:x,onCancel:j,loading:v=!1,icon:b}=e,w=()=>{switch(n){case"danger":return"#ef4444";case"warning":return"#f59e0b";case"success":return"#10b981";default:return"#3b82f6"}},S=w();return(0,r.jsxs)(a.Z,{open:t,onCancel:j,footer:null,centered:!0,width:400,closable:!1,styles:{body:{padding:"32px 24px"},mask:{backdropFilter:"blur(4px)",backgroundColor:"rgba(0,0,0,0.45)"}},className:"modern-confirm-modal",children:[(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center"},className:"jsx-a93d1526d5312985",children:[(0,r.jsx)("div",{style:{marginBottom:20,padding:20,borderRadius:"50%",backgroundColor:"".concat(S,"10"),display:"flex",alignItems:"center",justifyContent:"center"},className:"jsx-a93d1526d5312985",children:(()=>{if(b)return b;let e={fontSize:42,color:w()};switch(n){case"danger":return(0,r.jsx)(c.Z,{style:e});case"warning":return(0,r.jsx)(d.Z,{style:e});case"success":return(0,r.jsx)(u.Z,{style:e});case"info":return(0,r.jsx)(h.Z,{style:e});default:return(0,r.jsx)(p.Z,{style:e})}})()}),(0,r.jsx)(y,{level:4,style:{marginBottom:12,fontWeight:700},children:i}),(0,r.jsx)("div",{style:{marginBottom:32},className:"jsx-a93d1526d5312985",children:"string"==typeof o?(0,r.jsx)(g,{type:"secondary",style:{fontSize:15},children:o}):o}),(0,r.jsxs)("div",{style:{width:"100%",display:"flex",gap:12},className:"jsx-a93d1526d5312985",children:[(0,r.jsx)(s.ZP,{block:!0,size:"large",onClick:j,disabled:v,style:{borderRadius:12,height:48,fontWeight:600,border:"1px solid #e2e8f0"},children:m}),(0,r.jsx)(s.ZP,{block:!0,type:"primary",size:"large",onClick:x,loading:v,style:{borderRadius:12,height:48,fontWeight:600,background:S,border:"1px solid ".concat(S),boxShadow:"0 4px 12px ".concat(S,"40")},children:f})]})]}),(0,r.jsx)(l(),{id:"a93d1526d5312985",children:".modern-confirm-modal .ant-modal-content{-webkit-border-radius:20px!important;-moz-border-radius:20px!important;border-radius:20px!important;-webkit-box-shadow:0 10px 30px rgba(0,0,0,.15)!important;-moz-box-shadow:0 10px 30px rgba(0,0,0,.15)!important;box-shadow:0 10px 30px rgba(0,0,0,.15)!important;overflow:hidden}"})]})}},71567:function(e,t,n){"use strict";n.d(t,{q:function(){return i},v:function(){return r}});let r="/api",i={AUTH:{LOGIN:"/auth/login",ME:"/auth/me",CSRF:"/csrf"},POS:{PRODUCTS:"/pos/products",ORDERS:"/pos/orders",TABLES:"/pos/tables",DISCOUNTS:"/pos/discounts",DELIVERY:"/pos/delivery",PAYMENT_METHODS:"/pos/paymentMethod",PAYMENTS:"/pos/payments",CATEGORY:"/pos/category",SHIFTS:{BASE:"/pos/shifts",CURRENT:"/pos/shifts/current",OPEN:"/pos/shifts/open",CLOSE:"/pos/shifts/close"},DASHBOARD:{SALES:"/pos/dashboard/sales",TOP_ITEMS:"/pos/dashboard/top-items"},CHANNELS:{STATS:"/pos/orders/stats"},SHOP_PROFILE:"/pos/shopProfile",SALES_ORDER_ITEMS:"/pos/salesOrderItem",SALES_ORDER_DETAILS:"/pos/salesOrderDetail",PRODUCTS_UNIT:"/pos/productsUnit",PAYMENT_DETAILS:"/pos/paymentDetails",BRANCH:"/branches"}}},14362:function(e,t,n){"use strict";n.d(t,{AuthProvider:function(){return u},a:function(){return h}});var r=n(57437),i=n(2265),l=n(99376),o=n(5447),a=n(84859),s=n(48651),c=n(3369);let d=(0,i.createContext)(void 0),u=e=>{let{children:t}=e,[n,u]=(0,i.useState)(null),[h,p]=(0,i.useState)(!0),y=(0,l.useRouter)(),g=(0,l.usePathname)(),f=async()=>{try{let e="";e=localStorage.getItem("token_ws")||"";let t=await o.O.getMe(e);u(t)}catch(e){u(null)}finally{p(!1)}};(0,i.useEffect)(()=>{f()},[]);let{showLoading:m,hideLoading:x}=(0,c.x)();(0,i.useEffect)(()=>{h||n||"/login"===g||y.push("/login")},[n,h,g,y]);let j=async e=>{try{m("กำลังเข้าสู่ระบบ...");let t=await o.O.getCsrfToken(),{token:n,...r}=await o.O.login(e,t);n&&localStorage.setItem("token_ws",n),u(r),y.push("/")}catch(e){throw e}finally{x()}},v=async()=>{try{m("กำลังออกจากระบบ...");let e="";e=localStorage.getItem("token_ws")||"",await o.O.logout(e),localStorage.removeItem("token_ws"),a.x.clearQueue(),u(null),y.push("/login")}catch(e){console.error("Logout error:",e)}finally{x()}};return h?(0,r.jsx)("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-white",children:(0,r.jsx)(s.Z,{size:"large"})}):n||"/login"===g?(0,r.jsx)(d.Provider,{value:{user:n,loading:h,login:j,logout:v,checkAuth:f},children:t}):null},h=()=>{let e=(0,i.useContext)(d);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}},46252:function(e,t,n){"use strict";n.d(t,{J:function(){return a},SocketProvider:function(){return s}});var r=n(57437),i=n(2265),l=n(68680),o=n(14362);let a=(0,i.createContext)({socket:null,isConnected:!1}),s=e=>{let{children:t}=e,[n,s]=(0,i.useState)(null),[c,d]=(0,i.useState)(!1),{user:u}=(0,o.a)();return(0,i.useEffect)(()=>{if(!u){n&&(n.disconnect(),s(null),d(!1));return}let e=localStorage.getItem("token_ws"),t=(0,l.io)("http://localhost:3000",{transports:["websocket"],withCredentials:!0,auth:e?{token:e}:void 0});return t.on("connect",()=>{console.log("Socket Connected:",t.id),d(!0)}),t.on("disconnect",()=>{console.log("Socket Disconnected"),d(!1)}),s(t),()=>{t.disconnect()}},[u]),(0,r.jsx)(a.Provider,{value:{socket:n,isConnected:c},children:t})}},3369:function(e,t,n){"use strict";n.d(t,{GlobalLoadingProvider:function(){return s},O:function(){return d},x:function(){return c}});var r=n(57437),i=n(2265),l=n(48651);let o=(0,i.createContext)(void 0),a=(0,i.createContext)(void 0),s=e=>{let{children:t}=e,[n,s]=(0,i.useState)({}),[c,d]=(0,i.useState)(void 0),u=(0,i.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default";s(e=>({...e,[t]:(e[t]||0)+1})),e&&d(e)},[]),h=(0,i.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";s(t=>{if(!t[e])return t;let n={...t};return n[e]-=1,n[e]<=0&&delete n[e],n})},[]),p=(0,i.useCallback)(()=>{s({}),d(void 0)},[]),y=Object.keys(n).length>0,g=(0,i.useMemo)(()=>({isLoading:y,loadingMessage:c}),[y,c]),f=(0,i.useMemo)(()=>({showLoading:u,hideLoading:h,resetLoading:p}),[u,h,p]);return(0,r.jsx)(a.Provider,{value:f,children:(0,r.jsxs)(o.Provider,{value:g,children:[t,y&&(0,r.jsx)("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center pointer-events-auto bg-black/10 backdrop-blur-[1px]",children:(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:10,background:"rgba(255, 255, 255, 0.9)",padding:"20px 40px",borderRadius:12,boxShadow:"0 4px 12px rgba(0,0,0,0.1)"},children:[(0,r.jsx)(l.Z,{size:"large"}),c&&(0,r.jsx)("div",{style:{fontSize:14,color:"#1f1f1f",fontWeight:500},children:c})]})})]})})};function c(){let e=(0,i.useContext)(o),t=(0,i.useContext)(a);if(!e||!t)throw Error("useGlobalLoading must be used within a GlobalLoadingProvider");return(0,i.useMemo)(()=>({...e,...t}),[e,t])}function d(){let e=(0,i.useContext)(a);if(!e)throw Error("useGlobalLoadingDispatch must be used within a GlobalLoadingProvider");return e}},20920:function(e,t,n){"use strict";n.d(t,{L:function(){return i}});var r=n(2265);function i(){let[e,t]=(0,r.useState)("undefined"==typeof navigator||navigator.onLine);return(0,r.useEffect)(()=>{let e=()=>t(!0),n=()=>t(!1);return window.addEventListener("online",e),window.addEventListener("offline",n),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",n)}},[]),e}},24675:function(e,t,n){"use strict";n.d(t,{s:function(){return l}});var r=n(2265),i=n(46252);let l=()=>(0,r.useContext)(i.J)},2913:function(e,t,n){"use strict";function r(e,t){return({GET:"".concat(i.API_BASE_URL).concat(t),POST:"".concat(i.API_BASE_URL).concat(t),PUT:"".concat(i.API_BASE_URL).concat(t),DELETE:"".concat(i.API_BASE_URL).concat(t),PATCH:"".concat(i.API_BASE_URL).concat(t)})[e]}n.d(t,{b:function(){return r}});let i={get API_BASE_URL(){return"/api"}}},5447:function(e,t,n){"use strict";n.d(t,{O:function(){return l}});var r=n(71567),i=n(2913);let l={login:async(e,t,n)=>{try{let l=(0,i.b)("POST",r.q.AUTH.LOGIN),o={"Content-Type":"application/json"};t&&(o["X-CSRF-Token"]=t),n&&(o.Cookie=n);let a=await fetch(l,{method:"POST",headers:o,credentials:"include",body:JSON.stringify(e)});if(!a.ok){let e=await a.json().catch(()=>({}));throw Error(e.message||e.detail||"เข้าสู่ระบบไม่สำเร็จ")}let s=await a.json();return{...s.user,token:s.token}}catch(e){throw Error(e.message||"เข้าสู่ระบบไม่สำเร็จ")}},logout:async(e,t,n)=>{try{let r=(0,i.b)("POST","/auth/logout"),l={"Content-Type":"application/json"};e&&(l.Authorization="Bearer ".concat(e)),t&&(l["X-CSRF-Token"]=t),n&&(l.Cookie=n),await fetch(r,{method:"POST",headers:l,credentials:"include"})}catch(e){console.error("Logout failed",e)}},getMe:async e=>{try{let t=(0,i.b)("GET",r.q.AUTH.ME),n=await fetch(t,{method:"GET",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"},credentials:"include",cache:"no-store"});if(!n.ok)throw Error("Unauthorized");return await n.json()}catch(e){throw e}},async getCsrfToken(){try{let e=await fetch("".concat(r.v).concat(r.q.AUTH.CSRF),{credentials:"include"});if(!e.ok)return"";return(await e.json()).csrfToken}catch(e){return console.error("Failed to fetch CSRF token",e),""}}}},2838:function(e,t,n){"use strict";n.d(t,{G:function(){return l}});var r=n(2913);let i="/pos/category",l={findAll:async(e,t)=>{let n=(0,r.b)("GET",i);t&&(n+="?".concat(t.toString()));let l={};e&&(l.Cookie=e);let o=await fetch(n,{cache:"no-store",credentials:"include",headers:l});if(!o.ok){let e=await o.json().catch(()=>({}));throw Error(e.error||e.message||"Failed to fetch categories")}return o.json()},findOne:async(e,t)=>{let n=(0,r.b)("GET","".concat(i,"/").concat(e)),l={};t&&(l.Cookie=t);let o=await fetch(n,{cache:"no-store",credentials:"include",headers:l});if(!o.ok){let e=await o.json().catch(()=>({}));throw Error(e.error||e.message||"Failed to fetch category")}return o.json()},findOneByName:async(e,t)=>{let n=(0,r.b)("GET","".concat(i,"/name/").concat(e)),l={};t&&(l.Cookie=t);let o=await fetch(n,{cache:"no-store",credentials:"include",headers:l});if(!o.ok){let e=await o.json().catch(()=>({}));throw Error(e.error||e.message||"Failed to fetch category by name")}return o.json()},create:async(e,t,n)=>{let l=(0,r.b)("POST",i),o={"Content-Type":"application/json"};t&&(o.Cookie=t),n&&(o["X-CSRF-Token"]=n);let a=await fetch(l,{method:"POST",headers:o,body:JSON.stringify(e),credentials:"include"});if(!a.ok){let e=await a.json().catch(()=>({}));throw Error(e.error||e.message||"Failed to create category")}return a.json()},update:async(e,t,n,l)=>{let o=(0,r.b)("PUT","".concat(i,"/").concat(e)),a={"Content-Type":"application/json"};n&&(a.Cookie=n),l&&(a["X-CSRF-Token"]=l);let s=await fetch(o,{method:"PUT",headers:a,body:JSON.stringify(t),credentials:"include"});if(!s.ok){let e=await s.json().catch(()=>({}));throw Error(e.error||e.message||"Failed to update category")}return s.json()},delete:async(e,t,n)=>{let l=(0,r.b)("DELETE","".concat(i,"/").concat(e)),o={};t&&(o.Cookie=t),n&&(o["X-CSRF-Token"]=n);let a=await fetch(l,{method:"DELETE",headers:o,credentials:"include"});if(!a.ok){let e=await a.json().catch(()=>({}));throw Error(e.error||e.message||"Failed to delete category")}}}},84859:function(e,t,n){"use strict";n.d(t,{M:function(){return a},x:function(){return o}});let r="pos_offline_queue",i=()=>{let e=localStorage.getItem(r);return e?JSON.parse(e):[]},l=e=>{localStorage.setItem(r,JSON.stringify(e))},o={addToQueue:(e,t)=>{let n=i(),r={id:"offline-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),type:e,payload:t,timestamp:Date.now(),retryCount:0};return l([...n,r]),r},getQueue:()=>i(),removeFromQueue:e=>{l(i().filter(t=>t.id!==e))},incrementRetry:(e,t)=>{l(i().map(n=>n.id===e?{...n,retryCount:n.retryCount+1,lastError:t}:n))},clearQueue:()=>{localStorage.removeItem(r)},pruneExceeded:()=>{l(i().filter(e=>e.retryCount<=5))}},a={maxRetry:5,backoff:e=>Math.min(3e4,2e3*e)}},47799:function(e,t,n){"use strict";n.d(t,{R:function(){return c}});var r=n(2913),i=n(71567),l=n(20019);let o=l.Ryn({id:l.Z_8(),product_name:l.Z_8(),display_name:l.Z_8(),description:l.Z_8().optional().or(l.Z_8()),price:l.Rxh().or(l.Z_8().transform(e=>Number(e))),category_id:l.Z_8(),unit_id:l.Z_8(),img_url:l.Z_8().nullable().optional(),create_date:l.Z_8().or(l.hTZ()).transform(e=>new Date(e)),update_date:l.Z_8().or(l.hTZ()).transform(e=>new Date(e)),is_active:l.O72().optional().default(!0),category:l.YjB().optional(),unit:l.YjB().optional()}),a=l.Ryn({data:l.IXX(o),total:l.Rxh(),page:l.Rxh(),last_page:l.Rxh()}),s=i.q.POS.PRODUCTS,c={findAll:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,l=(0,r.b)("GET",s),o=new URLSearchParams(i||"");o.append("page",e.toString()),o.append("limit",t.toString()),l+="?".concat(o.toString());let c={};n&&(c.Cookie=n);let d=await fetch(l,{cache:"no-store",credentials:"include",headers:c});if(!d.ok){let e=await d.json().catch(()=>({}));throw Error(e.error||e.message||"Failed to fetch products")}let u=await d.json();return a.parse(u)},findOne:async(e,t)=>{let n=(0,r.b)("GET","".concat(s,"/").concat(e)),i={};t&&(i.Cookie=t);let l=await fetch(n,{cache:"no-store",credentials:"include",headers:i});if(!l.ok){let e=await l.json().catch(()=>({}));throw Error(e.error||e.message||"Failed to fetch product")}let a=await l.json();return o.parse(a)},findOneByName:async(e,t)=>{let n=(0,r.b)("GET","".concat(s,"/name/").concat(e)),i={};t&&(i.Cookie=t);let l=await fetch(n,{cache:"no-store",credentials:"include",headers:i});if(!l.ok){let e=await l.json().catch(()=>({}));throw Error(e.error||e.message||"Failed to fetch product by name")}let a=await l.json();return o.parse(a)},create:async(e,t,n)=>{let i=(0,r.b)("POST",s),l={"Content-Type":"application/json"};t&&(l.Cookie=t),n&&(l["X-CSRF-Token"]=n);let o=await fetch(i,{method:"POST",headers:l,body:JSON.stringify(e),credentials:"include"});if(!o.ok){let e=await o.json().catch(()=>({}));throw Error(e.error||e.message||"Failed to create product")}return o.json()},update:async(e,t,n,i)=>{let l=(0,r.b)("PUT","".concat(s,"/").concat(e)),o={"Content-Type":"application/json"};n&&(o.Cookie=n),i&&(o["X-CSRF-Token"]=i);let a=await fetch(l,{method:"PUT",headers:o,body:JSON.stringify(t),credentials:"include"});if(!a.ok){let e=await a.json().catch(()=>({}));throw Error(e.error||e.message||"Failed to update product")}return a.json()},delete:async(e,t,n)=>{let i=(0,r.b)("DELETE","".concat(s,"/").concat(e)),l={};t&&(l.Cookie=t),n&&(l["X-CSRF-Token"]=n);let o=await fetch(i,{method:"DELETE",headers:l,credentials:"include"});if(!o.ok){let e=await o.json().catch(()=>({}));throw Error(e.error||e.message||"Failed to delete product")}}}},66290:function(e,t,n){"use strict";n.d(t,{$:function(){return o}});var r=n(2913);let i=n(71567).q.POS.TABLES,l=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"application/json",n={};return t&&(n["Content-Type"]=t),e&&(n.Cookie=e),n},o={getAll:async(e,t)=>{let n=(0,r.b)("GET",i),o=new URLSearchParams(t||"");o.has("page")||o.set("page","1"),o.has("limit")||o.set("limit","200");let a=o.toString();a&&(n+="?".concat(a));let s=l(e,""),c=await fetch(n,{cache:"no-store",headers:s,credentials:"include"});if(!c.ok){let e=await c.json().catch(()=>({}));throw Error(e.error||e.message||"Failed to fetch tables")}return c.json()},getById:async(e,t)=>{let n=(0,r.b)("GET","".concat(i,"/").concat(e)),o=l(t,""),a=await fetch(n,{cache:"no-store",headers:o,credentials:"include"});if(!a.ok){let e=await a.json().catch(()=>({}));throw Error(e.error||e.message||"Failed to fetch tables")}return a.json()},getByName:async(e,t)=>{let n=(0,r.b)("GET","".concat(i,"/getByName/").concat(e)),o=l(t,""),a=await fetch(n,{cache:"no-store",headers:o,credentials:"include"});if(!a.ok){let e=await a.json().catch(()=>({}));throw Error(e.error||e.message||"Failed to fetch tables")}return a.json()},create:async(e,t,n)=>{let o=(0,r.b)("POST","".concat(i)),a=l(t);n&&(a["X-CSRF-Token"]=n);let s=await fetch(o,{method:"POST",headers:a,credentials:"include",body:JSON.stringify(e)});if(!s.ok){let e=await s.json().catch(()=>({}));throw Error(e.error||e.message||"Failed to create table")}return s.json()},update:async(e,t,n,o)=>{let a=(0,r.b)("PUT","".concat(i,"/").concat(e)),s=l(n);o&&(s["X-CSRF-Token"]=o);let c=await fetch(a,{method:"PUT",headers:s,credentials:"include",body:JSON.stringify(t)});if(!c.ok){let e=await c.json().catch(()=>({}));throw Error(e.error||e.message||"Failed to update table")}return c.json()},delete:async(e,t,n)=>{let o=(0,r.b)("DELETE","".concat(i,"/").concat(e)),a=l(t,"");n&&(a["X-CSRF-Token"]=n);let s=await fetch(o,{method:"DELETE",headers:a,credentials:"include"});if(!s.ok){let e=await s.json().catch(()=>({}));throw Error(e.error||e.message||"Failed to delete table")}}}},97235:function(e,t,n){"use strict";n.d(t,{P:function(){return a}});var r=n(5447);let i=null,l=0,o=null;async function a(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=Date.now();return!e&&i&&t-l<6e5?i:(o||(o=r.O.getCsrfToken().then(e=>(i=e||"",l=Date.now(),i)).finally(()=>{o=null})),o)}},67697:function(e,t,n){"use strict";n.d(t,{D:function(){return o},v:function(){return l}});var r=n(2265);let i=e=>{if("string"==typeof e)return e;if(e&&"object"==typeof e){var t;if("id"in e&&e.id)return e.id;if("data"in e&&(null===(t=e.data)||void 0===t?void 0:t.id))return e.data.id}};function l(e,t,n){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e=>e.id,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>!0;(0,r.useEffect)(()=>{if(!e)return;let r=e=>{if(!o(e))return;let t=l(e);n(n=>n.some(e=>l(e)===t)?n:[...n,e])},a=e=>{let t=l(e);n(n=>o(e)?n.some(e=>l(e)===t)?n.map(n=>l(n)===t?e:n):[...n,e]:n.filter(e=>l(e)!==t))},s=e=>{let t=i(e);t&&n(e=>e.filter(e=>l(e)!==t))};return e.on(t.create,r),e.on(t.update,a),e.on(t.delete,s),()=>{e.off(t.create,r),e.off(t.update,a),e.off(t.delete,s)}},[e,t.create,t.update,t.delete,l,n,o])}function o(e){let{socket:t,events:n=[],onRefresh:i,intervalMs:l,enabled:o=!0,debounceMs:a}=e;(0,r.useEffect)(()=>{if(!o||!t||0===n.length)return;let e=null,r=()=>{if(!a||a<=0){i();return}e&&clearTimeout(e),e=setTimeout(()=>{e=null,i()},a)};return n.forEach(e=>t.on(e,r)),()=>{e&&clearTimeout(e),n.forEach(e=>t.off(e,r))}},[o,t,n,i,a]),(0,r.useEffect)(()=>{if(!o||!l)return;let e=setInterval(i,l);return()=>clearInterval(e)},[o,l,i])}},89056:function(e,t,n){"use strict";n.d(t,{Z:function(){return d}});let r=e=>"object"==typeof e&&null!=e&&1===e.nodeType,i=(e,t)=>(!t||"hidden"!==e)&&"visible"!==e&&"clip"!==e,l=(e,t)=>{if(e.clientHeight<e.scrollHeight||e.clientWidth<e.scrollWidth){let n=getComputedStyle(e,null);return i(n.overflowY,t)||i(n.overflowX,t)||(e=>{let t=(e=>{if(!e.ownerDocument||!e.ownerDocument.defaultView)return null;try{return e.ownerDocument.defaultView.frameElement}catch(e){return null}})(e);return!!t&&(t.clientHeight<e.scrollHeight||t.clientWidth<e.scrollWidth)})(e)}return!1},o=(e,t,n,r,i,l,o,a)=>l<e&&o>t||l>e&&o<t?0:l<=e&&a<=n||o>=t&&a>=n?l-e-r:o>t&&a<n||l<e&&a>n?o-t+i:0,a=e=>{let t=e.parentElement;return null==t?e.getRootNode().host||null:t},s=(e,t)=>{var n,i,s,c;if("undefined"==typeof document)return[];let{scrollMode:d,block:u,inline:h,boundary:p,skipOverflowHiddenElements:y}=t,g="function"==typeof p?p:e=>e!==p;if(!r(e))throw TypeError("Invalid target");let f=document.scrollingElement||document.documentElement,m=[],x=e;for(;r(x)&&g(x);){if((x=a(x))===f){m.push(x);break}null!=x&&x===document.body&&l(x)&&!l(document.documentElement)||null!=x&&l(x,y)&&m.push(x)}let j=null!=(i=null==(n=window.visualViewport)?void 0:n.width)?i:innerWidth,v=null!=(c=null==(s=window.visualViewport)?void 0:s.height)?c:innerHeight,{scrollX:b,scrollY:w}=window,{height:S,width:_,top:k,right:C,bottom:Z,left:T}=e.getBoundingClientRect(),{top:P,right:B,bottom:E,left:z}=(e=>{let t=window.getComputedStyle(e);return{top:parseFloat(t.scrollMarginTop)||0,right:parseFloat(t.scrollMarginRight)||0,bottom:parseFloat(t.scrollMarginBottom)||0,left:parseFloat(t.scrollMarginLeft)||0}})(e),A="start"===u||"nearest"===u?k-P:"end"===u?Z+E:k+S/2-P+E,R="center"===h?T+_/2-z+B:"end"===h?C+B:T-z,O=[];for(let e=0;e<m.length;e++){let t=m[e],{height:n,width:r,top:i,right:a,bottom:s,left:c}=t.getBoundingClientRect();if("if-needed"===d&&k>=0&&T>=0&&Z<=v&&C<=j&&(t===f&&!l(t)||k>=i&&Z<=s&&T>=c&&C<=a))break;let p=getComputedStyle(t),y=parseInt(p.borderLeftWidth,10),g=parseInt(p.borderTopWidth,10),x=parseInt(p.borderRightWidth,10),P=parseInt(p.borderBottomWidth,10),B=0,E=0,z="offsetWidth"in t?t.offsetWidth-t.clientWidth-y-x:0,N="offsetHeight"in t?t.offsetHeight-t.clientHeight-g-P:0,I="offsetWidth"in t?0===t.offsetWidth?0:r/t.offsetWidth:0,L="offsetHeight"in t?0===t.offsetHeight?0:n/t.offsetHeight:0;if(f===t)B="start"===u?A:"end"===u?A-v:"nearest"===u?o(w,w+v,v,g,P,w+A,w+A+S,S):A-v/2,E="start"===h?R:"center"===h?R-j/2:"end"===h?R-j:o(b,b+j,j,y,x,b+R,b+R+_,_),B=Math.max(0,B+w),E=Math.max(0,E+b);else{B="start"===u?A-i-g:"end"===u?A-s+P+N:"nearest"===u?o(i,s,n,g,P+N,A,A+S,S):A-(i+n/2)+N/2,E="start"===h?R-c-y:"center"===h?R-(c+r/2)+z/2:"end"===h?R-a+x+z:o(c,a,r,y,x+z,R,R+_,_);let{scrollLeft:e,scrollTop:l}=t;B=0===L?0:Math.max(0,Math.min(l+B/L,t.scrollHeight-n/L+N)),E=0===I?0:Math.max(0,Math.min(e+E/I,t.scrollWidth-r/I+z)),A+=l-B,R+=e-E}O.push({el:t,top:B,left:E})}return O},c=e=>!1===e?{block:"end",inline:"nearest"}:e===Object(e)&&0!==Object.keys(e).length?e:{block:"start",inline:"nearest"};function d(e,t){if(!e.isConnected||!(e=>{let t=e;for(;t&&t.parentNode;){if(t.parentNode===document)return!0;t=t.parentNode instanceof ShadowRoot?t.parentNode.host:t.parentNode}return!1})(e))return;let n=(e=>{let t=window.getComputedStyle(e);return{top:parseFloat(t.scrollMarginTop)||0,right:parseFloat(t.scrollMarginRight)||0,bottom:parseFloat(t.scrollMarginBottom)||0,left:parseFloat(t.scrollMarginLeft)||0}})(e);if("object"==typeof t&&"function"==typeof t.behavior)return t.behavior(s(e,t));let r="boolean"==typeof t||null==t?void 0:t.behavior;for(let{el:i,top:l,left:o}of s(e,c(t))){let e=l-n.top+n.bottom,t=o-n.left+n.right;i.scroll({top:e,left:t,behavior:r})}}}},function(e){e.O(0,[5015,7717,7698,742,3211,7993,8651,2646,6207,7213,9021,2224,3248,1721,9,5616,8589,5496,3834,8640,6931,19,8056,4547,9356,3410,2297,779,4191,2971,2117,1744],function(){return e(e.s=8118)}),_N_E=e.O()}]);