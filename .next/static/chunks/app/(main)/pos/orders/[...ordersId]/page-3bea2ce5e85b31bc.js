(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1304],{8118:function(e,t,i){Promise.resolve().then(i.bind(i,536))},536:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return eg}});var l=i(57437),r=i(29),n=i.n(r),s=i(2265),a=i(99376),d=i(19683),o=i(34029),c=i(85180),y=i(24783),h=i(80009),u=i(89970),x=i(50742),p=i(47451),m=i(69410),g=i(96931),j=i(4156),v=i(73179),f=i(23496),b=i(62376),_=i(15424),S=i(9738),k=i(13377),Z=i(26349),C=i(49638),z=i(17588),A=i(52539),w=i(67605),B=i(1915),N=i(89245),P=i(96473),T=i(83669),I=i(53286),R=i(97235),H=i(66290),D=i(32446),q=i(34962),L=i(1165),W=i(61414),O=i(71096),F=i.n(O);i(6729);var E=i(33145),M=i(64625),$=i(53743),G=i(88589),Y=i(90136),K=i(29436),Q=i(40312),X=i(22623),J=i(2838),U=i(47799),V=i(3369);let{Text:ee,Title:et}=d.default,ei=e=>{let{isOpen:t,onClose:i,onAddItem:r}=e,{message:a}=M.Z.useApp(),[d,o]=(0,s.useState)([]),[y,h]=(0,s.useState)([]),[u,p]=(0,s.useState)([]),[m,g]=(0,s.useState)(null),[j,v]=(0,s.useState)(""),{showLoading:b,hideLoading:_}=(0,V.x)(),[S,k]=(0,s.useState)(null),[A,w]=(0,s.useState)(1),[B,N]=(0,s.useState)(""),[T,I]=(0,s.useState)([]),R=(0,s.useCallback)(async()=>{try{b("กำลังโหลดข้อมูลสินค้า...");let[e,t]=await Promise.all([U.R.findAll(1,100),J.G.findAll()]);o(e.data),h(e.data),p(Array.isArray(t)?t:[])}catch(e){a.error("ไม่สามารถโหลดข้อมูลได้")}finally{_()}},[b,_,a]),H=(0,s.useCallback)(()=>{w(1),N(""),I([]),k(null),v("")},[]);(0,s.useEffect)(()=>{t&&(R(),H())},[R,t,H]);let D=e=>{g(e),q(j,e)},q=(e,t)=>{let i=d;t&&(i=i.filter(e=>e.category_id===t)),e&&(i=i.filter(t=>t.display_name.toLowerCase().includes(e.toLowerCase()))),h(i)},O=e=>{k(e),w(1),N(""),I([])},F=(e,t,i)=>{I(l=>l.map(l=>{if(l.id!==e)return l;if("price"===t){let e="number"==typeof i?i:Number(i)||0;return{...l,price:e}}return{...l,name:String(i)}}))},ei=e=>{I(t=>t.filter(t=>t.id!==e))},el=async()=>{if(S)try{b("กำลังเพิ่มรายการ...");let e=T.filter(e=>""!==e.name.trim()).map(e=>({detail_name:e.name,extra_price:e.price}));await r(S,A,B,e),a.success("เพิ่มรายการเรียบร้อย"),i(),k(null)}catch(e){}finally{_()}};return(0,l.jsxs)($.Z,{className:"mobile-fullscreen-modal",title:null,open:t,onCancel:i,footer:null,width:850,destroyOnHidden:!0,centered:!0,children:[(0,l.jsx)(n(),{id:L.$k.__hash,children:L.$k}),(0,l.jsxs)("div",{style:L.il.modalHeader,className:"modal-header",children:[S?(0,l.jsx)(x.ZP,{type:"text",icon:(0,l.jsx)(z.Z,{}),onClick:()=>k(null),"aria-label":"กลับ",style:{height:44,width:44,borderRadius:12,background:L._A.backgroundSecondary,display:"flex",alignItems:"center",justifyContent:"center",border:"1px solid ".concat(L._A.border)},className:"scale-hover"}):(0,l.jsx)(x.ZP,{type:"text",icon:(0,l.jsx)(C.Z,{}),onClick:i,"aria-label":"ปิด",style:{height:44,width:44,borderRadius:12,background:L._A.backgroundSecondary,display:"flex",alignItems:"center",justifyContent:"center",border:"1px solid ".concat(L._A.border)},className:"scale-hover"}),(0,l.jsx)(ee,{strong:!0,style:{fontSize:18,flex:1,color:L._A.text,lineHeight:1.4},children:S?"ระบุรายละเอียด":"เลือกสินค้า"})]}),S?(0,l.jsx)("div",{style:L.m4.detailSection,className:"detail-section",children:(0,l.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:20},children:[(0,l.jsxs)("div",{style:{display:"flex",gap:16,alignItems:"flex-start"},className:"product-info-section",children:[S.img_url?(0,l.jsx)(l.Fragment,{children:(0,l.jsx)(E.default,{src:S.img_url,alt:S.display_name,width:100,height:100,style:{objectFit:"cover",borderRadius:12,flexShrink:0}})}):(0,l.jsx)("div",{style:{width:100,height:100,background:L._A.backgroundSecondary,borderRadius:12,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:(0,l.jsx)(Q.Z,{style:{fontSize:32,opacity:.2}})}),(0,l.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,l.jsx)(et,{level:4,style:{margin:"0 0 6px 0",fontSize:20,lineHeight:1.3},children:S.display_name}),(0,l.jsxs)(ee,{style:{fontSize:20,fontWeight:700,color:L._A.primary,lineHeight:1.2},children:["฿",Number(S.price).toLocaleString()]})]})]}),(0,l.jsx)(f.Z,{style:{margin:"0"}}),(0,l.jsxs)("div",{children:[(0,l.jsx)(ee,{strong:!0,style:{display:"block",marginBottom:14,fontSize:16,color:L._A.text},children:"จำนวน"}),(0,l.jsxs)("div",{style:L.il.quantityControl,className:"quantity-control",children:[(0,l.jsx)(x.ZP,{type:"primary",icon:(0,l.jsx)(X.Z,{}),onClick:()=>w(e=>Math.max(1,e-1)),disabled:A<=1,style:{...L.il.quantityButton,background:L._A.white,color:L._A.primary,border:"2px solid ".concat(L._A.primary)},className:"scale-hover quantity-button"}),(0,l.jsx)("div",{style:L.il.quantityDisplay,className:"quantity-display",children:A}),(0,l.jsx)(x.ZP,{type:"primary",icon:(0,l.jsx)(P.Z,{}),onClick:()=>w(e=>e+1),style:{...L.il.quantityButton,background:"linear-gradient(135deg, ".concat(L._A.primary," 0%, ").concat(L._A.primaryDark," 100%)"),border:"none"},className:"scale-hover quantity-button"})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[(0,l.jsx)(ee,{strong:!0,style:{fontSize:16},children:"ตัวเลือกเพิ่มเติม (Optional)"}),(0,l.jsx)(x.ZP,{size:"small",type:"dashed",onClick:()=>{I(e=>[...e,{id:Date.now(),name:"",price:0}])},icon:(0,l.jsx)(P.Z,{}),children:"เพิ่ม"})]}),T.map(e=>(0,l.jsxs)("div",{style:L.m4.detailItemRow,className:"detail-item-row",children:[(0,l.jsx)(G.default,{placeholder:"ไข่ดาว, พิเศษ...",value:e.name,onChange:t=>F(e.id,"name",t.target.value),style:{flex:1,borderRadius:10,height:44,fontSize:15}}),(0,l.jsx)(Y.Z,{placeholder:"0.00",value:e.price,onChange:t=>F(e.id,"price",t||0),style:{width:110,borderRadius:10,height:44,fontSize:15},inputMode:"decimal",controls:!1,min:0,precision:2,formatter:e=>"".concat(e).replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:e=>e.replace(/\$\s?|(,*)/g,""),onKeyDown:t=>{/^[0-9]$/.test(t.key)||["Backspace","Delete","ArrowLeft","ArrowRight","Tab","Enter","."].includes(t.key)||t.preventDefault(),"."===t.key&&e.price.toString().includes(".")&&t.preventDefault()}}),(0,l.jsx)(x.ZP,{type:"text",danger:!0,icon:(0,l.jsx)(Z.Z,{}),onClick:()=>ei(e.id),style:{width:44,height:44,borderRadius:10},className:"scale-hover"})]},e.id))]}),(0,l.jsxs)("div",{children:[(0,l.jsx)(ee,{strong:!0,style:{display:"block",marginBottom:10,fontSize:16,color:L._A.text},children:"หมายเหตุ"}),(0,l.jsx)(G.default.TextArea,{rows:3,value:B,onChange:e=>N(e.target.value),placeholder:"เช่น ไม่ใส่ผัก, เผ็ดน้อย...",style:{borderRadius:12,fontSize:15,padding:"12px 14px",lineHeight:1.5}})]}),(0,l.jsxs)("div",{style:{marginTop:24},children:[(0,l.jsxs)("div",{style:L.il.priceCard,children:[(0,l.jsx)(ee,{strong:!0,style:{fontSize:16,color:L._A.text},children:"ยอดรวมรายการนี้"}),(0,l.jsx)(et,{level:4,style:{margin:0,color:L._A.priceTotal,fontSize:24},children:(0,W.xG)((()=>{if(!S)return 0;let e=T.map(e=>({detail_name:e.name,extra_price:e.price}));return(0,W.ku)(S.price,A,e)})())})]}),(0,l.jsxs)("div",{style:L.il.actionButtons,className:"action-buttons",children:[(0,l.jsx)(x.ZP,{onClick:()=>k(null),style:L.il.secondaryButton,className:"scale-hover secondary-button",children:"ย้อนกลับ"}),(0,l.jsx)(x.ZP,{type:"primary",onClick:el,icon:(0,l.jsx)(P.Z,{}),style:L.il.primaryButton,className:"scale-hover primary-button",children:"เพิ่มลงออเดอร์"})]})]})]})}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{style:{...L.m4.searchBar,paddingBottom:8},children:[(0,l.jsx)(G.default,{placeholder:"ค้นหาสินค้าหรือรหัส...",prefix:(0,l.jsx)(K.Z,{style:{color:L._A.textSecondary}}),value:j,onChange:e=>{let t=e.target.value;v(t),q(t,m)},allowClear:!0,style:{...L.m4.searchInput,marginBottom:12}}),(0,l.jsxs)("div",{style:{display:"flex",overflowX:"auto",gap:8,paddingBottom:4,scrollBehavior:"smooth",scrollbarWidth:"none",msOverflowStyle:"none"},className:"hide-scrollbar",children:[(0,l.jsx)(x.ZP,{size:"middle",type:null===m?"primary":"default",onClick:()=>D(null),style:{borderRadius:20,minWidth:70,border:null===m?"none":"1px solid ".concat(L._A.border)},children:"ทั้งหมด"}),u.map(e=>(0,l.jsx)(x.ZP,{size:"middle",type:m===e.id?"primary":"default",onClick:()=>D(e.id),style:{borderRadius:20,border:m===e.id?"none":"1px solid ".concat(L._A.border)},children:e.display_name||e.category_name},e.id))]})]}),(0,l.jsxs)("div",{style:{maxHeight:"calc(100vh - 180px)",overflowY:"auto",paddingBottom:20},className:"order-detail-content",children:[(0,l.jsx)("div",{style:L.m4.productGrid,className:"product-grid",children:y.map(e=>(0,l.jsxs)("div",{style:L.m4.productCard,onClick:()=>O(e),className:"product-card-hoverable scale-in",children:[(0,l.jsx)("div",{style:{position:"relative",width:"100%",height:130,background:L._A.backgroundSecondary},children:e.img_url?(0,l.jsx)(l.Fragment,{children:(0,l.jsx)(E.default,{alt:e.display_name,src:e.img_url,fill:!0,style:{objectFit:"cover",borderRadius:"12px 12px 0 0"},sizes:"(max-width: 768px) 50vw, (max-width: 1200px) 33vw, 25vw"})}):(0,l.jsx)("div",{style:L.m4.productPlaceholder,children:(0,l.jsx)(Q.Z,{style:{fontSize:28,opacity:.3}})})}),(0,l.jsxs)("div",{style:L.m4.productInfo,className:"product-info",children:[(0,l.jsx)("div",{style:{...L.m4.productName},className:"product-name",children:e.display_name}),(0,l.jsx)(ee,{style:{...L.m4.productPrice},className:"product-price",children:(0,W.xG)(e.price)})]})]},e.id))}),0===y.length&&(0,l.jsx)(c.Z,{description:"ไม่พบสินค้าที่คุณต้องการ",style:{marginTop:60,padding:"40px 20px"}})]})]})]})};var el=i(78355);let{Text:er,Title:en}=d.default,{TextArea:es}=G.default,ea=e=>{var t,i,r,n,a,d;let{item:c,isOpen:u,onClose:p,onSave:m}=e,[g,j]=(0,s.useState)(1),[v,b]=(0,s.useState)(""),[S,k]=(0,s.useState)([]),z=(0,s.useRef)(null),{showLoading:A,hideLoading:w}=(0,V.x)();(0,s.useEffect)(()=>{if(c&&u){let e=c.id;e!==z.current&&(j(c.quantity),b(c.notes||""),k(c.details?[...c.details.map(e=>({detail_name:e.detail_name,extra_price:e.extra_price}))]:[]),z.current=e)}},[c,u]),(0,s.useEffect)(()=>{u||(z.current=null,j(1),b(""),k([]))},[u]);let B=(0,s.useCallback)(async()=>{if(c)try{A("กำลังบันทึกแก้ไข...");let e=S.filter(e=>e.detail_name&&""!==e.detail_name.trim());await m(c.id,g,v,e)}catch(e){console.error(e),o.ZP.error("บันทึกรายการไม่สำเร็จ")}finally{w()}},[c,g,v,S,m,A,w]),N=(0,s.useCallback)(()=>{j(e=>e+1)},[]),T=(0,s.useCallback)(()=>{j(e=>Math.max(1,e-1))},[]),I=(0,s.useCallback)(()=>{k(e=>[...e,{detail_name:"",extra_price:0}])},[]),R=(0,s.useCallback)(e=>{k(t=>t.filter((t,i)=>i!==e))},[]),H=(0,s.useCallback)((e,t,i)=>{k(l=>{let r=[...l];return r[e]={...r[e],[t]:i},r})},[]);return c?(0,l.jsxs)($.Z,{className:"mobile-fullscreen-modal",title:null,open:u,onCancel:p,footer:null,width:500,destroyOnHidden:!0,centered:!0,closable:!1,children:[(0,l.jsxs)("div",{style:L.il.modalHeader,className:"modal-header",children:[(0,l.jsx)(er,{strong:!0,style:{fontSize:18,flex:1,color:L._A.text,lineHeight:1.4},children:"แก้ไขรายการ"}),(0,l.jsx)(x.ZP,{type:"text",icon:(0,l.jsx)(C.Z,{}),onClick:p,"aria-label":"ปิด",style:{height:44,width:44,display:"flex",alignItems:"center",justifyContent:"center",borderRadius:12,color:L._A.textSecondary,background:L._A.backgroundSecondary,border:"1px solid ".concat(L._A.border)},className:"scale-hover"})]}),(0,l.jsxs)("div",{style:{padding:"20px",maxHeight:"calc(100vh - 200px)",overflowY:"auto"},children:[(0,l.jsxs)("div",{style:{display:"flex",gap:16,marginBottom:24,alignItems:"center",background:L._A.backgroundSecondary,padding:16,borderRadius:16},children:[(0,l.jsx)("div",{style:{flexShrink:0},children:(null===(t=c.product)||void 0===t?void 0:t.img_url)?(0,l.jsx)(E.default,{src:c.product.img_url,alt:null!==(d=null===(i=c.product)||void 0===i?void 0:i.display_name)&&void 0!==d?d:"สินค้า",width:80,height:80,style:{borderRadius:14,objectFit:"cover",border:"1px solid ".concat(L._A.borderLight)}}):(0,l.jsx)("div",{style:{width:80,height:80,borderRadius:14,background:"linear-gradient(135deg, ".concat(L._A.primaryLight," 0%, #DBEAFE 100%)"),display:"flex",alignItems:"center",justifyContent:"center"},children:(0,l.jsx)(_.Z,{style:{fontSize:28,color:L._A.primary,opacity:.5}})})}),(0,l.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,l.jsx)(en,{level:5,style:{margin:0,fontSize:18,color:L._A.text},children:(null===(r=c.product)||void 0===r?void 0:r.display_name)||"ไม่ระบุ"}),(0,l.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginTop:6},children:[(null===(a=c.product)||void 0===a?void 0:null===(n=a.category)||void 0===n?void 0:n.display_name)&&(0,l.jsx)(h.Z,{color:"cyan",style:{fontSize:11,margin:0,borderRadius:6,fontWeight:500},children:c.product.category.display_name}),(0,l.jsx)(er,{style:{fontSize:16,fontWeight:600,color:L._A.primary},children:(0,W.xG)(c.price)})]})]})]}),(0,l.jsxs)("div",{style:{marginBottom:24},children:[(0,l.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14},children:[(0,l.jsx)(er,{strong:!0,style:{fontSize:16,color:L._A.text},children:"รายการเพิ่มเติม (Topping)"}),(0,l.jsx)(x.ZP,{type:"text",icon:(0,l.jsx)(P.Z,{style:{fontSize:12}}),onClick:I,style:{borderRadius:12,background:L._A.primaryLight,color:L._A.primary,fontWeight:600,fontSize:13,height:36,padding:"0 16px",border:"1px solid ".concat(L._A.primary,"30"),display:"flex",alignItems:"center",justifyContent:"center"},className:"scale-hover",children:"เพิ่มรายการ"})]}),0===S.length?(0,l.jsx)("div",{style:{textAlign:"center",padding:"16px",background:L._A.backgroundSecondary,borderRadius:12,border:"1px dashed ".concat(L._A.border)},children:(0,l.jsx)(er,{type:"secondary",style:{fontSize:13},children:"ไม่มีรายการเพิ่มเติม"})}):(0,l.jsx)(y.Z,{direction:"vertical",style:{width:"100%"},size:12,children:S.map((e,t)=>(0,l.jsxs)("div",{style:{display:"flex",gap:10,alignItems:"center",padding:"12px 14px",background:L._A.backgroundSecondary,borderRadius:12,border:"1px solid ".concat(L._A.border)},children:[(0,l.jsx)(G.default,{placeholder:"รายการ",value:e.detail_name,onChange:e=>H(t,"detail_name",e.target.value),style:{flex:2,borderRadius:10,height:44,fontSize:15}}),(0,l.jsx)(Y.Z,{placeholder:"ราคา",value:e.extra_price,onChange:e=>H(t,"extra_price",e||0),style:{flex:1,borderRadius:10,height:44,fontSize:15},inputMode:"decimal",controls:!1,min:0,precision:2,formatter:e=>"".concat(e).replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:e=>e.replace(/\$\s?|(,*)/g,""),onKeyDown:t=>{/^[0-9]$/.test(t.key)||["Backspace","Delete","ArrowLeft","ArrowRight","Tab","Enter","."].includes(t.key)||t.preventDefault(),"."===t.key&&e.extra_price.toString().includes(".")&&t.preventDefault()}}),(0,l.jsx)(x.ZP,{danger:!0,type:"text",icon:(0,l.jsx)(Z.Z,{}),onClick:()=>R(t),style:{color:L._A.danger,borderRadius:10,width:44,height:44},className:"scale-hover"})]},t))})]}),(0,l.jsx)(f.Z,{style:{margin:"0 0 20px 0"}}),(0,l.jsxs)("div",{style:{marginBottom:24},children:[(0,l.jsx)(er,{strong:!0,style:{display:"block",marginBottom:14,fontSize:16,color:L._A.text},children:"ปรับจำนวน"}),(0,l.jsxs)("div",{style:L.il.quantityControl,className:"quantity-control",children:[(0,l.jsx)(x.ZP,{type:"primary",icon:(0,l.jsx)(X.Z,{}),onClick:T,disabled:g<=1,style:{...L.il.quantityButton,background:L._A.white,color:L._A.primary,border:"2px solid ".concat(L._A.primary)},className:"scale-hover quantity-button"}),(0,l.jsx)("div",{style:L.il.quantityDisplay,className:"quantity-display",children:g}),(0,l.jsx)(x.ZP,{type:"primary",icon:(0,l.jsx)(P.Z,{}),onClick:N,style:{...L.il.quantityButton,background:"linear-gradient(135deg, ".concat(L._A.primary," 0%, ").concat(L._A.primaryDark," 100%)"),border:"none"},className:"scale-hover quantity-button"})]})]}),(0,l.jsxs)("div",{style:{marginBottom:24},children:[(0,l.jsx)(er,{strong:!0,style:{display:"block",marginBottom:10,fontSize:16,color:L._A.text},children:"หมายเหตุ / คำแนะนำพิเศษ"}),(0,l.jsx)(es,{value:v,onChange:e=>b(e.target.value),placeholder:"เช่น หวานน้อย, ไม่ใส่น้ำตาล...",rows:3,style:{borderRadius:12,padding:"12px 14px",fontSize:15,lineHeight:1.5}})]}),(0,l.jsxs)("div",{style:L.il.priceCard,children:[(0,l.jsx)(er,{strong:!0,style:{fontSize:16,color:L._A.text},children:"ยอดรวมรายการนี้"}),(0,l.jsxs)(en,{level:4,style:{margin:0,color:L._A.priceTotal,fontSize:22},children:["฿",(0,W.ku)(Number(c.price),g,S).toLocaleString()]})]})]}),(0,l.jsxs)("div",{style:L.il.actionButtons,className:"action-buttons",children:[(0,l.jsx)(x.ZP,{onClick:p,style:L.il.secondaryButton,className:"scale-hover secondary-button",children:"ยกเลิก"}),(0,l.jsx)(x.ZP,{type:"primary",onClick:B,icon:(0,l.jsx)(el.Z,{}),style:L.il.primaryButton,className:"scale-hover primary-button",children:"บันทึกแก้ไข"})]})]},(null==c?void 0:c.id)||"edit-modal"):null};var ed=i(60300),eo=i(20920),ec=i(84859),ey=i(24675),eh=i(67697),eu=i(88444),ex=i(5325);let{Title:ep,Text:em}=d.default;function eg(){var e,t,i;let r=(0,a.useRouter)(),d=(0,a.useParams)(),O=Array.isArray(null==d?void 0:d.ordersId)?d.ordersId[0]:null==d?void 0:d.ordersId,[E,M]=(0,s.useState)(null),[$,G]=(0,s.useState)(!0),[Y,K]=(0,s.useState)(!1),{showLoading:Q,hideLoading:X}=(0,V.x)(),{socket:J}=(0,ey.s)(),U=(0,eo.L)(),{queue:ee,addToQueue:et,removeFromQueue:el,isLoading:er}=(0,eu.G)(),en=E?ee.find(e=>e.order_id===E.id):null,[es,eg]=(0,s.useState)([]),[ej,ev]=(0,s.useState)(!1),[ef,eb]=(0,s.useState)(null),[e_,eS]=(0,s.useState)(!1),[ek,eZ]=(0,s.useState)({open:!1,type:"confirm",title:"",content:"",onOk:()=>{}}),eC=()=>eZ(e=>({...e,open:!1})),ez=(0,s.useCallback)(async e=>{try{G(!0),Q("กำลังโหลดข้อมูลออเดอร์...");let t=await I.x.getById(e);if([D.i.Paid,D.i.Cancelled,D.i.WaitingForPayment].includes(t.status)){let e=(0,W.EO)(t);r.push(e);return}M(t)}catch(e){o.ZP.error("ไม่สามารถโหลดข้อมูลออเดอร์ได้")}finally{G(!1),X()}},[r,Q,X]);(0,s.useEffect)(()=>{O&&ez(O)},[O,ez]),(0,eh.D)({socket:J,events:["orders:update","orders:delete","orders:create","payments:create","payments:update"],onRefresh:()=>{O&&ez(O)},intervalMs:15e3,enabled:!!O});let eA=async e=>{try{K(!0),Q("กำลังดำเนินการเสิร์ฟ...");let t=await (0,R.P)();await I.x.updateItemStatus(e,D.i.Served,void 0,t),o.ZP.success("เสิร์ฟรายการเรียบร้อย"),ez(O)}catch(e){o.ZP.error("เกิดข้อผิดพลาดในการเสิร์ฟ")}finally{K(!1),X()}},ew=async()=>{if(0!==es.length)try{K(!0),Q("กำลังดำเนินการเสิร์ฟ ".concat(es.length," รายการ..."));let e=await (0,R.P)();await Promise.all(es.map(t=>I.x.updateItemStatus(t.toString(),D.i.Served,void 0,e))),o.ZP.success("เสิร์ฟรายการที่เลือกเรียบร้อย"),eg([]),ez(O)}catch(e){o.ZP.error("เกิดข้อผิดพลาดในการเสิร์ฟ")}finally{K(!1),X()}},eB=async()=>{0!==es.length&&eZ({open:!0,type:"danger",title:"ยืนยันการยกเลิก",content:"คุณต้องการยกเลิก ".concat(es.length," รายการที่เลือกใช่หรือไม่?"),okText:"ยืนยันยกเลิก",cancelText:"ไม่ยกเลิก",onOk:async()=>{try{K(!0),Q("กำลังดำเนินการยกเลิก..."),eC();let e=await (0,R.P)();await Promise.all(es.map(t=>I.x.updateItemStatus(t.toString(),D.i.Cancelled,void 0,e))),o.ZP.success("ยกเลิกรายการที่เลือกเรียบร้อย"),eg([]),ez(O)}catch(e){o.ZP.error("เกิดข้อผิดพลาดในการยกเลิก")}finally{K(!1),X()}}})},eN=async e=>{try{K(!0),Q("กำลังย้อนกลับสถานะ...");let t=await (0,R.P)();await I.x.updateItemStatus(e,D.i.Cooking,void 0,t),o.ZP.success("ยกเลิกการเสิร์ฟ (กลับไปปรุง)"),ez(O)}finally{K(!1),X()}},eP=async e=>{eZ({open:!0,type:"danger",title:"ยืนยันการลบ",content:"คุณต้องการลบรายการสินค้านี้ใช่หรือไม่?",okText:"ลบ",cancelText:"ยกเลิก",onOk:async()=>{try{K(!0),Q("กำลังลบรายการ..."),eC();let t=await (0,R.P)();await I.x.deleteItem(e,void 0,t),o.ZP.success("ลบรายการเรียบร้อย"),ez(O)}catch(e){o.ZP.error("ไม่สามารถลบรายการได้")}finally{K(!1),X()}}})},eT=async function(e,t,i){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];try{K(!0),Q("กำลังบันทึกข้อมูล...");let r=await (0,R.P)();if(!t||t<1)throw o.ZP.error("จำนวนต้องมากกว่า 0"),Error("Invalid quantity");let n={quantity:Number(t),notes:String(i||""),details:Array.isArray(l)?l.map(e=>({detail_name:String(e.detail_name||""),extra_price:Number(e.extra_price||0)})):[]};await I.x.updateItem(e,n,void 0,r),o.ZP.success("แก้ไขรายการเรียบร้อย"),ev(!1),eb(null),ev(!1),eb(null),await new Promise(e=>setTimeout(e,600)),await ez(O),setTimeout(async()=>{var i;let l=await I.x.getById(O),r=null==l?void 0:null===(i=l.items)||void 0===i?void 0:i.find(t=>t.id===e);r&&(r.quantity===t?M(l):setTimeout(async()=>{await ez(O)},1e3))},500)}catch(e){throw o.ZP.error("ไม่สามารถแก้ไขรายการได้"),e}finally{K(!1),X()}},eI=e=>{eb(e),ev(!0)},eR=async function(e,t,i){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],r=(Number(e.price)+l.reduce((e,t)=>e+t.extra_price,0))*t;if(!U){ec.x.addToQueue("ADD_ITEM",{orderId:O,itemData:{product_id:e.id,quantity:t,price:e.price,notes:i,discount_amount:0,total_price:r,details:l}}),o.ZP.warning("บันทึกข้อมูลแบบ Offline แล้ว"),ez(O);return}try{K(!0),Q("กำลังเพิ่มสินค้า...");let n=await (0,R.P)();await I.x.addItem(O,{product_id:e.id,quantity:t,price:e.price,notes:i,discount_amount:0,total_price:r,details:l,status:D.i.Cooking},void 0,n),o.ZP.success("เพิ่มสินค้าเรียบร้อย"),ez(O)}catch(e){throw o.ZP.error("เพิ่มสินค้าไม่สำเร็จ"),e}finally{K(!1),X()}},eH=async()=>{let e=(null==E?void 0:E.order_type)===D.m.Delivery;eZ({open:!0,type:"success",title:e?"ยืนยันจัดออเดอร์เสร็จสิ้น":"ยืนยันการ".concat((0,W.qO)(null==E?void 0:E.order_type),"ทั้งหมด"),content:e?"จัดเตรียมอาหารเรียบร้อยแล้ว ต้องการส่งมอบให้ไรเดอร์หรือไม่?":"รายการทั้งหมดเสร็จสิ้นแล้ว ต้องการเข้าสู่ขั้นตอนการชำระเงินหรือไม่?",okText:"ยืนยัน",cancelText:"ยกเลิก",onOk:async()=>{try{K(!0),Q("กำลังยืนยันรายการ..."),eC();let e=await (0,R.P)();if(await I.x.updateStatus(O,D.i.WaitingForPayment,e),o.ZP.success("ยืนยันออเดอร์เรียบร้อย"),E){let e=(0,W.EO)(E);r.push(e)}else r.push("/pos/orders")}catch(e){o.ZP.error("เกิดข้อผิดพลาดในการยืนยัน")}finally{K(!1),X()}}})};if($&&!E)return null;if(!E)return(0,l.jsx)(c.Z,{description:"ไม่พบข้อมูล"});let eD=[{title:"",key:"image",width:70,align:"center",render:(e,t)=>{var i,r,n;return(null===(i=t.product)||void 0===i?void 0:i.img_url)?(0,l.jsx)(l.Fragment,{children:(0,l.jsx)("img",{src:t.product.img_url,alt:null!==(n=null===(r=t.product)||void 0===r?void 0:r.display_name)&&void 0!==n?n:"สินค้า",style:L.B9.productThumb})}):(0,l.jsx)("div",{style:L.B9.productThumbPlaceholder,children:(0,l.jsx)(b.Z,{})})}},{title:"รายการ",key:"product",align:"center",render:(e,t)=>{var i;return(0,l.jsxs)(y.Z,{orientation:"vertical",size:2,align:"center",children:[(0,l.jsx)(em,{strong:!0,style:{fontSize:15,lineHeight:"1.2"},children:null===(i=t.product)||void 0===i?void 0:i.display_name}),t.details&&t.details.length>0&&(0,l.jsx)("div",{style:{fontSize:13,color:L._A.served,textAlign:"center"},children:t.details.map((e,t)=>(0,l.jsxs)("div",{style:{lineHeight:"1.4"},children:["+ ",e.detail_name]},t))}),t.notes&&(0,l.jsxs)(em,{style:{fontSize:13,color:L._A.cancelled},children:[(0,l.jsx)(_.Z,{})," ",t.notes]})]})}},{title:"หมวดหมู่",key:"category",width:120,align:"center",render:(e,t)=>{var i,r;return(0,l.jsx)(y.Z,{orientation:"vertical",size:0,align:"center",children:(null===(r=t.product)||void 0===r?void 0:null===(i=r.category)||void 0===i?void 0:i.display_name)?(0,l.jsx)(h.Z,{color:"cyan",style:L.B9.categoryTag,children:t.product.category.display_name}):"-"})}},{title:"ราคา",key:"price",width:110,align:"center",render:(e,t)=>(0,l.jsxs)(y.Z,{orientation:"vertical",size:0,align:"center",children:[(0,l.jsxs)(em,{style:{...L.B9.priceTag,fontSize:18},children:["฿",Number(t.price).toLocaleString()]}),t.details&&t.details.length>0&&t.details.map((e,t)=>(0,l.jsxs)(em,{style:{fontSize:13,color:L._A.priceTotal,display:"block",lineHeight:"1.4"},children:["+ ฿",Number(e.extra_price).toLocaleString()]},t))]})},{title:"สถานะ",dataIndex:"status",key:"status",width:120,align:"center",render:e=>(0,l.jsx)(h.Z,{color:e===D.i.Pending?"orange":e===D.i.Cooking?"blue":"green",children:(0,W.d7)(e,E.order_type)})},{title:"จำนวน",dataIndex:"quantity",key:"quantity",width:80,align:"center",render:e=>(0,l.jsxs)(em,{strong:!0,style:{fontSize:16},children:["x",e]})},{title:"จัดการ",key:"actions",width:130,align:"right",render:(e,t)=>(0,l.jsxs)(y.Z,{children:[(0,l.jsx)(u.Z,{title:(0,W.qO)(E.order_type),children:(0,l.jsxs)(x.ZP,{type:"primary",onClick:()=>eA(t.id),style:{background:L._A.served,borderColor:L._A.served,height:"auto",padding:"4px 8px",display:"flex",flexDirection:"column",alignItems:"center",gap:2,minWidth:60,borderRadius:10},children:[(0,l.jsx)(S.Z,{style:{fontSize:16}}),(0,l.jsx)("span",{style:{fontSize:10,fontWeight:700},children:(0,W.qO)(E.order_type)})]})}),(0,l.jsx)(u.Z,{title:"แก้ไข",children:(0,l.jsx)(x.ZP,{type:"text",icon:(0,l.jsx)(k.Z,{}),onClick:()=>eI(t)})}),(0,l.jsx)(u.Z,{title:"ลบ",children:(0,l.jsx)(x.ZP,{type:"text",danger:!0,icon:(0,l.jsx)(Z.Z,{}),onClick:()=>eP(t.id)})})]})}],eq=[{title:"",key:"image",width:70,align:"center",render:(e,t)=>{var i,r,n;return(null===(i=t.product)||void 0===i?void 0:i.img_url)?(0,l.jsx)(l.Fragment,{children:(0,l.jsx)("img",{src:t.product.img_url,alt:null!==(n=null===(r=t.product)||void 0===r?void 0:r.display_name)&&void 0!==n?n:"สินค้า",style:{...L.B9.productThumb,opacity:.7}})}):(0,l.jsx)("div",{style:L.B9.productThumbPlaceholder,children:(0,l.jsx)(b.Z,{})})}},{title:"รายการ",key:"product",align:"center",render:(e,t)=>{var i;return(0,l.jsxs)(y.Z,{orientation:"vertical",size:2,align:"center",children:[(0,l.jsx)(em,{strong:!0,style:{fontSize:15,lineHeight:"1.2",textDecoration:t.status===D.i.Cancelled?"line-through":"none",color:t.status===D.i.Cancelled?L._A.textLight:L._A.text},children:null===(i=t.product)||void 0===i?void 0:i.display_name}),t.details&&t.details.length>0&&(0,l.jsx)("div",{style:{fontSize:12,color:L._A.served,opacity:.7,textAlign:"center"},children:t.details.map((e,t)=>(0,l.jsxs)("div",{style:{lineHeight:"1.4"},children:["+ ",e.detail_name]},t))}),t.notes&&(0,l.jsxs)(em,{style:{fontSize:12,opacity:.7,color:L._A.cancelled},children:[(0,l.jsx)(_.Z,{})," ",t.notes]})]})}},{title:"หมวดหมู่",key:"category",width:120,align:"center",render:(e,t)=>{var i,r;return(0,l.jsx)(y.Z,{orientation:"vertical",size:0,align:"center",children:(null===(r=t.product)||void 0===r?void 0:null===(i=r.category)||void 0===i?void 0:i.display_name)?(0,l.jsx)(h.Z,{color:"cyan",style:{...L.B9.categoryTag,opacity:.7},children:t.product.category.display_name}):"-"})}},{title:"ราคา",key:"price",width:110,align:"center",render:(e,t)=>(0,l.jsxs)(y.Z,{orientation:"vertical",size:0,align:"center",children:[(0,l.jsxs)(em,{style:{...L.B9.priceTag,opacity:.7},children:["฿",Number(t.price).toLocaleString()]}),t.details&&t.details.length>0&&t.details.map((e,t)=>(0,l.jsxs)(em,{style:{fontSize:11,opacity:.7,color:L._A.priceTotal,display:"block",lineHeight:"1.4"},children:["+ ฿",Number(e.extra_price).toLocaleString()]},t))]})},{title:"ราคารวม",key:"total",width:120,align:"center",render:(e,t)=>(0,l.jsxs)(em,{strong:!0,style:{color:t.status===D.i.Cancelled?L._A.textLight:L._A.priceTotal,fontSize:16,textDecoration:t.status===D.i.Cancelled?"line-through":"none"},children:["฿",Number(t.total_price).toLocaleString()]})},{title:"สถานะ",dataIndex:"status",key:"status",width:120,align:"center",render:e=>(0,l.jsx)(h.Z,{color:(0,W.OY)(e),children:(0,W.d7)(e,E.order_type)})},{title:"จำนวน",dataIndex:"quantity",key:"quantity",width:80,align:"center",render:e=>(0,l.jsxs)(em,{strong:!0,style:{fontSize:16},children:["x",e]})},{title:"จัดการ",key:"actions",width:130,align:"right",render:(e,t)=>t.status===D.i.Served?(0,l.jsx)(x.ZP,{size:"small",className:"unserve-button",style:L.B9.unserveButton,icon:(0,l.jsx)(C.Z,{}),onClick:()=>eN(t.id),children:E.order_type===D.m.DineIn?"ยกเลิกเสิร์ฟ":"ยกเลิกปรุงเสร็จ"}):null}],eL=(null===(e=E.items)||void 0===e?void 0:e.filter(e=>e.status===D.i.Pending||e.status===D.i.Cooking))||[],eW=((null===(t=E.items)||void 0===t?void 0:t.filter(e=>e.status===D.i.Served||e.status===D.i.Cancelled||e.status===D.i.WaitingForPayment))||[]).sort((e,t)=>e.status===D.i.Cancelled&&t.status!==D.i.Cancelled?1:e.status!==D.i.Cancelled&&t.status===D.i.Cancelled?-1:0),eO=(0,W.Nz)(E.items),eF=(0,W.yj)(E.items),eE=0===eL.length&&((null===(i=E.items)||void 0===i?void 0:i.length)||0)>0,eM=eL.length>12,e$=eW.length>12;return(0,l.jsxs)("div",{style:L.B9.container,className:"order-detail-page",children:[(0,l.jsx)(n(),{id:L.$k.__hash,children:L.$k}),(0,l.jsx)("header",{style:L.B9.header,className:"order-detail-header",children:(0,l.jsxs)("div",{style:L.B9.headerContent,className:"header-content",children:[(0,l.jsx)(x.ZP,{type:"text",icon:(0,l.jsx)(z.Z,{}),onClick:()=>{(null==E?void 0:E.order_type)===D.m.DineIn?r.push("/pos/channels/dine-in"):r.back()},"aria-label":"กลับ",style:L.B9.headerBackButton,className:"scale-hover header-back-button"}),(0,l.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,l.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,flexWrap:"wrap",marginBottom:4},children:[(0,l.jsx)(ep,{level:4,style:L.B9.headerTitle,className:"header-title",children:E.order_no}),E.order_type===D.m.DineIn&&E.table&&(0,l.jsxs)(h.Z,{style:L.B9.tableNameBadge,children:["\uD83E\uDE91 โต๊ะ ",E.table.table_name]}),E.order_type===D.m.Delivery&&E.delivery_code&&(0,l.jsxs)(h.Z,{style:L.B9.tableNameBadge,children:["\uD83D\uDCCB ",E.delivery_code]}),(0,l.jsx)(h.Z,{color:(0,W.OY)(E.status),className:"status-badge",style:{margin:0,fontSize:12,fontWeight:600,borderRadius:8,padding:"4px 12px",lineHeight:1.3},children:(0,W.d7)(E.status,E.order_type)})]}),(0,l.jsxs)("div",{style:L.B9.headerMetaRow,children:[(0,l.jsx)(h.Z,{icon:E.order_type===D.m.DineIn?(0,l.jsx)(b.Z,{style:{fontSize:10}}):E.order_type===D.m.TakeAway?(0,l.jsx)(A.Z,{style:{fontSize:10}}):(0,l.jsx)(w.Z,{style:{fontSize:10}}),style:{...L.B9.channelBadge,background:(0,W.Gs)(E.order_type)+"15",color:(0,W.Gs)(E.order_type)},children:(0,W.mz)(E.order_type)}),(0,l.jsx)("div",{style:L.B9.headerMetaSeparator}),(0,l.jsx)(em,{type:"secondary",style:{fontSize:11,lineHeight:1.2},children:F()(E.create_date).format("HH:mm | D MMM YY")}),en&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{style:L.B9.headerMetaSeparator}),(0,l.jsxs)(h.Z,{color:en.status===ex.l.Pending?"orange":en.status===ex.l.Processing?"blue":en.status===ex.l.Completed?"green":"red",style:{margin:0,fontSize:11,borderRadius:6,padding:"3px 10px",lineHeight:1.3},children:["คิว #",en.queue_position]})]})]})]})]})}),E&&E.status!==D.i.Cancelled&&E.status!==D.i.Completed&&(0,l.jsx)("div",{style:{padding:"12px 16px",display:"flex",justifyContent:"flex-end",gap:8,background:L._A.backgroundSecondary,borderBottom:"1px solid ".concat(L._A.border)},children:en?(0,l.jsx)(x.ZP,{danger:!0,icon:(0,l.jsx)(Z.Z,{}),onClick:()=>{el(en.id)},loading:er,size:"middle",style:{borderRadius:10,height:36,fontWeight:500,fontSize:13},className:"scale-hover queue-action-button",children:"ลบออกจากคิว"}):(0,l.jsx)(x.ZP,{type:"primary",icon:(0,l.jsx)(B.Z,{}),onClick:()=>{et({orderId:E.id,priority:ex.t.Normal})},loading:er,size:"middle",style:{borderRadius:10,height:36,fontWeight:500,fontSize:13,background:"linear-gradient(135deg, ".concat(L._A.primary," 0%, ").concat(L._A.primaryDark," 100%)"),border:"none",boxShadow:"0 2px 8px ".concat(L._A.primary,"25")},className:"scale-hover queue-action-button",children:"เพิ่มเข้าคิว"})}),(0,l.jsx)("main",{style:L.B9.contentWrapper,className:"order-detail-content",children:(0,l.jsxs)(p.Z,{gutter:[20,20],children:[(0,l.jsxs)(m.Z,{xs:24,lg:16,children:[(0,l.jsx)(g.Z,{className:"order-detail-card fade-in",style:L.B9.card,title:(0,l.jsxs)("div",{className:"card-header-wrapper",children:[(0,l.jsxs)("div",{className:"card-header-top-row",children:[(0,l.jsxs)("div",{className:"card-header-left",children:[(0,l.jsx)("div",{style:L.B9.masterCheckboxWrapper,children:(0,l.jsx)(j.Z,{indeterminate:es.length>0&&es.length<eL.length,checked:eL.length>0&&es.length===eL.length,onChange:e=>{e.target.checked?eg(eL.map(e=>e.id)):eg([])},style:L.B9.masterCheckbox})}),(0,l.jsxs)(em,{strong:!0,style:L.Qo.sectionTitle,className:"section-title-text",children:["กำลังทำอาหาร (",eL.length,")"]})]}),(0,l.jsx)("div",{className:"card-header-right",children:(0,l.jsxs)("div",{className:"header-actions-container",children:[(0,l.jsx)(x.ZP,{icon:(0,l.jsx)(N.Z,{}),onClick:()=>ez(O),size:"small",style:L.B9.actionButtonSecondary,className:"header-action-btn",title:"รีเฟรช"}),(0,l.jsx)(x.ZP,{type:"primary",icon:(0,l.jsx)(P.Z,{}),onClick:()=>eS(!0),size:"small",style:L.B9.actionButtonPrimary,className:"header-action-btn",children:(0,l.jsx)("span",{children:"เพิ่ม"})})]})})]}),es.length>0&&(0,l.jsxs)("div",{className:"bulk-actions-container",children:[(0,l.jsx)(x.ZP,{danger:!0,icon:(0,l.jsx)(Z.Z,{}),onClick:eB,size:"small",className:"bulk-action-btn",children:(0,l.jsxs)("span",{children:["ยกเลิก (",es.length,")"]})}),(0,l.jsx)(x.ZP,{type:"primary",icon:(0,l.jsx)(S.Z,{}),onClick:ew,loading:Y,size:"small",style:{background:L._A.served,borderColor:L._A.served},className:"bulk-action-btn",children:(0,l.jsxs)("span",{children:[(0,W.qO)(E.order_type)," (",es.length,")"]})})]})]}),children:eL.length>0?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"order-detail-table-desktop",children:(0,l.jsx)(v.Z,{dataSource:eL,columns:eD,rowKey:"id",virtual:eM,scroll:eM?{y:420}:void 0,pagination:!1,size:"middle",className:"order-items-table",rowSelection:{selectedRowKeys:es,onChange:e=>{eg(e)},hideSelectAll:!0}})}),(0,l.jsx)("div",{className:"order-detail-cards-mobile",children:eL.map(e=>{var t,i,r,n,s,a;return(0,l.jsxs)("div",{style:{...L.B9.itemCard,...L.B9.itemCardActive},className:"order-item-card scale-in",children:[(0,l.jsxs)("div",{style:{display:"flex",gap:10,marginBottom:10},children:[(0,l.jsx)("div",{style:{flexShrink:0},children:(null===(t=e.product)||void 0===t?void 0:t.img_url)?(0,l.jsx)(l.Fragment,{children:(0,l.jsx)("img",{src:e.product.img_url,alt:null!==(a=null===(i=e.product)||void 0===i?void 0:i.display_name)&&void 0!==a?a:"สินค้า",style:{...L.B9.productThumb,width:56,height:56,borderRadius:10}})}):(0,l.jsx)("div",{style:{...L.B9.productThumbPlaceholder,width:56,height:56,borderRadius:10},children:(0,l.jsx)(b.Z,{style:{fontSize:20}})})}),(0,l.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,l.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[(0,l.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,l.jsx)(j.Z,{checked:es.includes(e.id),onChange:t=>{eg(t.target.checked?[...es,e.id]:es.filter(t=>t!==e.id))},children:(0,l.jsx)(em,{strong:!0,style:{fontSize:17,lineHeight:1.5},children:null===(r=e.product)||void 0===r?void 0:r.display_name})}),(0,l.jsx)("div",{style:{paddingLeft:24,marginTop:2},children:(null===(s=e.product)||void 0===s?void 0:null===(n=s.category)||void 0===n?void 0:n.display_name)&&(0,l.jsx)(h.Z,{color:"cyan",style:{...L.B9.categoryTag,fontSize:9},children:e.product.category.display_name})})]}),(0,l.jsxs)(em,{strong:!0,style:{fontSize:19,color:L._A.primary,marginLeft:8,lineHeight:1.4},children:["x",e.quantity]})]}),(0,l.jsxs)("div",{style:{paddingLeft:24,marginTop:2},children:[e.details&&e.details.length>0&&(0,l.jsx)("div",{style:{fontSize:13,color:L._A.served,marginBottom:4,lineHeight:1.4},children:e.details.map(e=>"".concat(e.detail_name," (+ ฿").concat(Number(e.extra_price).toLocaleString(),")")).join(", ")}),(0,l.jsx)(y.Z,{orientation:"vertical",size:2,children:(0,l.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,l.jsxs)(em,{style:{...L.B9.priceTag,fontSize:15},children:["฿",Number(e.price).toLocaleString()]}),(0,l.jsxs)(em,{strong:!0,style:{color:L._A.priceTotal,fontSize:16},children:["รวม ฿",Number(e.total_price).toLocaleString()]})]})}),e.notes&&(0,l.jsx)("div",{style:{marginTop:4},children:(0,l.jsxs)(em,{style:{fontSize:13,color:L._A.cancelled,lineHeight:1.4},children:[(0,l.jsx)(_.Z,{style:{fontSize:13}})," ",e.notes]})})]})]})]}),(0,l.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",borderTop:"1px solid ".concat(L._A.border),paddingTop:10,gap:6,marginTop:10},children:[(0,l.jsx)(x.ZP,{size:"small",type:"text",danger:!0,icon:(0,l.jsx)(Z.Z,{}),onClick:()=>eP(e.id),style:{height:34,borderRadius:8,fontSize:13,padding:"0 12px",fontWeight:500},className:"scale-hover",children:"ลบ"}),(0,l.jsx)(x.ZP,{size:"small",type:"text",icon:(0,l.jsx)(k.Z,{}),onClick:()=>eI(e),style:{height:34,borderRadius:8,fontSize:13,padding:"0 12px",fontWeight:500},className:"scale-hover",children:"แก้ไข"}),(0,l.jsxs)(x.ZP,{size:"small",type:"primary",onClick:()=>eA(e.id),style:{background:L._A.served,borderColor:L._A.served,height:34,padding:"0 14px",borderRadius:8,fontSize:13,fontWeight:600},className:"scale-hover",children:[(0,l.jsx)(S.Z,{style:{fontSize:13,marginRight:4}}),(0,W.qO)(E.order_type)]})]})]},e.id)})})]}):(0,l.jsxs)("div",{style:L.B9.emptyState,children:[(0,l.jsx)(T.Z,{className:"empty-state-icon"}),(0,l.jsx)(em,{className:"empty-state-text",children:"ไม่มีรายการที่กำลังรอ"})]})}),(0,l.jsx)(g.Z,{className:"order-detail-card fade-in",style:L.B9.card,title:(0,l.jsxs)(em,{strong:!0,style:{...L.Qo.sectionTitle,color:L._A.textSecondary},children:[(0,W.zP)(E.order_type)," (",eW.length,")"]}),children:eW.length>0?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"order-detail-table-desktop",children:(0,l.jsx)(v.Z,{dataSource:eW,columns:eq,rowKey:"id",virtual:e$,scroll:e$?{y:360}:void 0,pagination:!1,size:"small",className:"order-items-table",rowClassName:e=>e.status===D.i.Cancelled?"row-cancelled":""})}),(0,l.jsx)("div",{className:"order-detail-cards-mobile",children:eW.map(e=>{var t,i,r,n,s,a;return(0,l.jsxs)("div",{style:{...L.B9.itemCard,...L.B9.itemCardServed,backgroundColor:e.status===D.i.Cancelled?L._A.cancelledLight:L._A.white,borderColor:e.status===D.i.Cancelled?L._A.cancelled+"30":L._A.border,position:"relative"},children:[(0,l.jsx)("div",{style:{position:"absolute",top:10,right:10},children:(0,l.jsx)(h.Z,{color:(0,W.OY)(e.status),style:{margin:0,fontSize:10,padding:"2px 8px",borderRadius:6,lineHeight:1.2},children:(0,W.d7)(e.status,E.order_type)})}),(0,l.jsxs)("div",{style:{display:"flex",gap:10},children:[(0,l.jsx)("div",{style:{flexShrink:0},children:(null===(t=e.product)||void 0===t?void 0:t.img_url)?(0,l.jsx)(l.Fragment,{children:(0,l.jsx)("img",{src:e.product.img_url,alt:null!==(a=null===(i=e.product)||void 0===i?void 0:i.display_name)&&void 0!==a?a:"สินค้า",style:{...L.B9.productThumb,width:52,height:52,borderRadius:10,opacity:.7}})}):(0,l.jsx)("div",{style:{...L.B9.productThumbPlaceholder,width:52,height:52,borderRadius:10},children:(0,l.jsx)(b.Z,{style:{fontSize:18}})})}),(0,l.jsx)("div",{style:{flex:1,minWidth:0,paddingRight:50},children:(0,l.jsx)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:(0,l.jsxs)("div",{style:{flex:1},children:[(0,l.jsx)(em,{strong:!0,style:{fontSize:16,textDecoration:e.status===D.i.Cancelled?"line-through":"none",color:e.status===D.i.Cancelled?L._A.textLight:L._A.text,lineHeight:1.5},children:null===(r=e.product)||void 0===r?void 0:r.display_name}),(0,l.jsx)("div",{style:{marginTop:2},children:(null===(s=e.product)||void 0===s?void 0:null===(n=s.category)||void 0===n?void 0:n.display_name)&&(0,l.jsx)(h.Z,{color:"cyan",style:{...L.B9.categoryTag,fontSize:9},children:e.product.category.display_name})}),e.details&&e.details.length>0&&(0,l.jsx)("div",{style:{fontSize:13,color:L._A.served,opacity:.7,marginBottom:4,lineHeight:1.4},children:e.details.map(e=>"".concat(e.detail_name," (+ ฿").concat(Number(e.extra_price).toLocaleString(),")")).join(", ")}),(0,l.jsx)(y.Z,{orientation:"vertical",size:2,style:{marginTop:4,width:"100%"},children:(0,l.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)(em,{style:{...L.B9.priceTag,fontSize:14,opacity:.7},children:["฿",Number(e.price).toLocaleString()]}),(0,l.jsxs)(em,{strong:!0,style:{marginLeft:8,color:L._A.textSecondary,opacity:.7,fontSize:15},children:["รวม ฿",Number(e.total_price).toLocaleString()]})]}),(0,l.jsxs)(em,{strong:!0,style:{color:L._A.textSecondary,fontSize:15},children:["x",e.quantity]})]})}),e.notes&&(0,l.jsx)("div",{style:{marginTop:4},children:(0,l.jsxs)(em,{style:{fontSize:13,opacity:.7,color:L._A.cancelled,lineHeight:1.4},children:[(0,l.jsx)(_.Z,{style:{fontSize:13}})," ",e.notes]})})]})})})]}),e.status===D.i.Served&&(0,l.jsx)("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:10,paddingTop:10,borderTop:"1px solid ".concat(L._A.border)},children:(0,l.jsx)(x.ZP,{size:"small",className:"unserve-button",style:{...L.B9.unserveButton,height:34,fontSize:13,padding:"0 14px",borderRadius:8,fontWeight:500},icon:(0,l.jsx)(C.Z,{style:{fontSize:13}}),onClick:()=>eN(e.id),children:(null==E?void 0:E.order_type)===D.m.DineIn?"ยกเลิกเสิร์ฟ":"ยกเลิกปรุงเสร็จ"})})]},e.id)})})]}):(0,l.jsx)("div",{style:{textAlign:"center",padding:"20px 0"},children:(0,l.jsx)(em,{type:"secondary",children:"ยังไม่มีรายการที่ดำเนินการแล้ว"})})})]}),(0,l.jsx)(m.Z,{xs:24,lg:8,children:(0,l.jsxs)(g.Z,{className:"order-detail-card summary-card",style:L.B9.summaryCard,children:[(0,l.jsx)(ep,{level:5,style:{marginBottom:16,fontSize:18,fontWeight:600},children:"สรุปการสั่งซื้อ"}),(0,l.jsxs)("div",{style:{...L.B9.summaryList,background:"white"},children:[(0,l.jsx)(em,{strong:!0,style:{fontSize:15,marginBottom:10,display:"block",color:L._A.textSecondary},children:"รายการสินค้า"}),eO.map((e,t)=>{var i,r,n;return(0,l.jsxs)("div",{style:L.B9.summaryItemRow,children:[(null===(i=e.product)||void 0===i?void 0:i.img_url)?(0,l.jsx)(l.Fragment,{children:(0,l.jsx)("img",{src:e.product.img_url,alt:(null===(r=e.product)||void 0===r?void 0:r.display_name)||"สินค้า",style:L.B9.summaryItemImage})}):(0,l.jsx)("div",{style:{...L.B9.summaryItemImage,display:"flex",alignItems:"center",justifyContent:"center",background:"#f8fafc"},children:(0,l.jsx)(b.Z,{style:{fontSize:16,color:"#bfbfbf"}})}),(0,l.jsxs)("div",{style:L.B9.summaryItemContent,children:[(0,l.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[(0,l.jsx)(em,{strong:!0,style:{fontSize:15,flex:1,lineHeight:1.4},children:null===(n=e.product)||void 0===n?void 0:n.display_name}),(0,l.jsxs)(em,{strong:!0,style:{fontSize:15,color:L._A.primary,lineHeight:1.4},children:["฿",Number(e.total_price).toLocaleString()]})]}),(0,l.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:4},children:[(0,l.jsxs)(em,{type:"secondary",style:{fontSize:13,lineHeight:1.4},children:["จำนวน : ",e.quantity]}),(0,l.jsxs)(em,{type:"secondary",style:{fontSize:13,lineHeight:1.4},children:["ราคา : ",Number(e.price).toLocaleString()]})]}),e.details&&e.details.length>0&&(0,l.jsxs)("div",{style:L.B9.summaryDetailText,children:[(0,l.jsx)(P.Z,{style:{fontSize:10}})," ",e.details.map(e=>"".concat(e.detail_name," (+").concat(Number(e.extra_price).toLocaleString(),")")).join(", ")]}),e.notes&&(0,l.jsxs)("div",{style:{...L.B9.summaryDetailText,color:L._A.cancelled,fontStyle:"italic"},children:["โน้ต: ",e.notes]})]})]},e.id||t)})]}),(0,l.jsxs)("div",{style:L.B9.summaryList,children:[(0,l.jsx)(em,{strong:!0,style:{fontSize:15,marginBottom:10,display:"block",color:L._A.textSecondary},children:"แยกตามหมวดหมู่"}),Object.entries((0,W.Rr)((null==E?void 0:E.items)||[])).map(e=>{let[t,i]=e;return(0,l.jsxs)("div",{style:L.B9.summaryRow,children:[(0,l.jsx)(em,{type:"secondary",style:{fontSize:14,lineHeight:1.4},children:t}),(0,l.jsxs)(em,{strong:!0,style:{fontSize:14,lineHeight:1.4},children:[String(i)," รายการ"]})]},t)}),(0,l.jsx)(f.Z,{style:{margin:"10px 0"}}),(0,l.jsxs)("div",{style:L.B9.summaryRow,children:[(0,l.jsx)(em,{type:"secondary",style:{fontSize:14,lineHeight:1.4},children:"จำนวนรายการทั้งหมด"}),(0,l.jsxs)(em,{strong:!0,style:{fontSize:14,lineHeight:1.4},children:[eO.length," รายการ"]})]})]}),(0,l.jsx)("div",{style:{padding:"0 4px"},children:(0,l.jsxs)("div",{style:L.B9.summaryMainRow,children:[(0,l.jsx)(em,{strong:!0,style:{fontSize:20,lineHeight:1.3},children:"ยอดรวมทั้งสิ้น"}),(0,l.jsxs)(em,{strong:!0,style:{fontSize:28,color:L._A.primary,lineHeight:1.2},children:["฿",eF.toLocaleString()]})]})}),eE&&(0,l.jsx)(x.ZP,{type:"primary",block:!0,size:"large",onClick:eH,style:{marginTop:16,height:48,borderRadius:10,fontWeight:600,fontSize:16,background:"linear-gradient(135deg, ".concat(L._A.served," 0%, #059669 100%)"),border:"none",boxShadow:"0 4px 12px ".concat(L._A.served,"25")},className:"scale-hover",children:(0,W.iN)(E.order_type)}),(0,l.jsx)(x.ZP,{danger:!0,block:!0,size:"large",onClick:()=>{E&&eZ({open:!0,type:"danger",title:"ยืนยันการยกเลิกออเดอร์?",content:"การดำเนินการนี้จะยกเลิกสินค้าทุกรายการและคืนสถานะโต๊ะ (หากมี) คุณแน่ใจหรือไม่?",okText:"ยืนยันการยกเลิก",cancelText:"ยกเลิก",onOk:async()=>{try{var e;K(!0),Q("กำลังดำเนินการยกเลิก..."),eC();let t=await (0,R.P)(),i=(null===(e=E.items)||void 0===e?void 0:e.filter(e=>e.status!==D.i.Cancelled))||[];await Promise.all(i.map(e=>I.x.updateItemStatus(e.id,D.i.Cancelled,void 0,t))),await I.x.updateStatus(E.id,D.i.Cancelled,t),E.table_id&&await H.$.update(E.table_id,{status:q.c.Available},void 0,t),o.ZP.success("ยกเลิกออเดอร์เรียบร้อย"),r.push((0,W.d$)(E.order_type))}catch(e){o.ZP.error("ไม่สามารถยกเลิกออเดอร์ได้")}finally{K(!1),X()}}})},style:{marginTop:12,height:44,borderRadius:10,fontWeight:500,fontSize:15,border:"1px solid ".concat(L._A.danger)},disabled:Y,className:"scale-hover",children:"ยกเลิกออเดอร์"})]})})]})}),(0,l.jsx)(ei,{isOpen:e_,onClose:()=>eS(!1),onAddItem:eR}),ej&&ef&&(0,l.jsx)(ea,{item:ef,isOpen:ej,onClose:()=>{ev(!1),eb(null)},onSave:eT},"edit-modal-".concat(ef.id)),(0,l.jsx)(ed.Z,{open:ek.open,type:ek.type,title:ek.title,content:ek.content,okText:ek.okText,cancelText:ek.cancelText,onOk:ek.onOk,onCancel:eC,loading:Y})]})}F().locale("th")}},function(e){e.O(0,[8024,4736,8592,1744],function(){return e(e.s=8118)}),_N_E=e.O()}]);