(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1304],{8118:function(e,t,i){Promise.resolve().then(i.bind(i,536))},536:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return ef}});var l=i(57437),r=i(29),n=i.n(r),s=i(2265),a=i(99376),o=i(7806),d=i(19683),c=i(34029),y=i(85180),u=i(24783),h=i(80009),x=i(89970),p=i(50742),m=i(47451),g=i(69410),v=i(96931),j=i(4156),f=i(73179),b=i(23496),_=i(62376),S=i(15424),k=i(9738),Z=i(13377),C=i(26349),z=i(49638),w=i(52539),A=i(67605),N=i(1915),B=i(89245),P=i(96473),T=i(83669),I=i(53286),R=i(97235),D=i(66290),H=i(32446),q=i(34962),L=i(1165),W=i(61414),O=i(71096),F=i.n(O);i(6729);var M=i(33145),E=i(64625),$=i(53743),G=i(88589),Y=i(90136),K=i(17588),Q=i(29436),X=i(40312),J=i(22623),U=i(2838),V=i(47799),ee=i(3369);let{Text:et,Title:ei}=d.default,el=e=>{var t;let{isOpen:i,onClose:r,onAddItem:a,orderType:o}=e,{message:d}=E.Z.useApp(),[c,u]=(0,s.useState)([]),[h,x]=(0,s.useState)([]),[m,g]=(0,s.useState)([]),[v,j]=(0,s.useState)(null),[f,_]=(0,s.useState)(""),{showLoading:S,hideLoading:k}=(0,ee.x)(),[Z,w]=(0,s.useState)(null),[A,N]=(0,s.useState)(1),[B,T]=(0,s.useState)(""),[I,R]=(0,s.useState)([]),D=(0,s.useCallback)(async()=>{try{S("กำลังโหลดข้อมูลสินค้า...");let[e,t]=await Promise.all([V.R.findAll(1,100),U.G.findAll()]);u(e.data),x(e.data),g(Array.isArray(t)?t:[])}catch(e){d.error("ไม่สามารถโหลดข้อมูลได้")}finally{k()}},[S,k,d]),q=(0,s.useCallback)(()=>{N(1),T(""),R([]),w(null),_("")},[]);(0,s.useEffect)(()=>{i&&(D(),q())},[D,i,q]);let O=e=>{j(e),F(f,e)},F=(e,t)=>{let i=c;t&&(i=i.filter(e=>e.category_id===t)),e&&(i=i.filter(t=>t.display_name.toLowerCase().includes(e.toLowerCase()))),x(i)},el=e=>{w(e),N(1),T(""),R([])},er=(e,t,i)=>{R(l=>l.map(l=>{if(l.id!==e)return l;if("price"===t){let e="number"==typeof i?i:Number(i)||0;return{...l,price:e}}return{...l,name:String(i)}}))},en=e=>{R(t=>t.filter(t=>t.id!==e))},es=async()=>{if(Z)try{S("กำลังเพิ่มรายการ...");let e=I.filter(e=>""!==e.name.trim()).map(e=>({detail_name:e.name,extra_price:e.price}));await a(Z,A,B,e),d.success("เพิ่มรายการเรียบร้อย"),r(),w(null)}catch(e){}finally{k()}};return(0,l.jsxs)($.Z,{className:"mobile-fullscreen-modal",title:null,open:i,onCancel:r,footer:null,width:850,destroyOnHidden:!0,centered:!0,styles:{body:{padding:0,display:"flex",flexDirection:"column",height:"90vh",maxHeight:"90vh",overflow:"hidden",borderRadius:16}},children:[(0,l.jsx)(n(),{id:L.$k.__hash,children:L.$k}),(0,l.jsxs)("div",{style:{...L.il.modalHeader,flexShrink:0},className:"modal-header",children:[Z?(0,l.jsx)(p.ZP,{type:"text",icon:(0,l.jsx)(K.Z,{}),onClick:()=>w(null),"aria-label":"กลับ",style:{height:44,width:44,borderRadius:12,background:L._A.backgroundSecondary,display:"flex",alignItems:"center",justifyContent:"center",border:"1px solid ".concat(L._A.border)},className:"scale-hover"}):(0,l.jsx)(p.ZP,{type:"text",icon:(0,l.jsx)(z.Z,{}),onClick:r,"aria-label":"ปิด",style:{height:44,width:44,borderRadius:12,background:L._A.backgroundSecondary,display:"flex",alignItems:"center",justifyContent:"center",border:"1px solid ".concat(L._A.border)},className:"scale-hover"}),(0,l.jsx)(et,{strong:!0,style:{fontSize:18,flex:1,color:L._A.text,lineHeight:1.4},children:Z?"ระบุรายละเอียด":"เลือกสินค้า"})]}),Z?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{style:{flex:1,overflowY:"auto",padding:"20px",display:"flex",flexDirection:"column"},children:(0,l.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:20},children:[(0,l.jsxs)("div",{style:{display:"flex",gap:16,alignItems:"flex-start"},className:"product-info-section",children:[Z.img_url?(0,l.jsx)(l.Fragment,{children:(0,l.jsx)(M.default,{src:Z.img_url,alt:Z.display_name,width:100,height:100,style:{objectFit:"cover",borderRadius:12,flexShrink:0}})}):(0,l.jsx)("div",{style:{width:100,height:100,background:L._A.backgroundSecondary,borderRadius:12,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:(0,l.jsx)(X.Z,{style:{fontSize:32,opacity:.2}})}),(0,l.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,l.jsx)(ei,{level:4,style:{margin:"0 0 6px 0",fontSize:20,lineHeight:1.3},children:Z.display_name}),(0,l.jsxs)(et,{style:{fontSize:20,fontWeight:700,color:L._A.primary,lineHeight:1.2},children:["฿",Number(o===H.m.Delivery&&null!==(t=Z.price_delivery)&&void 0!==t?t:Z.price).toLocaleString()]})]})]}),(0,l.jsx)(b.Z,{style:{margin:"0"}}),(0,l.jsxs)("div",{children:[(0,l.jsx)(et,{strong:!0,style:{display:"block",marginBottom:14,fontSize:16,color:L._A.text},children:"จำนวน"}),(0,l.jsxs)("div",{style:L.il.quantityControl,className:"quantity-control",children:[(0,l.jsx)(p.ZP,{type:"primary",icon:(0,l.jsx)(J.Z,{}),onClick:()=>N(e=>Math.max(1,e-1)),disabled:A<=1,style:{...L.il.quantityButton,background:L._A.white,color:L._A.primary,border:"2px solid ".concat(L._A.primary)},className:"scale-hover quantity-button"}),(0,l.jsx)("div",{style:L.il.quantityDisplay,className:"quantity-display",children:A}),(0,l.jsx)(p.ZP,{type:"primary",icon:(0,l.jsx)(P.Z,{}),onClick:()=>N(e=>e+1),style:{...L.il.quantityButton,background:"linear-gradient(135deg, ".concat(L._A.primary," 0%, ").concat(L._A.primaryDark," 100%)"),border:"none"},className:"scale-hover quantity-button"})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[(0,l.jsx)(et,{strong:!0,style:{fontSize:16},children:"ตัวเลือกเพิ่มเติม (Optional)"}),(0,l.jsx)(p.ZP,{size:"small",type:"dashed",onClick:()=>{R(e=>[...e,{id:Date.now(),name:"",price:0}])},icon:(0,l.jsx)(P.Z,{}),children:"เพิ่ม"})]}),I.map(e=>(0,l.jsxs)("div",{style:L.m4.detailItemRow,className:"detail-item-row",children:[(0,l.jsx)(G.default,{placeholder:"ไข่ดาว, พิเศษ...",value:e.name,onChange:t=>er(e.id,"name",t.target.value),style:{flex:1,borderRadius:10,height:44,fontSize:15}}),(0,l.jsx)(Y.Z,{placeholder:"0.00",value:e.price,onChange:t=>er(e.id,"price",t||0),style:{width:110,borderRadius:10,height:44,fontSize:15},inputMode:"decimal",controls:!1,min:0,precision:2,formatter:e=>"".concat(e).replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:e=>e.replace(/\$\s?|(,*)/g,""),onKeyDown:t=>{/^[0-9]$/.test(t.key)||["Backspace","Delete","ArrowLeft","ArrowRight","Tab","Enter","."].includes(t.key)||t.preventDefault(),"."===t.key&&e.price.toString().includes(".")&&t.preventDefault()}}),(0,l.jsx)(p.ZP,{type:"text",danger:!0,icon:(0,l.jsx)(C.Z,{}),onClick:()=>en(e.id),style:{width:44,height:44,borderRadius:10},className:"scale-hover"})]},e.id))]}),(0,l.jsxs)("div",{children:[(0,l.jsx)(et,{strong:!0,style:{display:"block",marginBottom:10,fontSize:16,color:L._A.text},children:"หมายเหตุ"}),(0,l.jsx)(G.default.TextArea,{rows:3,value:B,onChange:e=>T(e.target.value),placeholder:"เช่น ไม่ใส่ผัก, เผ็ดน้อย...",style:{borderRadius:12,fontSize:15,padding:"12px 14px",lineHeight:1.5}})]}),(0,l.jsx)("div",{style:{height:10}})]})}),(0,l.jsxs)("div",{style:{marginTop:0},children:[(0,l.jsxs)("div",{style:{...L.il.priceCard,margin:"0 20px",borderRadius:"12px 12px 0 0",borderBottom:"none"},children:[(0,l.jsx)(et,{strong:!0,style:{fontSize:16,color:L._A.text},children:"ยอดรวมรายการนี้"}),(0,l.jsx)(ei,{level:4,style:{margin:0,color:L._A.priceTotal,fontSize:24},children:(0,W.xG)((()=>{var e;if(!Z)return 0;let t=o===H.m.Delivery&&null!==(e=Z.price_delivery)&&void 0!==e?e:Z.price,i=I.map(e=>({detail_name:e.name,extra_price:e.price}));return(0,W.ku)(t,A,i)})())})]}),(0,l.jsxs)("div",{style:{...L.il.actionButtons,flexShrink:0},className:"action-buttons",children:[(0,l.jsx)(p.ZP,{onClick:()=>w(null),style:L.il.secondaryButton,className:"scale-hover secondary-button",children:"ย้อนกลับ"}),(0,l.jsx)(p.ZP,{type:"primary",onClick:es,icon:(0,l.jsx)(P.Z,{}),style:L.il.primaryButton,className:"scale-hover primary-button",children:"เพิ่มลงออเดอร์"})]})]})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{style:{...L.m4.searchBar,paddingBottom:8,flexShrink:0},children:[(0,l.jsx)(G.default,{placeholder:"ค้นหาสินค้าหรือรหัส...",prefix:(0,l.jsx)(Q.Z,{style:{color:L._A.textSecondary}}),value:f,onChange:e=>{let t=e.target.value;_(t),F(t,v)},allowClear:!0,style:{...L.m4.searchInput,marginBottom:12}}),(0,l.jsxs)("div",{style:{display:"flex",overflowX:"auto",gap:8,paddingBottom:4,scrollBehavior:"smooth",scrollbarWidth:"none",msOverflowStyle:"none"},className:"hide-scrollbar",children:[(0,l.jsx)(p.ZP,{size:"middle",type:null===v?"primary":"default",onClick:()=>O(null),style:{borderRadius:20,minWidth:70,border:null===v?"none":"1px solid ".concat(L._A.border)},children:"ทั้งหมด"}),m.map(e=>(0,l.jsx)(p.ZP,{size:"middle",type:v===e.id?"primary":"default",onClick:()=>O(e.id),style:{borderRadius:20,border:v===e.id?"none":"1px solid ".concat(L._A.border)},children:e.display_name||e.category_name},e.id))]})]}),(0,l.jsxs)("div",{style:{flex:1,overflowY:"auto",paddingBottom:20},className:"order-detail-content",children:[(0,l.jsx)("div",{style:L.m4.productGrid,className:"product-grid",children:h.map(e=>(0,l.jsxs)("div",{style:L.m4.productCard,onClick:()=>el(e),className:"product-card-hoverable scale-in",children:[(0,l.jsx)("div",{style:{position:"relative",width:"100%",height:130,background:L._A.backgroundSecondary},children:e.img_url?(0,l.jsx)(l.Fragment,{children:(0,l.jsx)(M.default,{alt:e.display_name,src:e.img_url,fill:!0,style:{objectFit:"cover",borderRadius:"12px 12px 0 0"},sizes:"(max-width: 768px) 50vw, (max-width: 1200px) 33vw, 25vw"})}):(0,l.jsx)("div",{style:L.m4.productPlaceholder,children:(0,l.jsx)(X.Z,{style:{fontSize:28,opacity:.3}})})}),(0,l.jsxs)("div",{style:L.m4.productInfo,className:"product-info",children:[(0,l.jsx)("div",{style:{...L.m4.productName},className:"product-name",children:e.display_name}),(0,l.jsx)(et,{style:{...L.m4.productPrice},className:"product-price",children:(0,W.xG)(e.price)})]})]},e.id))}),0===h.length&&(0,l.jsx)(y.Z,{description:"ไม่พบสินค้าที่คุณต้องการ",style:{marginTop:60,padding:"40px 20px"}})]})]})]})};var er=i(78355);let{Text:en,Title:es}=d.default,{TextArea:ea}=G.default,eo=["Backspace","Delete","ArrowLeft","ArrowRight","Tab","Enter","."],ed=e=>{var t,i,r,n,a,o;let{item:d,isOpen:y,onClose:x,onSave:m}=e,[g,v]=(0,s.useState)(1),[j,f]=(0,s.useState)(""),[_,k]=(0,s.useState)([]),Z=(0,s.useRef)(null),{showLoading:w,hideLoading:A}=(0,ee.O)();(0,s.useEffect)(()=>{if(d&&y){let e=d.id;e!==Z.current&&(v(d.quantity),f(d.notes||""),k(d.details?[...d.details.map(e=>({detail_name:e.detail_name,extra_price:e.extra_price}))]:[]),Z.current=e)}},[d,y]),(0,s.useEffect)(()=>{y||(Z.current=null,v(1),f(""),k([]))},[y]);let N=(0,s.useCallback)(async()=>{if(d)try{w("เธ\x81เธณเธฅเธฑเธ\x87เธ\x9aเธฑเธ\x99เธ—เธถเธ\x81เน\x81เธ\x81เน\x89เน\x84เธ\x82...");let e=_.filter(e=>e.detail_name&&""!==e.detail_name.trim());await m(d.id,g,j,e)}catch(e){c.ZP.error("เธ\x9aเธฑเธ\x99เธ—เธถเธ\x81เธฃเธฒเธขเธ\x81เธฒเธฃเน\x84เธกเน\x88เธชเธณเน€เธฃเน\x87เธ\x88")}finally{A()}},[d,g,j,_,m,w,A]),B=(0,s.useCallback)(()=>{v(e=>e+1)},[]),T=(0,s.useCallback)(()=>{v(e=>Math.max(1,e-1))},[]),I=(0,s.useCallback)(()=>{k(e=>[...e,{detail_name:"",extra_price:0}])},[]),R=(0,s.useCallback)(e=>{k(t=>t.filter((t,i)=>i!==e))},[]),D=(0,s.useCallback)((e,t,i)=>{k(l=>{let r=[...l];return r[e]={...r[e],[t]:i},r})},[]);return d?(0,l.jsxs)($.Z,{className:"mobile-fullscreen-modal",title:null,open:y,onCancel:x,footer:null,width:500,destroyOnHidden:!0,centered:!0,closable:!1,styles:{body:{padding:0,display:"flex",flexDirection:"column",height:"80vh",maxHeight:"80vh",overflow:"hidden",borderRadius:16}},children:[(0,l.jsxs)("div",{style:{...L.il.modalHeader,flexShrink:0},className:"modal-header",children:[(0,l.jsx)(en,{strong:!0,style:{fontSize:18,flex:1,color:L._A.text,lineHeight:1.4},children:"เน\x81เธ\x81เน\x89เน\x84เธ\x82เธฃเธฒเธขเธ\x81เธฒเธฃ"}),(0,l.jsx)(p.ZP,{type:"text",icon:(0,l.jsx)(z.Z,{}),onClick:x,"aria-label":"เธ\x9bเธดเธ”",style:{height:44,width:44,display:"flex",alignItems:"center",justifyContent:"center",borderRadius:12,color:L._A.textSecondary,background:L._A.backgroundSecondary,border:"1px solid ".concat(L._A.border)},className:"scale-hover"})]}),(0,l.jsxs)("div",{style:{flex:1,overflowY:"auto",padding:"20px"},children:[(0,l.jsxs)("div",{style:{display:"flex",gap:16,marginBottom:24,alignItems:"center",background:L._A.backgroundSecondary,padding:16,borderRadius:16},children:[(0,l.jsx)("div",{style:{flexShrink:0},children:(null===(t=d.product)||void 0===t?void 0:t.img_url)?(0,l.jsx)(M.default,{src:d.product.img_url,alt:null!==(o=null===(i=d.product)||void 0===i?void 0:i.display_name)&&void 0!==o?o:"เธชเธดเธ\x99เธ\x84เน\x89เธฒ",width:80,height:80,style:{borderRadius:14,objectFit:"cover",border:"1px solid ".concat(L._A.borderLight)}}):(0,l.jsx)("div",{style:{width:80,height:80,borderRadius:14,background:"linear-gradient(135deg, ".concat(L._A.primaryLight," 0%, #DBEAFE 100%)"),display:"flex",alignItems:"center",justifyContent:"center"},children:(0,l.jsx)(S.Z,{style:{fontSize:28,color:L._A.primary,opacity:.5}})})}),(0,l.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,l.jsx)(es,{level:5,style:{margin:0,fontSize:18,color:L._A.text},children:(null===(r=d.product)||void 0===r?void 0:r.display_name)||"เน\x84เธกเน\x88เธฃเธฐเธ\x9aเธธ"}),(0,l.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginTop:6},children:[(null===(a=d.product)||void 0===a?void 0:null===(n=a.category)||void 0===n?void 0:n.display_name)&&(0,l.jsx)(h.Z,{color:"cyan",style:{fontSize:11,margin:0,borderRadius:6,fontWeight:500},children:d.product.category.display_name}),(0,l.jsx)(en,{style:{fontSize:16,fontWeight:600,color:L._A.primary},children:(0,W.xG)(d.price)})]})]})]}),(0,l.jsxs)("div",{style:{marginBottom:24},children:[(0,l.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14},children:[(0,l.jsx)(en,{strong:!0,style:{fontSize:16,color:L._A.text},children:"เธฃเธฒเธขเธ\x81เธฒเธฃเน€เธ\x9eเธดเน\x88เธกเน€เธ•เธดเธก (Topping)"}),(0,l.jsx)(p.ZP,{type:"text",icon:(0,l.jsx)(P.Z,{style:{fontSize:12}}),onClick:I,style:{borderRadius:12,background:L._A.primaryLight,color:L._A.primary,fontWeight:600,fontSize:13,height:36,padding:"0 16px",border:"1px solid ".concat(L._A.primary,"30"),display:"flex",alignItems:"center",justifyContent:"center"},className:"scale-hover",children:"เน€เธ\x9eเธดเน\x88เธกเธฃเธฒเธขเธ\x81เธฒเธฃ"})]}),0===_.length?(0,l.jsx)("div",{style:{textAlign:"center",padding:"16px",background:L._A.backgroundSecondary,borderRadius:12,border:"1px dashed ".concat(L._A.border)},children:(0,l.jsx)(en,{type:"secondary",style:{fontSize:13},children:"เน\x84เธกเน\x88เธกเธตเธฃเธฒเธขเธ\x81เธฒเธฃเน€เธ\x9eเธดเน\x88เธกเน€เธ•เธดเธก"})}):(0,l.jsx)(u.Z,{direction:"vertical",style:{width:"100%"},size:12,children:_.map((e,t)=>(0,l.jsxs)("div",{style:{display:"flex",gap:10,alignItems:"center",padding:"12px 14px",background:L._A.backgroundSecondary,borderRadius:12,border:"1px solid ".concat(L._A.border)},children:[(0,l.jsx)(G.default,{placeholder:"เธฃเธฒเธขเธ\x81เธฒเธฃ",value:e.detail_name,onChange:e=>D(t,"detail_name",e.target.value),style:{flex:2,borderRadius:10,height:44,fontSize:15}}),(0,l.jsx)(Y.Z,{placeholder:"เธฃเธฒเธ\x84เธฒ",value:e.extra_price,onChange:e=>D(t,"extra_price",e||0),style:{flex:1,borderRadius:10,height:44,fontSize:15},inputMode:"decimal",controls:!1,min:0,precision:2,formatter:e=>"".concat(e).replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:e=>e.replace(/\$\s?|(,*)/g,""),onKeyDown:t=>{/^[0-9]$/.test(t.key)||eo.includes(t.key)||t.preventDefault(),"."===t.key&&e.extra_price.toString().includes(".")&&t.preventDefault()}}),(0,l.jsx)(p.ZP,{danger:!0,type:"text",icon:(0,l.jsx)(C.Z,{}),onClick:()=>R(t),style:{color:L._A.danger,borderRadius:10,width:44,height:44},className:"scale-hover"})]},t))})]}),(0,l.jsx)(b.Z,{style:{margin:"0 0 20px 0"}}),(0,l.jsxs)("div",{style:{marginBottom:24},children:[(0,l.jsx)(en,{strong:!0,style:{display:"block",marginBottom:14,fontSize:16,color:L._A.text},children:"เธ\x9bเธฃเธฑเธ\x9aเธ\x88เธณเธ\x99เธงเธ\x99"}),(0,l.jsxs)("div",{style:L.il.quantityControl,className:"quantity-control",children:[(0,l.jsx)(p.ZP,{type:"primary",icon:(0,l.jsx)(J.Z,{}),onClick:T,disabled:g<=1,style:{...L.il.quantityButton,background:L._A.white,color:L._A.primary,border:"2px solid ".concat(L._A.primary)},className:"scale-hover quantity-button"}),(0,l.jsx)("div",{style:L.il.quantityDisplay,className:"quantity-display",children:g}),(0,l.jsx)(p.ZP,{type:"primary",icon:(0,l.jsx)(P.Z,{}),onClick:B,style:{...L.il.quantityButton,background:"linear-gradient(135deg, ".concat(L._A.primary," 0%, ").concat(L._A.primaryDark," 100%)"),border:"none"},className:"scale-hover quantity-button"})]})]}),(0,l.jsxs)("div",{style:{marginBottom:24},children:[(0,l.jsx)(en,{strong:!0,style:{display:"block",marginBottom:10,fontSize:16,color:L._A.text},children:"เธซเธกเธฒเธขเน€เธซเธ•เธธ / เธ\x84เธณเน\x81เธ\x99เธฐเธ\x99เธณเธ\x9eเธดเน€เธจเธฉ"}),(0,l.jsx)(ea,{value:j,onChange:e=>f(e.target.value),placeholder:"เน€เธ\x8aเน\x88เธ\x99 เธซเธงเธฒเธ\x99เธ\x99เน\x89เธญเธข, เน\x84เธกเน\x88เน\x83เธชเน\x88เธ\x99เน\x89เธณเธ•เธฒเธฅ...",rows:3,style:{borderRadius:12,padding:"12px 14px",fontSize:15,lineHeight:1.5}})]}),(0,l.jsxs)("div",{style:{...L.il.priceCard,marginBottom:0},children:[(0,l.jsx)(en,{strong:!0,style:{fontSize:16,color:L._A.text},children:"เธขเธญเธ”เธฃเธงเธกเธฃเธฒเธขเธ\x81เธฒเธฃเธ\x99เธตเน\x89"}),(0,l.jsxs)(es,{level:4,style:{margin:0,color:L._A.priceTotal,fontSize:22},children:["เธฟ",(0,W.ku)(Number(d.price),g,_).toLocaleString()]})]})]}),(0,l.jsxs)("div",{style:{...L.il.actionButtons,flexShrink:0},className:"action-buttons",children:[(0,l.jsx)(p.ZP,{onClick:x,style:L.il.secondaryButton,className:"scale-hover secondary-button",children:"เธขเธ\x81เน€เธฅเธดเธ\x81"}),(0,l.jsx)(p.ZP,{type:"primary",onClick:N,icon:(0,l.jsx)(er.Z,{}),style:L.il.primaryButton,className:"scale-hover primary-button",children:"เธ\x9aเธฑเธ\x99เธ—เธถเธ\x81เน\x81เธ\x81เน\x89เน\x84เธ\x82"})]})]},(null==d?void 0:d.id)||"edit-modal"):null};var ec=i(60300),ey=i(20920),eu=i(84859),eh=i(24675),ex=i(67697),ep=i(88444),em=i(5325),eg=i(20148);let{Title:ev,Text:ej}=d.default;function ef(){var e,t;let i=(0,a.useRouter)(),r=(0,a.useParams)(),d=Array.isArray(null==r?void 0:r.ordersId)?r.ordersId[0]:null==r?void 0:r.ordersId,[O,M]=(0,s.useState)(null),[E,$]=(0,s.useState)(!0),[G,Y]=(0,s.useState)(!1),{showLoading:K,hideLoading:Q}=(0,ee.x)(),{socket:X}=(0,eh.s)(),J=(0,ey.L)(),{queue:U,addToQueue:V,removeFromQueue:et,isLoading:ei}=(0,ep.G)(),er=O?U.find(e=>e.order_id===O.id):null,[en,es]=(0,s.useState)([]),[ea,eo]=(0,s.useState)(!1),[ef,eb]=(0,s.useState)(null),[e_,eS]=(0,s.useState)(!1),[ek,eZ]=(0,s.useState)({open:!1,type:"confirm",title:"",content:"",onOk:()=>{}}),eC=()=>eZ(e=>({...e,open:!1})),ez=(0,s.useCallback)(async e=>{try{$(!0),K("กำลังโหลดข้อมูลออเดอร์...");let t=await I.x.getById(e);if([H.i.Paid,H.i.Cancelled,H.i.WaitingForPayment].includes(t.status)){let e=(0,W.EO)(t);i.push(e);return}M(t)}catch(e){c.ZP.error("ไม่สามารถโหลดข้อมูลออเดอร์ได้")}finally{$(!1),Q()}},[i,K,Q]);(0,s.useEffect)(()=>{d&&ez(d)},[d,ez]),(0,ex.D)({socket:X,events:["orders:update","orders:delete","orders:create","payments:create","payments:update"],onRefresh:()=>{d&&ez(d)},intervalMs:15e3,enabled:!!d});let ew=(0,s.useMemo)(()=>{var e;return(null==O?void 0:null===(e=O.items)||void 0===e?void 0:e.filter(e=>e.status===H.i.Pending||e.status===H.i.Cooking))||[]},[null==O?void 0:O.items]),eA=(0,s.useMemo)(()=>{var e;return((null==O?void 0:null===(e=O.items)||void 0===e?void 0:e.filter(e=>e.status===H.i.Served||e.status===H.i.Cancelled||e.status===H.i.WaitingForPayment))||[]).sort((e,t)=>e.status===H.i.Cancelled&&t.status!==H.i.Cancelled?1:e.status!==H.i.Cancelled&&t.status===H.i.Cancelled?-1:0)},[null==O?void 0:O.items]),eN=(0,s.useMemo)(()=>(0,o.S)(ew),[ew]),eB=(0,s.useMemo)(()=>(0,o.S)(eA),[eA]),eP=(0,s.useMemo)(()=>(0,W.Nz)(null==O?void 0:O.items),[null==O?void 0:O.items]),eT=(0,s.useMemo)(()=>(0,o.S)(eP),[eP]),eI=(0,W.yj)(null==O?void 0:O.items),eR=0===ew.length&&((null==O?void 0:null===(e=O.items)||void 0===e?void 0:e.length)||0)>0,eD=eN.length>12,eH=eB.length>12,eq=async e=>{try{var t;Y(!0),K("กำลังดำเนินการเสิร์ฟ...");let i=await (0,R.P)(),l=eN.find(t=>t.id===e),r=(null==l?void 0:null===(t=l.originalItems)||void 0===t?void 0:t.map(e=>e.id))||[e];await Promise.all(r.map(e=>I.x.updateItemStatus(e,H.i.Served,void 0,i))),c.ZP.success("เสิร์ฟรายการเรียบร้อย"),ez(d)}catch(e){c.ZP.error("เกิดข้อผิดพลาดในการเสิร์ฟ")}finally{Y(!1),Q()}},eL=async()=>{if(0!==en.length)try{Y(!0),K("กำลังดำเนินการเสิร์ฟ ".concat(en.length," รายการ (รวมกลุ่ม)..."));let e=await (0,R.P)(),t=en.flatMap(e=>{var t;let i=eN.find(t=>t.id===e);return(null==i?void 0:null===(t=i.originalItems)||void 0===t?void 0:t.map(e=>e.id))||[e.toString()]});await Promise.all(t.map(t=>I.x.updateItemStatus(t,H.i.Served,void 0,e))),c.ZP.success("เสิร์ฟรายการที่เลือกเรียบร้อย"),es([]),ez(d)}catch(e){c.ZP.error("เกิดข้อผิดพลาดในการเสิร์ฟ")}finally{Y(!1),Q()}},eW=async()=>{if(0===en.length)return;let e=en.flatMap(e=>{var t;let i=eN.find(t=>t.id===e);return(null==i?void 0:null===(t=i.originalItems)||void 0===t?void 0:t.map(e=>e.id))||[e.toString()]});eZ({open:!0,type:"danger",title:"ยืนยันการยกเลิก",content:"คุณต้องการยกเลิก ".concat(e.length," รายการที่เลือกใช่หรือไม่?"),okText:"ยืนยันยกเลิก",cancelText:"ไม่ยกเลิก",onOk:async()=>{try{Y(!0),K("กำลังดำเนินการยกเลิก..."),eC();let t=await (0,R.P)();await Promise.all(e.map(e=>I.x.updateItemStatus(e,H.i.Cancelled,void 0,t))),c.ZP.success("ยกเลิกรายการที่เลือกเรียบร้อย"),es([]),ez(d)}catch(e){c.ZP.error("เกิดข้อผิดพลาดในการยกเลิก")}finally{Y(!1),Q()}}})},eO=async e=>{try{var t;Y(!0),K("กำลังย้อนกลับสถานะ...");let i=await (0,R.P)(),l=eB.find(t=>t.id===e),r=(null==l?void 0:null===(t=l.originalItems)||void 0===t?void 0:t.map(e=>e.id))||[e];await Promise.all(r.map(e=>I.x.updateItemStatus(e,H.i.Cooking,void 0,i))),c.ZP.success("ยกเลิกการเสิร์ฟ (กลับไปปรุง)"),ez(d)}finally{Y(!1),Q()}},eF=async e=>{eZ({open:!0,type:"danger",title:"ยืนยันการลบ",content:"คุณต้องการลบรายการสินค้านี้ใช่หรือไม่?",okText:"ลบ",cancelText:"ยกเลิก",onOk:async()=>{try{var t;Y(!0),K("กำลังลบรายการ..."),eC();let i=await (0,R.P)(),l=eN.find(t=>t.id===e),r=(null==l?void 0:null===(t=l.originalItems)||void 0===t?void 0:t.map(e=>e.id))||[e];await Promise.all(r.map(e=>I.x.deleteItem(e,void 0,i))),c.ZP.success("ลบรายการเรียบร้อย (".concat(r.length," รายการ)")),ez(d)}catch(e){c.ZP.error("ไม่สามารถลบรายการได้")}finally{Y(!1),Q()}}})},eM=async function(e,t,i){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];try{Y(!0),K("กำลังบันทึกข้อมูล...");let r=await (0,R.P)();if(!t||t<1)throw c.ZP.error("จำนวนต้องมากกว่า 0"),Error("Invalid quantity");let n={quantity:Number(t),notes:String(i||""),details:Array.isArray(l)?l.map(e=>({detail_name:String(e.detail_name||""),extra_price:Number(e.extra_price||0)})):[]};await I.x.updateItem(e,n,void 0,r),c.ZP.success("แก้ไขรายการเรียบร้อย"),eo(!1),eb(null),eo(!1),eb(null),await new Promise(e=>setTimeout(e,600)),await ez(d),setTimeout(async()=>{var i;let l=await I.x.getById(d),r=null==l?void 0:null===(i=l.items)||void 0===i?void 0:i.find(t=>t.id===e);r&&(r.quantity===t?M(l):setTimeout(async()=>{await ez(d)},1e3))},500)}catch(e){throw c.ZP.error("ไม่สามารถแก้ไขรายการได้"),e}finally{Y(!1),Q()}},eE=e=>{eb(e),eo(!0)},e$=async function(e,t,i){var l;let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],n=(null==O?void 0:O.order_type)===H.m.Delivery?Number(null!==(l=e.price_delivery)&&void 0!==l?l:e.price):Number(e.price),s=(n+r.reduce((e,t)=>e+t.extra_price,0))*t;if(!J){eu.x.addToQueue("ADD_ITEM",{orderId:d,itemData:{product_id:e.id,quantity:t,price:n,notes:i,discount_amount:0,total_price:s,details:r}}),c.ZP.warning("บันทึกข้อมูลแบบ Offline แล้ว"),ez(d);return}try{Y(!0),K("กำลังเพิ่มสินค้า...");let l=await (0,R.P)();await I.x.addItem(d,{product_id:e.id,quantity:t,price:n,notes:i,discount_amount:0,total_price:s,details:r,status:H.i.Cooking},void 0,l),c.ZP.success("เพิ่มสินค้าเรียบร้อย"),ez(d)}catch(e){throw c.ZP.error("เพิ่มสินค้าไม่สำเร็จ"),e}finally{Y(!1),Q()}},eG=async()=>{let e=(null==O?void 0:O.order_type)===H.m.Delivery;eZ({open:!0,type:"success",title:e?"ยืนยันจัดออเดอร์เสร็จสิ้น":"ยืนยันการ".concat((0,W.qO)(null==O?void 0:O.order_type),"ทั้งหมด"),content:e?"จัดเตรียมอาหารเรียบร้อยแล้ว ต้องการส่งมอบให้ไรเดอร์หรือไม่?":"รายการทั้งหมดเสร็จสิ้นแล้ว ต้องการเข้าสู่ขั้นตอนการชำระเงินหรือไม่?",okText:"ยืนยัน",cancelText:"ยกเลิก",onOk:async()=>{try{Y(!0),K("กำลังยืนยันรายการ..."),eC();let e=await (0,R.P)();if(await I.x.updateStatus(d,H.i.WaitingForPayment,e),c.ZP.success("ยืนยันออเดอร์เรียบร้อย"),O){let e=(0,W.EO)(O);i.push(e)}else i.push("/pos/orders")}catch(e){c.ZP.error("เกิดข้อผิดพลาดในการยืนยัน")}finally{Y(!1),Q()}}})};if(E&&!O)return null;if(!O)return(0,l.jsx)(y.Z,{description:"ไม่พบข้อมูล"});let eY=[{title:"",key:"image",width:70,align:"center",render:(e,t)=>{var i,r,n;return(null===(i=t.product)||void 0===i?void 0:i.img_url)?(0,l.jsx)(l.Fragment,{children:(0,l.jsx)("img",{src:t.product.img_url,alt:null!==(n=null===(r=t.product)||void 0===r?void 0:r.display_name)&&void 0!==n?n:"สินค้า",style:L.B9.productThumb})}):(0,l.jsx)("div",{style:L.B9.productThumbPlaceholder,children:(0,l.jsx)(_.Z,{})})}},{title:"รายการ",key:"product",align:"center",render:(e,t)=>{var i;return(0,l.jsxs)(u.Z,{orientation:"vertical",size:2,align:"center",children:[(0,l.jsx)(ej,{strong:!0,style:{fontSize:15,lineHeight:"1.2"},children:null===(i=t.product)||void 0===i?void 0:i.display_name}),t.details&&t.details.length>0&&(0,l.jsx)("div",{style:{fontSize:13,color:L._A.served,textAlign:"center"},children:t.details.map((e,t)=>(0,l.jsxs)("div",{style:{lineHeight:"1.4"},children:["+ ",e.detail_name]},t))}),t.notes&&(0,l.jsxs)(ej,{style:{fontSize:13,color:L._A.cancelled},children:[(0,l.jsx)(S.Z,{})," ",t.notes]})]})}},{title:"หมวดหมู่",key:"category",width:120,align:"center",render:(e,t)=>{var i,r;return(0,l.jsx)(u.Z,{orientation:"vertical",size:0,align:"center",children:(null===(r=t.product)||void 0===r?void 0:null===(i=r.category)||void 0===i?void 0:i.display_name)?(0,l.jsx)(h.Z,{color:"cyan",style:L.B9.categoryTag,children:t.product.category.display_name}):"-"})}},{title:"ราคา",key:"price",width:110,align:"center",render:(e,t)=>(0,l.jsxs)(u.Z,{orientation:"vertical",size:0,align:"center",children:[(0,l.jsxs)(ej,{style:{...L.B9.priceTag,fontSize:18},children:["฿",Number(t.price).toLocaleString()]}),t.details&&t.details.length>0&&t.details.map((e,t)=>(0,l.jsxs)(ej,{style:{fontSize:13,color:L._A.priceTotal,display:"block",lineHeight:"1.4"},children:["+ ฿",Number(e.extra_price).toLocaleString()]},t))]})},{title:"สถานะ",dataIndex:"status",key:"status",width:120,align:"center",render:e=>(0,l.jsx)(h.Z,{color:e===H.i.Pending?"orange":e===H.i.Cooking?"blue":"green",children:(0,W.d7)(e,O.order_type)})},{title:"จำนวน",dataIndex:"quantity",key:"quantity",width:80,align:"center",render:e=>(0,l.jsxs)(ej,{strong:!0,style:{fontSize:16},children:["x",e]})},{title:"จัดการ",key:"actions",width:130,align:"right",render:(e,t)=>(0,l.jsxs)(u.Z,{children:[(0,l.jsx)(x.Z,{title:(0,W.qO)(O.order_type),children:(0,l.jsxs)(p.ZP,{type:"primary",onClick:()=>eq(t.id),style:{background:L._A.served,borderColor:L._A.served,height:"auto",padding:"4px 8px",display:"flex",flexDirection:"column",alignItems:"center",gap:2,minWidth:60,borderRadius:10},children:[(0,l.jsx)(k.Z,{style:{fontSize:16}}),(0,l.jsx)("span",{style:{fontSize:10,fontWeight:700},children:(0,W.qO)(O.order_type)})]})}),(0,l.jsx)(x.Z,{title:"แก้ไข",children:(0,l.jsx)(p.ZP,{type:"text",icon:(0,l.jsx)(Z.Z,{}),onClick:()=>eE(t)})}),(0,l.jsx)(x.Z,{title:"ลบ",children:(0,l.jsx)(p.ZP,{type:"text",danger:!0,icon:(0,l.jsx)(C.Z,{}),onClick:()=>eF(t.id)})})]})}],eK=[{title:"",key:"image",width:70,align:"center",render:(e,t)=>{var i,r,n;return(null===(i=t.product)||void 0===i?void 0:i.img_url)?(0,l.jsx)(l.Fragment,{children:(0,l.jsx)("img",{src:t.product.img_url,alt:null!==(n=null===(r=t.product)||void 0===r?void 0:r.display_name)&&void 0!==n?n:"สินค้า",style:{...L.B9.productThumb,opacity:.7}})}):(0,l.jsx)("div",{style:L.B9.productThumbPlaceholder,children:(0,l.jsx)(_.Z,{})})}},{title:"รายการ",key:"product",align:"center",render:(e,t)=>{var i;return(0,l.jsxs)(u.Z,{orientation:"vertical",size:2,align:"center",children:[(0,l.jsx)(ej,{strong:!0,style:{fontSize:15,lineHeight:"1.2",textDecoration:t.status===H.i.Cancelled?"line-through":"none",color:t.status===H.i.Cancelled?L._A.textLight:L._A.text},children:null===(i=t.product)||void 0===i?void 0:i.display_name}),t.details&&t.details.length>0&&(0,l.jsx)("div",{style:{fontSize:12,color:L._A.served,opacity:.7,textAlign:"center"},children:t.details.map((e,t)=>(0,l.jsxs)("div",{style:{lineHeight:"1.4"},children:["+ ",e.detail_name]},t))}),t.notes&&(0,l.jsxs)(ej,{style:{fontSize:12,opacity:.7,color:L._A.cancelled},children:[(0,l.jsx)(S.Z,{})," ",t.notes]})]})}},{title:"หมวดหมู่",key:"category",width:120,align:"center",render:(e,t)=>{var i,r;return(0,l.jsx)(u.Z,{orientation:"vertical",size:0,align:"center",children:(null===(r=t.product)||void 0===r?void 0:null===(i=r.category)||void 0===i?void 0:i.display_name)?(0,l.jsx)(h.Z,{color:"cyan",style:{...L.B9.categoryTag,opacity:.7},children:t.product.category.display_name}):"-"})}},{title:"ราคา",key:"price",width:110,align:"center",render:(e,t)=>(0,l.jsxs)(u.Z,{orientation:"vertical",size:0,align:"center",children:[(0,l.jsxs)(ej,{style:{...L.B9.priceTag,opacity:.7},children:["฿",Number(t.price).toLocaleString()]}),t.details&&t.details.length>0&&t.details.map((e,t)=>(0,l.jsxs)(ej,{style:{fontSize:11,opacity:.7,color:L._A.priceTotal,display:"block",lineHeight:"1.4"},children:["+ ฿",Number(e.extra_price).toLocaleString()]},t))]})},{title:"ราคารวม",key:"total",width:120,align:"center",render:(e,t)=>(0,l.jsxs)(ej,{strong:!0,style:{color:t.status===H.i.Cancelled?L._A.textLight:L._A.priceTotal,fontSize:16,textDecoration:t.status===H.i.Cancelled?"line-through":"none"},children:["฿",Number(t.total_price).toLocaleString()]})},{title:"สถานะ",dataIndex:"status",key:"status",width:120,align:"center",render:e=>(0,l.jsx)(h.Z,{color:(0,W.OY)(e),children:(0,W.d7)(e,O.order_type)})},{title:"จำนวน",dataIndex:"quantity",key:"quantity",width:80,align:"center",render:e=>(0,l.jsxs)(ej,{strong:!0,style:{fontSize:16},children:["x",e]})},{title:"จัดการ",key:"actions",width:130,align:"right",render:(e,t)=>t.status===H.i.Served?(0,l.jsx)(p.ZP,{size:"small",className:"unserve-button",style:L.B9.unserveButton,icon:(0,l.jsx)(z.Z,{}),onClick:()=>eO(t.id),children:O.order_type===H.m.DineIn?"ยกเลิกเสิร์ฟ":"ยกเลิกปรุงเสร็จ"}):null}];return(0,l.jsxs)("div",{style:L.B9.container,className:"order-detail-page",children:[(0,l.jsx)(n(),{id:L.$k.__hash,children:L.$k}),(0,l.jsx)(eg.Z,{title:null!==(t=null==O?void 0:O.order_no)&&void 0!==t?t:"รายละเอียดออเดอร์",subtitle:O?(0,l.jsxs)(u.Z,{size:8,wrap:!0,children:[(0,l.jsx)(h.Z,{icon:O.order_type===H.m.DineIn?(0,l.jsx)(_.Z,{style:{fontSize:10}}):O.order_type===H.m.TakeAway?(0,l.jsx)(w.Z,{style:{fontSize:10}}):(0,l.jsx)(A.Z,{style:{fontSize:10}}),style:{...L.B9.channelBadge,background:(0,W.Gs)(O.order_type)+"15",color:(0,W.Gs)(O.order_type)},children:(0,W.mz)(O.order_type)}),(0,l.jsx)(ej,{type:"secondary",style:{fontSize:12},children:F()(O.create_date).format("HH:mm | D MMM YY")}),(0,l.jsx)(h.Z,{color:(0,W.OY)(O.status),style:{margin:0,borderRadius:8,fontWeight:600},children:(0,W.d7)(O.status,O.order_type)}),er&&(0,l.jsxs)(h.Z,{color:er.status===em.l.Pending?"orange":er.status===em.l.Processing?"blue":er.status===em.l.Completed?"green":"red",style:{margin:0,borderRadius:8,fontWeight:600},children:["คิว #",er.queue_position]})]}):void 0,onBack:()=>{(null==O?void 0:O.order_type)===H.m.DineIn?i.push("/pos/channels/dine-in"):i.back()},icon:(0,l.jsx)(N.Z,{style:{fontSize:20}}),actions:(0,l.jsx)(p.ZP,{icon:(0,l.jsx)(B.Z,{}),onClick:()=>d&&ez(d),loading:G||E,children:"รีเฟรช"})}),O&&O.status!==H.i.Cancelled&&O.status!==H.i.Completed&&(0,l.jsx)("div",{style:{padding:"12px 16px",display:"flex",justifyContent:"flex-end",gap:8,background:L._A.backgroundSecondary,borderBottom:"1px solid ".concat(L._A.border)},children:er?(0,l.jsx)(p.ZP,{danger:!0,icon:(0,l.jsx)(C.Z,{}),onClick:()=>{et(er.id)},loading:ei,size:"middle",style:{borderRadius:10,height:36,fontWeight:500,fontSize:13},className:"scale-hover queue-action-button",children:"ลบออกจากคิว"}):(0,l.jsx)(p.ZP,{type:"primary",icon:(0,l.jsx)(N.Z,{}),onClick:()=>{V({orderId:O.id,priority:em.t.Normal})},loading:ei,size:"middle",style:{borderRadius:10,height:36,fontWeight:500,fontSize:13,background:"linear-gradient(135deg, ".concat(L._A.primary," 0%, ").concat(L._A.primaryDark," 100%)"),border:"none",boxShadow:"0 2px 8px ".concat(L._A.primary,"25")},className:"scale-hover queue-action-button",children:"เพิ่มเข้าคิว"})}),(0,l.jsx)("main",{style:L.B9.contentWrapper,className:"order-detail-content",children:(0,l.jsxs)(m.Z,{gutter:[20,20],children:[(0,l.jsxs)(g.Z,{xs:24,lg:16,children:[(0,l.jsx)(v.Z,{className:"order-detail-card fade-in",style:L.B9.card,title:(0,l.jsxs)("div",{className:"card-header-wrapper",children:[(0,l.jsxs)("div",{className:"card-header-top-row",children:[(0,l.jsxs)("div",{className:"card-header-left",children:[(0,l.jsx)("div",{style:L.B9.masterCheckboxWrapper,children:(0,l.jsx)(j.Z,{indeterminate:en.length>0&&en.length<ew.length,checked:ew.length>0&&en.length===ew.length,onChange:e=>{e.target.checked?es(ew.map(e=>e.id)):es([])},style:L.B9.masterCheckbox})}),(0,l.jsxs)(ej,{strong:!0,style:L.Qo.sectionTitle,className:"section-title-text",children:["กำลังทำอาหาร (",ew.length,")"]})]}),(0,l.jsx)("div",{className:"card-header-right",children:(0,l.jsxs)("div",{className:"header-actions-container",children:[(0,l.jsx)(p.ZP,{icon:(0,l.jsx)(B.Z,{}),onClick:()=>ez(d),size:"small",style:L.B9.actionButtonSecondary,className:"header-action-btn",title:"รีเฟรช"}),(0,l.jsx)(p.ZP,{type:"primary",icon:(0,l.jsx)(P.Z,{}),onClick:()=>eS(!0),size:"small",style:L.B9.actionButtonPrimary,className:"header-action-btn",children:(0,l.jsx)("span",{children:"เพิ่ม"})})]})})]}),en.length>0&&(0,l.jsxs)("div",{className:"bulk-actions-container",children:[(0,l.jsx)(p.ZP,{danger:!0,icon:(0,l.jsx)(C.Z,{}),onClick:eW,size:"small",className:"bulk-action-btn",children:(0,l.jsxs)("span",{children:["ยกเลิก (",en.length,")"]})}),(0,l.jsx)(p.ZP,{type:"primary",icon:(0,l.jsx)(k.Z,{}),onClick:eL,loading:G,size:"small",style:{background:L._A.served,borderColor:L._A.served},className:"bulk-action-btn",children:(0,l.jsxs)("span",{children:[(0,W.qO)(O.order_type)," (",en.length,")"]})})]})]}),children:ew.length>0?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"order-detail-table-desktop",children:(0,l.jsx)(f.Z,{dataSource:eN,columns:eY,rowKey:"id",virtual:eD,scroll:eD?{y:420}:void 0,pagination:!1,size:"middle",className:"order-items-table",rowSelection:{selectedRowKeys:en,onChange:e=>{es(e)},hideSelectAll:!0}})}),(0,l.jsx)("div",{className:"order-detail-cards-mobile",children:eN.map(e=>{var t,i,r,n,s,a;return(0,l.jsxs)("div",{style:{...L.B9.itemCard,...L.B9.itemCardActive},className:"order-item-card scale-in",children:[(0,l.jsxs)("div",{style:{display:"flex",gap:10,marginBottom:10},children:[(0,l.jsx)("div",{style:{flexShrink:0},children:(null===(t=e.product)||void 0===t?void 0:t.img_url)?(0,l.jsx)(l.Fragment,{children:(0,l.jsx)("img",{src:e.product.img_url,alt:null!==(a=null===(i=e.product)||void 0===i?void 0:i.display_name)&&void 0!==a?a:"สินค้า",style:{...L.B9.productThumb,width:56,height:56,borderRadius:10}})}):(0,l.jsx)("div",{style:{...L.B9.productThumbPlaceholder,width:56,height:56,borderRadius:10},children:(0,l.jsx)(_.Z,{style:{fontSize:20}})})}),(0,l.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,l.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[(0,l.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,l.jsx)(j.Z,{checked:en.includes(e.id),onChange:t=>{es(t.target.checked?[...en,e.id]:en.filter(t=>t!==e.id))},children:(0,l.jsx)(ej,{strong:!0,style:{fontSize:17,lineHeight:1.5},children:null===(r=e.product)||void 0===r?void 0:r.display_name})}),(0,l.jsx)("div",{style:{paddingLeft:24,marginTop:2},children:(null===(s=e.product)||void 0===s?void 0:null===(n=s.category)||void 0===n?void 0:n.display_name)&&(0,l.jsx)(h.Z,{color:"cyan",style:{...L.B9.categoryTag,fontSize:9},children:e.product.category.display_name})})]}),(0,l.jsxs)(ej,{strong:!0,style:{fontSize:19,color:L._A.primary,marginLeft:8,lineHeight:1.4},children:["x",e.quantity]})]}),(0,l.jsxs)("div",{style:{paddingLeft:24,marginTop:2},children:[e.details&&e.details.length>0&&(0,l.jsx)("div",{style:{fontSize:13,color:L._A.served,marginBottom:4,lineHeight:1.4},children:e.details.map(e=>"".concat(e.detail_name," (+ ฿").concat(Number(e.extra_price).toLocaleString(),")")).join(", ")}),(0,l.jsx)(u.Z,{orientation:"vertical",size:2,children:(0,l.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,l.jsxs)(ej,{style:{...L.B9.priceTag,fontSize:15},children:["฿",Number(e.price).toLocaleString()]}),(0,l.jsxs)(ej,{strong:!0,style:{color:L._A.priceTotal,fontSize:16},children:["รวม ฿",Number(e.total_price).toLocaleString()]})]})}),e.notes&&(0,l.jsx)("div",{style:{marginTop:4},children:(0,l.jsxs)(ej,{style:{fontSize:13,color:L._A.cancelled,lineHeight:1.4},children:[(0,l.jsx)(S.Z,{style:{fontSize:13}})," ",e.notes]})})]})]})]}),(0,l.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",borderTop:"1px solid ".concat(L._A.border),paddingTop:10,gap:6,marginTop:10},children:[(0,l.jsx)(p.ZP,{size:"small",type:"text",danger:!0,icon:(0,l.jsx)(C.Z,{}),onClick:()=>eF(e.id),style:{height:34,borderRadius:8,fontSize:13,padding:"0 12px",fontWeight:500},className:"scale-hover",children:"ลบ"}),(0,l.jsx)(p.ZP,{size:"small",type:"text",icon:(0,l.jsx)(Z.Z,{}),onClick:()=>eE(e),style:{height:34,borderRadius:8,fontSize:13,padding:"0 12px",fontWeight:500},className:"scale-hover",children:"แก้ไข"}),(0,l.jsxs)(p.ZP,{size:"small",type:"primary",onClick:()=>eq(e.id),style:{background:L._A.served,borderColor:L._A.served,height:34,padding:"0 14px",borderRadius:8,fontSize:13,fontWeight:600},className:"scale-hover",children:[(0,l.jsx)(k.Z,{style:{fontSize:13,marginRight:4}}),(0,W.qO)(O.order_type)]})]})]},e.id)})})]}):(0,l.jsxs)("div",{style:L.B9.emptyState,children:[(0,l.jsx)(T.Z,{className:"empty-state-icon"}),(0,l.jsx)(ej,{className:"empty-state-text",children:"ไม่มีรายการที่กำลังรอ"})]})}),(0,l.jsx)(v.Z,{className:"order-detail-card fade-in",style:L.B9.card,title:(0,l.jsxs)(ej,{strong:!0,style:{...L.Qo.sectionTitle,color:L._A.textSecondary},children:[(0,W.zP)(O.order_type)," (",eA.length,")"]}),children:eA.length>0?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"order-detail-table-desktop",children:(0,l.jsx)(f.Z,{dataSource:eB,columns:eK,rowKey:"id",virtual:eH,scroll:eH?{y:360}:void 0,pagination:!1,size:"small",className:"order-items-table",rowClassName:e=>e.status===H.i.Cancelled?"row-cancelled":""})}),(0,l.jsx)("div",{className:"order-detail-cards-mobile",children:eB.map(e=>{var t,i,r,n,s,a;return(0,l.jsxs)("div",{style:{...L.B9.itemCard,...L.B9.itemCardServed,backgroundColor:e.status===H.i.Cancelled?L._A.cancelledLight:L._A.white,borderColor:e.status===H.i.Cancelled?L._A.cancelled+"30":L._A.border,position:"relative"},children:[(0,l.jsx)("div",{style:{position:"absolute",top:10,right:10},children:(0,l.jsx)(h.Z,{color:(0,W.OY)(e.status),style:{margin:0,fontSize:10,padding:"2px 8px",borderRadius:6,lineHeight:1.2},children:(0,W.d7)(e.status,O.order_type)})}),(0,l.jsxs)("div",{style:{display:"flex",gap:10},children:[(0,l.jsx)("div",{style:{flexShrink:0},children:(null===(t=e.product)||void 0===t?void 0:t.img_url)?(0,l.jsx)(l.Fragment,{children:(0,l.jsx)("img",{src:e.product.img_url,alt:null!==(a=null===(i=e.product)||void 0===i?void 0:i.display_name)&&void 0!==a?a:"สินค้า",style:{...L.B9.productThumb,width:52,height:52,borderRadius:10,opacity:.7}})}):(0,l.jsx)("div",{style:{...L.B9.productThumbPlaceholder,width:52,height:52,borderRadius:10},children:(0,l.jsx)(_.Z,{style:{fontSize:18}})})}),(0,l.jsx)("div",{style:{flex:1,minWidth:0,paddingRight:50},children:(0,l.jsx)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:(0,l.jsxs)("div",{style:{flex:1},children:[(0,l.jsx)(ej,{strong:!0,style:{fontSize:16,textDecoration:e.status===H.i.Cancelled?"line-through":"none",color:e.status===H.i.Cancelled?L._A.textLight:L._A.text,lineHeight:1.5},children:null===(r=e.product)||void 0===r?void 0:r.display_name}),(0,l.jsx)("div",{style:{marginTop:2},children:(null===(s=e.product)||void 0===s?void 0:null===(n=s.category)||void 0===n?void 0:n.display_name)&&(0,l.jsx)(h.Z,{color:"cyan",style:{...L.B9.categoryTag,fontSize:9},children:e.product.category.display_name})}),e.details&&e.details.length>0&&(0,l.jsx)("div",{style:{fontSize:13,color:L._A.served,opacity:.7,marginBottom:4,lineHeight:1.4},children:e.details.map(e=>"".concat(e.detail_name," (+ ฿").concat(Number(e.extra_price).toLocaleString(),")")).join(", ")}),(0,l.jsx)(u.Z,{orientation:"vertical",size:2,style:{marginTop:4,width:"100%"},children:(0,l.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)(ej,{style:{...L.B9.priceTag,fontSize:14,opacity:.7},children:["฿",Number(e.price).toLocaleString()]}),(0,l.jsxs)(ej,{strong:!0,style:{marginLeft:8,color:L._A.textSecondary,opacity:.7,fontSize:15},children:["รวม ฿",Number(e.total_price).toLocaleString()]})]}),(0,l.jsxs)(ej,{strong:!0,style:{color:L._A.textSecondary,fontSize:15},children:["x",e.quantity]})]})}),e.notes&&(0,l.jsx)("div",{style:{marginTop:4},children:(0,l.jsxs)(ej,{style:{fontSize:13,opacity:.7,color:L._A.cancelled,lineHeight:1.4},children:[(0,l.jsx)(S.Z,{style:{fontSize:13}})," ",e.notes]})})]})})})]}),e.status===H.i.Served&&(0,l.jsx)("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:10,paddingTop:10,borderTop:"1px solid ".concat(L._A.border)},children:(0,l.jsx)(p.ZP,{size:"small",className:"unserve-button",style:{...L.B9.unserveButton,height:34,fontSize:13,padding:"0 14px",borderRadius:8,fontWeight:500},icon:(0,l.jsx)(z.Z,{style:{fontSize:13}}),onClick:()=>eO(e.id),children:(null==O?void 0:O.order_type)===H.m.DineIn?"ยกเลิกเสิร์ฟ":"ยกเลิกปรุงเสร็จ"})})]},e.id)})})]}):(0,l.jsx)("div",{style:{textAlign:"center",padding:"20px 0"},children:(0,l.jsx)(ej,{type:"secondary",children:"ยังไม่มีรายการที่ดำเนินการแล้ว"})})})]}),(0,l.jsx)(g.Z,{xs:24,lg:8,children:(0,l.jsxs)(v.Z,{className:"order-detail-card summary-card",style:L.B9.summaryCard,children:[(0,l.jsx)(ev,{level:5,style:{marginBottom:16,fontSize:18,fontWeight:600},children:"สรุปการสั่งซื้อ"}),(0,l.jsxs)("div",{style:{...L.B9.summaryList,background:"white"},children:[(0,l.jsx)(ej,{strong:!0,style:{fontSize:15,marginBottom:10,display:"block",color:L._A.textSecondary},children:"รายการสินค้า"}),eT.map((e,t)=>{var i,r,n;return(0,l.jsxs)("div",{style:L.B9.summaryItemRow,children:[(null===(i=e.product)||void 0===i?void 0:i.img_url)?(0,l.jsx)(l.Fragment,{children:(0,l.jsx)("img",{src:e.product.img_url,alt:(null===(r=e.product)||void 0===r?void 0:r.display_name)||"สินค้า",style:L.B9.summaryItemImage})}):(0,l.jsx)("div",{style:{...L.B9.summaryItemImage,display:"flex",alignItems:"center",justifyContent:"center",background:"#f8fafc"},children:(0,l.jsx)(_.Z,{style:{fontSize:16,color:"#bfbfbf"}})}),(0,l.jsxs)("div",{style:L.B9.summaryItemContent,children:[(0,l.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[(0,l.jsx)(ej,{strong:!0,style:{fontSize:15,flex:1,lineHeight:1.4},children:null===(n=e.product)||void 0===n?void 0:n.display_name}),(0,l.jsxs)(ej,{strong:!0,style:{fontSize:15,color:L._A.primary,lineHeight:1.4},children:["฿",Number(e.total_price).toLocaleString()]})]}),(0,l.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:4},children:[(0,l.jsxs)(ej,{type:"secondary",style:{fontSize:13,lineHeight:1.4},children:["จำนวน : ",e.quantity]}),(0,l.jsxs)(ej,{type:"secondary",style:{fontSize:13,lineHeight:1.4},children:["ราคา : ",Number(e.price).toLocaleString()]})]}),e.details&&e.details.length>0&&(0,l.jsxs)("div",{style:L.B9.summaryDetailText,children:[(0,l.jsx)(P.Z,{style:{fontSize:10}})," ",e.details.map(e=>"".concat(e.detail_name," (+").concat(Number(e.extra_price).toLocaleString(),")")).join(", ")]}),e.notes&&(0,l.jsxs)("div",{style:{...L.B9.summaryDetailText,color:L._A.cancelled,fontStyle:"italic"},children:["โน้ต: ",e.notes]})]})]},e.id||t)})]}),(0,l.jsxs)("div",{style:L.B9.summaryList,children:[(0,l.jsx)(ej,{strong:!0,style:{fontSize:15,marginBottom:10,display:"block",color:L._A.textSecondary},children:"แยกตามหมวดหมู่"}),Object.entries((0,W.Rr)((null==O?void 0:O.items)||[])).map(e=>{let[t,i]=e;return(0,l.jsxs)("div",{style:L.B9.summaryRow,children:[(0,l.jsx)(ej,{type:"secondary",style:{fontSize:14,lineHeight:1.4},children:t}),(0,l.jsxs)(ej,{strong:!0,style:{fontSize:14,lineHeight:1.4},children:[String(i)," รายการ"]})]},t)}),(0,l.jsx)(b.Z,{style:{margin:"10px 0"}}),(0,l.jsxs)("div",{style:L.B9.summaryRow,children:[(0,l.jsx)(ej,{type:"secondary",style:{fontSize:14,lineHeight:1.4},children:"จำนวนรายการทั้งหมด"}),(0,l.jsxs)(ej,{strong:!0,style:{fontSize:14,lineHeight:1.4},children:[eP.length," รายการ"]})]})]}),(0,l.jsx)("div",{style:{padding:"0 4px"},children:(0,l.jsxs)("div",{style:L.B9.summaryMainRow,children:[(0,l.jsx)(ej,{strong:!0,style:{fontSize:20,lineHeight:1.3},children:"ยอดรวมทั้งสิ้น"}),(0,l.jsxs)(ej,{strong:!0,style:{fontSize:28,color:L._A.primary,lineHeight:1.2},children:["฿",eI.toLocaleString()]})]})}),eR&&(0,l.jsx)(p.ZP,{type:"primary",block:!0,size:"large",onClick:eG,style:{marginTop:16,height:48,borderRadius:10,fontWeight:600,fontSize:16,background:"linear-gradient(135deg, ".concat(L._A.served," 0%, #059669 100%)"),border:"none",boxShadow:"0 4px 12px ".concat(L._A.served,"25")},className:"scale-hover",children:(0,W.iN)(O.order_type)}),(0,l.jsx)(p.ZP,{danger:!0,block:!0,size:"large",onClick:()=>{O&&eZ({open:!0,type:"danger",title:"ยืนยันการยกเลิกออเดอร์?",content:"การดำเนินการนี้จะยกเลิกสินค้าทุกรายการและคืนสถานะโต๊ะ (หากมี) คุณแน่ใจหรือไม่?",okText:"ยืนยันการยกเลิก",cancelText:"ยกเลิก",onOk:async()=>{try{var e;Y(!0),K("กำลังดำเนินการยกเลิก..."),eC();let t=await (0,R.P)(),l=(null===(e=O.items)||void 0===e?void 0:e.filter(e=>e.status!==H.i.Cancelled))||[];await Promise.all(l.map(e=>I.x.updateItemStatus(e.id,H.i.Cancelled,void 0,t))),await I.x.updateStatus(O.id,H.i.Cancelled,t),O.table_id&&await D.$.update(O.table_id,{status:q.c.Available},void 0,t),c.ZP.success("ยกเลิกออเดอร์เรียบร้อย"),i.push((0,W.d$)(O.order_type))}catch(e){c.ZP.error("ไม่สามารถยกเลิกออเดอร์ได้")}finally{Y(!1),Q()}}})},style:{marginTop:12,height:44,borderRadius:10,fontWeight:500,fontSize:15,border:"1px solid ".concat(L._A.danger)},disabled:G,className:"scale-hover",children:"ยกเลิกออเดอร์"})]})})]})}),(0,l.jsx)(el,{isOpen:e_,onClose:()=>eS(!1),onAddItem:e$,orderType:null==O?void 0:O.order_type}),ea&&ef&&(0,l.jsx)(ed,{item:ef,isOpen:ea,onClose:()=>{eo(!1),eb(null)},onSave:eM},"edit-modal-".concat(ef.id)),(0,l.jsx)(ec.Z,{open:ek.open,type:ek.type,title:ek.title,content:ek.content,okText:ek.okText,cancelText:ek.cancelText,onOk:ek.onOk,onCancel:eC,loading:G})]})}F().locale("th")}},function(e){e.O(0,[8024,4736,8592,1744],function(){return e(e.s=8118)}),_N_E=e.O()}]);