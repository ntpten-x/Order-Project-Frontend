(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9799],{69642:function(e,t,n){Promise.resolve().then(n.bind(n,57385))},57385:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return J}});var a=n(57437),r=n(2265),i=n(82646),l=n(88589),s=n(50742),o=n(80009),c=n(85180),d=n(53743),h=n(34029),u=n(48651),f=n(8056),g=n(93132),x=n(89245),b=n(96473),y=n(68620),p=n(8881),j=n(8900),m=n(39725),v=n(13377),w=n(26349),k=n(34962),S=n(99376),C=n(3369),E=n(26972),T=n(24675),I=n(97235),R=n(3286),z=n(67697),Z=n(73814),P=n(66290),_=n(69397);let A={...(0,_.y)("linear-gradient(135deg, #722ed1 0%, #531dab 100%)"),tableCard:e=>({marginBottom:12,borderRadius:20,border:"none",boxShadow:"0 2px 8px rgba(0,0,0,0.04)",overflow:"hidden",transition:"all 0.3s ease",background:e?"white":"linear-gradient(to right, #fafafa, white)",opacity:e?1:.7}),tableCardInner:{padding:16,display:"flex",alignItems:"center",gap:14}},N=(0,_.I)(".tables-page",".table-card"),{Text:D,Title:L}=i.default,F=e=>{let{onRefresh:t,onAdd:n,searchValue:r,onSearchChange:i}=e;return(0,a.jsxs)("div",{style:A.header,children:[(0,a.jsx)("div",{style:A.headerDecoCircle1}),(0,a.jsx)("div",{style:A.headerDecoCircle2}),(0,a.jsxs)("div",{style:A.headerContent,children:[(0,a.jsxs)("div",{style:A.headerLeft,children:[(0,a.jsx)("div",{style:A.headerIconBox,children:(0,a.jsx)(g.Z,{style:{fontSize:24,color:"white"}})}),(0,a.jsxs)("div",{children:[(0,a.jsx)(D,{style:{color:"rgba(255,255,255,0.85)",fontSize:13,display:"block"},children:"จัดการและติดตามสถานะโต๊ะทั้งหมดของคุณ"}),(0,a.jsx)(L,{level:4,style:{color:"white",margin:0,fontWeight:700,letterSpacing:"0.5px"},children:"รายการโต๊ะ"})]})]}),(0,a.jsxs)("div",{style:A.headerActions,children:[(0,a.jsx)(l.default,{allowClear:!0,placeholder:"ค้นหาโต๊ะ...",value:r,onChange:e=>i(e.target.value),style:{width:220,borderRadius:10}}),(0,a.jsx)(s.ZP,{type:"text",icon:(0,a.jsx)(x.Z,{style:{color:"white"}}),onClick:t,style:{background:"rgba(255,255,255,0.2)",borderRadius:12,height:40,width:40}}),(0,a.jsx)(s.ZP,{type:"primary",icon:(0,a.jsx)(b.Z,{}),onClick:n,style:{background:"white",color:"#722ed1",borderRadius:12,height:40,fontWeight:600,border:"none",boxShadow:"0 4px 12px rgba(0,0,0,0.15)"},children:"เพิ่มโต๊ะใหม่"})]})]})]})},O="pos:tables",B=e=>{let{totalTables:t,availableTables:n,unavailableTables:r,activeTables:i,inactiveTables:l}=e;return(0,a.jsxs)("div",{style:A.statsCard,children:[(0,a.jsxs)("div",{style:A.statItem,children:[(0,a.jsx)("span",{style:{...A.statNumber,color:"#722ed1"},children:t}),(0,a.jsx)(D,{style:A.statLabel,children:"ทั้งหมด"})]}),(0,a.jsx)("div",{style:{width:1,background:"#f0f0f0"}}),(0,a.jsxs)("div",{style:A.statItem,children:[(0,a.jsx)("span",{style:{...A.statNumber,color:"#52c41a"},children:n}),(0,a.jsx)(D,{style:A.statLabel,children:"ว่าง"})]}),(0,a.jsx)("div",{style:{width:1,background:"#f0f0f0"}}),(0,a.jsxs)("div",{style:A.statItem,children:[(0,a.jsx)("span",{style:{...A.statNumber,color:"#fa8c16"},children:r}),(0,a.jsx)(D,{style:A.statLabel,children:"ไม่ว่าง"})]}),(0,a.jsx)("div",{style:{width:1,background:"#f0f0f0"}}),(0,a.jsxs)("div",{style:A.statItem,children:[(0,a.jsx)("span",{style:{...A.statNumber,color:"#1890ff"},children:i}),(0,a.jsx)(D,{style:A.statLabel,children:"ใช้งาน"})]}),(0,a.jsx)("div",{style:{width:1,background:"#f0f0f0"}}),(0,a.jsxs)("div",{style:A.statItem,children:[(0,a.jsx)("span",{style:{...A.statNumber,color:"#ff4d4f"},children:l}),(0,a.jsx)(D,{style:A.statLabel,children:"ปิดใช้งาน"})]})]})},U=e=>{let{table:t,index:n,onEdit:r,onDelete:i}=e,l=t.status===k.c.Available;return(0,a.jsx)("div",{className:"table-card",style:{...A.tableCard(t.is_active),animationDelay:"".concat(.03*n,"s")},children:(0,a.jsxs)("div",{style:A.tableCardInner,children:[(0,a.jsx)("div",{style:{width:64,height:64,borderRadius:14,border:"2px solid #f0f0f0",boxShadow:"0 4px 12px rgba(0,0,0,0.06)",flexShrink:0,overflow:"hidden",position:"relative",background:l?"linear-gradient(135deg, #f6ffed 0%, #d9f7be 100%)":"linear-gradient(135deg, #fff7e6 0%, #ffe7ba 100%)",display:"flex",alignItems:"center",justifyContent:"center"},children:l?(0,a.jsx)(y.Z,{style:{fontSize:28,color:"#52c41a"}}):(0,a.jsx)(p.Z,{style:{fontSize:28,color:"#fa8c16"}})}),(0,a.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4},children:[(0,a.jsx)(D,{strong:!0,style:{fontSize:16,color:"#1a1a2e"},children:t.table_name}),t.is_active?(0,a.jsx)(j.Z,{style:{color:"#52c41a",fontSize:14}}):(0,a.jsx)(m.Z,{style:{color:"#ff4d4f",fontSize:14}})]}),(0,a.jsxs)("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:[(0,a.jsx)(o.Z,{color:l?"success":"warning",style:{borderRadius:8,margin:0,fontSize:11},children:l?"ว่าง":"ไม่ว่าง"}),(0,a.jsx)(o.Z,{color:t.is_active?"processing":"default",style:{borderRadius:8,margin:0,fontSize:11},children:t.is_active?"เปิดใช้งาน":"ปิดใช้งาน"})]})]}),(0,a.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,a.jsx)(s.ZP,{type:"text",icon:(0,a.jsx)(v.Z,{}),onClick:e=>{e.stopPropagation(),r(t)},style:{borderRadius:10,color:"#722ed1",background:"#f9f0ff"}}),(0,a.jsx)(s.ZP,{type:"text",danger:!0,icon:(0,a.jsx)(w.Z,{}),onClick:e=>{e.stopPropagation(),i(t)},style:{borderRadius:10,background:"#fff2f0"}})]})]})})},W=e=>{let{onAdd:t}=e;return(0,a.jsx)(c.Z,{image:c.Z.PRESENTED_IMAGE_SIMPLE,description:(0,a.jsxs)("div",{style:{textAlign:"center"},children:[(0,a.jsx)(D,{type:"secondary",style:{fontSize:15},children:"ยังไม่มีโต๊ะ"}),(0,a.jsx)("br",{}),(0,a.jsx)(D,{type:"secondary",style:{fontSize:13},children:"เริ่มต้นเพิ่มโต๊ะแรกของคุณ"})]}),style:{padding:"60px 20px",background:"white",borderRadius:20,margin:"0 16px"},children:(0,a.jsx)(s.ZP,{type:"primary",icon:(0,a.jsx)(b.Z,{}),onClick:t,style:{background:"linear-gradient(135deg, #722ed1 0%, #531dab 100%)",border:"none"},children:"เพิ่มโต๊ะ"})})};function J(){let e=(0,S.useRouter)(),[t,n]=(0,r.useState)([]),[i,l]=(0,r.useState)(1),[s,o]=(0,r.useState)(0),[c,x]=(0,r.useState)(1),[b,y]=(0,r.useState)(""),[p,j]=(0,r.useState)(""),{execute:m}=(0,E.J)(),{showLoading:v}=(0,C.x)(),{socket:w}=(0,T.s)(),{isAuthorized:_,isChecking:L}=(0,R.e)({requiredRole:"Admin"});(0,r.useEffect)(()=>{(0,I.P)()},[]),(0,r.useEffect)(()=>{let e=setTimeout(()=>{j(b.trim()),l(1)},400);return()=>clearTimeout(e)},[b]),(0,r.useEffect)(()=>{var e;if(p||1!==i)return;let t=(0,Z.t)(O,3e5);(null==t?void 0:null===(e=t.data)||void 0===e?void 0:e.length)&&(n(t.data),o(t.total),x(t.last_page))},[p,i]);let J=(0,r.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=async()=>{let e=new URLSearchParams;e.set("page",i.toString()),e.set("limit","50"),p&&e.set("q",p);let t=await P.$.getAll(void 0,e);n(t.data),o(t.total),x(t.last_page),p||1!==i||(0,Z.v)(O,t)};if(e)try{await t()}catch(e){console.error("Silent refresh failed:",e)}else m(t,"กำลังโหลดข้อมูลโต๊ะ...")},[p,m,i]);(0,r.useEffect)(()=>{_&&J(!1)},[_,J]),(0,z.D)({socket:w,events:["tables:create","tables:update","tables:delete"],onRefresh:()=>J(!0),intervalMs:2e4,debounceMs:1e3});let M=()=>{v("กำลังเปิดหน้าจัดการโต๊ะ..."),e.push("/pos/tables/manager/add")},G=t=>{v("กำลังเปิดหน้าแก้ไขโต๊ะ..."),e.push("/pos/tables/manager/edit/".concat(t.id))},X=e=>{d.Z.confirm({title:"ยืนยันการลบโต๊ะ",content:'คุณต้องการลบโต๊ะ "'.concat(e.table_name,'" หรือไม่?'),okText:"ลบ",okType:"danger",cancelText:"ยกเลิก",centered:!0,onOk:async()=>{await m(async()=>{let t=await (0,I.P)();if(!(await fetch("/api/pos/tables/delete/".concat(e.id),{method:"DELETE",headers:{"X-CSRF-Token":t}})).ok)throw Error("ไม่สามารถลบโต๊ะได้");h.ZP.success('ลบโต๊ะ "'.concat(e.table_name,'" สำเร็จ'))},"กำลังลบโต๊ะ...")}})};if(L)return(0,a.jsxs)("div",{style:{display:"flex",height:"100vh",justifyContent:"center",alignItems:"center",flexDirection:"column",gap:16},children:[(0,a.jsx)(u.Z,{size:"large"}),(0,a.jsx)(D,{type:"secondary",children:"กำลังตรวจสอบสิทธิ์การใช้งาน..."})]});if(!_)return(0,a.jsxs)("div",{style:{display:"flex",height:"100vh",justifyContent:"center",alignItems:"center",flexDirection:"column",gap:16},children:[(0,a.jsx)(u.Z,{size:"large"}),(0,a.jsx)(D,{type:"danger",children:"คุณไม่มีสิทธิ์เข้าถึงหน้านี้ กำลังพากลับ..."})]});let q=t.filter(e=>e.is_active),Y=t.filter(e=>!e.is_active),$=t.filter(e=>e.status===k.c.Available),H=t.filter(e=>e.status===k.c.Unavailable);return(0,a.jsxs)("div",{className:"tables-page",style:A.container,children:[(0,a.jsx)("style",{children:N}),(0,a.jsx)(F,{onRefresh:J,onAdd:M,searchValue:b,onSearchChange:y}),(0,a.jsx)(B,{totalTables:t.length,availableTables:$.length,unavailableTables:H.length,activeTables:q.length,inactiveTables:Y.length}),(0,a.jsx)("div",{style:A.listContainer,children:t.length>0?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{style:A.sectionTitle,children:[(0,a.jsx)(g.Z,{style:{fontSize:18,color:"#722ed1"}}),(0,a.jsx)("span",{style:{fontSize:16,fontWeight:600,color:"#1a1a2e"},children:"รายการโต๊ะ"}),(0,a.jsxs)("div",{style:{background:"linear-gradient(135deg, #722ed1 0%, #531dab 100%)",color:"white",padding:"4px 12px",borderRadius:20,fontSize:12,fontWeight:600},children:[t.length," รายการ"]})]}),t.map((e,t)=>(0,a.jsx)(U,{table:e,index:t,onEdit:G,onDelete:X},e.id))]}):(0,a.jsx)(W,{onAdd:M})}),c>1&&(0,a.jsx)("div",{style:{display:"flex",justifyContent:"center",marginTop:16},children:(0,a.jsx)(f.Z,{current:i,pageSize:50,total:s,onChange:e=>l(e),size:"small"})})]})}},26972:function(e,t,n){"use strict";n.d(t,{J:function(){return l}});var a=n(2265),r=n(3369),i=n(53743);let l=()=>{let{showLoading:e,hideLoading:t}=(0,r.x)();return{execute:(0,a.useCallback)(async function(n){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"กำลังดำเนินการ...",r=(arguments.length>2&&arguments[2],arguments.length>3&&void 0!==arguments[3]?arguments[3]:"เกิดข้อผิดพลาด");try{return e(a,"async"),await n()}catch(e){console.error("Async action error:",e),i.Z.error({title:"ข้อผิดพลาด",content:e.message||r});return}finally{t("async")}},[e,t])}}},66290:function(e,t,n){"use strict";n.d(t,{$:function(){return l}});var a=n(2913);let r=n(71567).q.POS.TABLES,i=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"application/json",n={};return t&&(n["Content-Type"]=t),e&&(n.Cookie=e),n},l={getAll:async(e,t)=>{let n=(0,a.b)("GET",r),l=new URLSearchParams(t||"");l.has("page")||l.set("page","1"),l.has("limit")||l.set("limit","200");let s=l.toString();s&&(n+="?".concat(s));let o=i(e,""),c=await fetch(n,{cache:"no-store",headers:o,credentials:"include"});if(!c.ok){let e=await c.json().catch(()=>({}));throw Error(e.error||e.message||"Failed to fetch tables")}return c.json()},getById:async(e,t)=>{let n=(0,a.b)("GET","".concat(r,"/").concat(e)),l=i(t,""),s=await fetch(n,{cache:"no-store",headers:l,credentials:"include"});if(!s.ok){let e=await s.json().catch(()=>({}));throw Error(e.error||e.message||"Failed to fetch tables")}return s.json()},getByName:async(e,t)=>{let n=(0,a.b)("GET","".concat(r,"/getByName/").concat(e)),l=i(t,""),s=await fetch(n,{cache:"no-store",headers:l,credentials:"include"});if(!s.ok){let e=await s.json().catch(()=>({}));throw Error(e.error||e.message||"Failed to fetch tables")}return s.json()},create:async(e,t,n)=>{let l=(0,a.b)("POST","".concat(r)),s=i(t);n&&(s["X-CSRF-Token"]=n);let o=await fetch(l,{method:"POST",headers:s,credentials:"include",body:JSON.stringify(e)});if(!o.ok){let e=await o.json().catch(()=>({}));throw Error(e.error||e.message||"Failed to create table")}return o.json()},update:async(e,t,n,l)=>{let s=(0,a.b)("PUT","".concat(r,"/").concat(e)),o=i(n);l&&(o["X-CSRF-Token"]=l);let c=await fetch(s,{method:"PUT",headers:o,credentials:"include",body:JSON.stringify(t)});if(!c.ok){let e=await c.json().catch(()=>({}));throw Error(e.error||e.message||"Failed to update table")}return c.json()},delete:async(e,t,n)=>{let l=(0,a.b)("DELETE","".concat(r,"/").concat(e)),s=i(t,"");n&&(s["X-CSRF-Token"]=n);let o=await fetch(l,{method:"DELETE",headers:s,credentials:"include"});if(!o.ok){let e=await o.json().catch(()=>({}));throw Error(e.error||e.message||"Failed to delete table")}}}},69397:function(e,t,n){"use strict";n.d(t,{I:function(){return i},y:function(){return r}});let a={container:{paddingBottom:100,backgroundColor:"#f8f9fc",minHeight:"100vh"},header:{background:"linear-gradient(135deg, #722ed1 0%, #531dab 100%)",padding:"20px 20px 60px 20px",position:"relative",overflow:"hidden"},headerDecoCircle1:{position:"absolute",top:-50,right:-50,width:150,height:150,borderRadius:"50%",background:"rgba(255,255,255,0.1)"},headerDecoCircle2:{position:"absolute",bottom:-30,left:-30,width:100,height:100,borderRadius:"50%",background:"rgba(255,255,255,0.08)"},headerContent:{position:"relative",zIndex:1,display:"flex",alignItems:"center",justifyContent:"space-between"},headerLeft:{display:"flex",alignItems:"center",gap:12},headerIconBox:{width:48,height:48,borderRadius:14,background:"rgba(255,255,255,0.2)",display:"flex",alignItems:"center",justifyContent:"center",backdropFilter:"blur(8px)"},headerActions:{display:"flex",gap:8},statsCard:{margin:"-40px 16px 0 16px",padding:"16px",background:"white",borderRadius:20,boxShadow:"0 8px 24px rgba(0,0,0,0.08)",display:"flex",justifyContent:"space-around",position:"relative",zIndex:10},statItem:{textAlign:"center",flex:1},statNumber:{fontSize:24,fontWeight:700,display:"block"},statLabel:{fontSize:12,color:"#8c8c8c",marginTop:2},listContainer:{padding:"20px 16px 0 16px"},sectionTitle:{display:"flex",alignItems:"center",gap:8,marginBottom:16}},r=e=>({...a,header:{...a.header,background:e}}),i=(e,t)=>"\n    @keyframes fadeSlideIn {\n        from {\n            opacity: 0;\n            transform: translateY(12px);\n        }\n        to {\n            opacity: 1;\n            transform: translateY(0);\n        }\n    }\n    \n    ".concat(t," {\n        animation: fadeSlideIn 0.4s ease both;\n    }\n    \n    ").concat(t,":hover {\n        transform: translateY(-2px);\n        box-shadow: 0 8px 24px rgba(0,0,0,0.1) !important;\n    }\n    \n    ").concat(t,":active {\n        transform: scale(0.98);\n    }\n    \n    ").concat(e," *::-webkit-scrollbar {\n        width: 6px;\n    }\n    ").concat(e," *::-webkit-scrollbar-track {\n        background: transparent;\n    }\n    ").concat(e," *::-webkit-scrollbar-thumb {\n        background: #d9d9d9;\n        border-radius: 3px;\n    }\n    ").concat(e," *::-webkit-scrollbar-thumb:hover {\n        background: #bfbfbf;\n    }\n")},34962:function(e,t,n){"use strict";var a,r;n.d(t,{c:function(){return a}}),(r=a||(a={})).Available="Available",r.Unavailable="Unavailable"},3286:function(e,t,n){"use strict";n.d(t,{e:function(){return s}});var a=n(2265),r=n(34029),i=n(99376),l=n(14362);function s(){let{requiredRole:e="Admin",redirectUnauthenticated:t="/login",redirectUnauthorized:n="/pos",unauthorizedMessage:s="คุณไม่มีสิทธิ์เข้าถึงหน้านี้"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=(0,i.useRouter)(),{user:c,loading:d}=(0,l.a)(),h=(0,a.useMemo)(()=>d?"checking":c?e&&c.role!==e?"unauthorized":"authorized":"unauthenticated",[c,d,e]),u=(0,a.useRef)(!1);return(0,a.useEffect)(()=>{if("unauthenticated"===h){o.replace(t);return}"unauthorized"===h&&(u.current||(u.current=!0,r.ZP.error(s)),o.replace(n))},[h,o,t,n,s]),{status:h,isAuthorized:"authorized"===h,isChecking:"checking"===h,user:c}}},73814:function(e,t,n){"use strict";n.d(t,{t:function(){return r},v:function(){return i}});let a=()=>!0,r=(e,t)=>{if(!a())return null;try{var n;let a=window.localStorage.getItem(e);if(!a)return null;let r=JSON.parse(a);if(!(null==r?void 0:r.ts)||Date.now()-r.ts>t)return null;return null!==(n=r.data)&&void 0!==n?n:null}catch(e){return null}},i=(e,t)=>{if(a())try{let n={ts:Date.now(),data:t};window.localStorage.setItem(e,JSON.stringify(n))}catch(e){}}},97235:function(e,t,n){"use strict";n.d(t,{P:function(){return s}});var a=n(5447);let r=null,i=0,l=null;async function s(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=Date.now();return!e&&r&&t-i<6e5?r:(l||(l=a.O.getCsrfToken().then(e=>(r=e||"",i=Date.now(),r)).finally(()=>{l=null})),l)}}},function(e){e.O(0,[5015,7717,7698,742,3211,7993,8651,2646,6207,7213,9021,2224,3248,1721,9,5616,8589,5496,3834,8056,67,3490,2971,2117,1744],function(){return e(e.s=69642)}),_N_E=e.O()}]);