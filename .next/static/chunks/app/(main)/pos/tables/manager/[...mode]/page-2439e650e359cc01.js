(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4165],{94169:function(e,t,n){Promise.resolve().then(n.bind(n,43731))},26349:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var a=n(2265),r={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M360 184h-8c4.4 0 8-3.6 8-8v8h304v-8c0 4.4 3.6 8 8 8h-8v72h72v-80c0-35.3-28.7-64-64-64H352c-35.3 0-64 28.7-64 64v80h72v-72zm504 72H160c-17.7 0-32 14.3-32 32v32c0 4.4 3.6 8 8 8h60.4l24.7 523c1.6 34.1 29.8 61 63.9 61h454c34.2 0 62.3-26.8 63.9-61l24.7-523H888c4.4 0 8-3.6 8-8v-32c0-17.7-14.3-32-32-32zM731.3 840H292.7l-24.2-512h487l-24.2 512z"}}]},name:"delete",theme:"outlined"},l=n(55015);function s(){return(s=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}var o=a.forwardRef((e,t)=>a.createElement(l.Z,s({},e,{ref:t,icon:r})))},93132:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var a=n(2265),r={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M928 160H96c-17.7 0-32 14.3-32 32v640c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-40 208H676V232h212v136zm0 224H676V432h212v160zM412 432h200v160H412V432zm200-64H412V232h200v136zm-476 64h212v160H136V432zm0-200h212v136H136V232zm0 424h212v136H136V656zm276 0h200v136H412V656zm476 136H676V656h212v136z"}}]},name:"table",theme:"outlined"},l=n(55015);function s(){return(s=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}var o=a.forwardRef((e,t)=>a.createElement(l.Z,s({},e,{ref:t,icon:r})))},34029:function(e,t,n){"use strict";var a=n(19103),r=n(2265),l=n(51783),s=n(52402),o=n(71744),c=n(47213),i=n(32569),u=n(12224),d=n(55582);let f=null,h=e=>e(),m=[],g={};function v(){let{getContainer:e,duration:t,rtl:n,maxCount:a,top:r}=g,l=(null==e?void 0:e())||document.body;return{getContainer:()=>l,duration:t,rtl:n,maxCount:a,top:r}}let p=r.forwardRef((e,t)=>{let{messageConfig:n,sync:a}=e,{getPrefixCls:l}=(0,r.useContext)(o.E_),c=g.prefixCls||l("message"),i=(0,r.useContext)(s.J),[d,f]=(0,u.K)({...n,prefixCls:c,...i.message});return r.useImperativeHandle(t,()=>{let e={...d};return Object.keys(e).forEach(t=>{e[t]=function(){for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];return a(),d[t].apply(d,n)}}),{instance:e,sync:a}}),f}),b=r.forwardRef((e,t)=>{let[n,a]=r.useState(v),l=()=>{a(v)};r.useEffect(l,[]);let s=(0,c.w6)(),o=s.getRootPrefixCls(),i=s.getIconPrefixCls(),u=s.getTheme(),d=r.createElement(p,{ref:t,sync:l,messageConfig:n});return r.createElement(c.ZP,{prefixCls:o,iconPrefixCls:i,theme:u},s.holderRender?s.holderRender(d):d)}),y=()=>{if(!f){let e=document.createDocumentFragment(),t={fragment:e};f=t,h(()=>{(0,l.s)(r.createElement(b,{ref:e=>{let{instance:n,sync:a}=e||{};Promise.resolve().then(()=>{!t.instance&&n&&(t.instance=n,t.sync=a,y())})}}),e)});return}f.instance&&(m.forEach(e=>{let{type:t,skipped:n}=e;if(!n)switch(t){case"open":h(()=>{let t=f.instance.open({...g,...e.config});null==t||t.then(e.resolve),e.setCloseFn(t)});break;case"destroy":h(()=>{null==f||f.instance.destroy(e.key)});break;default:h(()=>{var n;let r=(n=f.instance)[t].apply(n,(0,a.Z)(e.args));null==r||r.then(e.resolve),e.setCloseFn(r)})}}),m=[])},x={open:function(e){let t=(0,d.J)(t=>{let n;let a={type:"open",config:e,resolve:t,setCloseFn:e=>{n=e}};return m.push(a),()=>{n?h(()=>{n()}):a.skipped=!0}});return y(),t},destroy:e=>{m.push({type:"destroy",key:e}),y()},config:function(e){g={...g,...e},h(()=>{var e;null==f||null===(e=f.sync)||void 0===e||e.call(f)})},useMessage:u.Z,_InternalPanelDoNotUseOrYouWillBeFired:i.ZP};["success","info","warning","error","loading"].forEach(e=>{x[e]=function(){for(var t=arguments.length,n=Array(t),a=0;a<t;a++)n[a]=arguments[a];return function(e,t){(0,c.w6)();let n=(0,d.J)(n=>{let a;let r={type:e,args:t,resolve:n,setCloseFn:e=>{a=e}};return m.push(r),()=>{a?h(()=>{a()}):r.skipped=!0}});return y(),n}(e,n)}}),t.ZP=x},53743:function(e,t,n){"use strict";n.d(t,{Z:function(){return y}});var a=n(42535),r=n(50815),l=n(74079),s=n(2265),o=n(28975),c=n(61994),i=n(93942),u=n(71744),d=n(64024),f=n(85695),h=n(90024),m=n(4065),g=(0,i.i)(e=>{let{prefixCls:t,className:n,closeIcon:a,closable:r,type:l,title:i,children:g,footer:v,...p}=e,{getPrefixCls:b}=s.useContext(u.E_),y=b(),x=t||b("modal"),j=(0,d.Z)(y),[w,E]=(0,m.ZP)(x,j),C="".concat(x,"-confirm"),Z={};return Z=l?{closable:null!=r&&r,title:"",footer:"",children:s.createElement(f.O,{...e,prefixCls:x,confirmPrefixCls:C,rootPrefixCls:y,content:g})}:{closable:null==r||r,title:i,footer:null!==v&&s.createElement(h.$,{...e}),children:g},s.createElement(o.s,{prefixCls:x,className:(0,c.W)(w,"".concat(x,"-pure-panel"),l&&C,l&&"".concat(C,"-").concat(l),n,E,j),...p,closeIcon:(0,h.b)(x,a),closable:r,...Z})}),v=n(23248);function p(e){return(0,a.ZP)((0,a.uW)(e))}let b=l.Z;b.useModal=v.Z,b.info=function(e){return(0,a.ZP)((0,a.cw)(e))},b.success=function(e){return(0,a.ZP)((0,a.vq)(e))},b.error=function(e){return(0,a.ZP)((0,a.AQ)(e))},b.warning=p,b.warn=p,b.confirm=function(e){return(0,a.ZP)((0,a.Au)(e))},b.destroyAll=function(){for(;r.Z.length;){let e=r.Z.pop();e&&e()}},b.config=a.ai,b._InternalPanelDoNotUseOrYouWillBeFired=g;var y=b},43731:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return S}});var a=n(57437),r=n(2265),l=n(44967),s=n(34029),o=n(53743),c=n(48651),i=n(88589),u=n(93834),d=n(80336),f=n(99376),h=n(34962),m=n(82646),g=n(80009),v=n(93132),p=n(72175);let{Text:b}=m.default,{pageStyles:y,ManagePageStyles:x}=(0,p.dg)({focusColor:"#722ed1",focusShadow:"rgba(114, 46, 209, 0.1)",switchGradient:"linear-gradient(135deg, #722ed1 0%, #531dab 100%)"}),j=e=>{let{isEdit:t,onBack:n,onDelete:r}=e;return(0,a.jsx)(p.oI,{pageStyles:y,isEdit:t,onBack:n,onDelete:r,titleCreate:"เพิ่มโต๊ะ",titleEdit:"แก้ไขโต๊ะ"})},w=e=>{let{name:t,status:n}=e,r="Available"===String(n);return(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:14,padding:16,background:"#fafafa",borderRadius:16,marginTop:12},children:[(0,a.jsx)("div",{style:{width:60,height:60,borderRadius:14,background:r?"linear-gradient(135deg, #f6ffed 0%, #d9f7be 100%)":"linear-gradient(135deg, #fff7e6 0%, #ffe7ba 100%)",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,border:"1px solid #f0f0f0"},children:(0,a.jsx)(v.Z,{style:{fontSize:24,color:r?"#52c41a":"#fa8c16"}})}),(0,a.jsxs)("div",{children:[(0,a.jsx)(b,{strong:!0,style:{display:"block",marginBottom:2},children:t||"ตัวอย่างโต๊ะ"}),(0,a.jsx)("div",{style:{display:"flex",gap:6},children:(0,a.jsx)(g.Z,{color:r?"success":"warning",style:{borderRadius:6,margin:0,fontSize:10},children:r?"ว่าง":"ไม่ว่าง"})})]})]})},E=e=>{let{isEdit:t,loading:n,onCancel:r}=e;return(0,a.jsx)(p.uM,{pageStyles:y,isEdit:t,loading:n,onCancel:r})};var C=n(97235),Z=n(3286),P=n(2938),k=n(66290);function S(e){let{params:t}=e,n=(0,f.useRouter)(),[m]=l.Z.useForm(),[g,v]=(0,r.useState)(!1),[p,b]=(0,r.useState)(!1),[S,O]=(0,r.useState)(""),[T,_]=(0,r.useState)(""),[F,z]=(0,r.useState)(""),H=t.mode[0],R=t.mode[1]||null,A="edit"===H&&!!R,{isAuthorized:I,isChecking:V}=(0,Z.e)({requiredRole:"Admin"});(0,r.useEffect)(()=>{(async()=>{z(await (0,C.P)())})()},[]);let N=(0,r.useCallback)(async()=>{v(!0);try{if(!R)return;let e=await k.$.getById(R);m.setFieldsValue({table_name:e.table_name,status:e.status,is_active:e.is_active}),O(e.table_name||""),_(e.status||"")}catch(e){console.error(e),s.ZP.error("ไม่สามารถดึงข้อมูลโต๊ะได้"),n.push("/pos/tables")}finally{v(!1)}},[R,m,n]);(0,r.useEffect)(()=>{A&&N()},[A,R,N]);let B=async e=>{b(!0);try{if(A){if(!R)throw Error("ID not found");await k.$.update(R,e,void 0,F),s.ZP.success("อัปเดตโต๊ะสำเร็จ")}else await k.$.create(e,void 0,F),s.ZP.success("สร้างโต๊ะสำเร็จ");n.push("/pos/tables")}catch(e){console.error(e),s.ZP.error(e.message||(A?"ไม่สามารถอัปเดตโต๊ะได้":"ไม่สามารถสร้างโต๊ะได้"))}finally{b(!1)}},U=()=>n.push("/pos/tables");return V?(0,a.jsx)(P.H,{message:"กำลังตรวจสอบสิทธิ์..."}):I?(0,a.jsxs)("div",{className:"manage-page",style:y.container,children:[(0,a.jsx)(x,{}),(0,a.jsx)(j,{isEdit:A,onBack:U,onDelete:A?()=>{R&&o.Z.confirm({title:"ยืนยันการลบโต๊ะ",content:'คุณต้องการลบโต๊ะ "'.concat(S,'" หรือไม่?'),okText:"ลบ",okType:"danger",cancelText:"ยกเลิก",centered:!0,onOk:async()=>{try{await k.$.delete(R,void 0,F),s.ZP.success("ลบโต๊ะสำเร็จ"),n.push("/pos/tables")}catch(e){console.error(e),s.ZP.error("ไม่สามารถลบโต๊ะได้")}}})}:void 0}),(0,a.jsx)("div",{className:"manage-form-card",style:y.formCard,children:g?(0,a.jsx)("div",{style:{display:"flex",justifyContent:"center",padding:"60px 0"},children:(0,a.jsx)(c.Z,{size:"large"})}):(0,a.jsxs)(l.Z,{form:m,layout:"vertical",onFinish:B,requiredMark:!1,autoComplete:"off",initialValues:{is_active:!0,status:h.c.Available},onValuesChange:e=>{void 0!==e.table_name&&O(e.table_name),void 0!==e.status&&_(e.status)},children:[(0,a.jsx)(l.Z.Item,{name:"table_name",label:"ชื่อโต๊ะ *",rules:[{required:!0,message:"กรุณากรอกชื่อโต๊ะ"},{max:50,message:"ความยาวต้องไม่เกิน 50 ตัวอักษร"}],children:(0,a.jsx)(i.default,{size:"large",placeholder:"เช่น T1, A10, VIP1",maxLength:50})}),(0,a.jsx)(l.Z.Item,{name:"status",label:"สถานะโต๊ะ *",rules:[{required:!0,message:"กรุณาเลือกสถานะโต๊ะ"}],children:(0,a.jsxs)(u.default,{size:"large",placeholder:"เลือกสถานะ",children:[(0,a.jsx)(u.default.Option,{value:h.c.Available,children:"ว่าง (Available)"}),(0,a.jsx)(u.default.Option,{value:h.c.Unavailable,children:"ไม่ว่าง (Unavailable)"})]})}),(0,a.jsx)(w,{name:S,status:T}),(0,a.jsx)(l.Z.Item,{name:"is_active",label:"สถานะการใช้งาน",valuePropName:"checked",style:{marginTop:20},children:(0,a.jsx)(d.Z,{checkedChildren:"เปิดใช้งาน",unCheckedChildren:"ปิดใช้งาน"})}),(0,a.jsx)(E,{isEdit:A,loading:p,onCancel:U})]})})]}):(0,a.jsx)(P.H,{message:"คุณไม่มีสิทธิ์เข้าถึงหน้านี้",tone:"danger"})}},66290:function(e,t,n){"use strict";n.d(t,{$:function(){return s}});var a=n(2913);let r=n(71567).q.POS.TABLES,l=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"application/json",n={};return t&&(n["Content-Type"]=t),e&&(n.Cookie=e),n},s={getAll:async(e,t)=>{let n=(0,a.b)("GET",r),s=new URLSearchParams(t||"");s.has("page")||s.set("page","1"),s.has("limit")||s.set("limit","200");let o=s.toString();o&&(n+="?".concat(o));let c=l(e,""),i=await fetch(n,{cache:"no-store",headers:c,credentials:"include"});if(!i.ok){let e=await i.json().catch(()=>({}));throw Error(e.error||e.message||"Failed to fetch tables")}return i.json()},getById:async(e,t)=>{let n=(0,a.b)("GET","".concat(r,"/").concat(e)),s=l(t,""),o=await fetch(n,{cache:"no-store",headers:s,credentials:"include"});if(!o.ok){let e=await o.json().catch(()=>({}));throw Error(e.error||e.message||"Failed to fetch tables")}return o.json()},getByName:async(e,t)=>{let n=(0,a.b)("GET","".concat(r,"/getByName/").concat(e)),s=l(t,""),o=await fetch(n,{cache:"no-store",headers:s,credentials:"include"});if(!o.ok){let e=await o.json().catch(()=>({}));throw Error(e.error||e.message||"Failed to fetch tables")}return o.json()},create:async(e,t,n)=>{let s=(0,a.b)("POST","".concat(r)),o=l(t);n&&(o["X-CSRF-Token"]=n);let c=await fetch(s,{method:"POST",headers:o,credentials:"include",body:JSON.stringify(e)});if(!c.ok){let e=await c.json().catch(()=>({}));throw Error(e.error||e.message||"Failed to create table")}return c.json()},update:async(e,t,n,s)=>{let o=(0,a.b)("PUT","".concat(r,"/").concat(e)),c=l(n);s&&(c["X-CSRF-Token"]=s);let i=await fetch(o,{method:"PUT",headers:c,credentials:"include",body:JSON.stringify(t)});if(!i.ok){let e=await i.json().catch(()=>({}));throw Error(e.error||e.message||"Failed to update table")}return i.json()},delete:async(e,t,n)=>{let s=(0,a.b)("DELETE","".concat(r,"/").concat(e)),o=l(t,"");n&&(o["X-CSRF-Token"]=n);let c=await fetch(s,{method:"DELETE",headers:o,credentials:"include"});if(!c.ok){let e=await c.json().catch(()=>({}));throw Error(e.error||e.message||"Failed to delete table")}}}},34962:function(e,t,n){"use strict";var a,r;n.d(t,{c:function(){return a}}),(r=a||(a={})).Available="Available",r.Unavailable="Unavailable"}},function(e){e.O(0,[5015,7717,7698,742,3211,7993,8651,2646,6207,7213,9021,2224,3248,9,5616,8589,5496,3834,4967,5775,4243,2971,2117,1744],function(){return e(e.s=94169)}),_N_E=e.O()}]);