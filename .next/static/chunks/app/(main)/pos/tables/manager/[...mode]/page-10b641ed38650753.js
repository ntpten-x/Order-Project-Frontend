(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4165],{94169:function(e,t,a){Promise.resolve().then(a.bind(a,73511))},73511:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return O}});var r=a(57437),n=a(2265),i=a(39486),s=a(80009),o=a(51653),l=a(19878),d=a(34029),c=a(53743),u=a(50742),g=a(48651),h=a(47451),p=a(69410),b=a(96931),x=a(88589),f=a(93834),m=a(80336),y=a(99376),v=a(25193),j=a(37410),w=a(20148),F=a(93132),k=a(8900),S=a(26349),C=a(88009),Z=a(15424),E=a(78355),_=a(29271),I=a(97235),B=a(67918),R=a(2938),A=a(85790),T=a(34962);let{Title:z,Text:P}=i.default,D=e=>{if(!e)return"-";let t=new Date(e);return Number.isNaN(t.getTime())?"-":new Intl.DateTimeFormat("th-TH",{dateStyle:"medium",timeStyle:"short"}).format(t)},L=e=>e===T.c.Available?"ว่าง":"ไม่ว่าง",N=e=>{let{tableName:t,status:a,isActive:n}=e,i=a===T.c.Available;return(0,r.jsxs)("div",{style:{background:"white",borderRadius:20,padding:20,boxShadow:"0 10px 30px rgba(0,0,0,0.05)",border:"1px solid #F1F5F9"},children:[(0,r.jsx)(z,{level:5,style:{color:"#7C3AED",marginBottom:16,fontWeight:700},children:"ตัวอย่างการแสดงผล"}),(0,r.jsxs)("div",{style:{borderRadius:16,border:"1px solid ".concat(n?"#ddd6fe":"#e2e8f0"),padding:14,background:n?"#f5f3ff":"#f8fafc",display:"flex",alignItems:"center",gap:12,marginBottom:16},children:[(0,r.jsx)("div",{style:{width:48,height:48,borderRadius:12,background:n?"linear-gradient(135deg, #ede9fe 0%, #ddd6fe 100%)":"#e2e8f0",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:(0,r.jsx)(F.Z,{style:{fontSize:20,color:n?"#7C3AED":"#64748b"}})}),(0,r.jsxs)("div",{style:{textAlign:"left",flex:1},children:[(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,r.jsx)(P,{strong:!0,style:{fontSize:16,color:"#0f172a"},children:t||"ชื่อโต๊ะ"}),n&&(0,r.jsx)(k.Z,{style:{color:"#10B981",fontSize:14}})]}),(0,r.jsx)(s.Z,{color:i?"green":"orange",style:{margin:"6px 0 0",borderRadius:6},children:L(a)})]})]}),(0,r.jsx)(o.Z,{type:n?"success":"warning",showIcon:!0,message:n?"โต๊ะนี้พร้อมใช้งานในระบบ POS":"โต๊ะนี้จะไม่แสดงให้เลือกใช้งาน"})]})};function O(e){var t,a;let{params:i}=e,s=(0,y.useRouter)(),[F]=l.Z.useForm(),[k,L]=(0,n.useState)(!1),[O,W]=(0,n.useState)(!1),[U,M]=(0,n.useState)(""),[H,V]=(0,n.useState)(T.c.Available),[q,X]=(0,n.useState)(!0),[Y,J]=(0,n.useState)(""),[$,G]=(0,n.useState)(null),[K,Q]=(0,n.useState)(""),ee=null===(t=i.mode)||void 0===t?void 0:t[0],et=(null===(a=i.mode)||void 0===a?void 0:a[1])||null,ea="add"===ee||"edit"===ee,er="edit"===ee&&!!et,{isAuthorized:en,isChecking:ei}=(0,B.e)({allowedRoles:["Admin","Manager"]}),es=(0,n.useMemo)(()=>er?"แก้ไขข้อมูลโต๊ะ":"เพิ่มโต๊ะ",[er]);(0,n.useEffect)(()=>{ea&&("edit"!==ee||et)||(d.ZP.warning("รูปแบบ URL ไม่ถูกต้อง"),s.replace("/pos/tables"))},[ea,ee,et,s]),(0,n.useEffect)(()=>{(async()=>{J(await (0,I.P)())})()},[]);let eo=(0,n.useCallback)(async()=>{if(et){L(!0);try{let e=await fetch("/api/pos/tables/getById/".concat(et));if(!e.ok)throw Error("ไม่สามารถดึงข้อมูลโต๊ะได้");let t=await e.json();F.setFieldsValue({table_name:t.table_name,status:t.status,is_active:t.is_active}),M(t.table_name||""),V(t.status||T.c.Available),X(!!t.is_active),Q((t.table_name||"").toLowerCase()),G(t)}catch(e){console.error(e),d.ZP.error("ไม่สามารถดึงข้อมูลโต๊ะได้"),s.replace("/pos/tables")}finally{L(!1)}}},[et,F,s]);(0,n.useEffect)(()=>{er&&eo()},[er,eo]);let el=(0,n.useCallback)(async e=>{let t=e.trim();if(!t||er&&t.toLowerCase()===K)return!1;try{let e=await fetch("/api/pos/tables/getByName/".concat(encodeURIComponent(t)));if(!e.ok)return!1;let a=await e.json();if(!(null==a?void 0:a.id)||er&&a.id===et)return!1;return!0}catch(e){return!1}},[K,et,er]),ed=async e=>{W(!0);try{let t={table_name:e.table_name.trim(),status:e.status,is_active:e.is_active},a=er?"/api/pos/tables/update/".concat(et):"/api/pos/tables/create",r=er?"PUT":"POST",n=await fetch(a,{method:r,headers:{"Content-Type":"application/json","X-CSRF-Token":Y},body:JSON.stringify(t)});if(!n.ok){let e=await n.json().catch(()=>({}));throw Error(e.error||e.message||(er?"ไม่สามารถอัปเดตโต๊ะได้":"ไม่สามารถสร้างโต๊ะได้"))}d.ZP.success(er?"อัปเดตโต๊ะสำเร็จ":"สร้างโต๊ะสำเร็จ"),s.push("/pos/tables")}catch(e){console.error(e),d.ZP.error(e instanceof Error?e.message:"ไม่สามารถบันทึกข้อมูลได้")}finally{W(!1)}},ec=()=>s.push("/pos/tables");return ei?(0,r.jsx)(R.H,{message:"กำลังตรวจสอบสิทธิ์..."}):en?(0,r.jsxs)("div",{className:"manage-page",style:A.R.container,children:[(0,r.jsx)(w.Z,{title:es,subtitle:er?"ปรับแก้ชื่อโต๊ะ สถานะโต๊ะ และสถานะการใช้งาน":"สร้างโต๊ะใหม่ให้พร้อมใช้งานในระบบ POS",onBack:ec,actions:er?(0,r.jsx)(u.ZP,{danger:!0,onClick:()=>{et&&c.Z.confirm({title:"ยืนยันการลบโต๊ะ",content:'คุณต้องการลบโต๊ะ "'.concat(U||"-",'" หรือไม่?'),okText:"ลบ",okType:"danger",cancelText:"ยกเลิก",centered:!0,icon:(0,r.jsx)(S.Z,{style:{color:"#EF4444"}}),onOk:async()=>{try{if(!(await fetch("/api/pos/tables/delete/".concat(et),{method:"DELETE",headers:{"X-CSRF-Token":Y}})).ok)throw Error("ไม่สามารถลบโต๊ะได้");d.ZP.success("ลบโต๊ะสำเร็จ"),s.push("/pos/tables")}catch(e){console.error(e),d.ZP.error("ไม่สามารถลบโต๊ะได้")}}})},icon:(0,r.jsx)(S.Z,{}),children:"ลบ"}):null}),(0,r.jsx)(v.Z,{maxWidth:1040,children:(0,r.jsx)(j.Z,{style:{background:"transparent",border:"none"},children:k?(0,r.jsx)("div",{style:{display:"flex",justifyContent:"center",padding:"90px 0"},children:(0,r.jsx)(g.Z,{size:"large",tip:"กำลังโหลดข้อมูล..."})}):(0,r.jsxs)(h.Z,{gutter:[20,20],children:[(0,r.jsx)(p.Z,{xs:24,lg:15,children:(0,r.jsxs)(b.Z,{bordered:!1,style:{borderRadius:20,boxShadow:"0 4px 20px rgba(0,0,0,0.04)",overflow:"hidden"},styles:{body:{padding:24}},children:[(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:10,marginBottom:20},children:[(0,r.jsx)(C.Z,{style:{fontSize:20,color:"#7C3AED"}}),(0,r.jsx)(z,{level:5,style:{margin:0},children:"ข้อมูลโต๊ะ"})]}),(0,r.jsxs)(l.Z,{form:F,layout:"vertical",onFinish:ed,requiredMark:!1,autoComplete:"off",initialValues:{is_active:!0,status:T.c.Available},onValuesChange:e=>{void 0!==e.table_name&&M(e.table_name),void 0!==e.status&&V(e.status),void 0!==e.is_active&&X(e.is_active)},children:[(0,r.jsx)(l.Z.Item,{name:"table_name",label:(0,r.jsx)("span",{style:{fontWeight:600,color:"#334155"},children:"ชื่อระบบ (table_name)"}),validateTrigger:["onBlur","onSubmit"],rules:[{required:!0,message:"กรุณากรอกชื่อระบบ"},{max:50,message:"ความยาวต้องไม่เกิน 50 ตัวอักษร"},{pattern:/^[a-zA-Z0-9\s\-_().]*$/,message:"กรอกได้เฉพาะภาษาอังกฤษ ตัวเลข และ - _ ( ) ."},{validator:async(e,t)=>{if((null==t?void 0:t.trim())&&await el(t))throw Error("ชื่อโต๊ะนี้ถูกใช้งานแล้ว")}}],children:(0,r.jsx)(x.default,{size:"large",placeholder:"เช่น T-01, VIP-01",style:{borderRadius:12,height:46,backgroundColor:"#F8FAFC",border:"1px solid #E2E8F0"},maxLength:50})}),(0,r.jsx)(l.Z.Item,{name:"status",label:(0,r.jsx)("span",{style:{fontWeight:600,color:"#334155"},children:"สถานะโต๊ะ"}),rules:[{required:!0,message:"กรุณาเลือกสถานะโต๊ะ"}],children:(0,r.jsx)(f.default,{size:"large",style:{borderRadius:12},options:[{value:T.c.Available,label:"ว่าง (Available)"},{value:T.c.Unavailable,label:"ไม่ว่าง (Unavailable)"}]})}),(0,r.jsx)("div",{style:{padding:"16px",background:"#F8FAFC",borderRadius:14,marginTop:16,marginBottom:18},children:(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:12},children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(P,{strong:!0,style:{fontSize:15,display:"block"},children:"สถานะการใช้งาน"}),(0,r.jsx)(P,{type:"secondary",style:{fontSize:13},children:"เปิดเพื่อให้แสดงโต๊ะนี้ในหน้า POS"})]}),(0,r.jsx)(l.Z.Item,{name:"is_active",valuePropName:"checked",noStyle:!0,children:(0,r.jsx)(m.Z,{style:{background:q?"#10B981":void 0}})})]})}),(0,r.jsx)(o.Z,{showIcon:!0,type:"info",icon:(0,r.jsx)(Z.Z,{}),message:"ข้อมูลที่จำเป็น",description:"ต้องกรอกชื่อโต๊ะ และกำหนดสถานะเริ่มต้นของโต๊ะ โดยชื่อโต๊ะจะถูกตรวจสอบไม่ให้ซ้ำในสาขาเดียวกัน",style:{marginBottom:24}}),(0,r.jsxs)("div",{style:{marginTop:12,display:"flex",gap:12},children:[(0,r.jsx)(u.ZP,{size:"large",onClick:ec,style:{flex:1,borderRadius:12,height:46,fontWeight:600},children:"ยกเลิก"}),(0,r.jsx)(u.ZP,{type:"primary",htmlType:"submit",loading:O,icon:(0,r.jsx)(E.Z,{}),style:{flex:2,borderRadius:12,height:46,fontWeight:600,background:"#7C3AED",boxShadow:"0 4px 12px rgba(124, 58, 237, 0.25)"},children:"บันทึกข้อมูล"})]})]})]})}),(0,r.jsx)(p.Z,{xs:24,lg:9,children:(0,r.jsxs)("div",{style:{display:"grid",gap:14},children:[(0,r.jsx)(N,{tableName:U,status:H,isActive:q}),er?(0,r.jsxs)(b.Z,{style:{borderRadius:16},children:[(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:10},children:[(0,r.jsx)(_.Z,{style:{color:"#0369a1"}}),(0,r.jsx)(P,{strong:!0,children:"รายละเอียดรายการ"})]}),(0,r.jsxs)("div",{style:{display:"grid",gap:8},children:[(0,r.jsxs)(P,{type:"secondary",children:["ID: ",(null==$?void 0:$.id)||"-"]}),(0,r.jsxs)(P,{type:"secondary",children:["สถานะออเดอร์ล่าสุด: ",(null==$?void 0:$.active_order_status)||"-"]}),(0,r.jsxs)(P,{type:"secondary",children:["สร้างเมื่อ: ",D(null==$?void 0:$.create_date)]}),(0,r.jsxs)(P,{type:"secondary",children:["อัปเดตเมื่อ: ",D(null==$?void 0:$.update_date)]})]})]}):null]})})]})})})]}):(0,r.jsx)(R.H,{message:"คุณไม่มีสิทธิ์เข้าถึงหน้านี้",tone:"danger"})}},69397:function(e,t,a){"use strict";a.d(t,{IU:function(){return l},YO:function(){return s},lv:function(){return o},yf:function(){return i}});let r={colors:{primary:"#6366F1",primaryLight:"#EEF2FF",success:"#10B981",successLight:"#ECFDF5",warning:"#F59E0B",warningLight:"#FFFBEB",error:"#EF4444",errorLight:"#FEF2F2",info:"#3B82F6",infoLight:"#EFF6FF",bg:"#F8FAFC",card:"#FFFFFF",border:"#E2E8F0",borderLight:"#F1F5F9",text:"#1E293B",textSecondary:"#64748B",textMuted:"#94A3B8"},radius:{sm:8,md:12,lg:16,xl:20},shadow:{sm:"0 1px 2px rgba(0, 0, 0, 0.04)",md:"0 4px 12px rgba(0, 0, 0, 0.06)",lg:"0 8px 24px rgba(0, 0, 0, 0.08)"}},n={container:{paddingBottom:100,backgroundColor:r.colors.bg,minHeight:"100dvh",width:"100%",overflowX:"hidden"},header:{background:"linear-gradient(135deg, ".concat(r.colors.primary," 0%, #4F46E5 100%)"),padding:"16px 16px 48px 16px",position:"relative",overflow:"hidden",borderBottomLeftRadius:r.radius.xl,borderBottomRightRadius:r.radius.xl},headerDecoCircle1:{position:"absolute",top:-40,right:-40,width:120,height:120,borderRadius:"50%",background:"rgba(255,255,255,0.08)"},headerDecoCircle2:{position:"absolute",bottom:-20,left:-20,width:80,height:80,borderRadius:"50%",background:"rgba(255,255,255,0.06)"},headerContent:{position:"relative",zIndex:1,display:"flex",alignItems:"center",justifyContent:"space-between",gap:12},headerLeft:{display:"flex",alignItems:"center",gap:12,flex:1},headerIconBox:{width:44,height:44,borderRadius:r.radius.md,background:"rgba(255,255,255,0.15)",display:"flex",alignItems:"center",justifyContent:"center",backdropFilter:"blur(8px)",flexShrink:0},headerTitle:{color:"#fff",margin:0,fontSize:18,fontWeight:600},headerSubtitle:{color:"rgba(255,255,255,0.8)",fontSize:13,margin:0},headerActions:{display:"flex",gap:8,flexShrink:0},statsCard:{margin:"-32px 16px 0 16px",padding:16,background:r.colors.card,borderRadius:r.radius.lg,boxShadow:r.shadow.md,display:"flex",justifyContent:"space-around",position:"relative",zIndex:10},statItem:{textAlign:"center",flex:1},statNumber:{fontSize:22,fontWeight:700,display:"block",color:r.colors.text},statLabel:{fontSize:12,color:r.colors.textMuted,marginTop:2},listContainer:{padding:"16px 16px 0 16px"},sectionTitle:{display:"flex",alignItems:"center",gap:8,marginBottom:12,fontSize:15,fontWeight:600,color:r.colors.text}},i=e=>({...n,header:{...n.header,background:e}}),s=e=>({marginBottom:12,borderRadius:r.radius.lg,border:"1px solid ".concat(e?r.colors.border:r.colors.borderLight),boxShadow:e?r.shadow.sm:"none",overflow:"hidden",transition:"all 0.2s ease",background:r.colors.card,opacity:e?1:.6}),o={padding:16,display:"flex",alignItems:"center",gap:12};r.radius.md;let l=(e,t)=>"\n  /* Card animations */\n  ".concat(t," {\n    animation: fadeSlideIn 0.3s ease both;\n  }\n  \n  ").concat(t,":hover {\n    transform: translateY(-2px);\n    box-shadow: ").concat(r.shadow.md," !important;\n  }\n  \n  ").concat(t,":active {\n    transform: scale(0.99);\n  }\n  \n  /* Scrollbar */\n  ").concat(e," *::-webkit-scrollbar {\n    width: 5px;\n    height: 5px;\n  }\n  ").concat(e," *::-webkit-scrollbar-track {\n    background: transparent;\n  }\n  ").concat(e," *::-webkit-scrollbar-thumb {\n    background: #CBD5E1;\n    border-radius: 3px;\n  }\n  ").concat(e," *::-webkit-scrollbar-thumb:hover {\n    background: #94A3B8;\n  }\n")},85790:function(e,t,a){"use strict";a.d(t,{R:function(){return n},W:function(){return i}});var r=a(69397);let n={...(0,r.yf)("linear-gradient(135deg, #7C3AED 0%, #6D28D9 100%)"),tableCard:r.YO,tableCardInner:r.lv},i=(0,r.IU)(".tables-page",".table-card")},34962:function(e,t,a){"use strict";var r,n;a.d(t,{c:function(){return r}}),(n=r||(r={})).Available="Available",n.Unavailable="Unavailable"}},function(e){e.O(0,[253,1522,3418,742,9486,4252,3916,8651,6931,4159,3831,2224,3248,9,8879,8589,4221,3834,9878,3832,2191,9385,4390,2971,2117,1744],function(){return e(e.s=94169)}),_N_E=e.O()}]);