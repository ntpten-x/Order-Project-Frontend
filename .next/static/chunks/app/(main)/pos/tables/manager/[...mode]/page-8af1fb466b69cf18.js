(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4165],{94169:function(e,t,s){Promise.resolve().then(s.bind(s,73511))},73511:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return W}});var a=s(57437),l=s(2265),i=s(60283),r=s(80009),n=s(61778),o=s(19878),d=s(34029),c=s(53743),u=s(50742),h=s(48651),x=s(47451),g=s(69410),p=s(96931),y=s(88589),f=s(93834),m=s(66487),b=s(99376),j=s(25193),v=s(37410),Z=s(20148),w=s(93132),_=s(8900),k=s(26349),S=s(88009),C=s(15424),E=s(78355),P=s(29271),R=s(97235),A=s(67918),F=s(2938),T=s(85790),I=s(34962);let{Title:B,Text:z}=i.default,N=e=>{if(!e)return"-";let t=new Date(e);return Number.isNaN(t.getTime())?"-":new Intl.DateTimeFormat("th-TH",{dateStyle:"medium",timeStyle:"short"}).format(t)},D=e=>e===I.c.Available?"ว่าง":"ไม่ว่าง",O=e=>{let{tableName:t,status:s,isActive:l}=e,i=s===I.c.Available;return(0,a.jsxs)("div",{style:{background:"white",borderRadius:20,padding:20,boxShadow:"0 10px 30px rgba(0,0,0,0.05)",border:"1px solid #F1F5F9"},children:[(0,a.jsx)(B,{level:5,style:{color:"#7C3AED",marginBottom:16,fontWeight:700},children:"ตัวอย่างการแสดงผล"}),(0,a.jsxs)("div",{style:{borderRadius:16,border:"1px solid ".concat(l?"#ddd6fe":"#e2e8f0"),padding:14,background:l?"#f5f3ff":"#f8fafc",display:"flex",alignItems:"center",gap:12,marginBottom:16},children:[(0,a.jsx)("div",{style:{width:48,height:48,borderRadius:12,background:l?"linear-gradient(135deg, #ede9fe 0%, #ddd6fe 100%)":"#e2e8f0",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:(0,a.jsx)(w.Z,{style:{fontSize:20,color:l?"#7C3AED":"#64748b"}})}),(0,a.jsxs)("div",{style:{textAlign:"left",flex:1},children:[(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,a.jsx)(z,{strong:!0,style:{fontSize:16,color:"#0f172a"},children:t||"ชื่อโต๊ะ"}),l&&(0,a.jsx)(_.Z,{style:{color:"#10B981",fontSize:14}})]}),(0,a.jsx)(r.Z,{color:i?"green":"orange",style:{margin:"6px 0 0",borderRadius:6},children:D(s)})]})]}),(0,a.jsx)(n.Z,{type:l?"success":"warning",showIcon:!0,message:l?"โต๊ะนี้พร้อมใช้งานในระบบ POS":"โต๊ะนี้จะไม่แสดงให้เลือกใช้งาน"})]})};function W(e){var t,s;let{params:i}=e,r=(0,b.useRouter)(),[w]=o.Z.useForm(),[_,D]=(0,l.useState)(!1),[W,L]=(0,l.useState)(!1),[U,V]=(0,l.useState)(""),[q,H]=(0,l.useState)(I.c.Available),[M,X]=(0,l.useState)(!0),[J,$]=(0,l.useState)(""),[G,K]=(0,l.useState)(null),[Q,Y]=(0,l.useState)(""),ee=null===(t=i.mode)||void 0===t?void 0:t[0],et=(null===(s=i.mode)||void 0===s?void 0:s[1])||null,es="add"===ee||"edit"===ee,ea="edit"===ee&&!!et,{isAuthorized:el,isChecking:ei}=(0,A.e)({allowedRoles:["Admin","Manager"]}),er=(0,l.useMemo)(()=>ea?"แก้ไขข้อมูลโต๊ะ":"เพิ่มโต๊ะ",[ea]);(0,l.useEffect)(()=>{es&&("edit"!==ee||et)||(d.ZP.warning("รูปแบบ URL ไม่ถูกต้อง"),r.replace("/pos/tables"))},[es,ee,et,r]),(0,l.useEffect)(()=>{(async()=>{$(await (0,R.P)())})()},[]);let en=(0,l.useCallback)(async()=>{if(et){D(!0);try{let e=await fetch("/api/pos/tables/getById/".concat(et));if(!e.ok)throw Error("ไม่สามารถดึงข้อมูลโต๊ะได้");let t=await e.json();w.setFieldsValue({table_name:t.table_name,status:t.status,is_active:t.is_active}),V(t.table_name||""),H(t.status||I.c.Available),X(!!t.is_active),Y((t.table_name||"").toLowerCase()),K(t)}catch(e){console.error(e),d.ZP.error("ไม่สามารถดึงข้อมูลโต๊ะได้"),r.replace("/pos/tables")}finally{D(!1)}}},[et,w,r]);(0,l.useEffect)(()=>{ea&&en()},[ea,en]);let eo=(0,l.useCallback)(async e=>{let t=e.trim();if(!t||ea&&t.toLowerCase()===Q)return!1;try{let e=await fetch("/api/pos/tables/getByName/".concat(encodeURIComponent(t)));if(!e.ok)return!1;let s=await e.json();if(!(null==s?void 0:s.id)||ea&&s.id===et)return!1;return!0}catch(e){return!1}},[Q,et,ea]),ed=async e=>{L(!0);try{let t={table_name:e.table_name.trim(),status:e.status,is_active:e.is_active},s=ea?"/api/pos/tables/update/".concat(et):"/api/pos/tables/create",a=ea?"PUT":"POST",l=await fetch(s,{method:a,headers:{"Content-Type":"application/json","X-CSRF-Token":J},body:JSON.stringify(t)});if(!l.ok){let e=await l.json().catch(()=>({}));throw Error(e.error||e.message||(ea?"ไม่สามารถอัปเดตโต๊ะได้":"ไม่สามารถสร้างโต๊ะได้"))}d.ZP.success(ea?"อัปเดตโต๊ะสำเร็จ":"สร้างโต๊ะสำเร็จ"),r.push("/pos/tables")}catch(e){console.error(e),d.ZP.error(e instanceof Error?e.message:"ไม่สามารถบันทึกข้อมูลได้")}finally{L(!1)}},ec=()=>r.push("/pos/tables");return ei?(0,a.jsx)(F.H,{message:"กำลังตรวจสอบสิทธิ์..."}):el?(0,a.jsxs)("div",{className:"manage-page",style:T.R.container,children:[(0,a.jsx)(Z.Z,{title:er,subtitle:ea?"ปรับแก้ชื่อโต๊ะ สถานะโต๊ะ และสถานะการใช้งาน":"สร้างโต๊ะใหม่ให้พร้อมใช้งานในระบบ POS",onBack:ec,actions:ea?(0,a.jsx)(u.ZP,{danger:!0,onClick:()=>{et&&c.Z.confirm({title:"ยืนยันการลบโต๊ะ",content:'คุณต้องการลบโต๊ะ "'.concat(U||"-",'" หรือไม่?'),okText:"ลบ",okType:"danger",cancelText:"ยกเลิก",centered:!0,icon:(0,a.jsx)(k.Z,{style:{color:"#EF4444"}}),onOk:async()=>{try{if(!(await fetch("/api/pos/tables/delete/".concat(et),{method:"DELETE",headers:{"X-CSRF-Token":J}})).ok)throw Error("ไม่สามารถลบโต๊ะได้");d.ZP.success("ลบโต๊ะสำเร็จ"),r.push("/pos/tables")}catch(e){console.error(e),d.ZP.error("ไม่สามารถลบโต๊ะได้")}}})},icon:(0,a.jsx)(k.Z,{}),children:"ลบ"}):null}),(0,a.jsx)(j.Z,{maxWidth:1040,children:(0,a.jsx)(v.Z,{style:{background:"transparent",border:"none"},children:_?(0,a.jsx)("div",{style:{display:"flex",justifyContent:"center",padding:"90px 0"},children:(0,a.jsx)(h.Z,{size:"large",tip:"กำลังโหลดข้อมูล..."})}):(0,a.jsxs)(x.Z,{gutter:[20,20],children:[(0,a.jsx)(g.Z,{xs:24,lg:15,children:(0,a.jsxs)(p.Z,{bordered:!1,style:{borderRadius:20,boxShadow:"0 4px 20px rgba(0,0,0,0.04)",overflow:"hidden"},styles:{body:{padding:24}},children:[(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:10,marginBottom:20},children:[(0,a.jsx)(S.Z,{style:{fontSize:20,color:"#7C3AED"}}),(0,a.jsx)(B,{level:5,style:{margin:0},children:"ข้อมูลโต๊ะ"})]}),(0,a.jsxs)(o.Z,{form:w,layout:"vertical",onFinish:ed,requiredMark:!1,autoComplete:"off",initialValues:{is_active:!0,status:I.c.Available},onValuesChange:e=>{void 0!==e.table_name&&V(e.table_name),void 0!==e.status&&H(e.status),void 0!==e.is_active&&X(e.is_active)},children:[(0,a.jsx)(o.Z.Item,{name:"table_name",label:(0,a.jsx)("span",{style:{fontWeight:600,color:"#334155"},children:"ชื่อระบบ (table_name)"}),validateTrigger:["onBlur","onSubmit"],rules:[{required:!0,message:"กรุณากรอกชื่อระบบ"},{max:50,message:"ความยาวต้องไม่เกิน 50 ตัวอักษร"},{pattern:/^[a-zA-Z0-9\s\-_().]*$/,message:"กรอกได้เฉพาะภาษาอังกฤษ ตัวเลข และ - _ ( ) ."},{validator:async(e,t)=>{if((null==t?void 0:t.trim())&&await eo(t))throw Error("ชื่อโต๊ะนี้ถูกใช้งานแล้ว")}}],children:(0,a.jsx)(y.default,{size:"large",placeholder:"เช่น T-01, VIP-01",style:{borderRadius:12,height:46,backgroundColor:"#F8FAFC",border:"1px solid #E2E8F0"},maxLength:50})}),(0,a.jsx)(o.Z.Item,{name:"status",label:(0,a.jsx)("span",{style:{fontWeight:600,color:"#334155"},children:"สถานะโต๊ะ"}),rules:[{required:!0,message:"กรุณาเลือกสถานะโต๊ะ"}],children:(0,a.jsx)(f.default,{size:"large",style:{borderRadius:12},options:[{value:I.c.Available,label:"ว่าง (Available)"},{value:I.c.Unavailable,label:"ไม่ว่าง (Unavailable)"}]})}),(0,a.jsx)("div",{style:{padding:"16px",background:"#F8FAFC",borderRadius:14,marginTop:16,marginBottom:18},children:(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:12},children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(z,{strong:!0,style:{fontSize:15,display:"block"},children:"สถานะการใช้งาน"}),(0,a.jsx)(z,{type:"secondary",style:{fontSize:13},children:"เปิดเพื่อให้แสดงโต๊ะนี้ในหน้า POS"})]}),(0,a.jsx)(o.Z.Item,{name:"is_active",valuePropName:"checked",noStyle:!0,children:(0,a.jsx)(m.Z,{style:{background:M?"#10B981":void 0}})})]})}),(0,a.jsx)(n.Z,{showIcon:!0,type:"info",icon:(0,a.jsx)(C.Z,{}),message:"ข้อมูลที่จำเป็น",description:"ต้องกรอกชื่อโต๊ะ และกำหนดสถานะเริ่มต้นของโต๊ะ โดยชื่อโต๊ะจะถูกตรวจสอบไม่ให้ซ้ำในสาขาเดียวกัน",style:{marginBottom:24}}),(0,a.jsxs)("div",{style:{marginTop:12,display:"flex",gap:12},children:[(0,a.jsx)(u.ZP,{size:"large",onClick:ec,style:{flex:1,borderRadius:12,height:46,fontWeight:600},children:"ยกเลิก"}),(0,a.jsx)(u.ZP,{type:"primary",htmlType:"submit",loading:W,icon:(0,a.jsx)(E.Z,{}),style:{flex:2,borderRadius:12,height:46,fontWeight:600,background:"#7C3AED",boxShadow:"0 4px 12px rgba(124, 58, 237, 0.25)"},children:"บันทึกข้อมูล"})]})]})]})}),(0,a.jsx)(g.Z,{xs:24,lg:9,children:(0,a.jsxs)("div",{style:{display:"grid",gap:14},children:[(0,a.jsx)(O,{tableName:U,status:q,isActive:M}),ea?(0,a.jsxs)(p.Z,{style:{borderRadius:16},children:[(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:10},children:[(0,a.jsx)(P.Z,{style:{color:"#0369a1"}}),(0,a.jsx)(z,{strong:!0,children:"รายละเอียดรายการ"})]}),(0,a.jsxs)("div",{style:{display:"grid",gap:8},children:[(0,a.jsxs)(z,{type:"secondary",children:["ID: ",(null==G?void 0:G.id)||"-"]}),(0,a.jsxs)(z,{type:"secondary",children:["สถานะออเดอร์ล่าสุด: ",(null==G?void 0:G.active_order_status)||"-"]}),(0,a.jsxs)(z,{type:"secondary",children:["สร้างเมื่อ: ",N(null==G?void 0:G.create_date)]}),(0,a.jsxs)(z,{type:"secondary",children:["อัปเดตเมื่อ: ",N(null==G?void 0:G.update_date)]})]})]}):null]})})]})})})]}):(0,a.jsx)(F.H,{message:"คุณไม่มีสิทธิ์เข้าถึงหน้านี้",tone:"danger"})}}},function(e){e.O(0,[8024,4736,8592,1744],function(){return e(e.s=94169)}),_N_E=e.O()}]);