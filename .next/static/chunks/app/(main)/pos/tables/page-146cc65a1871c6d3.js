(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9799],{69642:function(e,t,l){Promise.resolve().then(l.bind(l,97955))},97955:function(e,t,l){"use strict";l.r(t),l.d(t,{default:function(){return U}});var a=l(57437),i=l(2265),s=l(60283),n=l(80009),r=l(66487),o=l(50742),c=l(53743),d=l(34029),h=l(24783),f=l(88589),u=l(24738),x=l(93132),g=l(8900),p=l(13377),b=l(26349),y=l(89245),j=l(96473),v=l(29436),m=l(34962),k=l(99376),Z=l(3369),w=l(26972),C=l(24675),S=l(97235),_=l(67918),E=l(67697),A=l(73814),z=l(85790),P=l(2938),T=l(25193),R=l(37410),N=l(27623),W=l(20148),I=l(2786),D=l(12028);let{Text:F}=s.default,L=e=>{let t=new Date(e);return Number.isNaN(t.getTime())?"-":new Intl.DateTimeFormat("th-TH",{dateStyle:"medium",timeStyle:"short"}).format(t)},O=e=>e===m.c.Available?"ว่าง":"ไม่ว่าง",B=e=>{let{total:t,active:l,inactive:i,available:s,unavailable:n}=e;return(0,a.jsxs)("div",{style:{background:"#fff",borderRadius:16,border:"1px solid #e2e8f0",display:"grid",gridTemplateColumns:"repeat(5, minmax(0, 1fr))",gap:8,padding:14},children:[(0,a.jsxs)("div",{style:{textAlign:"center"},children:[(0,a.jsx)("span",{style:{fontSize:24,fontWeight:700,color:"#0f172a",display:"block"},children:t}),(0,a.jsx)(F,{style:{fontSize:12,color:"#64748b"},children:"ทั้งหมด"})]}),(0,a.jsxs)("div",{style:{textAlign:"center"},children:[(0,a.jsx)("span",{style:{fontSize:24,fontWeight:700,color:"#7C3AED",display:"block"},children:l}),(0,a.jsx)(F,{style:{fontSize:12,color:"#64748b"},children:"ใช้งาน"})]}),(0,a.jsxs)("div",{style:{textAlign:"center"},children:[(0,a.jsx)("span",{style:{fontSize:24,fontWeight:700,color:"#b91c1c",display:"block"},children:i}),(0,a.jsx)(F,{style:{fontSize:12,color:"#64748b"},children:"ปิดใช้งาน"})]}),(0,a.jsxs)("div",{style:{textAlign:"center"},children:[(0,a.jsx)("span",{style:{fontSize:24,fontWeight:700,color:"#059669",display:"block"},children:s}),(0,a.jsx)(F,{style:{fontSize:12,color:"#64748b"},children:"สถานะว่าง"})]}),(0,a.jsxs)("div",{style:{textAlign:"center"},children:[(0,a.jsx)("span",{style:{fontSize:24,fontWeight:700,color:"#d97706",display:"block"},children:n}),(0,a.jsx)(F,{style:{fontSize:12,color:"#64748b"},children:"สถานะไม่ว่าง"})]})]})},H=e=>{let{table:t,onEdit:l,onDelete:i,onToggleActive:s,updatingStatusId:c}=e,d=t.status===m.c.Available;return(0,a.jsx)("div",{className:"table-card",style:{...z.R.tableCard(t.is_active),borderRadius:16},onClick:()=>l(t),children:(0,a.jsxs)("div",{style:z.R.tableCardInner,children:[(0,a.jsx)("div",{style:{width:52,height:52,borderRadius:14,background:d?"linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%)":"linear-gradient(135deg, #fef3c7 0%, #fde68a 100%)",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,boxShadow:d?"0 4px 10px rgba(5, 150, 105, 0.18)":"0 4px 10px rgba(217, 119, 6, 0.18)"},children:(0,a.jsx)(x.Z,{style:{fontSize:22,color:d?"#059669":"#b45309"}})}),(0,a.jsxs)("div",{style:{flex:1,minWidth:0,paddingRight:8},children:[(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4},children:[(0,a.jsx)(F,{strong:!0,style:{fontSize:16,color:"#0f172a"},ellipsis:{tooltip:t.table_name},children:t.table_name}),t.is_active&&(0,a.jsx)(g.Z,{style:{color:"#10B981",fontSize:14}}),(0,a.jsx)(n.Z,{color:t.is_active?"green":"default",children:t.is_active?"ใช้งาน":"ปิดใช้งาน"})]}),(0,a.jsx)(n.Z,{color:d?"green":"orange",style:{margin:0,borderRadius:6},children:O(t.status)}),(0,a.jsxs)(F,{type:"secondary",style:{fontSize:12,display:"block",marginTop:6},children:["อัปเดตล่าสุด ",L(t.update_date)]})]}),(0,a.jsxs)("div",{style:{display:"flex",gap:6,alignItems:"center"},children:[(0,a.jsx)(r.Z,{size:"small",checked:t.is_active,loading:c===t.id,onClick:(e,l)=>{null==l||l.stopPropagation(),s(t,e)}}),(0,a.jsx)(o.ZP,{type:"text",icon:(0,a.jsx)(p.Z,{}),onClick:e=>{e.stopPropagation(),l(t)},style:{borderRadius:10,color:"#7C3AED",background:"#f5f3ff",width:36,height:36}}),(0,a.jsx)(o.ZP,{type:"text",danger:!0,icon:(0,a.jsx)(b.Z,{}),onClick:e=>{e.stopPropagation(),i(t)},style:{borderRadius:10,background:"#fef2f2",width:36,height:36}})]})]})})};function U(){let e=(0,k.useRouter)(),[t,l]=(0,i.useState)([]),[s,n]=(0,i.useState)(""),[r,g]=(0,i.useState)("all"),[p,F]=(0,i.useState)("all"),[L,O]=(0,i.useState)(null),{execute:U}=(0,w.J)(),{showLoading:J}=(0,Z.x)(),{socket:M}=(0,C.s)(),{isAuthorized:X,isChecking:q}=(0,_.e)({allowedRoles:["Admin","Manager"]});(0,i.useEffect)(()=>{(0,S.P)()},[]),(0,i.useEffect)(()=>{let e=(0,A.t)("pos:tables",3e5);e&&e.length>0&&l(e)},[]);let G=(0,i.useCallback)(async()=>{U(async()=>{let e=await fetch("/api/pos/tables?limit=200");if(!e.ok){let t=await e.json().catch(()=>({}));throw Error(t.error||t.message||"ไม่สามารถดึงข้อมูลโต๊ะได้")}let t=await e.json(),a=Array.isArray(t)?t:null==t?void 0:t.data;if(!Array.isArray(a))throw Error("รูปแบบข้อมูลไม่ถูกต้อง");l(a)},"กำลังโหลดข้อมูลโต๊ะ...")},[U]);(0,i.useEffect)(()=>{X&&G()},[X,G]),(0,E.v)(M,{create:D.b.tables.create,update:D.b.tables.update,delete:D.b.tables.delete},l),(0,i.useEffect)(()=>{t.length>0&&(0,A.v)("pos:tables",t)},[t]);let K=(0,i.useMemo)(()=>{let e=t;"active"===r?e=e.filter(e=>e.is_active):"inactive"===r&&(e=e.filter(e=>!e.is_active)),"all"!==p&&(e=e.filter(e=>e.status===p));let l=s.trim().toLowerCase();return l&&(e=e.filter(e=>e.table_name.toLowerCase().includes(l)||(e.active_order_status||"").toLowerCase().includes(l))),e},[t,s,r,p]),Q=()=>{J("กำลังเปิดหน้าจัดการโต๊ะ..."),e.push("/pos/tables/manager/add")},V=t=>{J("กำลังเปิดหน้าแก้ไขโต๊ะ..."),e.push("/pos/tables/manager/edit/".concat(t.id))},Y=e=>{c.Z.confirm({title:"ยืนยันการลบโต๊ะ",content:'คุณต้องการลบโต๊ะ "'.concat(e.table_name,'" หรือไม่?'),okText:"ลบ",okType:"danger",cancelText:"ยกเลิก",centered:!0,icon:(0,a.jsx)(b.Z,{style:{color:"#EF4444"}}),onOk:async()=>{await U(async()=>{let t=await (0,S.P)();if(!(await fetch("/api/pos/tables/delete/".concat(e.id),{method:"DELETE",headers:{"X-CSRF-Token":t}})).ok)throw Error("ไม่สามารถลบโต๊ะได้");l(t=>t.filter(t=>t.id!==e.id)),d.ZP.success('ลบโต๊ะ "'.concat(e.table_name,'" สำเร็จ'))},"กำลังลบโต๊ะ...")}})},$=async(e,t)=>{O(e.id);try{let a=await (0,S.P)(),i=await fetch("/api/pos/tables/update/".concat(e.id),{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-Token":a},body:JSON.stringify({is_active:t})});if(!i.ok){let e=await i.json().catch(()=>({}));throw Error(e.error||e.message||"ไม่สามารถเปลี่ยนสถานะโต๊ะได้")}let s=await i.json();l(t=>t.map(t=>t.id===e.id?s:t)),d.ZP.success(t?"เปิดใช้งานโต๊ะแล้ว":"ปิดใช้งานโต๊ะแล้ว")}catch(e){console.error(e),d.ZP.error(e instanceof Error?e.message:"ไม่สามารถเปลี่ยนสถานะโต๊ะได้")}finally{O(null)}};if(q)return(0,a.jsx)(P.H,{message:"กำลังตรวจสอบสิทธิ์การใช้งาน..."});if(!X)return(0,a.jsx)(P.H,{message:"คุณไม่มีสิทธิ์เข้าถึงหน้านี้ กำลังพากลับ...",tone:"danger"});let ee=t.filter(e=>e.is_active).length,et=t.filter(e=>!e.is_active).length,el=t.filter(e=>e.status===m.c.Available).length,ea=t.filter(e=>e.status===m.c.Unavailable).length;return(0,a.jsxs)("div",{className:"tables-page",style:z.R.container,children:[(0,a.jsx)("style",{children:z.W}),(0,a.jsx)(W.Z,{title:"โต๊ะ",subtitle:"ทั้งหมด ".concat(t.length," รายการ"),icon:(0,a.jsx)(x.Z,{}),actions:(0,a.jsxs)(h.Z,{size:8,wrap:!0,children:[(0,a.jsx)(o.ZP,{icon:(0,a.jsx)(y.Z,{}),onClick:G}),(0,a.jsx)(o.ZP,{type:"primary",icon:(0,a.jsx)(j.Z,{}),onClick:Q,children:"เพิ่มโต๊ะ"})]})}),(0,a.jsx)(T.Z,{children:(0,a.jsxs)(N.Z,{children:[(0,a.jsx)(B,{total:t.length,active:ee,inactive:et,available:el,unavailable:ea}),(0,a.jsx)(R.Z,{title:"ค้นหาและตัวกรอง",children:(0,a.jsxs)("div",{style:{display:"grid",gap:10,gridTemplateColumns:"1fr",alignItems:"center"},children:[(0,a.jsx)(f.default,{prefix:(0,a.jsx)(v.Z,{style:{color:"#94A3B8"}}),allowClear:!0,placeholder:"ค้นหาจากชื่อโต๊ะหรือสถานะออเดอร์...",value:s,onChange:e=>n(e.target.value)}),(0,a.jsx)(u.Z,{options:[{label:"ทั้งหมด (".concat(t.length,")"),value:"all"},{label:"ใช้งาน (".concat(ee,")"),value:"active"},{label:"ปิดใช้งาน (".concat(et,")"),value:"inactive"}],value:r,onChange:e=>g(e)}),(0,a.jsx)(u.Z,{options:[{label:"ทุกสถานะ (".concat(t.length,")"),value:"all"},{label:"ว่าง (".concat(el,")"),value:m.c.Available},{label:"ไม่ว่าง (".concat(ea,")"),value:m.c.Unavailable}],value:p,onChange:e=>F(e)})]})}),(0,a.jsx)(R.Z,{title:"รายการโต๊ะ",extra:(0,a.jsx)("span",{style:{fontWeight:600},children:K.length}),children:K.length>0?K.map(e=>(0,a.jsx)(H,{table:e,onEdit:V,onDelete:Y,onToggleActive:$,updatingStatusId:L},e.id)):(0,a.jsx)(I.Z,{title:s.trim()?"ไม่พบโต๊ะตามคำค้น":"ยังไม่มีโต๊ะในระบบ",description:s.trim()?"ลองเปลี่ยนคำค้น หรือตัวกรองสถานะ":"เพิ่มโต๊ะแรกเพื่อเริ่มใช้งาน",action:s.trim()?null:(0,a.jsx)(o.ZP,{type:"primary",icon:(0,a.jsx)(j.Z,{}),onClick:Q,children:"เพิ่มโต๊ะ"})})})]})})]})}}},function(e){e.O(0,[8024,4736,8592,1744],function(){return e(e.s=69642)}),_N_E=e.O()}]);