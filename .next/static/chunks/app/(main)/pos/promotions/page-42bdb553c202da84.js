(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6651],{95963:function(e,t,i){Promise.resolve().then(i.bind(i,53541))},53541:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return D}});var s=i(57437),n=i(2265),o=i(19683),r=i(24783),l=i(88589),d=i(50742),a=i(96931),c=i(35713),p=i(85180),x=i(80009),u=i(2261),h=i(89245),m=i(96473),y=i(8900),g=i(39725),f=i(13377),j=i(49634),v=i(99376),Z=i(29827),b=i(11713),w=i(21770),_=i(46252),S=i(39988),C=i(34029),P=i(61980),k=i(3286),z=i(2938),q=i(12093),B=i(71096),Y=i.n(B);i(6729);let{Text:A,Title:T}=o.default;Y().locale("th");let R={[P.q.BuyXGetY]:"ซื้อ X แถม Y",[P.q.PercentageOff]:"ลดเปอร์เซ็นต์",[P.q.FixedAmountOff]:"ลดจำนวนเงิน",[P.q.FreeShipping]:"ฟรีค่าจัดส่ง",[P.q.Bundle]:"ชุดโปรโมชัน",[P.q.MinimumPurchase]:"ซื้อขั้นต่ำ"};function D(){let e=(0,v.useRouter)(),[t,i]=(0,n.useState)(""),o=(0,q.c)(t.trim(),400),{promotions:P,isLoading:B,refetch:D}=function(){let{socket:e}=(0,n.useContext)(_.J),t=(0,Z.NL)(),{data:i=[],isLoading:s,refetch:o}=(0,b.a)({queryKey:["promotions","active"],queryFn:async()=>await S.promotionsService.getActivePromotions(),staleTime:3e5});(0,n.useEffect)(()=>{if(!e)return;let i=()=>{t.invalidateQueries({queryKey:["promotions"]})};return e.on("promotions:updated",i),()=>{e.off("promotions:updated",i)}},[e,t]);let r=(0,w.D)({mutationFn:e=>S.promotionsService.validatePromotion(e)}),l=(0,w.D)({mutationFn:e=>S.promotionsService.applyPromotion(e),onSuccess:()=>{t.invalidateQueries({queryKey:["promotions"]}),C.ZP.success("ใช้โปรโมชันสำเร็จ")},onError:e=>{C.ZP.error(e.message||"ไม่สามารถใช้โปรโมชันได้")}});return{promotions:i,isLoading:s,refetch:o,validatePromotion:r.mutateAsync,applyPromotion:l.mutateAsync,isValidating:r.isPending,isApplying:l.isPending}}(),{isAuthorized:I,isChecking:E}=(0,k.e)({requiredRole:"Admin"}),F=P.filter(e=>{if(!o)return!0;let t=o.toLowerCase();return e.name.toLowerCase().includes(t)||e.promotion_code.toLowerCase().includes(t)||e.description&&e.description.toLowerCase().includes(t)}),L=F.filter(e=>e.is_active),M=F.filter(e=>!!e.end_date&&Y()(e.end_date).isBefore(Y()()));return E?(0,s.jsx)(z.H,{message:"กำลังตรวจสอบสิทธิ์การใช้งาน..."}):I?(0,s.jsxs)("div",{style:{padding:"24px",maxWidth:1400,margin:"0 auto"},children:[(0,s.jsxs)("div",{style:{background:"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)",borderRadius:20,padding:"32px 24px",marginBottom:24,position:"relative",overflow:"hidden"},children:[(0,s.jsx)("div",{style:{position:"absolute",top:-50,right:-50,width:200,height:200,borderRadius:"50%",background:"rgba(255,255,255,0.1)"}}),(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",position:"relative",zIndex:1},children:[(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:16},children:[(0,s.jsx)("div",{style:{width:64,height:64,borderRadius:16,background:"rgba(255,255,255,0.2)",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,s.jsx)(u.Z,{style:{fontSize:28,color:"white"}})}),(0,s.jsxs)("div",{children:[(0,s.jsx)(A,{style:{color:"rgba(255,255,255,0.85)",fontSize:14,display:"block"},children:"จัดการโปรโมชัน"}),(0,s.jsx)(T,{level:3,style:{color:"white",margin:0,fontWeight:700},children:"Promotions"})]})]}),(0,s.jsxs)(r.Z,{children:[(0,s.jsx)(l.default,{allowClear:!0,placeholder:"ค้นหาโปรโมชัน...",value:t,onChange:e=>i(e.target.value),style:{width:240,borderRadius:10}}),(0,s.jsx)(d.ZP,{icon:(0,s.jsx)(h.Z,{}),onClick:()=>D(),style:{background:"rgba(255,255,255,0.2)",color:"white",border:"none"}}),(0,s.jsx)(d.ZP,{type:"primary",icon:(0,s.jsx)(m.Z,{}),onClick:()=>e.push("/pos/promotions/manager/add"),style:{background:"white",color:"#f5576c"},children:"เพิ่มโปรโมชัน"})]})]})]}),(0,s.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:16,marginBottom:24},children:[(0,s.jsx)(a.Z,{children:(0,s.jsxs)("div",{style:{textAlign:"center"},children:[(0,s.jsx)(c.Z,{count:F.length,showZero:!0,children:(0,s.jsx)(u.Z,{style:{fontSize:32,color:"#f5576c"}})}),(0,s.jsx)("div",{style:{marginTop:8},children:(0,s.jsx)(A,{type:"secondary",children:"ทั้งหมด"})})]})}),(0,s.jsx)(a.Z,{children:(0,s.jsxs)("div",{style:{textAlign:"center"},children:[(0,s.jsx)(c.Z,{count:L.length,showZero:!0,children:(0,s.jsx)(y.Z,{style:{fontSize:32,color:"#52c41a"}})}),(0,s.jsx)("div",{style:{marginTop:8},children:(0,s.jsx)(A,{type:"secondary",children:"เปิดใช้งาน"})})]})}),(0,s.jsx)(a.Z,{children:(0,s.jsxs)("div",{style:{textAlign:"center"},children:[(0,s.jsx)(c.Z,{count:M.length,showZero:!0,children:(0,s.jsx)(g.Z,{style:{fontSize:32,color:"#ff4d4f"}})}),(0,s.jsx)("div",{style:{marginTop:8},children:(0,s.jsx)(A,{type:"secondary",children:"หมดอายุ"})})]})})]}),B?(0,s.jsx)(a.Z,{loading:!0}):0===F.length?(0,s.jsx)(a.Z,{children:(0,s.jsx)(p.Z,{description:"ยังไม่มีโปรโมชัน"})}):(0,s.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(350px, 1fr))",gap:16},children:F.map(t=>{let i=t.end_date&&Y()(t.end_date).isBefore(Y()()),n=t.is_active&&!i;return(0,s.jsx)(a.Z,{style:{borderRadius:12,boxShadow:"0 2px 8px rgba(0,0,0,0.1)",border:n?"2px solid #52c41a":"1px solid #f0f0f0"},actions:[(0,s.jsx)(d.ZP,{type:"text",icon:(0,s.jsx)(f.Z,{}),onClick:()=>e.push("/pos/promotions/manager/edit/".concat(t.id)),children:"แก้ไข"},"edit")],children:(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start",marginBottom:12},children:(0,s.jsxs)("div",{style:{flex:1},children:[(0,s.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"center",marginBottom:8},children:[(0,s.jsx)(A,{strong:!0,style:{fontSize:16},children:t.name}),n?(0,s.jsx)(y.Z,{style:{color:"#52c41a",fontSize:14}}):(0,s.jsx)(g.Z,{style:{color:"#ff4d4f",fontSize:14}})]}),(0,s.jsx)(x.Z,{color:"purple",style:{marginBottom:8},children:t.promotion_code}),(0,s.jsx)(x.Z,{color:n?"success":"default",children:R[t.promotion_type]})]})}),t.description&&(0,s.jsx)(A,{type:"secondary",style:{fontSize:12,display:"block",marginBottom:8},children:t.description}),(0,s.jsxs)("div",{style:{display:"flex",gap:16,fontSize:12,color:"#8c8c8c",marginTop:12},children:[t.start_date&&(0,s.jsxs)("div",{children:[(0,s.jsx)(j.Z,{})," เริ่ม: ",Y()(t.start_date).format("DD/MM/YYYY")]}),t.end_date&&(0,s.jsxs)("div",{children:[(0,s.jsx)(j.Z,{})," สิ้นสุด: ",Y()(t.end_date).format("DD/MM/YYYY")]})]}),t.usage_limit&&(0,s.jsx)("div",{style:{marginTop:8},children:(0,s.jsxs)(A,{type:"secondary",style:{fontSize:12},children:["ใช้แล้ว: ",t.usage_count||0," / ",t.usage_limit]})})]})},t.id)})})]}):(0,s.jsx)(z.H,{message:"คุณไม่มีสิทธิ์เข้าถึงหน้านี้",tone:"danger"})}}},function(e){e.O(0,[8024,4736,8592,1744],function(){return e(e.s=95963)}),_N_E=e.O()}]);