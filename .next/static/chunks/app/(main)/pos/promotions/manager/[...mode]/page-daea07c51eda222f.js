(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[327],{87051:function(e,t,i){Promise.resolve().then(i.bind(i,67138))},67138:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return q}});var n=i(57437),a=i(2265),l=i(88589),r=i(7408),s=i(19878),d=i(34029),o=i(48651),u=i(55846),c=i(90136),m=i(66487),p=i(99376),_=i(61980),h=i(3286),x=i(2938),g=i(2261),f=i(71096),y=i.n(f);i(6729);let{TextArea:b}=l.default,{RangePicker:j}=r.default;y().locale("th");let v=[{label:"ซื้อ X แถม Y",value:_.q.BuyXGetY},{label:"ลดเปอร์เซ็นต์",value:_.q.PercentageOff},{label:"ลดจำนวนเงิน",value:_.q.FixedAmountOff},{label:"ฟรีค่าจัดส่ง",value:_.q.FreeShipping},{label:"ชุดโปรโมชัน",value:_.q.Bundle},{label:"ซื้อขั้นต่ำ",value:_.q.MinimumPurchase}],Z=[{label:"ทุกสินค้า",value:_.x.AllProducts},{label:"หมวดหมู่เฉพาะ",value:_.x.SpecificCategory},{label:"สินค้าเฉพาะ",value:_.x.SpecificProduct},{label:"ยอดซื้อขั้นต่ำ",value:_.x.MinimumAmount}];function q(e){let{params:t}=e,r=(0,p.useRouter)(),[f]=s.Z.useForm(),[q,w]=(0,a.useState)(!1),[P,I]=(0,a.useState)(!1),[S,O]=(0,a.useState)(_.q.PercentageOff),[A,k]=(0,a.useState)(_.x.AllProducts),F=t.mode[0],C=t.mode[1]||null,N="edit"===F&&!!C,{isAuthorized:M,isChecking:Y}=(0,h.e)({requiredRole:"Admin"}),E=(0,a.useCallback)(async()=>{w(!0);try{if(!C)return;let{promotionsService:e}=await i.e(8592).then(i.bind(i,39988)),t=await e.getById(C);f.setFieldsValue({promotion_code:t.promotion_code,name:t.name,description:t.description,promotion_type:t.promotion_type,condition_type:t.condition_type,condition_value:t.condition_value?JSON.parse(t.condition_value):void 0,discount_amount:t.discount_amount,discount_percentage:t.discount_percentage,minimum_purchase:t.minimum_purchase,buy_quantity:t.buy_quantity,get_quantity:t.get_quantity,start_date:t.start_date?y()(t.start_date):void 0,end_date:t.end_date?y()(t.end_date):void 0,usage_limit:t.usage_limit,usage_limit_per_user:t.usage_limit_per_user,is_active:t.is_active}),O(t.promotion_type||_.q.PercentageOff),k(t.condition_type||_.x.AllProducts)}catch(e){console.error(e),d.ZP.error("ไม่สามารถดึงข้อมูลโปรโมชันได้"),r.push("/pos/promotions")}finally{w(!1)}},[C,f,r]);(0,a.useEffect)(()=>{N&&E()},[N,C,E]);let R=async e=>{I(!0);try{let t={...e,condition_value:e.condition_value?JSON.stringify(e.condition_value):void 0,start_date:e.start_date?e.start_date.toISOString():void 0,end_date:e.end_date?e.end_date.toISOString():void 0},{promotionsService:n}=await i.e(8592).then(i.bind(i,39988));N?(await n.update(C,t),d.ZP.success("อัปเดตโปรโมชันสำเร็จ")):(await n.create(t),d.ZP.success("สร้างโปรโมชันสำเร็จ")),r.push("/pos/promotions")}catch(e){d.ZP.error(e instanceof Error?e.message:"เกิดข้อผิดพลาด")}finally{I(!1)}};return Y?(0,n.jsx)(x.H,{message:"กำลังตรวจสอบสิทธิ์การใช้งาน..."}):M?(0,n.jsxs)("div",{style:{padding:"24px",maxWidth:800,margin:"0 auto"},children:[(0,n.jsxs)("div",{style:{background:"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)",borderRadius:20,padding:"24px",marginBottom:24,display:"flex",alignItems:"center",gap:16},children:[(0,n.jsx)(g.Z,{style:{fontSize:32,color:"white"}}),(0,n.jsx)("div",{children:(0,n.jsx)("h2",{style:{color:"white",margin:0},children:N?"แก้ไขโปรโมชัน":"เพิ่มโปรโมชัน"})})]}),(0,n.jsx)(o.Z,{spinning:q,children:(0,n.jsxs)(s.Z,{form:f,layout:"vertical",onFinish:R,initialValues:{promotion_type:_.q.PercentageOff,condition_type:_.x.AllProducts,is_active:!0,usage_limit:0,usage_limit_per_user:1},children:[(0,n.jsx)(s.Z.Item,{label:"รหัสโปรโมชัน",name:"promotion_code",rules:[{required:!0,message:"กรุณากรอกรหัสโปรโมชัน"}],children:(0,n.jsx)(l.default,{placeholder:"เช่น SUMMER2024"})}),(0,n.jsx)(s.Z.Item,{label:"ชื่อโปรโมชัน",name:"name",rules:[{required:!0,message:"กรุณากรอกชื่อโปรโมชัน"}],children:(0,n.jsx)(l.default,{placeholder:"เช่น โปรโมชันฤดูร้อน"})}),(0,n.jsx)(s.Z.Item,{label:"รายละเอียด",name:"description",children:(0,n.jsx)(b,{rows:3,placeholder:"อธิบายรายละเอียดโปรโมชัน"})}),(0,n.jsx)(s.Z.Item,{label:"ประเภทโปรโมชัน",name:"promotion_type",rules:[{required:!0}],children:(0,n.jsx)(u.ZP.Group,{options:v,onChange:e=>O(e.target.value)})}),(0,n.jsx)(s.Z.Item,{label:"เงื่อนไข",name:"condition_type",rules:[{required:!0}],children:(0,n.jsx)(u.ZP.Group,{options:Z,onChange:e=>k(e.target.value)})}),(S===_.q.PercentageOff||S===_.q.FixedAmountOff)&&(0,n.jsxs)(n.Fragment,{children:[S===_.q.PercentageOff&&(0,n.jsx)(s.Z.Item,{label:"เปอร์เซ็นต์ส่วนลด",name:"discount_percentage",rules:[{required:!0,message:"กรุณากรอกเปอร์เซ็นต์ส่วนลด"}],children:(0,n.jsx)(c.Z,{min:0,max:100,placeholder:"เช่น 10",style:{width:"100%"},addonAfter:"%"})}),S===_.q.FixedAmountOff&&(0,n.jsx)(s.Z.Item,{label:"จำนวนเงินส่วนลด",name:"discount_amount",rules:[{required:!0,message:"กรุณากรอกจำนวนเงินส่วนลด"}],children:(0,n.jsx)(c.Z,{min:0,placeholder:"เช่น 50",style:{width:"100%"},addonAfter:"บาท"})})]}),S===_.q.BuyXGetY&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s.Z.Item,{label:"จำนวนที่ต้องซื้อ",name:"buy_quantity",rules:[{required:!0}],children:(0,n.jsx)(c.Z,{min:1,style:{width:"100%"}})}),(0,n.jsx)(s.Z.Item,{label:"จำนวนที่ได้ฟรี",name:"get_quantity",rules:[{required:!0}],children:(0,n.jsx)(c.Z,{min:1,style:{width:"100%"}})})]}),S===_.q.MinimumPurchase&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s.Z.Item,{label:"ยอดซื้อขั้นต่ำ",name:"minimum_purchase",rules:[{required:!0}],children:(0,n.jsx)(c.Z,{min:0,style:{width:"100%"},addonAfter:"บาท"})}),(0,n.jsx)(s.Z.Item,{label:"ส่วนลด",name:"discount_amount",rules:[{required:!0}],children:(0,n.jsx)(c.Z,{min:0,style:{width:"100%"},addonAfter:"บาท"})})]}),(A===_.x.SpecificCategory||A===_.x.SpecificProduct)&&(0,n.jsx)(s.Z.Item,{label:"ค่าเงื่อนไข (JSON Array)",name:"condition_value",tooltip:"กรอกเป็น JSON Array เช่น ['id1', 'id2']",children:(0,n.jsx)(b,{rows:2,placeholder:'["id1", "id2"]'})}),(0,n.jsx)(s.Z.Item,{label:"วันที่เริ่มต้น - สิ้นสุด",children:(0,n.jsx)(j,{style:{width:"100%"},showTime:!0,format:"DD/MM/YYYY HH:mm"})}),(0,n.jsx)(s.Z.Item,{label:"จำนวนครั้งที่ใช้ได้ (0 = ไม่จำกัด)",name:"usage_limit",children:(0,n.jsx)(c.Z,{min:0,style:{width:"100%"}})}),(0,n.jsx)(s.Z.Item,{label:"จำนวนครั้งที่ใช้ได้ต่อผู้ใช้",name:"usage_limit_per_user",children:(0,n.jsx)(c.Z,{min:1,style:{width:"100%"}})}),(0,n.jsx)(s.Z.Item,{label:"สถานะ",name:"is_active",valuePropName:"checked",children:(0,n.jsx)(m.Z,{})}),(0,n.jsx)(s.Z.Item,{children:(0,n.jsxs)("div",{style:{display:"flex",gap:12,justifyContent:"flex-end"},children:[(0,n.jsx)("button",{type:"button",onClick:()=>r.back(),style:{padding:"8px 24px",borderRadius:8,border:"1px solid #d9d9d9",background:"white",cursor:"pointer"},children:"ยกเลิก"}),(0,n.jsx)("button",{type:"submit",disabled:P,style:{padding:"8px 24px",borderRadius:8,border:"none",background:"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)",color:"white",cursor:"pointer",fontWeight:600},children:P?"กำลังบันทึก...":N?"อัปเดต":"สร้าง"})]})})]})})]}):(0,n.jsx)(x.H,{message:"คุณไม่มีสิทธิ์เข้าถึงหน้านี้",tone:"danger"})}}},function(e){e.O(0,[8024,4736,8592,1744],function(){return e(e.s=87051)}),_N_E=e.O()}]);