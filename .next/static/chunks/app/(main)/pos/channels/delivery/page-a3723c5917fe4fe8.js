(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3859],{15392:function(e,r,t){Promise.resolve().then(t.bind(t,43865))},43865:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return Y}});var a=t(57437),o=t(29),n=t.n(o),i=t(2265),s=t(99376),l=t(19683),d=t(34029),c=t(24783),m=t(80009),p=t(50742),x=t(47451),y=t(69410),f=t(53743),h=t(93834),u=t(88589),v=t(67605),b=t(96473),j=t(5540),g=t(25193),k=t(37410),w=t(20148),z=t(2786),N=t(29827),S=t(11713),C=t(46252),Z=t(2913),_=t(71567),E=t(98170);let B=_.q.POS.DELIVERY,P=function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"application/json",t={};return r&&(t["Content-Type"]=r),e&&(t.Cookie=e),t},R=async(e,r)=>{let t=(0,Z.b)("GET",B),a=new URLSearchParams(r||"");a.has("page")||a.set("page","1"),a.has("limit")||a.set("limit","200");let o=a.toString();o&&(t+="?".concat(o));let n=P(e,""),i=await fetch(t,{cache:"no-store",headers:n,credentials:"include"});if(!i.ok){var s;let e=await i.json().catch(()=>({}));throw Error((null==e?void 0:null===(s=e.error)||void 0===s?void 0:s.message)||e.error||e.message||"Failed to fetch delivery providers")}return(0,E.XO)(await i.json())};var D=t(32446),I=t(44225),O=t(11777),T=t(25369),W=t(252),F=t(61414),L=t(3369),q=t(33203),A=t(71096),K=t.n(A),M=t(45721),H=t.n(M);t(6729);let{Text:U}=l.default;function Y(){let e=(0,s.useRouter)(),{showLoading:r,hideLoading:t}=(0,L.x)(),{deliveryProviders:o,isLoading:l}=function(){let{socket:e}=(0,i.useContext)(C.J),r=(0,N.NL)(),{data:t,error:a,isLoading:o,refetch:n}=(0,S.a)({queryKey:["delivery"],queryFn:async()=>(await R()).data,staleTime:5e3});return(0,i.useEffect)(()=>{if(!e)return;let t=()=>{r.invalidateQueries({queryKey:["delivery"]})};return e.on("delivery:create",t),e.on("delivery:update",t),e.on("delivery:delete",t),()=>{e.off("delivery:create",t),e.off("delivery:update",t),e.off("delivery:delete",t)}},[e,r]),{deliveryProviders:t||[],isLoading:o,isError:a,mutate:n}}(),{orders:Z,isLoading:_}=(0,q.w)({orderType:D.m.Delivery}),[E,B]=(0,i.useState)(!1),P=(0,i.useMemo)(()=>(0,W.Do)(Z),[Z]),[A,M]=(0,i.useState)(""),[H,Y]=(0,i.useState)(null),G=(0,i.useMemo)(()=>o.find(e=>e.id===H),[o,H]);(0,i.useEffect)(()=>{_||l?r("กำลังโหลดออเดอร์..."):t()},[_,l,r,t]);let J=r=>{let t=(0,F.M9)(r);e.push(t)},Q=()=>{M(""),Y(null),B(!0)},V=()=>{if(!H){d.ZP.error("กรุณาเลือกผู้ให้บริการ");return}if(!A.trim()){d.ZP.error("กรุณากรอกรหัสออเดอร์");return}r("กำลังเข้าสู่หน้าออเดอร์...");let t=A.trim();(null==G?void 0:G.delivery_prefix)&&(t="".concat(G.delivery_prefix,"-").concat(t)),e.push("/pos/channels/delivery/".concat(H,"?code=").concat(encodeURIComponent(t)))},X=e=>{switch(e){case"available":return"success";case"occupied":return"orange";case"waitingForPayment":return"blue";default:return"default"}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(T.c,{}),(0,a.jsx)(n(),{id:O.N5.__hash,children:O.N5}),(0,a.jsx)(n(),{id:"c1ca8602d2ef2218",children:".order-card-hover{-webkit-transition:all.3s cubic-bezier(.4,0,.2,1)!important;-moz-transition:all.3s cubic-bezier(.4,0,.2,1)!important;-o-transition:all.3s cubic-bezier(.4,0,.2,1)!important;transition:all.3s cubic-bezier(.4,0,.2,1)!important}.order-card-hover:hover{-webkit-transform:translatey(-4px)!important;-moz-transform:translatey(-4px)!important;-ms-transform:translatey(-4px)!important;-o-transform:translatey(-4px)!important;transform:translatey(-4px)!important;-webkit-box-shadow:0 12px 28px rgba(0,0,0,.1)!important;-moz-box-shadow:0 12px 28px rgba(0,0,0,.1)!important;box-shadow:0 12px 28px rgba(0,0,0,.1)!important}.order-card-hover:active{-webkit-transform:translatey(-2px)scale(.99)!important;-moz-transform:translatey(-2px)scale(.99)!important;-ms-transform:translatey(-2px)scale(.99)!important;-o-transform:translatey(-2px)scale(.99)!important;transform:translatey(-2px)scale(.99)!important}@media(hover:none){.order-card-hover:active{-webkit-transform:scale(.98)!important;-moz-transform:scale(.98)!important;-ms-transform:scale(.98)!important;-o-transform:scale(.98)!important;transform:scale(.98)!important}.order-card-hover:hover{-webkit-transform:none!important;-moz-transform:none!important;-ms-transform:none!important;-o-transform:none!important;transform:none!important}}.back-button-hover:hover{background:rgba(255,255,255,.28)!important;-webkit-transform:translatex(-2px);-moz-transform:translatex(-2px);-ms-transform:translatex(-2px);-o-transform:translatex(-2px);transform:translatex(-2px)}.add-button-hover:hover{-webkit-transform:translatey(-2px)!important;-moz-transform:translatey(-2px)!important;-ms-transform:translatey(-2px)!important;-o-transform:translatey(-2px)!important;transform:translatey(-2px)!important;-webkit-box-shadow:0 12px 24px rgba(139,92,246,.35)!important;-moz-box-shadow:0 12px 24px rgba(139,92,246,.35)!important;box-shadow:0 12px 24px rgba(139,92,246,.35)!important}.add-button-hover:active{-webkit-transform:scale(.98)!important;-moz-transform:scale(.98)!important;-ms-transform:scale(.98)!important;-o-transform:scale(.98)!important;transform:scale(.98)!important}.hide-on-mobile{display:inline!important}.show-on-mobile-inline{display:none!important}@media(max-width:768px){.hide-on-mobile{display:none!important}.show-on-mobile-inline{display:inline!important}}.delivery-modal .ant-modal-content{-webkit-border-radius:20px!important;-moz-border-radius:20px!important;border-radius:20px!important;overflow:hidden}.delivery-modal .ant-modal-header{padding:20px 24px 16px!important;border-bottom:1px solid#f0f0f0!important}.delivery-modal .ant-modal-body{padding:24px!important}.delivery-modal .ant-modal-footer{padding:16px 24px 20px!important;border-top:1px solid#f0f0f0!important}"}),(0,a.jsxs)("div",{style:I.Np.container,className:"jsx-c1ca8602d2ef2218",children:[(0,a.jsx)(w.Z,{title:"เดลิเวอรี่",subtitle:(0,a.jsxs)(c.Z,{size:8,wrap:!0,children:[(0,a.jsxs)(m.Z,{children:["ทั้งหมด ",P.total]}),(0,a.jsxs)(m.Z,{color:"orange",children:["กำลังปรุง ",P.cooking]})]}),onBack:()=>{e.push("/pos/channels")},icon:(0,a.jsx)(v.Z,{style:{fontSize:20}}),actions:(0,a.jsx)(p.ZP,{type:"primary",icon:(0,a.jsx)(b.Z,{}),onClick:Q,children:"เพิ่มออเดอร์"})}),(0,a.jsx)(g.Z,{children:(0,a.jsx)(k.Z,{title:"ออเดอร์",children:Z.length>0?(0,a.jsx)(x.Z,{gutter:[16,16],children:Z.map((e,r)=>{var t;let n=(0,W.Yx)(e),i=I.ax[n],s=o.find(r=>r.id===e.delivery_id),l=e.delivery_code||e.order_no.split("-").pop();return(0,a.jsx)(y.Z,{xs:24,sm:12,md:8,lg:6,xl:6,className:"delivery-order-col-mobile",children:(0,a.jsxs)("article",{style:{...O.yy.orderCard,border:"1.5px solid ".concat(i.border)},onClick:()=>J(e),onKeyDown:r=>{("Enter"===r.key||" "===r.key)&&(r.preventDefault(),J(e))},role:"button",tabIndex:0,"aria-label":"ออเดอร์ ".concat(l," - ").concat((0,W.NE)(e.status)),className:"jsx-c1ca8602d2ef2218 "+"order-card-hover delivery-order-card table-card-animate table-card-delay-".concat(r%6+1),children:[(0,a.jsxs)("div",{style:{...O.yy.orderCardHeader,background:i.light},className:"jsx-c1ca8602d2ef2218",children:[(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:10},className:"jsx-c1ca8602d2ef2218",children:[(0,a.jsx)("div",{style:{width:40,height:40,borderRadius:12,background:"".concat(i.primary,"20"),display:"flex",alignItems:"center",justifyContent:"center"},className:"jsx-c1ca8602d2ef2218",children:(0,a.jsx)(v.Z,{style:{color:i.primary,fontSize:20}})}),(0,a.jsxs)("div",{className:"jsx-c1ca8602d2ef2218",children:[(0,a.jsx)(U,{strong:!0,style:{fontSize:16,color:"#1E293B",display:"block",lineHeight:1.2},children:l}),(0,a.jsx)(U,{type:"secondary",style:{fontSize:11},children:(null==s?void 0:s.delivery_name)||"Delivery"})]})]}),(0,a.jsx)(m.Z,{color:X(n),style:{borderRadius:8,margin:0,fontWeight:600,border:"none",padding:"4px 12px"},children:(0,W.NE)(e.status)})]}),(0,a.jsx)("div",{style:O.yy.orderCardContent,className:"jsx-c1ca8602d2ef2218",children:(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:16},className:"jsx-c1ca8602d2ef2218",children:[(0,a.jsxs)("div",{className:"jsx-c1ca8602d2ef2218",children:[(0,a.jsx)(U,{type:"secondary",style:{fontSize:12,display:"block",marginBottom:4},children:"รายการสินค้า"}),(0,a.jsxs)(U,{strong:!0,style:{fontSize:16},children:[e.items_count||0," รายการ"]})]}),(0,a.jsxs)("div",{style:{textAlign:"right"},className:"jsx-c1ca8602d2ef2218",children:[(0,a.jsx)(U,{type:"secondary",style:{fontSize:12,display:"block",marginBottom:4},children:"ยอดรวม"}),(0,a.jsxs)(U,{strong:!0,style:{fontSize:20,color:i.primary},children:["฿",null===(t=e.total_amount)||void 0===t?void 0:t.toLocaleString()]})]})]})}),(0,a.jsxs)("div",{style:O.yy.orderCardFooter,className:"jsx-c1ca8602d2ef2218",children:[(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:6},className:"jsx-c1ca8602d2ef2218",children:[(0,a.jsx)(j.Z,{style:{fontSize:12,color:"#94A3B8"}}),(0,a.jsx)(U,{type:"secondary",style:{fontSize:12},children:K()(e.create_date).fromNow()})]}),(0,a.jsx)(m.Z,{style:{margin:0,borderRadius:6,background:I.hS.delivery.light,color:I.hS.delivery.primary,border:"1px solid ".concat(I.hS.delivery.border),fontSize:11,fontWeight:600},children:"Delivery"})]})]})},e.id)})}):(0,a.jsx)(z.Z,{title:"ไม่มีออเดอร์เดลิเวอรี่",description:"เริ่มรับออเดอร์โดยกดปุ่ม “เพิ่มออเดอร์”",action:(0,a.jsx)(p.ZP,{type:"primary",icon:(0,a.jsx)(b.Z,{}),onClick:Q,children:"สร้างออเดอร์ใหม่"})})})}),(0,a.jsx)(f.Z,{title:(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12},className:"jsx-c1ca8602d2ef2218",children:[(0,a.jsx)("div",{style:{width:40,height:40,borderRadius:12,background:I.hS.delivery.light,display:"flex",alignItems:"center",justifyContent:"center"},className:"jsx-c1ca8602d2ef2218",children:(0,a.jsx)(v.Z,{style:{color:I.hS.delivery.primary,fontSize:20}})}),(0,a.jsxs)("div",{className:"jsx-c1ca8602d2ef2218",children:[(0,a.jsx)("div",{style:{fontSize:18,fontWeight:700,color:"#1E293B"},className:"jsx-c1ca8602d2ef2218",children:"เปิดออเดอร์เดลิเวอรี่"}),(0,a.jsx)("div",{style:{fontSize:13,fontWeight:400,color:"#94A3B8"},className:"jsx-c1ca8602d2ef2218",children:"กรอกข้อมูลเพื่อสร้างออเดอร์ใหม่"})]})]}),open:E,onOk:V,onCancel:()=>B(!1),okText:"ยืนยัน",cancelText:"ยกเลิก",centered:!0,className:"delivery-modal",okButtonProps:{style:{background:I.hS.delivery.primary,borderColor:I.hS.delivery.primary,height:44,borderRadius:12,fontWeight:600,padding:"0 24px"},disabled:!H||!A.trim()},cancelButtonProps:{style:{height:44,borderRadius:12,fontWeight:600,padding:"0 24px"}},children:(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:20},className:"jsx-c1ca8602d2ef2218",children:[(0,a.jsxs)("div",{className:"jsx-c1ca8602d2ef2218",children:[(0,a.jsx)(U,{strong:!0,style:{display:"block",marginBottom:8,fontSize:14,color:"#475569"},children:"เลือกผู้ให้บริการ (Delivery Provider)"}),(0,a.jsx)(h.default,{placeholder:"เลือกผู้ให้บริการ",style:{width:"100%"},size:"large",value:H,onChange:Y,options:o.map(e=>({label:e.delivery_name,value:e.id})),loading:l})]}),(0,a.jsxs)("div",{className:"jsx-c1ca8602d2ef2218",children:[(0,a.jsx)(U,{strong:!0,style:{display:"block",marginBottom:8,fontSize:14,color:"#475569"},children:"รหัสเดลิเวอรี่ / Order Code"}),(0,a.jsx)(u.default,{placeholder:"ระบุรหัสออเดอร์ (เช่น 123)",addonBefore:(null==G?void 0:G.delivery_prefix)?"".concat(G.delivery_prefix,"-"):void 0,value:A,onChange:e=>M(e.target.value),size:"large",onPressEnter:V,style:{borderRadius:8}})]})]})})]})]})}K().extend(H()),K().locale("th")}},function(e){e.O(0,[8024,4736,8592,1744],function(){return e(e.s=15392)}),_N_E=e.O()}]);