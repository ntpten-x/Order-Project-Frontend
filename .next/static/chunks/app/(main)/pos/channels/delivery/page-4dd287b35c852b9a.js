(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3859],{15392:function(e,a,r){Promise.resolve().then(r.bind(r,43865))},43865:function(e,a,r){"use strict";r.r(a),r.d(a,{default:function(){return q}});var t=r(57437),s=r(29),n=r.n(s),i=r(2265),o=r(99376),l=r(19683),d=r(34029),c=r(50742),m=r(47451),y=r(69410),x=r(80009),p=r(85180),h=r(53743),f=r(93834),v=r(88589),j=r(17588),u=r(67605),b=r(96473),g=r(5540),N=r(29827),k=r(11713),S=r(46252),w=r(2913);let z=r(71567).q.POS.DELIVERY,C=function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"application/json",r={};return a&&(r["Content-Type"]=a),e&&(r.Cookie=e),r},E=async(e,a)=>{let r=(0,w.b)("GET",z),t=new URLSearchParams(a||"");t.has("page")||t.set("page","1"),t.has("limit")||t.set("limit","200");let s=t.toString();s&&(r+="?".concat(s));let n=C(e,""),i=await fetch(r,{cache:"no-store",headers:n,credentials:"include"});if(!i.ok){let e=await i.json().catch(()=>({}));throw Error(e.error||e.message||"Failed to fetch delivery providers")}return i.json()};var _=r(32446),B=r(44225),Z=r(11777),P=r(25369),D=r(252),I=r(61414),R=r(3369),T=r(33203),W=r(71096),H=r.n(W),L=r(45721),O=r.n(L);r(6729);let{Title:F,Text:M}=l.default;function q(){let e=(0,o.useRouter)(),{showLoading:a,hideLoading:r}=(0,R.x)(),{deliveryProviders:s,isLoading:l}=function(){let{socket:e}=(0,i.useContext)(S.J),a=(0,N.NL)(),{data:r,error:t,isLoading:s,refetch:n}=(0,k.a)({queryKey:["delivery"],queryFn:async()=>(await E()).data,staleTime:5e3});return(0,i.useEffect)(()=>{if(!e)return;let r=()=>{a.invalidateQueries({queryKey:["delivery"]})};return e.on("delivery:create",r),e.on("delivery:update",r),e.on("delivery:delete",r),()=>{e.off("delivery:create",r),e.off("delivery:update",r),e.off("delivery:delete",r)}},[e,a]),{deliveryProviders:r||[],isLoading:s,isError:t,mutate:n}}(),{orders:w,isLoading:z}=(0,T.w)({orderType:_.m.Delivery}),[C,W]=(0,i.useState)(!1),L=(0,i.useMemo)(()=>(0,D.Do)(w),[w]),[O,q]=(0,i.useState)(""),[A,K]=(0,i.useState)(null),G=(0,i.useMemo)(()=>s.find(e=>e.id===A),[s,A]);(0,i.useEffect)(()=>{z||l?a("กำลังโหลดออเดอร์..."):r()},[z,l,a,r]);let U=a=>{let r=(0,I.M9)(a);e.push(r)},Y=()=>{q(""),K(null),W(!0)},J=()=>{if(!A){d.ZP.error("กรุณาเลือกผู้ให้บริการ");return}if(!O.trim()){d.ZP.error("กรุณากรอกรหัสออเดอร์");return}a("กำลังเข้าสู่หน้าออเดอร์...");let r=O.trim();(null==G?void 0:G.delivery_prefix)&&(r="".concat(G.delivery_prefix,"-").concat(r)),e.push("/pos/channels/delivery/".concat(A,"?code=").concat(encodeURIComponent(r)))},Q=e=>{switch(e){case"available":return"success";case"occupied":return"orange";case"waitingForPayment":return"blue";default:return"default"}};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(P.c,{}),(0,t.jsx)(n(),{id:Z.N5.__hash,children:Z.N5}),(0,t.jsx)(n(),{id:"c1ca8602d2ef2218",children:".order-card-hover{-webkit-transition:all.3s cubic-bezier(.4,0,.2,1)!important;-moz-transition:all.3s cubic-bezier(.4,0,.2,1)!important;-o-transition:all.3s cubic-bezier(.4,0,.2,1)!important;transition:all.3s cubic-bezier(.4,0,.2,1)!important}.order-card-hover:hover{-webkit-transform:translatey(-4px)!important;-moz-transform:translatey(-4px)!important;-ms-transform:translatey(-4px)!important;-o-transform:translatey(-4px)!important;transform:translatey(-4px)!important;-webkit-box-shadow:0 12px 28px rgba(0,0,0,.1)!important;-moz-box-shadow:0 12px 28px rgba(0,0,0,.1)!important;box-shadow:0 12px 28px rgba(0,0,0,.1)!important}.order-card-hover:active{-webkit-transform:translatey(-2px)scale(.99)!important;-moz-transform:translatey(-2px)scale(.99)!important;-ms-transform:translatey(-2px)scale(.99)!important;-o-transform:translatey(-2px)scale(.99)!important;transform:translatey(-2px)scale(.99)!important}@media(hover:none){.order-card-hover:active{-webkit-transform:scale(.98)!important;-moz-transform:scale(.98)!important;-ms-transform:scale(.98)!important;-o-transform:scale(.98)!important;transform:scale(.98)!important}.order-card-hover:hover{-webkit-transform:none!important;-moz-transform:none!important;-ms-transform:none!important;-o-transform:none!important;transform:none!important}}.back-button-hover:hover{background:rgba(255,255,255,.28)!important;-webkit-transform:translatex(-2px);-moz-transform:translatex(-2px);-ms-transform:translatex(-2px);-o-transform:translatex(-2px);transform:translatex(-2px)}.add-button-hover:hover{-webkit-transform:translatey(-2px)!important;-moz-transform:translatey(-2px)!important;-ms-transform:translatey(-2px)!important;-o-transform:translatey(-2px)!important;transform:translatey(-2px)!important;-webkit-box-shadow:0 12px 24px rgba(139,92,246,.35)!important;-moz-box-shadow:0 12px 24px rgba(139,92,246,.35)!important;box-shadow:0 12px 24px rgba(139,92,246,.35)!important}.add-button-hover:active{-webkit-transform:scale(.98)!important;-moz-transform:scale(.98)!important;-ms-transform:scale(.98)!important;-o-transform:scale(.98)!important;transform:scale(.98)!important}.hide-on-mobile{display:inline!important}.show-on-mobile-inline{display:none!important}@media(max-width:768px){.hide-on-mobile{display:none!important}.show-on-mobile-inline{display:inline!important}}.delivery-modal .ant-modal-content{-webkit-border-radius:20px!important;-moz-border-radius:20px!important;border-radius:20px!important;overflow:hidden}.delivery-modal .ant-modal-header{padding:20px 24px 16px!important;border-bottom:1px solid#f0f0f0!important}.delivery-modal .ant-modal-body{padding:24px!important}.delivery-modal .ant-modal-footer{padding:16px 24px 20px!important;border-top:1px solid#f0f0f0!important}"}),(0,t.jsxs)("div",{style:B.Np.container,className:"jsx-c1ca8602d2ef2218",children:[(0,t.jsxs)("header",{style:{...Z.yy.channelHeader,background:B.hS.delivery.gradient},role:"banner",className:"jsx-c1ca8602d2ef2218 delivery-header-mobile",children:[(0,t.jsx)("div",{className:"jsx-c1ca8602d2ef2218 header-pattern"}),(0,t.jsx)("div",{className:"jsx-c1ca8602d2ef2218 header-circle circle-1"}),(0,t.jsx)("div",{className:"jsx-c1ca8602d2ef2218 header-circle circle-2"}),(0,t.jsxs)("div",{style:Z.yy.channelHeaderContent,className:"jsx-c1ca8602d2ef2218 delivery-header-content-mobile",children:[(0,t.jsxs)("button",{style:Z.yy.channelBackButton,onClick:()=>{e.push("/pos/channels")},"aria-label":"กลับไปหน้าเลือกช่องทาง",className:"jsx-c1ca8602d2ef2218 back-button-hover delivery-back-button-mobile",children:[(0,t.jsx)(j.Z,{}),(0,t.jsx)("span",{className:"jsx-c1ca8602d2ef2218",children:"กลับ"})]}),(0,t.jsxs)("div",{style:Z.yy.channelTitleSection,className:"jsx-c1ca8602d2ef2218 delivery-title-section-mobile",children:[(0,t.jsx)(u.Z,{style:Z.yy.channelHeaderIcon,className:"delivery-header-icon-mobile","aria-hidden":"true"}),(0,t.jsxs)("div",{className:"jsx-c1ca8602d2ef2218",children:[(0,t.jsx)(F,{level:3,style:Z.yy.channelHeaderTitle,className:"delivery-header-title-mobile",children:"เดลิเวอรี่"}),(0,t.jsx)(M,{style:Z.yy.channelHeaderSubtitle,children:"Delivery"})]})]}),(0,t.jsxs)("div",{style:Z.yy.channelStatsBar,className:"jsx-c1ca8602d2ef2218 delivery-stats-bar-mobile",children:[(0,t.jsxs)("div",{style:Z.yy.statItem,className:"jsx-c1ca8602d2ef2218",children:[(0,t.jsx)("span",{style:{...Z.yy.statDot,background:"#fff"},className:"jsx-c1ca8602d2ef2218"}),(0,t.jsxs)(M,{style:Z.yy.statText,children:["ทั้งหมด ",L.total]})]}),(0,t.jsxs)("div",{style:Z.yy.statItem,className:"jsx-c1ca8602d2ef2218",children:[(0,t.jsx)("span",{style:{...Z.yy.statDot,background:B.ax.occupied.primary},className:"jsx-c1ca8602d2ef2218"}),(0,t.jsxs)(M,{style:Z.yy.statText,children:["กำลังปรุง ",L.cooking]})]})]})]})]}),(0,t.jsxs)("main",{style:{maxWidth:1400,margin:"0 auto",padding:"0 16px 32px"},role:"main",className:"jsx-c1ca8602d2ef2218 delivery-content-mobile",children:[(0,t.jsx)("div",{style:{display:"flex",justifyContent:"flex-end",marginBottom:20},className:"jsx-c1ca8602d2ef2218",children:(0,t.jsxs)(c.ZP,{type:"primary",size:"large",icon:(0,t.jsx)(b.Z,{}),onClick:Y,className:"add-button-hover delivery-add-button-mobile",style:{...Z.yy.addOrderButton,background:B.hS.delivery.primary,boxShadow:"0 8px 20px ".concat(B.hS.delivery.primary,"40")},children:[(0,t.jsx)("span",{className:"jsx-c1ca8602d2ef2218 hide-on-mobile",children:"เพิ่มออเดอร์ใหม่"}),(0,t.jsx)("span",{className:"jsx-c1ca8602d2ef2218 show-on-mobile-inline",children:"เพิ่ม"})]})}),w.length>0?(0,t.jsx)(m.Z,{gutter:[16,16],children:w.map((e,a)=>{var r;let n=(0,D.Yx)(e),i=B.ax[n],o=s.find(a=>a.id===e.delivery_id),l=e.delivery_code||e.order_no.split("-").pop();return(0,t.jsx)(y.Z,{xs:24,sm:12,md:8,lg:6,xl:6,className:"delivery-order-col-mobile",children:(0,t.jsxs)("article",{style:{...Z.yy.orderCard,border:"1.5px solid ".concat(i.border)},onClick:()=>U(e),onKeyDown:a=>{("Enter"===a.key||" "===a.key)&&(a.preventDefault(),U(e))},role:"button",tabIndex:0,"aria-label":"ออเดอร์ ".concat(l," - ").concat((0,D.NE)(e.status)),className:"jsx-c1ca8602d2ef2218 "+"order-card-hover delivery-order-card table-card-animate table-card-delay-".concat(a%6+1),children:[(0,t.jsxs)("div",{style:{...Z.yy.orderCardHeader,background:i.light},className:"jsx-c1ca8602d2ef2218",children:[(0,t.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:10},className:"jsx-c1ca8602d2ef2218",children:[(0,t.jsx)("div",{style:{width:40,height:40,borderRadius:12,background:"".concat(i.primary,"20"),display:"flex",alignItems:"center",justifyContent:"center"},className:"jsx-c1ca8602d2ef2218",children:(0,t.jsx)(u.Z,{style:{color:i.primary,fontSize:20}})}),(0,t.jsxs)("div",{className:"jsx-c1ca8602d2ef2218",children:[(0,t.jsx)(M,{strong:!0,style:{fontSize:16,color:"#1E293B",display:"block",lineHeight:1.2},children:l}),(0,t.jsx)(M,{type:"secondary",style:{fontSize:11},children:(null==o?void 0:o.delivery_name)||"Delivery"})]})]}),(0,t.jsx)(x.Z,{color:Q(n),style:{borderRadius:8,margin:0,fontWeight:600,border:"none",padding:"4px 12px"},children:(0,D.NE)(e.status)})]}),(0,t.jsx)("div",{style:Z.yy.orderCardContent,className:"jsx-c1ca8602d2ef2218",children:(0,t.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:16},className:"jsx-c1ca8602d2ef2218",children:[(0,t.jsxs)("div",{className:"jsx-c1ca8602d2ef2218",children:[(0,t.jsx)(M,{type:"secondary",style:{fontSize:12,display:"block",marginBottom:4},children:"รายการสินค้า"}),(0,t.jsxs)(M,{strong:!0,style:{fontSize:16},children:[e.items_count||0," รายการ"]})]}),(0,t.jsxs)("div",{style:{textAlign:"right"},className:"jsx-c1ca8602d2ef2218",children:[(0,t.jsx)(M,{type:"secondary",style:{fontSize:12,display:"block",marginBottom:4},children:"ยอดรวม"}),(0,t.jsxs)(M,{strong:!0,style:{fontSize:20,color:i.primary},children:["฿",null===(r=e.total_amount)||void 0===r?void 0:r.toLocaleString()]})]})]})}),(0,t.jsxs)("div",{style:Z.yy.orderCardFooter,className:"jsx-c1ca8602d2ef2218",children:[(0,t.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:6},className:"jsx-c1ca8602d2ef2218",children:[(0,t.jsx)(g.Z,{style:{fontSize:12,color:"#94A3B8"}}),(0,t.jsx)(M,{type:"secondary",style:{fontSize:12},children:H()(e.create_date).fromNow()})]}),(0,t.jsx)(x.Z,{style:{margin:0,borderRadius:6,background:B.hS.delivery.light,color:B.hS.delivery.primary,border:"1px solid ".concat(B.hS.delivery.border),fontSize:11,fontWeight:600},children:"Delivery"})]})]})},e.id)})}):(0,t.jsxs)("div",{style:Z.yy.emptyStateContainer,className:"jsx-c1ca8602d2ef2218",children:[(0,t.jsx)(p.Z,{image:p.Z.PRESENTED_IMAGE_SIMPLE,description:(0,t.jsxs)("div",{style:{marginTop:16},className:"jsx-c1ca8602d2ef2218",children:[(0,t.jsx)(F,{level:4,style:{marginBottom:8,color:"#1E293B"},children:"ไม่มีออเดอร์เดลิเวอรี่"}),(0,t.jsx)(M,{type:"secondary",style:{fontSize:15},children:'เริ่มรับออเดอร์โดยกดปุ่ม "เพิ่มออเดอร์"'})]})}),(0,t.jsx)(c.ZP,{type:"primary",size:"large",icon:(0,t.jsx)(b.Z,{}),onClick:Y,style:{marginTop:24,background:B.hS.delivery.primary,height:52,borderRadius:16,padding:"0 32px",fontWeight:600,border:"none",boxShadow:"0 8px 20px ".concat(B.hS.delivery.primary,"40")},children:"สร้างออเดอร์ใหม่"})]})]}),(0,t.jsx)(h.Z,{title:(0,t.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12},className:"jsx-c1ca8602d2ef2218",children:[(0,t.jsx)("div",{style:{width:40,height:40,borderRadius:12,background:B.hS.delivery.light,display:"flex",alignItems:"center",justifyContent:"center"},className:"jsx-c1ca8602d2ef2218",children:(0,t.jsx)(u.Z,{style:{color:B.hS.delivery.primary,fontSize:20}})}),(0,t.jsxs)("div",{className:"jsx-c1ca8602d2ef2218",children:[(0,t.jsx)("div",{style:{fontSize:18,fontWeight:700,color:"#1E293B"},className:"jsx-c1ca8602d2ef2218",children:"เปิดออเดอร์เดลิเวอรี่"}),(0,t.jsx)("div",{style:{fontSize:13,fontWeight:400,color:"#94A3B8"},className:"jsx-c1ca8602d2ef2218",children:"กรอกข้อมูลเพื่อสร้างออเดอร์ใหม่"})]})]}),open:C,onOk:J,onCancel:()=>W(!1),okText:"ยืนยัน",cancelText:"ยกเลิก",centered:!0,className:"delivery-modal",okButtonProps:{style:{background:B.hS.delivery.primary,borderColor:B.hS.delivery.primary,height:44,borderRadius:12,fontWeight:600,padding:"0 24px"},disabled:!A||!O.trim()},cancelButtonProps:{style:{height:44,borderRadius:12,fontWeight:600,padding:"0 24px"}},children:(0,t.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:20},className:"jsx-c1ca8602d2ef2218",children:[(0,t.jsxs)("div",{className:"jsx-c1ca8602d2ef2218",children:[(0,t.jsx)(M,{strong:!0,style:{display:"block",marginBottom:8,fontSize:14,color:"#475569"},children:"เลือกผู้ให้บริการ (Delivery Provider)"}),(0,t.jsx)(f.default,{placeholder:"เลือกผู้ให้บริการ",style:{width:"100%"},size:"large",value:A,onChange:K,options:s.map(e=>({label:e.delivery_name,value:e.id})),loading:l})]}),(0,t.jsxs)("div",{className:"jsx-c1ca8602d2ef2218",children:[(0,t.jsx)(M,{strong:!0,style:{display:"block",marginBottom:8,fontSize:14,color:"#475569"},children:"รหัสเดลิเวอรี่ / Order Code"}),(0,t.jsx)(v.default,{placeholder:"ระบุรหัสออเดอร์ (เช่น 123)",addonBefore:(null==G?void 0:G.delivery_prefix)?"".concat(G.delivery_prefix,"-"):void 0,value:O,onChange:e=>q(e.target.value),size:"large",onPressEnter:J,style:{borderRadius:8}})]})]})})]})]})}H().extend(O()),H().locale("th")}},function(e){e.O(0,[8024,4736,8592,1744],function(){return e(e.s=15392)}),_N_E=e.O()}]);