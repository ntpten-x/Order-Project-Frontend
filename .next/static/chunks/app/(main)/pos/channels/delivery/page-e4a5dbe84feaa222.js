(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3859],{15392:function(e,r,t){Promise.resolve().then(t.bind(t,43865))},43865:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return Q}});var a=t(57437),o=t(29),n=t.n(o),i=t(2265),s=t(99376),l=t(60283),d=t(34029),c=t(24783),m=t(80009),p=t(50742),y=t(47451),x=t(69410),f=t(53743),h=t(93834),v=t(88589),u=t(67605),b=t(96473),g=t(5540),j=t(25193),w=t(37410),k=t(20148),z=t(2786),N=t(30290),S=t(36799),C=t(29827),Z=t(11713),_=t(46252),P=t(2913),E=t(71567),B=t(98170);let R=E.q.POS.DELIVERY,O=function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"application/json",t={};return r&&(t["Content-Type"]=r),e&&(t.Cookie=e),t},D=async(e,r)=>{let t=(0,P.b)("GET",R),a=new URLSearchParams(r||"");a.has("page")||a.set("page","1"),a.has("limit")||a.set("limit","200");let o=a.toString();o&&(t+="?".concat(o));let n=O(e,""),i=await fetch(t,{cache:"no-store",headers:n,credentials:"include"});if(!i.ok){var s;let e=await i.json().catch(()=>({}));throw Error((null==e?void 0:null===(s=e.error)||void 0===s?void 0:s.message)||e.error||e.message||"Failed to fetch delivery providers")}return(0,B.XO)(await i.json())};var I=t(12028),W=t(32446),F=t(44225),T=t(11777),L=t(25369),q=t(252),M=t(61414),A=t(3369),K=t(33203),H=t(71096),U=t.n(H),Y=t(45721),G=t.n(Y);t(6729);let{Text:J}=l.default;function Q(){let e=(0,s.useRouter)(),{showLoading:r,hideLoading:t}=(0,A.x)(),{deliveryProviders:o,isLoading:l,isError:P,mutate:E}=function(){let{socket:e}=(0,i.useContext)(_.J),r=(0,C.NL)(),{data:t,error:a,isLoading:o,refetch:n}=(0,Z.a)({queryKey:["delivery"],queryFn:async()=>(await D()).data,staleTime:5e3});return(0,i.useEffect)(()=>{if(!e)return;let t=()=>{r.invalidateQueries({queryKey:["delivery"]})};return e.on(I.b.delivery.create,t),e.on(I.b.delivery.update,t),e.on(I.b.delivery.delete,t),()=>{e.off(I.b.delivery.create,t),e.off(I.b.delivery.update,t),e.off(I.b.delivery.delete,t)}},[e,r]),{deliveryProviders:t||[],isLoading:o,isError:a,mutate:n}}(),{orders:B,isLoading:R}=(0,K.w)({orderType:W.m.Delivery}),[O,H]=(0,i.useState)(!1),Y=(0,i.useMemo)(()=>(0,q.Do)(B),[B]),[G,Q]=(0,i.useState)(""),[V,X]=(0,i.useState)(null),$=(0,i.useMemo)(()=>o.find(e=>e.id===V),[o,V]);(0,i.useEffect)(()=>{R||l?r((0,S.t)("delivery.loadingOrders")):t()},[R,l,r,t]);let ee=r=>{let t=(0,M.M9)(r);e.push(t)},er=()=>{Q(""),X(null),H(!0)},et=()=>{if(!V){d.ZP.error("กรุณาเลือกผู้ให้บริการ");return}if(!G.trim()){d.ZP.error("กรุณากรอกรหัสออเดอร์");return}r("กำลังเข้าสู่หน้าออเดอร์...");let t=G.trim();(null==$?void 0:$.delivery_prefix)&&(t="".concat($.delivery_prefix,"-").concat(t)),e.push("/pos/channels/delivery/".concat(V,"?code=").concat(encodeURIComponent(t)))},ea=e=>{switch(e){case"available":return"success";case"occupied":return"orange";case"waitingForPayment":return"blue";default:return"default"}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(L.c,{}),(0,a.jsx)(n(),{id:T.N5.__hash,children:T.N5}),(0,a.jsx)(n(),{id:"c1ca8602d2ef2218",children:".order-card-hover{-webkit-transition:all.3s cubic-bezier(.4,0,.2,1)!important;-moz-transition:all.3s cubic-bezier(.4,0,.2,1)!important;-o-transition:all.3s cubic-bezier(.4,0,.2,1)!important;transition:all.3s cubic-bezier(.4,0,.2,1)!important}.order-card-hover:hover{-webkit-transform:translatey(-4px)!important;-moz-transform:translatey(-4px)!important;-ms-transform:translatey(-4px)!important;-o-transform:translatey(-4px)!important;transform:translatey(-4px)!important;-webkit-box-shadow:0 12px 28px rgba(0,0,0,.1)!important;-moz-box-shadow:0 12px 28px rgba(0,0,0,.1)!important;box-shadow:0 12px 28px rgba(0,0,0,.1)!important}.order-card-hover:active{-webkit-transform:translatey(-2px)scale(.99)!important;-moz-transform:translatey(-2px)scale(.99)!important;-ms-transform:translatey(-2px)scale(.99)!important;-o-transform:translatey(-2px)scale(.99)!important;transform:translatey(-2px)scale(.99)!important}@media(hover:none){.order-card-hover:active{-webkit-transform:scale(.98)!important;-moz-transform:scale(.98)!important;-ms-transform:scale(.98)!important;-o-transform:scale(.98)!important;transform:scale(.98)!important}.order-card-hover:hover{-webkit-transform:none!important;-moz-transform:none!important;-ms-transform:none!important;-o-transform:none!important;transform:none!important}}.back-button-hover:hover{background:rgba(255,255,255,.28)!important;-webkit-transform:translatex(-2px);-moz-transform:translatex(-2px);-ms-transform:translatex(-2px);-o-transform:translatex(-2px);transform:translatex(-2px)}.add-button-hover:hover{-webkit-transform:translatey(-2px)!important;-moz-transform:translatey(-2px)!important;-ms-transform:translatey(-2px)!important;-o-transform:translatey(-2px)!important;transform:translatey(-2px)!important;-webkit-box-shadow:0 12px 24px rgba(139,92,246,.35)!important;-moz-box-shadow:0 12px 24px rgba(139,92,246,.35)!important;box-shadow:0 12px 24px rgba(139,92,246,.35)!important}.add-button-hover:active{-webkit-transform:scale(.98)!important;-moz-transform:scale(.98)!important;-ms-transform:scale(.98)!important;-o-transform:scale(.98)!important;transform:scale(.98)!important}.hide-on-mobile{display:inline!important}.show-on-mobile-inline{display:none!important}@media(max-width:768px){.hide-on-mobile{display:none!important}.show-on-mobile-inline{display:inline!important}}.delivery-modal .ant-modal-content{-webkit-border-radius:20px!important;-moz-border-radius:20px!important;border-radius:20px!important;overflow:hidden}.delivery-modal .ant-modal-header{padding:20px 24px 16px!important;border-bottom:1px solid#f0f0f0!important}.delivery-modal .ant-modal-body{padding:24px!important}.delivery-modal .ant-modal-footer{padding:16px 24px 20px!important;border-top:1px solid#f0f0f0!important}"}),(0,a.jsxs)("div",{style:F.Np.container,className:"jsx-c1ca8602d2ef2218",children:[(0,a.jsx)(k.Z,{title:"เดลิเวอรี่",subtitle:(0,a.jsxs)(c.Z,{size:8,wrap:!0,children:[(0,a.jsxs)(m.Z,{children:["ทั้งหมด ",Y.total]}),(0,a.jsxs)(m.Z,{color:"orange",children:["กำลังปรุง ",Y.cooking]})]}),onBack:()=>{e.push("/pos/channels")},icon:(0,a.jsx)(u.Z,{style:{fontSize:20}}),actions:(0,a.jsx)(p.ZP,{type:"primary",icon:(0,a.jsx)(b.Z,{}),onClick:er,children:"เพิ่มออเดอร์"})}),(0,a.jsx)(j.Z,{children:P?(0,a.jsx)(N.Z,{status:"error",title:(0,S.t)("page.error"),onRetry:()=>E()}):l||0!==o.length?(0,a.jsx)(w.Z,{title:"ออเดอร์",children:B.length>0?(0,a.jsx)(y.Z,{gutter:[16,16],children:B.map((e,r)=>{var t;let n=(0,q.Yx)(e),i=F.ax[n],s=o.find(r=>r.id===e.delivery_id),l=e.delivery_code||e.order_no.split("-").pop();return(0,a.jsx)(x.Z,{xs:24,sm:12,md:8,lg:6,xl:6,className:"delivery-order-col-mobile",children:(0,a.jsxs)("article",{style:{...T.yy.orderCard,border:"1.5px solid ".concat(i.border)},onClick:()=>ee(e),onKeyDown:r=>{("Enter"===r.key||" "===r.key)&&(r.preventDefault(),ee(e))},role:"button",tabIndex:0,"aria-label":"ออเดอร์ ".concat(l," - ").concat((0,q.NE)(e.status)),className:"jsx-c1ca8602d2ef2218 "+"order-card-hover delivery-order-card table-card-animate table-card-delay-".concat(r%6+1),children:[(0,a.jsxs)("div",{style:{...T.yy.orderCardHeader,background:i.light},className:"jsx-c1ca8602d2ef2218",children:[(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:10},className:"jsx-c1ca8602d2ef2218",children:[(0,a.jsx)("div",{style:{width:40,height:40,borderRadius:12,background:"".concat(i.primary,"20"),display:"flex",alignItems:"center",justifyContent:"center"},className:"jsx-c1ca8602d2ef2218",children:(0,a.jsx)(u.Z,{style:{color:i.primary,fontSize:20}})}),(0,a.jsxs)("div",{className:"jsx-c1ca8602d2ef2218",children:[(0,a.jsx)(J,{strong:!0,style:{fontSize:16,color:"#1E293B",display:"block",lineHeight:1.2},children:l}),(0,a.jsx)(J,{type:"secondary",style:{fontSize:11},children:(null==s?void 0:s.delivery_name)||"Delivery"})]})]}),(0,a.jsx)(m.Z,{color:ea(n),style:{borderRadius:8,margin:0,fontWeight:600,border:"none",padding:"4px 12px"},children:(0,q.NE)(e.status)})]}),(0,a.jsx)("div",{style:T.yy.orderCardContent,className:"jsx-c1ca8602d2ef2218",children:(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:16},className:"jsx-c1ca8602d2ef2218",children:[(0,a.jsxs)("div",{className:"jsx-c1ca8602d2ef2218",children:[(0,a.jsx)(J,{type:"secondary",style:{fontSize:12,display:"block",marginBottom:4},children:"รายการสินค้า"}),(0,a.jsxs)(J,{strong:!0,style:{fontSize:16},children:[e.items_count||0," รายการ"]})]}),(0,a.jsxs)("div",{style:{textAlign:"right"},className:"jsx-c1ca8602d2ef2218",children:[(0,a.jsx)(J,{type:"secondary",style:{fontSize:12,display:"block",marginBottom:4},children:"ยอดรวม"}),(0,a.jsxs)(J,{strong:!0,style:{fontSize:20,color:i.primary},children:["฿",null===(t=e.total_amount)||void 0===t?void 0:t.toLocaleString()]})]})]})}),(0,a.jsxs)("div",{style:T.yy.orderCardFooter,className:"jsx-c1ca8602d2ef2218",children:[(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:6},className:"jsx-c1ca8602d2ef2218",children:[(0,a.jsx)(g.Z,{style:{fontSize:12,color:"#94A3B8"}}),(0,a.jsx)(J,{type:"secondary",style:{fontSize:12},children:U()(e.create_date).fromNow()})]}),(0,a.jsx)(m.Z,{style:{margin:0,borderRadius:6,background:F.hS.delivery.light,color:F.hS.delivery.primary,border:"1px solid ".concat(F.hS.delivery.border),fontSize:11,fontWeight:600},children:"Delivery"})]})]})},e.id)})}):(0,a.jsx)(z.Z,{title:(0,S.t)("delivery.noOrders"),description:"เริ่มรับออเดอร์โดยกดปุ่ม “เพิ่มออเดอร์”",action:(0,a.jsx)(p.ZP,{type:"primary",icon:(0,a.jsx)(b.Z,{}),onClick:er,children:(0,S.t)("delivery.createNewOrder")})})}):(0,a.jsx)(N.Z,{status:"empty",title:(0,S.t)("delivery.noProviders"),action:(0,a.jsx)(p.ZP,{onClick:()=>E(),children:(0,S.t)("delivery.retry")})})}),(0,a.jsx)(f.Z,{title:(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12},className:"jsx-c1ca8602d2ef2218",children:[(0,a.jsx)("div",{style:{width:40,height:40,borderRadius:12,background:F.hS.delivery.light,display:"flex",alignItems:"center",justifyContent:"center"},className:"jsx-c1ca8602d2ef2218",children:(0,a.jsx)(u.Z,{style:{color:F.hS.delivery.primary,fontSize:20}})}),(0,a.jsxs)("div",{className:"jsx-c1ca8602d2ef2218",children:[(0,a.jsx)("div",{style:{fontSize:18,fontWeight:700,color:"#1E293B"},className:"jsx-c1ca8602d2ef2218",children:(0,S.t)("delivery.createOrder")}),(0,a.jsx)("div",{style:{fontSize:13,fontWeight:400,color:"#94A3B8"},className:"jsx-c1ca8602d2ef2218",children:(0,S.t)("delivery.createOrderSubtitle")})]})]}),open:O,onOk:et,onCancel:()=>H(!1),okText:"ยืนยัน",cancelText:"ยกเลิก",centered:!0,className:"delivery-modal",okButtonProps:{style:{background:F.hS.delivery.primary,borderColor:F.hS.delivery.primary,height:44,borderRadius:12,fontWeight:600,padding:"0 24px"},disabled:l||!V||!G.trim()},cancelButtonProps:{style:{height:44,borderRadius:12,fontWeight:600,padding:"0 24px"}},children:(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:20},className:"jsx-c1ca8602d2ef2218",children:[(0,a.jsxs)("div",{className:"jsx-c1ca8602d2ef2218",children:[(0,a.jsx)(J,{strong:!0,style:{display:"block",marginBottom:8,fontSize:14,color:"#475569"},children:(0,S.t)("delivery.selectProvider")}),(0,a.jsx)(h.default,{placeholder:(0,S.t)("delivery.selectProviderPlaceholder"),style:{width:"100%"},size:"large",value:V,onChange:X,options:o.map(e=>({label:e.delivery_name,value:e.id})),loading:l,dropdownStyle:{borderRadius:12,padding:8},dropdownMatchSelectWidth:!0,getPopupContainer:e=>(null==e?void 0:e.closest(".delivery-modal"))||(null==e?void 0:e.parentElement)||document.body,notFoundContent:l?(0,S.t)("delivery.loadingOrders"):(0,S.t)("delivery.noProviders")})]}),(0,a.jsxs)("div",{className:"jsx-c1ca8602d2ef2218",children:[(0,a.jsx)(J,{strong:!0,style:{display:"block",marginBottom:8,fontSize:14,color:"#475569"},children:(0,S.t)("delivery.orderCode")}),(0,a.jsx)(v.default,{placeholder:(0,S.t)("delivery.enterOrderCode"),addonBefore:(null==$?void 0:$.delivery_prefix)?"".concat($.delivery_prefix,"-"):void 0,value:G,onChange:e=>Q(e.target.value),size:"large",onPressEnter:et,style:{borderRadius:8}})]})]})})]})]})}U().extend(G()),U().locale("th")}},function(e){e.O(0,[8024,4736,8592,1744],function(){return e(e.s=15392)}),_N_E=e.O()}]);