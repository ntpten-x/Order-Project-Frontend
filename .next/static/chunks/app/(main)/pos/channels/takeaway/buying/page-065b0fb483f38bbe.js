(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4674],{13410:function(e,n,t){Promise.resolve().then(t.bind(t,9395))},52539:function(e,n,t){"use strict";t.d(n,{Z:function(){return o}});var r=t(2265),i={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 312H696v-16c0-101.6-82.4-184-184-184s-184 82.4-184 184v16H192c-17.7 0-32 14.3-32 32v536c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V344c0-17.7-14.3-32-32-32zm-432-16c0-61.9 50.1-112 112-112s112 50.1 112 112v16H400v-16zm392 544H232V384h96v88c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-88h224v88c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-88h96v456z"}}]},name:"shopping",theme:"outlined"},a=t(55015);function u(){return(u=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e}).apply(this,arguments)}var o=r.forwardRef((e,n)=>r.createElement(a.Z,u({},e,{ref:n,icon:i})))},9395:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return g}});var r=t(57437),i=t(2265),a=t(13817),u=t(99376),o=t(34029),c=t(52539),s=t(8949),l=t(53286),d=t(61414),f=t(252),v=t(32446),y=t(3369),p=t(77961),m=t(97235);function _(e){let{queueNumber:n}=e,{showLoading:t,hideLoading:a}=(0,y.x)(),[_,h]=(0,i.useState)(""),g=(0,u.useRouter)();(0,i.useEffect)(()=>{(async()=>{t();let e=await (0,m.P)();e&&h(e),a()})()},[t,a]);let{cartItems:b,clearCart:w,getSubtotal:k,getDiscountAmount:D,getFinalPrice:A,selectedDiscount:N,setOrderMode:P,setReferenceId:x,setReferenceCode:C}=(0,s.j)();(0,i.useEffect)(()=>{P("TAKEAWAY"),x(null),C(n||null)},[n,P,x,C]);let T=async()=>{t();try{let e=(0,d.zf)(b,v.m.TakeAway,{subTotal:k(),discountAmount:D(),totalAmount:A()},{discountId:null==N?void 0:N.id,queueNumber:n});await l.x.create(e,void 0,_),o.ZP.success("สร้างออเดอร์เรียบร้อยแล้ว"),w(),g.push((0,f.Zu)(v.m.TakeAway))}catch(e){o.ZP.error(e instanceof Error?e.message:"ไม่สามารถทำรายการได้")}finally{a()}};return(0,r.jsx)(p.Z,{title:"ระบบขายหน้าร้าน (Take Away)",subtitle:"สั่งกลับบ้าน ".concat(n?"- คิว ".concat(n):""),icon:(0,r.jsx)(c.Z,{style:{fontSize:28}}),onConfirmOrder:T})}var h=t(25193);function g(){return(0,r.jsx)(h.Z,{maxWidth:99999,style:{padding:0},children:(0,r.jsx)(a.default,{style:{background:"transparent"},children:(0,r.jsx)(a.default.Content,{style:{background:"transparent"},children:(0,r.jsx)(_,{})})})})}},61414:function(e,n,t){"use strict";t.d(n,{EO:function(){return w},Gs:function(){return s},HL:function(){return k},M9:function(){return D},Nz:function(){return m},OY:function(){return u},Rr:function(){return g},Wl:function(){return a},d$:function(){return A},d7:function(){return c},iN:function(){return f},jN:function(){return p},ku:function(){return h},mz:function(){return l},qO:function(){return d},s6:function(){return o},xG:function(){return y},yj:function(){return b},zP:function(){return v},zf:function(){return N}});var r=t(32446),i=t(34962);let a=e=>{var n,t;if(e.status===i.c.Available)return"/pos/channels/dine-in/".concat(e.id);let a=e.active_order_id||(null===(n=e.active_order)||void 0===n?void 0:n.id),u=e.active_order_status||(null===(t=e.active_order)||void 0===t?void 0:t.status);return a?u===r.i.WaitingForPayment?"/pos/items/payment/".concat(a):"/pos/orders/".concat(a):"/pos/channels/dine-in/".concat(e.id)},u=e=>{switch(e){case r.i.Pending:return"orange";case r.i.Cooking:return"blue";case r.i.Served:return"green";case r.i.Paid:return"cyan";case r.i.Cancelled:return"red";case r.i.WaitingForPayment:return"gold";default:if("cancelled"===String(null!=e?e:"").trim().toLowerCase())return"red";return"default"}},o=e=>"cancelled"===String(null!=e?e:"").trim().toLowerCase(),c=(e,n)=>{switch(e){case r.i.Pending:return"กำลังดำเนินการ";case r.i.Cooking:return"กำลังปรุง";case r.i.Served:if("TakeAway"===n||"Delivery"===n)return"ทำแล้ว";return"เสิร์ฟแล้ว";case r.i.Paid:return"ชำระเงินแล้ว";case r.i.Completed:return"สำเร็จ";case r.i.Cancelled:return"ยกเลิก";case r.i.WaitingForPayment:return"รอชำระเงิน";default:if(o(e))return"ยกเลิก";return e}},s=e=>{switch(e){case"DineIn":return"#722ed1";case"TakeAway":return"#fa8c16";case"Delivery":return"#eb2f96";default:return"#1890ff"}},l=e=>{switch(e){case"DineIn":return"ทานที่ร้าน";case"TakeAway":return"สั่งกลับบ้าน";case"Delivery":return"เดลิเวอรี่";default:return e}},d=e=>"DineIn"===e?"เสิร์ฟ":"ทำแล้ว",f=e=>"Delivery"===e?"จัดออเดอร์เสร็จแล้วพร้อมส่งให้ไรเดอร์":"DineIn"===e?"ยืนยันเสิร์ฟพร้อมชำระเงิน":"ยืนยันทำแล้วพร้อมชำระเงิน",v=e=>"DineIn"===e?"เสิร์ฟอาหารแล้ว":"ปรุงเสร็จแล้ว",y=e=>{let n="string"==typeof e?parseFloat(e):e;return"฿".concat(Number(n).toLocaleString("th-TH",{minimumFractionDigits:0,maximumFractionDigits:2}))},p=e=>{var n,t;return"DineIn"===e.order_type?(null===(n=e.table)||void 0===n?void 0:n.table_name)||"ไม่ระบุโต๊ะ":"Delivery"===e.order_type?e.delivery_code||(null===(t=e.delivery)||void 0===t?void 0:t.delivery_name)||"ไม่ระบุข้อมูล":"TakeAway"===e.order_type?e.order_no||"ไม่ระบุเลขที่":e.order_no||"N/A"},m=e=>(null!=e?e:[]).filter(e=>!o(e.status)),_=e=>(null!=e?e:[]).reduce((e,n)=>e+(Number(n.extra_price)||0),0),h=(e,n,t)=>((Number(e)||0)+_(t))*n,g=e=>m(e).reduce((e,n)=>{var t,r;let i=(null===(r=n.product)||void 0===r?void 0:null===(t=r.category)||void 0===t?void 0:t.display_name)||"ไม่ระบุหมวด";return e[i]=(e[i]||0)+(n.quantity||0),e},{}),b=e=>m(e).reduce((e,n)=>e+Number(n.total_price||0),0),w=e=>"DineIn"===e.order_type?"/pos/channels/dine-in":"TakeAway"===e.order_type?"/pos/channels/takeaway":"Delivery"===e.order_type?"/pos/channels/delivery":"/pos/orders",k=e=>"/pos/orders/".concat(e),D=e=>e.status===r.i.WaitingForPayment?e.order_type===r.m.Delivery?"/pos/items/delivery/".concat(e.id):"/pos/items/payment/".concat(e.id):"/pos/orders/".concat(e.id),A=e=>e===r.m.Delivery?"/pos/channels/delivery":e===r.m.TakeAway?"/pos/channels/takeaway":e===r.m.DineIn?"/pos/channels/dine-in":"/pos/channels",N=(e,n,t,i)=>({order_no:i.orderNo||"ORD-".concat(Date.now()),order_type:n,sub_total:t.subTotal,discount_amount:t.discountAmount,vat:0,total_amount:t.totalAmount,received_amount:0,change_amount:0,status:r.i.Pending,discount_id:i.discountId||null,payment_method_id:null,table_id:i.tableId||null,delivery_id:i.deliveryId||null,delivery_code:i.deliveryCode||null,items:e.map(e=>{var t;let i=n===r.m.Delivery?Number(null!==(t=e.product.price_delivery)&&void 0!==t?t:e.product.price):Number(e.product.price),a=(i+(e.details||[]).reduce((e,n)=>e+Number(n.extra_price),0))*e.quantity;return{product_id:e.product.id,quantity:e.quantity,price:i,total_price:a,discount_amount:0,notes:e.notes||"",status:r.i.Cooking,details:e.details||[]}})})}},function(e){e.O(0,[253,1522,3418,742,9486,4252,3916,8651,4159,3831,2224,3248,2401,9,8879,8589,19,3834,9763,1713,5713,8056,4547,4480,5799,3145,1747,4899,6835,2971,2117,1744],function(){return e(e.s=13410)}),_N_E=e.O()}]);