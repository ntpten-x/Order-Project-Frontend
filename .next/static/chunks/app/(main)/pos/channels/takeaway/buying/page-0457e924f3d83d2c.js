(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4674],{13410:function(e,n,t){Promise.resolve().then(t.bind(t,9395))},52539:function(e,n,t){"use strict";t.d(n,{Z:function(){return o}});var r=t(2265),i={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 312H696v-16c0-101.6-82.4-184-184-184s-184 82.4-184 184v16H192c-17.7 0-32 14.3-32 32v536c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V344c0-17.7-14.3-32-32-32zm-432-16c0-61.9 50.1-112 112-112s112 50.1 112 112v16H400v-16zm392 544H232V384h96v88c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-88h224v88c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-88h96v456z"}}]},name:"shopping",theme:"outlined"},a=t(55015);function u(){return(u=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e}).apply(this,arguments)}var o=r.forwardRef((e,n)=>r.createElement(a.Z,u({},e,{ref:n,icon:i})))},9395:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return _}});var r=t(57437),i=t(2265),a=t(99376),u=t(34029),o=t(52539),c=t(8949),s=t(53286),l=t(61414),d=t(252),f=t(32446),v=t(3369),y=t(77961),m=t(97235);function p(e){let{queueNumber:n}=e,{showLoading:t,hideLoading:p}=(0,v.x)(),[_,h]=(0,i.useState)(""),g=(0,a.useRouter)();(0,i.useEffect)(()=>{(async()=>{t();let e=await (0,m.P)();e&&h(e),p()})()},[t,p]);let{cartItems:b,clearCart:w,getSubtotal:D,getDiscountAmount:k,getFinalPrice:A,selectedDiscount:N,setOrderMode:P,setReferenceId:T,setReferenceCode:I}=(0,c.j)();(0,i.useEffect)(()=>{P("TAKEAWAY"),T(null),I(n||null)},[n,P,T,I]);let C=async()=>{t();try{let e=(0,l.zf)(b,f.m.TakeAway,{subTotal:D(),discountAmount:k(),totalAmount:A()},{discountId:null==N?void 0:N.id,queueNumber:n});await s.x.create(e,void 0,_),u.ZP.success("สร้างออเดอร์เรียบร้อยแล้ว"),w(),g.push((0,d.Zu)(f.m.TakeAway))}catch(e){u.ZP.error(e instanceof Error?e.message:"ไม่สามารถทำรายการได้")}finally{p()}};return(0,r.jsx)(y.Z,{title:"ระบบขายหน้าร้าน (Take Away)",subtitle:"สั่งกลับบ้าน ".concat(n?"- คิว ".concat(n):""),icon:(0,r.jsx)(o.Z,{style:{fontSize:28}}),onConfirmOrder:C})}function _(){return(0,r.jsx)(p,{})}},61414:function(e,n,t){"use strict";t.d(n,{EO:function(){return b},Gs:function(){return c},HL:function(){return w},M9:function(){return D},Nz:function(){return m},OY:function(){return u},Rr:function(){return h},Wl:function(){return a},d$:function(){return k},d7:function(){return o},iN:function(){return d},jN:function(){return y},ku:function(){return _},mz:function(){return s},qO:function(){return l},xG:function(){return v},yj:function(){return g},zP:function(){return f},zf:function(){return A}});var r=t(32446),i=t(34962);let a=e=>{var n,t;if(e.status===i.c.Available)return"/pos/channels/dine-in/".concat(e.id);let a=e.active_order_id||(null===(n=e.active_order)||void 0===n?void 0:n.id),u=e.active_order_status||(null===(t=e.active_order)||void 0===t?void 0:t.status);return a?u===r.i.WaitingForPayment?"/pos/items/payment/".concat(a):"/pos/orders/".concat(a):"/pos/channels/dine-in/".concat(e.id)},u=e=>{switch(e){case r.i.Pending:return"orange";case r.i.Cooking:return"blue";case r.i.Served:return"green";case r.i.Paid:return"cyan";case r.i.Cancelled:return"red";case r.i.WaitingForPayment:return"gold";default:return"default"}},o=(e,n)=>{switch(e){case r.i.Pending:return"กำลังดำเนินการ";case r.i.Cooking:return"กำลังปรุง";case r.i.Served:if("TakeAway"===n||"Delivery"===n)return"ทำแล้ว";return"เสิร์ฟแล้ว";case r.i.Paid:return"ชำระเงินแล้ว";case r.i.Completed:return"สำเร็จ";case r.i.Cancelled:return"ยกเลิก";case r.i.WaitingForPayment:return"รอชำระเงิน";default:return e}},c=e=>{switch(e){case"DineIn":return"#722ed1";case"TakeAway":return"#fa8c16";case"Delivery":return"#eb2f96";default:return"#1890ff"}},s=e=>{switch(e){case"DineIn":return"ทานที่ร้าน";case"TakeAway":return"สั่งกลับบ้าน";case"Delivery":return"เดลิเวอรี่";default:return e}},l=e=>"DineIn"===e?"เสิร์ฟ":"ทำแล้ว",d=e=>"Delivery"===e?"จัดออเดอร์เสร็จแล้วพร้อมส่งให้ไรเดอร์":"DineIn"===e?"ยืนยันเสิร์ฟพร้อมชำระเงิน":"ยืนยันทำแล้วพร้อมชำระเงิน",f=e=>"DineIn"===e?"เสิร์ฟอาหารแล้ว":"ปรุงเสร็จแล้ว",v=e=>{let n="string"==typeof e?parseFloat(e):e;return"฿".concat(Number(n).toLocaleString("th-TH",{minimumFractionDigits:0,maximumFractionDigits:2}))},y=e=>{var n,t;return"DineIn"===e.order_type?(null===(n=e.table)||void 0===n?void 0:n.table_name)||"ไม่ระบุโต๊ะ":"Delivery"===e.order_type?e.delivery_code||(null===(t=e.delivery)||void 0===t?void 0:t.delivery_name)||"ไม่ระบุข้อมูล":"TakeAway"===e.order_type?e.order_no||"ไม่ระบุเลขที่":e.order_no||"N/A"},m=e=>(null!=e?e:[]).filter(e=>e.status!==r.i.Cancelled),p=e=>(null!=e?e:[]).reduce((e,n)=>e+(Number(n.extra_price)||0),0),_=(e,n,t)=>((Number(e)||0)+p(t))*n,h=e=>m(e).reduce((e,n)=>{var t,r;let i=(null===(r=n.product)||void 0===r?void 0:null===(t=r.category)||void 0===t?void 0:t.display_name)||"ไม่ระบุหมวด";return e[i]=(e[i]||0)+(n.quantity||0),e},{}),g=e=>m(e).reduce((e,n)=>e+Number(n.total_price||0),0),b=e=>"DineIn"===e.order_type?"/pos/channels/dine-in":"TakeAway"===e.order_type?"/pos/channels/takeaway":"Delivery"===e.order_type?"/pos/channels/delivery":"/pos/orders",w=e=>"/pos/orders/".concat(e),D=e=>e.status===r.i.WaitingForPayment?e.order_type===r.m.Delivery?"/pos/items/delivery/".concat(e.id):"/pos/items/payment/".concat(e.id):"/pos/orders/".concat(e.id),k=e=>e===r.m.Delivery?"/pos/channels/delivery":e===r.m.TakeAway?"/pos/channels/takeaway":e===r.m.DineIn?"/pos/channels/dine-in":"/pos/channels",A=(e,n,t,i)=>({order_no:i.orderNo||"ORD-".concat(Date.now()),order_type:n,sub_total:t.subTotal,discount_amount:t.discountAmount,vat:0,total_amount:t.totalAmount,received_amount:0,change_amount:0,status:r.i.Pending,discount_id:i.discountId||null,payment_method_id:null,table_id:i.tableId||null,delivery_id:i.deliveryId||null,delivery_code:i.deliveryCode||null,items:e.map(e=>{let n=Number(e.product.price),t=(n+(e.details||[]).reduce((e,n)=>e+Number(n.extra_price),0))*e.quantity;return{product_id:e.product.id,quantity:e.quantity,price:n,total_price:t,discount_amount:0,notes:e.notes||"",status:r.i.Cooking,details:e.details||[]}})})}},function(e){e.O(0,[5015,7717,7698,742,3211,7993,8651,2646,6207,7213,9021,2224,3248,1721,9,5616,8589,5496,3834,19,8056,4547,9763,5713,9356,5799,3680,5101,2971,2117,1744],function(){return e(e.s=13410)}),_N_E=e.O()}]);