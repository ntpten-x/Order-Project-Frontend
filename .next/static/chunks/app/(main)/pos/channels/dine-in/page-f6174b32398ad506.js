(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4290],{83449:function(e,t,a){Promise.resolve().then(a.bind(a,12538))},12538:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return E}});var n=a(57437),r=a(29),i=a.n(r),o=a(2265),s=a(99376),c=a(24783),l=a(80009),d=a(47451),u=a(69410),m=a(50742),f=a(62376),p=a(8881),b=a(83669),y=a(81770),h=a(25193),x=a(37410),v=a(20148),g=a(2786),w=a(29827),k=a(11713),_=a(46252),j=a(66290),N=a(12028),z=a(44225),S=a(11777),D=a(25369),T=a(61414),P=a(3369),C=a(252);function E(){let e=(0,s.useRouter)(),{showLoading:t,hideLoading:a}=(0,P.x)(),{tables:r,isLoading:E}=function(){let{socket:e}=(0,o.useContext)(_.J),t=(0,w.NL)(),{data:a,error:n,isLoading:r,refetch:i}=(0,k.a)({queryKey:["tables"],queryFn:async()=>(await j.$.getAll()).data,staleTime:2e3,refetchOnReconnect:!0});return(0,o.useEffect)(()=>{if(!e)return;let a=()=>{t.invalidateQueries({queryKey:["tables"]})};return e.on(N.b.tables.create,a),e.on(N.b.tables.update,a),e.on(N.b.tables.delete,a),e.on(N.b.orders.create,a),e.on(N.b.orders.update,a),e.on(N.b.orders.delete,a),()=>{e.off(N.b.tables.create,a),e.off(N.b.tables.update,a),e.off(N.b.tables.delete,a),e.off(N.b.orders.create,a),e.off(N.b.orders.update,a),e.off(N.b.orders.delete,a)}},[e,t]),{tables:a||[],isLoading:r,isError:n,mutate:i}}();o.useEffect(()=>{E?t():a()},[E,t,a]);let F=(0,o.useMemo)(()=>(0,C.W9)(r),[r]),A=(0,o.useMemo)(()=>(0,C.Th)(r),[r]),I=(0,o.useMemo)(()=>(0,C.Tf)(A),[A]),Z=(t,a)=>{if(!a){let a=(0,T.Wl)(t);e.push(a)}};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(D.c,{}),(0,n.jsx)(i(),{id:S.N5.__hash,children:S.N5}),(0,n.jsx)(i(),{id:"a961af50cb45fe5b",children:".table-card-hover{-webkit-transition:all.3s cubic-bezier(.4,0,.2,1)!important;-moz-transition:all.3s cubic-bezier(.4,0,.2,1)!important;-o-transition:all.3s cubic-bezier(.4,0,.2,1)!important;transition:all.3s cubic-bezier(.4,0,.2,1)!important}.table-card-hover:hover{-webkit-transform:translatey(-6px)!important;-moz-transform:translatey(-6px)!important;-ms-transform:translatey(-6px)!important;-o-transform:translatey(-6px)!important;transform:translatey(-6px)!important;-webkit-box-shadow:0 16px 32px rgba(0,0,0,.08)!important;-moz-box-shadow:0 16px 32px rgba(0,0,0,.08)!important;box-shadow:0 16px 32px rgba(0,0,0,.08)!important}.table-card-hover:hover .table-icon{-webkit-transform:scale(1.1)!important;-moz-transform:scale(1.1)!important;-ms-transform:scale(1.1)!important;-o-transform:scale(1.1)!important;transform:scale(1.1)!important}.table-card-hover:active{-webkit-transform:translatey(-2px)scale(.98)!important;-moz-transform:translatey(-2px)scale(.98)!important;-ms-transform:translatey(-2px)scale(.98)!important;-o-transform:translatey(-2px)scale(.98)!important;transform:translatey(-2px)scale(.98)!important}@media(hover:none){.table-card-hover:active{-webkit-transform:scale(.97)!important;-moz-transform:scale(.97)!important;-ms-transform:scale(.97)!important;-o-transform:scale(.97)!important;transform:scale(.97)!important}.table-card-hover:hover{-webkit-transform:none!important;-moz-transform:none!important;-ms-transform:none!important;-o-transform:none!important;transform:none!important}}.table-icon-wrapper{width:64px;height:64px;-webkit-border-radius:20px;-moz-border-radius:20px;border-radius:20px;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center;margin-bottom:12px;position:relative;-webkit-transition:all.3s ease;-moz-transition:all.3s ease;-o-transition:all.3s ease;transition:all.3s ease}.pulse-soft{-webkit-animation:pulseSoft 2s ease-in-out infinite;-moz-animation:pulseSoft 2s ease-in-out infinite;-o-animation:pulseSoft 2s ease-in-out infinite;animation:pulseSoft 2s ease-in-out infinite}@-webkit-keyframes pulseSoft{0%,100%{-webkit-transform:scale(1);transform:scale(1);opacity:1}50%{-webkit-transform:scale(1.05);transform:scale(1.05);opacity:.9}}@-moz-keyframes pulseSoft{0%,100%{-moz-transform:scale(1);transform:scale(1);opacity:1}50%{-moz-transform:scale(1.05);transform:scale(1.05);opacity:.9}}@-o-keyframes pulseSoft{0%,100%{-o-transform:scale(1);transform:scale(1);opacity:1}50%{-o-transform:scale(1.05);transform:scale(1.05);opacity:.9}}@keyframes pulseSoft{0%,100%{-webkit-transform:scale(1);-moz-transform:scale(1);-o-transform:scale(1);transform:scale(1);opacity:1}50%{-webkit-transform:scale(1.05);-moz-transform:scale(1.05);-o-transform:scale(1.05);transform:scale(1.05);opacity:.9}}.back-button-hover:hover{background:rgba(255,255,255,.28)!important;-webkit-transform:translatex(-2px);-moz-transform:translatex(-2px);-ms-transform:translatex(-2px);-o-transform:translatex(-2px);transform:translatex(-2px)}.show-on-mobile{display:none!important}@media(max-width:768px){.show-on-mobile{display:inline!important}}"}),(0,n.jsxs)("div",{style:z.Np.container,className:"jsx-a961af50cb45fe5b",children:[(0,n.jsx)(v.Z,{title:"หน้าร้าน",subtitle:"เลือกโต๊ะ",onBack:()=>e.push("/pos/channels"),icon:(0,n.jsx)(f.Z,{style:{fontSize:20}}),actions:(0,n.jsxs)(c.Z,{size:8,wrap:!0,children:[(0,n.jsxs)(l.Z,{color:"success",children:["ว่าง ",F.available]}),(0,n.jsxs)(l.Z,{color:"warning",children:["ไม่ว่าง ",F.occupied]})]})}),(0,n.jsx)(h.Z,{children:(0,n.jsx)(x.Z,{title:"โต๊ะ",children:r.length>0?(0,n.jsx)(d.Z,{gutter:[16,16],children:I.map((e,t)=>{let a=(0,C.Oi)(e),r=z.ax[a],i="Available"===e.status,o=!e.is_active;return(0,n.jsx)(u.Z,{xs:12,sm:8,md:6,lg:6,xl:4,children:(0,n.jsxs)("article",{style:{...S.yy.channelPageCard,background:o?"#F8FAFC":r.light,border:"2px solid ".concat(r.border),opacity:o?.5:1,cursor:o?"not-allowed":"pointer"},onClick:()=>Z(e,o),onKeyDown:t=>{o||"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),Z(e,o))},role:"button",tabIndex:o?-1:0,"aria-label":"โต๊ะ ".concat(e.table_name," - ").concat(o?"ปิดใช้งาน":i?"ว่าง":"ไม่ว่าง"),"aria-disabled":o,className:"jsx-a961af50cb45fe5b "+"table-card-hover dine-in-table-card dine-in-table-card-mobile table-card-animate table-card-delay-".concat(t%6+1),children:[(0,n.jsx)("div",{style:{...S.yy.channelPageCardGradientOverlay,background:r.gradient},className:"jsx-a961af50cb45fe5b"}),(0,n.jsxs)("div",{style:S.yy.channelPageCardInner,className:"jsx-a961af50cb45fe5b",children:[(0,n.jsx)("div",{style:{background:"".concat(r.primary,"15"),border:"2px solid ".concat(r.primary,"30")},className:"jsx-a961af50cb45fe5b table-icon-wrapper",children:o?(0,n.jsx)(p.Z,{className:"table-icon dine-in-table-icon-mobile",style:{fontSize:32,color:r.primary,transition:"transform 0.3s ease"}}):i?(0,n.jsx)(b.Z,{className:"table-icon dine-in-table-icon-mobile",style:{fontSize:32,color:r.primary,transition:"transform 0.3s ease"}}):(0,n.jsx)(y.Z,{className:"table-icon pulse-soft dine-in-table-icon-mobile",style:{fontSize:32,color:r.primary,transition:"transform 0.3s ease"}})}),(0,n.jsx)("div",{style:{...S.yy.channelPageCardMainText,fontSize:24,color:r.text||r.primary},className:"jsx-a961af50cb45fe5b dine-in-table-name-mobile",children:e.table_name}),(0,n.jsxs)("div",{style:{marginTop:12,display:"flex",flexDirection:"column",gap:6,alignItems:"center"},className:"jsx-a961af50cb45fe5b",children:[!o&&(0,n.jsx)("div",{style:{fontSize:13,fontWeight:700,color:i?z.ax.available.primary:"#EF4444",textTransform:"uppercase",letterSpacing:"0.5px"},className:"jsx-a961af50cb45fe5b",children:i?"● ว่าง":"● ไม่ว่าง"}),(0,n.jsx)("div",{style:{...S.yy.channelPageCardStatusBadge,background:o?"#94A3B8":i?"rgba(16, 185, 129, 0.1)":r.primary,color:o?"#fff":i?z.ax.available.primary:"#fff",border:i?"1px solid ".concat(z.ax.available.border):"none",fontSize:12,padding:"6px 14px"},className:"jsx-a961af50cb45fe5b",children:o?"ปิดใช้งาน":i?"รอรับออเดอร์":e.active_order_status?(0,C.NE)(e.active_order_status):"กำลังใช้งาน"})]})]})]})},e.id)})}):(0,n.jsx)(g.Z,{title:"ยังไม่มีข้อมูลโต๊ะ",description:"กรุณาเพิ่มข้อมูลโต๊ะก่อนเริ่มการขาย",action:(0,n.jsx)(m.ZP,{type:"primary",size:"large",icon:(0,n.jsx)(f.Z,{}),onClick:()=>e.push("/pos/tables"),children:"ไปหน้าจัดการโต๊ะ"})})})})]})]})}},2786:function(e,t,a){"use strict";a.d(t,{Z:function(){return c}});var n=a(57437);a(2265);var r=a(96931),i=a(85180),o=a(39486),s=a(87530);function c(e){let{title:t="ไม่มีข้อมูล",description:a,action:c,image:l}=e;return(0,n.jsx)(r.Z,{size:"small",variant:"outlined",style:{borderRadius:s.H.cardRadiusLG},bodyStyle:{padding:20},children:(0,n.jsx)(i.Z,{image:l,description:(0,n.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[(0,n.jsx)(o.default.Text,{strong:!0,children:t}),a?(0,n.jsx)(o.default.Text,{type:"secondary",children:a}):null]}),children:c})})}},66290:function(e,t,a){"use strict";a.d(t,{$:function(){return c}});var n=a(2913),r=a(71567),i=a(98170);let o=r.q.POS.TABLES,s=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"application/json",a={};return t&&(a["Content-Type"]=t),e&&(a.Cookie=e),a},c={getAll:async(e,t)=>{let a=(0,n.b)("GET",o),r=new URLSearchParams(t||"");r.has("page")||r.set("page","1"),r.has("limit")||r.set("limit","200");let c=r.toString();c&&(a+="?".concat(c));let l=s(e,""),d=await fetch(a,{cache:"no-store",headers:l,credentials:"include"});if(!d.ok){let e=await d.json().catch(()=>({}));throw Error((0,i.i_)(e,"Failed to fetch tables"))}return(0,i.XO)(await d.json())},getById:async(e,t)=>{let a=(0,n.b)("GET","".concat(o,"/").concat(e)),r=s(t,""),c=await fetch(a,{cache:"no-store",headers:r,credentials:"include"});if(!c.ok){let e=await c.json().catch(()=>({}));throw Error((0,i.i_)(e,"Failed to fetch tables"))}return(0,i.hH)(await c.json())},getByName:async(e,t)=>{let a=(0,n.b)("GET","".concat(o,"/getByName/").concat(e)),r=s(t,""),c=await fetch(a,{cache:"no-store",headers:r,credentials:"include"});if(!c.ok){let e=await c.json().catch(()=>({}));throw Error((0,i.i_)(e,"Failed to fetch tables"))}return(0,i.hH)(await c.json())},create:async(e,t,a)=>{let r=(0,n.b)("POST","".concat(o)),c=s(t);a&&(c["X-CSRF-Token"]=a);let l=await fetch(r,{method:"POST",headers:c,credentials:"include",body:JSON.stringify(e)});if(!l.ok){let e=await l.json().catch(()=>({}));throw Error((0,i.i_)(e,"Failed to create table"))}return(0,i.hH)(await l.json())},update:async(e,t,a,r)=>{let c=(0,n.b)("PUT","".concat(o,"/").concat(e)),l=s(a);r&&(l["X-CSRF-Token"]=r);let d=await fetch(c,{method:"PUT",headers:l,credentials:"include",body:JSON.stringify(t)});if(!d.ok){let e=await d.json().catch(()=>({}));throw Error((0,i.i_)(e,"Failed to update table"))}return(0,i.hH)(await d.json())},delete:async(e,t,a)=>{let r=(0,n.b)("DELETE","".concat(o,"/").concat(e)),c=s(t,"");a&&(c["X-CSRF-Token"]=a);let l=await fetch(r,{method:"DELETE",headers:c,credentials:"include"});if(!l.ok){let e=await l.json().catch(()=>({}));throw Error((0,i.i_)(e,"Failed to delete table"))}}}},34962:function(e,t,a){"use strict";var n,r;a.d(t,{c:function(){return n}}),(r=n||(n={})).Available="Available",r.Unavailable="Unavailable"},252:function(e,t,a){"use strict";a.d(t,{NE:function(){return l},Th:function(){return s},Do:function(){return d},Yx:function(){return u},Zu:function(){return m},Oi:function(){return c},W9:function(){return i},Tf:function(){return o}});var n=a(34962),r=a(32446);function i(e){let t={total:e.length,available:0,occupied:0,inactive:0};return e.forEach(e=>{e.is_active?e.status===n.c.Available?t.available++:t.occupied++:t.inactive++}),t}function o(e){return[...e].sort((e,t)=>{let a=parseInt(e.table_name.replace(/\D/g,"")),n=parseInt(t.table_name.replace(/\D/g,""));return isNaN(a)||isNaN(n)?e.table_name.localeCompare(t.table_name):a-n})}function s(e){return e.filter(e=>e.is_active)}function c(e){return e.is_active?"WaitingForPayment"===e.active_order_status?"waitingForPayment":e.status===n.c.Available?"available":"occupied":"inactive"}function l(e){return e?({Pending:"กำลังดำเนินการ",Cooking:"กำลังปรุง",Served:"เสิร์ฟแล้ว",WaitingForOrder:"รอรับออเดอร์",WaitingForPayment:"รอชำระเงิน",Paid:"ชำระเงินแล้ว",Completed:"เสร็จสมบูรณ์",Cancelled:"ยกเลิก"})[e]||e:""}function d(e){return e.reduce((e,t)=>(e.total++,t.status===r.i.Pending&&e.pending++,t.status===r.i.Cooking&&e.cooking++,t.status===r.i.Served&&e.served++,e),{total:0,pending:0,cooking:0,served:0})}function u(e){switch(e.status){case r.i.Pending:case r.i.Cooking:return"occupied";case r.i.Served:return"waitingForPayment";case r.i.Paid:return"available";default:return"inactive"}}let m=e=>{switch(e){case r.m.DineIn:case"DineIn":return"/pos/channels/dine-in";case r.m.TakeAway:case"TakeAway":return"/pos/channels/takeaway";case r.m.Delivery:case"Delivery":return"/pos/channels/delivery";default:return"/pos/orders"}}},61414:function(e,t,a){"use strict";a.d(t,{EO:function(){return g},Gs:function(){return c},HL:function(){return w},M9:function(){return k},Nz:function(){return b},OY:function(){return o},Rr:function(){return x},Wl:function(){return i},d$:function(){return _},d7:function(){return s},iN:function(){return u},jN:function(){return p},ku:function(){return h},mz:function(){return l},qO:function(){return d},xG:function(){return f},yj:function(){return v},zP:function(){return m},zf:function(){return j}});var n=a(32446),r=a(34962);let i=e=>{var t,a;if(e.status===r.c.Available)return"/pos/channels/dine-in/".concat(e.id);let i=e.active_order_id||(null===(t=e.active_order)||void 0===t?void 0:t.id),o=e.active_order_status||(null===(a=e.active_order)||void 0===a?void 0:a.status);return i?o===n.i.WaitingForPayment?"/pos/items/payment/".concat(i):"/pos/orders/".concat(i):"/pos/channels/dine-in/".concat(e.id)},o=e=>{switch(e){case n.i.Pending:return"orange";case n.i.Cooking:return"blue";case n.i.Served:return"green";case n.i.Paid:return"cyan";case n.i.Cancelled:return"red";case n.i.WaitingForPayment:return"gold";default:return"default"}},s=(e,t)=>{switch(e){case n.i.Pending:return"กำลังดำเนินการ";case n.i.Cooking:return"กำลังปรุง";case n.i.Served:if("TakeAway"===t||"Delivery"===t)return"ทำแล้ว";return"เสิร์ฟแล้ว";case n.i.Paid:return"ชำระเงินแล้ว";case n.i.Completed:return"สำเร็จ";case n.i.Cancelled:return"ยกเลิก";case n.i.WaitingForPayment:return"รอชำระเงิน";default:return e}},c=e=>{switch(e){case"DineIn":return"#722ed1";case"TakeAway":return"#fa8c16";case"Delivery":return"#eb2f96";default:return"#1890ff"}},l=e=>{switch(e){case"DineIn":return"ทานที่ร้าน";case"TakeAway":return"สั่งกลับบ้าน";case"Delivery":return"เดลิเวอรี่";default:return e}},d=e=>"DineIn"===e?"เสิร์ฟ":"ทำแล้ว",u=e=>"Delivery"===e?"จัดออเดอร์เสร็จแล้วพร้อมส่งให้ไรเดอร์":"DineIn"===e?"ยืนยันเสิร์ฟพร้อมชำระเงิน":"ยืนยันทำแล้วพร้อมชำระเงิน",m=e=>"DineIn"===e?"เสิร์ฟอาหารแล้ว":"ปรุงเสร็จแล้ว",f=e=>{let t="string"==typeof e?parseFloat(e):e;return"฿".concat(Number(t).toLocaleString("th-TH",{minimumFractionDigits:0,maximumFractionDigits:2}))},p=e=>{var t,a;return"DineIn"===e.order_type?(null===(t=e.table)||void 0===t?void 0:t.table_name)||"ไม่ระบุโต๊ะ":"Delivery"===e.order_type?e.delivery_code||(null===(a=e.delivery)||void 0===a?void 0:a.delivery_name)||"ไม่ระบุข้อมูล":"TakeAway"===e.order_type?e.order_no||"ไม่ระบุเลขที่":e.order_no||"N/A"},b=e=>(null!=e?e:[]).filter(e=>e.status!==n.i.Cancelled),y=e=>(null!=e?e:[]).reduce((e,t)=>e+(Number(t.extra_price)||0),0),h=(e,t,a)=>((Number(e)||0)+y(a))*t,x=e=>b(e).reduce((e,t)=>{var a,n;let r=(null===(n=t.product)||void 0===n?void 0:null===(a=n.category)||void 0===a?void 0:a.display_name)||"ไม่ระบุหมวด";return e[r]=(e[r]||0)+(t.quantity||0),e},{}),v=e=>b(e).reduce((e,t)=>e+Number(t.total_price||0),0),g=e=>"DineIn"===e.order_type?"/pos/channels/dine-in":"TakeAway"===e.order_type?"/pos/channels/takeaway":"Delivery"===e.order_type?"/pos/channels/delivery":"/pos/orders",w=e=>"/pos/orders/".concat(e),k=e=>e.status===n.i.WaitingForPayment?e.order_type===n.m.Delivery?"/pos/items/delivery/".concat(e.id):"/pos/items/payment/".concat(e.id):"/pos/orders/".concat(e.id),_=e=>e===n.m.Delivery?"/pos/channels/delivery":e===n.m.TakeAway?"/pos/channels/takeaway":e===n.m.DineIn?"/pos/channels/dine-in":"/pos/channels",j=(e,t,a,r)=>({order_no:r.orderNo||"ORD-".concat(Date.now()),order_type:t,sub_total:a.subTotal,discount_amount:a.discountAmount,vat:0,total_amount:a.totalAmount,received_amount:0,change_amount:0,status:n.i.Pending,discount_id:r.discountId||null,payment_method_id:null,table_id:r.tableId||null,delivery_id:r.deliveryId||null,delivery_code:r.deliveryCode||null,items:e.map(e=>{var a;let r=t===n.m.Delivery?Number(null!==(a=e.product.price_delivery)&&void 0!==a?a:e.product.price):Number(e.product.price),i=(r+(e.details||[]).reduce((e,t)=>e+Number(t.extra_price),0))*e.quantity;return{product_id:e.product.id,quantity:e.quantity,price:r,total_price:i,discount_amount:0,notes:e.notes||"",status:n.i.Cooking,details:e.details||[]}})})}},function(e){e.O(0,[253,1522,3418,742,9486,4252,3916,8651,6931,4159,3831,2224,2401,9,9845,4221,9763,1713,256,9385,563,2971,2117,1744],function(){return e(e.s=83449)}),_N_E=e.O()}]);