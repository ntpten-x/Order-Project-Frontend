(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7947],{68923:function(t,e,n){Promise.resolve().then(n.bind(n,41555))},41555:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return E}});var a=n(57437),r=n(2265),i=n(99376),u=n(13817),l=n(34029),o=n(62376),s=n(8949),d=n(66290),c=n(53286),_=n(14362),f=n(77961),m=n(20920),b=n(32446),y=n(84859),p=n(252),h=n(3369),g=n(97235);function v(t){let{tableId:e}=t,{showLoading:n,hideLoading:u}=(0,h.x)(),[v,x]=(0,r.useState)(""),[E,P]=(0,r.useState)(""),Z=(0,i.useRouter)(),{user:I}=(0,_.a)(),j=(0,m.L)();(0,r.useEffect)(()=>{(async()=>{n("กำลังโหลดข้อมูล...");try{let[t,n]=await Promise.all([(0,g.P)(),e?d.$.getById(e):Promise.resolve(null)]);t&&x(t);let a=(null==n?void 0:n.data)||n;a&&a.table_name?P(a.table_name):e&&P("โต๊ะ ".concat(e.substring(0,8),"..."))}catch(t){console.error("Failed to load table data:",t),e&&P("โต๊ะ ".concat(e.substring(0,8),"...")),l.ZP.error("ไม่สามารถโหลดข้อมูลโต๊ะได้")}finally{u()}})()},[e,n,u]);let{cartItems:k,clearCart:D,getSubtotal:N,getDiscountAmount:w,getFinalPrice:C,selectedDiscount:O,setOrderMode:R,setReferenceId:q,setReferenceCode:S}=(0,s.j)();(0,r.useEffect)(()=>{R("DINE_IN"),q(e),S(null)},[e,R,q,S]);let T=async()=>{n("กำลังสร้างออเดอร์...");try{let t={order_no:"ORD-".concat(Date.now()),order_type:b.m.DineIn,sub_total:N(),discount_amount:w(),vat:0,total_amount:C(),received_amount:0,change_amount:0,status:b.i.Pending,discount_id:(null==O?void 0:O.id)||null,payment_method_id:null,table_id:e,delivery_id:null,delivery_code:null,created_by_id:(null==I?void 0:I.id)||null,items:k.map(t=>{let e=Number(t.product.price),n=(t.details||[]).reduce((t,e)=>t+Number(e.extra_price),0),a=(e+n)*t.quantity;return{product_id:t.product.id,quantity:t.quantity,price:e,total_price:a,discount_amount:0,notes:t.notes||"",status:b.i.Cooking,details:t.details||[]}})};if(!j){y.x.addToQueue("CREATE_ORDER",t),l.ZP.warning("บันทึกออเดอร์แบบ Offline แล้ว (จะซิงค์เมื่อมีเน็ต)"),D(),Z.push((0,p.Zu)(b.m.DineIn));return}await c.x.create(t,void 0,v),l.ZP.success("สร้างออเดอร์เรียบร้อยแล้ว"),D(),Z.push((0,p.Zu)(b.m.DineIn))}catch(t){l.ZP.error(t instanceof Error?t.message:"ไม่สามารถทำรายการได้")}finally{u()}};return(0,a.jsx)(f.Z,{title:"ระบบขายหน้าร้าน",subtitle:E?"ทานที่ร้าน - โต๊ะ ".concat(E):"ทานที่ร้าน - โต๊ะ ".concat(e.substring(0,8),"..."),icon:(0,a.jsx)(o.Z,{style:{fontSize:28}}),onConfirmOrder:T})}var x=n(25193);function E(){let t=(0,i.useParams)().tableId;return(0,a.jsx)(x.Z,{maxWidth:99999,style:{padding:0},children:(0,a.jsx)(u.default,{style:{background:"transparent"},children:(0,a.jsx)(u.default.Content,{style:{background:"transparent"},children:(0,a.jsx)(v,{tableId:t})})})})}}},function(t){t.O(0,[8024,4736,8592,1744],function(){return t(t.s=68923)}),_N_E=t.O()}]);