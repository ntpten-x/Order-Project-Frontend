(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7947],{68923:function(e,t,n){Promise.resolve().then(n.bind(n,41555))},41555:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return g}});var a=n(57437),r=n(2265),o=n(99376),i=n(34029),c=n(62376),l=n(8949),s=n(66290),u=n(53286),d=n(14362),f=n(77961),h=n(20920),m=n(32446),w=n(84859),y=n(252),E=n(3369),_=n(97235);function b(e){let{tableId:t}=e,{showLoading:n,hideLoading:b}=(0,E.x)(),[g,p]=(0,r.useState)(""),[v,j]=(0,r.useState)(""),P=(0,o.useRouter)(),{user:T}=(0,d.a)(),k=(0,h.L)();(0,r.useEffect)(()=>{(async()=>{n("กำลังโหลดข้อมูล...");try{let[e,n]=await Promise.all([(0,_.P)(),t?s.$.getById(t):Promise.resolve(null)]);e&&p(e),n&&j(n.table_name)}catch(e){i.ZP.error("ไม่สามารถโหลดข้อมูลโต๊ะได้")}finally{b()}})()},[t,n,b]);let{cartItems:S,clearCart:L,getSubtotal:N,getDiscountAmount:O,getFinalPrice:C,selectedDiscount:D,setOrderMode:I,setReferenceId:F,setReferenceCode:R}=(0,l.j)();(0,r.useEffect)(()=>{I("DINE_IN"),F(t),R(null)},[t,I,F,R]);let Z=async()=>{n("กำลังสร้างออเดอร์...");try{let e={order_no:"ORD-".concat(Date.now()),order_type:m.m.DineIn,sub_total:N(),discount_amount:O(),vat:0,total_amount:C(),received_amount:0,change_amount:0,status:m.i.Pending,discount_id:(null==D?void 0:D.id)||null,payment_method_id:null,table_id:t,delivery_id:null,delivery_code:null,created_by_id:(null==T?void 0:T.id)||null,items:S.map(e=>{let t=Number(e.product.price),n=(e.details||[]).reduce((e,t)=>e+Number(t.extra_price),0),a=(t+n)*e.quantity;return{product_id:e.product.id,quantity:e.quantity,price:t,total_price:a,discount_amount:0,notes:e.notes||"",status:m.i.Cooking,details:e.details||[]}})};if(!k){w.x.addToQueue("CREATE_ORDER",e),i.ZP.warning("บันทึกออเดอร์แบบ Offline แล้ว (จะซิงค์เมื่อมีเน็ต)"),L(),P.push((0,y.Zu)(m.m.DineIn));return}await u.x.create(e,void 0,g),i.ZP.success("สร้างออเดอร์เรียบร้อยแล้ว"),L(),P.push((0,y.Zu)(m.m.DineIn))}catch(e){i.ZP.error(e instanceof Error?e.message:"ไม่สามารถทำรายการได้")}finally{b()}};return(0,a.jsx)(f.Z,{title:"ระบบขายหน้าร้าน (Dine In)",subtitle:"ทานที่ร้าน - โต๊ะ ".concat(v||t),icon:(0,a.jsx)(c.Z,{style:{fontSize:28}}),onConfirmOrder:Z})}function g(){let e=(0,o.useParams)().tableId;return(0,a.jsx)(b,{tableId:e})}},20920:function(e,t,n){"use strict";n.d(t,{L:function(){return r}});var a=n(2265);function r(){let[e,t]=(0,a.useState)("undefined"==typeof navigator||navigator.onLine);return(0,a.useEffect)(()=>{let e=()=>t(!0),n=()=>t(!1);return window.addEventListener("online",e),window.addEventListener("offline",n),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",n)}},[]),e}},66290:function(e,t,n){"use strict";n.d(t,{$:function(){return i}});var a=n(2913);let r=n(71567).q.POS.TABLES,o=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"application/json",n={};return t&&(n["Content-Type"]=t),e&&(n.Cookie=e),n},i={getAll:async(e,t)=>{let n=(0,a.b)("GET",r),i=new URLSearchParams(t||"");i.has("page")||i.set("page","1"),i.has("limit")||i.set("limit","200");let c=i.toString();c&&(n+="?".concat(c));let l=o(e,""),s=await fetch(n,{cache:"no-store",headers:l,credentials:"include"});if(!s.ok){let e=await s.json().catch(()=>({}));throw Error(e.error||e.message||"Failed to fetch tables")}return s.json()},getById:async(e,t)=>{let n=(0,a.b)("GET","".concat(r,"/").concat(e)),i=o(t,""),c=await fetch(n,{cache:"no-store",headers:i,credentials:"include"});if(!c.ok){let e=await c.json().catch(()=>({}));throw Error(e.error||e.message||"Failed to fetch tables")}return c.json()},getByName:async(e,t)=>{let n=(0,a.b)("GET","".concat(r,"/getByName/").concat(e)),i=o(t,""),c=await fetch(n,{cache:"no-store",headers:i,credentials:"include"});if(!c.ok){let e=await c.json().catch(()=>({}));throw Error(e.error||e.message||"Failed to fetch tables")}return c.json()},create:async(e,t,n)=>{let i=(0,a.b)("POST","".concat(r)),c=o(t);n&&(c["X-CSRF-Token"]=n);let l=await fetch(i,{method:"POST",headers:c,credentials:"include",body:JSON.stringify(e)});if(!l.ok){let e=await l.json().catch(()=>({}));throw Error(e.error||e.message||"Failed to create table")}return l.json()},update:async(e,t,n,i)=>{let c=(0,a.b)("PUT","".concat(r,"/").concat(e)),l=o(n);i&&(l["X-CSRF-Token"]=i);let s=await fetch(c,{method:"PUT",headers:l,credentials:"include",body:JSON.stringify(t)});if(!s.ok){let e=await s.json().catch(()=>({}));throw Error(e.error||e.message||"Failed to update table")}return s.json()},delete:async(e,t,n)=>{let i=(0,a.b)("DELETE","".concat(r,"/").concat(e)),c=o(t,"");n&&(c["X-CSRF-Token"]=n);let l=await fetch(i,{method:"DELETE",headers:c,credentials:"include"});if(!l.ok){let e=await l.json().catch(()=>({}));throw Error(e.error||e.message||"Failed to delete table")}}}}},function(e){e.O(0,[5015,7717,7698,742,3211,7993,8651,2646,6207,7213,9021,2224,3248,1721,9,5616,8589,5496,3834,19,8056,4547,9763,5713,9356,5799,3680,5101,2971,2117,1744],function(){return e(e.s=68923)}),_N_E=e.O()}]);