(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7947],{68923:function(t,e,n){Promise.resolve().then(n.bind(n,41555))},41555:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return E}});var a=n(57437),i=n(2265),u=n(99376),r=n(34029),l=n(62376),o=n(8949),s=n(66290),c=n(53286),d=n(14362),_=n(77961),f=n(20920),m=n(32446),b=n(84859),y=n(252),p=n(3369),v=n(97235);function h(t){let{tableId:e}=t,{showLoading:n,hideLoading:h}=(0,p.x)(),[E,P]=(0,i.useState)(""),[g,I]=(0,i.useState)(""),Z=(0,u.useRouter)(),{user:x}=(0,d.a)(),D=(0,f.L)();(0,i.useEffect)(()=>{(async()=>{n("กำลังโหลดข้อมูล...");try{let[t,n]=await Promise.all([(0,v.P)(),e?s.$.getById(e):Promise.resolve(null)]);t&&P(t);let a=(null==n?void 0:n.data)||n;a&&a.table_name?I(a.table_name):e&&I("โต๊ะ ".concat(e.substring(0,8),"..."))}catch(t){console.error("Failed to load table data:",t),e&&I("โต๊ะ ".concat(e.substring(0,8),"...")),r.ZP.error("ไม่สามารถโหลดข้อมูลโต๊ะได้")}finally{h()}})()},[e,n,h]);let{cartItems:N,clearCart:w,getSubtotal:O,getDiscountAmount:k,getFinalPrice:C,selectedDiscount:R,setOrderMode:j,setReferenceId:q,setReferenceCode:S}=(0,o.j)();(0,i.useEffect)(()=>{j("DINE_IN"),q(e),S(null)},[e,j,q,S]);let T=async()=>{n("กำลังสร้างออเดอร์...");try{let t={order_no:"ORD-".concat(Date.now()),order_type:m.m.DineIn,sub_total:O(),discount_amount:k(),vat:0,total_amount:C(),received_amount:0,change_amount:0,status:m.i.Pending,discount_id:(null==R?void 0:R.id)||null,payment_method_id:null,table_id:e,delivery_id:null,delivery_code:null,created_by_id:(null==x?void 0:x.id)||null,items:N.map(t=>{let e=Number(t.product.price),n=(t.details||[]).reduce((t,e)=>t+Number(e.extra_price),0),a=(e+n)*t.quantity;return{product_id:t.product.id,quantity:t.quantity,price:e,total_price:a,discount_amount:0,notes:t.notes||"",status:m.i.Cooking,details:t.details||[]}})};if(!D){b.x.addToQueue("CREATE_ORDER",t),r.ZP.warning("บันทึกออเดอร์แบบ Offline แล้ว (จะซิงค์เมื่อมีเน็ต)"),w(),Z.push((0,y.Zu)(m.m.DineIn));return}await c.x.create(t,void 0,E),r.ZP.success("สร้างออเดอร์เรียบร้อยแล้ว"),w(),Z.push((0,y.Zu)(m.m.DineIn))}catch(t){r.ZP.error(t instanceof Error?t.message:"ไม่สามารถทำรายการได้")}finally{h()}};return(0,a.jsx)(_.Z,{title:"ระบบขายหน้าร้าน",subtitle:g?"ทานที่ร้าน - โต๊ะ ".concat(g):"ทานที่ร้าน - โต๊ะ ".concat(e.substring(0,8),"..."),icon:(0,a.jsx)(l.Z,{style:{fontSize:28}}),onConfirmOrder:T})}function E(){let t=(0,u.useParams)().tableId;return(0,a.jsx)(h,{tableId:t})}}},function(t){t.O(0,[8024,4736,8592,1744],function(){return t(t.s=68923)}),_N_E=t.O()}]);