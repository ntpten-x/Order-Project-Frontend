(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7947],{68923:function(t,e,n){Promise.resolve().then(n.bind(n,41555))},41555:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return v}});var a=n(57437),i=n(2265),o=n(99376),r=n(13817),c=n(34029),l=n(62376),s=n(8949),u=n(66290),d=n(53286),f=n(14362),h=n(77961),w=n(20920),_=n(32446),y=n(84859),b=n(252),m=n(3369),E=n(97235);function p(t){let{tableId:e}=t,{showLoading:n,hideLoading:r}=(0,m.x)(),[p,g]=(0,i.useState)(""),[v,j]=(0,i.useState)(""),k=(0,o.useRouter)(),{user:P}=(0,f.a)(),T=(0,w.L)();(0,i.useEffect)(()=>{(async()=>{n("กำลังโหลดข้อมูล...");try{let[t,n]=await Promise.all([(0,E.P)(),e?u.$.getById(e):Promise.resolve(null)]);t&&g(t);let a=(null==n?void 0:n.data)||n;a&&a.table_name?j(a.table_name):e&&j("โต๊ะ ".concat(e.substring(0,8),"..."))}catch(t){console.error("Failed to load table data:",t),e&&j("โต๊ะ ".concat(e.substring(0,8),"...")),c.ZP.error("ไม่สามารถโหลดข้อมูลโต๊ะได้")}finally{r()}})()},[e,n,r]);let{cartItems:S,clearCart:O,getSubtotal:x,getDiscountAmount:C,getFinalPrice:L,selectedDiscount:N,setOrderMode:F,setReferenceId:D,setReferenceCode:I}=(0,s.j)();(0,i.useEffect)(()=>{F("DINE_IN"),D(e),I(null)},[e,F,D,I]);let R=async()=>{n("กำลังสร้างออเดอร์...");try{let t={order_no:"ORD-".concat(Date.now()),order_type:_.m.DineIn,sub_total:x(),discount_amount:C(),vat:0,total_amount:L(),received_amount:0,change_amount:0,status:_.i.Pending,discount_id:(null==N?void 0:N.id)||null,payment_method_id:null,table_id:e,delivery_id:null,delivery_code:null,created_by_id:(null==P?void 0:P.id)||null,items:S.map(t=>{let e=Number(t.product.price),n=(t.details||[]).reduce((t,e)=>t+Number(e.extra_price),0),a=(e+n)*t.quantity;return{product_id:t.product.id,quantity:t.quantity,price:e,total_price:a,discount_amount:0,notes:t.notes||"",status:_.i.Cooking,details:t.details||[]}})};if(!T){y.x.addToQueue("CREATE_ORDER",t),c.ZP.warning("บันทึกออเดอร์แบบ Offline แล้ว (จะซิงค์เมื่อมีเน็ต)"),O(),k.push((0,b.Zu)(_.m.DineIn));return}await d.x.create(t,void 0,p),c.ZP.success("สร้างออเดอร์เรียบร้อยแล้ว"),O(),k.push((0,b.Zu)(_.m.DineIn))}catch(t){c.ZP.error(t instanceof Error?t.message:"ไม่สามารถทำรายการได้")}finally{r()}};return(0,a.jsx)(h.Z,{title:"ระบบขายหน้าร้าน",subtitle:v?"ทานที่ร้าน - โต๊ะ ".concat(v):"ทานที่ร้าน - โต๊ะ ".concat(e.substring(0,8),"..."),icon:(0,a.jsx)(l.Z,{style:{fontSize:28}}),onConfirmOrder:R})}var g=n(25193);function v(){let t=(0,o.useParams)().tableId;return(0,a.jsx)(g.Z,{maxWidth:99999,style:{padding:0},children:(0,a.jsx)(r.default,{style:{background:"transparent"},children:(0,a.jsx)(r.default.Content,{style:{background:"transparent"},children:(0,a.jsx)(p,{tableId:t})})})})}},20920:function(t,e,n){"use strict";n.d(e,{L:function(){return i}});var a=n(2265);function i(){let[t,e]=(0,a.useState)("undefined"==typeof navigator||navigator.onLine);return(0,a.useEffect)(()=>{let t=()=>e(!0),n=()=>e(!1);return window.addEventListener("online",t),window.addEventListener("offline",n),()=>{window.removeEventListener("online",t),window.removeEventListener("offline",n)}},[]),t}},66290:function(t,e,n){"use strict";n.d(e,{$:function(){return l}});var a=n(2913),i=n(71567),o=n(98170);let r=i.q.POS.TABLES,c=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"application/json",n={};return e&&(n["Content-Type"]=e),t&&(n.Cookie=t),n},l={getAll:async(t,e)=>{let n=(0,a.b)("GET",r),i=new URLSearchParams(e||"");i.has("page")||i.set("page","1"),i.has("limit")||i.set("limit","200");let l=i.toString();l&&(n+="?".concat(l));let s=c(t,""),u=await fetch(n,{cache:"no-store",headers:s,credentials:"include"});if(!u.ok){let t=await u.json().catch(()=>({}));throw Error((0,o.i_)(t,"Failed to fetch tables"))}return(0,o.XO)(await u.json())},getById:async(t,e)=>{let n=(0,a.b)("GET","".concat(r,"/").concat(t)),i=c(e,""),l=await fetch(n,{cache:"no-store",headers:i,credentials:"include"});if(!l.ok){let t=await l.json().catch(()=>({}));throw Error((0,o.i_)(t,"Failed to fetch tables"))}return(0,o.hH)(await l.json())},getByName:async(t,e)=>{let n=(0,a.b)("GET","".concat(r,"/getByName/").concat(t)),i=c(e,""),l=await fetch(n,{cache:"no-store",headers:i,credentials:"include"});if(!l.ok){let t=await l.json().catch(()=>({}));throw Error((0,o.i_)(t,"Failed to fetch tables"))}return(0,o.hH)(await l.json())},create:async(t,e,n)=>{let i=(0,a.b)("POST","".concat(r)),l=c(e);n&&(l["X-CSRF-Token"]=n);let s=await fetch(i,{method:"POST",headers:l,credentials:"include",body:JSON.stringify(t)});if(!s.ok){let t=await s.json().catch(()=>({}));throw Error((0,o.i_)(t,"Failed to create table"))}return(0,o.hH)(await s.json())},update:async(t,e,n,i)=>{let l=(0,a.b)("PUT","".concat(r,"/").concat(t)),s=c(n);i&&(s["X-CSRF-Token"]=i);let u=await fetch(l,{method:"PUT",headers:s,credentials:"include",body:JSON.stringify(e)});if(!u.ok){let t=await u.json().catch(()=>({}));throw Error((0,o.i_)(t,"Failed to update table"))}return(0,o.hH)(await u.json())},delete:async(t,e,n)=>{let i=(0,a.b)("DELETE","".concat(r,"/").concat(t)),l=c(e,"");n&&(l["X-CSRF-Token"]=n);let s=await fetch(i,{method:"DELETE",headers:l,credentials:"include"});if(!s.ok){let t=await s.json().catch(()=>({}));throw Error((0,o.i_)(t,"Failed to delete table"))}}}}},function(t){t.O(0,[253,1522,3418,742,9486,4252,3916,8651,4159,3831,2224,3248,2401,9,8879,8589,19,3834,9763,1713,5713,8056,4547,4480,5799,3145,1747,4899,6835,2971,2117,1744],function(){return t(t.s=68923)}),_N_E=t.O()}]);