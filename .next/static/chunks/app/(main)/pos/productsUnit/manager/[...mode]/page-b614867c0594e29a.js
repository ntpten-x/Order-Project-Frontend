(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7736],{40919:function(e,t,a){Promise.resolve().then(a.bind(a,3090))},3090:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return b}});var s=a(57437),n=a(2265),i=a(44967),r=a(34029),o=a(53743),l=a(48651),d=a(88589),c=a(80336),u=a(99376),p=a(82646),m=a(88009),h=a(72175);let{Text:f}=p.default,{pageStyles:g,ManagePageStyles:y}=(0,h.dg)({focusColor:"#722ed1",focusShadow:"rgba(114, 46, 209, 0.1)",switchGradient:"linear-gradient(135deg, #722ed1 0%, #531dab 100%)"}),x=e=>{let{isEdit:t,onBack:a,onDelete:n}=e;return(0,s.jsx)(h.oI,{pageStyles:g,isEdit:t,onBack:a,onDelete:n,titleCreate:"เพิ่มหน่วยสินค้า",titleEdit:"แก้ไขหน่วยสินค้า"})},j=e=>{let{displayName:t,unitName:a}=e;return(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:14,padding:16,background:"#fafafa",borderRadius:16,marginTop:12},children:[(0,s.jsx)("div",{style:{width:60,height:60,borderRadius:14,background:"linear-gradient(135deg, #f9f0ff 0%, #efdbff 100%)",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:(0,s.jsx)(m.Z,{style:{fontSize:24,color:"#722ed1"}})}),(0,s.jsxs)("div",{children:[(0,s.jsx)(f,{strong:!0,style:{display:"block",marginBottom:4},children:t||a||"ตัวอย่างหน่วยสินค้า"}),(0,s.jsx)(f,{type:"secondary",style:{fontSize:12},children:a||"หน่วยนับของสินค้า"})]})]})},k=e=>{let{isEdit:t,loading:a,onCancel:n}=e;return(0,s.jsx)(h.uM,{pageStyles:g,isEdit:t,loading:a,onCancel:n})};var _=a(97235),C=a(3286),v=a(2938);function b(e){let{params:t}=e,a=(0,u.useRouter)(),[p]=i.Z.useForm(),[m,h]=(0,n.useState)(!1),[f,b]=(0,n.useState)(!1),[w,E]=(0,n.useState)(""),[S,Z]=(0,n.useState)(""),[T,P]=(0,n.useState)(""),N=t.mode[0],U=t.mode[1]||null,I="edit"===N&&!!U,{isAuthorized:R,isChecking:z}=(0,C.e)({requiredRole:"Admin"});(0,n.useEffect)(()=>{(async()=>{P(await (0,_.P)())})()},[]);let F=(0,n.useCallback)(async()=>{h(!0);try{let e=await fetch("/api/pos/productsUnit/getById/".concat(U));if(!e.ok)throw Error("ไม่สามารถดึงข้อมูลหน่วยสินค้าได้");let t=await e.json();p.setFieldsValue({unit_name:t.unit_name,display_name:t.display_name,is_active:t.is_active}),E(t.display_name||""),Z(t.unit_name||"")}catch(e){console.error(e),r.ZP.error("ไม่สามารถดึงข้อมูลหน่วยสินค้าได้"),a.push("/pos/productsUnit")}finally{h(!1)}},[U,p,a]);(0,n.useEffect)(()=>{I&&F()},[I,U,F]);let O=async e=>{b(!0);try{if(I){let t=await fetch("/api/pos/productsUnit/update/".concat(U),{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-Token":T},body:JSON.stringify(e)});if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.error||e.message||"ไม่สามารถอัปเดตหน่วยสินค้าได้")}r.ZP.success("อัปเดตหน่วยสินค้าสำเร็จ")}else{let t=await fetch("/api/pos/productsUnit/create",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":T},body:JSON.stringify(e)});if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.error||e.message||"ไม่สามารถสร้างหน่วยสินค้าได้")}r.ZP.success("สร้างหน่วยสินค้าสำเร็จ")}a.push("/pos/productsUnit")}catch(e){console.error(e),r.ZP.error(e.message||(I?"ไม่สามารถอัปเดตหน่วยสินค้าได้":"ไม่สามารถสร้างหน่วยสินค้าได้"))}finally{b(!1)}},B=()=>a.push("/pos/productsUnit");return z?(0,s.jsx)(v.H,{message:"กำลังตรวจสอบสิทธิ์..."}):R?(0,s.jsxs)("div",{className:"manage-page",style:g.container,children:[(0,s.jsx)(y,{}),(0,s.jsx)(x,{isEdit:I,onBack:B,onDelete:I?()=>{U&&o.Z.confirm({title:"ยืนยันการลบหน่วยสินค้า",content:'คุณต้องการลบหน่วย "'.concat(w,'" หรือไม่?'),okText:"ลบ",okType:"danger",cancelText:"ยกเลิก",centered:!0,onOk:async()=>{try{if(!(await fetch("/api/pos/productsUnit/delete/".concat(U),{method:"DELETE",headers:{"X-CSRF-Token":T}})).ok)throw Error("ไม่สามารถลบหน่วยสินค้าได้");r.ZP.success("ลบหน่วยสินค้าสำเร็จ"),a.push("/pos/productsUnit")}catch(e){console.error(e),r.ZP.error("ไม่สามารถลบหน่วยสินค้าได้")}}})}:void 0}),(0,s.jsx)("div",{className:"manage-form-card",style:g.formCard,children:m?(0,s.jsx)("div",{style:{display:"flex",justifyContent:"center",padding:"60px 0"},children:(0,s.jsx)(l.Z,{size:"large"})}):(0,s.jsxs)(i.Z,{form:p,layout:"vertical",onFinish:O,requiredMark:!1,autoComplete:"off",initialValues:{is_active:!0},onValuesChange:e=>{void 0!==e.display_name&&E(e.display_name),void 0!==e.unit_name&&Z(e.unit_name)},children:[(0,s.jsx)(i.Z.Item,{name:"unit_name",label:"ชื่อหน่วย (ภาษาอังกฤษ) *",rules:[{required:!0,message:"กรุณากรอกชื่อหน่วย"},{pattern:/^[a-zA-Z0-9\s\-_().]*$/,message:"กรุณากรอกภาษาอังกฤษเท่านั้น"},{max:100,message:"ความยาวต้องไม่เกิน 100 ตัวอักษร"}],children:(0,s.jsx)(d.default,{size:"large",placeholder:"เช่น Piece, Bottle, Cup",maxLength:100})}),(0,s.jsx)(i.Z.Item,{name:"display_name",label:"ชื่อที่แสดง (ภาษาไทย) *",rules:[{required:!0,message:"กรุณากรอกชื่อที่แสดง"},{max:100,message:"ความยาวต้องไม่เกิน 100 ตัวอักษร"}],children:(0,s.jsx)(d.default,{size:"large",placeholder:"เช่น ชิ้น, ขวด, แก้ว",maxLength:100})}),(0,s.jsx)(j,{displayName:w,unitName:S}),(0,s.jsx)(i.Z.Item,{name:"is_active",label:"สถานะการใช้งาน",valuePropName:"checked",style:{marginTop:20},children:(0,s.jsx)(c.Z,{checkedChildren:"ใช้งาน",unCheckedChildren:"ไม่ใช้งาน"})}),(0,s.jsx)(k,{isEdit:I,loading:f,onCancel:B})]})})]}):(0,s.jsx)(v.H,{message:"คุณไม่มีสิทธิ์เข้าถึงหน้านี้",tone:"danger"})}}},function(e){e.O(0,[5015,7717,7698,742,3211,7993,8651,2646,6207,7213,9021,2224,3248,5616,8589,4967,5775,9046,4243,2971,2117,1744],function(){return e(e.s=40919)}),_N_E=e.O()}]);