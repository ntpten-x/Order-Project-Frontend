(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7736],{40919:function(e,t,s){Promise.resolve().then(s.bind(s,10303))},10303:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return B}});var i=s(57437),n=s(2265),a=s(60283),r=s(61778),l=s(19878),o=s(34029),d=s(53743),c=s(50742),u=s(48651),p=s(47451),y=s(69410),h=s(96931),x=s(88589),m=s(66487),g=s(99376),f=s(25193),j=s(37410),v=s(20148),b=s(1915),_=s(8900),Z=s(26349),k=s(88009),w=s(15424),S=s(78355),C=s(29271),F=s(97235),E=s(67918),P=s(2938),R=s(58525);let{Title:T,Text:I}=a.default,U=e=>{if(!e)return"-";let t=new Date(e);return Number.isNaN(t.getTime())?"-":new Intl.DateTimeFormat("th-TH",{dateStyle:"medium",timeStyle:"short"}).format(t)},z=e=>{let{displayName:t,unitName:s,isActive:n}=e;return(0,i.jsxs)("div",{style:{background:"white",borderRadius:20,padding:20,boxShadow:"0 10px 30px rgba(0,0,0,0.05)",border:"1px solid #F1F5F9"},children:[(0,i.jsx)(T,{level:5,style:{color:"#0e7490",marginBottom:16,fontWeight:700},children:"ตัวอย่างการแสดงผล"}),(0,i.jsxs)("div",{style:{borderRadius:16,border:"1px solid ".concat(n?"#bae6fd":"#e2e8f0"),padding:14,background:n?"#f0f9ff":"#f8fafc",display:"flex",alignItems:"center",gap:12,marginBottom:16},children:[(0,i.jsx)("div",{style:{width:48,height:48,borderRadius:12,background:n?"linear-gradient(135deg, #cffafe 0%, #a5f3fc 100%)":"#e2e8f0",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:(0,i.jsx)(b.Z,{style:{fontSize:20,color:n?"#0e7490":"#64748b"}})}),(0,i.jsxs)("div",{style:{textAlign:"left",flex:1},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,i.jsx)(I,{strong:!0,style:{fontSize:16,color:"#0f172a"},children:t||"ชื่อหน่วยสินค้า"}),n&&(0,i.jsx)(_.Z,{style:{color:"#10B981",fontSize:14}})]}),(0,i.jsx)(I,{type:"secondary",style:{fontSize:13,display:"block"},children:s||"unit_name"})]})]}),(0,i.jsx)(r.Z,{type:n?"success":"warning",showIcon:!0,message:n?"หน่วยสินค้านี้พร้อมใช้งานในหน้า POS":"หน่วยสินค้านี้จะไม่แสดงในหน้า POS"})]})};function B(e){var t,s;let{params:a}=e,b=(0,g.useRouter)(),[_]=l.Z.useForm(),[B,N]=(0,n.useState)(!1),[O,A]=(0,n.useState)(!1),[L,W]=(0,n.useState)(""),[D,q]=(0,n.useState)(""),[H,M]=(0,n.useState)(!0),[V,X]=(0,n.useState)(""),[J,$]=(0,n.useState)(null),G=null===(t=a.mode)||void 0===t?void 0:t[0],K=(null===(s=a.mode)||void 0===s?void 0:s[1])||null,Q="add"===G||"edit"===G,Y="edit"===G&&!!K,{isAuthorized:ee,isChecking:et}=(0,E.e)({allowedRoles:["Admin","Manager"]}),es=(0,n.useMemo)(()=>Y?"แก้ไขหน่วยสินค้า":"เพิ่มหน่วยสินค้า",[Y]);(0,n.useEffect)(()=>{Q&&("edit"!==G||K)||(o.ZP.warning("รูปแบบ URL ไม่ถูกต้อง"),b.replace("/pos/productsUnit"))},[Q,G,K,b]),(0,n.useEffect)(()=>{(async()=>{X(await (0,F.P)())})()},[]);let ei=(0,n.useCallback)(async()=>{if(K){N(!0);try{let e=await fetch("/api/pos/productsUnit/getById/".concat(K));if(!e.ok)throw Error("ไม่สามารถดึงข้อมูลหน่วยสินค้าได้");let t=await e.json();_.setFieldsValue({unit_name:t.unit_name,display_name:t.display_name,is_active:t.is_active}),W(t.display_name||""),q(t.unit_name||""),M(t.is_active),$(t)}catch(e){console.error(e),o.ZP.error("ไม่สามารถดึงข้อมูลหน่วยสินค้าได้"),b.replace("/pos/productsUnit")}finally{N(!1)}}},[K,_,b]);(0,n.useEffect)(()=>{Y&&ei()},[Y,ei]);let en=(0,n.useCallback)(async e=>{var t;let s=e.trim();if(!s||Y&&(null==J?void 0:null===(t=J.unit_name)||void 0===t?void 0:t.toLowerCase())===s.toLowerCase())return!1;try{let e=await fetch("/api/pos/productsUnit/getByName/".concat(encodeURIComponent(s)));if(!e.ok)return!1;let t=await e.json();if(!(null==t?void 0:t.id)||Y&&t.id===K)return!1;return!0}catch(e){return!1}},[K,Y,J]),ea=async e=>{A(!0);try{let t={unit_name:e.unit_name.trim(),display_name:e.display_name.trim(),is_active:e.is_active},s=Y?"/api/pos/productsUnit/update/".concat(K):"/api/pos/productsUnit/create",i=Y?"PUT":"POST",n=await fetch(s,{method:i,headers:{"Content-Type":"application/json","X-CSRF-Token":V},body:JSON.stringify(t)});if(!n.ok){let e=await n.json().catch(()=>({}));throw Error(e.error||e.message||(Y?"ไม่สามารถอัปเดตหน่วยสินค้าได้":"ไม่สามารถสร้างหน่วยสินค้าได้"))}o.ZP.success(Y?"อัปเดตหน่วยสินค้าสำเร็จ":"สร้างหน่วยสินค้าสำเร็จ"),b.push("/pos/productsUnit")}catch(e){console.error(e),o.ZP.error(e instanceof Error?e.message:"ไม่สามารถสร้าง/แก้ไขหน่วยสินค้าได้")}finally{A(!1)}},er=()=>b.push("/pos/productsUnit");return et?(0,i.jsx)(P.H,{message:"กำลังตรวจสอบสิทธิ์..."}):ee?(0,i.jsxs)("div",{className:"manage-page",style:R.R.container,children:[(0,i.jsx)(v.Z,{title:es,subtitle:Y?"ปรับแก้ชื่อหน่วยและสถานะการใช้งาน":"สร้างหน่วยสินค้าใหม่ให้พร้อมใช้งานในระบบ POS",onBack:er,actions:Y?(0,i.jsx)(c.ZP,{danger:!0,onClick:()=>{K&&d.Z.confirm({title:"ยืนยันการลบหน่วยสินค้า",content:'คุณต้องการลบหน่วย "'.concat(L||(null==J?void 0:J.display_name)||"-",'" หรือไม่?'),okText:"ลบ",okType:"danger",cancelText:"ยกเลิก",centered:!0,icon:(0,i.jsx)(Z.Z,{style:{color:"#EF4444"}}),onOk:async()=>{try{if(!(await fetch("/api/pos/productsUnit/delete/".concat(K),{method:"DELETE",headers:{"X-CSRF-Token":V}})).ok)throw Error("ไม่สามารถลบหน่วยสินค้าได้");o.ZP.success("ลบหน่วยสินค้าสำเร็จ"),b.push("/pos/productsUnit")}catch(e){console.error(e),o.ZP.error("ไม่สามารถลบหน่วยสินค้าได้")}}})},icon:(0,i.jsx)(Z.Z,{}),children:"ลบ"}):null}),(0,i.jsx)(f.Z,{maxWidth:1040,children:(0,i.jsx)(j.Z,{style:{background:"transparent",border:"none"},children:B?(0,i.jsx)("div",{style:{display:"flex",justifyContent:"center",padding:"90px 0"},children:(0,i.jsx)(u.Z,{size:"large",tip:"กำลังโหลดข้อมูล..."})}):(0,i.jsxs)(p.Z,{gutter:[20,20],children:[(0,i.jsx)(y.Z,{xs:24,lg:15,children:(0,i.jsxs)(h.Z,{bordered:!1,style:{borderRadius:20,boxShadow:"0 4px 20px rgba(0,0,0,0.04)",overflow:"hidden"},styles:{body:{padding:24}},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:10,marginBottom:20},children:[(0,i.jsx)(k.Z,{style:{fontSize:20,color:"#0e7490"}}),(0,i.jsx)(T,{level:5,style:{margin:0},children:"ข้อมูลหน่วยสินค้า"})]}),(0,i.jsxs)(l.Z,{form:_,layout:"vertical",onFinish:ea,requiredMark:!1,autoComplete:"off",initialValues:{is_active:!0},onValuesChange:e=>{void 0!==e.display_name&&W(e.display_name),void 0!==e.unit_name&&q(e.unit_name),void 0!==e.is_active&&M(e.is_active)},children:[(0,i.jsx)(l.Z.Item,{name:"unit_name",label:(0,i.jsx)("span",{style:{fontWeight:600,color:"#334155"},children:"ชื่อระบบ (unit_name)"}),validateTrigger:["onBlur","onSubmit"],rules:[{required:!0,message:"กรุณากรอกชื่อระบบ"},{pattern:/^[a-zA-Z0-9\s\-_().]*$/,message:"กรอกได้เฉพาะภาษาอังกฤษ ตัวเลข และ - _ ( ) ."},{max:100,message:"ความยาวต้องไม่เกิน 100 ตัวอักษร"},{validator:async(e,t)=>{if((null==t?void 0:t.trim())&&await en(t))throw Error("ชื่อระบบนี้ถูกใช้งานแล้ว")}}],children:(0,i.jsx)(x.default,{size:"large",placeholder:"เช่น piece, box, kg",style:{borderRadius:12,height:46,backgroundColor:"#F8FAFC",border:"1px solid #E2E8F0"},maxLength:100})}),(0,i.jsx)(l.Z.Item,{name:"display_name",label:(0,i.jsx)("span",{style:{fontWeight:600,color:"#334155"},children:"ชื่อที่แสดง"}),rules:[{required:!0,message:"กรุณากรอกชื่อที่แสดง"},{max:100,message:"ความยาวต้องไม่เกิน 100 ตัวอักษร"}],children:(0,i.jsx)(x.default,{size:"large",placeholder:"เช่น ชิ้น, กล่อง, กิโลกรัม",style:{borderRadius:12,height:46,backgroundColor:"#F8FAFC",border:"1px solid #E2E8F0"},maxLength:100})}),(0,i.jsx)("div",{style:{padding:"16px",background:"#F8FAFC",borderRadius:14,marginTop:16,marginBottom:18},children:(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:12},children:[(0,i.jsxs)("div",{children:[(0,i.jsx)(I,{strong:!0,style:{fontSize:15,display:"block"},children:"สถานะการใช้งาน"}),(0,i.jsx)(I,{type:"secondary",style:{fontSize:13},children:"เปิดเพื่อให้แสดงในหน้าขายสินค้า POS"})]}),(0,i.jsx)(l.Z.Item,{name:"is_active",valuePropName:"checked",noStyle:!0,children:(0,i.jsx)(m.Z,{style:{background:H?"#10B981":void 0}})})]})}),(0,i.jsx)(r.Z,{showIcon:!0,type:"info",icon:(0,i.jsx)(w.Z,{}),message:"ข้อมูลที่จำเป็น",description:"ต้องกรอกชื่อระบบและชื่อที่แสดง โดยชื่อระบบจะถูกตรวจสอบไม่ให้ซ้ำในสาขาเดียวกัน",style:{marginBottom:24}}),(0,i.jsxs)("div",{style:{marginTop:12,display:"flex",gap:12},children:[(0,i.jsx)(c.ZP,{size:"large",onClick:er,style:{flex:1,borderRadius:12,height:46,fontWeight:600},children:"ยกเลิก"}),(0,i.jsx)(c.ZP,{type:"primary",htmlType:"submit",loading:O,icon:(0,i.jsx)(S.Z,{}),style:{flex:2,borderRadius:12,height:46,fontWeight:600,background:"#0e7490",boxShadow:"0 4px 12px rgba(14, 116, 144, 0.25)"},children:"บันทึกข้อมูล"})]})]})]})}),(0,i.jsx)(y.Z,{xs:24,lg:9,children:(0,i.jsxs)("div",{style:{display:"grid",gap:14},children:[(0,i.jsx)(z,{displayName:L,unitName:D,isActive:H}),Y?(0,i.jsxs)(h.Z,{style:{borderRadius:16},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:10},children:[(0,i.jsx)(C.Z,{style:{color:"#0369a1"}}),(0,i.jsx)(I,{strong:!0,children:"รายละเอียดรายการ"})]}),(0,i.jsxs)("div",{style:{display:"grid",gap:8},children:[(0,i.jsxs)(I,{type:"secondary",children:["ID: ",(null==J?void 0:J.id)||"-"]}),(0,i.jsxs)(I,{type:"secondary",children:["สร้างเมื่อ: ",U(null==J?void 0:J.create_date)]}),(0,i.jsxs)(I,{type:"secondary",children:["อัปเดตเมื่อ: ",U(null==J?void 0:J.update_date)]})]})]}):null]})})]})})})]}):(0,i.jsx)(P.H,{message:"คุณไม่มีสิทธิ์เข้าถึงหน้านี้",tone:"danger"})}}},function(e){e.O(0,[8024,4736,8592,1744],function(){return e(e.s=40919)}),_N_E=e.O()}]);