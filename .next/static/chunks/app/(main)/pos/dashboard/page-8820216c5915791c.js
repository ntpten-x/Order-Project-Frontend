(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1633,3490],{20067:function(){},72061:function(){},80351:function(e,t,r){Promise.resolve().then(r.bind(r,18826))},18826:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return X}});var o=r(57437),a=r(2265),n=r(82646),i=r(7408),l=r(34029),s=r(91652),c=r(48651),d=r(47451),u=r(69410),f=r(50742),h=r(83410),g=r(96931),m=r(45235),p=r(2297),b=r(80009),x=r(52539),y=r(29332),S=r(89245),_=r(50010),v=r(60216),j=r(73879),w=r(42318),k=r(6520),E=r(53375),Z=r(46994),T=r(2093),P=r(71096),C=r.n(P);r(6729),C().locale("th");let I=e=>{var t;let r=e.lastAutoTable;return null!==(t=null==r?void 0:r.finalY)&&void 0!==t?t:0},R=function(e,t,r){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"ร้านค้า POS",a=new E.ZP,n=a.internal.pageSize.getWidth();a.setFontSize(18),a.text(o,n/2,20,{align:"center"}),a.setFontSize(14),a.text("รายงานยอดขาย",n/2,30,{align:"center"}),a.setFontSize(10),a.text("ช่วงวันที่: ".concat(r[0]," - ").concat(r[1]),n/2,38,{align:"center"}),a.text("พิมพ์เมื่อ: ".concat(C()().format("DD/MM/YYYY HH:mm")),n/2,44,{align:"center"});let i=e.reduce((e,t)=>e+Number(t.total_sales),0),l=e.reduce((e,t)=>e+Number(t.total_orders),0),s=e.reduce((e,t)=>e+Number(t.total_discount),0),c=e.reduce((e,t)=>e+Number(t.delivery_sales||0),0);a.setFontSize(12),a.text("สรุปยอดรวม",14,55),a.setFontSize(10),a.text("ยอดขายรวม: ".concat(i.toLocaleString()," บาท"),14,63),a.text("จำนวนออเดอร์: ".concat(l.toLocaleString()," รายการ"),14,70),a.text("ยอดขายเดลิเวอรี่: ".concat(c.toLocaleString()," บาท"),14,77),a.text("ส่วนลดรวม: ".concat(s.toLocaleString()," บาท"),14,84),(0,Z.ZP)(a,{startY:92,head:[["วันที่","ออเดอร์","ยอดขาย","เงินสด","เดลิเวอรี่","ส่วนลด"]],body:e.map(e=>[C()(e.date).format("DD/MM/YYYY"),e.total_orders.toString(),"".concat(Number(e.total_sales).toLocaleString()),"".concat(Number(e.cash_sales).toLocaleString()),"".concat(Number(e.delivery_sales||0).toLocaleString()),"".concat(Number(e.total_discount).toLocaleString())]),theme:"grid",headStyles:{fillColor:[102,126,234]},styles:{fontSize:9}});let d=I(a)+10;a.setFontSize(12),a.text("สินค้าขายดี 5 อันดับ",14,d),(0,Z.ZP)(a,{startY:d+5,head:[["อันดับ","สินค้า","จำนวน","ยอดขาย (บาท)"]],body:t.map((e,t)=>[(t+1).toString(),e.product_name,e.total_quantity.toString(),Number(e.total_revenue).toLocaleString()]),theme:"grid",headStyles:{fillColor:[82,196,26]},styles:{fontSize:9}}),a.save("รายงานยอดขาย_".concat(r[0],"_").concat(r[1],".pdf"))},D=(e,t,r)=>{let o=T.P6.book_new(),a=e.map(e=>[C()(e.date).format("DD/MM/YYYY"),e.total_orders,Number(e.total_sales),Number(e.cash_sales),Number(e.qr_sales),Number(e.delivery_sales||0),Number(e.total_discount)]),n=T.P6.aoa_to_sheet([["วันที่","จำนวนออเดอร์","ยอดขายรวม","เงินสด","QR","เดลิเวอรี่","ส่วนลด"],...a]);T.P6.book_append_sheet(o,n,"ยอดขายรายวัน");let i=t.map((e,t)=>[t+1,e.product_name,e.total_quantity,Number(e.total_revenue)]),l=T.P6.aoa_to_sheet([["อันดับ","สินค้า","จำนวนขาย","ยอดขาย (บาท)"],...i]);T.P6.book_append_sheet(o,l,"สินค้าขายดี");let s=e.reduce((e,t)=>e+Number(t.total_sales),0),c=e.reduce((e,t)=>e+Number(t.total_orders),0),d=e.reduce((e,t)=>e+Number(t.total_discount),0),u=e.reduce((e,t)=>e+Number(t.delivery_sales||0),0),f=[["รายงานยอดขาย"],["ช่วงวันที่: ".concat(r[0]," - ").concat(r[1])],[],["รายการ","ยอดรวม"],["ยอดขายรวม",s],["จำนวนออเดอร์",c],["ยอดขายเดลิเวอรี่",u],["ส่วนลดรวม",d]],h=T.P6.aoa_to_sheet(f);T.P6.book_append_sheet(o,h,"สรุป"),T.NC(o,"รายงานยอดขาย_".concat(r[0],"_").concat(r[1],".xlsx"))};var N=r(99376),O=r(44225),A=r(71567);let Y={getSalesSummary:async(e,t)=>{let r=await fetch("".concat(A.v).concat(A.q.POS.DASHBOARD.SALES,"?startDate=").concat(e,"&endDate=").concat(t),{method:"GET",headers:{"Content-Type":"application/json"}});if(!r.ok)throw Error("Failed to fetch sales summary");return r.json()},getTopSellingItems:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t=await fetch("".concat(A.v).concat(A.q.POS.DASHBOARD.TOP_ITEMS,"?limit=").concat(e),{method:"GET",headers:{"Content-Type":"application/json"}});if(!t.ok)throw Error("Failed to fetch top selling items");return t.json()}};var L=r(53286),M=r(32446),B=r(3369),F=r(24675),Q=r(67697);let{Title:z,Text:U}=n.default,{RangePicker:H}=i.default;function X(){let e=(0,N.useRouter)(),{showLoading:t,hideLoading:r}=(0,B.x)(),{socket:n}=(0,F.s)(),[i,E]=(0,a.useState)([]),[Z,T]=(0,a.useState)([]),[P,I]=(0,a.useState)([]),[A,X]=(0,a.useState)(!0),[q,G]=(0,a.useState)([C()().startOf("month"),C()().endOf("month")]),W=(0,a.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e||X(!0);try{let e=q[0].format("YYYY-MM-DD"),t=q[1].format("YYYY-MM-DD"),[r,o,a]=await Promise.all([Y.getSalesSummary(e,t),Y.getTopSellingItems(5),L.x.getAllSummary(void 0,1,10,"Paid,Cancelled")]);E(r),T(o),I(a.data||[])}catch(e){}finally{e||X(!1)}},[q]);(0,a.useEffect)(()=>{W(!1)},[W]),(0,Q.D)({socket:n,events:["orders:update","orders:create","orders:delete","payments:create"],onRefresh:()=>W(!0),intervalMs:2e4,debounceMs:1e3});let J=i.reduce((e,t)=>e+Number(t.total_sales),0),V=i.reduce((e,t)=>e+Number(t.total_orders),0),K=i.reduce((e,t)=>e+Number(t.total_discount),0),$=i.reduce((e,t)=>e+Number(t.delivery_sales||0),0),ee=i.reduce((e,t)=>e+Number(t.dine_in_sales||0),0),et=i.reduce((e,t)=>e+Number(t.takeaway_sales||0),0),er=P.length>10,eo=[{title:"#",key:"index",width:60,render:(e,t,r)=>r+1},{title:"สินค้า",dataIndex:"product_name",key:"name",render:(e,t)=>(0,o.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12},children:[(0,o.jsx)(s.Z,{shape:"square",src:t.img_url,icon:(0,o.jsx)(x.Z,{})}),(0,o.jsx)(U,{children:e})]})},{title:"ยอดขาย (ชิ้น)",dataIndex:"total_quantity",key:"qty",align:"center"},{title:"ยอดขาย (บาท)",dataIndex:"total_revenue",key:"revenue",align:"right",render:e=>"฿".concat(Number(e).toLocaleString())}];return A?(0,o.jsx)("div",{style:{...O.Np.container,display:"flex",justifyContent:"center",alignItems:"center"},children:(0,o.jsx)(c.Z,{size:"large",tip:"กำลังโหลดข้อมูล..."})}):(0,o.jsxs)("div",{style:O.Np.container,children:[(0,o.jsx)("div",{style:{...O.Np.heroParams,paddingBottom:60},children:(0,o.jsxs)("div",{style:{maxWidth:1200,margin:"0 auto",position:"relative",zIndex:10},children:[(0,o.jsx)("div",{style:O.Np.sectionTitle,children:(0,o.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:16},children:[(0,o.jsx)(y.Z,{style:{fontSize:32,color:"#fff"}}),(0,o.jsxs)("div",{children:[(0,o.jsx)(z,{level:3,style:{margin:0,color:"#fff"},children:"Dashboard"}),(0,o.jsx)(U,{style:{color:"rgba(255,255,255,0.85)"},children:"ภาพรวมยอดขายร้านค้า"})]})]})}),(0,o.jsxs)(d.Z,{gutter:16,align:"middle",children:[(0,o.jsx)(u.Z,{children:(0,o.jsx)(H,{style:{borderRadius:8,padding:"8px 16px"},value:q,onChange:e=>e&&G([e[0],e[1]]),allowClear:!1})}),(0,o.jsx)(u.Z,{children:(0,o.jsx)(f.ZP,{icon:(0,o.jsx)(S.Z,{}),onClick:()=>W(!1),type:"default",style:{borderRadius:8,background:"rgba(255,255,255,0.2)",border:"none",color:"#fff"},children:"รีเฟรช"})}),(0,o.jsx)(u.Z,{children:(0,o.jsx)(h.Z,{menu:{items:[{key:"pdf",icon:(0,o.jsx)(_.Z,{}),label:"ส่งออก PDF",onClick:()=>{try{t("กำลังสร้าง PDF..."),R(i,Z,[q[0].format("YYYY-MM-DD"),q[1].format("YYYY-MM-DD")]),l.ZP.success("ส่งออก PDF สำเร็จ")}catch(e){l.ZP.error("เกิดข้อผิดพลาดในการส่งออก PDF")}finally{r()}}},{key:"excel",icon:(0,o.jsx)(v.Z,{}),label:"ส่งออก Excel",onClick:()=>{try{t("กำลังสร้าง Excel..."),D(i,Z,[q[0].format("YYYY-MM-DD"),q[1].format("YYYY-MM-DD")]),l.ZP.success("ส่งออก Excel สำเร็จ")}catch(e){l.ZP.error("เกิดข้อผิดพลาดในการส่งออก Excel")}finally{r()}}}]},trigger:["click"],disabled:A||0===i.length,children:(0,o.jsx)(f.ZP,{icon:(0,o.jsx)(j.Z,{}),type:"primary",style:{borderRadius:8},children:"ส่งออกรายงาน"})})})]})]})}),(0,o.jsxs)("div",{style:{maxWidth:1200,margin:"-40px auto 30px",padding:"0 24px",position:"relative",zIndex:20},children:[(0,o.jsxs)(d.Z,{gutter:[24,24],style:{marginBottom:24},children:[(0,o.jsx)(u.Z,{xs:24,sm:8,children:(0,o.jsx)(g.Z,{bordered:!1,style:{borderRadius:16,boxShadow:"0 4px 12px rgba(0,0,0,0.05)"},children:(0,o.jsx)(m.Z,{title:"ยอดขายรวม",value:J,precision:2,prefix:(0,o.jsx)(w.Z,{style:{color:O.X1.primary}}),suffix:"฿",valueStyle:{color:O.X1.primary,fontWeight:"bold"}})})}),(0,o.jsx)(u.Z,{xs:24,sm:8,children:(0,o.jsx)(g.Z,{bordered:!1,style:{borderRadius:16,boxShadow:"0 4px 12px rgba(0,0,0,0.05)"},children:(0,o.jsx)(m.Z,{title:"จำนวนออเดอร์",value:V,prefix:(0,o.jsx)(x.Z,{style:{color:"#52c41a"}}),suffix:"รายการ",valueStyle:{fontWeight:"bold"}})})}),(0,o.jsx)(u.Z,{xs:24,sm:8,children:(0,o.jsx)(g.Z,{bordered:!1,style:{borderRadius:16,boxShadow:"0 4px 12px rgba(0,0,0,0.05)"},children:(0,o.jsx)(m.Z,{title:"ส่วนลดทั้งหมด",value:K,precision:2,prefix:(0,o.jsx)(y.Z,{style:{color:"#ff4d4f"}}),suffix:"฿",valueStyle:{color:"#ff4d4f",fontWeight:"bold"}})})})]}),(0,o.jsxs)(d.Z,{gutter:[24,24],style:{marginBottom:24},children:[(0,o.jsx)(u.Z,{xs:24,sm:8,children:(0,o.jsx)(g.Z,{bordered:!1,style:{borderRadius:16,boxShadow:"0 4px 12px rgba(0,0,0,0.05)"},children:(0,o.jsx)(m.Z,{title:"ยอดขายทานที่ร้าน",value:ee,precision:2,prefix:(0,o.jsx)(w.Z,{style:{color:"#1890ff"}}),suffix:"฿",valueStyle:{color:"#1890ff",fontWeight:"bold"}})})}),(0,o.jsx)(u.Z,{xs:24,sm:8,children:(0,o.jsx)(g.Z,{bordered:!1,style:{borderRadius:16,boxShadow:"0 4px 12px rgba(0,0,0,0.05)"},children:(0,o.jsx)(m.Z,{title:"ยอดขายกลับบ้าน",value:et,precision:2,prefix:(0,o.jsx)(x.Z,{style:{color:"#52c41a"}}),suffix:"฿",valueStyle:{color:"#52c41a",fontWeight:"bold"}})})}),(0,o.jsx)(u.Z,{xs:24,sm:8,children:(0,o.jsx)(g.Z,{bordered:!1,style:{borderRadius:16,boxShadow:"0 4px 12px rgba(0,0,0,0.05)"},children:(0,o.jsx)(m.Z,{title:"ยอดขายเดลิเวอรี่",value:$,precision:2,prefix:(0,o.jsx)(y.Z,{style:{color:"#eb2f96"}}),suffix:"฿",valueStyle:{color:"#eb2f96",fontWeight:"bold"}})})})]}),(0,o.jsxs)(d.Z,{gutter:[24,24],children:[(0,o.jsx)(u.Z,{xs:24,lg:16,children:(0,o.jsx)(g.Z,{title:"รายการยอดขายรายวัน",bordered:!1,style:{borderRadius:16,boxShadow:"0 4px 12px rgba(0,0,0,0.05)"},children:(0,o.jsx)(p.Z,{dataSource:i,loading:A,rowKey:"date",pagination:{pageSize:5},columns:[{title:"วันที่",dataIndex:"date",render:e=>C()(e).format("DD MMM YYYY")},{title:"ออเดอร์",dataIndex:"total_orders",align:"center"},{title:"ยอดขาย",dataIndex:"total_sales",align:"right",render:e=>(0,o.jsxs)("strong",{children:["฿",Number(e).toLocaleString()]})},{title:"เงินสด",dataIndex:"cash_sales",align:"right",render:e=>"฿".concat(Number(e).toLocaleString())},{title:"เดลิเวอรี่",dataIndex:"delivery_sales",align:"right",render:e=>(0,o.jsxs)("span",{style:{color:"#eb2f96"},children:["฿",Number(e||0).toLocaleString()]})}]})})}),(0,o.jsx)(u.Z,{xs:24,lg:8,children:(0,o.jsx)(g.Z,{title:"5 สินค้าขายดี",bordered:!1,style:{borderRadius:16,boxShadow:"0 4px 12px rgba(0,0,0,0.05)",height:"100%"},children:(0,o.jsx)(p.Z,{dataSource:Z,columns:eo,pagination:!1,size:"small",rowKey:"product_id",loading:A})})})]}),(0,o.jsx)(d.Z,{style:{marginTop:24},children:(0,o.jsx)(u.Z,{xs:24,children:(0,o.jsx)(g.Z,{title:"ออเดอร์ล่าสุด",bordered:!1,style:{borderRadius:16,boxShadow:"0 4px 12px rgba(0,0,0,0.05)"},children:(0,o.jsx)(p.Z,{dataSource:P,loading:A,rowKey:"id",virtual:er,scroll:er?{y:360}:void 0,pagination:!1,columns:[{title:"เลขที่",dataIndex:"order_no",key:"order_no",render:e=>(0,o.jsxs)(b.Z,{color:"blue",children:["#",e]})},{title:"วันเวลา",dataIndex:"create_date",key:"date",render:e=>C()(e).format("DD/MM/YYYY HH:mm")},{title:"ประเภท",dataIndex:"order_type",key:"type",render:e=>{var t,r;let a={[M.m.DineIn]:{label:"ทานที่ร้าน",color:"blue"},[M.m.TakeAway]:{label:"กลับบ้าน",color:"green"},[M.m.Delivery]:{label:"เดลิเวอรี่",color:"orange"}};return(0,o.jsx)(b.Z,{color:(null===(t=a[e])||void 0===t?void 0:t.color)||"default",children:(null===(r=a[e])||void 0===r?void 0:r.label)||e})}},{title:"ยอดรวม",dataIndex:"total_amount",key:"total",align:"right",render:e=>(0,o.jsxs)("strong",{children:["฿",Number(e).toLocaleString()]})},{title:"สถานะ",dataIndex:"status",key:"status",render:e=>{var t,r;let a={[M.i.Paid]:{label:"ชำระแล้ว",color:"green"},[M.i.Cancelled]:{label:"ยกเลิก",color:"red"}};return(0,o.jsx)(b.Z,{color:(null===(t=a[e])||void 0===t?void 0:t.color)||"default",children:(null===(r=a[e])||void 0===r?void 0:r.label)||e})}},{title:"",key:"action",width:100,render:(t,r)=>(0,o.jsx)(f.ZP,{type:"primary",icon:(0,o.jsx)(k.Z,{}),size:"small",onClick:()=>e.push("/pos/dashboard/".concat(r.id)),children:"ดูรายละเอียด"})}]})})})})]})]})}C().locale("th")},71567:function(e,t,r){"use strict";r.d(t,{q:function(){return a},v:function(){return o}});let o="/api",a={AUTH:{LOGIN:"/auth/login",ME:"/auth/me",CSRF:"/csrf"},POS:{PRODUCTS:"/pos/products",ORDERS:"/pos/orders",TABLES:"/pos/tables",DISCOUNTS:"/pos/discounts",DELIVERY:"/pos/delivery",PAYMENT_METHODS:"/pos/paymentMethod",PAYMENTS:"/pos/payments",CATEGORY:"/pos/category",SHIFTS:{BASE:"/pos/shifts",CURRENT:"/pos/shifts/current",OPEN:"/pos/shifts/open",CLOSE:"/pos/shifts/close"},DASHBOARD:{SALES:"/pos/dashboard/sales",TOP_ITEMS:"/pos/dashboard/top-items"},CHANNELS:{STATS:"/pos/orders/stats"},SHOP_PROFILE:"/pos/shopProfile",SALES_ORDER_ITEMS:"/pos/salesOrderItem",SALES_ORDER_DETAILS:"/pos/salesOrderDetail",PRODUCTS_UNIT:"/pos/productsUnit",PAYMENT_DETAILS:"/pos/paymentDetails",BRANCH:"/branches"}}},14362:function(e,t,r){"use strict";r.d(t,{AuthProvider:function(){return u},a:function(){return f}});var o=r(57437),a=r(2265),n=r(99376),i=r(5447),l=r(84859),s=r(48651),c=r(3369);let d=(0,a.createContext)(void 0),u=e=>{let{children:t}=e,[r,u]=(0,a.useState)(null),[f,h]=(0,a.useState)(!0),g=(0,n.useRouter)(),m=(0,n.usePathname)(),p=async()=>{try{let e="";e=localStorage.getItem("token_ws")||"";let t=await i.O.getMe(e);u(t)}catch(e){u(null)}finally{h(!1)}};(0,a.useEffect)(()=>{p()},[]);let{showLoading:b,hideLoading:x}=(0,c.x)();(0,a.useEffect)(()=>{f||r||"/login"===m||g.push("/login")},[r,f,m,g]);let y=async e=>{try{b("กำลังเข้าสู่ระบบ...");let t=await i.O.getCsrfToken(),{token:r,...o}=await i.O.login(e,t);r&&localStorage.setItem("token_ws",r),u(o),g.push("/")}catch(e){throw e}finally{x()}},S=async()=>{try{b("กำลังออกจากระบบ...");let e="";e=localStorage.getItem("token_ws")||"",await i.O.logout(e),localStorage.removeItem("token_ws"),l.x.clearQueue(),u(null),g.push("/login")}catch(e){console.error("Logout error:",e)}finally{x()}};return f?(0,o.jsx)("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-white",children:(0,o.jsx)(s.Z,{size:"large"})}):r||"/login"===m?(0,o.jsx)(d.Provider,{value:{user:r,loading:f,login:y,logout:S,checkAuth:p},children:t}):null},f=()=>{let e=(0,a.useContext)(d);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}},46252:function(e,t,r){"use strict";r.d(t,{J:function(){return l},SocketProvider:function(){return s}});var o=r(57437),a=r(2265),n=r(68680),i=r(14362);let l=(0,a.createContext)({socket:null,isConnected:!1}),s=e=>{let{children:t}=e,[r,s]=(0,a.useState)(null),[c,d]=(0,a.useState)(!1),{user:u}=(0,i.a)();return(0,a.useEffect)(()=>{if(!u){r&&(r.disconnect(),s(null),d(!1));return}let e=localStorage.getItem("token_ws"),t=(0,n.io)("http://localhost:3000",{transports:["websocket"],withCredentials:!0,auth:e?{token:e}:void 0});return t.on("connect",()=>{console.log("Socket Connected:",t.id),d(!0)}),t.on("disconnect",()=>{console.log("Socket Disconnected"),d(!1)}),s(t),()=>{t.disconnect()}},[u]),(0,o.jsx)(l.Provider,{value:{socket:r,isConnected:c},children:t})}},3369:function(e,t,r){"use strict";r.d(t,{GlobalLoadingProvider:function(){return s},O:function(){return d},x:function(){return c}});var o=r(57437),a=r(2265),n=r(48651);let i=(0,a.createContext)(void 0),l=(0,a.createContext)(void 0),s=e=>{let{children:t}=e,[r,s]=(0,a.useState)({}),[c,d]=(0,a.useState)(void 0),u=(0,a.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default";s(e=>({...e,[t]:(e[t]||0)+1})),e&&d(e)},[]),f=(0,a.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";s(t=>{if(!t[e])return t;let r={...t};return r[e]-=1,r[e]<=0&&delete r[e],r})},[]),h=(0,a.useCallback)(()=>{s({}),d(void 0)},[]),g=Object.keys(r).length>0,m=(0,a.useMemo)(()=>({isLoading:g,loadingMessage:c}),[g,c]),p=(0,a.useMemo)(()=>({showLoading:u,hideLoading:f,resetLoading:h}),[u,f,h]);return(0,o.jsx)(l.Provider,{value:p,children:(0,o.jsxs)(i.Provider,{value:m,children:[t,g&&(0,o.jsx)("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center pointer-events-auto bg-black/10 backdrop-blur-[1px]",children:(0,o.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:10,background:"rgba(255, 255, 255, 0.9)",padding:"20px 40px",borderRadius:12,boxShadow:"0 4px 12px rgba(0,0,0,0.1)"},children:[(0,o.jsx)(n.Z,{size:"large"}),c&&(0,o.jsx)("div",{style:{fontSize:14,color:"#1f1f1f",fontWeight:500},children:c})]})})]})})};function c(){let e=(0,a.useContext)(i),t=(0,a.useContext)(l);if(!e||!t)throw Error("useGlobalLoading must be used within a GlobalLoadingProvider");return(0,a.useMemo)(()=>({...e,...t}),[e,t])}function d(){let e=(0,a.useContext)(l);if(!e)throw Error("useGlobalLoadingDispatch must be used within a GlobalLoadingProvider");return e}},24675:function(e,t,r){"use strict";r.d(t,{s:function(){return n}});var o=r(2265),a=r(46252);let n=()=>(0,o.useContext)(a.J)},2913:function(e,t,r){"use strict";function o(e,t){return({GET:"".concat(a.API_BASE_URL).concat(t),POST:"".concat(a.API_BASE_URL).concat(t),PUT:"".concat(a.API_BASE_URL).concat(t),DELETE:"".concat(a.API_BASE_URL).concat(t),PATCH:"".concat(a.API_BASE_URL).concat(t)})[e]}r.d(t,{b:function(){return o}});let a={get API_BASE_URL(){return"/api"}}},5447:function(e,t,r){"use strict";r.d(t,{O:function(){return n}});var o=r(71567),a=r(2913);let n={login:async(e,t,r)=>{try{let n=(0,a.b)("POST",o.q.AUTH.LOGIN),i={"Content-Type":"application/json"};t&&(i["X-CSRF-Token"]=t),r&&(i.Cookie=r);let l=await fetch(n,{method:"POST",headers:i,credentials:"include",body:JSON.stringify(e)});if(!l.ok){let e=await l.json().catch(()=>({}));throw Error(e.message||e.detail||"เข้าสู่ระบบไม่สำเร็จ")}let s=await l.json();return{...s.user,token:s.token}}catch(e){throw Error(e.message||"เข้าสู่ระบบไม่สำเร็จ")}},logout:async(e,t,r)=>{try{let o=(0,a.b)("POST","/auth/logout"),n={"Content-Type":"application/json"};e&&(n.Authorization="Bearer ".concat(e)),t&&(n["X-CSRF-Token"]=t),r&&(n.Cookie=r),await fetch(o,{method:"POST",headers:n,credentials:"include"})}catch(e){console.error("Logout failed",e)}},getMe:async e=>{try{let t=(0,a.b)("GET",o.q.AUTH.ME),r=await fetch(t,{method:"GET",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"},credentials:"include",cache:"no-store"});if(!r.ok)throw Error("Unauthorized");return await r.json()}catch(e){throw e}},async getCsrfToken(){try{let e=await fetch("".concat(o.v).concat(o.q.AUTH.CSRF),{credentials:"include"});if(!e.ok)return"";return(await e.json()).csrfToken}catch(e){return console.error("Failed to fetch CSRF token",e),""}}}},84859:function(e,t,r){"use strict";r.d(t,{M:function(){return l},x:function(){return i}});let o="pos_offline_queue",a=()=>{let e=localStorage.getItem(o);return e?JSON.parse(e):[]},n=e=>{localStorage.setItem(o,JSON.stringify(e))},i={addToQueue:(e,t)=>{let r=a(),o={id:"offline-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),type:e,payload:t,timestamp:Date.now(),retryCount:0};return n([...r,o]),o},getQueue:()=>a(),removeFromQueue:e=>{n(a().filter(t=>t.id!==e))},incrementRetry:(e,t)=>{n(a().map(r=>r.id===e?{...r,retryCount:r.retryCount+1,lastError:t}:r))},clearQueue:()=>{localStorage.removeItem(o)},pruneExceeded:()=>{n(a().filter(e=>e.retryCount<=5))}},l={maxRetry:5,backoff:e=>Math.min(3e4,2e3*e)}},53286:function(e,t,r){"use strict";r.d(t,{x:function(){return y}});var o=r(20019),a=r(2913),n=r(71567),i=r(32446);let l=o.Ryn({id:o.Z_8(),username:o.Z_8()}).partial().nullable(),s=o.Ryn({id:o.Z_8(),display_name:o.Z_8()}).partial().nullable(),c=o.Ryn({id:o.Z_8(),display_name:o.Z_8(),img_url:o.Z_8().nullable(),price:o.oQ2.number(),category:s.optional()}).partial().nullable(),d=o.Ryn({id:o.Z_8().optional(),detail_name:o.Z_8(),extra_price:o.oQ2.number()}).partial(),u=o.Ryn({id:o.Z_8(),order_id:o.Z_8(),product_id:o.Z_8(),product_name:o.Z_8().optional(),quantity:o.oQ2.number(),price:o.oQ2.number(),total_price:o.oQ2.number(),discount_amount:o.oQ2.number().optional().default(0),notes:o.Z_8().nullable().optional(),status:o.jbo(i.i).optional(),product:c.optional(),details:o.IXX(d).optional()}),f=o.Ryn({id:o.Z_8(),order_no:o.Z_8(),order_type:o.jbo(i.m),table_id:o.Z_8().nullable().optional(),delivery_id:o.Z_8().nullable().optional(),delivery_code:o.Z_8().nullable().optional(),sub_total:o.oQ2.number(),discount_id:o.Z_8().nullable().optional(),discount_amount:o.oQ2.number(),vat:o.oQ2.number(),total_amount:o.oQ2.number(),received_amount:o.oQ2.number(),change_amount:o.oQ2.number(),status:o.jbo(i.i),created_by_id:o.Z_8().nullable().optional(),create_date:o.Z_8(),update_date:o.Z_8(),items:o.IXX(u).optional(),created_by:l.optional(),table:o.YjB().optional(),delivery:o.YjB().optional(),discount:o.YjB().optional(),payments:o.IXX(o.YjB()).optional()}),h=o.Ryn({data:o.IXX(f),total:o.oQ2.number(),page:o.oQ2.number(),last_page:o.oQ2.number().optional()}),g=o.Ryn({table_name:o.Z_8().nullable().optional(),delivery_name:o.Z_8().nullable().optional()}).partial().nullable(),m=o.Ryn({id:o.Z_8(),order_no:o.Z_8(),order_type:o.jbo(i.m),status:o.jbo(i.i),create_date:o.Z_8(),total_amount:o.oQ2.number(),delivery_code:o.Z_8().nullable().optional(),table_id:o.Z_8().nullable().optional(),delivery_id:o.Z_8().nullable().optional(),table:g.optional(),delivery:g.optional(),items_summary:o.IMB(o.Z_8(),o.oQ2.number()).optional(),items_count:o.oQ2.number().optional()}),p=o.Ryn({data:o.IXX(m),total:o.oQ2.number(),page:o.oQ2.number(),last_page:o.oQ2.number().optional()}),b=n.q.POS.ORDERS,x=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"application/json",r={};return t&&(r["Content-Type"]=t),e&&(r.Cookie=e),r},y={getAll:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50,n=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0,l=arguments.length>5?arguments[5]:void 0,s=new URLSearchParams({page:t.toString(),limit:r.toString(),...n&&{status:n},...i&&{type:i},...l&&{q:l}}),c="".concat(b,"?").concat(s.toString()),d=(0,a.b)("GET",c),u=x(e,""),f=await fetch(d,{cache:"no-store",headers:u,credentials:"include"});if(!f.ok){let e=await f.json().catch(()=>({}));throw Error(e.error||e.message||"ไม่สามารถดึงข้อมูลออเดอร์ได้")}let g=await f.json();try{return h.parse(g)}catch(e){throw console.error("Zod Validation Error in ordersService.getAll:",e),e instanceof o.jmq&&console.error("Zod Issues:",e.issues),e}},getAllSummary:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50,n=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0,l=arguments.length>5?arguments[5]:void 0,s=new URLSearchParams({page:t.toString(),limit:r.toString(),...n&&{status:n},...i&&{type:i},...l&&{q:l}}),c="".concat(b,"/summary?").concat(s.toString()),d=(0,a.b)("GET",c),u=x(e,""),f=await fetch(d,{cache:"no-store",headers:u,credentials:"include"});if(!f.ok){let e=await f.json().catch(()=>({}));throw Error(e.error||e.message||"ไม่สามารถดึงข้อมูลออเดอร์ได้")}let h=await f.json();try{return p.parse(h)}catch(e){throw console.error("Zod Validation Error in ordersService.getAllSummary:",e),e instanceof o.jmq&&console.error("Zod Issues:",e.issues),e}},getStats:async e=>{let t=(0,a.b)("GET",n.q.POS.CHANNELS.STATS),r=x(e,""),o=await fetch(t,{cache:"no-store",headers:r,credentials:"include"});if(!o.ok){let e=await o.text();console.error("Order Stats Backend Error:",e);let t=await JSON.parse(e).catch(()=>({}));throw Error(t.error||t.message||"ไม่สามารถดึงข้อมูลสถิติได้")}return await o.json()},getById:async(e,t)=>{let r=(0,a.b)("GET","".concat(b,"/").concat(e)),n=x(t,""),i=await fetch(r,{cache:"no-store",headers:n,credentials:"include"});if(!i.ok){let e=await i.json().catch(()=>({}));throw Error(e.error||e.message||"ไม่สามารถดึงข้อมูลออเดอร์ได้")}let l=await i.json();try{return f.parse(l)}catch(e){throw console.error("Zod Validation Error in ordersService.getById:",e),e instanceof o.jmq&&console.error("Zod Issues:",e.issues),e}},create:async(e,t,r)=>{let o=(0,a.b)("POST","".concat(b)),n=x(t);r&&(n["X-CSRF-Token"]=r);let i=await fetch(o,{method:"POST",headers:n,credentials:"include",body:JSON.stringify(e)});if(!i.ok){let e=await i.json().catch(()=>({}));throw Error(e.error||e.message||"ไม่สามารถสร้างออเดอร์ได้")}return i.json()},update:async(e,t,r,o)=>{let n=(0,a.b)("PUT","".concat(b,"/").concat(e)),i=x(r);o&&(i["X-CSRF-Token"]=o);let l=await fetch(n,{method:"PUT",headers:i,credentials:"include",body:JSON.stringify(t)});if(!l.ok){let e=await l.json().catch(()=>({}));throw Error(e.error||e.message||"ไม่สามารถแก้ไขออเดอร์ได้")}return l.json()},delete:async(e,t,r)=>{let o=(0,a.b)("DELETE","".concat(b,"/").concat(e)),n=x(t,"");r&&(n["X-CSRF-Token"]=r);let i=await fetch(o,{method:"DELETE",headers:n,credentials:"include"});if(!i.ok){let e=await i.json().catch(()=>({}));throw Error(e.error||e.message||"ไม่สามารถลบออเดอร์ได้")}},updateItemStatus:async(e,t,r,o)=>{let n=(0,a.b)("PATCH","".concat(b,"/items/").concat(e,"/status")),i=x(r);o&&(i["X-CSRF-Token"]=o);let l=await fetch(n,{method:"PATCH",headers:i,credentials:"include",body:JSON.stringify({status:t})});if(!l.ok){let e=await l.json().catch(()=>({}));throw Error(e.error||e.message||"ไม่สามารถอัปเดตสถานะรายการได้")}},getItems:async(e,t)=>{let r=(0,a.b)("GET","".concat(b,"/items").concat(e?"?status=".concat(e):"")),o=x(t,""),n=await fetch(r,{cache:"no-store",headers:o,credentials:"include"});if(!n.ok){let e=await n.json().catch(()=>({}));throw Error(e.error||e.message||"ไม่สามารถดึงข้อมูลรายการได้")}return n.json()},addItem:async(e,t,r,o)=>{let n=(0,a.b)("POST","".concat(b,"/").concat(e,"/items")),i=x(r);o&&(i["X-CSRF-Token"]=o);let l=await fetch(n,{method:"POST",headers:i,credentials:"include",body:JSON.stringify(t)});if(!l.ok){let e=await l.json().catch(()=>({}));throw Error(e.error||e.message||"ไม่สามารถเพิ่มรายการได้")}return l.json()},updateItem:async(e,t,r,o)=>{let n=(0,a.b)("PUT","".concat(b,"/items/").concat(e)),i=x(r);o&&(i["X-CSRF-Token"]=o);let l=await fetch(n,{method:"PUT",headers:i,credentials:"include",body:JSON.stringify(t)});if(!l.ok){let e=await l.json().catch(()=>({}));throw Error(e.error||e.message||"ไม่สามารถแก้ไขรายการได้")}return l.json()},deleteItem:async(e,t,r)=>{let o=(0,a.b)("DELETE","".concat(b,"/items/").concat(e)),n=x(t,"");r&&(n["X-CSRF-Token"]=r);let i=await fetch(o,{method:"DELETE",headers:n,credentials:"include"});if(!i.ok){let e=await i.json().catch(()=>({}));throw Error(e.error||e.message||"ไม่สามารถลบรายการได้")}return i.json()},updateStatus:async(e,t,r)=>{let o={"Content-Type":"application/json"};r&&(o["X-CSRF-Token"]=r);let n=(0,a.b)("PUT","".concat(b,"/").concat(e));if(!(await fetch(n,{method:"PUT",headers:o,body:JSON.stringify({status:t}),credentials:"include"})).ok)throw Error("Failed to update status")}}},44225:function(e,t,r){"use strict";r.d(t,{Np:function(){return n},X1:function(){return o},ax:function(){return i},hS:function(){return a}});let o={primary:"#1890ff",secondary:"#13c2c2",success:"#52c41a",warning:"#faad14",error:"#ff4d4f",background:"#f5f5f5",cardBg:"#ffffff",text:"#262626",textSecondary:"#8c8c8c",border:"#f0f0f0",id_dineIn:"#1890ff",id_takeaway:"#52c41a",id_delivery:"#722ed1",kitchen:"#ff6b35",shift:"#10b981",kitchenBg:"#0f172a",kitchenCard:"rgba(30, 41, 59, 0.7)",kitchenBorder:"rgba(255, 255, 255, 0.1)"},a={dineIn:{primary:"#1890ff",light:"#e6f7ff",border:"#91d5ff",gradient:"linear-gradient(135deg, #1890ff 0%, #096dd9 100%)"},takeaway:{primary:"#52c41a",light:"#f6ffed",border:"#b7eb8f",gradient:"linear-gradient(135deg, #52c41a 0%, #73d13d 100%)"},delivery:{primary:"#722ed1",light:"#f9f0ff",border:"#d3adf7",gradient:"linear-gradient(135deg, #722ed1 0%, #9254de 100%)"}},n={container:{minHeight:"100vh",background:o.background,fontFamily:"'Inter', 'Sarabun', sans-serif"},heroParams:{background:"linear-gradient(135deg, #1890ff 0%, #096dd9 100%)",padding:"32px 24px 70px",position:"relative",borderBottomLeftRadius:24,borderBottomRightRadius:24,boxShadow:"0 8px 24px rgba(24, 144, 255, 0.25)",marginBottom:-40,zIndex:1,overflow:"hidden"},kitchenContainer:{minHeight:"100vh",background:"#0f172a",padding:"24px 24px 100px",color:"#f8fafc",fontFamily:"'Inter', 'Sarabun', sans-serif"},kitchenGlassCard:{background:"rgba(30, 41, 59, 0.7)",backdropFilter:"blur(12px)",border:"1px solid rgba(255, 255, 255, 0.1)",borderRadius:20,boxShadow:"0 8px 32px rgba(0, 0, 0, 0.3)",overflow:"hidden"},kitchenHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:24,flexWrap:"wrap",gap:16},shiftHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:24},sectionTitle:{display:"flex",alignItems:"center",gap:12,marginBottom:20,color:"#fff"},contentWrapper:{maxWidth:1400,margin:"-40px auto 30px",padding:"0 24px",position:"relative",zIndex:20},card:{borderRadius:16,boxShadow:"0 4px 12px rgba(0,0,0,0.05)",border:"none",overflow:"hidden",background:o.cardBg},itemCard:{marginBottom:8,borderRadius:8,transition:"all 0.3s ease"}},i={available:{primary:"#52c41a",light:"#f6ffed",border:"#b7eb8f",gradient:"linear-gradient(135deg, #52c41a 0%, #73d13d 100%)"},occupied:{primary:"#fa8c16",light:"#fff7e6",border:"#ffd591",gradient:"linear-gradient(135deg, #fa8c16 0%, #ffa940 100%)"},inactive:{primary:"#8c8c8c",light:"#fafafa",border:"#d9d9d9",gradient:"linear-gradient(135deg, #8c8c8c 0%, #bfbfbf 100%)"},waitingForPayment:{primary:"#1890ff",light:"#e6f7ff",border:"#91d5ff",gradient:"linear-gradient(135deg, #1890ff 0%, #40a9ff 100%)"}}},32446:function(e,t,r){"use strict";var o,a,n,i;r.d(t,{i:function(){return a},m:function(){return o}}),(n=o||(o={})).DineIn="DineIn",n.TakeAway="TakeAway",n.Delivery="Delivery",(i=a||(a={})).Pending="Pending",i.Cooking="Cooking",i.Served="Served",i.WaitingForPayment="WaitingForPayment",i.Paid="Paid",i.Completed="Completed",i.Cancelled="Cancelled"},67697:function(e,t,r){"use strict";r.d(t,{D:function(){return i},v:function(){return n}});var o=r(2265);let a=e=>{if("string"==typeof e)return e;if(e&&"object"==typeof e){var t;if("id"in e&&e.id)return e.id;if("data"in e&&(null===(t=e.data)||void 0===t?void 0:t.id))return e.data.id}};function n(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e=>e.id,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>!0;(0,o.useEffect)(()=>{if(!e)return;let o=e=>{if(!i(e))return;let t=n(e);r(r=>r.some(e=>n(e)===t)?r:[...r,e])},l=e=>{let t=n(e);r(r=>i(e)?r.some(e=>n(e)===t)?r.map(r=>n(r)===t?e:r):[...r,e]:r.filter(e=>n(e)!==t))},s=e=>{let t=a(e);t&&r(e=>e.filter(e=>n(e)!==t))};return e.on(t.create,o),e.on(t.update,l),e.on(t.delete,s),()=>{e.off(t.create,o),e.off(t.update,l),e.off(t.delete,s)}},[e,t.create,t.update,t.delete,n,r,i])}function i(e){let{socket:t,events:r=[],onRefresh:a,intervalMs:n,enabled:i=!0,debounceMs:l}=e;(0,o.useEffect)(()=>{if(!i||!t||0===r.length)return;let e=null,o=()=>{if(!l||l<=0){a();return}e&&clearTimeout(e),e=setTimeout(()=>{e=null,a()},l)};return r.forEach(e=>t.on(e,o)),()=>{e&&clearTimeout(e),r.forEach(e=>t.off(e,o))}},[i,t,r,a,l]),(0,o.useEffect)(()=>{if(!i||!n)return;let e=setInterval(a,n);return()=>clearInterval(e)},[i,n,a])}}},function(e){e.O(0,[1425,3125,2505,5015,7717,7698,742,3211,7993,8651,2646,6207,7213,9021,2224,1721,9,5616,5496,3834,8640,6931,19,8056,3410,2297,9809,9136,2971,2117,1744],function(){return e(e.s=80351)}),_N_E=e.O()}]);