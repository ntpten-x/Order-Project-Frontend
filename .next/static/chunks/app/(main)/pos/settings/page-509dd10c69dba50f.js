(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1694],{66630:function(e,t,i){Promise.resolve().then(i.bind(i,49190))},49190:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return F}});var a=i(57437),n=i(2265),s=i(60283),r=i(50337),l=i(38616),o=i(34029),d=i(24783),c=i(50742),u=i(80009),p=i(88589),x=i(24738),g=i(96931),h=i(55322),f=i(89245),b=i(13377),m=i(96473),y=i(86955),j=i(83669),v=i(82618),k=i(29436),Z=i(99376),w=i(92525),C=i(97235),R=i(24675),I=i(67697),_=i(67918),S=i(2938),P=i(25193),z=i(37410),A=i(27623),B=i(20148),W=i(2786),E=i(12028),L=i(44225);let T={container:{minHeight:"100vh",background:L.X1.background,fontFamily:"var(--font-sans), 'Sarabun', sans-serif",paddingBottom:60},heroParams:{background:"linear-gradient(145deg, ".concat(L.X1.primary," 0%, ").concat(L.X1.primaryDark," 100%)"),padding:"20px 20px 60px",position:"relative",borderBottomLeftRadius:24,borderBottomRightRadius:24,boxShadow:"0 8px 24px rgba(99, 102, 241, 0.2)",zIndex:1,overflow:"hidden"},heroDecoCircle1:{position:"absolute",top:-60,right:-60,width:160,height:160,borderRadius:"50%",background:"rgba(255,255,255,0.08)"},heroDecoCircle2:{position:"absolute",bottom:-40,left:-40,width:120,height:120,borderRadius:"50%",background:"rgba(255,255,255,0.06)"},headerContent:{maxWidth:1e3,margin:"0 auto",position:"relative",zIndex:10},headerRow:{display:"flex",alignItems:"center",gap:16},backButton:{width:44,height:44,borderRadius:14,background:"rgba(255,255,255,0.2)",backdropFilter:"blur(10px)",border:"1px solid rgba(255,255,255,0.3)",color:"#fff",display:"flex",alignItems:"center",justifyContent:"center"},headerIconBox:{width:56,height:56,borderRadius:16,background:"rgba(255,255,255,0.2)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center"},sectionTitle:{display:"flex",alignItems:"center",gap:12,marginBottom:20,color:"#fff"},contentWrapper:{maxWidth:700,margin:"-40px auto 30px",padding:"0 20px",position:"relative",zIndex:20},card:{borderRadius:20,boxShadow:"0 4px 20px rgba(0,0,0,0.06)",border:"none"},activeAccountCard:{background:"linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%)",border:"1px solid #a7f3d0",borderRadius:16,padding:"20px",marginBottom:24},addButton:{borderRadius:14,height:52,fontSize:16,fontWeight:600,background:"#fff",border:"2px dashed ".concat(L.X1.primary),color:L.X1.primary,transition:"all 0.2s ease"},dividerTitle:{fontSize:16,fontWeight:600},accountSelector:{border:"1px solid #e2e8f0",borderRadius:14,padding:"14px 18px",cursor:"pointer",background:"#fff",display:"flex",alignItems:"center",justifyContent:"space-between",minHeight:56,transition:"all 0.2s ease",boxShadow:"0 2px 4px rgba(0,0,0,0.02)"},accountSelectorHover:{borderColor:L.X1.primary,boxShadow:"0 0 0 3px ".concat(L.X1.primaryLight)},modalAccountItem:{padding:"16px",border:"1px solid #e5e7eb",borderRadius:14,cursor:"pointer",background:"#fff",display:"flex",alignItems:"center",justifyContent:"space-between",transition:"all 0.2s ease"},modalAccountItemActive:{border:"2px solid #10b981",background:"#ecfdf5"},accountIconBox:{width:44,height:44,borderRadius:12,display:"flex",alignItems:"center",justifyContent:"center"}},{Text:X}=s.default,D=(e,t)=>{let i=null==e?void 0:e.status,a=null==e?void 0:e.code,n=(null==e?void 0:e.message)||"",s=n.toLowerCase();return"DUPLICATE_ENTRY"===a||s.includes("duplicate")||s.includes("already exists")?s.includes("active")?"มีบัญชีหลักอยู่แล้ว กรุณาเปลี่ยนบัญชีหลักจากรายการ":"เลขพร้อมเพย์นี้ถูกใช้งานแล้ว กรุณาตรวจสอบและลองใหม่":409===i&&"DATABASE_ERROR"===a?"เกิดข้อผิดพลาดฐานข้อมูลจากฝั่งเซิร์ฟเวอร์ (ไม่ใช่เลขซ้ำ) กรุณาลองใหม่หรือตรวจสอบ backend":409===i?n||"เกิดข้อขัดแย้งของข้อมูล กรุณารีเฟรชแล้วลองใหม่":400===i?n||"ข้อมูลไม่ถูกต้อง กรุณาตรวจสอบอีกครั้ง":403===i?"สิทธิ์ไม่เพียงพอ หรือ CSRF token หมดอายุ กรุณารีเฟรชหน้าแล้วลองใหม่":404===i?"ไม่พบบัญชีที่ต้องการใช้งาน":n||t};function M(e){let{label:t,value:i,color:n}=e;return(0,a.jsxs)("div",{style:{borderRadius:14,border:"1px solid #e2e8f0",background:"#fff",padding:12,textAlign:"center"},children:[(0,a.jsx)("div",{style:{fontSize:24,fontWeight:700,color:n},children:i}),(0,a.jsx)(X,{type:"secondary",style:{fontSize:12},children:t})]})}function H(e){let{compact:t=!1}=e;return(0,a.jsxs)("div",{style:{display:"grid",gap:t?8:12},children:[(0,a.jsx)(r.Z.Input,{active:!0,block:!0,style:{height:t?30:36}}),(0,a.jsx)(r.Z.Input,{active:!0,block:!0,style:{height:t?30:36}}),(0,a.jsx)(r.Z.Button,{active:!0,block:!0,style:{height:t?40:44}})]})}function F(){let e=(0,Z.useRouter)(),{socket:t}=(0,R.s)(),i=!l.default.useBreakpoint().md,{isAuthorized:s,isChecking:L}=(0,_.e)({allowedRoles:["Admin","Manager"]}),[F,N]=(0,n.useState)(!0),[O,U]=(0,n.useState)(!1),[Y,q]=(0,n.useState)([]),[G,J]=(0,n.useState)(null),[K,Q]=(0,n.useState)(""),[V,$]=(0,n.useState)("all"),ee=(0,n.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{e?U(!0):N(!0);let t=await w.p.getByShopId();q(t)}catch(e){console.error(e),o.ZP.error(D(e,"ไม่สามารถดึงข้อมูลบัญชีพร้อมเพย์ได้"))}finally{e?U(!1):N(!1)}},[]);(0,n.useEffect)(()=>{ee()},[ee]),(0,I.D)({socket:t,events:[E.b.paymentAccounts.create,E.b.paymentAccounts.update,E.b.paymentAccounts.delete],onRefresh:()=>ee(!0),intervalMs:3e4});let et=(0,n.useMemo)(()=>Y.filter(e=>"PromptPay"===e.account_type),[Y]),ei=(0,n.useMemo)(()=>et.find(e=>e.is_active)||null,[et]),ea=(0,n.useMemo)(()=>{let e=et.length,t=et.filter(e=>e.is_active).length;return{total:e,active:t,inactive:e-t}},[et]),en=(0,n.useMemo)(()=>{let e=et;"active"===V?e=e.filter(e=>e.is_active):"inactive"===V&&(e=e.filter(e=>!e.is_active));let t=K.trim().toLowerCase();return t&&(e=e.filter(e=>e.account_name.toLowerCase().includes(t)||e.account_number.toLowerCase().includes(t))),e},[et,V,K]),es=async(e,t)=>{J(e);try{let i=await (0,C.P)();await w.p.activate(e,void 0,void 0,i),o.ZP.success('ตั้ง "'.concat(t,'" เป็นบัญชีหลักสำเร็จ')),await ee(!0)}catch(e){console.error(e),o.ZP.error(D(e,"ไม่สามารถเปลี่ยนบัญชีหลักได้"))}finally{J(null)}};return L?(0,a.jsx)(S.H,{message:"กำลังตรวจสอบสิทธิ์..."}):s?(0,a.jsxs)("div",{style:T.container,children:[(0,a.jsx)(B.Z,{title:"ตั้งค่าบัญชีพร้อมเพย์",subtitle:"กำหนดบัญชีหลักและจัดการช่องทางรับชำระด้วยพร้อมเพย์",icon:(0,a.jsx)(h.Z,{}),onBack:()=>e.back(),actions:(0,a.jsxs)(d.Z,{size:8,wrap:!0,children:[(0,a.jsx)(c.ZP,{icon:(0,a.jsx)(f.Z,{}),onClick:()=>ee(!1),loading:O||F}),(0,a.jsx)(c.ZP,{icon:(0,a.jsx)(b.Z,{}),onClick:()=>e.push("/pos/settings/payment-accounts/manage"),children:"จัดการทั้งหมด"}),(0,a.jsx)(c.ZP,{type:"primary",icon:(0,a.jsx)(m.Z,{}),onClick:()=>e.push("/pos/settings/payment-accounts/add"),children:"เพิ่มพร้อมเพย์"})]})}),(0,a.jsx)(P.Z,{maxWidth:1040,children:(0,a.jsxs)(A.Z,{children:[(0,a.jsx)(z.Z,{title:"ภาพรวมบัญชีพร้อมเพย์",children:F?(0,a.jsx)(H,{compact:i}):(0,a.jsxs)("div",{style:{display:"grid",gridTemplateColumns:i?"repeat(2, minmax(0, 1fr))":"repeat(3, minmax(0, 1fr))",gap:i?8:10},children:[(0,a.jsx)(M,{label:"ทั้งหมด",value:ea.total,color:"#1e293b"}),(0,a.jsx)(M,{label:"บัญชีหลัก",value:ea.active,color:"#16a34a"}),(0,a.jsx)(M,{label:"ไม่ใช้งาน",value:ea.inactive,color:"#b91c1c"})]})}),(0,a.jsx)(z.Z,{title:"บัญชีหลักปัจจุบัน",children:F?(0,a.jsx)(H,{compact:i}):ei?(0,a.jsxs)("div",{style:{borderRadius:14,border:"1px solid #bbf7d0",background:"#f0fdf4",padding:i?10:14,display:"flex",alignItems:"center",justifyContent:"space-between",gap:12,flexWrap:"wrap"},children:[(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12,minWidth:0},children:[(0,a.jsx)("div",{style:{width:i?38:44,height:i?38:44,borderRadius:10,background:"#fdf2f8",color:"#db2777",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,a.jsx)(y.Z,{})}),(0,a.jsxs)("div",{style:{minWidth:0},children:[(0,a.jsx)(X,{strong:!0,style:{display:"block"},children:ei.account_name}),(0,a.jsx)(X,{type:"secondary",style:{fontSize:12},children:ei.account_number}),(0,a.jsxs)("div",{style:{marginTop:6,display:"flex",alignItems:"center",gap:6},children:[(0,a.jsxs)(u.Z,{color:"green",style:{margin:0,borderRadius:6},children:[(0,a.jsx)(j.Z,{})," บัญชีหลัก"]}),(0,a.jsx)(u.Z,{style:{margin:0,borderRadius:6},children:"พร้อมเพย์"})]})]})]}),(0,a.jsx)(c.ZP,{icon:(0,a.jsx)(v.Z,{}),onClick:()=>e.push("/pos/settings/payment-accounts/manage"),children:"เปลี่ยนบัญชีหลัก"})]}):(0,a.jsx)(W.Z,{title:"ยังไม่มีบัญชีพร้อมเพย์หลัก",description:"เพิ่มบัญชีพร้อมเพย์แรกเพื่อเริ่มใช้งานการรับชำระ",action:(0,a.jsx)(c.ZP,{type:"primary",icon:(0,a.jsx)(m.Z,{}),onClick:()=>e.push("/pos/settings/payment-accounts/add"),children:"เพิ่มบัญชีแรก"})})}),(0,a.jsx)(z.Z,{title:"ค้นหาและตัวกรอง",children:F?(0,a.jsx)(H,{compact:i}):(0,a.jsxs)("div",{style:{display:"grid",gap:i?8:10},children:[(0,a.jsx)(p.default,{size:i?"middle":"large",prefix:(0,a.jsx)(k.Z,{style:{color:"#94a3b8"}}),placeholder:"ค้นหาจากชื่อบัญชี หรือเลขพร้อมเพย์...",allowClear:!0,value:K,onChange:e=>Q(e.target.value)}),(0,a.jsx)(x.Z,{options:[{label:"ทั้งหมด (".concat(et.length,")"),value:"all"},{label:"ใช้งาน (".concat(ea.active,")"),value:"active"},{label:"ไม่ใช้งาน (".concat(ea.inactive,")"),value:"inactive"}],block:i,size:i?"small":"middle",value:V,onChange:e=>$(e)})]})}),(0,a.jsx)(z.Z,{title:"รายการบัญชีพร้อมเพย์",extra:(0,a.jsx)("span",{style:{fontWeight:600},children:en.length}),children:F?(0,a.jsx)("div",{style:{display:"grid",gap:i?8:10},children:Array.from({length:3}).map((e,t)=>(0,a.jsx)(g.Z,{size:"small",style:{borderRadius:12},children:(0,a.jsx)(r.Z,{active:!0,paragraph:{rows:1},title:{width:"60%"}})},t))}):en.length>0?(0,a.jsx)("div",{style:{display:"grid",gap:i?8:10},children:en.map(t=>(0,a.jsxs)("div",{style:{borderRadius:14,border:"1px solid ".concat(t.is_active?"#86efac":"#e2e8f0"),background:t.is_active?"#f0fdf4":"#fff",padding:i?10:12,display:"flex",alignItems:"center",justifyContent:"space-between",gap:12,flexWrap:"wrap"},children:[(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:10,minWidth:0},children:[(0,a.jsx)("div",{style:{width:i?34:38,height:i?34:38,borderRadius:10,background:"#fdf2f8",color:"#db2777",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,a.jsx)(y.Z,{})}),(0,a.jsxs)("div",{style:{minWidth:0},children:[(0,a.jsx)(X,{strong:!0,style:{display:"block"},children:t.account_name}),(0,a.jsx)(X,{type:"secondary",style:{fontSize:12},children:t.account_number})]})]}),(0,a.jsxs)(d.Z,{size:8,wrap:!0,children:[(0,a.jsx)(u.Z,{color:t.is_active?"green":"default",style:{borderRadius:6,margin:0},children:t.is_active?"บัญชีหลัก":"พร้อมเพย์"}),t.is_active?null:(0,a.jsx)(c.ZP,{type:"primary",size:"small",loading:G===t.id,onClick:()=>es(t.id,t.account_name),children:"ตั้งเป็นบัญชีหลัก"}),(0,a.jsx)(c.ZP,{size:"small",onClick:()=>e.push("/pos/settings/payment-accounts/edit/".concat(t.id)),children:"แก้ไข"})]})]},t.id))}):(0,a.jsx)(W.Z,{title:K.trim()?"ไม่พบบัญชีตามคำค้น":"ยังไม่มีบัญชีพร้อมเพย์",description:K.trim()?"ลองเปลี่ยนคำค้นหาหรือตัวกรอง":"เพิ่มบัญชีพร้อมเพย์เพื่อเริ่มใช้งานการชำระเงิน",action:K.trim()?null:(0,a.jsx)(c.ZP,{type:"primary",icon:(0,a.jsx)(m.Z,{}),onClick:()=>e.push("/pos/settings/payment-accounts/add"),children:"เพิ่มบัญชีพร้อมเพย์"})})})]})})]}):(0,a.jsx)(S.H,{message:"คุณไม่มีสิทธิ์เข้าถึงหน้านี้",tone:"danger"})}}},function(e){e.O(0,[8024,4736,8592,1744],function(){return e(e.s=66630)}),_N_E=e.O()}]);