(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9655],{80240:function(e,t,a){Promise.resolve().then(a.bind(a,77489))},77489:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return er}});var r=a(57437),n=a(2265),i=a(39486),o=a(88589),s=a(50337),d=a(51653),c=a(38616),l=a(19878),u=a(34029),p=a(53743),g=a(24783),h=a(50742),x=a(24725),f=a(96931),m=a(80009),y=a(47451),b=a(69410),v=a(80336),j=a(86955),F=a(8900),k=a(26349),w=a(55322),Z=a(89245),C=a(96473),B=a(29436),S=a(82618),_=a(13377),E=a(15424),I=a(78355),R=a(29271),P=a(99376),A=a(44225);let D={container:{minHeight:"100vh",background:A.X1.background,fontFamily:"var(--font-sans), 'Sarabun', sans-serif",paddingBottom:60},heroHeader:{background:"linear-gradient(145deg, #eb2f96 0%, #c41d7f 100%)",padding:"20px 20px 60px",position:"relative",borderBottomLeftRadius:24,borderBottomRightRadius:24,boxShadow:"0 8px 24px rgba(235, 47, 150, 0.2)",overflow:"hidden"},heroDecoCircle1:{position:"absolute",top:-60,right:-60,width:160,height:160,borderRadius:"50%",background:"rgba(255,255,255,0.08)"},heroDecoCircle2:{position:"absolute",bottom:-40,left:-40,width:120,height:120,borderRadius:"50%",background:"rgba(255,255,255,0.06)"},headerContent:{maxWidth:1200,margin:"0 auto",position:"relative",zIndex:10},headerRow:{display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",gap:16},headerLeft:{display:"flex",alignItems:"center",gap:16},backButton:{width:44,height:44,borderRadius:14,background:"rgba(255,255,255,0.2)",backdropFilter:"blur(10px)",border:"1px solid rgba(255,255,255,0.3)",color:"#fff",display:"flex",alignItems:"center",justifyContent:"center"},headerIconBox:{width:56,height:56,borderRadius:16,background:"rgba(255,255,255,0.2)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",justifyContent:"center"},contentWrapper:{maxWidth:1200,margin:"-40px auto 30px",padding:"0 20px",position:"relative",zIndex:20},card:{borderRadius:20,border:"none",boxShadow:"0 4px 20px rgba(0,0,0,0.06)",transition:"all 0.3s ease"},cardActive:{border:"2px solid ".concat(A.X1.primary),boxShadow:"0 8px 24px ".concat(A.X1.primary,"15")},accountIconBox:{width:56,height:56,borderRadius:16,background:"#eb2f9610",display:"flex",alignItems:"center",justifyContent:"center"},accountNumber:{background:"#f8fafc",borderRadius:12,padding:"12px 16px",border:"1px solid #e2e8f0"},addButton:{borderRadius:14,height:52,padding:"0 28px",fontWeight:600,background:"rgba(255,255,255,0.95)",border:"none",color:"#eb2f96",boxShadow:"0 4px 12px rgba(235, 47, 150, 0.15)"}};var T=a(92525),z=a(97235),W=a(67918),L=a(2938),O=a(24675),H=a(67697),N=a(12028),U=a(25193),M=a(37410),X=a(27623),q=a(20148),G=a(2786);let{Title:J,Text:V}=i.default,{TextArea:Q}=o.default,Y=e=>e.replace(/\D/g,""),K=e=>{if(!e)return"-";let t=new Date(e);return Number.isNaN(t.getTime())?"-":new Intl.DateTimeFormat("th-TH",{dateStyle:"medium",timeStyle:"short"}).format(t)},$=(e,t)=>{let a=null==e?void 0:e.status,r=null==e?void 0:e.code,n=(null==e?void 0:e.message)||"",i=n.toLowerCase();return"DUPLICATE_ENTRY"===r||i.includes("duplicate")||i.includes("already exists")?i.includes("active account")||i.includes("cannot delete")?"ลบบัญชีหลักไม่ได้ กรุณาเปลี่ยนบัญชีหลักก่อน":"เลขพร้อมเพย์นี้ถูกใช้งานแล้ว กรุณาตรวจสอบและลองใหม่":409===a&&"DATABASE_ERROR"===r?"เซิร์ฟเวอร์แจ้งข้อผิดพลาดฐานข้อมูล (ไม่ใช่เลขซ้ำ) กรุณาลองใหม่หรือตรวจสอบ backend":409===a?n||"เกิดข้อขัดแย้งของข้อมูล กรุณารีเฟรชแล้วลองใหม่":400===a?n||"ข้อมูลไม่ถูกต้อง กรุณาตรวจสอบอีกครั้ง":403===a?"สิทธิ์ไม่เพียงพอ หรือ CSRF token หมดอายุ กรุณารีเฟรชแล้วลองใหม่":404===a?"ไม่พบข้อมูลบัญชีที่ต้องการ":n||t},ee=e=>{let{total:t,active:a,inactive:n}=e;return(0,r.jsxs)("div",{style:{background:"#fff",borderRadius:16,border:"1px solid #e2e8f0",display:"grid",gridTemplateColumns:"repeat(3, minmax(0, 1fr))",gap:8,padding:14},children:[(0,r.jsxs)("div",{style:{textAlign:"center"},children:[(0,r.jsx)("span",{style:{fontSize:24,fontWeight:700,color:"#0f172a",display:"block"},children:t}),(0,r.jsx)(V,{style:{fontSize:12,color:"#64748b"},children:"ทั้งหมด"})]}),(0,r.jsxs)("div",{style:{textAlign:"center"},children:[(0,r.jsx)("span",{style:{fontSize:24,fontWeight:700,color:"#16a34a",display:"block"},children:a}),(0,r.jsx)(V,{style:{fontSize:12,color:"#64748b"},children:"บัญชีหลัก"})]}),(0,r.jsxs)("div",{style:{textAlign:"center"},children:[(0,r.jsx)("span",{style:{fontSize:24,fontWeight:700,color:"#b91c1c",display:"block"},children:n}),(0,r.jsx)(V,{style:{fontSize:12,color:"#64748b"},children:"ไม่ใช้งาน"})]})]})},et=e=>{let{compact:t=!1,rows:a=3}=e;return(0,r.jsx)("div",{style:{display:"grid",gap:t?8:12},children:Array.from({length:a}).map((e,a)=>(0,r.jsx)(s.Z.Input,{active:!0,block:!0,style:{height:t?32:38}},a))})},ea=e=>{let{accountName:t,accountNumber:a,isActive:n}=e;return(0,r.jsxs)("div",{style:{background:"white",borderRadius:20,padding:20,boxShadow:"0 10px 30px rgba(0,0,0,0.05)",border:"1px solid #F1F5F9"},children:[(0,r.jsx)(J,{level:5,style:{color:"#db2777",marginBottom:16,fontWeight:700},children:"ตัวอย่างการแสดงผล"}),(0,r.jsxs)("div",{style:{borderRadius:16,border:"1px solid ".concat(n?"#bbf7d0":"#e2e8f0"),padding:14,background:n?"#f0fdf4":"#f8fafc",display:"flex",alignItems:"center",gap:12,marginBottom:16},children:[(0,r.jsx)("div",{style:{width:48,height:48,borderRadius:12,background:"#fdf2f8",color:"#db2777",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,fontSize:20},children:(0,r.jsx)(j.Z,{})}),(0,r.jsxs)("div",{style:{textAlign:"left",flex:1,minWidth:0},children:[(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,r.jsx)(V,{strong:!0,style:{fontSize:16,color:"#0f172a"},ellipsis:!0,children:t||"ชื่อบัญชีพร้อมเพย์"}),n&&(0,r.jsx)(F.Z,{style:{color:"#16a34a",fontSize:14}})]}),(0,r.jsx)(V,{type:"secondary",style:{fontSize:13,display:"block"},children:a||"เลขพร้อมเพย์"}),(0,r.jsx)(V,{type:"secondary",style:{fontSize:12,display:"block"},children:"พร้อมเพย์ (PromptPay)"})]})]}),(0,r.jsx)(d.Z,{type:n?"success":"info",showIcon:!0,message:n?"บัญชีนี้จะเป็นบัญชีหลักสำหรับรับเงิน":"บัญชีนี้ยังไม่ถูกตั้งเป็นบัญชีหลัก"})]})};function er(e){var t,a,i,F,A,er;let{params:en}=e,ei=(0,P.useRouter)(),{socket:eo}=(0,O.s)(),es=!c.default.useBreakpoint().md,{isAuthorized:ed,isChecking:ec}=(0,W.e)({allowedRoles:["Admin","Manager"]}),[el]=l.Z.useForm(),[eu,ep]=(0,n.useState)([]),[eg,eh]=(0,n.useState)(!0),[ex,ef]=(0,n.useState)(!1),[em,ey]=(0,n.useState)(!1),[eb,ev]=(0,n.useState)(!1),[ej,eF]=(0,n.useState)(null),[ek,ew]=(0,n.useState)(""),[eZ,eC]=(0,n.useState)("all"),[eB,eS]=(0,n.useState)(null),e_=null===(t=en.mode)||void 0===t?void 0:t[0],eE="manage"===e_||"add"===e_||"edit"===e_?e_:null,eI=null!==(i=null===(a=en.mode)||void 0===a?void 0:a[1])&&void 0!==i?i:null,eR=null!==eE&&("edit"!==eE||!!eI),eP="manage"===eE,eA="add"===eE,eD="edit"===eE&&!!eI,eT=null!==(F=l.Z.useWatch("account_name",el))&&void 0!==F?F:"",ez=null!==(A=l.Z.useWatch("account_number",el))&&void 0!==A?A:"",eW=null!==(er=l.Z.useWatch("is_active",el))&&void 0!==er&&er,eL=(0,n.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{e?ef(!0):eh(!0);let t=await T.p.getByShopId();ep(t.filter(e=>"PromptPay"===e.account_type))}catch(e){console.error(e),u.ZP.error($(e,"ไม่สามารถโหลดข้อมูลบัญชีพร้อมเพย์ได้"))}finally{e?ef(!1):eh(!1),ey(!0)}},[]);(0,n.useEffect)(()=>{ed&&eL()},[ed,eL]),(0,n.useEffect)(()=>{eR||ei.replace("/pos/settings/payment-accounts/manage")},[eR,ei]),(0,H.v)(eo,{create:N.b.paymentAccounts.create,update:N.b.paymentAccounts.update,delete:N.b.paymentAccounts.delete},ep,e=>e.id,e=>"PromptPay"===e.account_type),(0,H.D)({socket:eo,events:[N.b.paymentAccounts.create,N.b.paymentAccounts.update,N.b.paymentAccounts.delete],onRefresh:()=>eL(!0),intervalMs:45e3,enabled:ed});let eO=(0,n.useMemo)(()=>{var e;return eD&&eI&&null!==(e=eu.find(e=>e.id===eI))&&void 0!==e?e:null},[eu,eI,eD]),eH=!!(eD&&(null==eO?void 0:eO.is_active));(0,n.useEffect)(()=>{eA&&(el.resetFields(),el.setFieldsValue({account_name:"",account_number:"",phone:"",address:"",is_active:0===eu.length}),eS(null))},[eu.length,el,eA]),(0,n.useEffect)(()=>{if(eD&&eI&&em){if(!eO){u.ZP.error("ไม่พบบัญชีพร้อมเพย์ที่ต้องการแก้ไข"),ei.replace("/pos/settings/payment-accounts/manage");return}eB!==eI&&(el.setFieldsValue({account_name:eO.account_name,account_number:eO.account_number,phone:eO.phone||"",address:eO.address||"",is_active:eO.is_active}),eS(eI))}},[eI,eO,em,el,eB,eD,ei]);let eN=(0,n.useMemo)(()=>{let e=eu.length,t=eu.filter(e=>e.is_active).length;return{total:e,active:t,inactive:e-t}},[eu]),eU=(0,n.useMemo)(()=>{let e=eu;"active"===eZ?e=e.filter(e=>e.is_active):"inactive"===eZ&&(e=e.filter(e=>!e.is_active));let t=ek.trim().toLowerCase();return t&&(e=e.filter(e=>e.account_name.toLowerCase().includes(t)||e.account_number.toLowerCase().includes(t))),e},[eu,ek,eZ]),eM=async e=>{if(!e.is_active){eF(e.id);try{let t=await (0,z.P)();await T.p.activate(e.id,void 0,void 0,t),u.ZP.success('ตั้ง "'.concat(e.account_name,'" เป็นบัญชีหลักแล้ว')),await eL(!0)}catch(e){console.error(e),u.ZP.error($(e,"ไม่สามารถตั้งบัญชีหลักได้"))}finally{eF(null)}}},eX=e=>{p.Z.confirm({title:"ยืนยันการลบบัญชีพร้อมเพย์",content:e.is_active?"บัญชีหลักไม่สามารถลบได้ กรุณาเปลี่ยนบัญชีหลักก่อน":'คุณต้องการลบบัญชี "'.concat(e.account_name,'" หรือไม่?'),okText:"ลบ",okType:"danger",cancelText:"ยกเลิก",centered:!0,icon:(0,r.jsx)(k.Z,{style:{color:"#EF4444"}}),okButtonProps:{disabled:e.is_active},onOk:async()=>{if(e.is_active){u.ZP.warning("ลบบัญชีหลักไม่ได้ กรุณาเปลี่ยนบัญชีหลักก่อน");return}try{let t=await (0,z.P)();await T.p.delete(e.id,void 0,void 0,t),u.ZP.success('ลบบัญชี "'.concat(e.account_name,'" สำเร็จ')),await eL(!0),eD&&ei.push("/pos/settings/payment-accounts/manage")}catch(e){console.error(e),u.ZP.error($(e,"ไม่สามารถลบบัญชีพร้อมเพย์ได้"))}}})},eq=async e=>{ev(!0);try{var t;let a=Y(e.account_number||""),r=Y(e.phone||"");if(10!==a.length&&13!==a.length)throw Error("เลขพร้อมเพย์ต้องมีความยาว 10 หรือ 13 หลัก");if(r&&10!==r.length)throw Error("เบอร์โทรศัพท์ต้องเป็นตัวเลข 10 หลัก");let n=eu.find(e=>Y(e.account_number)===a&&(!eD||e.id!==eI));if(n)throw Error('เลขพร้อมเพย์นี้ถูกใช้งานแล้ว โดยบัญชี "'.concat(n.account_name,'"'));let i={account_name:e.account_name.trim(),account_number:a,account_type:"PromptPay",bank_name:void 0,phone:r||void 0,address:(null===(t=e.address)||void 0===t?void 0:t.trim())||void 0,is_active:!!eH||!!e.is_active},o=await (0,z.P)();eD&&eI?(await T.p.update(eI,i,void 0,void 0,o),u.ZP.success('อัปเดตบัญชี "'.concat(i.account_name,'" สำเร็จ'))):(await T.p.create(i,void 0,void 0,o),u.ZP.success('เพิ่มบัญชี "'.concat(i.account_name,'" สำเร็จ'))),ei.push("/pos/settings/payment-accounts/manage"),await eL(!0)}catch(e){console.error(e),u.ZP.error($(e,"ไม่สามารถบันทึกข้อมูลได้"))}finally{ev(!1)}};if(ec)return(0,r.jsx)(L.H,{message:"กำลังตรวจสอบสิทธิ์..."});if(!ed)return(0,r.jsx)(L.H,{message:"คุณไม่มีสิทธิ์เข้าถึงหน้านี้",tone:"danger"});if(!eR)return null;let eG=eP?"จัดการบัญชีพร้อมเพย์":eD?"แก้ไขบัญชีพร้อมเพย์":"เพิ่มบัญชีพร้อมเพย์",eJ=eP?"จัดการรายการพร้อมเพย์ ตั้งบัญชีหลัก และแก้ไขข้อมูล":eD?"ปรับแก้ข้อมูลบัญชีพร้อมเพย์ที่มีอยู่":"เพิ่มบัญชีพร้อมเพย์ใหม่สำหรับรับชำระใน POS";return(0,r.jsxs)("div",{style:D.container,children:[(0,r.jsx)(q.Z,{title:eG,subtitle:eJ,icon:(0,r.jsx)(w.Z,{}),onBack:()=>ei.push("/pos/settings"),actions:eP?(0,r.jsxs)(g.Z,{size:8,wrap:!0,children:[(0,r.jsx)(h.ZP,{icon:(0,r.jsx)(Z.Z,{}),onClick:()=>eL(!1),loading:eg||ex}),(0,r.jsx)(h.ZP,{type:"primary",icon:(0,r.jsx)(C.Z,{}),onClick:()=>ei.push("/pos/settings/payment-accounts/add"),children:"เพิ่มพร้อมเพย์"})]}):(0,r.jsxs)(g.Z,{size:8,wrap:!0,children:[eD&&eO?(0,r.jsx)(h.ZP,{danger:!0,icon:(0,r.jsx)(k.Z,{}),onClick:()=>eX(eO),disabled:eO.is_active,children:"ลบ"}):null,(0,r.jsx)(h.ZP,{onClick:()=>ei.push("/pos/settings/payment-accounts/manage"),children:"กลับหน้ารายการ"})]})}),(0,r.jsx)(U.Z,{maxWidth:1100,children:eP?(0,r.jsxs)(X.Z,{children:[(0,r.jsx)(M.Z,{title:"ภาพรวมบัญชีพร้อมเพย์",children:eg?(0,r.jsx)(et,{compact:es,rows:2}):(0,r.jsx)(ee,{total:eN.total,active:eN.active,inactive:eN.inactive})}),(0,r.jsx)(M.Z,{title:"ค้นหาและตัวกรอง",children:eg?(0,r.jsx)(et,{compact:es,rows:3}):(0,r.jsxs)("div",{style:{display:"grid",gap:es?8:10},children:[(0,r.jsx)(o.default,{size:es?"middle":"large",prefix:(0,r.jsx)(B.Z,{style:{color:"#94A3B8"}}),allowClear:!0,placeholder:"ค้นหาจากชื่อบัญชี หรือเลขพร้อมเพย์...",value:ek,onChange:e=>ew(e.target.value)}),(0,r.jsx)(x.Z,{options:[{label:"ทั้งหมด (".concat(eu.length,")"),value:"all"},{label:"บัญชีหลัก (".concat(eN.active,")"),value:"active"},{label:"ไม่ใช้งาน (".concat(eN.inactive,")"),value:"inactive"}],block:es,size:es?"small":"middle",value:eZ,onChange:e=>eC(e)})]})}),(0,r.jsx)(M.Z,{title:"รายการบัญชีพร้อมเพย์",extra:(0,r.jsx)("span",{style:{fontWeight:600},children:eU.length}),children:eg?(0,r.jsx)("div",{style:{display:"grid",gap:es?8:10},children:Array.from({length:3}).map((e,t)=>(0,r.jsx)(f.Z,{size:"small",style:{borderRadius:12},children:(0,r.jsx)(s.Z,{active:!0,paragraph:{rows:1},title:{width:"60%"}})},t))}):eU.length>0?(0,r.jsx)("div",{style:{display:"grid",gap:es?8:10},children:eU.map(e=>(0,r.jsxs)("div",{style:{borderRadius:16,border:"1px solid ".concat(e.is_active?"#86efac":"#e2e8f0"),background:e.is_active?"#f0fdf4":"#fff",padding:es?10:14,display:"flex",alignItems:"center",justifyContent:"space-between",gap:10,flexWrap:"wrap"},children:[(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:10,minWidth:0},children:[(0,r.jsx)("div",{style:{width:es?38:44,height:es?38:44,borderRadius:12,background:"#fdf2f8",color:"#db2777",display:"flex",alignItems:"center",justifyContent:"center",fontSize:18},children:(0,r.jsx)(j.Z,{})}),(0,r.jsxs)("div",{style:{minWidth:0},children:[(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,flexWrap:"wrap"},children:[(0,r.jsx)(V,{strong:!0,style:{fontSize:15},children:e.account_name}),(0,r.jsx)(m.Z,{color:e.is_active?"green":"default",style:{margin:0,borderRadius:6},children:e.is_active?"บัญชีหลัก":"พร้อมเพย์"})]}),(0,r.jsx)(V,{type:"secondary",style:{fontSize:12,display:"block"},children:e.account_number})]})]}),(0,r.jsxs)(g.Z,{size:8,wrap:!0,children:[e.is_active?null:(0,r.jsx)(h.ZP,{type:"primary",icon:(0,r.jsx)(S.Z,{}),loading:ej===e.id,onClick:()=>eM(e),children:"ตั้งเป็นบัญชีหลัก"}),(0,r.jsx)(h.ZP,{icon:(0,r.jsx)(_.Z,{}),onClick:()=>ei.push("/pos/settings/payment-accounts/edit/".concat(e.id)),children:"แก้ไข"}),(0,r.jsx)(h.ZP,{danger:!0,icon:(0,r.jsx)(k.Z,{}),onClick:()=>eX(e),disabled:e.is_active,children:"ลบ"})]})]},e.id))}):(0,r.jsx)(G.Z,{title:ek.trim()?"ไม่พบบัญชีตามคำค้น":"ยังไม่มีบัญชีพร้อมเพย์",description:ek.trim()?"ลองเปลี่ยนคำค้นหาหรือฟิลเตอร์":"เพิ่มบัญชีแรกเพื่อเริ่มรับชำระเงินผ่านระบบ POS",action:ek.trim()?null:(0,r.jsx)(h.ZP,{type:"primary",icon:(0,r.jsx)(C.Z,{}),onClick:()=>ei.push("/pos/settings/payment-accounts/add"),children:"เพิ่มบัญชีแรก"})})})]}):(0,r.jsx)(M.Z,{style:{background:"transparent",border:"none"},children:eg&&eD?(0,r.jsxs)(y.Z,{gutter:[20,20],children:[(0,r.jsx)(b.Z,{xs:24,lg:15,children:(0,r.jsx)(et,{compact:es,rows:7})}),(0,r.jsx)(b.Z,{xs:24,lg:9,children:(0,r.jsx)(et,{compact:es,rows:4})})]}):(0,r.jsxs)(y.Z,{gutter:[20,20],children:[(0,r.jsx)(b.Z,{xs:24,lg:15,children:(0,r.jsxs)(f.Z,{bordered:!1,style:{borderRadius:20,boxShadow:"0 4px 20px rgba(0,0,0,0.04)",overflow:"hidden"},styles:{body:{padding:es?14:24}},children:[(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:10,marginBottom:20},children:[(0,r.jsx)(w.Z,{style:{fontSize:20,color:"#db2777"}}),(0,r.jsx)(J,{level:5,style:{margin:0},children:"ข้อมูลบัญชีพร้อมเพย์"})]}),(0,r.jsxs)(l.Z,{form:el,layout:"vertical",onFinish:eq,requiredMark:!1,autoComplete:"off",initialValues:{is_active:!1},children:[(0,r.jsx)(d.Z,{showIcon:!0,type:"info",icon:(0,r.jsx)(E.Z,{}),message:"รองรับเฉพาะพร้อมเพย์",description:"หน้าจอนี้รองรับการเพิ่ม/แก้ไขบัญชีพร้อมเพย์เท่านั้น",style:{marginBottom:16}}),(0,r.jsx)(l.Z.Item,{name:"account_name",label:(0,r.jsx)("span",{style:{fontWeight:600,color:"#334155"},children:"ชื่อบัญชี"}),rules:[{required:!0,message:"กรุณากรอกชื่อบัญชี"},{max:100,message:"ความยาวต้องไม่เกิน 100 ตัวอักษร"}],children:(0,r.jsx)(o.default,{size:es?"middle":"large",placeholder:"เช่น ร้านกาแฟสาขาหลัก",style:{borderRadius:12,height:46,backgroundColor:"#F8FAFC",border:"1px solid #E2E8F0"},maxLength:100})}),(0,r.jsx)(l.Z.Item,{name:"account_number",label:(0,r.jsx)("span",{style:{fontWeight:600,color:"#334155"},children:"เลขพร้อมเพย์"}),validateTrigger:["onBlur","onSubmit"],rules:[{required:!0,message:"กรุณากรอกเลขพร้อมเพย์"},{validator:async(e,t)=>{let a=Y(t||"");if(a){if(10!==a.length&&13!==a.length)throw Error("เลขพร้อมเพย์ต้องมีความยาว 10 หรือ 13 หลัก");if(eu.some(e=>Y(e.account_number)===a&&(!eD||e.id!==eI)))throw Error("เลขพร้อมเพย์นี้ถูกใช้งานแล้ว")}}}],children:(0,r.jsx)(o.default,{size:es?"middle":"large",placeholder:"08xxxxxxxx หรือเลข 13 หลัก",style:{borderRadius:12,height:46,backgroundColor:"#F8FAFC",border:"1px solid #E2E8F0"},maxLength:13,onChange:e=>{el.setFieldValue("account_number",Y(e.target.value).slice(0,13))}})}),(0,r.jsx)(l.Z.Item,{name:"phone",label:(0,r.jsx)("span",{style:{fontWeight:600,color:"#334155"},children:"เบอร์โทรติดต่อ (ไม่บังคับ)"}),rules:[{validator:async(e,t)=>{if(t&&10!==Y(t).length)throw Error("เบอร์โทรศัพท์ต้องเป็นตัวเลข 10 หลัก")}}],children:(0,r.jsx)(o.default,{size:es?"middle":"large",placeholder:"08xxxxxxxx",style:{borderRadius:12,height:46,backgroundColor:"#F8FAFC",border:"1px solid #E2E8F0"},maxLength:10,onChange:e=>{el.setFieldValue("phone",Y(e.target.value).slice(0,10))}})}),(0,r.jsx)(l.Z.Item,{name:"address",label:(0,r.jsx)("span",{style:{fontWeight:600,color:"#334155"},children:"ที่อยู่/หมายเหตุ (ไม่บังคับ)"}),rules:[{max:255,message:"ความยาวต้องไม่เกิน 255 ตัวอักษร"}],children:(0,r.jsx)(Q,{rows:3,placeholder:"เช่น ใช้สำหรับหน้าร้านชั้น 1",maxLength:255,style:{borderRadius:12,backgroundColor:"#F8FAFC",border:"1px solid #E2E8F0"}})}),(0,r.jsx)("div",{style:{padding:16,background:"#F8FAFC",borderRadius:14,marginTop:16,marginBottom:18},children:(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:12},children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(V,{strong:!0,style:{fontSize:15,display:"block"},children:"ตั้งเป็นบัญชีหลัก"}),(0,r.jsx)(V,{type:"secondary",style:{fontSize:13},children:"เปิดเพื่อใช้บัญชีนี้เป็นบัญชีหลักรับชำระเงิน"})]}),(0,r.jsx)(l.Z.Item,{name:"is_active",valuePropName:"checked",noStyle:!0,children:(0,r.jsx)(v.Z,{disabled:eH,style:{background:eW?"#10B981":void 0}})})]})}),(0,r.jsxs)("div",{style:{marginTop:12,display:"flex",gap:12},children:[(0,r.jsx)(h.ZP,{size:es?"middle":"large",onClick:()=>ei.push("/pos/settings/payment-accounts/manage"),style:{flex:1,borderRadius:12,height:46,fontWeight:600},children:"ยกเลิก"}),(0,r.jsx)(h.ZP,{type:"primary",htmlType:"submit",loading:eb,icon:(0,r.jsx)(I.Z,{}),size:es?"middle":"large",style:{flex:2,borderRadius:12,height:46,fontWeight:600,background:"#db2777",boxShadow:"0 4px 12px rgba(219, 39, 119, 0.25)"},children:"บันทึกข้อมูล"})]})]})]})}),(0,r.jsx)(b.Z,{xs:24,lg:9,children:(0,r.jsxs)("div",{style:{display:"grid",gap:14},children:[(0,r.jsx)(ea,{accountName:eT,accountNumber:ez,isActive:eW}),eD&&eO?(0,r.jsxs)(f.Z,{style:{borderRadius:16},children:[(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:10},children:[(0,r.jsx)(R.Z,{style:{color:"#0369a1"}}),(0,r.jsx)(V,{strong:!0,children:"รายละเอียดรายการ"})]}),(0,r.jsxs)("div",{style:{display:"grid",gap:8},children:[(0,r.jsxs)(V,{type:"secondary",children:["ID: ",eO.id]}),(0,r.jsxs)(V,{type:"secondary",children:["สร้างเมื่อ: ",K(eO.created_at)]}),(0,r.jsxs)(V,{type:"secondary",children:["อัปเดตเมื่อ: ",K(eO.updated_at)]}),(0,r.jsxs)(V,{type:"secondary",children:["สถานะ: ",eO.is_active?"บัญชีหลัก":"ยังไม่ใช้งาน"]})]})]}):null]})})]})})})]})}},27623:function(e,t,a){"use strict";a.d(t,{Z:function(){return o}});var r=a(57437);a(2265);var n=a(10868),i=a(87530);function o(e){let{children:t,gap:a=i.H.sectionGap,style:o}=e;return(0,r.jsx)(n.Z,{vertical:!0,gap:a,style:o,children:t})}},2786:function(e,t,a){"use strict";a.d(t,{Z:function(){return d}});var r=a(57437);a(2265);var n=a(96931),i=a(85180),o=a(39486),s=a(87530);function d(e){let{title:t="ไม่มีข้อมูล",description:a,action:d,image:c}=e;return(0,r.jsx)(n.Z,{size:"small",variant:"outlined",style:{borderRadius:s.H.cardRadiusLG},bodyStyle:{padding:20},children:(0,r.jsx)(i.Z,{image:c,description:(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[(0,r.jsx)(o.default.Text,{strong:!0,children:t}),a?(0,r.jsx)(o.default.Text,{type:"secondary",children:a}):null]}),children:d})})}},46252:function(e,t,a){"use strict";a.d(t,{J:function(){return d},SocketProvider:function(){return c}});var r=a(57437),n=a(2265),i=a(68680),o=a(34029),s=a(14362);let d=(0,n.createContext)({socket:null,isConnected:!1}),c=e=>{let{children:t}=e,[a,c]=(0,n.useState)(null),[l,u]=(0,n.useState)(!1),p=(0,n.useRef)(!1),{user:g}=(0,s.a)();return(0,n.useEffect)(()=>{var e;if(!g){a&&(a.disconnect(),c(null),u(!1));return}let t=(null===(e=g.branch)||void 0===e?void 0:e.id)||g.branch_id||null,r=(0,i.io)("http://localhost:3000",{transports:["websocket"],withCredentials:!0,auth:{userId:g.id,branchId:t},reconnection:!0,reconnectionAttempts:5,reconnectionDelay:800,reconnectionDelayMax:8e3});return r.on("connect",()=>{console.log("Socket Connected:",r.id),u(!0),p.current=!1,o.ZP.success({content:"เชื่อมต่อเรียลไทม์แล้ว",key:"socket-status",duration:1.5})}),r.on("disconnect",()=>{console.log("Socket Disconnected"),u(!1),p.current||(p.current=!0,o.ZP.warning({content:"การเชื่อมต่อเรียลไทม์หลุด กำลังพยายามเชื่อมต่อใหม่...",key:"socket-status",duration:2}))}),r.io.on("reconnect_attempt",e=>{console.log("Socket reconnect attempt",e),u(!1)}),r.io.on("reconnect_failed",()=>{console.log("Socket reconnect failed"),o.ZP.error({content:"เชื่อมต่อเรียลไทม์ไม่สำเร็จ",key:"socket-status",duration:2})}),c(r),()=>{r.disconnect()}},[null==g?void 0:g.id]),(0,r.jsx)(d.Provider,{value:{socket:a,isConnected:l},children:t})}},24675:function(e,t,a){"use strict";a.d(t,{s:function(){return i}});var r=a(2265),n=a(46252);let i=()=>(0,r.useContext)(n.J)},92525:function(e,t,a){"use strict";a.d(t,{p:function(){return s}});var r=a(2913),n=a(98170);let i="/pos/payment-accounts",o=e=>{var t;if(e&&"object"==typeof e)return null===(t=e.error)||void 0===t?void 0:t.code},s={getBasePath:e=>{let t=(0,r.b)("GET","".concat(i,"/accounts"));return e?"".concat(t,"?shopId=").concat(e):t},getByShopId:async(e,t)=>{let a=(0,r.b)("GET","".concat(i,"/accounts"));e&&(a+="?shopId=".concat(e));let s={};t&&(s.Cookie=t);let d=await fetch(a,{cache:"no-store",credentials:"include",headers:s});if(!d.ok){let e=await d.json().catch(()=>({})),t=Error((0,n.i_)(e,"Failed to fetch accounts"));throw t.status=d.status,t.code=o(e),t}return(0,n.hH)(await d.json())},create:async(e,t,a,s)=>{let d=(0,r.b)("POST","".concat(i,"/accounts"));t&&(d+="?shopId=".concat(t));let c={"Content-Type":"application/json"};a&&(c.Cookie=a),s&&(c["X-CSRF-Token"]=s);let l=await fetch(d,{method:"POST",headers:c,body:JSON.stringify(e),credentials:"include"});if(!l.ok){let e=await l.json().catch(()=>({})),t=Error((0,n.i_)(e,"Failed to create account"));throw t.status=l.status,t.code=o(e),t}return(0,n.hH)(await l.json())},update:async(e,t,a,s,d)=>{let c=(0,r.b)("PUT","".concat(i,"/accounts/").concat(e));a&&(c+="?shopId=".concat(a));let l={"Content-Type":"application/json"};s&&(l.Cookie=s),d&&(l["X-CSRF-Token"]=d);let u=await fetch(c,{method:"PUT",headers:l,body:JSON.stringify(t),credentials:"include"});if(!u.ok){let e=await u.json().catch(()=>({})),t=Error((0,n.i_)(e,"Failed to update account"));throw t.status=u.status,t.code=o(e),t}return(0,n.hH)(await u.json())},activate:async(e,t,a,s)=>{let d=(0,r.b)("PATCH","".concat(i,"/accounts/").concat(e,"/activate"));t&&(d+="?shopId=".concat(t));let c={"Content-Type":"application/json"};a&&(c.Cookie=a),s&&(c["X-CSRF-Token"]=s);let l=await fetch(d,{method:"PATCH",headers:c,body:JSON.stringify({}),credentials:"include"});if(!l.ok){let e=await l.json().catch(()=>({})),t=Error((0,n.i_)(e,"Failed to activate account"));throw t.status=l.status,t.code=o(e),t}return(0,n.hH)(await l.json())},delete:async(e,t,a,s)=>{let d=(0,r.b)("DELETE","".concat(i,"/accounts/").concat(e));t&&(d+="?shopId=".concat(t));let c={};a&&(c.Cookie=a),s&&(c["X-CSRF-Token"]=s);let l=await fetch(d,{method:"DELETE",headers:c,credentials:"include"});if(!l.ok){let e=await l.json().catch(()=>({})),t=Error((0,n.i_)(e,"Failed to delete account"));throw t.status=l.status,t.code=o(e),t}}}},44225:function(e,t,a){"use strict";a.d(t,{Np:function(){return o},X1:function(){return r},ax:function(){return i},hS:function(){return n}});let r={primary:"#6366F1",primaryLight:"#EEF2FF",primaryDark:"#4F46E5",success:"#10B981",successLight:"#ECFDF5",warning:"#F59E0B",warningLight:"#FFFBEB",error:"#EF4444",errorLight:"#FEF2F2",info:"#3B82F6",infoLight:"#EFF6FF",background:"#F8FAFC",cardBg:"#FFFFFF",border:"#E2E8F0",borderLight:"#F1F5F9",text:"#1E293B",textSecondary:"#64748B",textMuted:"#94A3B8",textInverse:"#FFFFFF",dineIn:"#3B82F6",takeaway:"#10B981",delivery:"#8B5CF6",kitchen:"#F97316",shift:"#10B981",kitchenBg:"#0F172A",kitchenCard:"rgba(30, 41, 59, 0.8)",kitchenBorder:"rgba(255, 255, 255, 0.1)"},n={dineIn:{primary:"#3B82F6",light:"#EFF6FF",border:"#BFDBFE",gradient:"linear-gradient(135deg, #3B82F6 0%, #2563EB 100%)",iconBg:"rgba(59, 130, 246, 0.1)"},takeaway:{primary:"#10B981",light:"#ECFDF5",border:"#A7F3D0",gradient:"linear-gradient(135deg, #10B981 0%, #059669 100%)",iconBg:"rgba(16, 185, 129, 0.1)"},delivery:{primary:"#8B5CF6",light:"#F5F3FF",border:"#DDD6FE",gradient:"linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%)",iconBg:"rgba(139, 92, 246, 0.1)"}},i={available:{primary:"#10B981",light:"#ECFDF5",border:"#A7F3D0",gradient:"linear-gradient(135deg, #10B981 0%, #059669 100%)",text:"#065F46"},occupied:{primary:"#F59E0B",light:"#FFFBEB",border:"#FCD34D",gradient:"linear-gradient(135deg, #F59E0B 0%, #D97706 100%)",text:"#92400E"},inactive:{primary:"#94A3B8",light:"#F8FAFC",border:"#CBD5E1",gradient:"linear-gradient(135deg, #94A3B8 0%, #64748B 100%)",text:"#475569"},waitingForPayment:{primary:"#3B82F6",light:"#EFF6FF",border:"#BFDBFE",gradient:"linear-gradient(135deg, #3B82F6 0%, #2563EB 100%)",text:"#1E40AF"}},o={container:{minHeight:"100vh",background:r.background,fontFamily:"var(--font-sans), 'Sarabun', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif",paddingBottom:100},header:{background:"linear-gradient(135deg, ".concat(r.primary," 0%, ").concat(r.primaryDark," 100%)"),padding:"16px 16px 48px",position:"relative",borderBottomLeftRadius:20,borderBottomRightRadius:20,overflow:"hidden"},heroHeader:{background:"linear-gradient(135deg, ".concat(r.primary," 0%, ").concat(r.primaryDark," 100%)"),padding:"24px 20px 56px",position:"relative",borderBottomLeftRadius:24,borderBottomRightRadius:24,boxShadow:"0 4px 20px rgba(99, 102, 241, 0.2)",marginBottom:-40,zIndex:1,overflow:"hidden"},contentWrapper:{maxWidth:1200,margin:"-32px auto 0",padding:"0 16px",position:"relative",zIndex:10},card:{borderRadius:16,boxShadow:"0 2px 8px rgba(0, 0, 0, 0.04)",border:"1px solid ".concat(r.border),overflow:"hidden",background:r.cardBg},itemCard:{marginBottom:8,borderRadius:12,border:"1px solid ".concat(r.borderLight),transition:"all 0.2s ease",background:r.cardBg},kitchenContainer:{minHeight:"100vh",background:r.kitchenBg,padding:"16px 16px 100px",color:"#F8FAFC",fontFamily:"var(--font-sans), 'Sarabun', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif"},kitchenGlassCard:{background:r.kitchenCard,backdropFilter:"blur(12px)",border:"1px solid ".concat(r.kitchenBorder),borderRadius:16,boxShadow:"0 8px 32px rgba(0, 0, 0, 0.3)",overflow:"hidden"},kitchenHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20,flexWrap:"wrap",gap:12},sectionTitle:{display:"flex",alignItems:"center",gap:10,marginBottom:16,fontSize:16,fontWeight:600,color:r.text}}},67697:function(e,t,a){"use strict";a.d(t,{D:function(){return o},v:function(){return i}});var r=a(2265);let n=e=>{if("string"==typeof e)return e;if(e&&"object"==typeof e){var t;if("id"in e&&e.id)return e.id;if("data"in e&&(null===(t=e.data)||void 0===t?void 0:t.id))return e.data.id}};function i(e,t,a){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e=>e.id,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>!0;(0,r.useEffect)(()=>{if(!e)return;let r=e=>{if(!o(e))return;let t=i(e);a(a=>a.some(e=>i(e)===t)?a:[...a,e])},s=e=>{let t=i(e);a(a=>o(e)?a.some(e=>i(e)===t)?a.map(a=>i(a)===t?e:a):[...a,e]:a.filter(e=>i(e)!==t))},d=e=>{let t=n(e);t&&a(e=>e.filter(e=>i(e)!==t))};return e.on(t.create,r),e.on(t.update,s),e.on(t.delete,d),()=>{e.off(t.create,r),e.off(t.update,s),e.off(t.delete,d)}},[e,t.create,t.update,t.delete,i,a,o])}function o(e){let{socket:t,events:a=[],onRefresh:n,intervalMs:i,enabled:o=!0,debounceMs:s}=e;(0,r.useEffect)(()=>{if(!o||!t||0===a.length)return;let e=null,r=()=>{if(!s||s<=0){n();return}e&&clearTimeout(e),e=setTimeout(()=>{e=null,n()},s)};return a.forEach(e=>t.on(e,r)),()=>{e&&clearTimeout(e),a.forEach(e=>t.off(e,r))}},[o,t,a,n,s]),(0,r.useEffect)(()=>{if(!o||!i)return;let e=setInterval(n,i);return()=>clearInterval(e)},[o,i,n])}},12028:function(e,t,a){"use strict";a.d(t,{b:function(){return r},g:function(){return n}});let r={system:{announcement:"system:announcement"},users:{create:"users:create",update:"users:update",delete:"users:delete",status:"users:update-status"},roles:{create:"roles:create",update:"roles:update",delete:"roles:delete"},branches:{create:"branches:create",update:"branches:update",delete:"branches:delete"},products:{create:"products:create",update:"products:update",delete:"products:delete"},productsUnit:{create:"productsUnit:create",update:"productsUnit:update",delete:"productsUnit:delete"},categories:{create:"category:create",update:"category:update",delete:"category:delete"},tables:{create:"tables:create",update:"tables:update",delete:"tables:delete"},orders:{create:"orders:create",update:"orders:update",delete:"orders:delete"},payments:{create:"payments:create",update:"payments:update",delete:"payments:delete"},discounts:{create:"discounts:create",update:"discounts:update",delete:"discounts:delete"},delivery:{create:"delivery:create",update:"delivery:update",delete:"delivery:delete"},shifts:{update:"shifts:update"},orderQueue:{added:"order-queue:added",updated:"order-queue:updated",removed:"order-queue:removed",reordered:"order-queue:reordered"},ingredients:{create:"ingredients:create",update:"ingredients:update",delete:"ingredients:delete"},ingredientsUnit:{create:"ingredientsUnit:create",update:"ingredientsUnit:update",delete:"ingredientsUnit:delete"},stock:{update:"stock:update"},stockOrders:{create:"stock:orders:create",update:"stock:orders:update",status:"stock:orders:status",delete:"stock:orders:delete",detailUpdate:"stock:orders:detail:update"},paymentAccounts:{create:"payment-accounts:create",update:"payment-accounts:update",delete:"payment-accounts:delete"},paymentMethods:{create:"paymentMethod:create",update:"paymentMethod:update",delete:"paymentMethod:delete"},shopProfile:{update:"shopProfile:update"},salesOrderItem:{create:"salesOrderItem:create",update:"salesOrderItem:update",delete:"salesOrderItem:delete"},salesOrderDetail:{create:"salesOrderDetail:create",update:"salesOrderDetail:update",delete:"salesOrderDetail:delete"}},n={stockOrdersUpdated:"orders_updated"}}},function(e){e.O(0,[253,1522,3418,742,9486,4252,3916,8651,6931,4159,3831,2224,3248,2401,9,8879,8589,9845,4221,9878,4725,9272,9385,4390,2971,2117,1744],function(){return e(e.s=80240)}),_N_E=e.O()}]);