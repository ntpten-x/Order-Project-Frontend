(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1694],{66630:function(e,t,n){Promise.resolve().then(n.bind(n,49190))},49190:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return E}});var a=n(57437),r=n(2265),i=n(82646),o=n(93834),c=n(64625),d=n(48651),s=n(96931),l=n(23496),f=n(50742),u=n(24783),g=n(80009),h=n(47451),p=n(69410),y=n(55322),x=n(96473),m=n(86955),b=n(37527),j=n(83669),v=n(92525),k=n(3369),w=n(44225);let C={container:{minHeight:"100vh",background:w.X1.background,fontFamily:"'Inter', 'Sarabun', sans-serif"},heroParams:{background:"linear-gradient(135deg, #1890ff 0%, #096dd9 100%)",padding:"32px 24px 70px",position:"relative",borderBottomLeftRadius:24,borderBottomRightRadius:24,boxShadow:"0 8px 24px rgba(24, 144, 255, 0.25)",marginBottom:-40,zIndex:1,overflow:"hidden"},sectionTitle:{display:"flex",alignItems:"center",gap:12,marginBottom:20,color:"#fff"},contentWrapper:{maxWidth:700,margin:"-40px auto 30px",padding:"0 24px",position:"relative",zIndex:20},card:{borderRadius:16,boxShadow:"0 4px 12px rgba(0,0,0,0.05)"},activeAccountCard:{background:"#f0f5ff",border:"1px solid #adc6ff",borderRadius:12,padding:"20px",marginBottom:32},addButton:{borderRadius:12,height:52,fontSize:16,fontWeight:600,background:"#fff",border:"1px dashed ".concat(w.X1.primary),color:w.X1.primary},dividerTitle:{fontSize:16,fontWeight:600}};var S=n(97235),B=n(24675),P=n(67697),I=n(3286),z=n(2938);let{Title:T,Text:R}=i.default,{Option:Z}=o.default;function E(){let{message:e}=c.Z.useApp(),[t,n]=(0,r.useState)(!0),[i,w]=(0,r.useState)([]),[E,_]=(0,r.useState)(null),{showLoading:F,hideLoading:A}=(0,k.x)(),{socket:H}=(0,B.s)(),{isAuthorized:W,isChecking:O}=(0,I.e)({requiredRole:"Admin"}),X=(0,r.useCallback)(async function(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{t||n(!0);let e=await v.p.getByShopId();w(e);let a=e.find(e=>e.is_active);_(a||null)}catch(t){e.error("ไม่สามารถดึงข้อมูลบัญชีได้")}finally{t||n(!1)}},[e]);(0,r.useEffect)(()=>{X()},[X]),(0,P.D)({socket:H,events:["payment-accounts:update","payment-accounts:create","payment-accounts:delete"],onRefresh:()=>X(!0),intervalMs:2e4});let N=async t=>{try{F("กำลังเปลี่ยนบัญชีรับเงิน...");let n=i.find(e=>e.id===t);n&&_(n);let a=await (0,S.P)();await v.p.activate(t,void 0,void 0,a),e.success("เปลี่ยนบัญชีรับเงินหลักสำเร็จ"),await X(!0)}catch(t){e.error("ไม่สามารถเปลี่ยนบัญชีได้"),await X(!0)}finally{A()}};return O?(0,a.jsx)(z.H,{message:"กำลังตรวจสอบสิทธิ์..."}):W?t?(0,a.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",background:C.container.background},children:(0,a.jsx)(d.Z,{size:"large",tip:"กำลังโหลด..."})}):(0,a.jsxs)("div",{style:C.container,children:[(0,a.jsx)("div",{style:{...C.heroParams,paddingBottom:60},children:(0,a.jsx)("div",{style:{maxWidth:1e3,margin:"0 auto",position:"relative",zIndex:10},children:(0,a.jsxs)("div",{style:C.sectionTitle,children:[(0,a.jsx)(y.Z,{style:{fontSize:28}}),(0,a.jsxs)("div",{children:[(0,a.jsx)(T,{level:3,style:{margin:0,color:"#fff"},children:"ตั้งค่าบัญชีรับเงิน (Payment Settings)"}),(0,a.jsx)(R,{style:{color:"rgba(255,255,255,0.85)",fontSize:14},children:"Manage your active payment account"})]})]})})}),(0,a.jsx)("div",{style:C.contentWrapper,children:(0,a.jsx)(s.Z,{variant:"borderless",style:C.card,children:(0,a.jsxs)("div",{style:{marginBottom:32},children:[(0,a.jsx)(l.Z,{titlePlacement:"left",plain:!0,style:C.dividerTitle,children:"บัญชีรับเงินที่ใช้งาน (Primary Payment Account)"}),(0,a.jsxs)("div",{style:{marginBottom:24},children:[(0,a.jsx)(R,{type:"secondary",style:{display:"block",marginBottom:16},children:"เลือกบัญชีที่จะให้ลูกค้าโอนเงินเข้า (ใช้สร้าง QR Code อัตโนมัติ)"}),(0,a.jsx)(o.default,{size:"large",style:{width:"100%"},placeholder:"-- เลือกบัญชีรับเงิน --",value:null==E?void 0:E.id,onChange:N,dropdownRender:e=>(0,a.jsxs)(a.Fragment,{children:[e,(0,a.jsx)(l.Z,{style:{margin:"8px 0"}}),(0,a.jsx)("div",{style:{padding:"0 8px 4px"},children:(0,a.jsx)(f.ZP,{type:"link",block:!0,icon:(0,a.jsx)(x.Z,{}),onClick:()=>window.location.href="/pos/settings/payment-accounts/manage",children:"จัดการบัญชีเพิ่มเติม"})})]}),children:i.map(e=>(0,a.jsx)(Z,{value:e.id,children:(0,a.jsxs)(u.Z,{children:["PromptPay"===e.account_type?(0,a.jsx)(m.Z,{style:{color:"#eb2f96"}}):(0,a.jsx)(b.Z,{style:{color:"#1890ff"}}),(0,a.jsx)(R,{strong:!0,children:e.account_name}),(0,a.jsxs)(R,{type:"secondary",style:{fontSize:12},children:["(",e.account_number,")"]}),e.is_active&&(0,a.jsx)(g.Z,{color:"success",style:{marginLeft:8},children:"ใช้งานอยู่"})]})},e.id))})]}),E&&(0,a.jsx)("div",{style:C.activeAccountCard,children:(0,a.jsxs)(h.Z,{align:"middle",gutter:16,children:[(0,a.jsx)(p.Z,{children:(0,a.jsx)(j.Z,{style:{fontSize:24,color:"#52c41a"}})}),(0,a.jsxs)(p.Z,{flex:"1",children:[(0,a.jsx)("div",{style:{marginBottom:4},children:(0,a.jsx)(R,{type:"secondary",style:{fontSize:12},children:"กำลังใช้งานอยู่ในปัจจุบัน:"})}),(0,a.jsxs)(u.Z,{direction:"vertical",size:0,children:[(0,a.jsx)(R,{strong:!0,style:{fontSize:18},children:E.account_name}),(0,a.jsxs)(u.Z,{children:[(0,a.jsxs)(R,{type:"secondary",children:["PromptPay"===E.account_type?"พร้อมเพย์":E.bank_name||"ธนาคาร",": "]}),(0,a.jsx)(R,{strong:!0,children:E.account_number})]})]})]})]})}),(0,a.jsx)(f.ZP,{block:!0,size:"large",icon:(0,a.jsx)(x.Z,{}),onClick:()=>window.location.href="/pos/settings/payment-accounts/manage",style:C.addButton,children:"เพิ่มหรือแก้ไขบัญชี (Manage Accounts)"})]})})})]}):(0,a.jsx)(z.H,{message:"คุณไม่มีสิทธิ์เข้าถึงหน้านี้",tone:"danger"})}},2938:function(e,t,n){"use strict";n.d(t,{H:function(){return c}});var a=n(57437);n(2265);var r=n(82646),i=n(48651);let{Text:o}=r.default,c=e=>{let{message:t,tone:n="secondary"}=e;return(0,a.jsxs)("div",{style:{display:"flex",height:"100vh",justifyContent:"center",alignItems:"center",flexDirection:"column",gap:16},children:[(0,a.jsx)(i.Z,{size:"large"}),(0,a.jsx)(o,{type:n,children:t})]})}},92525:function(e,t,n){"use strict";n.d(t,{p:function(){return i}});var a=n(2913);let r="/pos/payment-accounts",i={getBasePath:e=>{let t=(0,a.b)("GET","".concat(r,"/accounts"));return e?"".concat(t,"?shopId=").concat(e):t},getByShopId:async(e,t)=>{let n=(0,a.b)("GET","".concat(r,"/accounts"));e&&(n+="?shopId=".concat(e));let i={};t&&(i.Cookie=t);let o=await fetch(n,{cache:"no-store",credentials:"include",headers:i});if(!o.ok){let e=await o.json().catch(()=>({})),t=Error(e.error||e.message||"Failed to fetch accounts");throw t.status=o.status,t}return o.json()},create:async(e,t,n,i)=>{let o=(0,a.b)("POST","".concat(r,"/accounts"));t&&(o+="?shopId=".concat(t));let c={"Content-Type":"application/json"};n&&(c.Cookie=n),i&&(c["X-CSRF-Token"]=i);let d=await fetch(o,{method:"POST",headers:c,body:JSON.stringify(e),credentials:"include"});if(!d.ok){let e=await d.json().catch(()=>({})),t=Error(e.error||e.message||"Failed to create account");throw t.status=d.status,t}return d.json()},update:async(e,t,n,i,o)=>{let c=(0,a.b)("PUT","".concat(r,"/accounts/").concat(e));n&&(c+="?shopId=".concat(n));let d={"Content-Type":"application/json"};i&&(d.Cookie=i),o&&(d["X-CSRF-Token"]=o);let s=await fetch(c,{method:"PUT",headers:d,body:JSON.stringify(t),credentials:"include"});if(!s.ok){let e=await s.json().catch(()=>({})),t=Error(e.error||e.message||"Failed to update account");throw t.status=s.status,t}return s.json()},activate:async(e,t,n,i)=>{let o=(0,a.b)("PATCH","".concat(r,"/accounts/").concat(e,"/activate"));t&&(o+="?shopId=".concat(t));let c={"Content-Type":"application/json"};n&&(c.Cookie=n),i&&(c["X-CSRF-Token"]=i);let d=await fetch(o,{method:"PATCH",headers:c,body:JSON.stringify({}),credentials:"include"});if(!d.ok){let e=await d.json().catch(()=>({})),t=Error(e.error||e.message||"Failed to activate account");throw t.status=d.status,t}return d.json()},delete:async(e,t,n,i)=>{let o=(0,a.b)("DELETE","".concat(r,"/accounts/").concat(e));t&&(o+="?shopId=".concat(t));let c={};n&&(c.Cookie=n),i&&(c["X-CSRF-Token"]=i);let d=await fetch(o,{method:"DELETE",headers:c,credentials:"include"});if(!d.ok){let e=await d.json().catch(()=>({})),t=Error(e.error||e.message||"Failed to delete account");throw t.status=d.status,t}}}},44225:function(e,t,n){"use strict";n.d(t,{Np:function(){return i},X1:function(){return a},ax:function(){return o},hS:function(){return r}});let a={primary:"#1890ff",secondary:"#13c2c2",success:"#52c41a",warning:"#faad14",error:"#ff4d4f",background:"#f5f5f5",cardBg:"#ffffff",text:"#262626",textSecondary:"#8c8c8c",border:"#f0f0f0",id_dineIn:"#1890ff",id_takeaway:"#52c41a",id_delivery:"#722ed1",kitchen:"#ff6b35",shift:"#10b981",kitchenBg:"#0f172a",kitchenCard:"rgba(30, 41, 59, 0.7)",kitchenBorder:"rgba(255, 255, 255, 0.1)"},r={dineIn:{primary:"#1890ff",light:"#e6f7ff",border:"#91d5ff",gradient:"linear-gradient(135deg, #1890ff 0%, #096dd9 100%)"},takeaway:{primary:"#52c41a",light:"#f6ffed",border:"#b7eb8f",gradient:"linear-gradient(135deg, #52c41a 0%, #73d13d 100%)"},delivery:{primary:"#722ed1",light:"#f9f0ff",border:"#d3adf7",gradient:"linear-gradient(135deg, #722ed1 0%, #9254de 100%)"}},i={container:{minHeight:"100vh",background:a.background,fontFamily:"'Inter', 'Sarabun', sans-serif"},heroParams:{background:"linear-gradient(135deg, #1890ff 0%, #096dd9 100%)",padding:"32px 24px 70px",position:"relative",borderBottomLeftRadius:24,borderBottomRightRadius:24,boxShadow:"0 8px 24px rgba(24, 144, 255, 0.25)",marginBottom:-40,zIndex:1,overflow:"hidden"},kitchenContainer:{minHeight:"100vh",background:"#0f172a",padding:"24px 24px 100px",color:"#f8fafc",fontFamily:"'Inter', 'Sarabun', sans-serif"},kitchenGlassCard:{background:"rgba(30, 41, 59, 0.7)",backdropFilter:"blur(12px)",border:"1px solid rgba(255, 255, 255, 0.1)",borderRadius:20,boxShadow:"0 8px 32px rgba(0, 0, 0, 0.3)",overflow:"hidden"},kitchenHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:24,flexWrap:"wrap",gap:16},shiftHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:24},sectionTitle:{display:"flex",alignItems:"center",gap:12,marginBottom:20,color:"#fff"},contentWrapper:{maxWidth:1400,margin:"-40px auto 30px",padding:"0 24px",position:"relative",zIndex:20},card:{borderRadius:16,boxShadow:"0 4px 12px rgba(0,0,0,0.05)",border:"none",overflow:"hidden",background:a.cardBg},itemCard:{marginBottom:8,borderRadius:8,transition:"all 0.3s ease"}},o={available:{primary:"#52c41a",light:"#f6ffed",border:"#b7eb8f",gradient:"linear-gradient(135deg, #52c41a 0%, #73d13d 100%)"},occupied:{primary:"#fa8c16",light:"#fff7e6",border:"#ffd591",gradient:"linear-gradient(135deg, #fa8c16 0%, #ffa940 100%)"},inactive:{primary:"#8c8c8c",light:"#fafafa",border:"#d9d9d9",gradient:"linear-gradient(135deg, #8c8c8c 0%, #bfbfbf 100%)"},waitingForPayment:{primary:"#1890ff",light:"#e6f7ff",border:"#91d5ff",gradient:"linear-gradient(135deg, #1890ff 0%, #40a9ff 100%)"}}},3286:function(e,t,n){"use strict";n.d(t,{e:function(){return c}});var a=n(2265),r=n(34029),i=n(99376),o=n(14362);function c(){let{requiredRole:e="Admin",redirectUnauthenticated:t="/login",redirectUnauthorized:n="/pos",unauthorizedMessage:c="คุณไม่มีสิทธิ์เข้าถึงหน้านี้"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},d=(0,i.useRouter)(),{user:s,loading:l}=(0,o.a)(),f=(0,a.useMemo)(()=>l?"checking":s?e&&s.role!==e?"unauthorized":"authorized":"unauthenticated",[s,l,e]),u=(0,a.useRef)(!1);return(0,a.useEffect)(()=>{if("unauthenticated"===f){d.replace(t);return}"unauthorized"===f&&(u.current||(u.current=!0,r.ZP.error(c)),d.replace(n))},[f,d,t,n,c]),{status:f,isAuthorized:"authorized"===f,isChecking:"checking"===f,user:s}}},97235:function(e,t,n){"use strict";n.d(t,{P:function(){return c}});var a=n(5447);let r=null,i=0,o=null;async function c(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=Date.now();return!e&&r&&t-i<6e5?r:(o||(o=a.O.getCsrfToken().then(e=>(r=e||"",i=Date.now(),r)).finally(()=>{o=null})),o)}}},function(e){e.O(0,[5015,7717,7698,742,3211,7993,8651,2646,6207,7213,9021,2224,3248,1721,9,5496,3834,8640,6931,2239,4200,4853,3490,2971,2117,1744],function(){return e(e.s=66630)}),_N_E=e.O()}]);