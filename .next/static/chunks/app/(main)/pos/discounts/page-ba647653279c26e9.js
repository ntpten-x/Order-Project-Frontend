(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2519],{90153:function(e,i,t){Promise.resolve().then(t.bind(t,62024))},62024:function(e,i,t){"use strict";t.r(i),t.d(i,{default:function(){return O}});var n=t(57437),s=t(2265),d=t(19683),l=t(88589),r=t(50742),o=t(96931),a=t(80009),c=t(85180),x=t(53743),g=t(34029),p=t(44314),h=t(29436),y=t(89245),u=t(96473),f=t(2261),j=t(62670),b=t(8900),m=t(8881),F=t(13377),v=t(26349),E=t(69477),k=t(99376),S=t(3369),w=t(26972),C=t(24675),B=t(97235),z=t(3286),R=t(67697),Z=t(69397);let _={...(0,Z.yf)("linear-gradient(135deg, #F59E0B 0%, #D97706 100%)"),discountCard:Z.YO,discountCardInner:Z.lv},I=(0,Z.IU)(".discount-page",".discount-card");var W=t(2938);let{Text:A,Title:D}=d.default,P=e=>{let{onRefresh:i,onAdd:t,searchValue:s,onSearchChange:d,total:o}=e;return(0,n.jsxs)("div",{style:{marginBottom:24,background:"white",padding:"16px",borderRadius:20,boxShadow:"0 4px 20px rgba(0,0,0,0.03)"},children:[(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12,marginBottom:16},children:[(0,n.jsx)("div",{style:{width:44,height:44,background:"linear-gradient(135deg, #F59E0B 0%, #D97706 100%)",borderRadius:12,display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 4px 12px rgba(245, 158, 11, 0.3)",flexShrink:0},children:(0,n.jsx)(p.Z,{style:{fontSize:22,color:"white"}})}),(0,n.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,n.jsx)(D,{level:4,style:{margin:0,fontSize:18,fontWeight:700,color:"#1E293B"},children:"จัดการส่วนลด"}),(0,n.jsxs)(A,{style:{color:"#64748B",fontSize:13},children:[o," รายการ"]})]})]}),(0,n.jsxs)("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[(0,n.jsx)(l.default,{prefix:(0,n.jsx)(h.Z,{style:{color:"#94A3B8"}}),allowClear:!0,placeholder:"ค้นหา...",value:s,onChange:e=>d(e.target.value),style:{flex:1,minWidth:120,height:44,borderRadius:12,background:"#F8FAFC",fontSize:14,border:"1px solid #E2E8F0"}}),(0,n.jsx)(r.ZP,{icon:(0,n.jsx)(y.Z,{}),onClick:i,style:{height:44,width:44,borderRadius:12,border:"1px solid #E2E8F0",color:"#64748B",flexShrink:0}}),(0,n.jsx)(r.ZP,{type:"primary",icon:(0,n.jsx)(u.Z,{}),onClick:t,style:{height:44,padding:"0 16px",borderRadius:12,background:"linear-gradient(135deg, #F59E0B 0%, #D97706 100%)",boxShadow:"0 4px 12px rgba(245, 158, 11, 0.3)",fontSize:14,fontWeight:600,border:"none",flexShrink:0},children:"เพิ่มส่วนลด"})]})]})},L=e=>{let{total:i,fixed:t,percent:s,active:d,inactive:l}=e;return(0,n.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 mb-6",children:[(0,n.jsxs)("div",{style:{background:"white",padding:"12px 14px",borderRadius:16,boxShadow:"0 2px 10px rgba(0,0,0,0.02)",border:"1px solid #F1F5F9",display:"flex",alignItems:"center",gap:10},children:[(0,n.jsx)("div",{style:{width:40,height:40,borderRadius:10,background:"#FFF7ED",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:(0,n.jsx)(f.Z,{style:{fontSize:20,color:"#F59E0B"}})}),(0,n.jsxs)("div",{style:{minWidth:0},children:[(0,n.jsx)(A,{style:{color:"#64748B",display:"block",fontSize:11},children:"ทั้งหมด"}),(0,n.jsx)(D,{level:4,style:{margin:0,color:"#1E293B",fontWeight:700,fontSize:18},children:i})]})]}),(0,n.jsxs)("div",{style:{background:"white",padding:"12px 14px",borderRadius:16,boxShadow:"0 2px 10px rgba(0,0,0,0.02)",border:"1px solid #F1F5F9",display:"flex",alignItems:"center",gap:10},children:[(0,n.jsx)("div",{style:{width:40,height:40,borderRadius:10,background:"#F0F9FF",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:(0,n.jsx)(j.Z,{style:{fontSize:20,color:"#0EA5E9"}})}),(0,n.jsxs)("div",{style:{minWidth:0},children:[(0,n.jsx)(A,{style:{color:"#64748B",display:"block",fontSize:11},children:"แบบบาท"}),(0,n.jsx)(D,{level:4,style:{margin:0,color:"#1E293B",fontWeight:700,fontSize:18},children:t})]})]}),(0,n.jsxs)("div",{style:{background:"white",padding:"12px 14px",borderRadius:16,boxShadow:"0 2px 10px rgba(0,0,0,0.02)",border:"1px solid #F1F5F9",display:"flex",alignItems:"center",gap:10},children:[(0,n.jsx)("div",{style:{width:40,height:40,borderRadius:10,background:"#F5F3FF",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:(0,n.jsx)(p.Z,{style:{fontSize:20,color:"#8B5CF6"}})}),(0,n.jsxs)("div",{style:{minWidth:0},children:[(0,n.jsx)(A,{style:{color:"#64748B",display:"block",fontSize:11},children:"แบบ %"}),(0,n.jsx)(D,{level:4,style:{margin:0,color:"#1E293B",fontWeight:700,fontSize:18},children:s})]})]}),(0,n.jsxs)("div",{style:{background:"white",padding:"12px 14px",borderRadius:16,boxShadow:"0 2px 10px rgba(0,0,0,0.02)",border:"1px solid #F1F5F9",display:"flex",alignItems:"center",gap:10},children:[(0,n.jsx)("div",{style:{width:40,height:40,borderRadius:10,background:"#ECFDF5",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:(0,n.jsx)(b.Z,{style:{fontSize:20,color:"#10B981"}})}),(0,n.jsxs)("div",{style:{minWidth:0},children:[(0,n.jsx)(A,{style:{color:"#64748B",display:"block",fontSize:11},children:"ใช้งาน"}),(0,n.jsxs)("div",{style:{display:"flex",alignItems:"baseline",gap:4},children:[(0,n.jsx)(D,{level:4,style:{margin:0,color:"#1E293B",fontWeight:700,fontSize:18},children:d}),l>0&&(0,n.jsxs)(A,{type:"secondary",style:{fontSize:11},children:["(ปิด ",l,")"]})]})]})]})]})},T=s.memo(e=>{let{discount:i,onEdit:t,onDelete:s}=e,d=i.discount_type===E.L.Fixed;return(0,n.jsxs)(o.Z,{hoverable:!0,onClick:()=>t(i),style:{borderRadius:20,border:"none",boxShadow:"0 2px 8px rgba(0,0,0,0.04)",transition:"all 0.2s",overflow:"hidden",background:"white",opacity:i.is_active?1:.7},styles:{body:{padding:16}},children:[(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:16},children:[(0,n.jsx)("div",{style:{width:56,height:56,borderRadius:16,background:d?"linear-gradient(135deg, #E0F2FE 0%, #BAE6FD 100%)":"linear-gradient(135deg, #F3E8FF 0%, #D8B4FE 100%)",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:d?"0 4px 12px rgba(14, 165, 233, 0.2)":"0 4px 12px rgba(139, 92, 246, 0.2)"},children:d?(0,n.jsx)(j.Z,{style:{fontSize:24,color:"#0369A1"}}):(0,n.jsx)(p.Z,{style:{fontSize:24,color:"#7E22CE"}})}),(0,n.jsxs)("div",{style:{padding:"4px 10px",borderRadius:20,background:i.is_active?"#ECFDF5":"#F1F5F9",color:i.is_active?"#059669":"#64748B",fontSize:12,fontWeight:600,display:"flex",alignItems:"center",gap:4},children:[i.is_active?(0,n.jsx)(b.Z,{}):(0,n.jsx)(m.Z,{}),i.is_active?"Active":"Inactive"]})]}),(0,n.jsxs)("div",{style:{marginBottom:16},children:[(0,n.jsx)(D,{level:5,style:{margin:0,marginBottom:4,color:"#1E293B"},ellipsis:!0,children:i.display_name}),(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:6},children:[(0,n.jsx)(A,{type:"secondary",style:{fontSize:13},children:"Code:"}),(0,n.jsx)(a.Z,{style:{margin:0,borderRadius:6,background:"#F8FAFC",border:"1px solid #E2E8F0",color:"#475569"},children:i.discount_name})]})]}),(0,n.jsxs)("div",{style:{background:"#F8FAFC",borderRadius:12,padding:"10px 12px",marginBottom:16,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,n.jsx)(A,{style:{fontSize:12,color:"#64748B"},children:"มูลค่าส่วนลด"}),(0,n.jsx)(A,{style:{fontSize:16,fontWeight:700,color:"#F59E0B"},children:d?"฿".concat(i.discount_amount.toLocaleString()):"".concat(i.discount_amount,"% OFF")})]}),(0,n.jsxs)("div",{style:{display:"flex",gap:8,marginTop:"auto"},children:[(0,n.jsx)(r.ZP,{type:"text",icon:(0,n.jsx)(F.Z,{}),block:!0,onClick:e=>{e.stopPropagation(),t(i)},style:{borderRadius:10,background:"#FFF7ED",color:"#F59E0B",fontWeight:600},children:"แก้ไข"}),(0,n.jsx)(r.ZP,{type:"text",icon:(0,n.jsx)(v.Z,{}),onClick:e=>{e.stopPropagation(),s(i)},style:{borderRadius:10,background:"#FEF2F2",color:"#EF4444"}})]})]})});T.displayName="DiscountCard";let N=e=>{let{onAdd:i,isSearch:t}=e;return(0,n.jsx)("div",{style:{gridColumn:"1 / -1",display:"flex",justifyContent:"center",padding:"60px 0"},children:(0,n.jsx)(c.Z,{image:c.Z.PRESENTED_IMAGE_SIMPLE,description:(0,n.jsxs)("div",{style:{textAlign:"center"},children:[(0,n.jsx)(A,{type:"secondary",style:{fontSize:16,display:"block",marginBottom:8},children:t?"ไม่พบส่วนลดที่ค้นหา":"ยังไม่มีรายการส่วนลด"}),(0,n.jsx)(A,{type:"secondary",style:{fontSize:14},children:t?"ลองเปลี่ยนคำค้นหาใหม่":"เพิ่มส่วนลดแรกเพื่อเริ่มใช้งาน"})]}),children:!t&&(0,n.jsx)(r.ZP,{type:"primary",icon:(0,n.jsx)(u.Z,{}),onClick:i,size:"large",style:{marginTop:16,background:"linear-gradient(135deg, #F59E0B 0%, #D97706 100%)",border:"none",borderRadius:12,height:44,padding:"0 32px"},children:"เพิ่มส่วนลด"})})})};function O(){return(0,n.jsx)(H,{})}function H(){let e=(0,k.useRouter)(),[i,t]=(0,s.useState)([]),[d,l]=(0,s.useState)([]),[r,o]=(0,s.useState)(""),{execute:a}=(0,w.J)(),{showLoading:c}=(0,S.x)(),{socket:p}=(0,C.s)(),{isAuthorized:h,isChecking:y}=(0,z.e)({requiredRole:"Admin"});(0,s.useEffect)(()=>{(0,B.P)()},[]);let u=(0,s.useCallback)(async()=>{a(async()=>{let e=await fetch("/api/pos/discounts");if(!e.ok)throw Error("ไม่สามารถดึงข้อมูลส่วนลดได้");let i=await e.json();t(i),l(i)},"กำลังโหลดข้อมูลส่วนลด...")},[a]);(0,s.useEffect)(()=>{h&&u()},[h,u]),(0,s.useEffect)(()=>{if(r.trim()){let e=r.trim().toLowerCase();l(i.filter(i=>{var t,n,s;return(null===(t=i.display_name)||void 0===t?void 0:t.toLowerCase().includes(e))||(null===(n=i.discount_name)||void 0===n?void 0:n.toLowerCase().includes(e))||(null===(s=i.description)||void 0===s?void 0:s.toLowerCase().includes(e))}))}else l(i)},[r,i]),(0,R.v)(p,{create:"discounts:create",update:"discounts:update",delete:"discounts:delete"},t);let f=()=>{c("กำลังเปิดหน้าจัดการส่วนลด..."),e.push("/pos/discounts/manager/add")},j=i=>{c("กำลังเปิดหน้าแก้ไขส่วนลด..."),e.push("/pos/discounts/manager/edit/".concat(i.id))},b=e=>{x.Z.confirm({title:"ยืนยันการลบส่วนลด",content:'คุณต้องการลบส่วนลด "'.concat(e.display_name||e.discount_name,'" หรือไม่?'),okText:"ลบรายการ",okType:"danger",cancelText:"ยกเลิก",centered:!0,icon:(0,n.jsx)(v.Z,{style:{color:"#EF4444"}}),styles:{body:{borderRadius:16}},onOk:async()=>{await a(async()=>{let i=await (0,B.P)();if(!(await fetch("/api/pos/discounts/delete/".concat(e.id),{method:"DELETE",headers:{"X-CSRF-Token":i}})).ok)throw Error("ไม่สามารถลบส่วนลดได้");g.ZP.success("ลบส่วนลดสำเร็จ")},"กำลังลบส่วนลด...")}})};if(y)return(0,n.jsx)(W.H,{message:"กำลังตรวจสอบสิทธิ์การใช้งาน..."});if(!h)return(0,n.jsx)(W.H,{message:"คุณไม่มีสิทธิ์เข้าถึงหน้านี้",tone:"danger"});let m=i.filter(e=>e.is_active),F=i.filter(e=>!e.is_active),Z=i.filter(e=>e.discount_type===E.L.Fixed),A=i.filter(e=>e.discount_type===E.L.Percentage);return(0,n.jsxs)("div",{className:"discount-page px-4 md:px-6",style:{..._.container,paddingTop:16,paddingBottom:24,background:"#F8FAFC",minHeight:"100vh"},children:[(0,n.jsx)("style",{children:I}),(0,n.jsx)(P,{onRefresh:u,onAdd:f,searchValue:r,onSearchChange:o,total:i.length}),(0,n.jsx)(L,{total:i.length,fixed:Z.length,percent:A.length,active:m.length,inactive:F.length}),(0,n.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(260px, 1fr))",gap:16,paddingBottom:40},children:d.length>0?d.map(e=>(0,n.jsx)(T,{discount:e,onEdit:j,onDelete:b},e.id)):(0,n.jsx)(N,{onAdd:f,isSearch:!!r})})]})}}},function(e){e.O(0,[8024,4736,8592,1744],function(){return e(e.s=90153)}),_N_E=e.O()}]);