(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6012],{55516:function(e,t,n){Promise.resolve().then(n.bind(n,63168))},63168:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return P}});var a=n(57437),i=n(2265),s=n(88589),r=n(44967),o=n(34029),d=n(53743),c=n(48651),l=n(55846),u=n(33477),p=n(80336),m=n(99376),f=n(69477),h=n(82646),g=n(62670),x=n(44314),y=n(72175);let{Text:j}=h.default,{pageStyles:_,ManagePageStyles:b}=(0,y.dg)({focusColor:"#fa8c16",focusShadow:"rgba(250, 140, 22, 0.1)",switchGradient:"linear-gradient(135deg, #fa8c16 0%, #d48806 100%)",extraCss:"\n        .manage-page .ant-radio-button-wrapper {\n            border-radius: 12px !important;\n            border: 2px solid #f0f0f0 !important;\n            margin-right: 8px;\n            padding: 8px 16px;\n            height: auto !important;\n        }\n\n        .manage-page .ant-radio-button-wrapper:first-child {\n            border-radius: 12px !important;\n        }\n\n        .manage-page .ant-radio-button-wrapper:last-child {\n            border-radius: 12px !important;\n        }\n\n        .manage-page .ant-radio-button-wrapper-checked {\n            border-color: #fa8c16 !important;\n            background: linear-gradient(135deg, #fff7e6 0%, #ffe7ba 100%) !important;\n            color: #fa8c16 !important;\n        }\n\n        .manage-page .ant-radio-button-wrapper-checked::before {\n            display: none !important;\n        }\n    "}),w=e=>{let{isEdit:t,onBack:n,onDelete:i}=e;return(0,a.jsx)(y.oI,{pageStyles:_,isEdit:t,onBack:n,onDelete:i,titleCreate:"เพิ่มส่วนลด",titleEdit:"แก้ไขส่วนลด"})},k=e=>{let{displayName:t,discountType:n,discountAmount:i}=e,s=n===f.L.Fixed;return(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:14,padding:16,background:"#fafafa",borderRadius:16,marginTop:12},children:[(0,a.jsx)("div",{style:{width:80,height:80,borderRadius:14,border:"2px solid white",boxShadow:"0 4px 12px rgba(0,0,0,0.08)",overflow:"hidden",position:"relative",flexShrink:0,background:s?"linear-gradient(135deg, #e6f7ff 0%, #bae7ff 100%)":"linear-gradient(135deg, #f9f0ff 0%, #efdbff 100%)",display:"flex",alignItems:"center",justifyContent:"center"},children:s?(0,a.jsx)(g.Z,{style:{fontSize:32,color:"#1890ff",opacity:.8}}):(0,a.jsx)(x.Z,{style:{fontSize:32,color:"#722ed1",opacity:.8}})}),(0,a.jsxs)("div",{children:[(0,a.jsx)(j,{strong:!0,style:{display:"block",marginBottom:4,fontSize:16},children:t||"ตัวอย่างส่วนลด"}),(0,a.jsx)(j,{type:"secondary",style:{fontSize:14},children:i?s?"ลด ฿".concat(i):"ลด ".concat(i,"%"):"กรุณาระบุมูลค่าส่วนลด"})]})]})},v=e=>{let{isEdit:t,loading:n,onCancel:i}=e;return(0,a.jsx)(y.uM,{pageStyles:_,isEdit:t,loading:n,onCancel:i})};var C=n(97235),Z=n(3286),S=n(2938);let{TextArea:E}=s.default;function P(e){let{params:t}=e,n=(0,m.useRouter)(),[h]=r.Z.useForm(),[g,x]=(0,i.useState)(!1),[y,j]=(0,i.useState)(!1),[P,F]=(0,i.useState)(""),[L,T]=(0,i.useState)(f.L.Fixed),[I,N]=(0,i.useState)(""),D=t.mode[0],z=t.mode[1]||null,R="edit"===D&&!!z,{isAuthorized:B,isChecking:O}=(0,Z.e)({requiredRole:"Admin"});(0,i.useEffect)(()=>{(async()=>{N(await (0,C.P)())})()},[]);let q=(0,i.useCallback)(async()=>{x(!0);try{let e=await fetch("/api/pos/discounts/getById/".concat(z));if(!e.ok)throw Error("ไม่สามารถดึงข้อมูลส่วนลดได้");let t=await e.json();h.setFieldsValue({discount_name:t.discount_name,display_name:t.display_name,description:t.description,discount_type:t.discount_type,discount_amount:t.discount_amount,is_active:t.is_active}),F(t.display_name||t.discount_name||""),T(t.discount_type||f.L.Fixed)}catch(e){console.error(e),o.ZP.error("ไม่สามารถดึงข้อมูลส่วนลดได้"),n.push("/pos/discounts")}finally{x(!1)}},[z,h,n]);(0,i.useEffect)(()=>{R&&q()},[R,z,q]);let A=async e=>{j(!0);try{if(R){let t=await fetch("/api/pos/discounts/update/".concat(z),{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-Token":I},body:JSON.stringify(e)});if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.error||e.message||"ไม่สามารถอัปเดตส่วนลดได้")}o.ZP.success("อัปเดตส่วนลดสำเร็จ")}else{let t=await fetch("/api/pos/discounts/create",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":I},body:JSON.stringify(e)});if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.error||e.message||"ไม่สามารถสร้างส่วนลดได้")}o.ZP.success("สร้างส่วนลดสำเร็จ")}n.push("/pos/discounts")}catch(e){console.error(e),o.ZP.error(e.message||(R?"ไม่สามารถอัปเดตส่วนลดได้":"ไม่สามารถสร้างส่วนลดได้"))}finally{j(!1)}},V=()=>n.push("/pos/discounts");return O?(0,a.jsx)(S.H,{message:"กำลังตรวจสอบสิทธิ์..."}):B?(0,a.jsxs)("div",{className:"manage-page",style:_.container,children:[(0,a.jsx)(b,{}),(0,a.jsx)(w,{isEdit:R,onBack:V,onDelete:R?()=>{z&&d.Z.confirm({title:"ยืนยันการลบส่วนลด",content:'คุณต้องการลบส่วนลด "'.concat(P,'" หรือไม่?'),okText:"ลบ",okType:"danger",cancelText:"ยกเลิก",centered:!0,onOk:async()=>{try{if(!(await fetch("/api/pos/discounts/delete/".concat(z),{method:"DELETE",headers:{"X-CSRF-Token":I}})).ok)throw Error("ไม่สามารถลบส่วนลดได้");o.ZP.success("ลบส่วนลดสำเร็จ"),n.push("/pos/discounts")}catch(e){console.error(e),o.ZP.error("ไม่สามารถลบส่วนลดได้")}}})}:void 0}),(0,a.jsx)("div",{className:"manage-form-card",style:_.formCard,children:g?(0,a.jsx)("div",{style:{display:"flex",justifyContent:"center",padding:"60px 0"},children:(0,a.jsx)(c.Z,{size:"large"})}):(0,a.jsxs)(r.Z,{form:h,layout:"vertical",onFinish:A,requiredMark:!1,autoComplete:"off",initialValues:{is_active:!0,discount_type:f.L.Fixed,discount_amount:0},onValuesChange:e=>{void 0!==e.display_name&&F(e.display_name),void 0!==e.discount_type&&T(e.discount_type)},children:[(0,a.jsx)(r.Z.Item,{name:"discount_name",label:"รหัสส่วนลด (ในระบบ) *",rules:[{required:!0,message:"กรุณากรอกรหัสส่วนลด"},{max:50,message:"ความยาวต้องไม่เกิน 50 ตัวอักษร"}],children:(0,a.jsx)(s.default,{size:"large",placeholder:"เช่น DISCOUNT_10, NEW_YEAR",maxLength:50})}),(0,a.jsx)(r.Z.Item,{name:"display_name",label:"ชื่อที่แสดงให้ลูกค้า *",rules:[{required:!0,message:"กรุณากรอกชื่อที่แสดง"},{max:100,message:"ความยาวต้องไม่เกิน 100 ตัวอักษร"}],children:(0,a.jsx)(s.default,{size:"large",placeholder:"เช่น ส่วนลดปีใหม่, ลด 10%",maxLength:100})}),(0,a.jsx)(r.Z.Item,{name:"description",label:"รายละเอียด/เงื่อนไข",rules:[{max:500,message:"ความยาวต้องไม่เกิน 500 ตัวอักษร"}],children:(0,a.jsx)(E,{rows:3,placeholder:"รายละเอียดเงื่อนไขของส่วนลด (ถ้ามี)",maxLength:500})}),(0,a.jsx)(r.Z.Item,{name:"discount_type",label:"ประเภทส่วนลด *",rules:[{required:!0,message:"กรุณาเลือกประเภทส่วนลด"}],children:(0,a.jsxs)(l.ZP.Group,{buttonStyle:"solid",children:[(0,a.jsx)(l.ZP.Button,{value:f.L.Fixed,children:"\uD83D\uDCB5 ลดเป็นบาท (Fixed)"}),(0,a.jsx)(l.ZP.Button,{value:f.L.Percentage,children:"\uD83D\uDCCA ลดเป็นเปอร์เซ็นต์ (%)"})]})}),(0,a.jsx)(r.Z.Item,{name:"discount_amount",label:L===f.L.Fixed?"มูลค่าส่วนลด (บาท) *":"มูลค่าส่วนลด (%) *",rules:[{required:!0,message:"กรุณากรอกมูลค่าส่วนลด"},{validator:async(e,t)=>{if(t<0)throw Error("มูลค่าต้องไม่ติดลบ");if(L===f.L.Percentage&&t>100)throw Error("เปอร์เซ็นต์ต้องไม่เกิน 100%")}}],children:(0,a.jsx)(u.Z,{size:"large",min:0,max:L===f.L.Percentage?100:void 0,placeholder:L===f.L.Fixed?"เช่น 50":"เช่น 10",style:{width:"100%"},addonAfter:L===f.L.Fixed?"บาท":"%"})}),(0,a.jsx)(r.Z.Item,{noStyle:!0,dependencies:["display_name","discount_type","discount_amount"],children:e=>{let{getFieldValue:t}=e;return(0,a.jsx)(k,{displayName:t("display_name"),discountType:t("discount_type"),discountAmount:t("discount_amount")})}}),(0,a.jsx)(r.Z.Item,{name:"is_active",label:"สถานะการใช้งาน",valuePropName:"checked",style:{marginTop:20},children:(0,a.jsx)(p.Z,{checkedChildren:"เปิดใช้งาน",unCheckedChildren:"ปิดใช้งาน"})}),(0,a.jsx)(v,{isEdit:R,loading:y,onCancel:V})]})})]}):(0,a.jsx)(S.H,{message:"คุณไม่มีสิทธิ์เข้าถึงหน้านี้",tone:"danger"})}},69477:function(e,t,n){"use strict";var a,i;n.d(t,{L:function(){return a}}),(i=a||(a={})).Fixed="Fixed",i.Percentage="Percentage"}},function(e){e.O(0,[5015,7717,7698,742,3211,7993,8651,2646,6207,7213,9021,2224,3248,5616,8589,4967,4547,5775,1672,1356,4243,2971,2117,1744],function(){return e(e.s=55516)}),_N_E=e.O()}]);