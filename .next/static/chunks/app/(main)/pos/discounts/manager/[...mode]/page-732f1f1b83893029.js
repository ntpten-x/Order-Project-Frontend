(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6012],{55516:function(e,t,n){Promise.resolve().then(n.bind(n,63168))},63168:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return L}});var i=n(57437),r=n(2265),a=n(88589),s=n(19878),o=n(34029),d=n(53743),l=n(50742),c=n(48651),u=n(55846),p=n(90136),g=n(66487),h=n(99376),m=n(69477),x=n(25193),y=n(37410),f=n(20148),b=n(60283),j=n(62670),F=n(44314),w=n(72175);let{pageStyles:k,ManagePageStyles:E}=(0,w.dg)({focusColor:"#F59E0B",focusShadow:"rgba(245, 158, 11, 0.15)",switchGradient:"linear-gradient(135deg, #F59E0B 0%, #D97706 100%)",extraCss:"\n        .manage-page .ant-radio-button-wrapper {\n            border-radius: 12px !important;\n            border: 2px solid #f0f0f0 !important;\n            margin-right: 8px;\n            padding: 8px 16px;\n            height: auto !important;\n        }\n\n        .manage-page .ant-radio-button-wrapper:first-child {\n            border-radius: 12px !important;\n        }\n\n        .manage-page .ant-radio-button-wrapper:last-child {\n            border-radius: 12px !important;\n        }\n\n        .manage-page .ant-radio-button-wrapper-checked {\n            border-color: #F59E0B !important;\n            background: linear-gradient(135deg, #FFF7ED 0%, #FFEDD5 100%) !important;\n            color: #F59E0B !important;\n        }\n\n        .manage-page .ant-radio-button-wrapper-checked::before {\n            display: none !important;\n        }\n    "}),_=e=>{let{displayName:t,discountType:n,discountAmount:r}=e,a=n===m.L.Fixed;return(0,i.jsxs)("div",{children:[(0,i.jsx)(b.default.Text,{type:"secondary",style:{display:"block",marginBottom:12,fontSize:13,textAlign:"center"},children:"ตัวอย่างคูปอง (Preview)"}),(0,i.jsxs)("div",{style:{background:"white",borderRadius:20,overflow:"hidden",boxShadow:"0 8px 30px rgba(0,0,0,0.06)",border:"1px solid #F1F5F9",maxWidth:300,margin:"0 auto",position:"relative"},children:[(0,i.jsxs)("div",{style:{height:80,background:a?"linear-gradient(135deg, #3B82F6 0%, #2563EB 100%)":"linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%)",display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:[(0,i.jsx)("div",{style:{width:48,height:48,background:"rgba(255,255,255,0.2)",backdropFilter:"blur(10px)",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",border:"1px solid rgba(255,255,255,0.3)"},children:a?(0,i.jsx)(j.Z,{style:{fontSize:24,color:"white"}}):(0,i.jsx)(F.Z,{style:{fontSize:24,color:"white"}})}),(0,i.jsx)("div",{style:{position:"absolute",bottom:-10,left:-10,width:20,height:20,borderRadius:"50%",background:"#F8FAFC"}}),(0,i.jsx)("div",{style:{position:"absolute",bottom:-10,right:-10,width:20,height:20,borderRadius:"50%",background:"#F8FAFC"}})]}),(0,i.jsxs)("div",{style:{padding:"24px 20px",textAlign:"center"},children:[(0,i.jsxs)("div",{style:{fontSize:32,fontWeight:800,color:a?"#2563EB":"#7C3AED",lineHeight:1,marginBottom:8},children:[a?"฿":"",(r||0).toLocaleString(),a?"":"%"]}),(0,i.jsx)("div",{style:{fontSize:14,fontWeight:600,color:"#94A3B8",textTransform:"uppercase",letterSpacing:"1px",marginBottom:16},children:"DISCOUNT"}),(0,i.jsx)("div",{style:{height:1,background:"#E2E8F0",marginBottom:16,width:"100%"}}),(0,i.jsx)(b.default.Text,{strong:!0,style:{fontSize:16,color:"#1E293B",display:"block",marginBottom:4},children:t||"ชื่อส่วนลด"}),(0,i.jsx)(b.default.Text,{type:"secondary",style:{fontSize:12},children:"พร้อมใช้งานทันที"})]})]})]})},v=e=>{let{isEdit:t,loading:n,onCancel:r}=e;return(0,i.jsx)(w.uM,{pageStyles:k,isEdit:t,loading:n,onCancel:r})};var C=n(97235),B=n(67918),S=n(2938);let{TextArea:Z}=a.default;function L(e){let{params:t}=e,n=(0,h.useRouter)(),[b]=s.Z.useForm(),[j,F]=(0,r.useState)(!1),[w,L]=(0,r.useState)(!1),[P,T]=(0,r.useState)(""),[A,D]=(0,r.useState)(m.L.Fixed),[R,N]=(0,r.useState)(""),z=t.mode[0],I=t.mode[1]||null,H="edit"===z&&!!I,{isAuthorized:O,isChecking:W}=(0,B.e)({allowedRoles:["Admin","Manager"]});(0,r.useEffect)(()=>{(async()=>{N(await (0,C.P)())})()},[]);let q=(0,r.useCallback)(async()=>{F(!0);try{let e=await fetch("/api/pos/discounts/getById/".concat(I));if(!e.ok)throw Error("ไม่สามารถดึงข้อมูลส่วนลดได้");let t=await e.json();b.setFieldsValue({discount_name:t.discount_name,display_name:t.display_name,description:t.description,discount_type:t.discount_type,discount_amount:t.discount_amount,is_active:t.is_active}),T(t.display_name||t.discount_name||""),D(t.discount_type||m.L.Fixed)}catch(e){console.error(e),o.ZP.error("ไม่สามารถดึงข้อมูลส่วนลดได้"),n.push("/pos/discounts")}finally{F(!1)}},[I,b,n]);(0,r.useEffect)(()=>{H&&q()},[H,I,q]);let U=async e=>{L(!0);try{if(H){let t=await fetch("/api/pos/discounts/update/".concat(I),{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-Token":R},body:JSON.stringify(e)});if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.error||e.message||"ไม่สามารถอัปเดตส่วนลดได้")}o.ZP.success("อัปเดตส่วนลดสำเร็จ")}else{let t=await fetch("/api/pos/discounts/create",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":R},body:JSON.stringify(e)});if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.error||e.message||"ไม่สามารถสร้างส่วนลดได้")}o.ZP.success("สร้างส่วนลดสำเร็จ")}n.push("/pos/discounts")}catch(e){console.error(e),o.ZP.error(e.message||(H?"ไม่สามารถอัปเดตส่วนลดได้":"ไม่สามารถสร้างส่วนลดได้"))}finally{L(!1)}},V=()=>n.push("/pos/discounts");return W?(0,i.jsx)(S.H,{message:"กำลังตรวจสอบสิทธิ์..."}):O?(0,i.jsxs)("div",{className:"manage-page",style:k.container,children:[(0,i.jsx)(E,{}),(0,i.jsx)(f.Z,{title:H?"แก้ไขส่วนลด":"เพิ่มส่วนลด",subtitle:H?"แก้ไขข้อมูลส่วนลด":"สร้างส่วนลดใหม่",onBack:V,actions:H?(0,i.jsx)(l.ZP,{danger:!0,onClick:()=>{I&&d.Z.confirm({title:"ยืนยันการลบส่วนลด",content:'คุณต้องการลบส่วนลด "'.concat(P,'" หรือไม่?'),okText:"ลบ",okType:"danger",cancelText:"ยกเลิก",centered:!0,onOk:async()=>{try{if(!(await fetch("/api/pos/discounts/delete/".concat(I),{method:"DELETE",headers:{"X-CSRF-Token":R}})).ok)throw Error("ไม่สามารถลบส่วนลดได้");o.ZP.success("ลบส่วนลดสำเร็จ"),n.push("/pos/discounts")}catch(e){console.error(e),o.ZP.error("ไม่สามารถลบส่วนลดได้")}}})},children:"ลบ"}):null}),(0,i.jsx)(x.Z,{maxWidth:1e3,children:(0,i.jsx)(y.Z,{style:{background:"transparent",border:"none"},children:(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,i.jsx)("div",{className:"md:col-span-2",style:{...k.formCard,margin:0},children:j?(0,i.jsx)("div",{style:{display:"flex",justifyContent:"center",padding:"60px 0"},children:(0,i.jsx)(c.Z,{size:"large"})}):(0,i.jsxs)(s.Z,{form:b,layout:"vertical",onFinish:U,requiredMark:!1,autoComplete:"off",initialValues:{is_active:!0,discount_type:m.L.Fixed,discount_amount:0},onValuesChange:e=>{void 0!==e.display_name&&T(e.display_name),void 0!==e.discount_type&&D(e.discount_type)},children:[(0,i.jsx)(s.Z.Item,{name:"discount_name",label:"รหัสส่วนลด (ในระบบ) *",rules:[{required:!0,message:"กรุณากรอกรหัสส่วนลด"},{max:50,message:"ความยาวต้องไม่เกิน 50 ตัวอักษร"}],children:(0,i.jsx)(a.default,{size:"large",placeholder:"เช่น DISCOUNT_10, NEW_YEAR",maxLength:50})}),(0,i.jsx)(s.Z.Item,{name:"display_name",label:"ชื่อที่แสดงให้ลูกค้า *",rules:[{required:!0,message:"กรุณากรอกชื่อที่แสดง"},{max:100,message:"ความยาวต้องไม่เกิน 100 ตัวอักษร"}],children:(0,i.jsx)(a.default,{size:"large",placeholder:"เช่น ส่วนลดปีใหม่, ลด 10%",maxLength:100})}),(0,i.jsx)(s.Z.Item,{name:"description",label:"รายละเอียด/เงื่อนไข",rules:[{max:500,message:"ความยาวต้องไม่เกิน 500 ตัวอักษร"}],children:(0,i.jsx)(Z,{rows:3,placeholder:"รายละเอียดเงื่อนไขของส่วนลด (ถ้ามี)",maxLength:500,style:{borderRadius:12}})}),(0,i.jsxs)("div",{style:{background:"#F8FAFC",padding:16,borderRadius:16,marginBottom:24,border:"1px solid #E2E8F0"},children:[(0,i.jsx)(s.Z.Item,{name:"discount_type",label:"ประเภทส่วนลด *",rules:[{required:!0,message:"กรุณาเลือกประเภทส่วนลด"}],style:{marginBottom:16},children:(0,i.jsxs)(u.ZP.Group,{buttonStyle:"solid",style:{width:"100%",display:"flex",gap:8},children:[(0,i.jsx)(u.ZP.Button,{value:m.L.Fixed,style:{flex:1,textAlign:"center",borderRadius:10,height:40,lineHeight:"38px",border:A===m.L.Fixed?"none":"1px solid #E2E8F0",background:A===m.L.Fixed?"#3B82F6":"white",fontWeight:600},children:"\uD83D\uDCB5 ลดเป็นบาท (THB)"}),(0,i.jsx)(u.ZP.Button,{value:m.L.Percentage,style:{flex:1,textAlign:"center",borderRadius:10,height:40,lineHeight:"38px",border:A===m.L.Percentage?"none":"1px solid #E2E8F0",background:A===m.L.Percentage?"#8B5CF6":"white",fontWeight:600},children:"\uD83D\uDCCA ลดเปอร์เซ็นต์ (%)"})]})}),(0,i.jsx)(s.Z.Item,{name:"discount_amount",label:A===m.L.Fixed?"จำนวนเงินส่วนลด (บาท) *":"เปอร์เซ็นต์ส่วนลด (%) *",rules:[{required:!0,message:"กรุณากรอกมูลค่าส่วนลด"},{validator:async(e,t)=>{if(t<0)throw Error("มูลค่าต้องไม่ติดลบ");if(A===m.L.Percentage&&t>100)throw Error("เปอร์เซ็นต์ต้องไม่เกิน 100%")}}],style:{marginBottom:0},children:(0,i.jsx)(p.Z,{size:"large",min:0,max:A===m.L.Percentage?100:void 0,placeholder:A===m.L.Fixed?"เช่น 50":"เช่น 10",style:{width:"100%",height:45,borderRadius:12,fontSize:16},controls:!1,precision:A===m.L.Percentage?2:0,parser:e=>e?Number(e.replace(/[^0-9.]/g,"")):0,formatter:e=>"".concat(e).replace(/[^0-9.]/g,""),onKeyDown:e=>{if(!(["Backspace","Tab","Enter","Escape","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Home","End"].includes(e.key)||(e.ctrlKey||e.metaKey)&&["a","c","v","x"].includes(e.key.toLowerCase()))){if("."===e.key&&A===m.L.Percentage){String(b.getFieldValue("discount_amount")||"").includes(".")&&e.preventDefault();return}/^[0-9]$/.test(e.key)||e.preventDefault()}},suffix:A===m.L.Fixed?(0,i.jsx)("span",{style:{color:"#94A3B8"},children:"THB"}):(0,i.jsx)("span",{style:{color:"#94A3B8"},children:"%"})})})]}),(0,i.jsx)(s.Z.Item,{name:"is_active",label:"สถานะการใช้งาน",valuePropName:"checked",children:(0,i.jsx)(g.Z,{checkedChildren:"เปิดใช้งาน",unCheckedChildren:"ปิดใช้งาน"})}),(0,i.jsx)(v,{isEdit:H,loading:w,onCancel:V})]})}),(0,i.jsx)("div",{className:"hidden md:block",style:{position:"sticky",top:24},children:(0,i.jsx)(s.Z.Item,{noStyle:!0,dependencies:["display_name","discount_type","discount_amount"],children:e=>{let{getFieldValue:t}=e;return(0,i.jsx)(_,{displayName:t("display_name"),discountType:t("discount_type"),discountAmount:t("discount_amount")})}})})]})})})]}):(0,i.jsx)(S.H,{message:"คุณไม่มีสิทธิ์เข้าถึงหน้านี้",tone:"danger"})}}},function(e){e.O(0,[8024,4736,8592,1744],function(){return e(e.s=55516)}),_N_E=e.O()}]);