(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6012],{55516:function(e,t,n){Promise.resolve().then(n.bind(n,49306))},49306:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return M}});var i=n(57437),r=n(2265),o=n(88589),s=n(39486),a=n(51653),d=n(19878),l=n(34029),c=n(53743),u=n(50742),g=n(48651),p=n(47451),h=n(69410),x=n(96931),m=n(55846),f=n(33477),y=n(80336),b=n(99376),j=n(25193),v=n(37410),F=n(20148),w=n(62670),_=n(44314),k=n(8900),S=n(26349),Z=n(88009),C=n(15424),E=n(78355),B=n(29271),I=n(69477),R=n(97235),L=n(67918),P=n(2938),T=n(69711);let{TextArea:z}=o.default,{Title:N,Text:A}=s.default,D=e=>{if(!e)return"-";let t=new Date(e);return Number.isNaN(t.getTime())?"-":new Intl.DateTimeFormat("th-TH",{dateStyle:"medium",timeStyle:"short"}).format(t)},W=(e,t)=>{let n=Number(t||0);return e===I.L.Percentage?"".concat(n,"%"):"".concat(n.toLocaleString("th-TH")," บาท")},O=e=>{let{displayName:t,discountName:n,discountType:r,discountAmount:o,isActive:s}=e,d=r===I.L.Fixed;return(0,i.jsxs)("div",{style:{background:"white",borderRadius:20,padding:20,boxShadow:"0 10px 30px rgba(0,0,0,0.05)",border:"1px solid #F1F5F9"},children:[(0,i.jsx)(N,{level:5,style:{color:"#D97706",marginBottom:16,fontWeight:700},children:"ตัวอย่างการแสดงผล"}),(0,i.jsxs)("div",{style:{borderRadius:16,border:"1px solid ".concat(s?"#fed7aa":"#e2e8f0"),padding:14,background:s?"#fff7ed":"#f8fafc",display:"flex",alignItems:"center",gap:12,marginBottom:16},children:[(0,i.jsx)("div",{style:{width:48,height:48,borderRadius:12,background:s?d?"linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%)":"linear-gradient(135deg, #f3e8ff 0%, #e9d5ff 100%)":"#e2e8f0",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:d?(0,i.jsx)(w.Z,{style:{fontSize:20,color:s?"#0369a1":"#64748b"}}):(0,i.jsx)(_.Z,{style:{fontSize:20,color:s?"#7e22ce":"#64748b"}})}),(0,i.jsxs)("div",{style:{textAlign:"left",flex:1},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,i.jsx)(A,{strong:!0,style:{fontSize:16,color:"#0f172a"},children:t||"ชื่อส่วนลด"}),s&&(0,i.jsx)(k.Z,{style:{color:"#10B981",fontSize:14}})]}),(0,i.jsx)(A,{type:"secondary",style:{fontSize:13,display:"block"},children:n||"discount_name"}),(0,i.jsx)(A,{style:{fontSize:13,display:"block",color:"#D97706",fontWeight:600},children:W(r,o)})]})]}),(0,i.jsx)(a.Z,{type:s?"success":"warning",showIcon:!0,message:s?"ส่วนลดนี้พร้อมใช้งานในหน้า POS":"ส่วนลดนี้จะไม่สามารถเลือกใช้งานได้"})]})};function M(e){var t,n;let{params:s}=e,w=(0,b.useRouter)(),[_]=d.Z.useForm(),[k,W]=(0,r.useState)(!1),[M,H]=(0,r.useState)(!1),[U,q]=(0,r.useState)(""),[V,X]=(0,r.useState)(""),[Y,G]=(0,r.useState)(I.L.Fixed),[J,$]=(0,r.useState)(0),[K,Q]=(0,r.useState)(!0),[ee,et]=(0,r.useState)(""),[en,ei]=(0,r.useState)(null),[er,eo]=(0,r.useState)(""),es=null===(t=s.mode)||void 0===t?void 0:t[0],ea=(null===(n=s.mode)||void 0===n?void 0:n[1])||null,ed="add"===es||"edit"===es,el="edit"===es&&!!ea,{isAuthorized:ec,isChecking:eu}=(0,L.e)({allowedRoles:["Admin","Manager"]}),eg=(0,r.useMemo)(()=>el?"แก้ไขส่วนลด":"เพิ่มส่วนลด",[el]);(0,r.useEffect)(()=>{ed&&("edit"!==es||ea)||(l.ZP.warning("รูปแบบ URL ไม่ถูกต้อง"),w.replace("/pos/discounts"))},[ea,ed,es,w]),(0,r.useEffect)(()=>{(async()=>{et(await (0,R.P)())})()},[]);let ep=(0,r.useCallback)(async()=>{if(ea){W(!0);try{var e,t;let n=await fetch("/api/pos/discounts/getById/".concat(ea));if(!n.ok)throw Error("ไม่สามารถดึงข้อมูลส่วนลดได้");let i=await n.json();_.setFieldsValue({discount_name:i.discount_name,display_name:i.display_name,description:i.description,discount_type:i.discount_type,discount_amount:Number(null!==(e=i.discount_amount)&&void 0!==e?e:0),is_active:i.is_active}),q(i.display_name||""),X(i.discount_name||""),G(i.discount_type||I.L.Fixed),$(Number(null!==(t=i.discount_amount)&&void 0!==t?t:0)),Q(!!i.is_active),eo((i.discount_name||"").toLowerCase()),ei(i)}catch(e){console.error(e),l.ZP.error("ไม่สามารถดึงข้อมูลส่วนลดได้"),w.replace("/pos/discounts")}finally{W(!1)}}},[ea,_,w]);(0,r.useEffect)(()=>{el&&ep()},[el,ep]);let eh=(0,r.useCallback)(async e=>{let t=e.trim();if(!t||el&&t.toLowerCase()===er)return!1;try{let e=await fetch("/api/pos/discounts/getByName/".concat(encodeURIComponent(t)));if(!e.ok)return!1;let n=await e.json();if(!(null==n?void 0:n.id)||el&&n.id===ea)return!1;return!0}catch(e){return!1}},[er,ea,el]),ex=async e=>{H(!0);try{var t;let n={discount_name:e.discount_name.trim(),display_name:e.display_name.trim(),description:(null===(t=e.description)||void 0===t?void 0:t.trim())||void 0,discount_type:e.discount_type,discount_amount:Number(e.discount_amount||0),is_active:e.is_active},i=el?"/api/pos/discounts/update/".concat(ea):"/api/pos/discounts/create",r=el?"PUT":"POST",o=await fetch(i,{method:r,headers:{"Content-Type":"application/json","X-CSRF-Token":ee},body:JSON.stringify(n)});if(!o.ok){let e=await o.json().catch(()=>({}));throw Error(e.error||e.message||(el?"ไม่สามารถอัปเดตส่วนลดได้":"ไม่สามารถสร้างส่วนลดได้"))}l.ZP.success(el?"อัปเดตส่วนลดสำเร็จ":"สร้างส่วนลดสำเร็จ"),w.push("/pos/discounts")}catch(e){console.error(e),l.ZP.error(e instanceof Error?e.message:"ไม่สามารถบันทึกข้อมูลได้")}finally{H(!1)}},em=()=>w.push("/pos/discounts");return eu?(0,i.jsx)(P.H,{message:"กำลังตรวจสอบสิทธิ์..."}):ec?(0,i.jsxs)("div",{className:"manage-page",style:T.R.container,children:[(0,i.jsx)(F.Z,{title:eg,subtitle:el?"ปรับแก้ชื่อ ประเภท มูลค่า และสถานะส่วนลด":"สร้างส่วนลดใหม่ให้พร้อมใช้งานในระบบ POS",onBack:em,actions:el?(0,i.jsx)(u.ZP,{danger:!0,onClick:()=>{ea&&c.Z.confirm({title:"ยืนยันการลบส่วนลด",content:'คุณต้องการลบส่วนลด "'.concat(U||"-",'" หรือไม่?'),okText:"ลบ",okType:"danger",cancelText:"ยกเลิก",centered:!0,icon:(0,i.jsx)(S.Z,{style:{color:"#EF4444"}}),onOk:async()=>{try{if(!(await fetch("/api/pos/discounts/delete/".concat(ea),{method:"DELETE",headers:{"X-CSRF-Token":ee}})).ok)throw Error("ไม่สามารถลบส่วนลดได้");l.ZP.success("ลบส่วนลดสำเร็จ"),w.push("/pos/discounts")}catch(e){console.error(e),l.ZP.error("ไม่สามารถลบส่วนลดได้")}}})},icon:(0,i.jsx)(S.Z,{}),children:"ลบ"}):null}),(0,i.jsx)(j.Z,{maxWidth:1040,children:(0,i.jsx)(v.Z,{style:{background:"transparent",border:"none"},children:k?(0,i.jsx)("div",{style:{display:"flex",justifyContent:"center",padding:"90px 0"},children:(0,i.jsx)(g.Z,{size:"large",tip:"กำลังโหลดข้อมูล..."})}):(0,i.jsxs)(p.Z,{gutter:[20,20],children:[(0,i.jsx)(h.Z,{xs:24,lg:15,children:(0,i.jsxs)(x.Z,{bordered:!1,style:{borderRadius:20,boxShadow:"0 4px 20px rgba(0,0,0,0.04)",overflow:"hidden"},styles:{body:{padding:24}},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:10,marginBottom:20},children:[(0,i.jsx)(Z.Z,{style:{fontSize:20,color:"#D97706"}}),(0,i.jsx)(N,{level:5,style:{margin:0},children:"ข้อมูลส่วนลด"})]}),(0,i.jsxs)(d.Z,{form:_,layout:"vertical",onFinish:ex,requiredMark:!1,autoComplete:"off",initialValues:{is_active:!0,discount_type:I.L.Fixed,discount_amount:0},onValuesChange:e=>{void 0!==e.display_name&&q(e.display_name),void 0!==e.discount_name&&X(e.discount_name),void 0!==e.discount_type&&G(e.discount_type),void 0!==e.discount_amount&&$(Number(e.discount_amount||0)),void 0!==e.is_active&&Q(e.is_active)},children:[(0,i.jsx)(d.Z.Item,{name:"discount_name",label:(0,i.jsx)("span",{style:{fontWeight:600,color:"#334155"},children:"ชื่อระบบ (discount_name)"}),validateTrigger:["onBlur","onSubmit"],rules:[{required:!0,message:"กรุณากรอกชื่อระบบ"},{pattern:/^[a-zA-Z0-9\s\-_().]*$/,message:"กรอกได้เฉพาะภาษาอังกฤษ ตัวเลข และ - _ ( ) ."},{max:100,message:"ความยาวต้องไม่เกิน 100 ตัวอักษร"},{validator:async(e,t)=>{if((null==t?void 0:t.trim())&&await eh(t))throw Error("ชื่อระบบนี้ถูกใช้งานแล้ว")}}],children:(0,i.jsx)(o.default,{size:"large",placeholder:"เช่น DISCOUNT_10, VIP_MEMBER",style:{borderRadius:12,height:46,backgroundColor:"#F8FAFC",border:"1px solid #E2E8F0"},maxLength:100})}),(0,i.jsx)(d.Z.Item,{name:"display_name",label:(0,i.jsx)("span",{style:{fontWeight:600,color:"#334155"},children:"ชื่อที่แสดง"}),rules:[{required:!0,message:"กรุณากรอกชื่อที่แสดง"},{max:100,message:"ความยาวต้องไม่เกิน 100 ตัวอักษร"}],children:(0,i.jsx)(o.default,{size:"large",placeholder:"เช่น ลดสมาชิก 10%, ส่วนลดพิเศษ",style:{borderRadius:12,height:46,backgroundColor:"#F8FAFC",border:"1px solid #E2E8F0"},maxLength:100})}),(0,i.jsx)(d.Z.Item,{name:"description",label:(0,i.jsx)("span",{style:{fontWeight:600,color:"#334155"},children:"รายละเอียด/เงื่อนไข"}),rules:[{max:500,message:"ความยาวต้องไม่เกิน 500 ตัวอักษร"}],children:(0,i.jsx)(z,{rows:3,placeholder:"เช่น ใช้ได้เฉพาะบิลขั้นต่ำ 200 บาท",maxLength:500,style:{borderRadius:12,backgroundColor:"#F8FAFC",border:"1px solid #E2E8F0"}})}),(0,i.jsxs)("div",{style:{background:"#F8FAFC",padding:16,borderRadius:14,marginTop:16,marginBottom:18,border:"1px solid #E2E8F0"},children:[(0,i.jsx)(d.Z.Item,{name:"discount_type",label:(0,i.jsx)("span",{style:{fontWeight:600,color:"#334155"},children:"ประเภทส่วนลด"}),rules:[{required:!0,message:"กรุณาเลือกประเภทส่วนลด"}],style:{marginBottom:14},children:(0,i.jsxs)(m.ZP.Group,{optionType:"button",buttonStyle:"solid",style:{width:"100%",display:"grid",gridTemplateColumns:"1fr 1fr",gap:8},children:[(0,i.jsx)(m.ZP.Button,{value:I.L.Fixed,style:{textAlign:"center",borderRadius:10},children:"ลดเป็นบาท (THB)"}),(0,i.jsx)(m.ZP.Button,{value:I.L.Percentage,style:{textAlign:"center",borderRadius:10},children:"ลดเปอร์เซ็นต์ (%)"})]})}),(0,i.jsx)(d.Z.Item,{name:"discount_amount",label:(0,i.jsx)("span",{style:{fontWeight:600,color:"#334155"},children:Y===I.L.Fixed?"มูลค่าส่วนลด (บาท)":"มูลค่าส่วนลด (%)"}),rules:[{required:!0,message:"กรุณากรอกมูลค่าส่วนลด"},{validator:async(e,t)=>{if(null!=t){if(t<0)throw Error("มูลค่าต้องไม่ติดลบ");if(Y===I.L.Percentage&&t>100)throw Error("เปอร์เซ็นต์ต้องไม่เกิน 100")}}}],style:{marginBottom:0},children:(0,i.jsx)(f.Z,{size:"large",min:0,max:Y===I.L.Percentage?100:void 0,precision:2,placeholder:Y===I.L.Fixed?"เช่น 50.00":"เช่น 10",style:{width:"100%"},controls:!1})})]}),(0,i.jsx)("div",{style:{padding:"16px",background:"#F8FAFC",borderRadius:14,marginTop:16,marginBottom:18},children:(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:12},children:[(0,i.jsxs)("div",{children:[(0,i.jsx)(A,{strong:!0,style:{fontSize:15,display:"block"},children:"สถานะการใช้งาน"}),(0,i.jsx)(A,{type:"secondary",style:{fontSize:13},children:"เปิดเพื่อให้เลือกใช้ส่วนลดได้ในหน้า POS"})]}),(0,i.jsx)(d.Z.Item,{name:"is_active",valuePropName:"checked",noStyle:!0,children:(0,i.jsx)(y.Z,{style:{background:K?"#10B981":void 0}})})]})}),(0,i.jsx)(a.Z,{showIcon:!0,type:"info",icon:(0,i.jsx)(C.Z,{}),message:"ข้อมูลที่จำเป็น",description:"ต้องกรอกชื่อระบบ ชื่อที่แสดง ประเภทส่วนลด และมูลค่าส่วนลด โดยชื่อระบบจะถูกตรวจสอบไม่ให้ซ้ำในสาขาเดียวกัน",style:{marginBottom:24}}),(0,i.jsxs)("div",{style:{marginTop:12,display:"flex",gap:12},children:[(0,i.jsx)(u.ZP,{size:"large",onClick:em,style:{flex:1,borderRadius:12,height:46,fontWeight:600},children:"ยกเลิก"}),(0,i.jsx)(u.ZP,{type:"primary",htmlType:"submit",loading:M,icon:(0,i.jsx)(E.Z,{}),style:{flex:2,borderRadius:12,height:46,fontWeight:600,background:"#D97706",boxShadow:"0 4px 12px rgba(217, 119, 6, 0.25)"},children:"บันทึกข้อมูล"})]})]})]})}),(0,i.jsx)(h.Z,{xs:24,lg:9,children:(0,i.jsxs)("div",{style:{display:"grid",gap:14},children:[(0,i.jsx)(O,{displayName:U,discountName:V,discountType:Y,discountAmount:J,isActive:K}),el?(0,i.jsxs)(x.Z,{style:{borderRadius:16},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:10},children:[(0,i.jsx)(B.Z,{style:{color:"#0369a1"}}),(0,i.jsx)(A,{strong:!0,children:"รายละเอียดรายการ"})]}),(0,i.jsxs)("div",{style:{display:"grid",gap:8},children:[(0,i.jsxs)(A,{type:"secondary",children:["ID: ",(null==en?void 0:en.id)||"-"]}),(0,i.jsxs)(A,{type:"secondary",children:["สร้างเมื่อ: ",D(null==en?void 0:en.create_date)]})]})]}):null]})})]})})})]}):(0,i.jsx)(P.H,{message:"คุณไม่มีสิทธิ์เข้าถึงหน้านี้",tone:"danger"})}},69711:function(e,t,n){"use strict";n.d(t,{R:function(){return r},W:function(){return o}});var i=n(69397);let r={...(0,i.yf)("linear-gradient(135deg, #F59E0B 0%, #D97706 100%)"),discountCard:i.YO,discountCardInner:i.lv},o=(0,i.IU)(".discount-page",".discount-card")},69397:function(e,t,n){"use strict";n.d(t,{IU:function(){return d},YO:function(){return s},lv:function(){return a},yf:function(){return o}});let i={colors:{primary:"#6366F1",primaryLight:"#EEF2FF",success:"#10B981",successLight:"#ECFDF5",warning:"#F59E0B",warningLight:"#FFFBEB",error:"#EF4444",errorLight:"#FEF2F2",info:"#3B82F6",infoLight:"#EFF6FF",bg:"#F8FAFC",card:"#FFFFFF",border:"#E2E8F0",borderLight:"#F1F5F9",text:"#1E293B",textSecondary:"#64748B",textMuted:"#94A3B8"},radius:{sm:8,md:12,lg:16,xl:20},shadow:{sm:"0 1px 2px rgba(0, 0, 0, 0.04)",md:"0 4px 12px rgba(0, 0, 0, 0.06)",lg:"0 8px 24px rgba(0, 0, 0, 0.08)"}},r={container:{paddingBottom:100,backgroundColor:i.colors.bg,minHeight:"100dvh",width:"100%",overflowX:"hidden"},header:{background:"linear-gradient(135deg, ".concat(i.colors.primary," 0%, #4F46E5 100%)"),padding:"16px 16px 48px 16px",position:"relative",overflow:"hidden",borderBottomLeftRadius:i.radius.xl,borderBottomRightRadius:i.radius.xl},headerDecoCircle1:{position:"absolute",top:-40,right:-40,width:120,height:120,borderRadius:"50%",background:"rgba(255,255,255,0.08)"},headerDecoCircle2:{position:"absolute",bottom:-20,left:-20,width:80,height:80,borderRadius:"50%",background:"rgba(255,255,255,0.06)"},headerContent:{position:"relative",zIndex:1,display:"flex",alignItems:"center",justifyContent:"space-between",gap:12},headerLeft:{display:"flex",alignItems:"center",gap:12,flex:1},headerIconBox:{width:44,height:44,borderRadius:i.radius.md,background:"rgba(255,255,255,0.15)",display:"flex",alignItems:"center",justifyContent:"center",backdropFilter:"blur(8px)",flexShrink:0},headerTitle:{color:"#fff",margin:0,fontSize:18,fontWeight:600},headerSubtitle:{color:"rgba(255,255,255,0.8)",fontSize:13,margin:0},headerActions:{display:"flex",gap:8,flexShrink:0},statsCard:{margin:"-32px 16px 0 16px",padding:16,background:i.colors.card,borderRadius:i.radius.lg,boxShadow:i.shadow.md,display:"flex",justifyContent:"space-around",position:"relative",zIndex:10},statItem:{textAlign:"center",flex:1},statNumber:{fontSize:22,fontWeight:700,display:"block",color:i.colors.text},statLabel:{fontSize:12,color:i.colors.textMuted,marginTop:2},listContainer:{padding:"16px 16px 0 16px"},sectionTitle:{display:"flex",alignItems:"center",gap:8,marginBottom:12,fontSize:15,fontWeight:600,color:i.colors.text}},o=e=>({...r,header:{...r.header,background:e}}),s=e=>({marginBottom:12,borderRadius:i.radius.lg,border:"1px solid ".concat(e?i.colors.border:i.colors.borderLight),boxShadow:e?i.shadow.sm:"none",overflow:"hidden",transition:"all 0.2s ease",background:i.colors.card,opacity:e?1:.6}),a={padding:16,display:"flex",alignItems:"center",gap:12};i.radius.md;let d=(e,t)=>"\n  /* Card animations */\n  ".concat(t," {\n    animation: fadeSlideIn 0.3s ease both;\n  }\n  \n  ").concat(t,":hover {\n    transform: translateY(-2px);\n    box-shadow: ").concat(i.shadow.md," !important;\n  }\n  \n  ").concat(t,":active {\n    transform: scale(0.99);\n  }\n  \n  /* Scrollbar */\n  ").concat(e," *::-webkit-scrollbar {\n    width: 5px;\n    height: 5px;\n  }\n  ").concat(e," *::-webkit-scrollbar-track {\n    background: transparent;\n  }\n  ").concat(e," *::-webkit-scrollbar-thumb {\n    background: #CBD5E1;\n    border-radius: 3px;\n  }\n  ").concat(e," *::-webkit-scrollbar-thumb:hover {\n    background: #94A3B8;\n  }\n")},69477:function(e,t,n){"use strict";var i,r;n.d(t,{L:function(){return i}}),(r=i||(i={})).Fixed="Fixed",r.Percentage="Percentage"}},function(e){e.O(0,[253,1522,3418,742,9486,4252,3916,8651,6931,4159,3831,2224,3248,8879,8589,4221,9878,4547,8770,615,9385,4390,2971,2117,1744],function(){return e(e.s=55516)}),_N_E=e.O()}]);