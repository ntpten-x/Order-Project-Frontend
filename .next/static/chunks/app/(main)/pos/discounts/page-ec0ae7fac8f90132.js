(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2519],{90153:function(e,t,i){Promise.resolve().then(i.bind(i,35037))},35037:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return J}});var s=i(57437),n=i(2265),l=i(60283),a=i(80009),o=i(66487),r=i(50742),c=i(53743),d=i(34029),u=i(24783),p=i(88589),h=i(24738),f=i(62670),x=i(44314),y=i(13377),g=i(26349),j=i(89245),m=i(96473),b=i(29436),v=i(69477),k=i(99376),S=i(3369),Z=i(26972),_=i(24675),w=i(97235),C=i(67918),P=i(67697),z=i(73814),E=i(12028),T=i(69711),R=i(2938),A=i(25193),L=i(37410),N=i(27623),W=i(20148),F=i(2786);let{Text:I}=l.default,D=e=>{let t=new Date(e);return Number.isNaN(t.getTime())?"-":new Intl.DateTimeFormat("th-TH",{dateStyle:"medium",timeStyle:"short"}).format(t)},H=e=>{let t=Number(e.discount_amount||0);return e.discount_type===v.L.Percentage?"".concat(t,"%"):"".concat(t.toLocaleString("th-TH")," บาท")},O=e=>{let{total:t,active:i,inactive:n,fixed:l,percentage:a}=e;return(0,s.jsxs)("div",{style:{background:"#fff",borderRadius:16,border:"1px solid #e2e8f0",display:"grid",gridTemplateColumns:"repeat(5, minmax(0, 1fr))",gap:8,padding:14},children:[(0,s.jsxs)("div",{style:{textAlign:"center"},children:[(0,s.jsx)("span",{style:{fontSize:24,fontWeight:700,color:"#0f172a",display:"block"},children:t}),(0,s.jsx)(I,{style:{fontSize:12,color:"#64748b"},children:"ทั้งหมด"})]}),(0,s.jsxs)("div",{style:{textAlign:"center"},children:[(0,s.jsx)("span",{style:{fontSize:24,fontWeight:700,color:"#d97706",display:"block"},children:i}),(0,s.jsx)(I,{style:{fontSize:12,color:"#64748b"},children:"ใช้งาน"})]}),(0,s.jsxs)("div",{style:{textAlign:"center"},children:[(0,s.jsx)("span",{style:{fontSize:24,fontWeight:700,color:"#b91c1c",display:"block"},children:n}),(0,s.jsx)(I,{style:{fontSize:12,color:"#64748b"},children:"ปิดใช้งาน"})]}),(0,s.jsxs)("div",{style:{textAlign:"center"},children:[(0,s.jsx)("span",{style:{fontSize:24,fontWeight:700,color:"#0369a1",display:"block"},children:l}),(0,s.jsx)(I,{style:{fontSize:12,color:"#64748b"},children:"ลดเป็นบาท"})]}),(0,s.jsxs)("div",{style:{textAlign:"center"},children:[(0,s.jsx)("span",{style:{fontSize:24,fontWeight:700,color:"#7e22ce",display:"block"},children:a}),(0,s.jsx)(I,{style:{fontSize:12,color:"#64748b"},children:"ลดเปอร์เซ็นต์"})]})]})},B=e=>{let{discount:t,onEdit:i,onDelete:n,onToggleActive:l,updatingStatusId:c}=e,d=t.discount_type===v.L.Fixed;return(0,s.jsx)("div",{className:"discount-card",style:{...T.R.discountCard(t.is_active),borderRadius:16},onClick:()=>i(t),children:(0,s.jsxs)("div",{style:T.R.discountCardInner,children:[(0,s.jsx)("div",{style:{width:52,height:52,borderRadius:14,background:d?"linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%)":"linear-gradient(135deg, #f3e8ff 0%, #e9d5ff 100%)",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,boxShadow:d?"0 4px 10px rgba(3, 105, 161, 0.18)":"0 4px 10px rgba(126, 34, 206, 0.18)"},children:d?(0,s.jsx)(f.Z,{style:{fontSize:22,color:"#0369a1"}}):(0,s.jsx)(x.Z,{style:{fontSize:22,color:"#7e22ce"}})}),(0,s.jsxs)("div",{style:{flex:1,minWidth:0,paddingRight:8},children:[(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4},children:[(0,s.jsx)(I,{strong:!0,style:{fontSize:16,color:"#0f172a"},ellipsis:{tooltip:t.display_name},children:t.display_name}),(0,s.jsx)(a.Z,{color:t.is_active?"green":"default",children:t.is_active?"ใช้งาน":"ปิดใช้งาน"})]}),(0,s.jsx)(I,{type:"secondary",style:{fontSize:13,display:"block",color:"#334155"},ellipsis:{tooltip:t.discount_name},children:t.discount_name}),(0,s.jsxs)(I,{type:"secondary",style:{fontSize:12,display:"block",marginTop:2},children:["มูลค่าส่วนลด ",H(t)]}),(0,s.jsxs)(I,{type:"secondary",style:{fontSize:12,display:"block",marginTop:2},children:["สร้างเมื่อ ",D(t.create_date)]})]}),(0,s.jsxs)("div",{style:{display:"flex",gap:6,alignItems:"center"},children:[(0,s.jsx)(o.Z,{size:"small",checked:t.is_active,loading:c===t.id,onClick:(e,i)=>{null==i||i.stopPropagation(),l(t,e)}}),(0,s.jsx)(r.ZP,{type:"text",icon:(0,s.jsx)(y.Z,{}),onClick:e=>{e.stopPropagation(),i(t)},style:{borderRadius:10,color:"#d97706",background:"#fff7ed",width:36,height:36}}),(0,s.jsx)(r.ZP,{type:"text",danger:!0,icon:(0,s.jsx)(g.Z,{}),onClick:e=>{e.stopPropagation(),n(t)},style:{borderRadius:10,background:"#fef2f2",width:36,height:36}})]})]})})};function J(){let e=(0,k.useRouter)(),[t,i]=(0,n.useState)([]),[l,a]=(0,n.useState)(""),[o,f]=(0,n.useState)("all"),[y,I]=(0,n.useState)("all"),[D,H]=(0,n.useState)(null),{execute:J}=(0,Z.J)(),{showLoading:M}=(0,S.x)(),{socket:X}=(0,_.s)(),{isAuthorized:U,isChecking:q}=(0,C.e)({allowedRoles:["Admin","Manager"]});(0,n.useEffect)(()=>{(0,w.P)()},[]),(0,n.useEffect)(()=>{let e=(0,z.t)("pos:discounts",3e5);e&&e.length>0&&i(e)},[]);let G=(0,n.useCallback)(async()=>{J(async()=>{let e=await fetch("/api/pos/discounts");if(!e.ok){let t=await e.json().catch(()=>({}));throw Error(t.error||t.message||"ไม่สามารถดึงข้อมูลส่วนลดได้")}let t=await e.json(),s=Array.isArray(t)?t:null==t?void 0:t.data;if(!Array.isArray(s))throw Error("รูปแบบข้อมูลไม่ถูกต้อง");i(s)},"กำลังโหลดข้อมูลส่วนลด...")},[J]);(0,n.useEffect)(()=>{U&&G()},[U,G]),(0,P.v)(X,{create:E.b.discounts.create,update:E.b.discounts.update,delete:E.b.discounts.delete},i),(0,n.useEffect)(()=>{t.length>0&&(0,z.v)("pos:discounts",t)},[t]);let K=(0,n.useMemo)(()=>{let e=t;"active"===o?e=e.filter(e=>e.is_active):"inactive"===o&&(e=e.filter(e=>!e.is_active)),"all"!==y&&(e=e.filter(e=>e.discount_type===y));let i=l.trim().toLowerCase();return i&&(e=e.filter(e=>e.display_name.toLowerCase().includes(i)||e.discount_name.toLowerCase().includes(i)||(e.description||"").toLowerCase().includes(i))),e},[t,l,o,y]),Q=()=>{M("กำลังเปิดหน้าจัดการส่วนลด..."),e.push("/pos/discounts/manager/add")},V=t=>{M("กำลังเปิดหน้าแก้ไขส่วนลด..."),e.push("/pos/discounts/manager/edit/".concat(t.id))},Y=e=>{c.Z.confirm({title:"ยืนยันการลบส่วนลด",content:'คุณต้องการลบส่วนลด "'.concat(e.display_name,'" หรือไม่?'),okText:"ลบ",okType:"danger",cancelText:"ยกเลิก",centered:!0,icon:(0,s.jsx)(g.Z,{style:{color:"#EF4444"}}),onOk:async()=>{await J(async()=>{let t=await (0,w.P)();if(!(await fetch("/api/pos/discounts/delete/".concat(e.id),{method:"DELETE",headers:{"X-CSRF-Token":t}})).ok)throw Error("ไม่สามารถลบส่วนลดได้");i(t=>t.filter(t=>t.id!==e.id)),d.ZP.success('ลบส่วนลด "'.concat(e.display_name,'" สำเร็จ'))},"กำลังลบส่วนลด...")}})},$=async(e,t)=>{H(e.id);try{let s=await (0,w.P)(),n=await fetch("/api/pos/discounts/update/".concat(e.id),{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-Token":s},body:JSON.stringify({is_active:t})});if(!n.ok){let e=await n.json().catch(()=>({}));throw Error(e.error||e.message||"ไม่สามารถเปลี่ยนสถานะส่วนลดได้")}let l=await n.json();i(t=>t.map(t=>t.id===e.id?l:t)),d.ZP.success(t?"เปิดใช้งานส่วนลดแล้ว":"ปิดใช้งานส่วนลดแล้ว")}catch(e){console.error(e),d.ZP.error(e instanceof Error?e.message:"ไม่สามารถเปลี่ยนสถานะส่วนลดได้")}finally{H(null)}};if(q)return(0,s.jsx)(R.H,{message:"กำลังตรวจสอบสิทธิ์การใช้งาน..."});if(!U)return(0,s.jsx)(R.H,{message:"คุณไม่มีสิทธิ์เข้าถึงหน้านี้ กำลังพากลับ...",tone:"danger"});let ee=t.filter(e=>e.is_active).length,et=t.filter(e=>!e.is_active).length,ei=t.filter(e=>e.discount_type===v.L.Fixed).length,es=t.filter(e=>e.discount_type===v.L.Percentage).length;return(0,s.jsxs)("div",{className:"discount-page",style:T.R.container,children:[(0,s.jsx)("style",{children:T.W}),(0,s.jsx)(W.Z,{title:"ส่วนลด",subtitle:"ทั้งหมด ".concat(t.length," รายการ"),icon:(0,s.jsx)(x.Z,{}),actions:(0,s.jsxs)(u.Z,{size:8,wrap:!0,children:[(0,s.jsx)(r.ZP,{icon:(0,s.jsx)(j.Z,{}),onClick:G}),(0,s.jsx)(r.ZP,{type:"primary",icon:(0,s.jsx)(m.Z,{}),onClick:Q,children:"เพิ่มส่วนลด"})]})}),(0,s.jsx)(A.Z,{children:(0,s.jsxs)(N.Z,{children:[(0,s.jsx)(O,{total:t.length,active:ee,inactive:et,fixed:ei,percentage:es}),(0,s.jsx)(L.Z,{title:"ค้นหาและตัวกรอง",children:(0,s.jsxs)("div",{style:{display:"grid",gap:10,gridTemplateColumns:"1fr",alignItems:"center"},children:[(0,s.jsx)(p.default,{prefix:(0,s.jsx)(b.Z,{style:{color:"#94A3B8"}}),allowClear:!0,placeholder:"ค้นหาจากชื่อแสดง ชื่อระบบ หรือคำอธิบาย...",value:l,onChange:e=>a(e.target.value)}),(0,s.jsx)(h.Z,{options:[{label:"ทั้งหมด (".concat(t.length,")"),value:"all"},{label:"ใช้งาน (".concat(ee,")"),value:"active"},{label:"ปิดใช้งาน (".concat(et,")"),value:"inactive"}],value:o,onChange:e=>f(e)}),(0,s.jsx)(h.Z,{options:[{label:"ทุกประเภท (".concat(t.length,")"),value:"all"},{label:"ลดเป็นบาท (".concat(ei,")"),value:v.L.Fixed},{label:"ลด % (".concat(es,")"),value:v.L.Percentage}],value:y,onChange:e=>I(e)})]})}),(0,s.jsx)(L.Z,{title:"รายการส่วนลด",extra:(0,s.jsx)("span",{style:{fontWeight:600},children:K.length}),children:K.length>0?K.map(e=>(0,s.jsx)(B,{discount:e,onEdit:V,onDelete:Y,onToggleActive:$,updatingStatusId:D},e.id)):(0,s.jsx)(F.Z,{title:l.trim()?"ไม่พบส่วนลดตามคำค้น":"ยังไม่มีส่วนลด",description:l.trim()?"ลองเปลี่ยนคำค้น หรือตัวกรองสถานะ/ประเภท":"เพิ่มส่วนลดแรกเพื่อเริ่มใช้งาน",action:l.trim()?null:(0,s.jsx)(r.ZP,{type:"primary",icon:(0,s.jsx)(m.Z,{}),onClick:Q,children:"เพิ่มส่วนลด"})})})]})})]})}}},function(e){e.O(0,[8024,4736,8592,1744],function(){return e(e.s=90153)}),_N_E=e.O()}]);