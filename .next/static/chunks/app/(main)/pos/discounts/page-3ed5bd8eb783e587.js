(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2519],{90153:function(e,i,t){Promise.resolve().then(t.bind(t,62024))},62024:function(e,i,t){"use strict";t.r(i),t.d(i,{default:function(){return J}});var s=t(57437),n=t(2265),l=t(19683),o=t(96931),d=t(80009),r=t(50742),a=t(53743),c=t(34029),x=t(24783),p=t(88589),u=t(2261),h=t(62670),g=t(44314),y=t(8900),f=t(8881),j=t(13377),m=t(26349),b=t(29436),F=t(89245),v=t(96473),k=t(69477),E=t(99376),C=t(3369),w=t(26972),S=t(24675),Z=t(97235),B=t(3286),_=t(67697),z=t(69397);let R={...(0,z.yf)("linear-gradient(135deg, #F59E0B 0%, #D97706 100%)"),discountCard:z.YO,discountCardInner:z.lv},I=(0,z.IU)(".discount-page",".discount-card");var P=t(2938),W=t(25193),D=t(20148),A=t(37410),L=t(27623),T=t(2786);let{Text:N,Title:O}=l.default,H=e=>{let{total:i,fixed:t,percent:n,active:l,inactive:o}=e;return(0,s.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 mb-6",children:[(0,s.jsxs)("div",{style:{background:"white",padding:"12px 14px",borderRadius:16,boxShadow:"0 2px 10px rgba(0,0,0,0.02)",border:"1px solid #F1F5F9",display:"flex",alignItems:"center",gap:10},children:[(0,s.jsx)("div",{style:{width:40,height:40,borderRadius:10,background:"#FFF7ED",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:(0,s.jsx)(u.Z,{style:{fontSize:20,color:"#F59E0B"}})}),(0,s.jsxs)("div",{style:{minWidth:0},children:[(0,s.jsx)(N,{style:{color:"#64748B",display:"block",fontSize:11},children:"ทั้งหมด"}),(0,s.jsx)(O,{level:4,style:{margin:0,color:"#1E293B",fontWeight:700,fontSize:18},children:i})]})]}),(0,s.jsxs)("div",{style:{background:"white",padding:"12px 14px",borderRadius:16,boxShadow:"0 2px 10px rgba(0,0,0,0.02)",border:"1px solid #F1F5F9",display:"flex",alignItems:"center",gap:10},children:[(0,s.jsx)("div",{style:{width:40,height:40,borderRadius:10,background:"#F0F9FF",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:(0,s.jsx)(h.Z,{style:{fontSize:20,color:"#0EA5E9"}})}),(0,s.jsxs)("div",{style:{minWidth:0},children:[(0,s.jsx)(N,{style:{color:"#64748B",display:"block",fontSize:11},children:"แบบบาท"}),(0,s.jsx)(O,{level:4,style:{margin:0,color:"#1E293B",fontWeight:700,fontSize:18},children:t})]})]}),(0,s.jsxs)("div",{style:{background:"white",padding:"12px 14px",borderRadius:16,boxShadow:"0 2px 10px rgba(0,0,0,0.02)",border:"1px solid #F1F5F9",display:"flex",alignItems:"center",gap:10},children:[(0,s.jsx)("div",{style:{width:40,height:40,borderRadius:10,background:"#F5F3FF",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:(0,s.jsx)(g.Z,{style:{fontSize:20,color:"#8B5CF6"}})}),(0,s.jsxs)("div",{style:{minWidth:0},children:[(0,s.jsx)(N,{style:{color:"#64748B",display:"block",fontSize:11},children:"แบบ %"}),(0,s.jsx)(O,{level:4,style:{margin:0,color:"#1E293B",fontWeight:700,fontSize:18},children:n})]})]}),(0,s.jsxs)("div",{style:{background:"white",padding:"12px 14px",borderRadius:16,boxShadow:"0 2px 10px rgba(0,0,0,0.02)",border:"1px solid #F1F5F9",display:"flex",alignItems:"center",gap:10},children:[(0,s.jsx)("div",{style:{width:40,height:40,borderRadius:10,background:"#ECFDF5",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:(0,s.jsx)(y.Z,{style:{fontSize:20,color:"#10B981"}})}),(0,s.jsxs)("div",{style:{minWidth:0},children:[(0,s.jsx)(N,{style:{color:"#64748B",display:"block",fontSize:11},children:"ใช้งาน"}),(0,s.jsxs)("div",{style:{display:"flex",alignItems:"baseline",gap:4},children:[(0,s.jsx)(O,{level:4,style:{margin:0,color:"#1E293B",fontWeight:700,fontSize:18},children:l}),o>0&&(0,s.jsxs)(N,{type:"secondary",style:{fontSize:11},children:["(ปิด ",o,")"]})]})]})]})]})},q=n.memo(e=>{let{discount:i,onEdit:t,onDelete:n}=e,l=i.discount_type===k.L.Fixed;return(0,s.jsxs)(o.Z,{hoverable:!0,onClick:()=>t(i),style:{borderRadius:20,border:"none",boxShadow:"0 2px 8px rgba(0,0,0,0.04)",transition:"all 0.2s",overflow:"hidden",background:"white",opacity:i.is_active?1:.7},styles:{body:{padding:16}},children:[(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:16},children:[(0,s.jsx)("div",{style:{width:56,height:56,borderRadius:16,background:l?"linear-gradient(135deg, #E0F2FE 0%, #BAE6FD 100%)":"linear-gradient(135deg, #F3E8FF 0%, #D8B4FE 100%)",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:l?"0 4px 12px rgba(14, 165, 233, 0.2)":"0 4px 12px rgba(139, 92, 246, 0.2)"},children:l?(0,s.jsx)(h.Z,{style:{fontSize:24,color:"#0369A1"}}):(0,s.jsx)(g.Z,{style:{fontSize:24,color:"#7E22CE"}})}),(0,s.jsxs)("div",{style:{padding:"4px 10px",borderRadius:20,background:i.is_active?"#ECFDF5":"#F1F5F9",color:i.is_active?"#059669":"#64748B",fontSize:12,fontWeight:600,display:"flex",alignItems:"center",gap:4},children:[i.is_active?(0,s.jsx)(y.Z,{}):(0,s.jsx)(f.Z,{}),i.is_active?"Active":"Inactive"]})]}),(0,s.jsxs)("div",{style:{marginBottom:16},children:[(0,s.jsx)(O,{level:5,style:{margin:0,marginBottom:4,color:"#1E293B"},ellipsis:!0,children:i.display_name}),(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:6},children:[(0,s.jsx)(N,{type:"secondary",style:{fontSize:13},children:"Code:"}),(0,s.jsx)(d.Z,{style:{margin:0,borderRadius:6,background:"#F8FAFC",border:"1px solid #E2E8F0",color:"#475569"},children:i.discount_name})]})]}),(0,s.jsxs)("div",{style:{background:"#F8FAFC",borderRadius:12,padding:"10px 12px",marginBottom:16,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,s.jsx)(N,{style:{fontSize:12,color:"#64748B"},children:"มูลค่าส่วนลด"}),(0,s.jsx)(N,{style:{fontSize:16,fontWeight:700,color:"#F59E0B"},children:l?"฿".concat(i.discount_amount.toLocaleString()):"".concat(i.discount_amount,"% OFF")})]}),(0,s.jsxs)("div",{style:{display:"flex",gap:8,marginTop:"auto"},children:[(0,s.jsx)(r.ZP,{type:"text",icon:(0,s.jsx)(j.Z,{}),block:!0,onClick:e=>{e.stopPropagation(),t(i)},style:{borderRadius:10,background:"#FFF7ED",color:"#F59E0B",fontWeight:600},children:"แก้ไข"}),(0,s.jsx)(r.ZP,{type:"text",icon:(0,s.jsx)(m.Z,{}),onClick:e=>{e.stopPropagation(),n(i)},style:{borderRadius:10,background:"#FEF2F2",color:"#EF4444"}})]})]})});function J(){return(0,s.jsx)(U,{})}function U(){let e=(0,E.useRouter)(),[i,t]=(0,n.useState)([]),[l,o]=(0,n.useState)([]),[d,u]=(0,n.useState)(""),{execute:h}=(0,w.J)(),{showLoading:y}=(0,C.x)(),{socket:f}=(0,S.s)(),{isAuthorized:j,isChecking:z}=(0,B.e)({requiredRole:"Admin"});(0,n.useEffect)(()=>{(0,Z.P)()},[]);let N=(0,n.useCallback)(async()=>{h(async()=>{let e=await fetch("/api/pos/discounts");if(!e.ok)throw Error("ไม่สามารถดึงข้อมูลส่วนลดได้");let i=await e.json();t(i),o(i)},"กำลังโหลดข้อมูลส่วนลด...")},[h]);(0,n.useEffect)(()=>{j&&N()},[j,N]),(0,n.useEffect)(()=>{if(d.trim()){let e=d.trim().toLowerCase();o(i.filter(i=>{var t,s,n;return(null===(t=i.display_name)||void 0===t?void 0:t.toLowerCase().includes(e))||(null===(s=i.discount_name)||void 0===s?void 0:s.toLowerCase().includes(e))||(null===(n=i.description)||void 0===n?void 0:n.toLowerCase().includes(e))}))}else o(i)},[d,i]),(0,_.v)(f,{create:"discounts:create",update:"discounts:update",delete:"discounts:delete"},t);let O=()=>{y("กำลังเปิดหน้าจัดการส่วนลด..."),e.push("/pos/discounts/manager/add")},J=i=>{y("กำลังเปิดหน้าแก้ไขส่วนลด..."),e.push("/pos/discounts/manager/edit/".concat(i.id))},U=e=>{a.Z.confirm({title:"ยืนยันการลบส่วนลด",content:'คุณต้องการลบส่วนลด "'.concat(e.display_name||e.discount_name,'" หรือไม่?'),okText:"ลบรายการ",okType:"danger",cancelText:"ยกเลิก",centered:!0,icon:(0,s.jsx)(m.Z,{style:{color:"#EF4444"}}),styles:{body:{borderRadius:16}},onOk:async()=>{await h(async()=>{let i=await (0,Z.P)();if(!(await fetch("/api/pos/discounts/delete/".concat(e.id),{method:"DELETE",headers:{"X-CSRF-Token":i}})).ok)throw Error("ไม่สามารถลบส่วนลดได้");c.ZP.success("ลบส่วนลดสำเร็จ")},"กำลังลบส่วนลด...")}})};if(z)return(0,s.jsx)(P.H,{message:"กำลังตรวจสอบสิทธิ์การใช้งาน..."});if(!j)return(0,s.jsx)(P.H,{message:"คุณไม่มีสิทธิ์เข้าถึงหน้านี้",tone:"danger"});let X=i.filter(e=>e.is_active),Y=i.filter(e=>!e.is_active),G=i.filter(e=>e.discount_type===k.L.Fixed),K=i.filter(e=>e.discount_type===k.L.Percentage);return(0,s.jsxs)("div",{className:"discount-page px-4 md:px-6",style:{...R.container,paddingTop:16,paddingBottom:24,background:"#F8FAFC",minHeight:"100vh"},children:[(0,s.jsx)("style",{children:I}),(0,s.jsx)(D.Z,{title:"ส่วนลด",subtitle:"".concat(i.length," รายการ"),icon:(0,s.jsx)(g.Z,{}),actions:(0,s.jsxs)(x.Z,{size:8,wrap:!0,children:[(0,s.jsx)(p.default,{prefix:(0,s.jsx)(b.Z,{style:{color:"#94A3B8"}}),allowClear:!0,placeholder:"ค้นหา...",value:d,onChange:e=>u(e.target.value),style:{minWidth:200}}),(0,s.jsx)(r.ZP,{icon:(0,s.jsx)(F.Z,{}),onClick:N}),(0,s.jsx)(r.ZP,{type:"primary",icon:(0,s.jsx)(v.Z,{}),onClick:O,children:"เพิ่มส่วนลด"})]})}),(0,s.jsx)(W.Z,{children:(0,s.jsxs)(L.Z,{children:[(0,s.jsx)(H,{total:i.length,fixed:G.length,percent:K.length,active:X.length,inactive:Y.length}),(0,s.jsx)(A.Z,{title:"รายการส่วนลด",children:(0,s.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(260px, 1fr))",gap:16},children:l.length>0?l.map(e=>(0,s.jsx)(q,{discount:e,onEdit:J,onDelete:U},e.id)):(0,s.jsx)("div",{style:{gridColumn:"1 / -1"},children:(0,s.jsx)(T.Z,{title:d.trim()?"ไม่พบส่วนลดที่ค้นหา":"ยังไม่มีรายการส่วนลด",description:d.trim()?"ลองเปลี่ยนคำค้นหาใหม่":"เพิ่มส่วนลดแรกเพื่อเริ่มใช้งาน",action:d.trim()?null:(0,s.jsx)(r.ZP,{type:"primary",icon:(0,s.jsx)(v.Z,{}),onClick:O,children:"เพิ่มส่วนลด"})})})})})]})})]})}q.displayName="DiscountCard"}},function(e){e.O(0,[8024,4736,8592,1744],function(){return e(e.s=90153)}),_N_E=e.O()}]);