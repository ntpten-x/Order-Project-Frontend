(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4665],{79279:function(n,t,e){Promise.resolve().then(e.bind(e,64861))},64861:function(n,t,e){"use strict";e.r(t),e.d(t,{default:function(){return L}});var r=e(57437),o=e(2265),a=e(52717),i=e(44967),s=e(15883),c=e(42668),l=e(14362),u=e(45008),d=e(55589),p=e(96931),m=e(88589),f=e(50742);function h(){let n=(0,u._)(["\n  min-height: 100vh;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n  padding: 1rem;\n  position: relative;\n  overflow: hidden;\n"]);return h=function(){return n},n}function g(){let n=(0,u._)(["\n  width: 100%;\n  max-width: 420px;\n  background: #ffffff !important;\n  border-radius: 16px !important;\n  border: none !important;\n  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3) !important;\n  padding: 3rem 2.5rem !important;\n  position: relative;\n  z-index: 10;\n\n  .ant-card-body {\n    padding: 0 !important;\n  }\n\n  @media (max-width: 576px) {\n    padding: 2rem 1.5rem !important;\n    max-width: 90%;\n  }\n"]);return g=function(){return n},n}function x(){let n=(0,u._)(["\n  font-size: 36px;\n  font-weight: 700;\n  color: #2d3748;\n  text-align: center;\n  margin-bottom: 2.5rem;\n  margin-top: 0;\n\n  @media (max-width: 576px) {\n    font-size: 28px;\n    margin-bottom: 2rem;\n  }\n"]);return x=function(){return n},n}function b(){let n=(0,u._)(["\n  width: 100%;\n"]);return b=function(){return n},n}function S(){let n=(0,u._)(["\n  height: 48px;\n  border: none !important;\n  border-bottom: 2px solid #e2e8f0 !important;\n  border-radius: 0 !important;\n  padding: 12px 0 !important;\n  font-size: 15px;\n  background: transparent !important;\n  box-shadow: none !important;\n  transition: border-color 0.3s ease;\n\n  &::placeholder {\n    color: #a0aec0;\n    font-size: 15px;\n  }\n\n  &:hover {\n    border-bottom-color: #667eea !important;\n  }\n\n  &:focus,\n  &.ant-input-focused {\n    border-bottom-color: #667eea !important;\n    box-shadow: none !important;\n  }\n\n  .ant-input-prefix {\n    margin-right: 12px;\n    color: #a0aec0;\n  }\n"]);return S=function(){return n},n}function w(){let n=(0,u._)(["\n  height: 48px;\n  border: none !important;\n  border-bottom: 2px solid #e2e8f0 !important;\n  border-radius: 0 !important;\n  padding: 12px 0 !important;\n  font-size: 15px;\n  background: transparent !important;\n  transition: border-color 0.3s ease;\n\n  input {\n    background: transparent !important;\n    border: none !important;\n    box-shadow: none !important;\n    padding: 0 !important;\n  }\n\n  &::placeholder {\n    color: #a0aec0;\n    font-size: 15px;\n  }\n\n  &:hover {\n    border-bottom-color: #667eea !important;\n  }\n\n  &:focus,\n  &.ant-input-affix-wrapper-focused {\n    border-bottom-color: #667eea !important;\n    box-shadow: none !important;\n  }\n\n  .ant-input-prefix {\n    margin-right: 12px;\n    color: #a0aec0;\n  }\n\n  .ant-input-suffix {\n    color: #a0aec0;\n  }\n"]);return w=function(){return n},n}function y(){let n=(0,u._)(["\n  margin-bottom: 1.75rem;\n\n  .ant-form-item {\n    margin-bottom: 0;\n  }\n\n  .ant-form-item-explain-error {\n    font-size: 13px;\n    margin-top: 6px;\n    color: #e53e3e;\n  }\n"]);return y=function(){return n},n}function v(){let n=(0,u._)(["\n  height: 50px !important;\n  border-radius: 8px !important;\n  font-size: 16px !important;\n  font-weight: 600 !important;\n  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;\n  border: none !important;\n  color: white !important;\n  margin-top: 1.5rem !important;\n  box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4) !important;\n  transition: all 0.3s ease !important;\n\n  &:hover:not(:disabled) {\n    transform: translateY(-2px);\n    box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5) !important;\n    opacity: 0.95;\n  }\n\n  &:active:not(:disabled) {\n    transform: translateY(0);\n  }\n\n  &:disabled {\n    opacity: 0.7;\n    background: linear-gradient(135deg, #a5b4fc 0%, #c4b5fd 100%) !important;\n  }\n\n  span {\n    color: white !important;\n  }\n"]);return v=function(){return n},n}function E(){let n=(0,u._)(["\n  margin-top: 1.5rem;\n  text-align: center;\n"]);return E=function(){return n},n}function _(){let n=(0,u._)(["\n  margin-bottom: 1rem;\n  text-align: center;\n\n  a {\n    color: #718096;\n    font-size: 14px;\n    text-decoration: none;\n    transition: color 0.3s ease;\n\n    &:hover {\n      color: #667eea;\n    }\n  }\n"]);return _=function(){return n},n}function T(){let n=(0,u._)(["\n  color: #718096;\n  font-size: 14px;\n  text-align: center;\n\n  a {\n    color: #667eea;\n    font-weight: 600;\n    text-decoration: none;\n    margin-left: 4px;\n    transition: color 0.3s ease;\n\n    &:hover {\n      color: #764ba2;\n    }\n  }\n"]);return T=function(){return n},n}let A=d.Z.div(h()),C=(0,d.Z)(p.Z)(g()),P=d.Z.h1(x()),k=d.Z.div(b()),O=(0,d.Z)(m.default)(S()),j=(0,d.Z)(m.default.Password)(w()),R=d.Z.div(y()),I=(0,d.Z)(f.ZP)(v());function L(){let{login:n}=(0,l.a)(),[t,e]=(0,o.useState)(!1),u=async t=>{e(!0);try{await n(t),a.ZP.success({message:"เข้าสู่ระบบสำเร็จ",description:"ยินดีต้อนรับเข้าสู่ระบบ",placement:"topRight"})}catch(n){a.ZP.error({message:"เข้าสู่ระบบไม่สำเร็จ",description:n.message||"ชื่อผู้ใช้หรือรหัสผ่านไม่ถูกต้อง",placement:"topRight"})}finally{e(!1)}};return(0,r.jsx)(A,{children:(0,r.jsxs)(C,{children:[(0,r.jsx)(P,{children:"Login"}),(0,r.jsx)(k,{children:(0,r.jsxs)(i.Z,{name:"login",onFinish:u,layout:"vertical",requiredMark:!1,children:[(0,r.jsx)(R,{children:(0,r.jsx)(i.Z.Item,{name:"username",rules:[{required:!0,message:"กรุณากรอกชื่อผู้ใช้ !"},{pattern:/^[a-zA-Z0-9\-_@.]*$/,message:"กรุณากรอกภาษาอังกฤษ ตัวเลข หรืออักขระพิเศษ (- _ @ .)"}],children:(0,r.jsx)(O,{prefix:(0,r.jsx)(s.Z,{}),placeholder:"Username",autoComplete:"username"})})}),(0,r.jsx)(R,{children:(0,r.jsx)(i.Z.Item,{name:"password",rules:[{required:!0,message:"กรุณากรอกรหัสผ่าน !"},{pattern:/^[a-zA-Z0-9!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]*$/,message:"กรุณากรอกภาษาอังกฤษ ตัวเลข หรืออักขระพิเศษเท่านั้น"}],children:(0,r.jsx)(j,{prefix:(0,r.jsx)(c.Z,{}),placeholder:"Password",autoComplete:"current-password"})})}),(0,r.jsx)(i.Z.Item,{style:{marginBottom:0},children:(0,r.jsx)(I,{type:"primary",htmlType:"submit",loading:t,block:!0,children:"Login"})})]})})]})})}d.Z.div(E()),d.Z.div(_()),d.Z.div(T())},71567:function(n,t,e){"use strict";e.d(t,{q:function(){return o},v:function(){return r}});let r="/api",o={AUTH:{LOGIN:"/auth/login",ME:"/auth/me",CSRF:"/csrf"},POS:{PRODUCTS:"/pos/products",ORDERS:"/pos/orders",TABLES:"/pos/tables",DISCOUNTS:"/pos/discounts",DELIVERY:"/pos/delivery",PAYMENT_METHODS:"/pos/paymentMethod",PAYMENTS:"/pos/payments",CATEGORY:"/pos/category",SHIFTS:{BASE:"/pos/shifts",CURRENT:"/pos/shifts/current",OPEN:"/pos/shifts/open",CLOSE:"/pos/shifts/close"},DASHBOARD:{SALES:"/pos/dashboard/sales",TOP_ITEMS:"/pos/dashboard/top-items"},CHANNELS:{STATS:"/pos/orders/stats"},SHOP_PROFILE:"/pos/shopProfile",SALES_ORDER_ITEMS:"/pos/salesOrderItem",SALES_ORDER_DETAILS:"/pos/salesOrderDetail",PRODUCTS_UNIT:"/pos/productsUnit",PAYMENT_DETAILS:"/pos/paymentDetails",BRANCH:"/branches"}}},14362:function(n,t,e){"use strict";e.d(t,{AuthProvider:function(){return d},a:function(){return p}});var r=e(57437),o=e(2265),a=e(99376),i=e(5447),s=e(84859),c=e(48651),l=e(3369);let u=(0,o.createContext)(void 0),d=n=>{let{children:t}=n,[e,d]=(0,o.useState)(null),[p,m]=(0,o.useState)(!0),f=(0,a.useRouter)(),h=(0,a.usePathname)(),g=async()=>{try{let n="";n=localStorage.getItem("token_ws")||"";let t=await i.O.getMe(n);d(t)}catch(n){d(null)}finally{m(!1)}};(0,o.useEffect)(()=>{g()},[]);let{showLoading:x,hideLoading:b}=(0,l.x)();(0,o.useEffect)(()=>{p||e||"/login"===h||f.push("/login")},[e,p,h,f]);let S=async n=>{try{x("กำลังเข้าสู่ระบบ...");let t=await i.O.getCsrfToken(),{token:e,...r}=await i.O.login(n,t);e&&localStorage.setItem("token_ws",e),d(r),f.push("/")}catch(n){throw n}finally{b()}},w=async()=>{try{x("กำลังออกจากระบบ...");let n="";n=localStorage.getItem("token_ws")||"",await i.O.logout(n),localStorage.removeItem("token_ws"),s.x.clearQueue(),d(null),f.push("/login")}catch(n){console.error("Logout error:",n)}finally{b()}};return p?(0,r.jsx)("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-white",children:(0,r.jsx)(c.Z,{size:"large"})}):e||"/login"===h?(0,r.jsx)(u.Provider,{value:{user:e,loading:p,login:S,logout:w,checkAuth:g},children:t}):null},p=()=>{let n=(0,o.useContext)(u);if(!n)throw Error("useAuth must be used within an AuthProvider");return n}},3369:function(n,t,e){"use strict";e.d(t,{GlobalLoadingProvider:function(){return c},O:function(){return u},x:function(){return l}});var r=e(57437),o=e(2265),a=e(48651);let i=(0,o.createContext)(void 0),s=(0,o.createContext)(void 0),c=n=>{let{children:t}=n,[e,c]=(0,o.useState)({}),[l,u]=(0,o.useState)(void 0),d=(0,o.useCallback)(function(n){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default";c(n=>({...n,[t]:(n[t]||0)+1})),n&&u(n)},[]),p=(0,o.useCallback)(function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";c(t=>{if(!t[n])return t;let e={...t};return e[n]-=1,e[n]<=0&&delete e[n],e})},[]),m=(0,o.useCallback)(()=>{c({}),u(void 0)},[]),f=Object.keys(e).length>0,h=(0,o.useMemo)(()=>({isLoading:f,loadingMessage:l}),[f,l]),g=(0,o.useMemo)(()=>({showLoading:d,hideLoading:p,resetLoading:m}),[d,p,m]);return(0,r.jsx)(s.Provider,{value:g,children:(0,r.jsxs)(i.Provider,{value:h,children:[t,f&&(0,r.jsx)("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center pointer-events-auto bg-black/10 backdrop-blur-[1px]",children:(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:10,background:"rgba(255, 255, 255, 0.9)",padding:"20px 40px",borderRadius:12,boxShadow:"0 4px 12px rgba(0,0,0,0.1)"},children:[(0,r.jsx)(a.Z,{size:"large"}),l&&(0,r.jsx)("div",{style:{fontSize:14,color:"#1f1f1f",fontWeight:500},children:l})]})})]})})};function l(){let n=(0,o.useContext)(i),t=(0,o.useContext)(s);if(!n||!t)throw Error("useGlobalLoading must be used within a GlobalLoadingProvider");return(0,o.useMemo)(()=>({...n,...t}),[n,t])}function u(){let n=(0,o.useContext)(s);if(!n)throw Error("useGlobalLoadingDispatch must be used within a GlobalLoadingProvider");return n}},2913:function(n,t,e){"use strict";function r(n,t){return({GET:"".concat(o.API_BASE_URL).concat(t),POST:"".concat(o.API_BASE_URL).concat(t),PUT:"".concat(o.API_BASE_URL).concat(t),DELETE:"".concat(o.API_BASE_URL).concat(t),PATCH:"".concat(o.API_BASE_URL).concat(t)})[n]}e.d(t,{b:function(){return r}});let o={get API_BASE_URL(){return"/api"}}},5447:function(n,t,e){"use strict";e.d(t,{O:function(){return a}});var r=e(71567),o=e(2913);let a={login:async(n,t,e)=>{try{let a=(0,o.b)("POST",r.q.AUTH.LOGIN),i={"Content-Type":"application/json"};t&&(i["X-CSRF-Token"]=t),e&&(i.Cookie=e);let s=await fetch(a,{method:"POST",headers:i,credentials:"include",body:JSON.stringify(n)});if(!s.ok){let n=await s.json().catch(()=>({}));throw Error(n.message||n.detail||"เข้าสู่ระบบไม่สำเร็จ")}let c=await s.json();return{...c.user,token:c.token}}catch(n){throw Error(n.message||"เข้าสู่ระบบไม่สำเร็จ")}},logout:async(n,t,e)=>{try{let r=(0,o.b)("POST","/auth/logout"),a={"Content-Type":"application/json"};n&&(a.Authorization="Bearer ".concat(n)),t&&(a["X-CSRF-Token"]=t),e&&(a.Cookie=e),await fetch(r,{method:"POST",headers:a,credentials:"include"})}catch(n){console.error("Logout failed",n)}},getMe:async n=>{try{let t=(0,o.b)("GET",r.q.AUTH.ME),e=await fetch(t,{method:"GET",headers:{Authorization:"Bearer ".concat(n),"Content-Type":"application/json"},credentials:"include",cache:"no-store"});if(!e.ok)throw Error("Unauthorized");return await e.json()}catch(n){throw n}},async getCsrfToken(){try{let n=await fetch("".concat(r.v).concat(r.q.AUTH.CSRF),{credentials:"include"});if(!n.ok)return"";return(await n.json()).csrfToken}catch(n){return console.error("Failed to fetch CSRF token",n),""}}}},84859:function(n,t,e){"use strict";e.d(t,{M:function(){return s},x:function(){return i}});let r="pos_offline_queue",o=()=>{let n=localStorage.getItem(r);return n?JSON.parse(n):[]},a=n=>{localStorage.setItem(r,JSON.stringify(n))},i={addToQueue:(n,t)=>{let e=o(),r={id:"offline-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),type:n,payload:t,timestamp:Date.now(),retryCount:0};return a([...e,r]),r},getQueue:()=>o(),removeFromQueue:n=>{a(o().filter(t=>t.id!==n))},incrementRetry:(n,t)=>{a(o().map(e=>e.id===n?{...e,retryCount:e.retryCount+1,lastError:t}:e))},clearQueue:()=>{localStorage.removeItem(r)},pruneExceeded:()=>{a(o().filter(n=>n.retryCount<=5))}},s={maxRetry:5,backoff:n=>Math.min(3e4,2e3*n)}}},function(n){n.O(0,[5015,7717,7698,742,3211,7993,8651,6207,7213,9021,5616,8589,8640,6931,4967,2239,5025,2971,2117,1744],function(){return n(n.s=79279)}),_N_E=n.O()}]);