(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3185],{23512:function(e,t,r){Promise.resolve().then(r.t.bind(r,7438,23)),Promise.resolve().then(r.t.bind(r,16588,23)),Promise.resolve().then(r.t.bind(r,2778,23)),Promise.resolve().then(r.bind(r,22032)),Promise.resolve().then(r.bind(r,92987)),Promise.resolve().then(r.bind(r,14362)),Promise.resolve().then(r.bind(r,3369)),Promise.resolve().then(r.bind(r,46252)),Promise.resolve().then(r.bind(r,23174)),Promise.resolve().then(r.bind(r,22335))},22032:function(e,t,r){"use strict";var n=r(57437);r(2265);var o=r(13817),s=r(82646),a=r(24783),i=r(91652),l=r(83410),c=r(35713),u=r(15883),d=r(55322),p=r(40428),f=r(52539),x=r(70464),g=r(14362),h=r(99376);let{Header:b}=o.default,{Text:y}=s.default;t.default=()=>{let{user:e,logout:t}=(0,g.a)(),r=(0,h.usePathname)();if(!e||"/login"===r)return null;let o=[{key:"profile",label:(0,n.jsx)("div",{style:{padding:"12px 8px",minWidth:"240px"},children:(0,n.jsxs)(a.Z,{align:"center",size:16,children:[(0,n.jsx)(i.Z,{size:56,icon:(0,n.jsx)(u.Z,{}),style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",boxShadow:"0 4px 12px rgba(102, 126, 234, 0.3)"}}),(0,n.jsxs)("div",{children:[(0,n.jsx)(y,{strong:!0,style:{fontSize:"16px",display:"block",marginBottom:"2px"},children:(null==e?void 0:e.name)||(null==e?void 0:e.username)||"Guest"}),(0,n.jsx)(y,{type:"secondary",style:{fontSize:"13px"},children:(null==e?void 0:e.name)?e.username:(null==e?void 0:e.display_name)||"ไม่ได้กำหนดสิทธิ์"})]})]})}),disabled:!0},{type:"divider"},{key:"settings",icon:(0,n.jsx)(d.Z,{}),label:"การตั้งค่า",style:{padding:"10px 16px"}},{type:"divider"},{key:"logout",icon:(0,n.jsx)(p.Z,{}),label:"ออกจากระบบ",danger:!0,style:{padding:"10px 16px"},onClick:t}];return(0,n.jsxs)(b,{style:{position:"fixed",top:0,width:"100%",zIndex:1e3,height:"64px",padding:"0 16px",display:"flex",alignItems:"center",justifyContent:"space-between",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.12)",borderBottom:"1px solid rgba(255, 255, 255, 0.1)"},children:[(0,n.jsxs)(a.Z,{size:12,align:"center",children:[(0,n.jsx)("div",{style:{width:"40px",height:"40px",background:"rgba(255, 255, 255, 0.25)",backdropFilter:"blur(10px)",borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"center",border:"2px solid rgba(255, 255, 255, 0.3)",boxShadow:"0 8px 16px rgba(0, 0, 0, 0.1)",transition:"all 0.3s ease",cursor:"pointer"},onMouseEnter:e=>{e.currentTarget.style.transform="translateY(-2px)",e.currentTarget.style.boxShadow="0 12px 24px rgba(0, 0, 0, 0.15)"},onMouseLeave:e=>{e.currentTarget.style.transform="translateY(0)",e.currentTarget.style.boxShadow="0 8px 16px rgba(0, 0, 0, 0.1)"},children:(0,n.jsx)(f.Z,{style:{fontSize:"20px",color:"#fff"}})}),(0,n.jsx)(y,{strong:!0,className:"app-title",style:{fontSize:"20px",color:"#fff",margin:0,fontWeight:700,letterSpacing:"0.5px",textShadow:"0 2px 4px rgba(0, 0, 0, 0.1)"},children:"Order App"})]}),e&&(0,n.jsx)(l.Z,{menu:{items:o},trigger:["click"],placement:"bottomRight",children:(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px",cursor:"pointer",padding:"6px 12px",borderRadius:"24px",background:"rgba(255, 255, 255, 0.18)",backdropFilter:"blur(10px)",border:"2px solid rgba(255, 255, 255, 0.25)",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.1)",maxWidth:"180px"},onMouseEnter:e=>{e.currentTarget.style.background="rgba(255, 255, 255, 0.28)",e.currentTarget.style.transform="translateY(-2px)",e.currentTarget.style.boxShadow="0 8px 20px rgba(0, 0, 0, 0.15)"},onMouseLeave:e=>{e.currentTarget.style.background="rgba(255, 255, 255, 0.18)",e.currentTarget.style.transform="translateY(0)",e.currentTarget.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.1)"},children:[(0,n.jsx)(c.Z,{dot:!0,status:"success",offset:[-5,38],styles:{indicator:{width:"12px",height:"12px",boxShadow:"0 0 0 2px rgba(255, 255, 255, 0.5)"}},children:(0,n.jsx)(i.Z,{size:36,icon:(0,n.jsx)(u.Z,{}),style:{background:"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)",border:"2px solid rgba(255, 255, 255, 0.9)",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.2)"}})}),(0,n.jsx)(x.Z,{style:{fontSize:"10px",color:"#fff",transition:"transform 0.3s ease"}})]})})]})}},92987:function(e,t,r){"use strict";var n=r(57437),o=r(99376),s=r(2265),a=r(3369);t.default=e=>{let{children:t}=e,r=(0,o.usePathname)(),{resetLoading:i}=(0,a.x)();(0,s.useEffect)(()=>{i()},[r,i]);let l="/login"===r;return(0,n.jsx)("main",{style:{paddingTop:l?"0":"64px"},children:t})}},71567:function(e,t,r){"use strict";r.d(t,{q:function(){return o},v:function(){return n}});let n="/api",o={AUTH:{LOGIN:"/auth/login",ME:"/auth/me",CSRF:"/csrf"},POS:{PRODUCTS:"/pos/products",ORDERS:"/pos/orders",TABLES:"/pos/tables",DISCOUNTS:"/pos/discounts",DELIVERY:"/pos/delivery",PAYMENT_METHODS:"/pos/paymentMethod",PAYMENTS:"/pos/payments",CATEGORY:"/pos/category",SHIFTS:{BASE:"/pos/shifts",CURRENT:"/pos/shifts/current",OPEN:"/pos/shifts/open",CLOSE:"/pos/shifts/close"},DASHBOARD:{SALES:"/pos/dashboard/sales",TOP_ITEMS:"/pos/dashboard/top-items"},CHANNELS:{STATS:"/pos/orders/stats"},SHOP_PROFILE:"/pos/shopProfile",SALES_ORDER_ITEMS:"/pos/salesOrderItem",SALES_ORDER_DETAILS:"/pos/salesOrderDetail",PRODUCTS_UNIT:"/pos/productsUnit",PAYMENT_DETAILS:"/pos/paymentDetails",BRANCH:"/branches"}}},14362:function(e,t,r){"use strict";r.d(t,{AuthProvider:function(){return d},a:function(){return p}});var n=r(57437),o=r(2265),s=r(99376),a=r(5447),i=r(84859),l=r(48651),c=r(3369);let u=(0,o.createContext)(void 0),d=e=>{let{children:t}=e,[r,d]=(0,o.useState)(null),[p,f]=(0,o.useState)(!0),x=(0,s.useRouter)(),g=(0,s.usePathname)(),h=async()=>{try{let e="";e=localStorage.getItem("token_ws")||"";let t=await a.O.getMe(e);d(t)}catch(e){d(null)}finally{f(!1)}};(0,o.useEffect)(()=>{h()},[]);let{showLoading:b,hideLoading:y}=(0,c.x)();(0,o.useEffect)(()=>{p||r||"/login"===g||x.push("/login")},[r,p,g,x]);let S=async e=>{try{b("กำลังเข้าสู่ระบบ...");let t=await a.O.getCsrfToken(),{token:r,...n}=await a.O.login(e,t);r&&localStorage.setItem("token_ws",r),d(n),x.push("/")}catch(e){throw e}finally{y()}},m=async()=>{try{b("กำลังออกจากระบบ...");let e="";e=localStorage.getItem("token_ws")||"",await a.O.logout(e),localStorage.removeItem("token_ws"),i.x.clearQueue(),d(null),x.push("/login")}catch(e){console.error("Logout error:",e)}finally{y()}};return p?(0,n.jsx)("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-white",children:(0,n.jsx)(l.Z,{size:"large"})}):r||"/login"===g?(0,n.jsx)(u.Provider,{value:{user:r,loading:p,login:S,logout:m,checkAuth:h},children:t}):null},p=()=>{let e=(0,o.useContext)(u);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}},46252:function(e,t,r){"use strict";r.d(t,{J:function(){return i},SocketProvider:function(){return l}});var n=r(57437),o=r(2265),s=r(68680),a=r(14362);let i=(0,o.createContext)({socket:null,isConnected:!1}),l=e=>{let{children:t}=e,[r,l]=(0,o.useState)(null),[c,u]=(0,o.useState)(!1),{user:d}=(0,a.a)();return(0,o.useEffect)(()=>{if(!d){r&&(r.disconnect(),l(null),u(!1));return}let e=localStorage.getItem("token_ws"),t=(0,s.io)("http://localhost:3000",{transports:["websocket"],withCredentials:!0,auth:e?{token:e}:void 0});return t.on("connect",()=>{console.log("Socket Connected:",t.id),u(!0)}),t.on("disconnect",()=>{console.log("Socket Disconnected"),u(!1)}),l(t),()=>{t.disconnect()}},[d]),(0,n.jsx)(i.Provider,{value:{socket:r,isConnected:c},children:t})}},3369:function(e,t,r){"use strict";r.d(t,{GlobalLoadingProvider:function(){return l},O:function(){return u},x:function(){return c}});var n=r(57437),o=r(2265),s=r(48651);let a=(0,o.createContext)(void 0),i=(0,o.createContext)(void 0),l=e=>{let{children:t}=e,[r,l]=(0,o.useState)({}),[c,u]=(0,o.useState)(void 0),d=(0,o.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default";l(e=>({...e,[t]:(e[t]||0)+1})),e&&u(e)},[]),p=(0,o.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";l(t=>{if(!t[e])return t;let r={...t};return r[e]-=1,r[e]<=0&&delete r[e],r})},[]),f=(0,o.useCallback)(()=>{l({}),u(void 0)},[]),x=Object.keys(r).length>0,g=(0,o.useMemo)(()=>({isLoading:x,loadingMessage:c}),[x,c]),h=(0,o.useMemo)(()=>({showLoading:d,hideLoading:p,resetLoading:f}),[d,p,f]);return(0,n.jsx)(i.Provider,{value:h,children:(0,n.jsxs)(a.Provider,{value:g,children:[t,x&&(0,n.jsx)("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center pointer-events-auto bg-black/10 backdrop-blur-[1px]",children:(0,n.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:10,background:"rgba(255, 255, 255, 0.9)",padding:"20px 40px",borderRadius:12,boxShadow:"0 4px 12px rgba(0,0,0,0.1)"},children:[(0,n.jsx)(s.Z,{size:"large"}),c&&(0,n.jsx)("div",{style:{fontSize:14,color:"#1f1f1f",fontWeight:500},children:c})]})})]})})};function c(){let e=(0,o.useContext)(a),t=(0,o.useContext)(i);if(!e||!t)throw Error("useGlobalLoading must be used within a GlobalLoadingProvider");return(0,o.useMemo)(()=>({...e,...t}),[e,t])}function u(){let e=(0,o.useContext)(i);if(!e)throw Error("useGlobalLoadingDispatch must be used within a GlobalLoadingProvider");return e}},23174:function(e,t,r){"use strict";r.d(t,{default:function(){return u}});var n=r(57437),o=r(2265),s=r(73201),a=r(99376),i=r(47213),l=r(64625),c={token:{fontSize:16,colorPrimary:"#4F46E5",borderRadius:12,controlHeight:44,fontFamily:"var(--font-inter), sans-serif",colorTextHeading:"#111827",colorText:"#374151"},components:{Button:{controlHeight:48,borderRadius:12,algorithm:!0,fontSize:16,fontWeight:600},Input:{controlHeight:48,borderRadius:12},Card:{borderRadiusLG:20,boxShadowTertiary:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)"},Typography:{lineHeightHeading1:1.2,lineHeightHeading2:1.3},Layout:{headerBg:"rgba(255, 255, 255, 0.8)",bodyBg:"#ffffff"}}},u=e=>{let{children:t}=e,r=o.useMemo(()=>(0,s.Df)(),[]),[u,d]=(0,o.useState)(!1);return(0,a.useServerInsertedHTML)(()=>{if(!u)return d(!0),(0,n.jsx)("style",{id:"antd",dangerouslySetInnerHTML:{__html:(0,s.EN)(r,!0)}})}),(0,n.jsx)(s.V9,{cache:r,children:(0,n.jsx)(i.ZP,{theme:c,children:(0,n.jsx)(l.Z,{children:t})})})}},2913:function(e,t,r){"use strict";function n(e,t){return({GET:"".concat(o.API_BASE_URL).concat(t),POST:"".concat(o.API_BASE_URL).concat(t),PUT:"".concat(o.API_BASE_URL).concat(t),DELETE:"".concat(o.API_BASE_URL).concat(t),PATCH:"".concat(o.API_BASE_URL).concat(t)})[e]}r.d(t,{b:function(){return n}});let o={get API_BASE_URL(){return"/api"}}},22335:function(e,t,r){"use strict";r.d(t,{default:function(){return d}});var n=r(57437),o=r(17026),s=r(76451),a=r(90946),i=r(29827),l=r(2265),c=r(3369);let u=()=>{let e=(0,o.y)(),t=(0,s.B)(),{showLoading:r,hideLoading:n}=(0,c.x)(),a=(0,l.useRef)(!1),i=e+t>0;return(0,l.useEffect)(()=>{if(i&&!a.current){a.current=!0,r("กำลังโหลดข้อมูล...","query");return}!i&&a.current&&(a.current=!1,n("query"))},[i,r,n]),null};function d(e){let{children:t}=e,[r]=(0,l.useState)(()=>new a.S({defaultOptions:{queries:{staleTime:6e4,retry:1,refetchOnWindowFocus:!1}}}));return(0,n.jsxs)(i.aH,{client:r,children:[(0,n.jsx)(u,{}),t]})}},5447:function(e,t,r){"use strict";r.d(t,{O:function(){return s}});var n=r(71567),o=r(2913);let s={login:async(e,t,r)=>{try{let s=(0,o.b)("POST",n.q.AUTH.LOGIN),a={"Content-Type":"application/json"};t&&(a["X-CSRF-Token"]=t),r&&(a.Cookie=r);let i=await fetch(s,{method:"POST",headers:a,credentials:"include",body:JSON.stringify(e)});if(!i.ok){let e=await i.json().catch(()=>({}));throw Error(e.message||e.detail||"เข้าสู่ระบบไม่สำเร็จ")}let l=await i.json();return{...l.user,token:l.token}}catch(e){throw Error(e.message||"เข้าสู่ระบบไม่สำเร็จ")}},logout:async(e,t,r)=>{try{let n=(0,o.b)("POST","/auth/logout"),s={"Content-Type":"application/json"};e&&(s.Authorization="Bearer ".concat(e)),t&&(s["X-CSRF-Token"]=t),r&&(s.Cookie=r),await fetch(n,{method:"POST",headers:s,credentials:"include"})}catch(e){console.error("Logout failed",e)}},getMe:async e=>{try{let t=(0,o.b)("GET",n.q.AUTH.ME),r=await fetch(t,{method:"GET",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"},credentials:"include",cache:"no-store"});if(!r.ok)throw Error("Unauthorized");return await r.json()}catch(e){throw e}},async getCsrfToken(){try{let e=await fetch("".concat(n.v).concat(n.q.AUTH.CSRF),{credentials:"include"});if(!e.ok)return"";return(await e.json()).csrfToken}catch(e){return console.error("Failed to fetch CSRF token",e),""}}}},84859:function(e,t,r){"use strict";r.d(t,{M:function(){return i},x:function(){return a}});let n="pos_offline_queue",o=()=>{let e=localStorage.getItem(n);return e?JSON.parse(e):[]},s=e=>{localStorage.setItem(n,JSON.stringify(e))},a={addToQueue:(e,t)=>{let r=o(),n={id:"offline-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),type:e,payload:t,timestamp:Date.now(),retryCount:0};return s([...r,n]),n},getQueue:()=>o(),removeFromQueue:e=>{s(o().filter(t=>t.id!==e))},incrementRetry:(e,t)=>{s(o().map(r=>r.id===e?{...r,retryCount:r.retryCount+1,lastError:t}:r))},clearQueue:()=>{localStorage.removeItem(n)},pruneExceeded:()=>{s(o().filter(e=>e.retryCount<=5))}},i={maxRetry:5,backoff:e=>Math.min(3e4,2e3*e)}},2778:function(){}},function(e){e.O(0,[2251,2461,5015,7717,7698,742,3211,7993,8651,2646,6207,7213,9021,2224,3248,1721,5496,8640,1652,9763,5713,2239,3410,4731,2971,2117,1744],function(){return e(e.s=23512)}),_N_E=e.O()}]);