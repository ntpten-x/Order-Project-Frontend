"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4390],{2938:function(e,t,n){n.d(t,{H:function(){return x}});var r=n(57437),a=n(29),i=n.n(a);n(2265);var o=n(39486),l=n(47213),s=n(48651),d=n(48636),c=n(61935);let{Text:u,Title:f}=o.default,x=e=>{let{message:t,tone:n="secondary"}=e;return(0,r.jsxs)("div",{className:"jsx-e041fd1637d3b0f2 access-guard-container",children:[(0,r.jsx)(l.ZP,{theme:{token:{colorPrimary:"#3b82f6"}},children:(0,r.jsxs)("div",{className:"jsx-e041fd1637d3b0f2 content-wrapper",children:["danger"===n?(0,r.jsx)("div",{className:"jsx-e041fd1637d3b0f2 icon-circle danger",children:(0,r.jsx)(d.Z,{style:{fontSize:32,color:"#ef4444"}})}):(0,r.jsx)("div",{className:"jsx-e041fd1637d3b0f2 spinner-wrapper",children:(0,r.jsx)(s.Z,{indicator:(0,r.jsx)(c.Z,{style:{fontSize:40},spin:!0})})}),(0,r.jsxs)("div",{className:"jsx-e041fd1637d3b0f2 text-content",children:[(0,r.jsx)(f,{level:4,style:{margin:0,color:"#1e293b"},children:"danger"===n?"Access Denied":"Loading"}),(0,r.jsx)(u,{type:n,style:{fontSize:16},children:t})]})]})}),(0,r.jsx)(i(),{id:"e041fd1637d3b0f2",children:".access-guard-container.jsx-e041fd1637d3b0f2{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;height:100vh;-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;background:#f8fafc}.content-wrapper.jsx-e041fd1637d3b0f2{background:white;padding:40px;-webkit-border-radius:24px;-moz-border-radius:24px;border-radius:24px;-webkit-box-shadow:0 20px 40px rgba(0,0,0,.05);-moz-box-shadow:0 20px 40px rgba(0,0,0,.05);box-shadow:0 20px 40px rgba(0,0,0,.05);display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-moz-box-orient:vertical;-moz-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;gap:24px;text-align:center;min-width:320px;-webkit-animation:fadeIn.5s ease-out;-moz-animation:fadeIn.5s ease-out;-o-animation:fadeIn.5s ease-out;animation:fadeIn.5s ease-out}.icon-circle.jsx-e041fd1637d3b0f2{width:80px;height:80px;-webkit-border-radius:50%;-moz-border-radius:50%;border-radius:50%;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center;background:#fff1f2}.spinner-wrapper.jsx-e041fd1637d3b0f2{padding:20px}.text-content.jsx-e041fd1637d3b0f2{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-moz-box-orient:vertical;-moz-box-direction:normal;-ms-flex-direction:column;flex-direction:column;gap:8px}@-webkit-keyframes fadeIn{from{opacity:0;-webkit-transform:translatey(10px);transform:translatey(10px)}to{opacity:1;-webkit-transform:translatey(0);transform:translatey(0)}}@-moz-keyframes fadeIn{from{opacity:0;-moz-transform:translatey(10px);transform:translatey(10px)}to{opacity:1;-moz-transform:translatey(0);transform:translatey(0)}}@-o-keyframes fadeIn{from{opacity:0;-o-transform:translatey(10px);transform:translatey(10px)}to{opacity:1;-o-transform:translatey(0);transform:translatey(0)}}@keyframes fadeIn{from{opacity:0;-webkit-transform:translatey(10px);-moz-transform:translatey(10px);-o-transform:translatey(10px);transform:translatey(10px)}to{opacity:1;-webkit-transform:translatey(0);-moz-transform:translatey(0);-o-transform:translatey(0);transform:translatey(0)}}"})]})}},25193:function(e,t,n){n.d(t,{Z:function(){return o}});var r=n(57437);n(2265);var a=n(38616),i=n(87530);function o(e){let{children:t,maxWidth:n=i.H.pageMaxWidth,style:o}=e,l=a.default.useBreakpoint().md?i.H.pagePaddingXDesktop:i.H.pagePaddingXMobile;return(0,r.jsx)("div",{style:{width:"100%",maxWidth:n,margin:"0 auto",padding:"".concat(i.H.pagePaddingY,"px ").concat(l,"px"),...o},children:t})}},20148:function(e,t,n){n.d(t,{Z:function(){return u}});var r=n(57437);n(2265);var a=n(17588),i=n(2651),o=n(38616),l=n(10868),s=n(50742),d=n(39486),c=n(87530);function u(e){let{title:t,subtitle:n,icon:u,onBack:f,actions:x,style:p}=e,{token:b}=i.default.useToken(),g=o.default.useBreakpoint().md?c.H.pagePaddingXDesktop:c.H.pagePaddingXMobile;return(0,r.jsx)("div",{style:{padding:"".concat(c.H.pagePaddingY,"px ").concat(g,"px"),background:b.colorBgContainer,borderBottom:"1px solid ".concat(b.colorBorderSecondary),...p},children:(0,r.jsxs)(l.Z,{align:"center",justify:"space-between",wrap:"wrap",gap:12,style:{maxWidth:c.H.pageMaxWidth,margin:"0 auto"},children:[(0,r.jsxs)(l.Z,{align:"center",gap:12,style:{minWidth:0},children:[f&&(0,r.jsx)(s.ZP,{type:"text","aria-label":"ย้อนกลับ",icon:(0,r.jsx)(a.Z,{}),onClick:f,style:{borderRadius:12,width:44,height:44}}),u&&(0,r.jsx)("div",{style:{width:44,height:44,borderRadius:14,display:"grid",placeItems:"center",background:b.colorFillTertiary,color:b.colorText},children:u}),(0,r.jsxs)("div",{style:{minWidth:0},children:[(0,r.jsx)(d.default.Title,{level:4,style:{margin:0},children:t}),n&&(0,r.jsx)(d.default.Text,{type:"secondary",children:n})]})]}),x&&(0,r.jsx)(l.Z,{gap:8,wrap:"wrap",children:x})]})})}},37410:function(e,t,n){n.d(t,{Z:function(){return d}});var r=n(57437);n(2265);var a=n(2651),i=n(96931),o=n(10868),l=n(39486),s=n(87530);function d(e){let{title:t,extra:n,children:d,style:c}=e,{token:u}=a.default.useToken();return(0,r.jsx)(i.Z,{size:"small",variant:"outlined",style:{borderRadius:s.H.cardRadiusLG,...c},styles:{header:t?{borderBottomColor:u.colorBorderSecondary}:{display:"none"}},title:t?(0,r.jsxs)(o.Z,{align:"center",justify:"space-between",gap:12,children:[(0,r.jsx)(l.default.Text,{strong:!0,children:t}),n]}):void 0,children:d})}},87530:function(e,t,n){n.d(t,{H:function(){return r}});let r={pageMaxWidth:1200,pagePaddingXMobile:16,pagePaddingXDesktop:24,pagePaddingY:16,sectionGap:16,cardRadius:16,cardRadiusLG:20,cardShadow:"0 10px 24px rgba(15, 23, 42, 0.08)",surfaceBg:"#ffffff",surfaceBorder:"#e2e8f0"}},14362:function(e,t,n){n.d(t,{AuthProvider:function(){return f},a:function(){return x}});var r=n(57437),a=n(2265),i=n(99376),o=n(5447),l=n(84859),s=n(48651),d=n(3369),c=n(36799);let u=(0,a.createContext)(void 0),f=e=>{let{children:t}=e,[n,f]=(0,a.useState)(null),[x,p]=(0,a.useState)(!0),b=(0,i.useRouter)(),g=(0,i.usePathname)(),m=async()=>{try{let e=await o.O.getMe();f(e)}catch(e){f(null)}finally{p(!1)}};(0,a.useEffect)(()=>{m()},[]);let{showLoading:y,hideLoading:h}=(0,d.x)();(0,a.useEffect)(()=>{x||n||"/login"===g||b.push("/login")},[n,x,g,b]);let k=async e=>{try{y((0,c.t)("auth.loadingLogin"));let t=await o.O.getCsrfToken(),{token:n,...r}=await o.O.login(e,t);f(r),b.push("/")}catch(e){throw e}finally{h()}},w=async()=>{try{y((0,c.t)("auth.loadingLogout")),await o.O.logout(),l.x.clearQueue(),f(null),b.push("/login")}catch(e){console.error("Logout error:",e)}finally{h()}};return x?(0,r.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center",background:"#ffffff"},children:(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"12px",padding:"24px",background:"#ffffff",borderRadius:"20px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.1)"},children:[(0,r.jsx)(s.Z,{size:"large"}),(0,r.jsx)("div",{style:{color:"#64748b",fontSize:"14px",fontWeight:500},children:"กำลังตรวจสอบสิทธิ์..."})]})}):n||"/login"===g?(0,r.jsx)(u.Provider,{value:{user:n,loading:x,login:k,logout:w,checkAuth:m},children:t}):null},x=()=>{let e=(0,a.useContext)(u);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}},3369:function(e,t,n){n.d(t,{GlobalLoadingProvider:function(){return s},O:function(){return c},x:function(){return d}});var r=n(57437),a=n(2265),i=n(48651);let o=(0,a.createContext)(void 0),l=(0,a.createContext)(void 0),s=e=>{let{children:t}=e,[n,s]=(0,a.useState)({}),[d,c]=(0,a.useState)(void 0),u=(0,a.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default";s(e=>({...e,[t]:(e[t]||0)+1})),e&&c(e)},[]),f=(0,a.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";s(t=>{if(!t[e])return t;let n={...t};return n[e]-=1,n[e]<=0&&delete n[e],n})},[]),x=(0,a.useCallback)(()=>{s({}),c(void 0)},[]),p=Object.keys(n).length>0,b=(0,a.useMemo)(()=>({isLoading:p,loadingMessage:d}),[p,d]),g=(0,a.useMemo)(()=>({showLoading:u,hideLoading:f,resetLoading:x}),[u,f,x]);return(0,r.jsx)(l.Provider,{value:g,children:(0,r.jsxs)(o.Provider,{value:b,children:[t,p&&(0,r.jsx)("div",{role:"status","aria-live":"polite",className:"global-loading-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:13e3,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(255, 255, 255, 0.7)",backdropFilter:"blur(6px)",WebkitBackdropFilter:"blur(6px)",transition:"opacity 0.25s ease"},children:(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:16,background:"rgba(255, 255, 255, 0.95)",padding:"28px 40px",borderRadius:20,boxShadow:"0 10px 32px rgba(15, 23, 42, 0.14)",border:"1px solid rgba(148, 163, 184, 0.35)",minWidth:240,textAlign:"center"},children:[(0,r.jsx)(i.Z,{size:"large"}),d&&(0,r.jsx)("div",{style:{fontSize:16,color:"#334155",fontWeight:600,letterSpacing:"0.01em"},children:d})]})})]})})};function d(){let e=(0,a.useContext)(o),t=(0,a.useContext)(l);if(!e||!t)throw Error("useGlobalLoading must be used within a GlobalLoadingProvider");return(0,a.useMemo)(()=>({...e,...t}),[e,t])}function c(){let e=(0,a.useContext)(l);if(!e)throw Error("useGlobalLoadingDispatch must be used within a GlobalLoadingProvider");return e}},84859:function(e,t,n){n.d(t,{M:function(){return s},x:function(){return l}});let r="pos_offline_queue",a=()=>{let e=localStorage.getItem(r);return e?JSON.parse(e):[]},i=e=>{let t=Date.now();return e.filter(e=>t-e.timestamp<=6048e5)},o=e=>{localStorage.setItem(r,JSON.stringify(e))},l={addToQueue:(e,t)=>{let n=i(a()),r={id:"offline-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),type:e,payload:t,timestamp:Date.now(),retryCount:0};return o([...n,r]),r},getQueue:()=>a(),removeFromQueue:e=>{o(a().filter(t=>t.id!==e))},incrementRetry:(e,t)=>{o(a().map(n=>n.id===e?{...n,retryCount:n.retryCount+1,lastError:t}:n))},clearQueue:()=>{localStorage.removeItem(r)},pruneExceeded:()=>{o(i(a()).filter(e=>e.retryCount<=5))}},s={maxRetry:5,backoff:e=>Math.min(3e4,2e3*e)}},67918:function(e,t,n){n.d(t,{e:function(){return l}});var r=n(2265),a=n(34029),i=n(99376),o=n(14362);function l(){let{allowedRoles:e,requiredRole:t="Admin",redirectUnauthenticated:n="/login",redirectUnauthorized:l="/pos",unauthorizedMessage:s="คุณไม่มีสิทธิ์เข้าถึงหน้านี้"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},d=(0,i.useRouter)(),{user:c,loading:u}=(0,o.a)(),f=(0,r.useMemo)(()=>e&&e.length>0?e:t?[t]:void 0,[e,t]),x=(0,r.useMemo)(()=>(function(e,t,n){if(t)return"checking";if(!e)return"unauthenticated";if(n&&n.length>0){var r;let t="Admin"===(r=e.role)||"Manager"===r||"Employee"===r?r:null;if(!t||!(n.includes(t)||"Admin"===t))return"unauthorized"}return"authorized"})(c,u,f),[c,u,f]),p=(0,r.useRef)(!1);return(0,r.useEffect)(()=>{if("unauthenticated"===x){d.replace(n);return}"unauthorized"===x&&(p.current||(p.current=!0,a.ZP.error(s)),d.replace(l))},[x,d,n,l,s]),{status:x,isAuthorized:"authorized"===x,isChecking:"checking"===x,user:c}}},97235:function(e,t,n){n.d(t,{P:function(){return l}});var r=n(5447);let a=null,i=0,o=null;async function l(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=Date.now();return!e&&a&&t-i<6e5?a:(o||(o=r.O.getCsrfToken().then(e=>(a=e||"",i=Date.now(),a)).finally(()=>{o=null})),o)}}}]);