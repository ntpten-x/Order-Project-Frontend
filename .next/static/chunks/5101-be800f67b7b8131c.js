"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5101],{77961:function(e,t,o){o.d(t,{Z:function(){return X}});var a=o(57437),n=o(2265),r=o(33145),i=o(82646),l=o(34029),s=o(50742),c=o(48651),d=o(80009),p=o(8056),u=o(85180),f=o(35713),m=o(92190),y=o(53743),g=o(35631),h=o(88589),x=o(33477),b=o(17588),j=o(62376),S=o(96473),_=o(40312),w=o(26349),v=o(13377),k=o(22623),C=o(99376),T=o(8949),E=o(3369),I=o(29827),Z=o(11713),P=o(45345),z=o(46252),R=o(47799),N=o(79657),O=o(29),A=o.n(O);let D={primary:"#1890ff",primaryBorder:"#91d5ff",success:"#52c41a",warningLight:"#fff7e6",warningBorder:"#ffd591",text:"#262626",textSecondary:"#8c8c8c",background:"#f0f2f5",white:"#ffffff"},F={container:{minHeight:"100vh",background:D.background,display:"flex",flexDirection:"column",paddingBottom:100},header:{background:"linear-gradient(135deg, #1890ff 0%, #096dd9 100%)",padding:"16px 20px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",position:"sticky",top:0,zIndex:100},headerContent:{maxWidth:1400,margin:"0 auto",display:"flex",alignItems:"center",justifyContent:"space-between",gap:16},headerLeft:{display:"flex",alignItems:"center",gap:12,flex:1,minWidth:0},headerInfo:{flex:1,minWidth:0},headerTitle:{color:"#fff",fontSize:20,fontWeight:700,margin:0,lineHeight:1.2},headerSubtitle:{color:"rgba(255,255,255,0.85)",fontSize:13,marginTop:2},headerActions:{display:"flex",alignItems:"center",gap:8},categoryBar:{background:"#fff",padding:"12px 20px",borderBottom:"1px solid #f0f0f0",position:"sticky",top:64,zIndex:99,overflowX:"auto",whiteSpace:"nowrap"},categoryScroll:{maxWidth:1400,margin:"0 auto",display:"flex",gap:8},content:{maxWidth:1400,margin:"0 auto",padding:"20px",flex:1,width:"100%"},productGrid:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(220px, 1fr))",gap:16},productCard:{background:D.white,borderRadius:12,overflow:"hidden",boxShadow:"0 2px 8px rgba(0,0,0,0.06)",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",cursor:"pointer",border:"1px solid #f0f0f0"},productImage:{width:"100%",height:180,position:"relative",overflow:"hidden",background:"#f5f5f5"},productInfo:{padding:14},productName:{fontSize:15,fontWeight:600,lineHeight:1.3,color:D.text,marginBottom:4,display:"block"},productCategory:{fontSize:11,color:D.textSecondary,marginBottom:8},productFooter:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:12},productPrice:{fontSize:18,fontWeight:700,color:D.primary},addButton:{background:D.success,color:"#fff",border:"none",borderRadius:8,padding:"8px 16px",fontSize:13,fontWeight:600,cursor:"pointer",transition:"all 0.3s ease",display:"flex",alignItems:"center",gap:4},paginationContainer:{display:"flex",justifyContent:"center",marginTop:24,padding:"20px 0"},floatingCartButton:{width:60,height:60,borderRadius:"50%",background:"linear-gradient(135deg, #1890ff 0%, #096dd9 100%)",boxShadow:"0 6px 20px rgba(24, 144, 255, 0.4)",display:"flex",alignItems:"center",justifyContent:"center",border:"2px solid #fff"},loadingContainer:{textAlign:"center",padding:60,background:"#fff",borderRadius:12},emptyContainer:{textAlign:"center",padding:60,background:"#fff",borderRadius:12}},B={cartHeader:{display:"flex",alignItems:"center",gap:8},cartItem:{padding:"14px 0",borderBottom:"1px solid #f0f0f0"},cartItemImage:{width:50,height:50,borderRadius:8,objectFit:"cover",background:"#f5f5f5"},cartItemInfo:{flex:1},cartItemName:{fontSize:14,fontWeight:600,color:D.text,marginBottom:2},cartItemPrice:{fontSize:12,color:D.textSecondary},cartItemNote:{marginTop:4,background:D.warningLight,padding:"2px 6px",borderRadius:4,border:"1px dashed ".concat(D.warningBorder),display:"inline-block",fontSize:11},quantityControl:{display:"flex",alignItems:"center",gap:8,background:"#f5f5f5",padding:"2px 8px",borderRadius:20},checkoutSummary:{background:"#fafafa",padding:20,borderRadius:12,marginBottom:24}},L=()=>(0,a.jsx)(A(),{id:"79b16174f4c6f989",dynamic:[D.primaryBorder],children:".pos-product-card:hover{-webkit-transform:translatey(-4px);-moz-transform:translatey(-4px);-ms-transform:translatey(-4px);-o-transform:translatey(-4px);transform:translatey(-4px);-webkit-box-shadow:0 8px 24px rgba(0,0,0,.12);-moz-box-shadow:0 8px 24px rgba(0,0,0,.12);box-shadow:0 8px 24px rgba(0,0,0,.12);border-color:".concat(D.primaryBorder,"}.pos-product-card:active{-webkit-transform:translatey(-2px);-moz-transform:translatey(-2px);-ms-transform:translatey(-2px);-o-transform:translatey(-2px);transform:translatey(-2px)}.pos-add-button:hover{background:#73d13d;-webkit-transform:scale(1.05);-moz-transform:scale(1.05);-ms-transform:scale(1.05);-o-transform:scale(1.05);transform:scale(1.05)}.pos-add-button:active{-webkit-transform:scale(.98);-moz-transform:scale(.98);-ms-transform:scale(.98);-o-transform:scale(.98);transform:scale(.98)}@-webkit-keyframes pos-fade-in{from{opacity:0;-webkit-transform:translatey(20px);transform:translatey(20px)}to{opacity:1;-webkit-transform:translatey(0);transform:translatey(0)}}@-moz-keyframes pos-fade-in{from{opacity:0;-moz-transform:translatey(20px);transform:translatey(20px)}to{opacity:1;-moz-transform:translatey(0);transform:translatey(0)}}@-o-keyframes pos-fade-in{from{opacity:0;-o-transform:translatey(20px);transform:translatey(20px)}to{opacity:1;-o-transform:translatey(0);transform:translatey(0)}}@keyframes pos-fade-in{from{opacity:0;-webkit-transform:translatey(20px);-moz-transform:translatey(20px);-o-transform:translatey(20px);transform:translatey(20px)}to{opacity:1;-webkit-transform:translatey(0);-moz-transform:translatey(0);-o-transform:translatey(0);transform:translatey(0)}}.pos-fade-in{-webkit-animation:pos-fade-in.4s ease-out forwards;-moz-animation:pos-fade-in.4s ease-out forwards;-o-animation:pos-fade-in.4s ease-out forwards;animation:pos-fade-in.4s ease-out forwards}.pos-delay-1{-webkit-animation-delay:.05s;-moz-animation-delay:.05s;-o-animation-delay:.05s;animation-delay:.05s;opacity:0}.pos-delay-2{-webkit-animation-delay:.1s;-moz-animation-delay:.1s;-o-animation-delay:.1s;animation-delay:.1s;opacity:0}.pos-delay-3{-webkit-animation-delay:.15s;-moz-animation-delay:.15s;-o-animation-delay:.15s;animation-delay:.15s;opacity:0}.pos-delay-4{-webkit-animation-delay:.2s;-moz-animation-delay:.2s;-o-animation-delay:.2s;animation-delay:.2s;opacity:0}.pos-category-bar::-webkit-scrollbar{height:4px}.pos-category-bar::-webkit-scrollbar-track{background:#f0f0f0}.pos-category-bar::-webkit-scrollbar-thumb{background:#d9d9d9;-webkit-border-radius:4px;-moz-border-radius:4px;border-radius:4px}@media(max-width:768px){.pos-header-mobile{padding:12px 16px!important}.pos-header-title-mobile{font-size:16px!important}.pos-header-subtitle-mobile{font-size:12px!important}.pos-category-bar-mobile{padding:10px 16px!important;top:56px!important}.pos-content-mobile{padding:16px!important}.pos-product-grid-mobile{grid-template-columns:repeat(2,1fr)!important;gap:12px!important}.pos-product-image-mobile{height:140px!important}.pos-product-info-mobile{padding:12px!important}.pos-product-name-mobile{font-size:14px!important}.pos-product-price-mobile{font-size:16px!important}.pos-add-button-mobile{padding:6px 12px!important;font-size:12px!important}}.pos-floating-btn-container{position:fixed!important;bottom:32px!important;right:32px!important;left:auto!important;z-index:1000!important;-webkit-transition:all.3s cubic-bezier(.175,.885,.32,1.275);-moz-transition:all.3s cubic-bezier(.175,.885,.32,1.275);-o-transition:all.3s cubic-bezier(.175,.885,.32,1.275);transition:all.3s cubic-bezier(.175,.885,.32,1.275)}@media(max-width:768px){.pos-floating-btn-container{bottom:100px!important;right:20px!important;left:auto!important}}@media(max-width:480px){.pos-product-grid-mobile{gap:10px!important}}@media(min-width:1400px){.pos-product-grid{grid-template-columns:repeat(auto-fill,minmax(240px,1fr))!important}}")});var U=o(67338);let{Title:W,Text:q}=i.default;function X(e){let{title:t,subtitle:o,icon:i,onConfirmOrder:x}=e,{isLoading:O}=(0,E.x)(),A=(0,C.useRouter)(),[X,G]=(0,n.useState)(1),[M,J]=(0,n.useState)(void 0),{data:H=[]}=(0,N.L)(),{products:Y,isLoading:K,total:V}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,o=arguments.length>2?arguments[2]:void 0,{socket:a}=(0,n.useContext)(z.J),r=(0,I.NL)(),{data:i,error:l,isLoading:s,refetch:c}=(0,Z.a)({queryKey:["products",e,t,o],queryFn:async()=>{let a=new URLSearchParams;return o&&a.append("category_id",o),await R.R.findAll(e,t,void 0,a)},placeholderData:P.Wk,staleTime:2e3});return(0,n.useEffect)(()=>{if(!a)return;let e=()=>{r.invalidateQueries({queryKey:["products"]})};return a.on("products:create",e),a.on("products:update",e),a.on("products:delete",e),a.on("stock:update",e),()=>{a.off("products:create",e),a.off("products:update",e),a.off("products:delete",e),a.off("stock:update",e)}},[a,r]),{products:(null==i?void 0:i.data)||[],total:(null==i?void 0:i.total)||0,currentPage:(null==i?void 0:i.page)||1,lastPage:(null==i?void 0:i.last_page)||1,isLoading:s,isError:l,mutate:c}}(X,20,M),[$,ee]=(0,n.useState)(!1),[et,eo]=(0,n.useState)(!1),[ea,en]=(0,n.useState)(!1),{cartItems:er,addToCart:ei,removeFromCart:el,updateQuantity:es,updateItemNote:ec,clearCart:ed,removeDetailFromItem:ep,updateItemDetails:eu,getTotalItems:ef,getSubtotal:em,getFinalPrice:ey}=(0,T.j)();n.useEffect(()=>{let e=window.location.pathname;return()=>{window.location.pathname!==e&&ed()}},[ed]);let[eg,eh]=(0,n.useState)(!1),[ex,eb]=(0,n.useState)(null),[ej,eS]=(0,n.useState)(""),[e_,ew]=(0,n.useState)(!1),[ev,ek]=(0,n.useState)(null),eC=(e,t,o)=>{ek({id:e,name:t,details:o||[]}),ew(!0)},eT=(e,t,o)=>{eb({id:e,name:t,note:o}),eS(o||""),eh(!0)},eE=e=>{ei(e),l.ZP.success("เพิ่ม ".concat(e.display_name," ลงตะกร้าแล้ว"))},eI=async()=>{try{en(!0),await x(),eo(!1),ee(!1)}catch(e){console.error(e)}finally{en(!1)}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(L,{}),(0,a.jsxs)("div",{style:F.container,children:[(0,a.jsx)("div",{style:F.header,className:"pos-header-mobile",children:(0,a.jsx)("div",{style:F.headerContent,children:(0,a.jsxs)("div",{style:F.headerLeft,children:[(0,a.jsx)(s.ZP,{type:"text",icon:(0,a.jsx)(b.Z,{style:{color:"#fff"}}),onClick:()=>A.back(),style:{color:"#fff",padding:"4px 8px",background:"rgba(255,255,255,0.15)",border:"1px solid rgba(255,255,255,0.3)",borderRadius:8}}),(0,a.jsx)("div",{style:{display:"flex",alignItems:"center"},children:i}),(0,a.jsxs)("div",{style:F.headerInfo,children:[(0,a.jsx)(W,{level:4,style:F.headerTitle,className:"pos-header-title-mobile",children:t}),(0,a.jsx)(q,{style:F.headerSubtitle,className:"pos-header-subtitle-mobile",children:o})]})]})})}),(0,a.jsx)("div",{style:F.categoryBar,className:"pos-category-bar pos-category-bar-mobile",children:(0,a.jsxs)("div",{style:F.categoryScroll,children:[(0,a.jsx)(s.ZP,{type:M?"default":"primary",onClick:()=>{J(void 0),G(1)},shape:"round",size:"large",children:"ทั้งหมด"}),H.map(e=>(0,a.jsx)(s.ZP,{type:M===e.id?"primary":"default",onClick:()=>{J(e.id),G(1)},shape:"round",size:"large",children:e.display_name},e.id))]})}),(0,a.jsx)("div",{style:F.content,className:"pos-content-mobile",children:K&&!O?(0,a.jsx)("div",{style:F.loadingContainer,children:(0,a.jsx)(c.Z,{size:"large"})}):Y.length>0?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{style:F.productGrid,className:"pos-product-grid pos-product-grid-mobile",children:Y.map((e,t)=>(0,a.jsxs)("div",{className:"pos-product-card pos-fade-in pos-delay-".concat(t%4+1),style:F.productCard,onClick:()=>eE(e),children:[(0,a.jsx)("div",{style:F.productImage,className:"pos-product-image-mobile",children:(0,U.dU)(e)?(0,a.jsx)(r.default,{alt:e.product_name,src:e.img_url,fill:!0,style:{objectFit:"cover"},sizes:"(max-width: 768px) 50vw, 220px"}):(0,a.jsx)("div",{style:{width:"100%",height:"100%",background:"linear-gradient(135deg, #e6f7ff 0%, #bae7ff 100%)",display:"flex",justifyContent:"center",alignItems:"center"},children:(0,a.jsx)(j.Z,{style:{fontSize:40,color:D.primary,opacity:.35}})})}),(0,a.jsxs)("div",{style:F.productInfo,className:"pos-product-info-mobile",children:[(0,a.jsx)(q,{ellipsis:!0,style:F.productName,className:"pos-product-name-mobile",children:e.display_name}),(0,a.jsx)(d.Z,{color:"blue",style:{fontSize:10,marginBottom:8},children:(0,U.r6)(e)}),(0,a.jsxs)("div",{style:F.productFooter,children:[(0,a.jsx)(q,{style:F.productPrice,className:"pos-product-price-mobile",children:(0,U.T4)(Number(e.price))}),(0,a.jsx)(s.ZP,{type:"primary",size:"small",icon:(0,a.jsx)(S.Z,{}),className:"pos-add-button pos-add-button-mobile",style:F.addButton,onClick:t=>{t.stopPropagation(),eE(e)},children:"เพิ่ม"})]})]})]},e.id))}),(0,a.jsx)("div",{style:F.paginationContainer,children:(0,a.jsx)(p.Z,{current:X,total:V,pageSize:20,onChange:e=>G(e),showSizeChanger:!1,showTotal:e=>"ทั้งหมด ".concat(e," รายการ")})})]}):(0,a.jsx)("div",{style:{background:"#fff",borderRadius:24,padding:"100px 24px",textAlign:"center",boxShadow:"0 4px 24px rgba(0,0,0,0.04)",marginTop:20},children:(0,a.jsx)(u.Z,{image:u.Z.PRESENTED_IMAGE_SIMPLE,imageStyle:{height:120},description:(0,a.jsxs)("div",{style:{marginTop:20},children:[(0,a.jsx)(W,{level:4,style:{marginBottom:8},children:"ยังไม่มีข้อมูลสินค้า"}),(0,a.jsx)(q,{type:"secondary",style:{fontSize:16},children:"กรุณาเพิ่มสินค้าก่อนใช้งาน"})]}),children:(0,a.jsx)(s.ZP,{type:"primary",size:"large",icon:(0,a.jsx)(j.Z,{}),style:{height:50,padding:"0 40px",borderRadius:25,fontSize:16,marginTop:20,background:D.primary,border:"none"},onClick:()=>A.push("/pos/products"),children:"ไปหน้าจัดการสินค้า"})})})}),(0,a.jsx)("div",{className:"pos-floating-btn-container",children:(0,a.jsx)(f.Z,{count:ef(),size:"default",offset:[-5,5],children:(0,a.jsx)(s.ZP,{type:"primary",shape:"circle",size:"large",icon:(0,a.jsx)(_.Z,{style:{fontSize:22}}),onClick:()=>ee(!0),style:F.floatingCartButton})})}),(0,a.jsxs)(m.Z,{title:(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},children:[(0,a.jsxs)("div",{style:B.cartHeader,children:[(0,a.jsx)(_.Z,{style:{fontSize:18,color:D.primary}}),(0,a.jsx)("span",{children:"ตะกร้าสินค้า"}),(0,a.jsx)(f.Z,{count:ef(),style:{marginLeft:8}})]}),(0,a.jsx)(s.ZP,{danger:!0,type:"text",onClick:()=>{er.length>0&&y.Z.confirm({title:"ล้างตะกร้า",content:"คุณต้องการล้างสินค้าทั้งหมดในตะกร้าใช่หรือไม่?",okText:"ใช่, ล้างตะกร้า",cancelText:"ยกเลิก",okType:"danger",onOk:()=>{ed(),l.ZP.success("ล้างตะกร้าเรียบร้อยแล้ว"),ee(!1)}})},icon:(0,a.jsx)(w.Z,{}),style:{fontSize:16},children:"ล้างตะกร้า"})]}),placement:"right",width:420,open:$,onClose:()=>ee(!1),footer:er.length>0&&(0,a.jsxs)("div",{style:{padding:"12px 0"},children:[(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[(0,a.jsx)(q,{type:"secondary",children:"รวมเป็นเงิน"}),(0,a.jsx)(q,{strong:!0,style:{fontSize:16},children:(0,U.T4)(em())})]}),(0,a.jsx)(s.ZP,{type:"primary",block:!0,size:"large",onClick:()=>{if(0===er.length){l.ZP.warning("กรุณาเพิ่มสินค้าลงตะกร้าก่อน");return}eo(!0)},style:{background:"linear-gradient(135deg, #1890ff 0%, #096dd9 100%)",border:"none",height:48,fontWeight:600,fontSize:16},children:"ดำเนินการสั่งออเดอร์"})]}),children:[er.length>0?(0,a.jsx)(g.Z,{dataSource:er,renderItem:e=>{var t;return(0,a.jsx)(g.Z.Item,{style:B.cartItem,children:(0,a.jsxs)("div",{style:{width:"100%"},children:[(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[(0,a.jsx)("div",{style:{marginRight:12,flexShrink:0},children:(0,U.dU)(e.product)?(0,a.jsx)(r.default,{src:e.product.img_url,alt:e.product.product_name,width:50,height:50,style:B.cartItemImage}):(0,a.jsx)("div",{style:{...B.cartItemImage,display:"flex",alignItems:"center",justifyContent:"center"},children:(0,a.jsx)(j.Z,{style:{fontSize:20,color:"#ccc"}})})}),(0,a.jsxs)("div",{style:B.cartItemInfo,children:[(0,a.jsx)(q,{strong:!0,style:B.cartItemName,children:e.product.display_name}),(0,a.jsx)("div",{style:{marginTop:2},children:(0,a.jsxs)(q,{type:"secondary",style:B.cartItemPrice,children:[(0,U.T4)(Number(e.product.price))," / ",(null===(t=e.product.unit)||void 0===t?void 0:t.display_name)||"ชิ้น"]})}),e.details&&e.details.length>0&&(0,a.jsx)("div",{style:{marginTop:4,padding:"4px 8px",background:"#f6ffed",borderRadius:4,border:"1px solid #b7eb8f"},children:e.details.map((t,o)=>(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,a.jsxs)(q,{style:{fontSize:11,color:"#52c41a"},children:["+ ",t.detail_name]}),(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:4},children:[(0,a.jsx)(q,{style:{fontSize:11,color:"#52c41a"},children:(0,U.T4)(Number(t.extra_price))}),(0,a.jsx)(s.ZP,{type:"text",size:"small",danger:!0,icon:(0,a.jsx)(w.Z,{style:{fontSize:10}}),onClick:()=>ep(e.cart_item_id,o),style:{height:16,width:16,padding:0}})]})]},"".concat(o)))}),e.notes&&(0,a.jsx)("div",{style:B.cartItemNote,children:(0,a.jsxs)(q,{type:"warning",style:{fontSize:11},children:[(0,a.jsx)(v.Z,{style:{marginRight:4}}),e.notes]})})]}),(0,a.jsxs)("div",{style:{display:"flex",gap:6},children:[(0,a.jsx)(s.ZP,{type:"text",size:"small",icon:(0,a.jsx)(v.Z,{style:{color:D.primary,fontSize:12}}),onClick:()=>eT(e.cart_item_id,e.product.display_name,e.notes||""),style:{background:"#f0f7ff",borderRadius:6,fontSize:11,fontWeight:500,padding:"0 8px",height:24},children:"โน้ต"}),(0,a.jsx)(s.ZP,{type:"text",size:"small",icon:(0,a.jsx)(S.Z,{style:{color:"#52c41a",fontSize:12}}),onClick:()=>eC(e.cart_item_id,e.product.display_name,e.details),style:{background:"#f6ffed",borderRadius:6,fontSize:11,fontWeight:500,padding:"0 8px",height:24},children:"ท็อปปิ้ง"}),(0,a.jsx)(s.ZP,{type:"text",danger:!0,size:"small",icon:(0,a.jsx)(w.Z,{style:{fontSize:12}}),onClick:()=>el(e.cart_item_id),style:{background:"#fff1f0",borderRadius:6,fontSize:11,fontWeight:500,padding:"0 8px",height:24},children:"ลบ"})]})]}),(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:10},children:[(0,a.jsxs)("div",{style:B.quantityControl,children:[(0,a.jsx)(k.Z,{onClick:()=>es(e.cart_item_id,e.quantity-1),style:{fontSize:12,cursor:"pointer",padding:4}}),(0,a.jsx)(q,{style:{fontWeight:600,minWidth:20,textAlign:"center"},children:e.quantity}),(0,a.jsx)(S.Z,{onClick:()=>es(e.cart_item_id,e.quantity+1),style:{fontSize:12,cursor:"pointer",padding:4}})]}),(0,a.jsx)(q,{strong:!0,style:{fontSize:15},children:(0,U.T4)((Number(e.product.price)+(e.details||[]).reduce((e,t)=>e+Number(t.extra_price),0))*e.quantity)})]})]})})}}):(0,a.jsxs)("div",{style:{textAlign:"center",padding:36,opacity:.5},children:[(0,a.jsx)(_.Z,{style:{fontSize:48,marginBottom:16}}),(0,a.jsx)(q,{children:"ยังไม่มีสินค้าในตะกร้า"})]}),$&&(0,a.jsx)(m.Z,{title:(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,a.jsx)(_.Z,{})," สรุปรายการออเดอร์"]}),width:400,open:et,onClose:()=>eo(!1),footer:(0,a.jsx)("div",{style:{padding:"12px 16px"},children:(0,a.jsx)(s.ZP,{type:"primary",block:!0,size:"large",loading:ea,onClick:eI,style:{background:"linear-gradient(135deg, #1890ff 0%, #096dd9 100%)",border:"none",height:52,fontWeight:700,fontSize:18,borderRadius:12,boxShadow:"0 4px 12px rgba(24, 144, 255, 0.35)"},children:"ยืนยันการสั่งออเดอร์"})}),children:(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:24},children:[(0,a.jsxs)("section",{children:[(0,a.jsx)(W,{level:5,style:{marginBottom:12},children:"รายการที่สั่ง"}),(0,a.jsx)(g.Z,{itemLayout:"horizontal",dataSource:er,renderItem:e=>(0,a.jsxs)("div",{style:{display:"flex",gap:12,padding:"12px 0",borderBottom:"1px dashed #f0f0f0"},children:[(0,a.jsx)("div",{style:{width:40,height:40,borderRadius:8,overflow:"hidden",flexShrink:0,border:"1px solid #f0f0f0"},children:e.product.img_url?(0,a.jsx)("img",{src:e.product.img_url,alt:e.product.display_name,style:{width:"100%",height:"100%",objectFit:"cover"}}):(0,a.jsx)("div",{style:{width:"100%",height:"100%",background:"#f5f5f5",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,a.jsx)(j.Z,{style:{fontSize:16,color:"#ccc"}})})}),(0,a.jsx)("div",{style:{flex:1,minWidth:0},children:(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[(0,a.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,a.jsx)(q,{strong:!0,style:{fontSize:13,display:"block"},children:e.product.display_name}),(0,a.jsxs)("div",{style:{display:"flex",gap:8,marginTop:4,marginBottom:8},children:[(0,a.jsx)(s.ZP,{type:"text",size:"small",icon:(0,a.jsx)(v.Z,{style:{color:D.primary,fontSize:12}}),onClick:()=>{eo(!1),eT(e.cart_item_id,e.product.display_name,e.notes||"")},style:{height:22,padding:"0 4px",fontSize:10,background:"#f0f7ff",borderRadius:4},children:"โน้ต"}),(0,a.jsx)(s.ZP,{type:"text",size:"small",icon:(0,a.jsx)(S.Z,{style:{color:"#52c41a",fontSize:12}}),onClick:()=>{eo(!1),eC(e.cart_item_id,e.product.display_name,e.details)},style:{height:22,padding:"0 4px",fontSize:10,background:"#f6ffed",borderRadius:4},children:"ท็อปปิ้ง"})]}),(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:2},children:[(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,a.jsx)(q,{type:"secondary",style:{fontSize:11},children:"ราคาอาหาร"}),(0,a.jsx)(q,{type:"secondary",style:{fontSize:11},children:(0,U.T4)(Number(e.product.price))})]}),e.details&&e.details.map((e,t)=>(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,a.jsxs)(q,{style:{fontSize:11,color:"#52c41a"},children:["+ ",e.detail_name]}),(0,a.jsx)(q,{style:{fontSize:11,color:"#52c41a"},children:(0,U.T4)(Number(e.extra_price))})]},t)),(0,a.jsx)("div",{style:{marginTop:2},children:(0,a.jsxs)(q,{type:"secondary",style:{fontSize:11,fontWeight:500},children:["จำนวน: x",e.quantity]})})]}),e.notes&&(0,a.jsx)("div",{style:{marginTop:6,padding:"4px 8px",background:"#fffbe6",borderRadius:4,borderLeft:"3px solid #faad14"},children:(0,a.jsxs)(q,{italic:!0,style:{fontSize:11,color:"#d46b08"},children:["โน๊ต: ",e.notes]})})]}),(0,a.jsx)(q,{strong:!0,style:{fontSize:14,marginLeft:12,color:D.primary},children:(0,U.T4)((Number(e.product.price)+(e.details||[]).reduce((e,t)=>e+Number(t.extra_price),0))*e.quantity)})]})})]},e.cart_item_id)})]}),(0,a.jsxs)("section",{style:{background:"#f8fafc",padding:12,borderRadius:12,border:"1px solid #e2e8f0"},children:[(0,a.jsx)(q,{strong:!0,style:{fontSize:13,marginBottom:8,display:"block",color:"#64748b"},children:"สรุป"}),(()=>{let e={};return er.forEach(t=>{var o;let a=(null===(o=t.product.category)||void 0===o?void 0:o.display_name)||"อื่นๆ";e[a]=(e[a]||0)+t.quantity}),Object.entries(e).map(e=>{let[t,o]=e;return(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:4},children:[(0,a.jsx)(q,{type:"secondary",style:{fontSize:12},children:t}),(0,a.jsxs)(q,{strong:!0,style:{fontSize:12},children:[o," รายการ"]})]},t)})})()]}),(0,a.jsxs)("section",{style:{background:"#fff",padding:"16px 4px",borderTop:"2px solid #f0f0f0"},children:[(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:12},children:[(0,a.jsx)(q,{type:"secondary",style:{fontSize:14},children:"รวมจำนวนทั้งหมด"}),(0,a.jsxs)(q,{strong:!0,style:{fontSize:14},children:[ef()," รายการ"]})]}),(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,a.jsx)(q,{style:{fontSize:18,fontWeight:700},children:"ยอดรวมสุทธิ"}),(0,a.jsx)(q,{style:{fontSize:28,fontWeight:800,color:"#1890ff"},children:(0,U.T4)(ey())})]})]})]})}),(0,a.jsx)(y.Z,{title:"ระบุรายละเอียดเพิ่มเติม: ".concat(null==ex?void 0:ex.name),open:eg,onOk:()=>{ex&&(ec(ex.id,ej),eh(!1),eb(null),l.ZP.success("บันทึกโน๊ตเรียบร้อยแล้ว"))},onCancel:()=>{eh(!1),eb(null)},okText:"บันทึก",cancelText:"ยกเลิก",centered:!0,children:(0,a.jsxs)("div",{style:{padding:"10px 0"},children:[(0,a.jsx)(q,{style:{display:"block",marginBottom:8},children:"รายละเอียด / หมายเหตุ"}),(0,a.jsx)(h.default.TextArea,{rows:4,value:ej,onChange:e=>eS(e.target.value),placeholder:"เช่น ไม่ใส่ผัก, หวานน้อย, แยกน้ำ...",maxLength:200,showCount:!0})]})}),(0,a.jsx)(Q,{item:ev,isOpen:e_,onClose:()=>{ew(!1),ek(null)},onSave:e=>{ev&&eu(ev.id,e)}})]})]})]})}function Q(e){let{item:t,isOpen:o,onClose:r,onSave:i}=e,[l,c]=(0,n.useState)([]);n.useEffect(()=>{t&&o&&c(t.details?[...t.details.map(e=>({...e}))]:[])},[t,o]);let d=e=>{c(l.filter((t,o)=>o!==e))},p=(e,t,o)=>{let a=[...l];a[e]={...a[e],[t]:o},c(a)};return(0,a.jsx)(y.Z,{title:"รายละเอียดเพิ่มเติม: ".concat(null==t?void 0:t.name),open:o,onCancel:r,footer:[(0,a.jsx)(s.ZP,{onClick:r,children:"ยกเลิก"},"cancel"),(0,a.jsx)(s.ZP,{type:"primary",onClick:()=>{i(l.filter(e=>""!==e.detail_name.trim())),r()},children:"บันทึก"},"save")],width:500,centered:!0,children:(0,a.jsxs)("div",{style:{padding:"10px 0"},children:[(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[(0,a.jsx)(q,{strong:!0,children:"รายการเพิ่มเติม"}),(0,a.jsx)(s.ZP,{type:"dashed",size:"small",icon:(0,a.jsx)(S.Z,{}),onClick:()=>{c([...l,{detail_name:"",extra_price:0}])},children:"เพิ่มรายการ"})]}),0===l.length?(0,a.jsx)("div",{style:{textAlign:"center",padding:"20px",background:"#f5f5f5",borderRadius:8,color:"#999"},children:"ไม่มีรายการเพิ่มเติม"}):(0,a.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:10},children:l.map((e,t)=>(0,a.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[(0,a.jsx)(h.default,{placeholder:"ชื่อรายการ",value:e.detail_name,onChange:e=>p(t,"detail_name",e.target.value),style:{flex:2}}),(0,a.jsx)(x.Z,{placeholder:"ราคา",value:e.extra_price,onChange:e=>p(t,"extra_price",e||0),style:{flex:1,height:40,fontSize:14},inputMode:"decimal",controls:!1,min:0,precision:2,formatter:e=>"".concat(e).replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:e=>e.replace(/\$\s?|(,*)/g,""),onKeyDown:t=>{/^[0-9]$/.test(t.key)||["Backspace","Delete","ArrowLeft","ArrowRight","Tab","Enter","."].includes(t.key)||t.preventDefault(),"."===t.key&&e.extra_price.toString().includes(".")&&t.preventDefault()}}),(0,a.jsx)(s.ZP,{danger:!0,type:"text",icon:(0,a.jsx)(w.Z,{}),onClick:()=>d(t)})]},t))})]})})}},71567:function(e,t,o){o.d(t,{q:function(){return n},v:function(){return a}});let a="/api",n={AUTH:{LOGIN:"/auth/login",ME:"/auth/me",CSRF:"/csrf"},POS:{PRODUCTS:"/pos/products",ORDERS:"/pos/orders",TABLES:"/pos/tables",DISCOUNTS:"/pos/discounts",DELIVERY:"/pos/delivery",PAYMENT_METHODS:"/pos/paymentMethod",PAYMENTS:"/pos/payments",CATEGORY:"/pos/category",SHIFTS:{BASE:"/pos/shifts",CURRENT:"/pos/shifts/current",OPEN:"/pos/shifts/open",CLOSE:"/pos/shifts/close"},DASHBOARD:{SALES:"/pos/dashboard/sales",TOP_ITEMS:"/pos/dashboard/top-items"},CHANNELS:{STATS:"/pos/orders/stats"},SHOP_PROFILE:"/pos/shopProfile",SALES_ORDER_ITEMS:"/pos/salesOrderItem",SALES_ORDER_DETAILS:"/pos/salesOrderDetail",PRODUCTS_UNIT:"/pos/productsUnit",PAYMENT_DETAILS:"/pos/paymentDetails",BRANCH:"/branches"}}},14362:function(e,t,o){o.d(t,{AuthProvider:function(){return p},a:function(){return u}});var a=o(57437),n=o(2265),r=o(99376),i=o(5447),l=o(84859),s=o(48651),c=o(3369);let d=(0,n.createContext)(void 0),p=e=>{let{children:t}=e,[o,p]=(0,n.useState)(null),[u,f]=(0,n.useState)(!0),m=(0,r.useRouter)(),y=(0,r.usePathname)(),g=async()=>{try{let e="";e=localStorage.getItem("token_ws")||"";let t=await i.O.getMe(e);p(t)}catch(e){p(null)}finally{f(!1)}};(0,n.useEffect)(()=>{g()},[]);let{showLoading:h,hideLoading:x}=(0,c.x)();(0,n.useEffect)(()=>{u||o||"/login"===y||m.push("/login")},[o,u,y,m]);let b=async e=>{try{h("กำลังเข้าสู่ระบบ...");let t=await i.O.getCsrfToken(),{token:o,...a}=await i.O.login(e,t);o&&localStorage.setItem("token_ws",o),p(a),m.push("/")}catch(e){throw e}finally{x()}},j=async()=>{try{h("กำลังออกจากระบบ...");let e="";e=localStorage.getItem("token_ws")||"",await i.O.logout(e),localStorage.removeItem("token_ws"),l.x.clearQueue(),p(null),m.push("/login")}catch(e){console.error("Logout error:",e)}finally{x()}};return u?(0,a.jsx)("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-white",children:(0,a.jsx)(s.Z,{size:"large"})}):o||"/login"===y?(0,a.jsx)(d.Provider,{value:{user:o,loading:u,login:b,logout:j,checkAuth:g},children:t}):null},u=()=>{let e=(0,n.useContext)(d);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}},46252:function(e,t,o){o.d(t,{J:function(){return l},SocketProvider:function(){return s}});var a=o(57437),n=o(2265),r=o(68680),i=o(14362);let l=(0,n.createContext)({socket:null,isConnected:!1}),s=e=>{let{children:t}=e,[o,s]=(0,n.useState)(null),[c,d]=(0,n.useState)(!1),{user:p}=(0,i.a)();return(0,n.useEffect)(()=>{if(!p){o&&(o.disconnect(),s(null),d(!1));return}let e=localStorage.getItem("token_ws"),t=(0,r.io)("http://localhost:3000",{transports:["websocket"],withCredentials:!0,auth:e?{token:e}:void 0});return t.on("connect",()=>{console.log("Socket Connected:",t.id),d(!0)}),t.on("disconnect",()=>{console.log("Socket Disconnected"),d(!1)}),s(t),()=>{t.disconnect()}},[p]),(0,a.jsx)(l.Provider,{value:{socket:o,isConnected:c},children:t})}},8949:function(e,t,o){o.d(t,{Z:function(){return i},j:function(){return l}});var a=o(57437),n=o(2265);let r=(0,n.createContext)(void 0),i=e=>{let{children:t}=e,[o,i]=(0,n.useState)([]),[l,s]=(0,n.useState)("DINE_IN"),[c,d]=(0,n.useState)(null),[p,u]=(0,n.useState)(null),[f,m]=(0,n.useState)(null),[y,g]=(0,n.useState)(null),[h,x]=(0,n.useState)(!1);n.useEffect(()=>{let e=localStorage.getItem("pos_cart_items"),t=localStorage.getItem("pos_order_mode"),o=localStorage.getItem("pos_ref_id"),a=localStorage.getItem("pos_ref_code"),n=localStorage.getItem("pos_discount"),r=localStorage.getItem("pos_payment");if(e)try{let t=JSON.parse(e).map((e,t)=>({...e,cart_item_id:e.cart_item_id||"item-".concat(Date.now(),"-").concat(t,"-").concat(Math.random().toString(36).substr(2,9))}));i(t)}catch(e){console.error("Failed to parse cart:",e),i([])}t&&s(t),o&&d(o),a&&u(a),n&&m(JSON.parse(n)),r&&g(JSON.parse(r)),x(!0)},[]),n.useEffect(()=>{h&&(localStorage.setItem("pos_cart_items",JSON.stringify(o)),localStorage.setItem("pos_order_mode",l),c?localStorage.setItem("pos_ref_id",c):localStorage.removeItem("pos_ref_id"),p?localStorage.setItem("pos_ref_code",p):localStorage.removeItem("pos_ref_code"),f?localStorage.setItem("pos_discount",JSON.stringify(f)):localStorage.removeItem("pos_discount"),y?localStorage.setItem("pos_payment",JSON.stringify(y)):localStorage.removeItem("pos_payment"))},[o,l,c,p,f,y,h]);let b=e=>{i(t=>t.filter(t=>t.cart_item_id!==e))},j=()=>o.reduce((e,t)=>e+(Number(t.product.price)+(t.details||[]).reduce((e,t)=>e+Number(t.extra_price),0))*t.quantity,0),S=()=>{let e=j();return f?"Percentage"===f.discount_type?e*f.discount_amount/100:Math.min(f.discount_amount,e):0};return(0,a.jsx)(r.Provider,{value:{cartItems:o,addToCart:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,o=arguments.length>2?arguments[2]:void 0;i(a=>{let n={cart_item_id:"item-".concat(Date.now(),"-").concat(a.length,"-").concat(Math.random().toString(36).substr(2,9)),product:e,quantity:t,notes:o,details:[]};return[...a,n]})},removeFromCart:b,updateQuantity:(e,t)=>{if(t<=0){b(e);return}i(o=>o.map(o=>o.cart_item_id===e?{...o,quantity:t}:o))},updateItemNote:(e,t)=>{i(o=>o.map(o=>o.cart_item_id===e?{...o,notes:t}:o))},clearCart:()=>{i([]),m(null),g(null),d(null),u(null)},addDetailToItem:(e,t)=>{i(o=>o.map(o=>o.cart_item_id===e?{...o,details:[...o.details||[],t]}:o))},removeDetailFromItem:(e,t)=>{i(o=>o.map(o=>o.cart_item_id===e?{...o,details:(o.details||[]).filter((e,o)=>o!==t)}:o))},updateItemDetails:(e,t)=>{i(o=>o.map(o=>o.cart_item_id===e?{...o,details:t}:o))},orderMode:l,setOrderMode:s,referenceId:c,setReferenceId:d,referenceCode:p,setReferenceCode:u,selectedDiscount:f,setSelectedDiscount:m,selectedPaymentMethod:y,setSelectedPaymentMethod:g,getTotalItems:()=>o.reduce((e,t)=>e+t.quantity,0),getSubtotal:j,getDiscountAmount:S,getFinalPrice:()=>Math.max(0,j()-S())},children:t})},l=()=>{let e=(0,n.useContext)(r);if(void 0===e)throw Error("useCart must be used within a CartProvider");return e}},3369:function(e,t,o){o.d(t,{GlobalLoadingProvider:function(){return s},O:function(){return d},x:function(){return c}});var a=o(57437),n=o(2265),r=o(48651);let i=(0,n.createContext)(void 0),l=(0,n.createContext)(void 0),s=e=>{let{children:t}=e,[o,s]=(0,n.useState)({}),[c,d]=(0,n.useState)(void 0),p=(0,n.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default";s(e=>({...e,[t]:(e[t]||0)+1})),e&&d(e)},[]),u=(0,n.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";s(t=>{if(!t[e])return t;let o={...t};return o[e]-=1,o[e]<=0&&delete o[e],o})},[]),f=(0,n.useCallback)(()=>{s({}),d(void 0)},[]),m=Object.keys(o).length>0,y=(0,n.useMemo)(()=>({isLoading:m,loadingMessage:c}),[m,c]),g=(0,n.useMemo)(()=>({showLoading:p,hideLoading:u,resetLoading:f}),[p,u,f]);return(0,a.jsx)(l.Provider,{value:g,children:(0,a.jsxs)(i.Provider,{value:y,children:[t,m&&(0,a.jsx)("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center pointer-events-auto bg-black/10 backdrop-blur-[1px]",children:(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:10,background:"rgba(255, 255, 255, 0.9)",padding:"20px 40px",borderRadius:12,boxShadow:"0 4px 12px rgba(0,0,0,0.1)"},children:[(0,a.jsx)(r.Z,{size:"large"}),c&&(0,a.jsx)("div",{style:{fontSize:14,color:"#1f1f1f",fontWeight:500},children:c})]})})]})})};function c(){let e=(0,n.useContext)(i),t=(0,n.useContext)(l);if(!e||!t)throw Error("useGlobalLoading must be used within a GlobalLoadingProvider");return(0,n.useMemo)(()=>({...e,...t}),[e,t])}function d(){let e=(0,n.useContext)(l);if(!e)throw Error("useGlobalLoadingDispatch must be used within a GlobalLoadingProvider");return e}},79657:function(e,t,o){o.d(t,{L:function(){return r}});var a=o(11713),n=o(2838);function r(){return(0,a.a)({queryKey:["categories"],queryFn:()=>n.G.findAll(),staleTime:3e5,refetchOnWindowFocus:!1,retry:1})}},2913:function(e,t,o){function a(e,t){return({GET:"".concat(n.API_BASE_URL).concat(t),POST:"".concat(n.API_BASE_URL).concat(t),PUT:"".concat(n.API_BASE_URL).concat(t),DELETE:"".concat(n.API_BASE_URL).concat(t),PATCH:"".concat(n.API_BASE_URL).concat(t)})[e]}o.d(t,{b:function(){return a}});let n={get API_BASE_URL(){return"/api"}}},5447:function(e,t,o){o.d(t,{O:function(){return r}});var a=o(71567),n=o(2913);let r={login:async(e,t,o)=>{try{let r=(0,n.b)("POST",a.q.AUTH.LOGIN),i={"Content-Type":"application/json"};t&&(i["X-CSRF-Token"]=t),o&&(i.Cookie=o);let l=await fetch(r,{method:"POST",headers:i,credentials:"include",body:JSON.stringify(e)});if(!l.ok){let e=await l.json().catch(()=>({}));throw Error(e.message||e.detail||"เข้าสู่ระบบไม่สำเร็จ")}let s=await l.json();return{...s.user,token:s.token}}catch(e){throw Error(e.message||"เข้าสู่ระบบไม่สำเร็จ")}},logout:async(e,t,o)=>{try{let a=(0,n.b)("POST","/auth/logout"),r={"Content-Type":"application/json"};e&&(r.Authorization="Bearer ".concat(e)),t&&(r["X-CSRF-Token"]=t),o&&(r.Cookie=o),await fetch(a,{method:"POST",headers:r,credentials:"include"})}catch(e){console.error("Logout failed",e)}},getMe:async e=>{try{let t=(0,n.b)("GET",a.q.AUTH.ME),o=await fetch(t,{method:"GET",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"},credentials:"include",cache:"no-store"});if(!o.ok)throw Error("Unauthorized");return await o.json()}catch(e){throw e}},async getCsrfToken(){try{let e=await fetch("".concat(a.v).concat(a.q.AUTH.CSRF),{credentials:"include"});if(!e.ok)return"";return(await e.json()).csrfToken}catch(e){return console.error("Failed to fetch CSRF token",e),""}}}},2838:function(e,t,o){o.d(t,{G:function(){return r}});var a=o(2913);let n="/pos/category",r={findAll:async(e,t)=>{let o=(0,a.b)("GET",n);t&&(o+="?".concat(t.toString()));let r={};e&&(r.Cookie=e);let i=await fetch(o,{cache:"no-store",credentials:"include",headers:r});if(!i.ok){let e=await i.json().catch(()=>({}));throw Error(e.error||e.message||"Failed to fetch categories")}return i.json()},findOne:async(e,t)=>{let o=(0,a.b)("GET","".concat(n,"/").concat(e)),r={};t&&(r.Cookie=t);let i=await fetch(o,{cache:"no-store",credentials:"include",headers:r});if(!i.ok){let e=await i.json().catch(()=>({}));throw Error(e.error||e.message||"Failed to fetch category")}return i.json()},findOneByName:async(e,t)=>{let o=(0,a.b)("GET","".concat(n,"/name/").concat(e)),r={};t&&(r.Cookie=t);let i=await fetch(o,{cache:"no-store",credentials:"include",headers:r});if(!i.ok){let e=await i.json().catch(()=>({}));throw Error(e.error||e.message||"Failed to fetch category by name")}return i.json()},create:async(e,t,o)=>{let r=(0,a.b)("POST",n),i={"Content-Type":"application/json"};t&&(i.Cookie=t),o&&(i["X-CSRF-Token"]=o);let l=await fetch(r,{method:"POST",headers:i,body:JSON.stringify(e),credentials:"include"});if(!l.ok){let e=await l.json().catch(()=>({}));throw Error(e.error||e.message||"Failed to create category")}return l.json()},update:async(e,t,o,r)=>{let i=(0,a.b)("PUT","".concat(n,"/").concat(e)),l={"Content-Type":"application/json"};o&&(l.Cookie=o),r&&(l["X-CSRF-Token"]=r);let s=await fetch(i,{method:"PUT",headers:l,body:JSON.stringify(t),credentials:"include"});if(!s.ok){let e=await s.json().catch(()=>({}));throw Error(e.error||e.message||"Failed to update category")}return s.json()},delete:async(e,t,o)=>{let r=(0,a.b)("DELETE","".concat(n,"/").concat(e)),i={};t&&(i.Cookie=t),o&&(i["X-CSRF-Token"]=o);let l=await fetch(r,{method:"DELETE",headers:i,credentials:"include"});if(!l.ok){let e=await l.json().catch(()=>({}));throw Error(e.error||e.message||"Failed to delete category")}}}},84859:function(e,t,o){o.d(t,{M:function(){return l},x:function(){return i}});let a="pos_offline_queue",n=()=>{let e=localStorage.getItem(a);return e?JSON.parse(e):[]},r=e=>{localStorage.setItem(a,JSON.stringify(e))},i={addToQueue:(e,t)=>{let o=n(),a={id:"offline-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),type:e,payload:t,timestamp:Date.now(),retryCount:0};return r([...o,a]),a},getQueue:()=>n(),removeFromQueue:e=>{r(n().filter(t=>t.id!==e))},incrementRetry:(e,t)=>{r(n().map(o=>o.id===e?{...o,retryCount:o.retryCount+1,lastError:t}:o))},clearQueue:()=>{localStorage.removeItem(a)},pruneExceeded:()=>{r(n().filter(e=>e.retryCount<=5))}},l={maxRetry:5,backoff:e=>Math.min(3e4,2e3*e)}},53286:function(e,t,o){o.d(t,{x:function(){return b}});var a=o(20019),n=o(2913),r=o(71567),i=o(32446);let l=a.Ryn({id:a.Z_8(),username:a.Z_8()}).partial().nullable(),s=a.Ryn({id:a.Z_8(),display_name:a.Z_8()}).partial().nullable(),c=a.Ryn({id:a.Z_8(),display_name:a.Z_8(),img_url:a.Z_8().nullable(),price:a.oQ2.number(),category:s.optional()}).partial().nullable(),d=a.Ryn({id:a.Z_8().optional(),detail_name:a.Z_8(),extra_price:a.oQ2.number()}).partial(),p=a.Ryn({id:a.Z_8(),order_id:a.Z_8(),product_id:a.Z_8(),product_name:a.Z_8().optional(),quantity:a.oQ2.number(),price:a.oQ2.number(),total_price:a.oQ2.number(),discount_amount:a.oQ2.number().optional().default(0),notes:a.Z_8().nullable().optional(),status:a.jbo(i.i).optional(),product:c.optional(),details:a.IXX(d).optional()}),u=a.Ryn({id:a.Z_8(),order_no:a.Z_8(),order_type:a.jbo(i.m),table_id:a.Z_8().nullable().optional(),delivery_id:a.Z_8().nullable().optional(),delivery_code:a.Z_8().nullable().optional(),sub_total:a.oQ2.number(),discount_id:a.Z_8().nullable().optional(),discount_amount:a.oQ2.number(),vat:a.oQ2.number(),total_amount:a.oQ2.number(),received_amount:a.oQ2.number(),change_amount:a.oQ2.number(),status:a.jbo(i.i),created_by_id:a.Z_8().nullable().optional(),create_date:a.Z_8(),update_date:a.Z_8(),items:a.IXX(p).optional(),created_by:l.optional(),table:a.YjB().optional(),delivery:a.YjB().optional(),discount:a.YjB().optional(),payments:a.IXX(a.YjB()).optional()}),f=a.Ryn({data:a.IXX(u),total:a.oQ2.number(),page:a.oQ2.number(),last_page:a.oQ2.number().optional()}),m=a.Ryn({table_name:a.Z_8().nullable().optional(),delivery_name:a.Z_8().nullable().optional()}).partial().nullable(),y=a.Ryn({id:a.Z_8(),order_no:a.Z_8(),order_type:a.jbo(i.m),status:a.jbo(i.i),create_date:a.Z_8(),total_amount:a.oQ2.number(),delivery_code:a.Z_8().nullable().optional(),table_id:a.Z_8().nullable().optional(),delivery_id:a.Z_8().nullable().optional(),table:m.optional(),delivery:m.optional(),items_summary:a.IMB(a.Z_8(),a.oQ2.number()).optional(),items_count:a.oQ2.number().optional()}),g=a.Ryn({data:a.IXX(y),total:a.oQ2.number(),page:a.oQ2.number(),last_page:a.oQ2.number().optional()}),h=r.q.POS.ORDERS,x=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"application/json",o={};return t&&(o["Content-Type"]=t),e&&(o.Cookie=e),o},b={getAll:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50,r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0,l=arguments.length>5?arguments[5]:void 0,s=new URLSearchParams({page:t.toString(),limit:o.toString(),...r&&{status:r},...i&&{type:i},...l&&{q:l}}),c="".concat(h,"?").concat(s.toString()),d=(0,n.b)("GET",c),p=x(e,""),u=await fetch(d,{cache:"no-store",headers:p,credentials:"include"});if(!u.ok){let e=await u.json().catch(()=>({}));throw Error(e.error||e.message||"ไม่สามารถดึงข้อมูลออเดอร์ได้")}let m=await u.json();try{return f.parse(m)}catch(e){throw console.error("Zod Validation Error in ordersService.getAll:",e),e instanceof a.jmq&&console.error("Zod Issues:",e.issues),e}},getAllSummary:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50,r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0,l=arguments.length>5?arguments[5]:void 0,s=new URLSearchParams({page:t.toString(),limit:o.toString(),...r&&{status:r},...i&&{type:i},...l&&{q:l}}),c="".concat(h,"/summary?").concat(s.toString()),d=(0,n.b)("GET",c),p=x(e,""),u=await fetch(d,{cache:"no-store",headers:p,credentials:"include"});if(!u.ok){let e=await u.json().catch(()=>({}));throw Error(e.error||e.message||"ไม่สามารถดึงข้อมูลออเดอร์ได้")}let f=await u.json();try{return g.parse(f)}catch(e){throw console.error("Zod Validation Error in ordersService.getAllSummary:",e),e instanceof a.jmq&&console.error("Zod Issues:",e.issues),e}},getStats:async e=>{let t=(0,n.b)("GET",r.q.POS.CHANNELS.STATS),o=x(e,""),a=await fetch(t,{cache:"no-store",headers:o,credentials:"include"});if(!a.ok){let e=await a.text();console.error("Order Stats Backend Error:",e);let t=await JSON.parse(e).catch(()=>({}));throw Error(t.error||t.message||"ไม่สามารถดึงข้อมูลสถิติได้")}return await a.json()},getById:async(e,t)=>{let o=(0,n.b)("GET","".concat(h,"/").concat(e)),r=x(t,""),i=await fetch(o,{cache:"no-store",headers:r,credentials:"include"});if(!i.ok){let e=await i.json().catch(()=>({}));throw Error(e.error||e.message||"ไม่สามารถดึงข้อมูลออเดอร์ได้")}let l=await i.json();try{return u.parse(l)}catch(e){throw console.error("Zod Validation Error in ordersService.getById:",e),e instanceof a.jmq&&console.error("Zod Issues:",e.issues),e}},create:async(e,t,o)=>{let a=(0,n.b)("POST","".concat(h)),r=x(t);o&&(r["X-CSRF-Token"]=o);let i=await fetch(a,{method:"POST",headers:r,credentials:"include",body:JSON.stringify(e)});if(!i.ok){let e=await i.json().catch(()=>({}));throw Error(e.error||e.message||"ไม่สามารถสร้างออเดอร์ได้")}return i.json()},update:async(e,t,o,a)=>{let r=(0,n.b)("PUT","".concat(h,"/").concat(e)),i=x(o);a&&(i["X-CSRF-Token"]=a);let l=await fetch(r,{method:"PUT",headers:i,credentials:"include",body:JSON.stringify(t)});if(!l.ok){let e=await l.json().catch(()=>({}));throw Error(e.error||e.message||"ไม่สามารถแก้ไขออเดอร์ได้")}return l.json()},delete:async(e,t,o)=>{let a=(0,n.b)("DELETE","".concat(h,"/").concat(e)),r=x(t,"");o&&(r["X-CSRF-Token"]=o);let i=await fetch(a,{method:"DELETE",headers:r,credentials:"include"});if(!i.ok){let e=await i.json().catch(()=>({}));throw Error(e.error||e.message||"ไม่สามารถลบออเดอร์ได้")}},updateItemStatus:async(e,t,o,a)=>{let r=(0,n.b)("PATCH","".concat(h,"/items/").concat(e,"/status")),i=x(o);a&&(i["X-CSRF-Token"]=a);let l=await fetch(r,{method:"PATCH",headers:i,credentials:"include",body:JSON.stringify({status:t})});if(!l.ok){let e=await l.json().catch(()=>({}));throw Error(e.error||e.message||"ไม่สามารถอัปเดตสถานะรายการได้")}},getItems:async(e,t)=>{let o=(0,n.b)("GET","".concat(h,"/items").concat(e?"?status=".concat(e):"")),a=x(t,""),r=await fetch(o,{cache:"no-store",headers:a,credentials:"include"});if(!r.ok){let e=await r.json().catch(()=>({}));throw Error(e.error||e.message||"ไม่สามารถดึงข้อมูลรายการได้")}return r.json()},addItem:async(e,t,o,a)=>{let r=(0,n.b)("POST","".concat(h,"/").concat(e,"/items")),i=x(o);a&&(i["X-CSRF-Token"]=a);let l=await fetch(r,{method:"POST",headers:i,credentials:"include",body:JSON.stringify(t)});if(!l.ok){let e=await l.json().catch(()=>({}));throw Error(e.error||e.message||"ไม่สามารถเพิ่มรายการได้")}return l.json()},updateItem:async(e,t,o,a)=>{let r=(0,n.b)("PUT","".concat(h,"/items/").concat(e)),i=x(o);a&&(i["X-CSRF-Token"]=a);let l=await fetch(r,{method:"PUT",headers:i,credentials:"include",body:JSON.stringify(t)});if(!l.ok){let e=await l.json().catch(()=>({}));throw Error(e.error||e.message||"ไม่สามารถแก้ไขรายการได้")}return l.json()},deleteItem:async(e,t,o)=>{let a=(0,n.b)("DELETE","".concat(h,"/items/").concat(e)),r=x(t,"");o&&(r["X-CSRF-Token"]=o);let i=await fetch(a,{method:"DELETE",headers:r,credentials:"include"});if(!i.ok){let e=await i.json().catch(()=>({}));throw Error(e.error||e.message||"ไม่สามารถลบรายการได้")}return i.json()},updateStatus:async(e,t,o)=>{let a={"Content-Type":"application/json"};o&&(a["X-CSRF-Token"]=o);let r=(0,n.b)("PUT","".concat(h,"/").concat(e));if(!(await fetch(r,{method:"PUT",headers:a,body:JSON.stringify({status:t}),credentials:"include"})).ok)throw Error("Failed to update status")}}},47799:function(e,t,o){o.d(t,{R:function(){return c}});var a=o(2913),n=o(71567),r=o(20019);let i=r.Ryn({id:r.Z_8(),product_name:r.Z_8(),display_name:r.Z_8(),description:r.Z_8().optional().or(r.Z_8()),price:r.Rxh().or(r.Z_8().transform(e=>Number(e))),category_id:r.Z_8(),unit_id:r.Z_8(),img_url:r.Z_8().nullable().optional(),create_date:r.Z_8().or(r.hTZ()).transform(e=>new Date(e)),update_date:r.Z_8().or(r.hTZ()).transform(e=>new Date(e)),is_active:r.O72().optional().default(!0),category:r.YjB().optional(),unit:r.YjB().optional()}),l=r.Ryn({data:r.IXX(i),total:r.Rxh(),page:r.Rxh(),last_page:r.Rxh()}),s=n.q.POS.PRODUCTS,c={findAll:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,o=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,r=(0,a.b)("GET",s),i=new URLSearchParams(n||"");i.append("page",e.toString()),i.append("limit",t.toString()),r+="?".concat(i.toString());let c={};o&&(c.Cookie=o);let d=await fetch(r,{cache:"no-store",credentials:"include",headers:c});if(!d.ok){let e=await d.json().catch(()=>({}));throw Error(e.error||e.message||"Failed to fetch products")}let p=await d.json();return l.parse(p)},findOne:async(e,t)=>{let o=(0,a.b)("GET","".concat(s,"/").concat(e)),n={};t&&(n.Cookie=t);let r=await fetch(o,{cache:"no-store",credentials:"include",headers:n});if(!r.ok){let e=await r.json().catch(()=>({}));throw Error(e.error||e.message||"Failed to fetch product")}let l=await r.json();return i.parse(l)},findOneByName:async(e,t)=>{let o=(0,a.b)("GET","".concat(s,"/name/").concat(e)),n={};t&&(n.Cookie=t);let r=await fetch(o,{cache:"no-store",credentials:"include",headers:n});if(!r.ok){let e=await r.json().catch(()=>({}));throw Error(e.error||e.message||"Failed to fetch product by name")}let l=await r.json();return i.parse(l)},create:async(e,t,o)=>{let n=(0,a.b)("POST",s),r={"Content-Type":"application/json"};t&&(r.Cookie=t),o&&(r["X-CSRF-Token"]=o);let i=await fetch(n,{method:"POST",headers:r,body:JSON.stringify(e),credentials:"include"});if(!i.ok){let e=await i.json().catch(()=>({}));throw Error(e.error||e.message||"Failed to create product")}return i.json()},update:async(e,t,o,n)=>{let r=(0,a.b)("PUT","".concat(s,"/").concat(e)),i={"Content-Type":"application/json"};o&&(i.Cookie=o),n&&(i["X-CSRF-Token"]=n);let l=await fetch(r,{method:"PUT",headers:i,body:JSON.stringify(t),credentials:"include"});if(!l.ok){let e=await l.json().catch(()=>({}));throw Error(e.error||e.message||"Failed to update product")}return l.json()},delete:async(e,t,o)=>{let n=(0,a.b)("DELETE","".concat(s,"/").concat(e)),r={};t&&(r.Cookie=t),o&&(r["X-CSRF-Token"]=o);let i=await fetch(n,{method:"DELETE",headers:r,credentials:"include"});if(!i.ok){let e=await i.json().catch(()=>({}));throw Error(e.error||e.message||"Failed to delete product")}}}},32446:function(e,t,o){var a,n,r,i;o.d(t,{i:function(){return n},m:function(){return a}}),(r=a||(a={})).DineIn="DineIn",r.TakeAway="TakeAway",r.Delivery="Delivery",(i=n||(n={})).Pending="Pending",i.Cooking="Cooking",i.Served="Served",i.WaitingForPayment="WaitingForPayment",i.Paid="Paid",i.Completed="Completed",i.Cancelled="Cancelled"},34962:function(e,t,o){var a,n;o.d(t,{c:function(){return a}}),(n=a||(a={})).Available="Available",n.Unavailable="Unavailable"},252:function(e,t,o){o.d(t,{NE:function(){return c},Th:function(){return l},Do:function(){return d},Yx:function(){return p},Zu:function(){return u},Oi:function(){return s},W9:function(){return r},Tf:function(){return i}});var a=o(34962),n=o(32446);function r(e){let t={total:e.length,available:0,occupied:0,inactive:0};return e.forEach(e=>{e.is_active?e.status===a.c.Available?t.available++:t.occupied++:t.inactive++}),t}function i(e){return[...e].sort((e,t)=>{let o=parseInt(e.table_name.replace(/\D/g,"")),a=parseInt(t.table_name.replace(/\D/g,""));return isNaN(o)||isNaN(a)?e.table_name.localeCompare(t.table_name):o-a})}function l(e){return e.filter(e=>e.is_active)}function s(e){return e.is_active?"WaitingForPayment"===e.active_order_status?"waitingForPayment":e.status===a.c.Available?"available":"occupied":"inactive"}function c(e){return e?({Pending:"กำลังดำเนินการ",Cooking:"กำลังปรุง",Served:"เสิร์ฟแล้ว",WaitingForOrder:"รอรับออเดอร์",WaitingForPayment:"รอชำระเงิน",Paid:"ชำระเงินแล้ว",Completed:"เสร็จสมบูรณ์",Cancelled:"ยกเลิก"})[e]||e:""}function d(e){return e.reduce((e,t)=>(e.total++,t.status===n.i.Pending&&e.pending++,t.status===n.i.Cooking&&e.cooking++,t.status===n.i.Served&&e.served++,e),{total:0,pending:0,cooking:0,served:0})}function p(e){switch(e.status){case n.i.Pending:case n.i.Cooking:return"occupied";case n.i.Served:return"waitingForPayment";case n.i.Paid:return"available";default:return"inactive"}}let u=e=>{switch(e){case n.m.DineIn:case"DineIn":return"/pos/channels/dine-in";case n.m.TakeAway:case"TakeAway":return"/pos/channels/takeaway";case n.m.Delivery:case"Delivery":return"/pos/channels/delivery";default:return"/pos/orders"}}},97235:function(e,t,o){o.d(t,{P:function(){return l}});var a=o(5447);let n=null,r=0,i=null;async function l(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=Date.now();return!e&&n&&t-r<6e5?n:(i||(i=a.O.getCsrfToken().then(e=>(n=e||"",r=Date.now(),n)).finally(()=>{i=null})),i)}},67338:function(e,t,o){function a(e){return"฿".concat(e.toLocaleString("th-TH",{minimumFractionDigits:0,maximumFractionDigits:2}))}function n(e){var t;return(null===(t=e.category)||void 0===t?void 0:t.display_name)||"ไม่มีหมวดหมู่"}function r(e){return!!e.img_url&&e.img_url.length>0}o.d(t,{T4:function(){return a},dU:function(){return r},r6:function(){return n}})}}]);